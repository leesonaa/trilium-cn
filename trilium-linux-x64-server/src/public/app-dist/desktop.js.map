{"version":3,"file":"desktop.js","mappings":";qLAUe,MAAMA,UAA4B,IAC7CC,0BACI,MAAMC,EAAc,gCACpBA,EAAYC,UAAUC,6BAA8B,EAEpD,eAAwB,8BAA+B,CAAEF,eAC7D,CAEAG,8BACI,MAAMC,QAAuB,uBAEvBJ,QAAoB,yCAAkDI,EAAeC,OAAQ,CAAEC,UAAU,IAE/G,eAAwB,gBAAiB,CAACC,MAAOP,EAAYO,OACjE,CAEAJ,0BAAyB,aAACK,EAAY,eAAEC,IACpC,MAAMC,QAAmB,qBAAiC,CAACF,eAAcC,yBAGnEE,EAAA,uBAAqBD,EAAWL,QAEtC,MAAML,QAAoB,yCAAkDU,EAAWL,OAAQ,CAC3FC,UAAU,IAGd,iBAA0B,0BAA2B,CAACC,MAAOP,EAAYO,OAC7E,CAEAJ,8BAA6B,SAACS,IAC1B,MAAMP,EAASQ,EAAA,mBAA6BD,GAE5CE,KAAKC,mBAAmB,CAACN,eAAgBJ,GAC7C,CAEAW,4BACI,MAAMX,EAAS,sCACTY,EAAO,wCACTZ,GACA,uBAA+BA,EAAQY,EAE/C,CAEAC,wBACI,MAAMb,EAAS,sCACTY,EAAO,wCACTZ,GACA,mBAA2BA,EAAQY,EAE3C,CAEAE,+BACI,2BACJ,CAEAC,+BACI,2BACJ,CAEAC,sBACIC,EAAA,OAAa,kBAAmB,QACpC,CAEAC,sBACID,EAAA,OAAa,kBAAmB,OACpC,CAEAE,wBACIF,EAAA,SAAe,kBACnB,CAEAnB,oCACU,yCAAkD,cAAe,CAAEG,UAAU,GACvF,CAEAH,0CACUW,KAAKW,oBAAoB,UACnC,CAEAtB,sCACUW,KAAKW,oBAAoB,SACnC,CAEAtB,uCACUW,KAAKW,oBAAoB,UACnC,CAEAtB,0BAAyB,QAACuB,UAChB,iCAA0CA,GAAW,WAAY,CACnEpB,UAAU,EACVqB,cAAe,YAEvB,CAEAxB,2CACUW,KAAKW,oBAAoB,cACnC,CAEAtB,uCACUW,KAAKW,oBAAoB,UACnC,CAEAtB,0BAA0ByB,SAChB,iCAA0CA,EAAe,CAC3DtB,UAAU,EACVqB,cAAeC,GAEvB,CAEAzB,8BACI,MAAMS,EAAW,wCAEbA,SACM,yCAAkDA,EAAU,CAC9DN,UAAU,EACVL,UAAW,CACP4B,SAAU,WAI1B,CAEA1B,+BACI,MAAMS,EAAW,wCAEbA,SACM,yCAAkDA,EAAU,CAC9DN,UAAU,EACVL,UAAW,CACP4B,SAAU,gBAI1B,CAEA1B,oCACI,MAAMS,EAAW,wCAEbA,SACM,yCAAkDA,EAAU,CAC9DN,UAAU,EACVL,UAAW,CACP4B,SAAU,gBAI1B,CAEAC,oBACI,IAAKC,EAAA,qBAAoB,OACzB,MAAM,cAACC,GAAiBD,EAAA,uBAAqB,oBACvCE,EAAUD,EAAcE,gBAExBC,EADYF,EAAQG,OAAMC,GAAKA,EAAEC,cACZ,OAAS,OACpC,IAAK,MAAMC,KAAUN,EAASM,EAAOJ,IACzC,CAEAK,kBAAsB1B,MAAK,EAAS,EAAI,CACxC2B,mBAAsB3B,MAAK,EAAS,EAAI,CACxC4B,kBAAsB5B,MAAK,EAAS,EAAI,CACxC6B,mBAAsB7B,MAAK,EAAS,EAAI,CACxC8B,kBAAsB9B,MAAK,EAAS,EAAI,CACxC+B,kBAAsB/B,MAAK,EAAS,EAAI,CACxCgC,oBAAsBhC,MAAK,EAAS,EAAI,CACxCiC,kBAAsBjC,MAAK,EAAS,EAAI,CACxCkC,kBAAsBlC,MAAK,EAAS,EAAI,CACxCmC,iBAAsBnC,MAAK,EAASoC,OAAOC,kBAAoB,CAE/D,GAASC,GACL,MAAMC,EAAmB,mCAGnBC,EAAMD,EADED,IAAcF,OAAOC,kBAAoBE,EAAiBE,OAAS,EAAIH,EAAY,GAG7FE,GACA,iCAA0CA,EAAI/C,MAEtD,wDC/KW,MAAMiD,UAAoB,IACrCC,cACIC,QAEIC,OAAOC,UAEPD,OAAOC,QAAQtC,QAAQuC,8BAA+B,EACtDF,OAAOC,QAAQtC,QAAQwC,uBAAwB,EAC/CH,OAAOC,QAAQtC,QAAQyC,kBAAmB,EAElD,CAEAC,sBACQjC,EAAA,sBACAA,EAAA,uBAAqB,oBAAoBkC,mBAAmBC,gBAEpE,CAEA/D,mCACI,MAAMgE,QAAkB,oBAElB,KAACC,SAAcC,EAAA,OAAY,SAASF,EAAU9D,8BAA+B,CAC/EiE,QAAS,GACTC,KAAM,OACNC,YAAaL,EAAUK,aAAe,0CAGpCC,EAAA,wCAEA,yCAAkDL,EAAK/D,OAAQ,CAACC,UAAU,IAEhF,eAAwB,sBAAuB,CAACoE,WAAW,GAC/D,CAEAvE,iCAAgC,OAACE,EAAS,wCACtC,MAAMsE,QAAoBhE,EAAA,gBAAcN,GAClCuE,EAAoB,gCAEtBD,EAAYtE,SAAWuE,EAAkBjD,oBACnCiD,EAAkBC,UAEE,WAArBF,EAAYJ,YACXK,EAAkBE,iBAAiBzE,EAEjD,CAEAF,wBAAuB,OAACE,IACpB,MAAML,EAAc,gCAEhBA,EAAY2B,gBAAkBtB,SACxBL,EAAY8E,iBAAiBzE,EAE3C,CAEAF,uBACI,MAAMyE,EAAoB,gCAEtBA,GACAA,EAAkBC,SAE1B,CAEAE,+BACIhD,EAAA,kCACJ,CAEAiD,0BACI,GAAIjD,EAAA,qBAAoB,CACpB,MAAMkD,EAAMlD,EAAA,uBAAqB,oBAAoBkC,mBAEjDgB,EAAIC,oBACJD,EAAIE,eAAeF,EAAIG,eAE/B,CACJ,CAEAC,2BACItD,EAAA,2BACJ,CAEAuD,gBACI,MAAMC,EAAcC,EAAE,wCACjBC,OAAOD,EAAE,6CAA6CE,KAAKC,iBAEhEH,EAAE,QAAQC,OAAOF,GACjBA,EAAYK,QAAQ,SACxB,CAEAC,2BACI,GAAI9D,EAAA,qBAAoB,CAEpB,MAAM+D,EAAc/D,EAAA,uBAAqB,oBAAoBgE,wBACvDC,EAAcC,SAASH,EAAYI,kBAEzCJ,EAAYK,UAAUH,EAAc,EACxC,MAEIzD,OAAO6D,QAAQC,MAEvB,CAEAC,8BACI,GAAIvE,EAAA,qBAAoB,CAEpB,MAAM+D,EAAc/D,EAAA,uBAAqB,oBAAoBgE,wBACvDC,EAAcC,SAASH,EAAYI,kBAEzCJ,EAAYK,UAAUH,EAAc,EACxC,MAEIzD,OAAO6D,QAAQG,SAEvB,CAEApG,sCACI4B,EAAA,kBAAgB,iBAAkB,WAElCA,EAAA,0BAAwB,WAC5B,CAEA5B,qCACI4B,EAAA,kBAAgB,iBAAkB,UAElCA,EAAA,0BAAwB,WAC5B,CAEA5B,2BAA0B,SAACS,EAAQ,cAAEe,EAAa,UAAE1B,IAChD,MAAMuG,EAAkB,kBAA0B,CAAC5F,WAAUe,gBAAe1B,cAE5E,GAAI8B,EAAA,qBAAoB,CACpB,MAAM,YAAC0E,GAAe1E,EAAA,uBAAqB,YAE3C0E,EAAYC,KAAK,sBAAuB,CAAEF,mBAC9C,KACK,CACD,MAAMG,EAAM,GAAGpE,OAAOqE,SAASC,aAAatE,OAAOqE,SAASE,OAAOvE,OAAOqE,SAASG,yBAAyBP,IAE5GjE,OAAOyE,KAAKL,EAAK,GAAI,wBACzB,CACJ,CAEAxG,6BACIW,KAAKmG,oBAAoB,CAACrG,SAAU,GAAIe,cAAe,QAC3D,CAEAxB,6BACI,MAAM,MAACI,EAAK,KAAE6D,GAAQ,gCAGtB,GAAKA,GAAsB,SAAdA,EAAKG,KAAlB,CAKA,GAAIH,EAAKnD,KAAKiG,SAAS,sBACbC,EAAA,4BAAkC/C,EAAK/D,aAC1C,GAAI+D,EAAKnD,KAAKiG,SAAS,qBACpB7C,EAAA,OAAY,cAAcD,EAAK/D,eAClC,GAAkB,iCAAd+D,EAAKnD,KAAyC,CACrD,MAAMmG,QAAa/C,EAAA,OAAY,eAAeD,EAAK/D,UAE9C+G,EAAKC,SACNC,EAAA,kBAAuB,6CAA6CF,EAAKG,eAGvE,eAAwB,kBAAmB,CAAChH,MAAOA,EAAOiH,QAASJ,EAAKI,SAClF,CAEAF,EAAA,oBAAyB,QAjBzB,CAkBJ,CAEAG,gBACQ1F,EAAA,qBACAyD,EAAE,aAAakC,aAAa,QAEpC,CAEAC,oBACI7G,KAAK2G,eACT,CAEAG,4BACI9G,KAAK2G,eACT,CAEAtH,iCACI,MAAME,EAAS,4CAETgE,EAAA,OAAY,SAAShE,cAE3BiH,EAAA,oBAAyB,UAC7B,oCCjMJ,MAAMO,UAAoB,IACtBpE,YAAYlD,EAAQ,KAAMoB,EAAgB,OAAQmG,EAAY,MAC1DpE,QAEA5C,KAAKP,MAAQA,GAASO,KAAK2C,YAAYsE,gBACvCjH,KAAKa,cAAgBA,EACrBb,KAAKgH,UAAYA,EAEjBhH,KAAKkH,gBACT,CAEAC,uBACI,OAAOlG,EAAA,qBAAmB,EAC9B,CAEAmG,WACIpH,KAAKF,SAAW,KAChBE,KAAKT,OAAS,KACdS,KAAKqH,aAAe,KAGpBrH,KAAKsH,aAAa,eAAgB,CAC9BpI,YAAac,KACbF,SAAUE,KAAKF,WAGnBE,KAAKkH,gBACT,CAEAK,UACI,OAAQvH,KAAKT,MACjB,CAEAF,cAAcmI,EAAeC,EAAO,CAAC,GACjCA,EAAKC,wBAAiDC,IAA5BF,EAAKC,oBAAmCD,EAAKC,mBACvED,EAAKtI,UAAYsI,EAAKtI,WAAa,CAAC,EACpCsI,EAAKtI,UAAU4B,SAAW0G,EAAKtI,UAAU4B,UAAY,UAErD,MAAM6G,QAAyB5H,KAAK6H,oBAAoBL,GAEnDI,IAID5H,KAAKF,WAAa8H,GAAoB3G,EAAA,wBAAsBjB,KAAKb,UAAWsI,EAAKtI,mBAI/Ea,KAAKsH,aAAa,mBAAoB,CAACpI,YAAac,OAE1DiB,EAAA,4BAEAjB,KAAKF,SAAW8H,EAChB5H,KAAKb,UAAYsI,EAAKtI,YACpBI,OAAQS,KAAKT,OAAQ8H,aAAcrH,KAAKqH,cAAgBtH,EAAA,8BAAwC6H,IAElG5H,KAAK8H,kBAAkBF,GAEvB,qCAAwD5H,KAAKsD,MAEzDmE,EAAKC,0BACC1H,KAAKsH,aAAa,eAAgB,CACpCpI,YAAac,KACbF,SAAUE,KAAKF,iBAIjBE,KAAK+H,yBAEP9G,EAAA,oBACAjB,KAAKgI,eAAe,kBAAmB,CAACC,OAAQ,YAExD,CAEA5I,+BACI,GAA2B,SAAvBW,KAAKa,eACFb,KAAKF,SAASoI,WAAW,kBACxBlI,KAAKsD,KAAK6E,cAAc,uBAC9B,CAGE,IAAItH,EAAgB,UAEhBb,KAAKsD,KAAK8E,oBACVvH,EAAgB,UACTb,KAAKsD,KAAK+E,cACjBxH,EAAgB,kBAGdb,KAAKgE,iBAAiBnD,EAChC,CACJ,CAEAyH,iBACI,OAAO,kCAA0CC,GAAMA,EAAG9I,QAAUO,KAAKP,OAAS8I,EAAGvB,YAAchH,KAAKP,OAC5G,CAUA+I,gBAEI,OAAQxI,KAAKgH,SACjB,CAOAyB,iBACI,IAAIzI,KAAKgH,UAUL,OAAOhH,KATP,IACI,OAAO,gCAAyCA,KAAKgH,UACzD,CACA,MAAO0B,GAEH,OADA1I,KAAKgH,UAAY,KACVhH,IACX,CAKR,CAEA8H,kBAAkBF,GACde,YAAWtJ,UAEHuI,GAAoBA,IAAqB5H,KAAKF,gBACxCyD,EAAA,OAAY,eAAgB,CAC9BhE,OAAQS,KAAKsD,KAAK/D,OAClBO,SAAUE,KAAKF,UAEvB,GACD,IACP,CAEAT,0BAA0BmI,GACtB,MAAMI,QAAyB7H,EAAA,kBAA4ByH,EAAexH,KAAKa,eAE/E,GAAK+G,GAKL,IAAyE,UAA/D,oBAAmCA,EAAkB5H,MAI/D,OAAO4H,OARHgB,SAAS,4BAA4BpB,IAS7C,CAGIlE,WACA,OAAKtD,KAAKT,QAAYS,KAAKT,UAAUM,EAAA,cAI9BA,EAAA,cAAYG,KAAKT,QAHb,IAIf,CAGIsJ,oBACA,OAAO7I,KAAKF,SAAWE,KAAKF,SAASgJ,MAAM,KAAO,EACtD,CAEAC,WACI,OAAO,2BAAsC/I,KAAKP,KACtD,CAEAuJ,eACI,MAA2B,SAAvBhJ,KAAKa,eAGAb,KAAKF,UAA6C,IAAjCE,KAAKsI,iBAAiB7F,OAKzC,CACHhD,MAAOO,KAAKP,MACZuH,UAAWhH,KAAKgH,UAChBlH,SAAUE,KAAKF,SACfe,cAAeb,KAAKa,cACpBoI,OAAQjJ,KAAK+I,WACb5J,UAAWa,KAAKb,WAVL,IAYnB,CAEAE,sBACUW,KAAKgE,iBAAiB,OAChC,CAEA3E,uBAAuB6J,GACflJ,KAAKa,gBAAkBqI,IAI3BlJ,KAAKa,cAAgBqI,EAEhBlJ,KAAK6I,eAAeM,SAASD,IAAmBjI,EAAA,0BAC3CjB,KAAKoJ,QAAQF,SAGjBlJ,KAAKsH,aAAa,qBAAsB,CAC1C/H,OAAQ2J,EACRzJ,MAAOO,KAAKP,QAEpB,CAGAJ,mBACI,GAAIW,KAAKb,UAAUC,4BACf,OAAO,EAIX,IAAKY,KAAKsD,MAA4B,SAAnBtD,KAAKsD,KAAKG,MAAsC,SAAnBzD,KAAKsD,KAAKG,KACtD,OAAO,EAGX,GAAIzD,KAAKsD,KAAK6E,cAAc,YACxB,OAAO,EAGX,GAAgC,WAA5BnI,KAAKb,UAAU4B,SACf,OAAO,EAGX,MAAMsI,QAAarJ,KAAKsD,KAAKgG,UAEvBC,EAA+B,SAAnBvJ,KAAKsD,KAAKG,KACtBjD,EAAA,SAAe,wBACfA,EAAA,SAAe,wBAErB,OAAO6I,EAAKG,cAAgBD,IACpBvJ,KAAKsD,KAAK6E,cAAc,uBACpC,CAEA9I,6BAA4B,YAACoK,IACrBA,EAAYC,eAAe1J,KAAKT,SAChBkK,EAAYE,aAAa,QAAS3J,KAAKT,QAE3CqK,YACR5J,KAAKT,OAAS,KACdS,KAAKF,SAAW,KAEhBE,KAAKsH,aAAa,eAAgB,CAC9BpI,YAAac,KACbF,SAAUE,KAAKF,WAI/B,CAEA+J,cACI,OAAO7J,KAAKsD,MACuB,YAA5BtD,KAAKb,UAAU4B,UACff,KAAKsD,KAAKwG,eACV,CAAC,OAAQ,OAAQ,QAAQX,SAASnJ,KAAKsD,KAAKG,OACzB,iCAAnBzD,KAAKsD,KAAKnD,OACTH,KAAKsD,KAAK6E,cAAc,uBACpC,CAEA9I,oBAAoB0K,GAChB,OAAO/J,KAAKgK,QAAQ,IAAIC,SAAQC,GAAW,iBAA0B,wBAAyB,CAC1FH,WACAG,UACAzK,MAAOO,KAAKP,UAEpB,CAEAJ,sBACI,OAAOW,KAAKgK,QAAQ,IAAIC,SAAQC,GAAW,iBAA0B,wBAAyB,CAC1FA,UACAzK,MAAOO,KAAKP,UAEpB,CAEAJ,0BACI,OAAOW,KAAKgK,QAAQ,IAAIC,SAAQC,GAAW,iBAA0B,4BAA6B,CAC9FA,UACAzK,MAAOO,KAAKP,UAEpB,CAEAJ,sBACI,OAAOW,KAAKgK,QAAQ,IAAIC,SAAQC,GAAW,iBAA0B,wBAAyB,CAC1FA,UACAzK,MAAOO,KAAKP,UAEpB,CAEAuK,QAAQG,GACJ,OAAOF,QAAQG,KAAK,CAChBD,EACA,IAAIF,SAAQI,GAAO1B,YAAW,IAAM0B,EAAI,OAAO,QAEvD,CAEAnD,iBAIIlH,KAAKb,UAAY,CAAC,CACtB,CAEAE,2BACI,IAAKW,KAAKsD,KACN,OAAO,KAGX,MAAM,KAAEA,EAAI,UAAEnE,GAAca,KAE5B,IAAIsK,EAA+B,YAAvBnL,EAAU4B,SAChBuC,EAAKgH,MACL,GAAGhH,EAAKgH,UAAUnL,EAAU4B,WAElC,GAAI5B,EAAUoL,aAAc,CAExB,MAAMC,QAAmBlH,EAAKmH,kBAAkBtL,EAAUoL,cAEtDC,IACAF,GAAS,KAAKE,EAAWF,QAEjC,CAEA,OAAOA,CACX,EAGJ,UC1Ve,MAAMI,EACjB/H,cACI3C,KAAK2K,QAAUV,QAAQC,SAC3B,CAGAU,OACI,IAAIC,EACJ,MAAMC,EAAa,IAAIb,SAAQC,GAAWW,EAAa,IAAMX,MAEvDa,EAAa/K,KAAK2K,QAAQK,MAAK,IAAMH,IAI3C,OAFA7K,KAAK2K,QAAUG,EAERC,CACX,CAEA1L,qBAAqB4L,GACjB,MAAMC,QAAelL,KAAK4K,OAE1B,IACI,aAAaK,GACjB,CACA,QACIC,GACJ,CACJ,ECdW,MAAMC,UAAmB,IACpCxI,cACIC,QAGA5C,KAAKoL,SAAW,GAChBpL,KAAKqL,MAAQ,IAAIX,EAEjB1K,KAAKsL,YAAc,KAGnBtL,KAAKuL,mBAAqB,GAE1BvL,KAAKwL,WAAa,IAAI,KAAanM,UAC/B,IAAK,eACD,OAGJ,MAAMoM,EAAmBzL,KAAK0L,aACzBC,KAAIpD,GAAMA,EAAGS,iBACb4C,QAAOC,KAAOA,UAEbtI,EAAA,MAAW,UAAW,CACxBkI,iBAAkBK,KAAKC,UAAUN,IACnC,IAGN,0BAAmCzL,KACvC,CAGI0L,mBACA,OAAO1L,KAAKoL,QAChB,CAGI7I,uBACA,OAAOvC,KAAK0L,aAAaE,QAAOrD,IAAOA,EAAGvB,WAC9C,CAEA3H,iBACI,IACI,MAAM2M,EAAsB,gBAA2BxL,EAAA,UAAgB,qBAAwB,SAGzFX,EAAA,iBAAe,IACVmM,EAAmBC,SAAQzJ,GAC1B,CAAEzC,EAAA,mBAA6ByC,EAAI1C,UAAW0C,EAAI3B,mBAE3D,GAEH,MAAMqL,EAAuBF,EAAmBJ,QAAOO,GAC/ClL,EAAA,qBACSkL,EAAQlD,OAGNlJ,EAAA,mBAA6BoM,EAAQrM,YACpCD,EAAA,gBAKVsM,EAAQtL,iBAAiBhB,EAAA,gBAC3BsM,EAAQtL,cAAgB,SAGrB,KAILuL,EAAgB,gCAAwC3K,OAAOqE,SAASuG,MAE1C,IAAhCH,EAAqBzJ,QACrB2J,EAAc3M,MAAQ2M,EAAc3M,OAAS,kBAE7CyM,EAAqBI,KAAK,CACtBxM,SAAUsM,EAActM,UAAY,OACpCL,MAAO2M,EAAc3M,MACrBwJ,QAAQ,EACRpI,cAAeuL,EAAcvL,eAAiB,OAC9C1B,UAAWiN,EAAcjN,WAAa,CAAC,KAEnC+M,EAAqBK,MAAK/J,GAAOA,EAAIyG,WAC7CiD,EAAqB,GAAGjD,QAAS,SAG/BjJ,KAAKwL,WAAWgB,0BAAyBnN,UAC3C,IAAK,MAAMmD,KAAO0J,QACRlM,KAAKyM,oBAAoBjK,EAAI1C,SAAU,CACzCN,SAAUgD,EAAIyG,OACdxJ,MAAO+C,EAAI/C,MACXuH,UAAWxE,EAAIwE,UACfnG,cAAe2B,EAAI3B,cACnB1B,UAAWqD,EAAIrD,WAEvB,IAKAiN,EAActM,eACR,iCACFsM,EAAc3M,MACd2M,EAActM,SACdsM,EAAcjN,UACdiN,EAAcvL,eAEXuL,EAAc1M,oBACf,iBAA0B,cAAe,CAC3CA,aAAc0M,EAAc1M,cAGxC,CACA,MAAOgJ,GACHE,SAAS,0BAA0BpI,EAAA,MAAY,gCAAgCkI,EAAEgE,WAAWhE,EAAEiE,eAGxF3M,KAAK4M,cACf,CACJ,CAEA/F,mBAAkB,YAAC3H,IACXA,EAAY6J,YACZ/I,KAAK6M,kCAGT7M,KAAKwL,WAAWsB,gBACpB,CAEAD,kCACI,MAAME,EAAiB/M,KAAKgN,gBAGE,IAA1BvL,OAAO6D,QAAQ7C,QAAgBsK,IAAmBtL,OAAOqE,UAAUmH,MAEnExL,OAAO6D,QAAQ4H,UAAU,KAAM,GAAIH,GAGvC,MAAMjJ,EAAoB9D,KAAKmN,mBAC/BnN,KAAKoN,oBAAoBtJ,GAEzB9D,KAAKsH,aAAa,oBACtB,CAEA0F,gBACI,MAAMlJ,EAAoB9D,KAAKmN,mBAC/B,OAAKrJ,EAIE,kBAA0B,CAC7BhE,SAAUgE,EAAkBhE,SAC5BL,MAAOqE,EAAkBrE,MACzBoB,cAAeiD,EAAkBjD,cACjC1B,UAAW2E,EAAkB3E,YAPtB,EASf,CAGAkO,kBACI,OAAOrN,KAAK0L,YAChB,CAMA4B,sBACI,OAAOtN,KAAK0L,aAAaE,QAAOrD,GAAMA,EAAGC,iBAC7C,CAGA+E,mBAAmB9N,GACf,MAAMP,EAAcc,KAAK0L,aAAaa,MAAKhE,GAAMA,EAAG9I,QAAUA,IAE9D,IAAKP,EACD,MAAM,IAAIsO,MAAM,uBAAuB/N,MAG3C,OAAOP,CACX,CAOAiO,mBACI,OAAOnN,KAAKsL,YACNtL,KAAKuN,mBAAmBvN,KAAKsL,aAC7B,IACV,CAOAmC,uBACI,OAAOzN,KAAKsL,YACNtL,KAAKuN,mBAAmBvN,KAAKsL,aAAa7C,iBAC1C,IACV,CAGAiF,2BACI,MAAMC,EAAgB3N,KAAKmN,mBAC3B,OAAOQ,EAAgBA,EAAc7N,SAAW,IACpD,CAGA8N,uBACI,MAAMD,EAAgB3N,KAAKmN,mBAC3B,OAAOQ,EAAgBA,EAAcrK,KAAO,IAChD,CAGAuK,yBACI,MAAMC,EAAa9N,KAAK4N,uBAExB,OAAOE,EAAaA,EAAWvO,OAAS,IAC5C,CAGAwO,2BACI,MAAMD,EAAa9N,KAAK4N,uBAExB,OAAOE,EAAaA,EAAWrK,KAAO,IAC1C,CAEAuK,2BACI,MAAMF,EAAa9N,KAAK4N,uBAExB,OAAOE,EAAaA,EAAW3N,KAAO,IAC1C,CAEAd,0BAA0BI,EAAOK,EAAUX,EAAY,CAAC,EAAG0B,EAAgB,MACvE,MAAM3B,EAAcc,KAAK0L,aAAaa,MAAKhE,GAAMA,EAAG9I,QAAUA,WACjDO,KAAK4M,qBAEZ5M,KAAKiO,oBAAoB/O,EAAYO,OAEvCoB,SACM3B,EAAY8E,iBAAiBnD,GAGnCf,SACMZ,EAAYkK,QAAQtJ,EAAU,CAAEX,aAE9C,CAEAE,gCACI,MAAMH,QAAoBc,KAAK4M,qBAEzB5M,KAAKiO,oBAAoB/O,EAAYO,aAErCP,EAAYkI,UACtB,CAEA/H,mBAAmBI,EAAQ,KAAMoB,EAAgB,OAAQmG,EAAY,MACjE,MAAM9H,EAAc,IAAI,EAAYO,EAAOoB,EAAemG,GAE1D,IAAIkH,EAUJ,OALIA,EAHAjN,EAAA,mBAGsBjB,KAAKmN,mBAELnN,KAAKoL,SAASmB,MAAKhE,GAAMA,EAAG9I,QAAUP,EAAYO,QAGxEyO,SACMA,EAAoBlK,iBAAiBnD,GAEpCqN,IAGXlO,KAAKmO,MAAMjP,SAELc,KAAKsH,aAAa,wBAAyB,CAACpI,gBAE3CA,EACX,CAEAG,mBAAmB+O,EAAcvN,EAAgB,MAC7C,MAAM3B,QAAoBc,KAAK4M,aAAa,KAAM/L,GAAiBb,KAAKmN,mBAAmBtM,qBAErF3B,EAAYkK,QAAQgF,EAC9B,CAEA/O,oBAAoB+O,EAAcvN,EAAgB,MAC9C,MAAM8M,EAAgB3N,KAAKmN,yBACrBQ,EAAc3J,iBAAiBnD,GAAiB8M,EAAc9M,qBAC9D8M,EAAcvE,QAAQgF,EAChC,CAKA/O,kCAAkCS,EAAU2H,EAAO,CAAC,GAChD,MAAMvI,EAAcc,KAAKmN,mBACzB,IAAItM,EAAgB,OAEpB,GAAI3B,EAAa,CACb,MAAM0I,QAAyB7H,EAAA,kBAA4BD,EAAUZ,EAAY2B,gBAE7E+G,EAAiBuB,SAASjK,EAAY2B,gBAAkB+G,EAAiBuB,SAAS,cAClFtI,EAAgB3B,EAAY2B,cAEpC,CAIA,OAFA4G,EAAK5G,cAAgBA,EAEdb,KAAKyM,oBAAoB3M,EAAU2H,EAC9C,CAEApI,0BAA0BS,EAAU2H,EAAO,CAAC,GACxC,MAAMjI,IAAaiI,EAAKjI,SAClBC,EAAQgI,EAAKhI,OAAS,KACtBuH,EAAYS,EAAKT,WAAa,KAC9BnG,EAAgB4G,EAAK5G,eAAiB,OACtC1B,EAAYsI,EAAKtI,WAAa,CAAE4B,SAAU,WAE1C7B,QAAoBc,KAAK4M,aAAanN,EAAOoB,EAAemG,GAmBlE,OAjBIlH,SACMZ,EAAYkK,QAAQtJ,EAAU,CAEhC4H,oBAAqBlI,EACrBL,UAAWA,IAIfK,IACAQ,KAAKiO,oBAAoB/O,EAAYO,OAAO,SAEtCO,KAAKsH,aAAa,2BAA4B,CAChDpI,cACAY,SAAUZ,EAAYY,YAIvBZ,CACX,CAEAG,yBAAyBE,GACrB,IAAK,MAAML,KAAec,KAAKqN,kBAC3B,GAAInO,EAAYoE,MAAQpE,EAAYoE,KAAK/D,SAAWA,EAGhD,YAFAS,KAAKiO,oBAAoB/O,EAAYO,aAQvCO,KAAKyM,oBAAoBlN,EAAQ,CAAEC,UAAU,GACvD,CAEAH,0BAA0BI,EAAO6H,GAAe,GACxC7H,IAAUO,KAAKsL,cAInBtL,KAAKsL,YAAc7L,EAEf6H,SACMtH,KAAKsH,aAAa,uBAAwB,CAC5CpI,YAAac,KAAKuN,mBAAmB9N,KAI7CO,KAAKwL,WAAWsB,iBAEhB9M,KAAK6M,kCACT,CAMAxN,wBAAwBI,GAGpB,aAAaO,KAAKqL,MAAMgD,gBAAehP,UACnC,IAAIiP,EAEJ,IACIA,EAAsBtO,KAAKuN,mBAAmB9N,EAClD,CACA,MAEI,OAAO,CACX,CAEA,GAAI6O,EAAoB9F,iBAGY,IAFPxI,KAAKqN,kBAAkBzB,QAAOrD,GAAMA,EAAGC,kBAE3C/F,OAAc,CAC/B,GAAI6L,EAAoB/G,UAGpB,OAAO,QAGLvH,KAAK4M,cACf,CAIJlI,EAAE,aAAakC,aAAa,SAE5B,MAAM2H,EAAuBD,EAAoBhG,iBAC3CkG,EAAiBD,EAAqB5C,KAAIpD,GAAMA,EAAG9I,QAIzD,SAFMO,KAAKsH,aAAa,0BAA2B,CAAEmH,OAAQD,IAExDF,EAAoB9F,gBAQhBxI,KAAKuC,iBAAiBE,QAAU,QAC/BzC,KAAK0O,0BAENF,EAAerF,SAASnJ,KAAKsL,eACtBtL,KAAKuC,iBAAiBoM,WAAUpG,GAAMA,EAAG9I,QAAU6O,EAAoB7O,UAEvEO,KAAKuC,iBAAiBE,OAAS,QACjCzC,KAAK4O,mCAGL5O,KAAK6O,8BAlBuB,CACtC,MAAMC,EAAWR,EAAoB7F,iBAAiBH,iBAChDyG,EAAMD,EAASH,WAAUpG,GAAMA,EAAG9I,QAAU6O,EAAoB7O,QAEhEuP,EAAoBF,EADGC,IAAQD,EAASrM,OAAS,EAAIsM,EAAM,EAAIA,EAAM,SAGrE/O,KAAKiO,oBAAoBe,EAAkBvP,MACrD,CAiBA,OAFAO,KAAKiP,mBAAmBV,IAEjB,CAAI,GAEnB,CAEAU,mBAAmBV,GACf,MAAMC,EAAiBD,EAAqB5C,KAAIpD,GAAMA,EAAG9I,QAEnDyP,EAAWlP,KAAK0L,aAAaiD,WAAUpG,GAAMiG,EAAerF,SAASZ,EAAG9I,SAE9EO,KAAKoL,SAAWpL,KAAKoL,SAASQ,QAAOrD,IAAOiG,EAAerF,SAASZ,EAAG9I,SAEvEO,KAAKmP,wBAAwBZ,EAAsBW,GAEnDlP,KAAKsH,aAAa,qBAAsB,CAACmH,OAAQD,IAEjDxO,KAAKwL,WAAWsB,gBACpB,CAEAqC,wBAAwBzD,EAAcwD,GACN,IAAxBxD,EAAajJ,QAAgBiJ,EAAa,GAAGnE,WAIjDvH,KAAKuL,mBAAmBe,KAAK,CAAC8C,SAAU1D,EAAcwD,SAAUA,GACpE,CAEAG,iBAAgB,cAACC,IACb,MAAMC,EAAQ,CAAC,EAEf,IAAIC,EAAI,EAER,IAAK,MAAM/P,KAAS6P,EAChB,IAAK,MAAMpQ,KAAec,KAAKuN,mBAAmB9N,GAAO6I,iBACrDiH,EAAMrQ,EAAYO,OAAS+P,IAInCxP,KAAKoL,SAASqE,MAAK,CAACC,EAAGC,IAAMJ,EAAMG,EAAEjQ,OAAS8P,EAAMI,EAAElQ,QAAU,EAAI,IAEpEO,KAAKwL,WAAWsB,gBACpB,CAEA8C,yBAAwB,cAACN,EAAa,aAAEO,EAAY,aAAEC,IAClD,MAAMP,EAAQQ,OAAOC,YAAYV,EAAc3D,KAAI,CAACsE,EAAGT,IAAM,CAACS,EAAGT,MAEjExP,KAAKoL,SAASqE,MAAK,CAACC,EAAGC,IAAMJ,EAAMG,EAAEjQ,OAAS8P,EAAMI,EAAElQ,QAAU,EAAI,IAEhEoQ,GAAgBC,GAChB9P,KAAKoL,SAAS8E,SAAQC,IACdA,EAAE1Q,QAAUqQ,EAEZK,EAAEnJ,UAAY,KACPmJ,EAAE1Q,QAAUoQ,GAAgBM,EAAEnJ,YAAc6I,IAEnDM,EAAEnJ,UAAY8I,EAClB,IAIR9P,KAAKwL,WAAWsB,gBACpB,CAEAzN,+BACI,MAAM+Q,EAAkBpQ,KAAKyN,uBAAuBhO,MAE9C4Q,EAASrQ,KAAKuC,iBAAiBoM,WAAUpG,GAAMA,EAAG9I,QAAU2Q,IAC5DE,EAAiBtQ,KAAKuC,iBAAiB8N,IAAWrQ,KAAKuC,iBAAiBE,OAAS,EAAI,EAAI4N,EAAS,GAAG5Q,YAErGO,KAAKiO,oBAAoBqC,EACnC,CAEAjR,mCACI,MAAM+Q,EAAkBpQ,KAAKyN,uBAAuBhO,MAE9C4Q,EAASrQ,KAAKuC,iBAAiBoM,WAAUpG,GAAMA,EAAG9I,QAAU2Q,IAC5DE,EAAiBtQ,KAAKuC,iBAA4B,IAAX8N,EAAerQ,KAAKuC,iBAAiBE,OAAS,EAAI4N,EAAS,GAAG5Q,YAErGO,KAAKiO,oBAAoBqC,EACnC,CAEAjR,oCACUW,KAAKuQ,kBAAkBvQ,KAAKsL,YACtC,CAEAkF,oBAGI,OAFAxQ,KAAKwL,WAAWiF,wBAET,CACX,CAEAC,oBACI1Q,KAAK0O,yBACT,CAEArP,4BACI,IAAK,MAAMsR,KAAiB3Q,KAAKuC,iBAAiBoJ,KAAIpD,GAAMA,EAAG9I,cACrDO,KAAKuQ,kBAAkBI,EAErC,CAEAtR,6BAA4B,MAACI,IACzB,IAAK,MAAMkR,KAAiB3Q,KAAKuC,iBAAiBoJ,KAAIpD,GAAMA,EAAG9I,QACvDkR,IAAkBlR,SACZO,KAAKuQ,kBAAkBI,EAGzC,CAEAtR,uBAAsB,MAACI,UACbO,KAAKuQ,kBAAkB9Q,EACjC,CAEAJ,iCAAgC,MAACI,IAC7B,MAAM,SAACK,EAAQ,cAAEe,GAAiBb,KAAKuN,mBAAmB9N,SAEpCO,KAAKuQ,kBAAkB9Q,IAGzCO,KAAKgI,eAAe,eAAgB,CAAClI,WAAUe,iBAEvD,CAEAxB,6BACI,IAAIuR,EAAoB,WAElB5Q,KAAKqL,MAAMgD,gBAAehP,UAC5B,GAAuC,IAAnCW,KAAKuL,mBAAmB9I,OACxB,OAG6B,IAA7BzC,KAAK0L,aAAajJ,QAAgBzC,KAAK0L,aAAa,GAAGnE,YAEvDqJ,EAAoB5Q,KAAK0L,aAAa,IAG1C,MAAMmF,EAAgB7Q,KAAKuL,mBAAmBuF,MACxCpF,EAAemF,EAAczB,SAEnC,IAAK,MAAMlQ,KAAewM,EACtB1L,KAAKmO,MAAMjP,SAELc,KAAKsH,aAAa,wBAAyB,CAACpI,gBAItD,MAAM6R,EAAc,IACb/Q,KAAK0L,aAAasF,MAAM,EAAGH,EAAc3B,aACzClP,KAAK0L,aAAasF,OAAOtF,EAAajJ,WACtCzC,KAAK0L,aAAasF,MAAMH,EAAc3B,UAAWxD,EAAajJ,eAE/DzC,KAAK4P,wBAAwB,CAACN,cAAeyB,EAAYpF,KAAIpD,GAAMA,EAAG9I,UAE5E,IAAIwR,EAAUvF,EAAaa,MAAKhE,GAAMA,EAAGC,kBACrCyI,QAEMjR,KAAKsH,aAAa,mBAAoB,CACxCN,UAAWiK,EAAQxR,MACnByR,YAAaH,EAAYnF,QAAOrD,GAAMA,EAAGC,kBAAiBmG,WAAUpG,GAAMA,EAAG9I,QAAUwR,EAAQxR,gBAI7FO,KAAKsH,aAAa,mBAAoB,CACxC7H,MAAOsR,EAAYF,EAAc3B,UAAUzP,MAE3C0R,WAAYJ,EAAYF,EAAc3B,SAAW,GAAGzP,QAI5D,MAAM2R,EAAgD,IAAxB1F,EAAajJ,OACrCiJ,EAAa,GACbA,EAAaa,MAAKhE,GAAMA,EAAGC,wBAE3BxI,KAAKiO,oBAAoBmD,EAAsB3R,aAE/CO,KAAKsH,aAAa,eAAgB,CACpCpI,YAAakS,EACbtR,SAAUsR,EAAsBtR,UAClC,IAGF8Q,SACM5Q,KAAKuQ,kBAAkBK,EAAkBnR,MAEvD,CAEA4R,0BACIrR,KAAKwL,WAAWsB,gBACpB,CAEAzN,0BAA0ByE,GACtB,MAAMwN,EAAiB,OAEbxN,EAAkByN,qBACxB,iBACF3F,OAAO4F,SAETC,SAASnH,MAAQgH,EAAeI,KAAK,MACzC,CAEArS,6BAA4B,YAACoK,IACzB,MAAMkE,EAAgB3N,KAAKmN,mBAEvBQ,GAAiBlE,EAAYC,eAAeiE,EAAcpO,eACpDS,KAAKoN,oBAAoBO,EAEvC,CAEAtO,2BACI,MAAMsO,EAAgB3N,KAAKmN,mBAEvBQ,SACM3N,KAAKoN,oBAAoBO,EAEvC,gBCxpBW,MAAMgE,UAAqC,IACtDC,wBAAuB,OAAC3J,IAChBA,IAAWjI,KAAK6R,eAChB7R,KAAK6R,aAAe5J,EAEL,SAAXA,GAC0B,gCAERb,WAGtBpH,KAAKsH,aAAa,sBAAuB,CAACuK,aAAc5J,IAEhE,gBCLW,MAAM6J,UAA0B,IACvC/R,WACA,OAAO,gBACX,CAEAV,4BACI,MAAM0S,EAA0B/R,KAAKD,KAAKiS,2BAA2BrG,KAAIsG,GAAQA,EAAKC,KAAK3S,SAE3FS,KAAKgI,eAAe,iBAAkB,CAACmK,QAASJ,GACpD,CAEA1S,2BACI,MAAM+S,EAA4BpS,KAAKD,KAAKiS,2BAA2BrG,KAAIsG,GAAQA,EAAKC,KAAKG,WAE7FrS,KAAKgI,eAAe,kBAAmB,CAACsK,UAAWF,GACvD,CAEA/S,8BACI,MAAMyE,EAAoB,gCAErBA,SAIC,eAA6BA,EAAkBhE,SAAU,CAC3D4D,YAAaI,EAAkBR,KAAKI,YACpC6O,eAAe,GAEvB,CAEAlT,+BACI,MAAM4S,EAAOjS,KAAKD,KAAKyS,gBAEvB,IAAKP,EACD,OAGJ,MAAMQ,EAAiB1S,EAAA,cAAwBkS,EAAKS,aAC9ChP,EAAc3D,EAAA,2BAAqCkS,GAEhC,SAArBA,EAAKC,KAAK3S,QAAqB0S,EAAKC,KAAK3S,SAAW,8BAIlD,eAA6BkT,EAAgB,CAC/CE,OAAQ,QACRC,eAAgBX,EAAKC,KAAKG,SAC1B3O,YAAaA,EACb6O,eAAe,GAEvB,gBCvDW,MAAMM,UAA0B,IAC3ClQ,cACIC,QAEAW,EAAA,MAAW,gCAAgCyH,MAAK8H,IAC5C,IAAK,MAAMC,KAAQD,EACf9S,KAAKgT,wBAAwBD,EACjC,GAER,CAEAC,wBAAwBC,GACpB,MACMC,EAAYD,EAAWE,YAEzBF,EAAWrJ,UACX,yBAAqCsJ,GAErC,uBAAmCD,EAAWG,OANlC,IAAM,gCAAyChK,QAAQ6J,EAAW1T,SAMhB2T,EAEtE,CAEA7T,6BAA4B,YAACoK,IACzB,IAAK,MAAMsJ,KAAQtJ,EAAY4J,mBAC3B,GAAkB,UAAdN,EAAKtP,MAAkC,qBAAdsP,EAAKO,KAA6B,CAC3D,MAAMhQ,QAAazD,EAAA,gBAAckT,EAAKxT,QAElC+D,GAAsB,aAAdA,EAAKG,MACbzD,KAAKgT,wBAAwBD,EAErC,CAER,ECtBJ,MAAMQ,UAAmB,IACrB5Q,YAAY6Q,GACR5Q,QAEA5C,KAAKwT,aAAeA,EAEpBxT,KAAKyT,WAAa,GAClBzT,KAAK0T,sBAAwB,EACjC,CAEAC,UAAUC,GACN5T,KAAK4T,OAASA,CAClB,CAEAvU,cACIW,KAAK6T,uBAGCrT,EAAA,qBAENR,KAAK8T,sBAECjU,EAAA,2BAENG,KAAK+T,WAAWC,WAEhBrL,YAAW,IAAMtC,EAAA,iCAAuC,IAC5D,CAEAwN,iBACI7T,KAAK+T,WAAa,IAAI5I,EAEtBnL,KAAKyT,WAAa,CACdzT,KAAK+T,WACL,IAAI/U,EACJ,IAAI0D,EACJ,IAAIoP,EACJ,IAAIe,GAGJ5R,EAAA,oBACAjB,KAAKyT,WAAWnH,KAAK,IAAIqF,GAG7B,IAAK,MAAMsC,KAAajU,KAAKyT,WACzBzT,KAAKmO,MAAM8F,GAGXhT,EAAA,sBACAjB,KAAKmO,MAAM+F,EAAA,EAEnB,CAEAJ,gBACI,MAAMK,EAAanU,KAAK4T,OAAOQ,cAAcpU,MACvCqU,EAAkBF,EAAWG,SAEnC,mCAAgDD,GAEhD3P,EAAE,QAAQC,OAAO0P,GAEjBA,EAAgBE,GAAG,QAAS,0BAA0B,WAClD,GAAI7P,EAAE1E,MAAMwU,SAAS,YACjB,OAGJ,MAAMC,EAAc/P,EAAE1E,MAAM+S,KAAK,wBACdrO,EAAE1E,MAAM0U,QAAQ,cACNC,KAAK,aAExB3M,eAAeyM,EAAa,CAACG,IAAKlQ,EAAE1E,OAClD,IAEAA,KAAKmO,MAAMgG,GAEXnU,KAAKsH,aAAa,wBACtB,CAGAA,aAAagM,EAAMpB,EAAO,CAAC,GACvB,OAAOlS,KAAK6U,YAAYvB,EAAMpB,EAClC,CAGAlK,eAAesL,EAAMpB,EAAO,CAAC,GACzB,IAAK,MAAM4C,KAAY9U,KAAKyT,WAAY,CACpC,MAAMsB,EAAMD,EAAS,GAAGxB,YAExB,GAAIyB,EACA,OAAOD,EAASE,WAAWD,EAAK7C,EAExC,CAMA,OAFA+C,QAAQC,MAAM,qBAAqB5B,2BAE5BtT,KAAKsH,aAAagM,EAAMpB,EACnC,CAEAiD,iBAAiBC,GACb,OAAO1Q,EAAE0Q,GAAIV,QAAQ,cAAcC,KAAK,YAC5C,CAEAU,wBAAwBC,GACG,mBAAZC,SAKXvV,KAAK0T,sBAAsBpH,KAAK,IAAIiJ,QAAQD,GAChD,EAGJ,MAAME,EAAa,IAAIjC,EAAW9R,OAAOmD,KAAK4O,cAG9C9O,EAAEjD,QAAQ8S,GAAG,gBAAgB,KACzB,IAAIkB,GAAW,EAEfD,EAAW9B,sBAAwB8B,EAAW9B,sBAAsB9H,QAAO8J,KAAQA,EAAGC,UAEtF,IAAK,MAAMC,KAAWJ,EAAW9B,sBAAuB,CACpD,MAAMO,EAAY2B,EAAQD,QAErB1B,IAIAA,EAAUzD,sBACXyE,QAAQY,IAAI,aAAa5B,EAAU6B,iDAEnCtP,EAAA,oBAAkB,uBAAwB,KAE1CiP,GAAW,GAEnB,CAEA,IAAKA,EACD,MAAO,aACX,IAGJ/Q,EAAEjD,QAAQ8S,GAAG,cAAc,WACvB,MAAM,SAACzU,EAAQ,MAAEL,EAAK,UAAEN,GAAa,gCAAwCsC,OAAOqE,SAASuG,OAEzFvM,GAAYL,IACZ+V,EAAWzB,WAAWgC,oBAAoBtW,EAAOK,EAAUX,EAEnE,IAEA,sEC1Je,MAAM6W,EACjBrT,cACI3C,KAAK8V,YAAc,GAAG9V,KAAKiW,sBAAsB,uBAAmB,KAEpEjW,KAAKoL,SAAW,GAChBpL,KAAKkW,YAAc,IACvB,CAEID,yBAEA,OAAOjW,KAAK2C,YAAY2Q,KAAK6C,QAAQ,cAAe,IACxD,CAEAC,UAAUC,GAGN,OADArW,KAAKqW,OAASA,EACPrW,IACX,CAEAmO,SAASsF,GACL,IAAK,MAAMQ,KAAaR,EACpBQ,EAAUmC,UAAUpW,MAEpBA,KAAKoL,SAASkB,KAAK2H,GAGvB,OAAOjU,IACX,CAGA6U,YAAYvB,EAAMpB,GACd,IACI,MAAMoE,EAAoBtW,KAAKkW,YACzBlW,KAAKkW,YAAYlL,MAAK,IAAMhL,KAAKgV,WAAWhV,KAAK,GAAGsT,UAAcpB,KAClElS,KAAKgV,WAAWhV,KAAK,GAAGsT,UAAcpB,GAEtCqE,EAAkBvW,KAAKwW,sBAAsBlD,EAAMpB,GAGzD,OAAOoE,GAAqBC,EACtBtM,QAAQwM,IAAI,CAACH,EAAmBC,IAC/BD,GAAqBC,CAChC,CACA,MAAO7N,GAGH,OAFAuM,QAAQxO,MAAM,sBAAsB6M,gBAAmBtT,KAAK2C,YAAY2Q,mBAAmB5K,EAAEgE,WAAWhE,EAAEiE,SAEnG,IACX,CACJ,CAGArF,aAAagM,EAAMpB,EAAO,CAAC,GACvB,OAAOlS,KAAKqW,OAAO/O,aAAagM,EAAMpB,EAC1C,CAGAsE,sBAAsBlD,EAAMpB,EAAO,CAAC,GAChC,MAAMwE,EAAW,GAEjB,IAAK,MAAMvI,KAASnO,KAAKoL,SAAU,CAC/B,MAAMuL,EAAMxI,EAAM0G,YAAYvB,EAAMpB,GAEhCyE,GACAD,EAASpK,KAAKqK,EAEtB,CAGA,OAAOD,EAASjU,OAAS,EAAIwH,QAAQwM,IAAIC,GAAY,IACzD,CAGA1O,eAAesL,EAAMpB,EAAO,CAAC,GACzB,MAAM6C,EAAM/U,KAAK,GAAGsT,YAEpB,OAAIyB,EACO/U,KAAKgV,WAAWD,EAAK7C,GAGrBlS,KAAKqW,OAAOrO,eAAesL,EAAMpB,EAEhD,CAEA8C,WAAWD,EAAK7C,GACZ,GAAmB,mBAAR6C,EACP,OAGJ,MAAM6B,EAAYC,KAAKC,MAEjB3M,EAAU4K,EAAIgC,KAAK/W,KAAMkS,GAEzB8E,EAAOH,KAAKC,MAAQF,EAM1B,OAJIhS,KAAKqS,OAASD,EAAO,IACrB/B,QAAQY,IAAI,WAAWd,EAAIzB,WAAWtT,KAAK8V,oBAAoBkB,OAG/DpS,KAAKqS,OAAS9M,EACP,oBAAgBA,EAAS,IAAO,wBAAwBnK,KAAK2C,YAAY2Q,aAAayB,EAAIzB,QAG9FnJ,CACX,mFC7GJ,MAAM+M,UAAsB,IACxBvU,cACIC,QAEI,yBACA,6BAAgC,KAC5B5C,KAAKmX,cAAc,aAAiB,cAAc,IAGtD1V,OAAO2V,iBAAiB,SAASC,IACzBA,EAAMC,SACNtX,KAAKuX,qBAAqBvX,KAAKwX,iBAAkC,KAAfH,EAAMI,OAC5D,IAGZ,CAEAN,cAAcO,GACVA,EAAaC,WAAWD,GAEP,yBAAqB,YAAYE,SACzCT,cAAcO,EAC3B,CAEArY,2BAA2BqY,GACnBA,GA5BK,IA4BqBA,GA3BrB,GA4BLA,EAAaG,KAAKC,MAAmB,GAAbJ,GAAmB,GAE3C1X,KAAKmX,cAAcO,SAEb,SAAa,aAAcA,IAGjCzC,QAAQY,IAAI,eAAe6B,mCAEnC,CAEAF,iBACI,OAAO,yBAAqB,YAAYI,SAASG,eACrD,CAEAC,eACIhY,KAAKuX,qBAAqBvX,KAAKwX,iBAAmB,GACtD,CAEAS,cACIjY,KAAKuX,qBAAqBvX,KAAKwX,iBAAmB,GACtD,CACAU,iBACIlY,KAAKuX,qBAAqB,EAC9B,CAEAY,2BAA0B,WAACT,IACvB1X,KAAKuX,qBAAqBG,EAC9B,EAGJ,MAEA,EAFoB,IAAIR,gDCdxB,QA9CA,MACIvU,YAAY9C,EAAOuY,GAEfpY,KAAKH,MAAQA,EAEbG,KAAKqY,OAAOD,EAChB,CAEAC,OAAOD,GAEHpY,KAAKuK,aAAe6N,EAAI7N,aAExBvK,KAAKsY,QAAUF,EAAIE,QAEnBtY,KAAKuY,KAAOH,EAAIG,KAEhBvY,KAAKG,KAAOiY,EAAIjY,KAEhBH,KAAKsK,MAAQ8N,EAAI9N,MAEjBtK,KAAKwY,aAAeJ,EAAII,aAExBxY,KAAKyY,gBAAkBL,EAAIK,gBAE3BzY,KAAK0Y,gCAAkCN,EAAIM,gCAM3C1Y,KAAKwJ,cAAgB4O,EAAI5O,cAEzBxJ,KAAKH,MAAM8Y,YAAY3Y,KAAKuK,cAAgBvK,IAChD,CAGA4Y,UACI,OAAO5Y,KAAKH,MAAMgZ,MAAM7Y,KAAKsY,QACjC,CAGAjZ,gBACI,aAAaW,KAAKH,MAAMyJ,QAAQ,cAAetJ,KAAKuK,aACxD,+DCqCJ,QAzEA,MACI5H,YAAY9C,EAAOuY,GAEfpY,KAAKH,MAAQA,EAEbG,KAAKqY,OAAOD,EAChB,CAEAC,OAAOD,GAEHpY,KAAKmT,YAAciF,EAAIjF,YAEvBnT,KAAKT,OAAS6Y,EAAI7Y,OAElBS,KAAKyD,KAAO2U,EAAI3U,KAEhBzD,KAAKsT,KAAO8E,EAAI9E,KAEhBtT,KAAKoT,MAAQgF,EAAIhF,MAEjBpT,KAAKkP,SAAWkJ,EAAIlJ,SAEpBlP,KAAK8Y,gBAAkBV,EAAIU,aAC/B,CAGAF,UACI,OAAO5Y,KAAKH,MAAMgZ,MAAM7Y,KAAKT,OACjC,CAGAF,sBACI,MAAM+O,EAAepO,KAAKoO,aAE1B,aAAapO,KAAKH,MAAM+Y,QAAQxK,GAAc,EAClD,CAEIA,mBACA,GAAkB,aAAdpO,KAAKyD,KACL,MAAM,IAAI+J,MAAM,aAAaxN,KAAKmT,iCAGtC,OAAOnT,KAAKoT,KAChB,CAEI2F,iBACA,MAAqB,aAAd/Y,KAAKyD,MAAuB,CAAC,eAAgB,YAAa,kBAAmB,mBAAmB0F,SAASnJ,KAAKsT,KACzH,CAEI0F,eACA,MAAO,0BAA0BhZ,KAAKmT,qBAAqBnT,KAAKyD,cAAczD,KAAKsT,eAAetT,KAAKoT,QAC3G,CAEA6F,eACI,MAAqB,UAAdjZ,KAAKyD,OAAqBzD,KAAKsT,KAAKpL,WAAW,WAAalI,KAAKsT,KAAKpL,WAAW,aAC5F,CAEAgR,gBACI,OAAO,UAAwClZ,KAAKoT,MACxD,CAEA+F,gBAAgBpG,GACZ,MAAqB,UAAd/S,KAAKyD,MAAoBzD,KAAKsT,OAAS,GAAGP,EAAKtP,QAAQsP,EAAKO,MACvE,CAEI8F,UACA,MAAMA,EAAMrJ,OAAOsJ,OAAO,CAAC,EAAGrZ,MAG9B,cAFOoZ,EAAIvZ,MAEJuZ,CACX,iDClBJ,QA3DA,MACIzW,YAAY9C,EAAOuY,GAEfpY,KAAKH,MAAQA,EAEbG,KAAKqY,OAAOD,EAChB,CAEAC,OAAOD,GAKHpY,KAAKqS,SAAW+F,EAAI/F,SAEpBrS,KAAKT,OAAS6Y,EAAI7Y,OAElBS,KAAKqH,aAAe+Q,EAAI/Q,aAExBrH,KAAKsZ,aAAelB,EAAIkB,aAExBtZ,KAAKuZ,OAASnB,EAAImB,OAElBvZ,KAAKwZ,aAAepB,EAAIoB,WAExBxZ,KAAKyZ,iBAAmBrB,EAAIqB,cAChC,CAGApa,gBACI,OAAOW,KAAKH,MAAM+Y,QAAQ5Y,KAAKT,OACnC,CAGAma,mBACI,OAAO1Z,KAAKH,MAAM6Z,iBAAiB1Z,KAAKT,OAC5C,CAGAF,sBACI,OAAOW,KAAKH,MAAM+Y,QAAQ5Y,KAAKqH,aACnC,CAGAsS,aACI,MAA6B,SAAtB3Z,KAAKqH,YAChB,CAEI2R,eACA,MAAO,oBAAoBhZ,KAAKqS,WACpC,CAEIuH,WACA,MAAMA,EAAO,IAAI5Z,MAEjB,cADO4Z,EAAK/Z,MACL+Z,CACX,uGC5DJ,MAAMC,EAAoB,IAAIC,IAyB9B,EAvBA,SAA6BC,GACzB,IAAKA,GAAOC,OACR,MAAO,GAGX,MAAMC,EAAsBF,EAAM5D,QAAQ,cAAe,IAEzD,IAAK8D,EAAoBD,OACrB,MAAO,GAGX,MAAME,EAAY,SAASD,IAS3B,OAPKJ,EAAkBM,IAAID,KAEvBxV,EAAE,QAAQC,OAAO,WAAWuV,4BAAoCA,cAAsBH,2BAEtFF,EAAkBO,IAAIF,IAGnBA,CACX,EChBMG,EAAQ,QACRC,EAAW,WAEXC,EAAkB,CACpB,KAAQ,aACR,MAAS,cACT,KAAQ,aACR,OAAU,kBACV,OAAU,kBACV,YAAe,gBACf,KAAQ,aACR,QAAW,gBACX,QAAW,kBACX,OAAU,YACV,QAAW,kBACX,SAAY,aACZ,IAAO,kBACP,cAAiB,iBA29BrB,EAr8BA,MAKI5X,YAAY9C,EAAOuY,GAEfpY,KAAKH,MAAQA,EAGbG,KAAKwa,WAAa,GAGlBxa,KAAKya,gBAAkB,GAGvBza,KAAK0a,QAAU,GAEf1a,KAAKoL,SAAW,GAGhBpL,KAAK2a,eAAiB,CAAC,EAGvB3a,KAAK4a,cAAgB,CAAC,EAGtB5a,KAAK2Y,YAAc,KAEnB3Y,KAAKqY,OAAOD,EAChB,CAEAC,OAAOD,GAEHpY,KAAKT,OAAS6Y,EAAI7Y,OAElBS,KAAKsK,MAAQ8N,EAAI9N,MAEjBtK,KAAK0D,cAAgB0U,EAAI1U,YAKzB1D,KAAKyD,KAAO2U,EAAI3U,KAKhBzD,KAAKG,KAAOiY,EAAIjY,KAGhBH,KAAK6a,OAASzC,EAAIyC,MACtB,CAEAC,UAAUzT,EAAcgL,EAAU5C,GAAO,GAChB,SAAjBpI,IAICrH,KAAK0a,QAAQvR,SAAS9B,IACvBrH,KAAK0a,QAAQpO,KAAKjF,GAGtBrH,KAAK2a,eAAetT,GAAgBgL,EAEhC5C,GACAzP,KAAK+a,cAEb,CAEAC,SAASC,EAAa5I,EAAU5C,GAAO,GAC7BwL,KAAejb,KAAK4a,eACtB5a,KAAKoL,SAASkB,KAAK2O,GAGvBjb,KAAK4a,cAAcK,GAAe5I,EAE9B5C,GACAzP,KAAKkb,cAEb,CAEAA,eACI,MAAMC,EAAc,CAAC,EAErB,IAAK,MAAM9I,KAAYtC,OAAOqL,OAAOpb,KAAK4a,eACtCO,EAAY9I,GAAYrS,KAAKH,MAAMwb,UAAUhJ,GAAUiH,aAG3DtZ,KAAKoL,SAASqE,MAAK,CAACC,EAAGC,IAAMwL,EAAYnb,KAAK4a,cAAclL,IAAMyL,EAAYnb,KAAK4a,cAAcjL,KACrG,CAGA2L,SACI,MAAqB,qBAAdtb,KAAKG,IAChB,CAEAd,mBACI,MAAMgK,QAAarJ,KAAKsJ,UAExB,OAAOD,GAAM7F,OACjB,CAEAnE,uBACI,MAAMmE,QAAgBxD,KAAKub,aAE3B,IACI,OAAOzP,KAAK0P,MAAMhY,EACtB,CACA,MAAOkF,GAGH,OAFAuM,QAAQY,IAAI,iCAAiC7V,KAAKT,YAAamJ,EAAEgE,SAE1D,IACX,CACJ,CAKA+O,qBACI,OAAO1L,OAAOqL,OAAOpb,KAAK2a,eAC9B,CAMAe,eACI,OAAO1b,KAAKyb,oBAChB,CAKAE,oBACI,MAAMrJ,EAAYvC,OAAOqL,OAAOpb,KAAK2a,gBAErC,OAAO3a,KAAKH,MAAM+b,YAAYtJ,EAClC,CAMAsJ,cACI,OAAO5b,KAAK2b,mBAChB,CAGA7R,cACI,OAAO9J,KAAKoL,SAAS3I,OAAS,CAClC,CAGAoZ,mBAEI,MAAMvJ,EAAYtS,KAAKoL,SAASO,KAAIsP,GAAejb,KAAK4a,cAAcK,KAEtE,OAAOjb,KAAKH,MAAM+b,YAAYtJ,EAClC,CAGAwJ,mBACI,OAAO9b,KAAK0a,OAChB,CAGAqB,iBACI,OAAO/b,KAAKH,MAAMmc,kBAAkBhc,KAAK0a,QAC7C,CAIAK,cACI/a,KAAK0a,QAAQjL,MAAK,CAACwM,EAASC,KACxB,MAAMC,EAAYnc,KAAK2a,eAAesB,GAEtC,GAAIE,GAAaA,EAAUjU,WAAW,SAClC,OAAO,EAGX,MAAMkU,EAAQpc,KAAKH,MAAM6Z,iBAAiBuC,GAE1C,OAAIG,EAAMC,YAAcD,EAAME,qBACnB,EAGJL,EAAUC,GAAW,EAAI,CAAC,GAEzC,CAEIG,iBACA,OAAOrc,KAAKuc,aAAa,QAAS,WACtC,CAGAC,kBACI,OAAOxc,KAAKoL,QAChB,CAGA/L,sBACI,aAAaW,KAAKH,MAAM4c,SAASzc,KAAKoL,SAC1C,CAGA/L,uBAKI,OAJKW,KAAK2Y,cACN3Y,KAAK2Y,kBAAoB3Y,KAAKH,MAAM6c,sBAAsB1c,KAAKT,SAG5DS,KAAK2Y,WAChB,CAGAtZ,2BAA2BkZ,GACvB,aAAcvY,KAAK2c,kBACd/Q,QAAOpB,GAAcA,EAAW+N,OAASA,GAClD,CAGAlZ,wBAAwBkL,GAGpB,aAF0BvK,KAAK2c,kBAEZpQ,MAAKqQ,GAAOA,EAAIrS,eAAiBA,GACxD,CAEAsS,sCACI,GAAkB,UAAd7c,KAAKyD,OAAqBzD,KAAK8c,sBAAwB9c,KAAK8J,eAAqD,IAApC9J,KAAK2b,oBAAoBlZ,OACtG,OAAO,EAGX,MAAMgY,EAAkBza,KAAK+c,qBAAqBnR,QAAOoR,GAA8B,cAAlBA,EAAS1J,OAE9E,GAAImH,EAAgBhY,OAAS,EACzB,OAAO,EAGX,MAAMwa,EAAajd,KAAK+b,iBAAiB,GACnCmB,EAAkBzC,EAAgB,IAAI7B,UAE5C,QAAIsE,GAAmBA,IAAoBD,GAEZ,SAApBA,EAAWxZ,OAAoBwZ,EAAWH,qBAKzD,CAOAK,mBAAmB1Z,EAAM6P,GACrB,MAAM8J,EAAQpd,KAAKwa,WACd7O,KAAIwH,GAAenT,KAAKH,MAAM2a,WAAWrH,KACzCvH,OAAO4F,SAEZ,OAAOxR,KAAKqd,cAAcD,EAAO3Z,EAAM6P,EAC3C,CAOAgK,cAAc7Z,EAAM6P,GAChB,OAAOtT,KAAKqd,cAAcrd,KAAKud,sBAAsB,IAAK9Z,EAAM6P,EACpE,CAOAiK,sBAAsBC,GAGlB,GAAIA,EAAKrU,SAASnJ,KAAKT,QACnB,MAAO,GAGX,KAAMS,KAAKT,UAAU,gBAAgC,CACjD,MAAMke,EAAU,IAAID,EAAMxd,KAAKT,QACzBme,EAAW,CAAE1d,KAAKmd,sBAGxB,GAAoB,SAAhBnd,KAAKT,QAAqC,YAAhBS,KAAKT,OAC/B,IAAK,MAAM0d,KAAcjd,KAAK+b,iBAEF,WAApBkB,EAAWxZ,MACXia,EAASpR,KAAK2Q,EAAWU,2BAA2BF,IAKhE,IAAK,MAAMG,KAAgBF,EAASG,OAAOjS,QAAOmH,GAAsB,aAAdA,EAAKtP,MAAuB,CAAC,WAAY,WAAW0F,SAAS4J,EAAKO,QAAQ,CAChI,MAAMwK,EAAe9d,KAAKH,MAAMgZ,MAAM+E,EAAaxK,OAE/C0K,GAAgBA,EAAave,SAAWS,KAAKT,QAC7Cme,EAASpR,KACLwR,EAAaP,sBAAsBE,GAE9B7R,QAAOmH,KAAwB,UAAdA,EAAKtP,OAAmC,aAAdsP,EAAKO,MAAqC,sBAAdP,EAAKO,SAG7F,CAEA,eAA8BtT,KAAKT,QAAU,GAC7C,MAAMwe,EAAoB,IAAIjE,IAE9B,IAAK,MAAM/G,KAAQ2K,EAASG,OACnBE,EAAkB5D,IAAIpH,EAAKI,eAC5B4K,EAAkB3D,IAAIrH,EAAKI,aAE3B,eAA8BnT,KAAKT,QAAQ+M,KAAKyG,GAG5D,CAEA,OAAO,eAA8B/S,KAAKT,OAC9C,CAEAye,SACI,MAAuB,SAAhBhe,KAAKT,MAChB,CAOA0e,kBACI,GAAoB,SAAhBje,KAAKT,OACL,MAAO,CAAC,CAAC,SAGb,MAAM2e,EAAcle,KAAK+b,iBAAiBnQ,QAAOtI,GAAsB,WAAdA,EAAKG,OAExD0a,EAAmC,IAAvBD,EAAYzb,OACxByb,EAAY,GAAGD,kBACfC,EAAYjS,SAAQgR,GAAcA,EAAWgB,oBAEnD,IAAK,MAAMne,KAAYqe,EACnBre,EAASwM,KAAKtM,KAAKT,QAGvB,OAAO4e,CACX,CAMAC,yBAAyBvd,EAAgB,QACrC,MAAMwd,EAAkC,SAAlBxd,EAEhBsd,EAAYne,KAAKie,kBAAkBtS,KAAI6R,IAAQ,CACjD1d,SAAU0d,EACVc,mBAAoBD,GAAiBb,EAAKrU,SAAStI,GACnDwb,WAAYmB,EAAKe,MAAKhf,GAAUM,EAAA,cAAYN,GAAQ8c,aACpDmC,SAAUhB,EAAKjR,MAAKhN,GAAuC,WAA7BM,EAAA,cAAYN,GAAQkE,OAClDgb,SAAUjB,EAAKrU,SAAS,eAiB5B,OAdAgV,EAAU1O,MAAK,CAACC,EAAGC,IACXD,EAAE4O,qBAAuB3O,EAAE2O,mBACpB5O,EAAE4O,oBAAsB,EAAI,EAC5B5O,EAAE2M,aAAe1M,EAAE0M,WACnB3M,EAAE2M,WAAa,GAAK,EACpB3M,EAAE+O,WAAa9O,EAAE8O,SACjB/O,EAAE+O,SAAW,GAAK,EAClB/O,EAAE8O,WAAa7O,EAAE6O,SACjB9O,EAAE8O,SAAW,GAAK,EAElB9O,EAAE5P,SAAS2C,OAASkN,EAAE7P,SAAS2C,SAIvC0b,CACX,CAQAO,gBAAgB7d,EAAgB,QAC5B,OAAOb,KAAKoe,yBAAyBvd,GAAe,IAAIf,QAC5D,CAQA6e,sBAAsB9d,EAAgB,QAClC,MAAMf,EAAWE,KAAK0e,gBAAgB7d,GAEtC,OAAOf,GAAU4R,KAAK,IAC1B,CAKA4K,qBACI,GAAoB,YAAhBtc,KAAKT,OACL,OAAO,EACJ,GAAoB,SAAhBS,KAAKT,OACZ,OAAO,EAGX,IAAK,MAAM0d,KAAcjd,KAAK+b,iBAAkB,CAC5C,GAA0B,SAAtBkB,EAAW1d,OACX,OAAO,EACJ,GAA0B,YAAtB0d,EAAW1d,QAA4C,WAApB0d,EAAWxZ,OAIpDwZ,EAAWX,qBACZ,OAAO,CAEf,CAEA,OAAO,CACX,CASAe,cAAc7C,EAAY/W,EAAM6P,GAG5B,OAFAtT,KAAK4e,mBAAmBnb,EAAM6P,GAEzB7P,GAAS6P,EAEH7P,GAAQ6P,EACRkH,EAAW5O,QAAOmH,GAAQA,EAAKO,OAASA,GAAQP,EAAKtP,OAASA,IAC9DA,EACA+W,EAAW5O,QAAOmH,GAAQA,EAAKtP,OAASA,IACxC6P,EACAkH,EAAW5O,QAAOmH,GAAQA,EAAKO,OAASA,SAD5C,EALIkH,CAQf,CAEAmD,2BAA2BH,GAGvB,OAFcxd,KAAKud,sBAAsBC,GAE5B5R,QAAOmH,GAAQA,EAAK+F,eACrC,CAEA8F,mBAAmBnb,EAAM6P,GACrB,GAAI7P,GAAiB,UAATA,GAA6B,aAATA,EAC5B,MAAM,IAAI+J,MAAM,gCAAgC/J,wDAGpD,GAAI6P,EAAM,CACN,MAAMuL,EAAcvL,EAAKwL,OAAO,GAChC,GAAoB,MAAhBD,GAAuC,MAAhBA,EACvB,MAAM,IAAIrR,MAAM,iHAExB,CACJ,CAMAuR,eAAezL,GACX,OAAOtT,KAAKmd,mBAAmB9C,EAAO/G,EAC1C,CAMA0L,UAAU1L,GACN,OAAOtT,KAAKsd,cAAcjD,EAAO/G,EACrC,CAEA2L,UACI,MAAMC,EAAkBlf,KAAKgf,UAAU,aACjCG,EAAqBnf,KAAKof,wBAEhC,OAAIF,EAAgBzc,OAAS,EAClByc,EAAgB,GAAG9L,MAErB+L,IAGgB,SAAhBnf,KAAKT,OACH,uBAES,WAAhBS,KAAKT,OACE,kBAEY,SAAdS,KAAKyD,KACNzD,KAAKqf,WACE,eAGA,aAGQ,SAAdrf,KAAKyD,MAAmBzD,KAAKG,KAAK+H,WAAW,cAC3C,aAGAqS,EAAgBva,KAAKyD,MAEpC,CAEA6b,gBACI,MAAMvF,EAAQ/Z,KAAKuf,cAAc,SACjC,OAAO,EAAoCxF,EAC/C,CAEAsF,WACI,MAAqB,WAAdrf,KAAKyD,MACLzD,KAAKwf,2BAA2B/c,OAAS,CACpD,CAEA+c,2BACI,IAAIC,EAAgBzf,KAAK6b,mBAEzB,GAAK4D,EAUL,OAAOA,EATH9b,EAAA,WAAY,oBAAoB3D,KAAKT,kCAU7C,CAMAmgB,kBAAkBpM,GACd,OAAOtT,KAAKmd,mBAAmB7C,EAAUhH,EAC7C,CAMAqM,aAAarM,GACT,OAAOtT,KAAKsd,cAAchD,EAAUhH,EACxC,CAOAiJ,aAAa9Y,EAAM6P,GAGf,OAFmBtT,KAAKsd,gBAENiB,MAAKxL,GAAQA,EAAKO,OAASA,GAAQP,EAAKtP,OAASA,GACvE,CAOAmc,kBAAkBnc,EAAM6P,GACpB,QAAStT,KAAK6f,kBAAkBpc,EAAM6P,EAC1C,CAOAuM,kBAAkBpc,EAAM6P,GAGpB,OAFmBtT,KAAKmd,qBAEN5Q,MAAKwG,GAAQA,EAAKO,OAASA,GAAQP,EAAKtP,OAASA,GACvE,CAOAqc,aAAarc,EAAM6P,GAGf,OAFmBtT,KAAKsd,gBAEN/Q,MAAKwG,GAAQA,EAAKO,OAASA,GAAQP,EAAKtP,OAASA,GACvE,CAOAsc,uBAAuBtc,EAAM6P,GACzB,MAAMP,EAAO/S,KAAK6f,kBAAkBpc,EAAM6P,GAE1C,OAAOP,EAAOA,EAAKK,MAAQ,IAC/B,CAOA4M,kBAAkBvc,EAAM6P,GACpB,MAAMP,EAAO/S,KAAK8f,aAAarc,EAAM6P,GAErC,OAAOP,EAAOA,EAAKK,MAAQ,IAC/B,CAMA6M,cAAc3M,GAAQ,OAAOtT,KAAK4f,kBAAkBvF,EAAO/G,EAAO,CAMlE4M,SAAS5M,GAAQ,OAAOtT,KAAKuc,aAAalC,EAAO/G,EAAO,CAMxDnL,cAAcmL,GACV,MAAM6M,EAAQngB,KAAKogB,SAAS9M,GAE5B,QAAK6M,GAIEA,GAAyB,UAAhBA,EAAM/M,KAC1B,CAMAiN,iBAAiB/M,GAAQ,OAAOtT,KAAK4f,kBAAkBtF,EAAUhH,EAAO,CAMxEgN,YAAYhN,GAAQ,OAAOtT,KAAKuc,aAAajC,EAAUhH,EAAO,CAM9DiN,cAAcjN,GAAQ,OAAOtT,KAAK6f,kBAAkBxF,EAAO/G,EAAO,CAMlE8M,SAAS9M,GAAQ,OAAOtT,KAAK8f,aAAazF,EAAO/G,EAAO,CAMxDkN,iBAAiBlN,GAAQ,OAAOtT,KAAK6f,kBAAkBvF,EAAUhH,EAAO,CAMxEmN,YAAYnN,GAAQ,OAAOtT,KAAK8f,aAAaxF,EAAUhH,EAAO,CAM9DoN,mBAAmBpN,GAAQ,OAAOtT,KAAK+f,uBAAuB1F,EAAO/G,EAAO,CAM5EiM,cAAcjM,GAAQ,OAAOtT,KAAKggB,kBAAkB3F,EAAO/G,EAAO,CAMlEqN,sBAAsBrN,GAAQ,OAAOtT,KAAK+f,uBAAuBzF,EAAUhH,EAAO,CAMlFsN,iBAAiBtN,GAAQ,OAAOtT,KAAKggB,kBAAkB1F,EAAUhH,EAAO,CAMxEjU,wBAAwBiU,GACpB,MAAMuN,QAAgB7gB,KAAK8gB,mBAAmBxN,GAE9C,OAAOuN,EAAQpe,OAAS,EAAIoe,EAAQ,GAAK,IAC7C,CAMAxhB,yBAAyBiU,GACrB,MAAMyN,EAAY/gB,KAAK2f,aAAarM,GAC9BuN,EAAU,GAEhB,IAAK,MAAM7D,KAAY+D,EACnBF,EAAQvU,WAAWtM,KAAKH,MAAM+Y,QAAQoE,EAAS5J,QAGnD,OAAOyN,CACX,CAKAG,kCAMI,MALkB,IACXhhB,KAAK2f,aAAa,eAClB3f,KAAK2f,aAAa,YAGRhU,KAAIsV,GAAOjhB,KAAKH,MAAMgZ,MAAMoI,EAAI7N,QACrD,CAEA8N,kCACI,GAAIlhB,KAAKmI,cAAc,0BACnB,MAAO,GAGX,MAAMgZ,EAAgBnhB,KAAKsd,gBACtB1R,QAAOmH,GAAQA,EAAKkG,iBACpBrN,QAAOmH,IACJ,MAAMqO,EAAMrO,EAAKmG,gBAEjB,OAAOkI,GAAOA,EAAIC,UAAU,IAapC,OATAF,EAAc1R,MAAK,CAACC,EAAGC,IACfD,EAAEnQ,SAAWoQ,EAAEpQ,OACRmQ,EAAER,SAAWS,EAAET,UAAY,EAAI,EAG/BQ,EAAEnQ,OAASoQ,EAAEpQ,QAAU,EAAI,IAInC4hB,CACX,CAEAG,YAAY3hB,EAAgB4hB,GAAkB,EAAOC,EAAiB,MAClE,GAAIxhB,KAAKT,SAAWI,EAChB,OAAO,EAGX,GAAK6hB,GAEE,GAAIA,EAAerH,IAAIna,KAAKT,QAE/B,OAAO,OAHPiiB,EAAiB,IAAI1H,IAQzB,GAFA0H,EAAepH,IAAIpa,KAAKT,QAEpBgiB,EACA,IAAK,MAAMzD,KAAgB9d,KAAKghB,kCAC5B,GAAIlD,EAAawD,YAAY3hB,EAAgB4hB,EAAiBC,GAC1D,OAAO,EAKnB,IAAK,MAAMvE,KAAcjd,KAAK+b,iBAC1B,GAAIkB,EAAWqE,YAAY3hB,EAAgB4hB,EAAiBC,GACxD,OAAO,EAIf,OAAO,CACX,CAEAC,oBACI,MAAuB,YAAhBzhB,KAAKT,QAAwBS,KAAKshB,YAAY,UACzD,CAKAI,2BAA4B,CAO5B3E,qBACI,OAAO/c,KAAKya,gBACP9O,KAAIwH,GAAenT,KAAKH,MAAM2a,WAAWrH,IAClD,CAOA9T,qCACI,MAAMob,EAAkBza,KAAK+c,qBAE7B,aAAa/c,KAAKH,MAAM4c,SAAShC,EAAgB9O,KAAIgW,GAAMA,EAAGpiB,SAClE,CAMAF,0BACI,OAAOW,KAAKsJ,SAChB,CAGAjK,gBACI,aAAaW,KAAKH,MAAMyJ,QAAQ,QAAStJ,KAAKT,OAClD,CAEAyZ,WACI,MAAO,eAAehZ,KAAKT,iBAAiBS,KAAKsK,QACrD,CAEI8O,UACA,MAAMA,EAAMrJ,OAAOsJ,OAAO,CAAC,EAAGrZ,MAG9B,cAFOoZ,EAAIvZ,MAEJuZ,CACX,CAEAwI,cAEI,OADe5hB,KAAKgf,UAAU,YAChBrT,KAAIkW,GAAKA,EAAEzO,QAAO1B,KAAK,IACzC,CAEA0N,wBACI,MAAM0C,EAAS9hB,KAAKgf,UAAU,sBAC9B,OAAO8C,EAAOrf,OAAS,EAAIqf,EAAO,GAAG1O,MAAQ,EACjD,CAEA2O,iCACI,MAAMD,EAAS9hB,KAAKgf,UAAU,+BAC9B,OAAO8C,EAAOrf,OAAS,EAAIqf,EAAO,GAAG1O,MAAQ,EACjD,CAGA4O,eACI,OAAsB,SAAdhiB,KAAKyD,MAAiC,SAAdzD,KAAKyD,MAAiC,aAAdzD,KAAKyD,QACrDzD,KAAKG,KAAK+H,WAAW,2BACJ,6BAAdlI,KAAKG,MACS,oBAAdH,KAAKG,KACpB,CAGA8hB,SACI,OAAsB,SAAdjiB,KAAKyD,MAAiC,SAAdzD,KAAKyD,MAAiC,WAAdzD,KAAKyD,OAAoC,cAAdzD,KAAKG,IAC5F,CAGA+hB,eACI,OAAIliB,KAAKiiB,UAAajiB,KAAKgiB,gBAAkBhiB,KAAKG,KAAKiG,SAAS,iBAI9C,WAAdpG,KAAKyD,KAHE,WAOPzD,KAAKgiB,gBAAkBhiB,KAAKG,KAAKiG,SAAS,eACnC,UAGJ,IACX,CAEA/G,sBACI,IAAKW,KAAKgiB,eACN,MAAM,IAAIxU,MAAM,QAAQxN,KAAKT,qBAAqBS,KAAKyD,iBAAiBzD,KAAKG,oCAGjF,MAAMgiB,EAAMniB,KAAKkiB,eAEjB,GAAY,aAARC,EAAoB,CACpB,MAAMC,SAAuB,uCAAiCC,QAC9D,aAAaD,EAAcE,oBAAoBtiB,KAAKT,OACxD,CACK,GAAY,YAAR4iB,EAIL,MAAM,IAAI3U,MAAM,yBAAyB2U,cAAgBniB,KAAKT,gBAH3CgE,EAAA,OAAY,cAAcvD,KAAKT,SAK1D,CAEAgjB,WACI,IAAK,MAAMlb,KAAgBrH,KAAK0a,QAAS,CACrC,GAAqB,SAAjBrT,GAA4C,SAAjBA,EAC3B,SAGJ,MAAM4V,EAAapd,EAAA,cAAYwH,GAE/B,GAAK4V,GAAkC,WAApBA,EAAWxZ,OAIJ,WAAtBwZ,EAAW1d,QAAuB0d,EAAWsF,YAC7C,OAAO,CAEf,CAEA,OAAO,CACX,CAEAzF,qBACI,OAAQ9c,KAAK0D,aAAe,iCAChC,CAEA0E,oBACI,MAAqB,aAAdpI,KAAKyD,MAAuB,CAAC,UAAW,wBAAyB,uBAAuB0F,SAASnJ,KAAKT,OACjH,CAEA8I,YACI,OAAOrI,KAAKT,OAAO2I,WAAW,WAClC,CAOA7I,oBACI,aAAakE,EAAA,MAAW,SAASvD,KAAKT,kBAC1C,+DCp1BJ,MAEA,EAFoB,IA1JpB,MACIoD,cACI3C,KAAKwiB,QAAU9d,EAAE,2BACjB1E,KAAKyiB,wBAA0B,EAE/B/d,EAAE+M,UAAU8C,GAAG,SAAS,IAAMvU,KAAK0iB,QACvC,CAEArjB,WAAWmB,GACPR,KAAKQ,QAAUA,EAEfR,KAAKwiB,QAAQG,QAEb3iB,KAAK4iB,SAAS5iB,KAAKwiB,QAAShiB,EAAQqiB,OAEpC,mCAA+C7iB,KAAKwiB,SAEpDxiB,KAAK8iB,eAEL9iB,KAAKyiB,wBAA0B5L,KAAKC,KACxC,CAEAgM,eAII,MAGMC,EAAetR,SAASuR,gBAAgBD,aACxCE,EAAcxR,SAASuR,gBAAgBC,YACvCC,EAAoBljB,KAAKwiB,QAAQW,cACjCC,EAAmBpjB,KAAKwiB,QAAQa,aACtC,IAAIC,EAAKC,EAILD,EAFAtjB,KAAKQ,QAAQgjB,EAAIN,EARO,EAQmCH,EATlC,EAWnBA,EAAeG,EAXI,EAYlBljB,KAAKQ,QAAQgjB,EAXI,EADC,IAgBnBxjB,KAAKQ,QAAQgjB,EAfK,EAqBpBD,EAHyB,SAA7BvjB,KAAKQ,QAAQijB,YACTzjB,KAAKQ,QAAQkjB,EAnBO,EAmBmBT,EApBlB,EAsBdA,EAAcG,EArBD,EAsBbpjB,KAAKQ,QAAQkjB,EAAIN,EAtBJ,EADC,IA2BdpjB,KAAKQ,QAAQkjB,EAAIN,EA1BJ,EA6BpBpjB,KAAKQ,QAAQkjB,EAAIN,EA7BG,EA6BsCH,EA9BrC,EAgCdA,EAAcG,EAhCA,EAiCdpjB,KAAKQ,QAAQkjB,EAhCA,EADC,IAqCd1jB,KAAKQ,QAAQkjB,EApCA,EAwC5B1jB,KAAKwiB,QAAQmB,IAAI,CACbC,QAAS,QACTN,IAAKA,EACLC,KAAMA,IACPM,SAAS,OAChB,CAEAjB,SAASkB,EAASjB,GACd,IAAK,MAAMkB,KAAQlB,EACf,GAAKkB,EAIL,GAAmB,SAAfA,EAAKzZ,MACLwZ,EAAQnf,OAAOD,EAAE,SAASmf,SAAS,yBAChC,CACH,MAAMG,EAAQtf,EAAE,UAEZqf,EAAKE,OACLD,EAAMH,SAASE,EAAKE,QAEpBD,EAAMrf,OAAO,UAGjB,MAAMuf,EAAQxf,EAAE,UACXC,OAAOqf,GACPrf,OAAO,YACPA,OAAOof,EAAKzZ,OAEX6Z,EAAQzf,EAAE,QACXmf,SAAS,iBACTlf,OAAOuf,GACP3P,GAAG,eAAe7L,IAAK,IAGvB6L,GAAG,aAAa7L,IACbA,EAAE0b,kBAEc,IAAZ1b,EAAE2b,QAINrkB,KAAK0iB,OAEDqB,EAAKO,SACLP,EAAKO,QAAQP,EAAMrb,GAGvB1I,KAAKQ,QAAQ+jB,sBAAsBR,EAAMrb,KAT9B,KAoBnB,QAJqBf,IAAjBoc,EAAKS,SAA0BT,EAAKS,SACpCL,EAAMN,SAAS,YAGfE,EAAKlB,MAAO,CACZsB,EAAMN,SAAS,oBACfK,EAAML,SAAS,mBAEf,MAAMY,EAAW/f,EAAE,QAAQmf,SAAS,iBAEpC7jB,KAAK4iB,SAAS6B,EAAUV,EAAKlB,OAE7BsB,EAAMxf,OAAO8f,EACjB,CAEAX,EAAQnf,OAAOwf,EACnB,CAER,CAEAzB,OAIQ7L,KAAKC,MAAQ9W,KAAKyiB,wBAA0B,KAG5C9Z,YAAW,IAAM3I,KAAKwiB,QAAQE,QAAQ,IAE9C,wECxHJ,SACIgC,gBA/BJ,SAAyB5kB,EAAU4I,EAAGvJ,EAAY,CAAC,EAAG0B,EAAgB,MAClE,SAAiB,CACb6iB,EAAGhb,EAAEic,MACLnB,EAAG9a,EAAEkc,MACL/B,MAAO,CACH,CAACvY,MAAO,aAAcua,QAAS,mBAAoBZ,OAAQ,eAC3D,CAAC3Z,MAAO,aAAcua,QAAS,qBAAsBZ,OAAQ,oBAC7D,CAAC3Z,MAAO,YAAaua,QAAS,sBAAuBZ,OAAQ,sBAEjEM,sBAAuB,EAAEM,cAKrB,GAJKhkB,IACDA,EAAgB,wCAAyCA,eAG7C,qBAAZgkB,EACA,yCAA0C/kB,EAAU,CAAEe,gBAAe1B,mBAEpE,GAAgB,uBAAZ0lB,EAAkC,CACvC,MAAMC,EAAc,wCAAyCxc,kBACvD,MAAC7I,GAASqlB,EAAYA,EAAYriB,OAAS,GAEjD,yBAA0B,mBAAoB,CAAChD,QAAOK,WAAUe,gBAAe1B,aACnF,KACqB,wBAAZ0lB,GACL,yBAA0B,eAAgB,CAAC/kB,WAAUe,gBAAe1B,aACxE,GAGZ,yEC5BAE,eAAe0lB,EAAgBC,EAAWC,GACtC,MAAMnM,EAAgBmM,GAAuBD,EAAUlM,cAAgB,SAAW,GAC5EoM,EAAQxgB,EAAE,UAEhB,GAAuB,UAAnBsgB,EAAUvhB,KACVyhB,EAAMvgB,OAAO8M,SAAS0T,eAAe,IAAIH,EAAU1R,OAAOwF,MAEtDkM,EAAU5R,QACV8R,EAAMvgB,OAAO,KACbugB,EAAMvgB,OAAO8M,SAAS0T,gBAmBbC,EAnBwCJ,EAAU5R,MAoB/D,wBAAwBiS,KAAKD,GACtBA,EAEDA,EAAIjc,SAAS,KAGbic,EAAIjc,SAAS,KAGbic,EAAIjc,SAAS,KAIZ,IAAIic,EAAIjP,QAAQ,KAAM,UAHtB,KAAKiP,MAHL,IAAIA,KAHJ,IAAIA,cAtBR,GAAuB,aAAnBJ,EAAUvhB,KAAqB,CACtC,GAAIuhB,EAAUjM,WACV,OAAOmM,EAIPF,EAAU5R,QACV8R,EAAMvgB,OAAO8M,SAAS0T,eAAe,IAAIH,EAAU1R,OAAOwF,OAC1DoM,EAAMvgB,aA2BlBtF,eAA0BE,GACtB,MAAM+D,QAAa,kBAAc/D,GAEjC,GAAK+D,EAIL,OAAOoB,EAAE,MAAO,CACZ2H,KAAM,SAAS9M,IACf+lB,MAAO,mBAENC,KAAKjiB,EAAKgH,MACnB,CAvC+Bkb,CAAWR,EAAU5R,QAEhD,MACI,aAAY,sBAAsB4R,EAAUvhB,QAMpD,IAAqB2hB,EAHjB,OAAOF,CACX,CAkCA7lB,eAAeomB,EAAiBjL,EAAYyK,GACxC,MAAMS,EAAahhB,EAAE,2CAErB,IAAK,IAAI8K,EAAI,EAAGA,EAAIgL,EAAW/X,OAAQ+M,IAAK,CACxC,MAAMwV,EAAYxK,EAAWhL,GAEvB0V,QAAcH,EAAgBC,EAAWC,GAC/CS,EAAW/gB,OAAOugB,EAAMS,QAEpBnW,EAAIgL,EAAW/X,OAAS,GACxBijB,EAAW/gB,OAAO,IAE1B,CAEA,OAAO+gB,CACX,CAEA,MAAME,EAAoB,CACtB,mBACA,WACA,WACA,UACA,WACA,YACA,WACA,YA2BJ,GACIb,kBACAU,mBACAI,uBA3BJxmB,eAAsCiE,GAClC,MAAMwiB,EAA+BxiB,EAAK4d,kCAC1C,IAAI9D,EAAQ9Z,EAAKga,gBAGbF,EADA0I,EAA6BrjB,OAAS,EAC9B2a,EAAMxR,QAAOmH,KAAU+S,EAA6BvZ,MAAKwZ,GAAYA,EAAS5M,gBAAgBpG,OAG9FqK,EAAMxR,QACVmH,IAASA,EAAKkG,iBACLlG,EAAKgG,aACL6M,EAAkBzc,SAAS4J,EAAKO,OACjCP,EAAKxT,SAAW+D,EAAK/D,SAIrC,MAAMymB,QAA4BP,EAAiBrI,GAAO,GAE1D,MAAO,CACH6I,MAAO7I,EAAM3a,OACbujB,sBAER,2HC8CA,SAASE,EAAqB5T,GAC1B,OAAOA,EAAU1G,QAAOyG,IAAaA,EAASnK,WAAW,UAC7D,CAEA,SAASie,EAAe7T,GACpB,MAAMzR,EAAgB,uBAEtB,OAAOyR,EAAU1G,QAAOyG,IACpB,MAAM+T,EAAS,oBAAgB/T,GAE/B,MAAyB,SAAlB+T,EAAO7mB,QACP6mB,EAAO7mB,SAAWsB,CAAa,GAE9C,CAEA,SAASwlB,EAAUC,EAAI5Z,GACnB,MAAO,CACH4Z,GAAIA,EACJhc,MAAO,OACPoC,QAASA,EACT6Z,KAAM,QAEd,CAEA,yBAAuBlnB,UACnB,GAAyB,gBAArBqN,EAAQ8Z,SAIZ,GAAqB,cAAjB9Z,EAAQjJ,KACR,0BAA6BiJ,EAAQ+Z,QACrC,oBAAuB/Z,EAAQA,cAC5B,GAAqB,sBAAjBA,EAAQjJ,KACf,yBAA4B4iB,EAAU3Z,EAAQ+Z,OAAQ,6BAA6B/Z,EAAQga,uBACxF,GAAqB,kBAAjBha,EAAQjJ,KAA0B,CACzC,MAAM+C,EAAQ6f,EAAU3Z,EAAQ+Z,OAAQ,SACxCjgB,EAAMmgB,WAAa,IAEnB,yBAA4BngB,EAChC,KAGJ,yBAAuBnH,UACnB,GAAyB,kBAArBqN,EAAQ8Z,SAIZ,GAAqB,cAAjB9Z,EAAQjJ,KACR,0BAA6BiJ,EAAQ+Z,QACrC,oBAAuB/Z,EAAQA,cAC5B,GAAqB,sBAAjBA,EAAQjJ,KACf,yBAA4B4iB,EAAU3Z,EAAQ+Z,OAAQ,iCAAiC/Z,EAAQga,uBAC5F,GAAqB,kBAAjBha,EAAQjJ,KAA0B,CACzC,MAAM+C,EAAQ6f,EAAU3Z,EAAQ+Z,OAAQ,UACxCjgB,EAAMmgB,WAAa,IAEnB,yBAA4BngB,EAChC,KAgCJ,SACIogB,iBAjPJvnB,eAAgCwnB,EAAiBC,GAE7CD,EAAkBX,EADlBW,EAAkBV,EAAeU,IAGjC,MAAME,EAAe,oBAAgBD,GAErC,GAAI,CAAC,OAAQ,UAAW,wBAAyB,uBAAuB3d,SAAS4d,EAAaxnB,QAC1F,oBAAuB,kBAI3B,IAAK,MAAMynB,KAAkBH,EAAiB,CAC1C,MAAMvgB,QAAa,QAAW,YAAY0gB,iBAA8BF,KAExE,IAAKxgB,EAAKC,QAEN,YADA,oBAAuBD,EAAKoG,QAGpC,CACJ,EA+NIua,gBA7NJ5nB,eAA+BwnB,EAAiBK,GAE5CL,EAAkBX,EADlBW,EAAkBV,EAAeU,IAGjC,MAAMM,EAAY,oBAAgBD,GAAetO,UAUjD,GARyB,CACrB,OACA,uBACA,UACA,wBACA,uBAGiBzP,SAASge,EAAU5nB,QACpC,oBAAuB,iBAD3B,CAKAsnB,EAAgBO,UAEhB,IAAK,MAAMJ,KAAkBH,EAAiB,CAC1C,MAAMvgB,QAAa,QAAW,YAAY0gB,gBAA6BE,KAEvE,IAAK5gB,EAAKC,QAEN,YADA,oBAAuBD,EAAKoG,QAGpC,CAXA,CAYJ,EAiMI2a,iBA/LJhoB,eAAgCwnB,EAAiBS,GAG7C,GAA+B,YAFP,oBAAgBA,GAEpB/nB,OAApB,CAKAsnB,EAAkBV,EAAeU,GAEjC,IAAK,MAAMG,KAAkBH,EAAiB,CAC1C,MAAMU,EAAe,oBAAgBP,GAErC,GAAIO,EAAahoB,SAAW,wBACyB,kBAAvCgoB,EAAaC,iBAAiB/jB,KACxC,SAGJ,MAAM6C,QAAa,QAAW,YAAY0gB,aAA0BM,KAEpE,IAAKhhB,EAAKC,QAEN,YADA,oBAAuBD,EAAKoG,QAGpC,CAlBA,MAFI,oBAAuB,YAqB/B,EAuKI+a,YArKJpoB,eAA2BqoB,EAAmBC,GAAuB,GAGjE,GAAiC,KAFjCD,EAAoBvB,EAAeuB,IAEbjlB,OAClB,OAAO,EAGX,IAAImlB,EAASC,EAAiBC,EAW9B,GATI,sBACAF,GAAU,EACVC,GAAkB,KAGhBD,UAASC,kBAAiBC,oBAAoB,IAAI7d,SAAQI,GACxD,yBAA0B,wBAAyB,CAACqd,oBAAmB3d,SAAUM,EAAKsd,6BAGzFC,EACD,OAAO,EAGX,MAAMnB,EAAS,uBAAmB,IAElC,IAAIsB,EAAU,EAEd,IAAK,MAAMC,KAAoBN,EAAmB,CAC9CK,IAEA,MACME,EAAQ,WAAWxB,gBAAqBqB,EAAa,OAAS,gBADvDC,IAAYL,EAAkBjlB,OACgD,OAAS,UAE9F2jB,EAAS,oBAAgB4B,GAE3BH,QACM,WAAc,SAASzB,EAAO7mB,SAAS0oB,WAGvC,WAAc,YAAYD,IAAmBC,IAE3D,CAMA,OAJIH,GACA,4BAAwB,kCAGrB,CACX,EAuHII,sBArHJ7oB,eAAqC4S,GACjC,GAAI,kBAAiCA,IAC9B,mBAAkCA,IACC,WAAnCA,EAAKS,YAAYR,KAAKiW,SACzB,OAGJ,MAAMvV,EAAiBX,EAAKS,YAAYR,KAAKG,SACvC2U,EAAiB/U,EAAKC,KAAKG,SAE3B/L,QAAa,QAAW,YAAY0gB,gBAA6BpU,KAElEtM,EAAKC,SAKL,mBAAkC0L,IAASA,EAAKS,YAAY0V,cAAc3lB,QAAU,IACrFwP,EAAKS,YAAY2V,QAAS,EAC1BpW,EAAKS,YAAY4V,eANjB,oBAAuBhiB,EAAKoG,QAQpC,EAiGI6b,eAdJlpB,eAA8BE,EAAQ2nB,GAClC,MAAM5gB,QAAa,QAAW,SAAS/G,iBAAsB2nB,KAExD5gB,EAAKC,SACN,oBAAuBD,EAAKoG,QAEpC,EASI8b,kBApCJnpB,eAAiC4b,EAAawN,EAAgBlP,GAC1D,MAAMjT,QAAa,QAAW,SAAS2U,qBAA+BwN,IAAkB,CACpFlP,OAAQA,IAGPjT,EAAKC,SACN,oBAAuBD,EAAKoG,QAEpC,EA6BIgc,sBA3BJrpB,eAAqC4b,EAAa5T,EAAckS,GAC5D,MAAMjT,QAAa,QAAW,SAAS2U,mBAA6B5T,IAAgB,CAChFkS,OAAQA,IAGPjT,EAAKC,SACN,oBAAuBD,EAAKoG,QAEpC,2iBCvOArN,eAAeijB,oBAAoB/iB,EAAQopB,EAAe,KAAMC,EAAS,KAAMC,EAAS,MACpF,MAAMxiB,QAAe,+CAAY,iBAAiB9G,IAAU,CACxDqpB,SACAC,WAGJ,aAAaC,cAAcziB,EAAQsiB,EACvC,CAEAtpB,eAAeypB,cAAcziB,OAAQsiB,aAAcjD,YAC/C,MAAMqD,iBAAmB,qDAAc1iB,OAAO9G,OAAQ8G,OAAO2iB,WAAYL,aAAcjD,YAEvF,IACI,aAAc,WACV,OAAOuD,KAAK,gDAAgD5iB,OAAOuiB,iBACvE,EAAE7R,KAAKgS,WACX,CACA,MAAOrgB,GACH,MAAMpF,QAAa,uDAAc+C,OAAO9G,QAExC,+DAA6B,WAAW8G,OAAO9G,gBAAgB+D,EAAKgH,iBAAiB5B,EAAEgE,UAC3F,CACJ,CAEArN,eAAe6pB,wBACX,MAAMC,EAAW,0DACXC,QAAsB,8CAAW,kBAAoBD,EAAW,eAAiB,KAEvF,IAAK,MAAM9iB,KAAU+iB,QACXN,cAAcziB,EAE5B,CAEA,MAAMgjB,gBACF1mB,cACI3C,KAAKspB,SAAW,CAAC,CACrB,CAEAlP,IAAImP,GACKA,EAAOC,cAKZxpB,KAAKspB,SAASC,EAAOC,cAAgBxpB,KAAKspB,SAASC,EAAOC,eAAiB,GAC3ExpB,KAAKspB,SAASC,EAAOC,cAAcld,KAAKid,IALpCtU,QAAQY,IAAI,wEAMpB,CAEA4T,IAAIC,GACA,OAAK1pB,KAAKspB,SAASI,GAIZ1pB,KAAKspB,SAASI,GAIhB/d,KAAIpK,GAAKA,EAAEooB,UAAY,IAAIpoB,EAAMA,IAP3B,EAQf,EAGJlC,eAAeuqB,2BACX,MAAMR,QAAsB,8CAAW,kBAEjCS,EAAkB,IAAIR,gBAE5B,IAAK,MAAMhjB,KAAU+iB,EAAe,CAChC,IAAIG,EAEJ,IACIA,QAAeT,cAAcziB,GAC7BwjB,EAAgBzP,IAAImP,EACxB,CACA,MAAO7gB,GACHE,SAAS,aAAcF,GACvB,QACJ,CACJ,CAEA,OAAOmhB,CACX,CAEA,kCACIf,cACAxG,oBACA4G,sBACAU,8HCtFJ,IAAIE,EAAqB,GACrBC,EAAgB,KAsFpB,SAASC,IAGL,OAFAF,EAAqBA,EAAmBle,QAAOyG,KAAc,oBAAgBA,KAExC,IAA9ByX,EAAmBrnB,MAC9B,CAEA,SACIwnB,WA3FJ5qB,eAA0B6nB,GACtB,IAAI8C,IAIJ,GAAsB,QAAlBD,QACM,oBAA8BD,EAAoB5C,GAExD4C,EAAqB,GACrBC,EAAgB,UAEf,GAAsB,SAAlBA,EAA0B,CAC/B,MAAMG,EAAoBJ,EAAmBne,KAAI0G,GAAY,oBAAgBA,KAE7E,IAAK,MAAM8X,KAAmBD,EAAmB,CAC7C,MAAME,QAAsBD,EAAgBvR,gBAEtC,mBAA6BwR,EAAc7qB,OAAQ2nB,EAC7D,CAGJ,MAEI,qBAAwB,+BAA+B6C,IAE/D,EAmEIM,UAjEJhrB,eAAyBopB,GACrB,IAAIuB,IAIJ,GAAsB,QAAlBD,QACM,qBAA+BD,EAAoBrB,GAEzDqB,EAAqB,GACrBC,EAAgB,UAEf,GAAsB,SAAlBA,EAA0B,CAC/B,MAAMG,EAAoBJ,EAAmBne,KAAI0G,GAAY,oBAAgBA,KAE7E,IAAK,MAAM8X,KAAmBD,EAAmB,CAC7C,MAAME,QAAsBD,EAAgBvR,gBAEtC,sBAAgCwR,EAAc7qB,OAAQkpB,EAChE,CAGJ,MAEI,qBAAwB,+BAA+BsB,IAE/D,EAyCIO,IAnBJ,SAAahY,GACTwX,EAAqBxX,EAEjBwX,EAAmBrnB,OAAS,IAC5BsnB,EAAgB,MAEhB,sBAAyB,eAEjC,EAYIQ,KAxCJlrB,eAAoBiT,GAIhB,GAHAwX,EAAqBxX,EACrByX,EAAgB,OAEZ,uBAAoB,CAEpB,MAAM,UAACS,GAAa,EAAQ,MACtBC,EAAQ,GAEd,IAAK,MAAMrE,KAAU,sBAAkB0D,GAAqB,CACxD,MAAM5F,QAAc,eAAuB,GAAGkC,EAAO/e,gBAAgB+e,EAAO7mB,SAAU,CAAEmrB,eAAe,IACvGD,EAAMne,KAAK4X,EAAM,GAAGyG,UACxB,CAEAH,EAAUI,UAAUH,EAAM/Y,KAAK,MACnC,CAEA,sBAAyB,aAC7B,EAuBIsY,oLC5FJ,IAAIa,EAAY,EAmRhB,SACIC,mBA7QJzrB,eAAkC0rB,EAAQvqB,EAAU,CAAC,GACjDA,EAAUuP,OAAOsJ,OAAO,CACpB2R,SAAS,GACVxqB,GAEH,MAAMiD,EA+OV,SAA0BsnB,GACtB,IAAItnB,EAAOsnB,EAAOtnB,MAAQsnB,EAAOxS,KACjC,MAAMpY,EAAO4qB,EAAO5qB,KAmBpB,MAjBa,SAATsD,GAA4B,oBAATtD,EACnBsD,EAAO,MACS,SAATA,GAAmBtD,EAAK+H,WAAW,UAC1CzE,EAAO,QACS,SAATA,GAAmBtD,EAAK+H,WAAW,YAC1CzE,EAAO,SAGPsnB,EAAOrnB,cACH,kCACA,4BAGAD,EAAO,oBAIRA,CACX,CArQiBwnB,CAAiBF,GAGxBG,EAAmBxmB,EAAE,kCAE3B,GAAa,SAATjB,QAwDRpE,eAA0BiE,EAAM4nB,GAE5B,MAAM7hB,QAAa/F,EAAKgG,UAExB,GAAK,sBAAkBD,EAAK7F,eAuJhCnE,eAAkC6rB,EAAkB5nB,GAChD4nB,EAAiBvH,IAAI,UAAW,QAChCuH,EAAiBrH,SAAS,sBAE1B,IAAIsH,EAAe7nB,EAAKkZ,kBAEpB2O,EAAa1oB,OAAS,KACtB0oB,EAAeA,EAAana,MAAM,EAAG,KAIzC,MAAMoa,QAAmB,mBAAeD,GAExC,IAAK,MAAME,KAAaD,EACpBF,EAAiBvmB,aAAa,eAAuB,GAAGrB,EAAK/D,UAAU8rB,EAAU9rB,SAAU,CACvF+rB,aAAa,EACbC,cAAc,KAGlBL,EAAiBvmB,OAAO,OAEhC,CA1Jc6mB,CAAmBN,EAAkB5nB,OAlBT,CAClC4nB,EAAiBvmB,OAAOD,EAAE,4BAA4BihB,KAAKtc,EAAK7F,UAE5D0nB,EAAiB3e,KAAK,iBAAiB9J,OAAS,UAC1C,mBAA6B,WAEnCgpB,oBAAoBP,EAAiB,GAAI,CAACQ,OAAO,KAGrD,MAAMC,EAAoBvW,GAAM,qBAA6B1Q,EAAE0Q,GAAIrC,KAAK,SAClE6Y,EAAiBV,EAAiB3e,KAAK,oBACvCsf,EAAoBD,EAAejgB,KAAIyJ,GAAMuW,EAAkBvW,WAC/D,mBAAeyW,GAErB,IAAK,MAAMzW,KAAMwW,QACP,2BAAmClnB,EAAE0Q,GAEnD,CAGJ,CA/Ec0W,CAAWf,EAAQG,QAExB,GAAa,SAATznB,QAgFbpE,eAA0BiE,EAAM4nB,GAC5B,MAAM7hB,QAAa/F,EAAKgG,UAExB4hB,EAAiBvmB,OAAOD,EAAE,SAAS6gB,KAAKlc,EAAK7F,SACjD,CAnFcuoB,CAAWhB,EAAQG,QAExB,GAAa,UAATznB,GAA6B,WAATA,GAmFjC,SAAqBsnB,EAAQG,EAAkB1qB,EAAU,CAAC,GACtD,MAAMwrB,EAAeC,mBAAmBlB,EAAOzgB,OAE/C,IAAIzE,EAEAklB,aAAkB,IAClBllB,EAAM,cAAcklB,EAAOxrB,UAAUysB,KAAgBnU,KAAKqU,WACnDnB,aAAkB,MACzBllB,EAAM,mBAAmBklB,EAAOxgB,sBAAsByhB,KAAgBjB,EAAOtS,qBAGjFyS,EACKvH,IAAI,UAAW,QACfA,IAAI,cAAe,UACnBA,IAAI,kBAAmB,UAE5B,MAAMwI,EAAOznB,EAAE,SACVqO,KAAK,MAAOlN,GACZkN,KAAK,KAAM,oBAAsB8X,KACjClH,IAAI,YAAa,QAEtBuH,EAAiBvmB,OAAOwnB,GAEpB3rB,EAAQ4rB,cACR,mBAA6B,gBAA0BphB,MAAK,KACxDqhB,MAAMC,OAAO,IAAIH,EAAKpZ,KAAK,QAAS,CAChCwZ,SAAU,GACVC,MAAO,IACPC,aAAa,GACf,GAGd,CAlHQC,CAAY3B,EAAQG,EAAkB1qB,QAErC,IAAKA,EAAQwqB,SAAW,CAAC,OAAQ,MAAO,QAAS,SAAS7hB,SAAS1F,IAkH5E,SAAoBsnB,EAAQtnB,EAAMynB,GAC9B,IAAIyB,EAAYC,EAEhB,GAAI7B,aAAkB,IAClB4B,EAAa,QACbC,EAAW7B,EAAOxrB,WACf,MAAIwrB,aAAkB,KAIzB,MAAM,IAAIvd,MAAM,mCAAmCud,MAHnD4B,EAAa,cACbC,EAAW7B,EAAOxgB,YAGtB,CAEA,MAAMsiB,EAAWnoB,EAAE,sEAEnB,GAAa,QAATjB,EAAgB,CAChB,MAAMqpB,EAAcpoB,EAAE,8EACtBooB,EAAY/Z,KAAK,MAAO,sBAA8B,OAAO4Z,KAAcC,WAE3EC,EAASloB,OAAOmoB,EACpB,MAAO,GAAa,UAATrpB,EAAkB,CACzB,MAAMspB,EAAgBroB,EAAE,4BACnBqO,KAAK,MAAO,sBAA8B,OAAO4Z,KAAcC,mBAC/D7Z,KAAK,OAAQgY,EAAO5qB,MACpBwjB,IAAI,QAAS,QAElBkJ,EAASloB,OAAOooB,EACpB,MAAO,GAAa,UAATtpB,EAAkB,CACzB,MAAMupB,EAAgBtoB,EAAE,4BACnBqO,KAAK,MAAO,sBAA8B,OAAO4Z,KAAcC,mBAC/D7Z,KAAK,OAAQgY,EAAO5qB,MACpBwjB,IAAI,QAAS,QAElBkJ,EAASloB,OAAOqoB,EACpB,CAEA,GAAmB,UAAfL,EAAwB,CAGxB,MAAMM,EAAkBvoB,EAAE,2EACpBwoB,EAAcxoB,EAAE,uEAEtBuoB,EAAgB1Y,GAAG,SAAS,IAAM,qBAA6BwW,EAAOxrB,UACtE2tB,EAAY3Y,GAAG,SAAS,IAAM,uBAA+BwW,EAAOxrB,OAAQwrB,EAAO5qB,QAEnF+sB,EAAYC,QAAQpC,EAAOrnB,aAE3BmpB,EAASloB,OACLD,EAAE,gFACGC,OAAOsoB,GACPtoB,OAAOuoB,GAEpB,CAEAhC,EAAiBvmB,OAAOkoB,EAC5B,CAxKQO,CAAWrC,EAAQtnB,EAAMynB,QAExB,GAAa,YAATznB,QAwKbpE,eAA6BiE,EAAM4nB,SACzB,mBAA6B,aAEnC,MACM1nB,SADaF,EAAKgG,WACH9F,SAAW,GAEhC0nB,EACKvH,IAAI,UAAW,QACfA,IAAI,kBAAmB,gBAE5B,MACM0J,EADgB5rB,OAAO6rB,iBAAiB7b,SAASuR,iBACpBuK,iBAAiB,mBAEpDC,QAAQC,WAAWC,WAAW,CAACC,aAAa,EAAOC,MAAOP,EAAarT,OAAQ6T,cAAe,eAE9F,IACI,MAAM,IAACC,SAAaN,QAAQC,WAAWnZ,OAAO,oBAAsBuW,IAAarnB,GAEjF0nB,EAAiBvmB,OAAOD,EAAEopB,GAC9B,CAAE,MAAOplB,GACL,MAAMqlB,EAASrpB,EAAE,kBAEjBwmB,EAAiBvmB,OAAOopB,EAC5B,CACJ,CA/LcC,CAAcjD,EAAQG,QAE3B,GAAa,WAATznB,EAAmB,CACxB,MAAMopB,EAAWnoB,EAAE,eAEb,IAAA4P,OAAqByW,EAAQ8B,EAAU7sB,KAAKiuB,KAElD/C,EAAiBvmB,OAAOkoB,EAC5B,MACK,GAAKrsB,EAAQwqB,SAAoB,qBAATvnB,EAWpBsnB,aAAkB,KACvBG,EAAiBvmB,OACbD,EAAE,SACGif,IAAI,UAAW,QACfA,IAAI,kBAAmB,gBACvBA,IAAI,cAAe,UACnBA,IAAI,SAAU,QACdA,IAAI,YAAa,QACjBhf,OAAOD,EAAE,UAAUmf,SAASkH,EAAO9L,iBAnBU,CACtD,MAAMiP,EAAUxpB,EAAE,kFACb6P,GAAG,QAAS,2BAEjB2W,EAAiBvmB,OACbD,EAAE,SACGC,OAAO,mCACPA,OAAO,SACPA,OAAOupB,GAEpB,CAiBA,OAJInD,aAAkB,KAClBG,EAAiBrH,SAASkH,EAAOnJ,eAG9B,CACHsJ,mBACAznB,OAER,kFCjEApE,eAAe8uB,EAAWC,GACtB,MAAM9qB,QAAa,QAAW,sBAAsB8qB,IAAQ,aAI5D,aAFM,0CAEO,kBAAc9qB,EAAK/D,OACpC,CA+CA,SACI8uB,aAlEJhvB,iBACI,MAAMiE,QAAa,QAAW,uBAAuBgrB,QAAQC,OAAO,gBAAiB,aAErF,aAAa,kBAAcjrB,EAAK/D,OACpC,EA+DIivB,aA5DJnvB,iBACI,aAAa8uB,EAAWG,QAAQC,OAAO,cAC3C,EA2DIJ,aACAM,YAhDJpvB,eAA2B+uB,GACvB,MAAM9qB,QAAa,QAAW,uBAAuB8qB,IAAQ,aAI7D,aAFM,0CAEO,kBAAc9qB,EAAK/D,OACpC,EA2CImvB,aAxCJrvB,eAA4BsvB,GACxB,MAAMrrB,QAAa,QAAW,wBAAwBqrB,IAAS,aAI/D,aAFM,0CAEO,kBAAcrrB,EAAK/D,OACpC,EAmCIqvB,YAhCJvvB,eAA2BwvB,GACvB,MAAMvrB,QAAa,QAAW,uBAAuBurB,IAAQ,aAI7D,aAFM,0CAEO,kBAAcvrB,EAAK/D,OACpC,EA2BIuvB,iBAxBJzvB,iBACI,MAAMiE,QAAa,SAAY,6BAI/B,aAFM,0CAEO,kBAAcA,EAAK/D,OACpC,EAmBIwvB,iBAhBJ1vB,eAAgCoI,EAAO,CAAC,GACpC,MAAMnE,QAAa,SAAY,4BAA6BmE,GAI5D,aAFM,0CAEO,kBAAcnE,EAAK/D,OACpC,+DC3CA,SACIyvB,KAxBJ3vB,eAAoBqN,GAChB,OAAO,IAAIzC,SAAQI,GACf,yBAA0B,iBAAkB,CAACqC,UAAS3C,SAAUM,KACxE,EAsBI4kB,QApBJ5vB,eAAuBqN,GACnB,OAAO,IAAIzC,SAAQI,GACf,yBAA0B,oBAAqB,CAC3CqC,UACA3C,SAAU2Z,GAAKrZ,EAAIqZ,EAAEwL,cAEjC,EAeIC,6BAbJ9vB,eAA4CiL,GACxC,OAAO,IAAIL,SAAQI,GACf,yBAA0B,yCAA0C,CAACC,QAAOP,SAAUM,KAC9F,EAWI+kB,OATJ/vB,eAAsBgwB,GAClB,OAAO,IAAIplB,SAAQI,GACf,yBAA0B,mBAAoB,IAAIglB,EAAOtlB,SAAUM,KAC3E,oHCvBe,MAAMilB,EACjB3sB,YAAYyV,GAERpY,KAAK6a,OAASzC,EAAIyC,OAMlB7a,KAAKwD,QAAU4U,EAAI5U,QACnBxD,KAAKwJ,cAAgB4O,EAAI5O,cAGzBxJ,KAAKwY,aAAeJ,EAAII,aAExBxY,KAAKyY,gBAAkBL,EAAIK,eAC/B,CAKA8W,iBACI,OAAKvvB,KAAKwD,SAAYxD,KAAKwD,QAAQwW,OAI5BlO,KAAK0P,MAAMxb,KAAKwD,SAHZ,IAIf,CAGAgsB,uBACI,IACI,OAAOxvB,KAAKuvB,gBAChB,CACA,MAAO7mB,GACH,OAAO,IACX,CACJ,gBCoWJ,MAAM7I,EAAQ,IAvXd,MACI8C,cACI3C,KAAKyvB,mBAAqBzvB,KAAK0vB,iBACnC,CAEArwB,wBACI,MAAMiH,QAAa/C,EAAA,MAAW,QAK9BvD,KAAK6Y,MAAQ,CAAC,EAGd7Y,KAAK2vB,SAAW,CAAC,EAGjB3vB,KAAKwa,WAAa,CAAC,EAGnBxa,KAAK2Y,YAAc,CAAC,EAGpB3Y,KAAK4vB,aAAe,CAAC,EAErB5vB,KAAK6vB,QAAQvpB,EACjB,CAEAjH,kBAAkBywB,GACd,MAAMxpB,QAAa/C,EAAA,MAAW,sBAAsBusB,KAIpD,OAFA9vB,KAAK6vB,QAAQvpB,GAENtG,KAAK6Y,MAAMiX,EACtB,CAEAD,QAAQvpB,GACJ,MAAMypB,EAAWzpB,EAAKuS,MAChBmX,EAAa1pB,EAAKqpB,SAClBM,EAAgB3pB,EAAKkU,WAErB0V,EAAgB,IAAIpW,IAE1B,IAAK,MAAMqW,KAAWJ,EAAU,CAC5B,MAAM,OAACxwB,GAAU4wB,EAEjB,IAAI7sB,EAAOtD,KAAK6Y,MAAMtZ,GAEtB,GAAI+D,EAAM,CAIN,GAHAA,EAAK+U,OAAO8X,GAGM,WAAd7sB,EAAKG,KAAmB,CACxB,IAAK,MAAMwX,KAAe3X,EAAK8H,SAAU,CACrC,MAAMigB,EAAYrrB,KAAK6Y,MAAMoC,GAEzBoQ,IACAA,EAAU3Q,QAAU2Q,EAAU3Q,QAAQ9O,QAAOwkB,GAAKA,IAAM7wB,WAEjDS,KAAK2vB,SAAStE,EAAU1Q,eAAepb,WACvC8rB,EAAU1Q,eAAepb,GAExC,CAEA+D,EAAK8H,SAAW,GAChB9H,EAAKsX,cAAgB,CAAC,CAC1B,CAIAtX,EAAKoX,QAAUpX,EAAKoX,QAAQ9O,QAAOvE,IAC/B,MAAM4V,EAAajd,KAAK6Y,MAAMxR,GACxB+e,EAASpmB,KAAK2vB,SAAS1S,EAAWrC,cAAcrb,IAEtD,SAAK0d,IAAemJ,IAIhBA,EAAO3M,iBAIXwD,EAAW7R,SAAW6R,EAAW7R,SAASQ,QAAOwkB,GAAKA,IAAM7wB,WAErDS,KAAK2vB,SAAS1S,EAAWrC,cAAcrb,WACvC0d,EAAWrC,cAAcrb,GAEzB,GAAK,GAEpB,MAEIS,KAAK6Y,MAAMtZ,GAAU,IAAI,IAAMS,KAAMmwB,EAE7C,CAEA,IAAK,MAAME,KAAaL,EAAY,CAChC,MAAM5J,EAAS,IAAI,IAAQpmB,KAAMqwB,GAEjCrwB,KAAK2vB,SAASvJ,EAAO/T,UAAY+T,EAEjC,MAAMiF,EAAYrrB,KAAK6Y,MAAMuN,EAAO7mB,QAEhC8rB,GACAA,EAAUvQ,UAAUsL,EAAO/e,aAAc+e,EAAO/T,UAAU,GAG9D,MAAM4K,EAAajd,KAAK6Y,MAAMuN,EAAO/e,cAEjC4V,IACAA,EAAWjC,SAASoL,EAAO7mB,OAAQ6mB,EAAO/T,UAAU,GAEpD6d,EAAc9V,IAAI6C,EAAW1d,QAErC,CAEA,IAAK,MAAM+wB,KAAgBL,EAAe,CACtC,MAAM,YAAC9c,GAAemd,EAEtBtwB,KAAKwa,WAAWrH,GAAe,IAAI,IAAWnT,KAAMswB,GAEpD,MAAMhtB,EAAOtD,KAAK6Y,MAAMyX,EAAa/wB,QAMrC,GAJI+D,IAASA,EAAKkX,WAAWrR,SAASgK,IAClC7P,EAAKkX,WAAWlO,KAAK6G,GAGC,aAAtBmd,EAAa7sB,KAAqB,CAClC,MAAM8sB,EAAavwB,KAAK6Y,MAAMyX,EAAald,OAEvCmd,IACKA,EAAW9V,gBAAgBtR,SAASgK,IACrCod,EAAW9V,gBAAgBnO,KAAK6G,GAG5C,CACJ,CAGA,IAAK,MAAM5T,KAAU2wB,EACjBlwB,KAAK6Y,MAAMtZ,GAAQ2b,eACnBlb,KAAK6Y,MAAMtZ,GAAQwb,aAE3B,CAEA1b,kBAAkB8S,GACd,GAAuB,IAAnBA,EAAQ1P,OACR,OAGJ0P,EAAUqe,MAAMC,KAAK,IAAI3W,IAAI3H,IAE7B,MAAM7L,QAAa/C,EAAA,OAAY,YAAa,CAAE4O,YAE9CnS,KAAK6vB,QAAQvpB,GAEb,uBAAwB,gBAAiB,CAAC6L,WAC9C,CAEA9S,qBAAqBE,GACjB,MAAM+D,QAAatD,KAAK4Y,QAAQrZ,GAEhC,IAAK+D,GAAsB,WAAdA,EAAKG,KACd,OAGJ,MAAM,oBAACitB,EAAmB,kBAAEC,EAAiB,MAAElqB,SAAelD,EAAA,MAAW,eAAeD,EAAK/D,UAE7F,IAAKixB,MAAMI,QAAQF,GACf,MAAM,IAAIljB,MAAM,gBAAgBlK,EAAK/D,mBAAmBmxB,KAIxDptB,EAAK/D,UAAUM,EAAMgZ,QACrBhZ,EAAMgZ,MAAMvV,EAAK/D,QAAQ6L,SAAW,GACpCvL,EAAMgZ,MAAMvV,EAAK/D,QAAQqb,cAAgB,CAAC,GAG9C,MAAM+U,EAAW,IAAIrsB,EAAKqY,uBAAwBrY,EAAKuY,oBAqBvD,OAnBA6U,EAAoBxgB,SAAQ,CAAC2gB,EAAcC,IAAUnB,EAASrjB,KAAK,CAE/D+F,SAAU,QAAQ/O,EAAK/D,UAAUsxB,IACjCtxB,OAAQsxB,EACRxpB,aAAc/D,EAAK/D,OACnB+Z,aAA4B,IAAbwX,EAAQ,GACvBrX,gBAAgB,MAIpBzZ,KAAK6vB,QAAQ,CACThX,MAAO,CAACvV,GACRqsB,WACAnV,WAAY,KAGhB3a,EAAMgZ,MAAMvV,EAAK/D,QAAQwxB,qBAAsB,EAC/ClxB,EAAMgZ,MAAMvV,EAAK/D,QAAQoxB,kBAAoBA,EAEtC,CAAClqB,QACZ,CAGAuV,kBAAkB7J,EAAS6e,GAAsB,GAC7C,OAAO7e,EAAQxG,KAAIpM,GACVS,KAAK6Y,MAAMtZ,IAAYyxB,EAMjBhxB,KAAK6Y,MAAMtZ,IALlB0V,QAAQgc,MAAM,oBAAoB1xB,MAE3B,QAKZqM,QAAOtI,KAAUA,GACxB,CAGAjE,eAAe8S,EAAS6e,GAAsB,GAE1C,MAAME,GADN/e,EAAUqe,MAAMC,KAAK,IAAI3W,IAAI3H,KACEvG,QAAOrM,IAAWS,KAAK6Y,MAAMtZ,KAI5D,aAFMS,KAAKmxB,YAAYD,GAEhB/e,EAAQxG,KAAIpM,GACVS,KAAK6Y,MAAMtZ,IAAYyxB,EAKjBhxB,KAAK6Y,MAAMtZ,IAJlB0V,QAAQgc,MAAM,oBAAoB1xB,MAE3B,QAIZqM,QAAOtI,KAAUA,GACxB,CAGAjE,iBAAiBE,GAGb,OAAwB,WAFJS,KAAKyc,SAAS,CAACld,IAAS,IAE/BkD,MACjB,CAGApD,cAAcE,EAAQyxB,GAAsB,GACxC,MAAe,SAAXzxB,GACA0V,QAAQgc,MAAM,mBACP,MAED1xB,SAKIS,KAAKyc,SAAS,CAACld,GAASyxB,IAAsB,IAJxD/b,QAAQgc,MAAM,iBAAiB1xB,uBACxB,KAIf,CAGAma,iBAAiBna,GACb,IAAKA,EACD,MAAM,IAAIiO,MAAM,YAGpB,OAAOxN,KAAK6Y,MAAMtZ,EACtB,CAGAqc,YAAYtJ,EAAW0e,GAAsB,GACzC,OAAO1e,EACF3G,KAAI0G,GAAYrS,KAAKqb,UAAUhJ,EAAU2e,KACzCplB,QAAO+D,KAAOA,GACvB,CAGA0L,UAAUhJ,EAAU2e,GAAsB,GACtC,GAAM3e,KAAYrS,KAAK2vB,SAMnB,OAAO3vB,KAAK2vB,SAAStd,GALhB2e,GACDpoB,SAAS,wBAAwByJ,KAM7C,CAEAhT,kBAAkBgI,EAAc4T,GAC5B,GAAoB,SAAhBA,EACA,MAAO,YAGX,MAAM9M,QAAcnO,KAAK4Y,QAAQqC,GAEjC,OAAK9M,EAMEA,EAAMwM,eAAetT,IALxBuB,SAAS,uCAAuCvB,cAAyB4T,iCAElE,KAIf,CAGA5b,oBAAoBkL,EAAcymB,GAAsB,GACpD,MAAMxmB,EAAaxK,KAAK2Y,YAAYpO,GACpC,GAAIC,EACA,OAAOA,EAIX,IAAI4mB,EACJ,IACIA,QAAuB7tB,EAAA,wBAA6B,eAAegH,QACvE,CACA,MAAO7B,GACH,GAAIsoB,EAEA,OADAK,QAAQ,eAAe9mB,qDAAkE7B,EAAEgE,SACpF,KAEP,MAAMhE,CAEd,CAEA,MAAMiQ,EAAc3Y,KAAKsxB,sBAAsBF,GAM/C,OAJIzY,EAAYlW,SACZkW,EAAY,GAAGC,UAAUD,YAAcA,GAGpC3Y,KAAK2Y,YAAYpO,EAC5B,CAGAlL,4BAA4BE,GACxB,MAAM6xB,QAAuB7tB,EAAA,MAAW,SAAShE,iBACjD,OAAOS,KAAKsxB,sBAAsBF,EACtC,CAGAE,sBAAsBF,GAClB,OAAOA,EAAezlB,KAAI4lB,IACtB,IAAI/mB,EAUJ,OARI+mB,EAAchnB,gBAAgBvK,KAAK2Y,aACnCnO,EAAaxK,KAAK2Y,YAAY4Y,EAAchnB,cAC5CC,EAAW6N,OAAOkZ,KAElB/mB,EAAa,IAAI,IAAYxK,KAAMuxB,GACnCvxB,KAAK2Y,YAAYnO,EAAWD,cAAgBC,GAGzCA,CAAU,GAEzB,CAGAnL,cAAcstB,EAAYC,GAItB,MAAM4E,EAAM,GAAG7E,KAAcC,IAe7B,OAbK5sB,KAAK4vB,aAAa4B,KACnBxxB,KAAK4vB,aAAa4B,GAAOjuB,EAAA,MAAW,GAAGopB,KAAcC,UAChD5hB,MAAKoN,GAAO,IAAIkX,EAAMlX,KACtBqZ,OAAM/oB,GAAKuM,QAAQxO,MAAM,uBAAuBkmB,MAAeC,KAAalkB,KAKjF1I,KAAK4vB,aAAa4B,GAAKxmB,MACnB,IAAMrC,YAAW,IAAM3I,KAAK4vB,aAAa4B,GAAO,MAAM,cAIjDxxB,KAAK4vB,aAAa4B,EACnC,GAKJ,8FCtYA,SAASE,IACL,MAAM5tB,EAAoB,wCAE1B,OAAOA,EAAoBA,EAAkBjD,cAAgB,MACjE,CAEAxB,eAAe0E,IACX,MAAMD,EAAoB,wCAEtBA,SACMA,EAAkBC,SAEhC,CAMA,SAAS4tB,EAAc1f,GAEnB,MAA4B,SAArBA,EAAKC,KAAK3S,QACV0S,EAAKC,KAAK3S,SAAWmyB,GAChC,CAuCA,SACIA,mBACA3tB,UACA6tB,eAlDJ,SAAwB3f,GACpB,OAAO0f,EAAc1f,EAAKS,YAC9B,EAiDIif,gBACAE,gBA/BJxyB,eAA+BS,EAAUZ,GACrC,MAAM0I,QAAyB,oBAA4B9H,EAAUZ,EAAY2B,eAEjF,IAAK+G,EAED,OADAqN,QAAQY,IAAI,oBAAoB/V,OACzB,EAGX,MAAMe,EAAgB3B,EAAY2B,cAElC,IAAK+G,EAAiBuB,SAAStI,KAAmB+G,EAAiBuB,SAAS,WAAY,CACpF,MAAM2oB,QAAsB,kBAAc,qBAA6BlqB,IACjEmqB,QAAoB,kBAAclxB,GAExC,IAAKkxB,EAAYzQ,YAAY,mBACf,YAAsB,mBAAmBwQ,EAAcxnB,sCAAsCynB,EAAYznB,mGACnH,OAAO,QAILvG,GACV,CAEA,OAAO,CACX,EAQIiuB,yBA3CJ3yB,iBACI,MAAMwB,EAAgB6wB,IAEtB,MAAsB,SAAlB7wB,UAIsB,kBAAcA,IACrByb,oBACvB,sIChCOjd,eAAe4yB,EAAYtF,EAAYtlB,EAAc6qB,EAAO1xB,GAC/D,IAAK,CAAC,QAAS,eAAe2I,SAASwjB,GACnC,MAAM,IAAInf,MAAM,oCAAoCmf,OAGxD,GAAqB,IAAjBuF,EAAMzvB,OACN,OAGJ,MAAMgkB,EAAS,uBAAmB,IAClC,IAAIsB,EAAU,EAEd,IAAK,MAAMoK,KAAQD,EAAO,CACtBnK,IAEA,MAAMqK,EAAW,IAAIC,SACrBD,EAASztB,OAAO,SAAUwtB,GAC1BC,EAASztB,OAAO,SAAU8hB,GAC1B2L,EAASztB,OAAO,OAAQojB,IAAYmK,EAAMzvB,OAAS,OAAS,SAE5D,IAAK,MAAM+uB,KAAOhxB,EACd4xB,EAASztB,OAAO6sB,EAAKhxB,EAAQgxB,UAG3B9sB,EAAE4tB,KAAK,CACTzsB,IAAK,GAAGpE,OAAOmD,KAAK2tB,mBAAmBlrB,KAAgBslB,WACvD6F,cAAe,iBACftgB,KAAMkgB,EACNK,SAAU,OACVhvB,KAAM,OACNuG,QAAS,KACTvD,MAAO,SAAUisB,GACb,oBAAuB,kBAAkBA,EAAIC,eACjD,EACAC,aAAa,EACbC,aAAa,GAErB,CACJ,CAEA,SAASxM,EAAUC,EAAI5Z,GACnB,MAAO,CACH4Z,GAAIA,EACJhc,MAAO,OACPoC,QAASA,EACT6Z,KAAM,OAEd,CAEA,yBAAuBlnB,UACnB,GAAyB,gBAArBqN,EAAQ8Z,SAIZ,GAAqB,cAAjB9Z,EAAQjJ,KACR,0BAA6BiJ,EAAQ+Z,QACrC,oBAAuB/Z,EAAQA,cAC5B,GAAqB,sBAAjBA,EAAQjJ,KACf,yBAA4B4iB,EAAU3Z,EAAQ+Z,OAAQ,uBAAuB/Z,EAAQga,uBAClF,GAAqB,kBAAjBha,EAAQjJ,KAA0B,CACzC,MAAM+C,EAAQ6f,EAAU3Z,EAAQ+Z,OAAQ,SACxCjgB,EAAMmgB,WAAa,IAEnB,yBAA4BngB,GAExBkG,EAAQomB,OAAOC,sBACT,wCAAyC3pB,QAAQsD,EAAQomB,OAAOC,eAE9E,KAGJ,yBAAuB1zB,UACnB,GAAyB,sBAArBqN,EAAQ8Z,SAIZ,GAAqB,cAAjB9Z,EAAQjJ,KACR,0BAA6BiJ,EAAQ+Z,QACrC,oBAAuB/Z,EAAQA,cAC5B,GAAqB,sBAAjBA,EAAQjJ,KACf,yBAA4B4iB,EAAU3Z,EAAQ+Z,OAAQ,uBAAuB/Z,EAAQga,uBAClF,GAAqB,kBAAjBha,EAAQjJ,KAA0B,CACzC,MAAM+C,EAAQ6f,EAAU3Z,EAAQ+Z,OAAQ,SACxCjgB,EAAMmgB,WAAa,IAEnB,yBAA4BngB,GAExBkG,EAAQomB,OAAOzrB,oBACT,wCAAyC+B,QAAQsD,EAAQomB,OAAOC,eAAgB,CAClF5zB,UAAW,CACP4B,SAAU,gBAI1B,KAGJ,SACIkxB,4GCpGJ,MAAMe,EAAqB,CAAC,EAEtBC,EAAwB,QAAW,oBAAoBjoB,MAAKkoB,IACjEA,EAAUA,EAAQtnB,QAAO8D,KAAOA,EAAEyjB,aAElC,IAAK,MAAM9xB,KAAU6xB,EACpB7xB,EAAO+xB,mBAAqB/xB,EAAO+xB,mBAAmBxnB,QAAOynB,IAAaA,EAASnrB,WAAW,aAE9F8qB,EAAmB3xB,EAAO8xB,YAAc9xB,EAGzC,OAAO6xB,CAAO,IAOf7zB,eAAei0B,EAAmBC,GAGjC,aAFsBN,GAEPrnB,QAAOvK,GAAUA,EAAOkyB,QAAUA,GAClD,CAoBAl0B,eAAem0B,EAAUL,EAAYM,GAAS,SACvCR,EAEN,MAAM5xB,EAAS2xB,EAAmBG,GAElC,IAAK9xB,EAAQ,CACZ,IAAIoyB,EAIH,MAAM,IAAIjmB,MAAM,uBAAuB2lB,MAHvCle,QAAQC,MAAM,uBAAuBie,KAKvC,CAEA,OAAO9xB,CACR,CAvBAiyB,EAAmB,UAAUtoB,MAAKkoB,IACjC,IAAK,MAAM7xB,KAAU6xB,EACpB,IAAK,MAAMG,KAAYhyB,EAAO+xB,mBAC7B,uBAAmCC,GAAU,IAAM,yBAA0BhyB,EAAO8xB,WAAY,CAAC1zB,MAAO,oCAE1G,IAqDD,SACCi0B,yBAlCD,SAAkChO,GACjCA,EAAWnZ,KAAK,qBAAqBonB,MAAKt0B,MAAOmQ,EAAG4F,KACnD,MAAM+d,EAAazuB,EAAE0Q,GAAIrC,KAAK,gBACxB1R,QAAemyB,EAAUL,GAAY,GAE3C,GAAI9xB,EAAQ,CACX,MAAMuyB,EAAkBvyB,EAAO+xB,mBAAmB1hB,KAAK,OAEnDkiB,GAAoC,YAAjBlvB,EAAE0Q,GAAImQ,SAC5B7gB,EAAE0Q,GAAImQ,KAAKqO,EAEb,KAGDlO,EAAWnZ,KAAK,0BAA0BonB,MAAKt0B,MAAOmQ,EAAG4F,KACxD,MAAM+d,EAAazuB,EAAE0Q,GAAIrC,KAAK,wBACxB1R,QAAemyB,EAAUL,GAAY,GAE3C,GAAI9xB,EAAQ,CACX,MAAMiJ,EAAQ5F,EAAE0Q,GAAIrC,KAAK,SACnB8gB,EAAYxyB,EAAO+xB,mBAAmB1hB,KAAK,MAEjD,GAAIpH,GAAOnB,SAAS0qB,GACnB,OAGD,MAAMC,EAAYxpB,GAAO0P,OAAqB,GAAG1P,MAAUupB,KAAzBA,EAElCnvB,EAAE0Q,GAAIrC,KAAK,QAAS+gB,EACrB,IAEF,EAICC,uBAtED10B,eAAsCk0B,EAAO3e,EAAKX,GACjD,MAAMif,QAAgBI,EAAmBC,GAEzC,IAAK,MAAMlyB,KAAU6xB,EACpB,IAAK,MAAMG,KAAYhyB,EAAO+xB,mBAC7B,mBAA+Bxe,EAAKye,GAAU,IAAMpf,EAAUjM,eAAe3G,EAAO8xB,WAAY,CAAC1zB,MAAO,oCAG3G,EA+DCu0B,WAjFD30B,iBACC,aAAa4zB,CACd,EAgFCK,oECbD,MAAMW,EAAuB,CAAC,EAE9B50B,eAAe60B,EAAcruB,GACzBA,EAAM,GAAGpE,OAAOmD,KAAKuvB,aAAatuB,IAE7BouB,EAAqBpuB,KACtBouB,EAAqBpuB,GAAOnB,EAAE4tB,KAAK,CAC/BzsB,IAAKA,EACL4sB,SAAU,SACV2B,OAAO,WAITH,EAAqBpuB,EAC/B,CAEAxG,eAAeg1B,EAAWxuB,EAAKyuB,GAAmB,GAC7B9D,MACZC,KAAKhf,SAAS8iB,iBAAiB,SAC/B5oB,KAAIyJ,GAAMA,EAAG/I,OAEJkS,MAAKsD,GAAKA,EAAEzb,SAASP,OAC3ByuB,IACAzuB,EAAM,GAAGpE,OAAOmD,KAAKuvB,aAAatuB,KAGtCnB,EAAE,QAAQC,OAAOD,EAAE,6CAA6CqO,KAAK,OAAQlN,IAErF,CAEA,SACIwuB,aACAG,eA7CJn1B,eAA8Bo1B,GAK1B,GAJIA,EAAQ9Q,KACR8Q,EAAQ9Q,IAAIhY,KAAI+oB,GAAUL,EAAWK,KAGrCD,EAAQE,GACR,IAAK,MAAMC,KAAaH,EAAQE,SACtBT,EAAcU,EAGhC,EAoCIC,SAxHa,CAAC,GAAM,CAAC,mCAyHrBC,YAvHgB,CAChBH,GAAI,CACA,qCACA,oDACA,mDACA,+CACA,8CACA,0CACA,4CACA,8CACA,+CACA,6CACA,4CACA,yDACA,oCACA,sCAEJhR,IAAK,CACD,sCACA,6CAqGJoR,OAjGW,CAACJ,GAAI,CAAC,wBAkGjBK,aAhGiB,CACjBL,GAAI,CACA,uBACA,wBAEJhR,IAAK,CACD,iCA2FJsR,WAvFe,CAACN,GAAI,CAAC,2BAwFrBO,gBAtFoB,CAACvR,IAAK,CAAC,6BAuF3BwR,MArFU,CACVR,GAAI,CAAE,uCACF,gDACA,sDACJhR,IAAK,CAAE,0CAkFPyR,WA/Ee,CACfT,GAAI,CAAE,gCA+ENU,YA5EgB,CAChBV,GAAI,CAAE,iCA4ENW,QAzEY,CACZX,GAAI,CAAE,6BAyENY,WAtEe,CACfZ,GAAI,CACA,iDACA,yDACA,0EAmEJa,OA/DW,CACXb,GAAI,CACA,yIC1DRt1B,eAAeo2B,EAAYl2B,EAAQwB,GAC/B,IAAIwlB,EAWJ,MATiB,YAAbxlB,EAGAwlB,SAFmB,kBAAchnB,IAErB0f,UACQ,WAAble,EACPwlB,EAAO,mBACa,gBAAbxlB,IACPwlB,EAAO,cAEJA,CACX,CA+FA,SAASvZ,GAAc,SAAClN,EAAQ,MAAEL,EAAK,cAAEoB,EAAa,UAAE1B,EAAY,CAAC,IACjEW,EAAWA,GAAY,GACvB,MAOM41B,EAPS,CACXj2B,EAAQ,CAAEA,MAAOA,GAAU,KAC1BoB,GAAmC,SAAlBA,EAA4B,CAAEA,cAAeA,GAAkB,KACjF1B,EAAU4B,UAAmC,YAAvB5B,EAAU4B,SAAyB,CAAEA,SAAU5B,EAAU4B,UAAa,KAC5F5B,EAAUoL,aAAe,CAAEA,aAAcpL,EAAUoL,cAAiB,MACtEqB,QAAOwkB,KAAOA,IAEQzkB,KAAIgqB,IACxB,MAAMriB,EAAOvD,OAAO6lB,KAAKD,GAAM,GACzBviB,EAAQuiB,EAAKriB,GAEnB,MAAO,GAAG2Y,mBAAmB3Y,MAAS2Y,mBAAmB7Y,IAAQ,IAClE1B,KAAK,KAER,IAAK5R,IAAa41B,EACd,MAAO,GAGX,IAAIzoB,EAAO,IAAInN,IAMf,OAJI41B,IACAzoB,GAAQ,IAAIyoB,KAGTzoB,CACX,CAEA,SAAS4oB,EAA4BhwB,GACjC,IAAKA,EACD,MAAO,CAAC,EAGZ,MAAMiwB,EAAUjwB,EAAIkwB,QAAQ,KAC5B,IAAiB,IAAbD,EACA,MAAO,CAAC,EAGZ,MAAM7oB,EAAOpH,EAAImwB,OAAOF,EAAU,IAC3Bh2B,EAAUm2B,GAAehpB,EAAKnE,MAAM,KAE3C,IAAKhJ,EAASo2B,MAAM,sCAChB,MAAO,CAAC,EAGZ,MAAM/2B,EAAY,CACd4B,SAAU,WAEd,IAAItB,EAAQ,KACRoB,EAAgB,KAChBnB,EAAe,KAEnB,GAAIu2B,EACA,IAAK,MAAMN,KAAQM,EAAYntB,MAAM,KAAM,CACvC,IAAKwK,EAAMF,GAASuiB,EAAK7sB,MAAM,KAC/BwK,EAAO6iB,mBAAmB7iB,GAC1BF,EAAQ+iB,mBAAmB/iB,GAEd,UAATE,EACA7T,EAAQ2T,EACQ,kBAATE,EACPzS,EAAgBuS,EACA,iBAATE,EACP5T,EAAe0T,EACR,CAAC,WAAY,gBAAgBjK,SAASmK,GAC7CnU,EAAUmU,GAAQF,EAElB6B,QAAQmhB,KAAK,gCAAgC9iB,MAErD,CAGJ,MAAO,CACHxT,WACAP,OAAQ,qBAA6BO,GACrCL,QACAoB,gBACA1B,YACAO,eAER,CAEA,SAAS22B,EAASC,GACd,MAAMpS,EAAQxf,EAAE4xB,EAAI3jB,QAAQ+B,QAAQ,iBAGpC,OAAO6hB,EAAYD,EAFFpS,EAAMnR,KAAK,SAAWmR,EAAMnR,KAAK,aAEhBmR,EACtC,CAEA,SAASqS,EAAYD,EAAKE,EAAUtS,GAChC,GAAIsS,GAAUtuB,WAAW,SACrB,OAAO,EAGXouB,EAAIG,iBACJH,EAAIlS,kBAEJ,MAAM,SAACtkB,EAAQ,UAAEX,GAAa02B,EAA4BW,GAEpDlf,EAAU,oBAAgBgf,GAC1BI,EAA4B,IAAdJ,EAAIjS,MAClBsS,EAA8B,IAAdL,EAAIjS,MACpBuS,EAAgBF,GAAepf,GAAYqf,EAE3CE,EAA0B,IAAdP,EAAIjS,MAChByS,EAA4B,IAAdR,EAAIjS,MAExB,GAAIvkB,GACA,GAAI82B,EACA,iDAAkD92B,EAAU,CAACX,mBAC1D,GAAIu3B,EAAa,CACpB,MAAMj3B,EAAQiF,EAAE4xB,EAAI3jB,QAAQ+B,QAAQ,iBAAiB3B,KAAK,eAEpD7T,EAAcO,EACd,wCAAyCA,GACzC,wCAENP,EAAYkK,QAAQtJ,EAAU,CAACX,cAAY6L,MAAK,KACxC9L,IAAgB,yCAChB,yCAA0CA,EAAYO,MAC1D,GAER,OACG,GAAI+2B,EAAU,CACjB,MAAMO,EAAiB7S,GAAO1P,SAAS,4BACjCwiB,GAAqB9S,GAAuD,IAA9CA,EAAMxP,QAAQ,qBAAqBjS,QAEnEm0B,GACIG,IAAmBF,GAAaC,IAChCE,IAAsBH,GAAaC,MAEnCN,EAASS,cAAc/uB,WAAW,SAAWsuB,EAAStuB,WAAW,QACjEzG,OAAOyE,KAAKswB,EAAU,UACfA,EAASS,cAAc/uB,WAAW,UAAY,wBACpC,yBAAqB,YAE7BgvB,MAAMC,SAASX,GAGpC,CAEA,OAAO,CACX,CA2CAn3B,eAAe+3B,EAAsB/qB,GACjC,MAAM,OAAC9M,EAAM,UAAEJ,GAAa02B,EAA4BxpB,GACxD,IAAK9M,EACD,MAAO,iBAGX,MAAM+D,QAAa,kBAAc/D,GACjC,IAAK+D,EACD,MAAO,iBAGX,GAA4B,gBAAxBnE,GAAW4B,UAA8B5B,GAAWoL,aAAc,CAClE,MAAMC,QAAmBlH,EAAKmH,kBAAkBtL,EAAUoL,cAE1D,OAAOC,EAAaA,EAAWF,MAAQ,sBAC3C,CACI,OAAOhH,EAAKgH,KAEpB,CA0BA5F,EAAE+M,UAAU8C,GAAG,QAAS,IAAK8hB,GAC7B3xB,EAAE+M,UAAU8C,GAAG,WAAY,IAAK8hB,GAChC3xB,EAAE+M,UAAU8C,GAAG,cAAe,KAvF9B,SAAyB7L,GACrB,MAAMwb,EAAQxf,EAAEgE,EAAEiK,QAAQ+B,QAAQ,KAC5B7O,EAAMqe,EAAMnR,KAAK,SAAWmR,EAAMnR,KAAK,cAEvC,SAAEjT,EAAQ,UAAEX,GAAc02B,EAA4BhwB,GAEvD/F,IAIL4I,EAAE+tB,iBAEF,oBAAuC32B,EAAU4I,EAAGvJ,EAAW,MACnE,IA2EAuF,EAAE+M,UAAU8C,GAAG,WAAY,KAAK7L,IAC5BA,EAAE+tB,iBACF/tB,EAAE0b,kBAEF,MAEMiT,EAFQ3yB,EAAEgE,EAAEiK,QAAQ+B,QAAQ,KAEZ3B,KAAK,QAEvBskB,GAAWA,EAAQnvB,WAAW,SAC9BzG,OAAOyE,KAAKmxB,EAAS,SACzB,IAGJ3yB,EAAE+M,UAAU8C,GAAG,YAAa,KAAK7L,IAC7B,GAAgB,IAAZA,EAAE2b,MAKF,OADA3b,EAAE+tB,kBACK,CACX,IAGJ,SACIa,mBAnXJ,SAA4BzxB,GACxB,MAAM0xB,EAAgB,yBAAyBC,KAAK3xB,GAEpD,OAAyB,OAAlB0xB,EAAyB,KAAOA,EAAc,EACzD,EAgXI/R,WA/VJnmB,eAA0BS,EAAUU,EAAU,CAAC,GAC3C,IAAKV,IAAaA,EAASka,OAGvB,OAFApR,SAAS,UAEFlE,EAAE,UAAU6gB,KAAK,kBAGvBzlB,EAASoI,WAAW,UAGrBpI,EAAW,QAAQA,KAGvB,MAAMwrB,OAAsC3jB,IAAxBnH,EAAQ8qB,aAAmC9qB,EAAQ8qB,YACjEmM,OAAwC9vB,IAAzBnH,EAAQi3B,cAAqCj3B,EAAQi3B,aACpElM,OAAwC5jB,IAAzBnH,EAAQ+qB,cAAqC/qB,EAAQ+qB,aACpEb,OAA0C/iB,IAA1BnH,EAAQkqB,eAAsClqB,EAAQkqB,cACtEgN,OAAoD/vB,IAA/BnH,EAAQk3B,oBAA2Cl3B,EAAQk3B,oBAEhF,OAAEn4B,EAAM,aAAE8H,GAAiB,gCAAwCvH,GACnEX,EAAYqB,EAAQrB,WAAa,CAAC,EAClC4B,EAAW5B,EAAU4B,UAAY,UACvC,IAAI42B,EAAYn3B,EAAQ8J,MAExB,IAAKqtB,EACD,GAAiB,gBAAb52B,GAA8B5B,EAAUoL,aAAc,CACtD,MAAMC,QAAmB,wBAAoBrL,EAAUoL,cAEvDotB,EAAYntB,EAAaA,EAAWF,MAAQ,sBAChD,MACIqtB,QAAkB,iBAAyBp4B,EAAQ8H,GAI3D,MAAM/D,QAAa,kBAAc/D,GAEjC,GAAIm4B,GAAsB,CAAC,QAAS,SAAU,WAAWvuB,SAAS7F,EAAKG,OAAsB,YAAb1C,EAAwB,CACpG,MAAMirB,EAAeC,mBAAmB0L,GAExC,OAAOjzB,EAAE,SACJqO,KAAK,MAAO,cAAcxT,KAAUysB,KAAgBnU,KAAKqU,YACzDnZ,KAAK,MAAO4kB,EACrB,CAEA,MAAMjS,EAAahhB,EAAE,UAErB,GAAI6mB,EAAc,CACd,IAAIhF,QAAakP,EAAYl2B,EAAQwB,GAEjCwlB,GACAb,EACK/gB,OAAOD,EAAE,UAAUmf,SAAS,MAAM0C,MAClC5hB,OAAO,IAEpB,CAEA,MAAMsI,EAAOD,EAAc,CACvBlN,WACAX,UAAWA,IAGTy4B,EAAYlzB,EAAE,MAAO,CACvB2H,KAAMY,EACNsY,KAAMoS,IAaV,GAVKrM,GACDsM,EAAU/T,SAAS,sBAGnB6G,GACAkN,EAAU/T,SAAS,kBAGvB6B,EAAW/gB,OAAOizB,GAEdH,EAAc,CACd,MAAMI,QAAiC,8BAAsC/3B,GAE7E,GAAI+3B,EAA0B,CAC1BA,EAAyB/mB,MAEzB,MAAM2B,EAAiBolB,EAAyBnmB,KAAK,KAAKsI,OAEtDvH,GACAiT,EAAW/gB,OAAOD,EAAE,WAAW6gB,KAAK,WAAW,qBAA6B9S,OAEpF,CACJ,CAEA,OAAOiT,CACX,EAqQI2Q,WACAE,cACAuB,uBArGJz4B,eAAsCuV,EAAKvI,EAAO,MAC9C,MAAM6X,EAA2B,MAAnBtP,EAAI,GAAGmjB,QAAkBnjB,EAAMA,EAAIrI,KAAK,KAGtD,KADAF,EAAOA,GAAQ6X,EAAMnR,KAAK,SAGtB,YADAkC,QAAQmhB,KAAK,0BAA4BxhB,EAAI,GAAG+V,WAIpD,MAAM,OAACprB,EAAM,UAAEJ,GAAa02B,EAA4BxpB,GAClD/I,QAAa,kBAAc/D,GAAQ,GAErC+D,GACAsR,EAAIiP,SAASvgB,EAAKgc,iBAGtB,MAAMhV,QAAc8sB,EAAsB/qB,GAG1C,GAFAuI,EAAI2Q,KAAKjb,GAELhH,EAAM,CACN,MAAMijB,QAAakP,EAAYl2B,EAAQJ,EAAU4B,UAEjD6T,EAAIojB,QAAQtzB,EAAE,UAAUmf,SAAS0C,GACrC,CACJ,EA8EI6Q,wBACAa,0BAzDJ,SAAmC5rB,GAC/B,MAAM,OAAC9M,EAAM,UAAEJ,GAAa02B,EAA4BxpB,GACxD,IAAK9M,EACD,MAAO,iBAGX,MAAM+D,EAAO,2BAAuB/D,GACpC,IAAK+D,EACD,MAAO,iBAGX,GAA4B,gBAAxBnE,GAAW4B,UAA8B5B,GAAWoL,aAAc,CAClE,IAAKjH,EAAKqV,YACN,MAAO,qBAGX,MAAMnO,EAAalH,EAAKqV,YAAYpM,MAAKqQ,GAAOA,EAAIrS,eAAiBpL,EAAUoL,eAE/E,OAAOC,EAAaA,EAAWF,MAAQ,sBAC3C,CACI,OAAOhH,EAAKgH,KAEpB,EAoCI0C,gBACA6oB,6EC/WJ,MAEA,EAF2B,IAX3B,MACIlzB,cAEI3C,KAAKwa,WAAa,CAAC,CACvB,CAEA0d,aACIl4B,KAAKwa,WAAa,CAAC,CACvB,2HCPJnb,eAAe84B,EAAW1lB,EAAgBjS,EAAU,CAAC,IACjDA,EAAUuP,OAAOsJ,OAAO,CACpB7Z,UAAU,EACV44B,MAAO,QACPzlB,OAAQ,QACTnS,IAIUkD,aAAgB,oCACzBlD,EAAQkD,aAAc,GAG+B,SAArD,kDACAlD,EAAQ+R,eAAgB,GAGxB/R,EAAQ+R,iBACP/R,EAAQ8J,MAAO9J,EAAQgD,SAsEhC,SAA2B60B,GACvB,MAAMC,EAAM5zB,EAAE6zB,UAAUF,GAExB,OAAIC,EAAI71B,OAAS,GAAK61B,EAAI,GAAGP,SAAWO,EAAI,GAAGP,QAAQ7B,MAAM,WAKlD,CAJOxxB,EAAE4zB,EAAI,IAAI/S,OAER8S,EAAaliB,QAAQmiB,EAAI,GAAG3N,UAAW,KAKhD,CAAC,KAAM0N,EAEtB,CAnF2CG,CAAkBh4B,EAAQi4B,WAAWC,oBAG5E,MAAMrxB,EAAe,qBAA6BoL,GAE7B,YAAjBjS,EAAQiD,MAAuBjD,EAAQgD,UACvChD,EAAQgD,QAAU,yEAOtB,MAAM,KAACF,EAAI,OAAE8iB,SAAgB,SAAY,SAAS/e,qBAAgC7G,EAAQmS,yBAAyBnS,EAAQoS,gBAAkB,KAAM,CAC/ItI,MAAO9J,EAAQ8J,MACf9G,QAAShD,EAAQgD,SAAW,GAC5BE,YAAalD,EAAQkD,YACrBD,KAAMjD,EAAQiD,KACdtD,KAAMK,EAAQL,KACdw4B,eAAgBn4B,EAAQm4B,iBAU5B,GAPIn4B,EAAQ+R,eAER/R,EAAQi4B,WAAWG,wBAGjB,oCAEFp4B,EAAQhB,SAAU,CAClB,MAAMsE,EAAoB,8CACpBA,EAAkBsF,QAAQ,GAAGqJ,KAAkBnP,EAAK/D,UAEpC,UAAlBiB,EAAQ43B,MACR,uBAAwB,sBAAuB,CAACx0B,WAAW,IAEpC,YAAlBpD,EAAQ43B,OACb,uBAAwB,gBAAiB,CAAC34B,MAAOqE,EAAkBrE,OAE3E,CAKA,MAAO,CACH6D,WAJqB,kBAAcA,EAAK/D,QAKxC6mB,OAJiB,oBAAgBA,EAAO/T,UAMhD,CAEAhT,eAAew5B,IACX,OAAO,IAAI5uB,SAAQI,IACf,yBAA0B,iBAAkB,CAACN,SAAUM,GAAK,GAEpE,CA4CA,SACI8tB,aACAW,yBA5CJz5B,eAAwCoT,EAAgBjS,EAAU,CAAC,GAC/D,MAAM,QAAC+F,EAAO,SAAE4hB,EAAQ,eAAEwQ,SAAwBE,IAElD,GAAKtyB,EAOL,OAHA/F,EAAQiD,KAAO0kB,EACf3nB,EAAQm4B,eAAiBA,QAEZR,EAAW1lB,EAAgBjS,EAC5C,EAkCIu4B,iBAhBJ15B,eAAgCE,EAAQkT,GACpC,MAAMpL,EAAe,qBAA6BoL,IAC5C,KAACnP,SAAc,SAAY,SAAS/D,eAAoB8H,WAExD,oCAEoB,wCACR+B,QAAQ,GAAGqJ,KAAkBnP,EAAK/D,UAEpD,MAAMy5B,QAAiB,kBAAcz5B,GACrC,sBAAyB,OAAOy5B,EAAS1uB,cAC7C,EAMIuuB,0ICtGJx5B,eAAe45B,IACX,MAAM/U,EAAQxf,EAAE1E,MAEhB,GAAIkkB,EAAM1P,SAAS,uBAAyB0P,EAAM1P,SAAS,YACvD,OACG,GAAI0P,EAAMxP,QAAQ,oBAAoBjS,OAEzC,OACG,GAAIyhB,EAAMxP,QAAQ,iBAAiBjS,OAEtC,OAGJ,MAAMoD,EAAMqe,EAAMnR,KAAK,SAAWmR,EAAMnR,KAAK,cACvC,SAAEjT,EAAQ,OAAEP,EAAM,UAAEJ,GAAc,gCAAwC0G,GAEhF,IAAK/F,GAAmC,YAAvBX,EAAU4B,SACvB,OAGJ,MAAMm4B,EAAShV,EAAMnR,KAAK,iBAAmB,QAAQ8E,KAAKshB,MAAsB,IAAhBthB,KAAKqU,YAGrE,GAFAhI,EAAMnR,KAAK,eAAgBmmB,GAEvBx0B,EAAE,IAAIw0B,KAAUE,GAAG,YAEnB,OAGJ,MAAM91B,QAAa,kBAAc/D,IAE1BiE,SAAiByG,QAAQwM,IAAI,CAChC4iB,EAAc/1B,GAEd,IAAI2G,SAAQI,GAAO1B,WAAW0B,EAAK,SAGvC,GAAI,sBAAkB7G,GAClB,OAGJ,MAAMmiB,EAAO,qCAAqCniB,UAC5C81B,EAAe,WAAazhB,KAAKshB,MAAsB,UAAhBthB,KAAKqU,UAKlD,GAAIxnB,EAAE1E,MAAM4L,OAAO,UAAUnJ,OAAS,EAAG,CACrCiC,EAAE1E,MAAMgrB,QAAQ,CACZuO,UAAW,OAGXC,UAAW,SACX10B,QAAS,SACT20B,SAAU,SACVnvB,MAAOqb,EACPA,MAAM,EACN+T,SAAU,oCAAoCJ,qFAC9CK,UAAU,EACVC,YAAaV,IAGjBx0B,EAAE1E,MAAMgrB,QAAQ,QAMhB,MAAM6O,EAAe,KACZn1B,EAAE,IAAI40B,KAAgBF,GAAG,YAMzB10B,EAAE1E,MAAM4L,OAAO,UAAUnJ,QAAWiC,EAAE,IAAIw0B,WAAgBz2B,OAI3DkG,WAAWkxB,EAAc,KAFzBn1B,EAAE1E,MAAMgrB,QAAQ,WAPhB/V,QAAQY,IAAI,sBAUhB,EAGJlN,WAAWkxB,EAAc,IAC7B,CACJ,CAEAx6B,eAAeg6B,EAAc/1B,GACzB,IAAKA,EACD,MAAO,qBAGX,MAAMzC,EAAgB,yCAA0CA,cAC1Di5B,EAAex2B,EAAKqb,sBAAsB9d,GAEhD,IAAKi5B,EACD,OAGJ,IAAIt2B,EAAU,yCAAyC,iCAAyCs2B,IAAenlB,KAAK,oBAEpH,MAAM,oBAACqR,SAA6B,2BAAyC1iB,IAEvE,iBAAC4nB,SAA0B,uBAAmC5nB,EAAM,CACtE0nB,SAAS,EACThR,MAAM,IAKV,OAFAxW,EAAU,GAAGA,yCAA+CwiB,EAAoB,GAAG2E,kBAAkBO,EAAiB,GAAGP,YAElHnnB,CACX,CAEA,SACIu2B,mBAnIJ,WACIr1B,EAAE+M,UAAU8C,GAAG,aAAc,IAAK0kB,GAGlCv0B,EAAE+M,UAAU8C,GAAG,SAAS7L,IAChBhE,EAAEgE,EAAEiK,QAAQ+B,QAAQ,iBAAiBjS,QAKzCiC,EAAE,iBAAiBs1B,QAAQ,GAEnC,EAwHIC,oBAtHJ,SAA6BrlB,GACzBA,EAAIL,GAAG,aAAc0kB,EACzB,yECaA,SACIiB,iBAnCJ76B,eAAgCwlB,GAC5B,MAAMhC,EAAQ,CACV,CAAEvY,MAAO,KAAMua,QAASA,EAASphB,KAAM,OAAQwgB,OAAQ,cACvD,CAAE3Z,MAAO,KAAMua,QAASA,EAASphB,KAAM,OAAQwgB,OAAQ,cACvD,CAAE3Z,MAAO,QAASua,QAASA,EAASphB,KAAM,SAAUwgB,OAAQ,mBAC5D,CAAE3Z,MAAO,MAAOua,QAASA,EAASphB,KAAM,cAAewgB,OAAQ,iBAC/D,CAAE3Z,MAAO,OAAQua,QAASA,EAASphB,KAAM,UAAWwgB,OAAQ,iBAC5D,CAAE3Z,MAAO,OAAQua,QAASA,EAASphB,KAAM,SAAUwgB,OAAQ,mBAC3D,CAAE3Z,MAAO,IAAKua,QAASA,EAASphB,KAAM,OAAQwgB,OAAQ,cACtD,CAAE3Z,MAAO,OAAQua,QAASA,EAASphB,KAAM,UAAWwgB,OAAQ,mBAC5D,CAAE3Z,MAAO,KAAMua,QAASA,EAASphB,KAAM,SAAUwgB,OAAQ,aACzD,CAAE3Z,MAAO,OAAQua,QAASA,EAASphB,KAAM,UAAWwgB,OAAQ,oBAG1DkW,QAAwB,QAAW,oBACnCC,QAAsB,mBAAeD,GAE3C,GAAIC,EAAc33B,OAAS,EAAG,CAC1BogB,EAAMvW,KAAK,CAAEhC,MAAO,SAEpB,IAAK,MAAMwT,KAAgBsc,EACvBvX,EAAMvW,KAAK,CACPhC,MAAOwT,EAAaxT,MACpB2Z,OAAQnG,EAAamB,UACrB4F,QAASA,EACTphB,KAAMqa,EAAara,KACnBk1B,eAAgB7a,EAAave,QAGzC,CAEA,OAAOsjB,CACX,yEChCA,SAASwX,EAAU52B,GACf,GAAa,UAATA,GAA6B,gBAATA,EACpB,MAAM,IAAI+J,MAAM,sBAAsB/J,yCAE9C,CAEA,SAAS62B,EAAW72B,EAAMlE,GAGtB,OAFA86B,EAAU52B,GAEH82B,EAAkB,OAAO92B,KAAQlE,aAC5C,CAQA,SAASi7B,EAAS30B,GACV,uBACe,yBAAqB,oBAE7BZ,wBAAwBw1B,YAAY50B,GAE3CpE,OAAOqE,SAASuG,KAAOxG,CAE/B,CAcAxG,eAAeq7B,EAAWj3B,EAAMmpB,EAAUzsB,GAEtC,GADAk6B,EAAU52B,IACL,wBAAsB,kBACvB,OAIJ,IAAIk3B,SADe,SAAY,GAAGl3B,KAAQmpB,sBACtBgO,YACpB,MAAM,KAACpD,GAAQ,yBAAqB,iBAC9BqD,EAAWC,QAAQD,SAEzB,GAAiB,UAAbA,EAAsB,CAEtB,MAAME,EAAY,CAAC,sBAAuB,iBAAkB,UAAW,QAAS,iBAAkB,gBAAiB,OAAQ,aAAc,eACnIC,EAAwBC,IAC1B,MAAMpW,EAAU,GAAGoW,sBAA6BN,MAChD1lB,QAAQY,IAAI,qBAAqBgP,MACjC2S,EAAK3S,GAAS,CAACpe,EAAOy0B,EAAQC,KACtB10B,GACAwO,QAAQxO,MAAM,8CAA8Cw0B,MAAax0B,KACzE20B,EAAeL,EAAUhF,QAAQkF,GAAY,IAE7ChmB,QAAQY,IAAI,sCAAsColB,MAAaC,IACnE,GACF,EAGAE,EAAkBtK,IACpB,MAAMmK,EAAWF,EAAUjK,GAC3B,IAAKmK,EAGD,OAFAhmB,QAAQxO,MAAM,6CACdP,KAAKo0B,EAAW1N,GAAW,CAAC/mB,KAAK,IAGrC2xB,EAAK,SAASyD,KAAY,CAACx0B,EAAOy0B,EAAQC,KAClCD,EAAOlhB,OACPghB,EAAqBC,GAErBG,EAAetK,EAAQ,EAC3B,GACF,EAENsK,EAAe,EACnB,KAAwB,UAAbP,IACwB,IAA3BF,EAAS5E,QAAQ,OAEjB4E,EAAWA,EAASxkB,QAAQ,MAAO,OAGvCqhB,EADgB,0CAA4CmD,GAC9C,CAACU,EAAKH,EAAQC,KACxB,GAAIE,EAGA,OAFApmB,QAAQxO,MAAM,qBAAsB40B,QACpCn1B,KAAKo0B,EAAW1N,GAAW,CAAC/mB,KAAK,GAErC,MAGJoP,QAAQY,IAAI,wEACZ3P,KAAKo0B,EAAW1N,GAAW,CAAC/mB,KAAK,IAEzC,CAeA,SAAS00B,EAAkB10B,GACvB,OAAI,uBAEO,GA0Cf,WACI,MAAMA,EAAM,IAAIy1B,IAAI75B,OAAOqE,SAASuG,MACpC,MAAO,GAAGxG,EAAIE,aAAaF,EAAI01B,YAAY11B,EAAI21B,MACnD,CA7CkBC,MAAa51B,IAIhBA,CAEf,CASAxG,eAAeq8B,EAAej4B,EAAMmpB,EAAUzsB,GAG1C,GAFAk6B,EAAU52B,GAEN,uBAAoB,CACpB,MAAM6C,QAAa,SAAY,GAAG7C,KAAQmpB,qBAEpC+O,EAAW,yBAAqB,kBACpBA,EAASzE,MAAMC,SAAS7wB,EAAKs0B,cAI3Cn5B,OAAOyE,KAAKo0B,EAAW72B,EAAMmpB,GAErC,MApBJ,SAA0BzsB,GACtB,MAAgB,oBAATA,GACAA,EAAK+H,WAAW,UAChB/H,EAAK+H,WAAW,UAChB/H,EAAK+H,WAAW,QAC3B,CAkBY0zB,CAAiBz7B,GAGjBsB,OAAOqE,SAASuG,KAAOiuB,EAAW72B,EAAMmpB,GAFxCnrB,OAAOyE,KA1InB,SAAwBzC,EAAMlE,GAG1B,OAFA86B,EAAU52B,GAEH82B,EAAkB,OAAO92B,KAAQlE,SAC5C,CAsIwBs8B,CAAep4B,EAAMmpB,GAK7C,CAUA,SACI4N,WACAsB,iBA3IJ,SAA0Bv8B,GAGtBi7B,EAFY,GAAGF,EAAW,QAAS/6B,MAAWsX,KAAKC,QAGvD,EAwIIilB,iBA9DJ,SAA0Bx8B,EAAQy8B,GAG9BxB,EAFYD,EAAkB,iBAAiByB,cAGnD,EA2DIC,mBAvIJ,SAA4B1xB,GAGxBiwB,EAFY,GAAGF,EAAW,cAAe/vB,MAAiBsM,KAAKC,QAGnE,EAoIIyjB,oBACA2B,mBAduB78B,MAAOE,EAAQY,UAAeu7B,EAAe,QAASn8B,EAAQY,GAerFg8B,yBAd6B98B,MAAOkL,EAAcpK,UAAeu7B,EAAe,cAAenxB,EAAcpK,GAe7Gi8B,eAvEmB/8B,MAAOE,EAAQY,UAAeu6B,EAAW,QAASn7B,GAwErE88B,qBAvEyBh9B,MAAOkL,EAAcpK,UAAeu6B,EAAW,cAAenwB,gEChD3F,MAEA,EAFgB,IAxDhB,MACI5H,cACI3C,KAAKyvB,mBAAqB,QAAW,WAAWzkB,MAAKkH,GAAQlS,KAAKs8B,KAAKpqB,IAC3E,CAEAoqB,KAAKC,GACDv8B,KAAKu8B,IAAMA,CACf,CAEA9S,IAAI+H,GACA,OAAOxxB,KAAKu8B,IAAI/K,EACpB,CAEAgL,WACI,OAAOzsB,OAAO6lB,KAAK51B,KAAKu8B,IAC5B,CAEAE,QAAQjL,GACJ,IACI,OAAO1lB,KAAK0P,MAAMxb,KAAKu8B,IAAI/K,GAC/B,CACA,MAAO9oB,GACH,OAAO,IACX,CACJ,CAEAg0B,OAAOlL,GACH,OAAOrsB,SAASnF,KAAKu8B,IAAI/K,GAC7B,CAEAmL,SAASnL,GACL,OAAO7Z,WAAW3X,KAAKu8B,IAAI/K,GAC/B,CAEA4H,GAAG5H,GACC,MAAyB,SAAlBxxB,KAAKu8B,IAAI/K,EACpB,CAEAoL,IAAIpL,EAAKpe,GACLpT,KAAKu8B,IAAI/K,GAAOpe,CACpB,CAEA/T,WAAWmyB,EAAKpe,GACZpT,KAAK48B,IAAIpL,EAAKpe,GAEd,MAAMypB,EAAU,CAAC,EACjBA,EAAQrL,GAAOpe,QAET,QAAW,UAAWypB,EAChC,CAEAx9B,aAAamyB,SACHxxB,KAAK88B,KAAKtL,IAAOxxB,KAAKo5B,GAAG5H,IAAMxY,WACzC,iDClBJ,SACIwC,MAtCJ,SAAepI,GACX,MAAM2pB,EAAS3pB,EAAMtK,MAAM,KAAK6C,KAAIE,GAAKA,EAAEmO,SACrCgjB,EAAS,CAAC,EAEhB,IAAK,MAAMC,KAASF,EAChB,GAAc,aAAVE,EACAD,EAAO3b,YAAa,OAEnB,GAAI,CAAC,OAAQ,SAAU,UAAW,OAAQ,WAAY,OAAOlY,SAAS8zB,GACvED,EAAOE,UAAYD,OAElB,GAAI,CAAC,SAAU,SAAS9zB,SAAS8zB,GAClCD,EAAOG,aAAeF,OAErB,GAAIA,EAAM/0B,WAAW,aAAc,CACpC,MAAMk1B,EAASH,EAAMn0B,MAAM,KAE3Bk0B,EAAOK,gBAAkBl4B,SAASi4B,EAAO,GAC7C,MACK,GAAIH,EAAM/0B,WAAW,SAAU,CAChC,MAAMk1B,EAASH,EAAMn0B,MAAM,KAE3Bk0B,EAAOM,cAAgBF,EAAO,EAClC,MACK,GAAIH,EAAM/0B,WAAW,WAAY,CAClC,MAAMk1B,EAASH,EAAMn0B,MAAM,KAE3Bk0B,EAAOO,gBAAkBH,EAAO,EACpC,MAEInoB,QAAQY,IAAI,2CAA4ConB,GAIhE,OAAOD,CACX,qIC1BA,IAAIQ,EAA2B,KAS/B,SAASC,IACL,MAAMC,EAAMh5B,EAAEi5B,WAEd,OAAK,OAAW,kBAKZ,kCACAD,EAAIxzB,SAAQ,IAIZszB,EAA2BE,EAE3B,yBAA0B,uCAGvBA,EAAIvzB,YAdP,yBAA0B,sBACnBuzB,EAcf,CAkDA,SAASrX,EAAU3Z,EAASkxB,EAAiBrY,GACzC,MAAO,CACHe,GAAI5Z,EAAQ+Z,OACZnc,MAAO,GAAGszB,WACVlxB,QAAS6Y,EACTgB,KAAM7Z,EAAQwF,KAAK2rB,QAAU,eAAiB,SAEtD,CAnCA,yBAAuBx+B,UACE,0BAAjBqN,EAAQjJ,YArBhBpE,iBACI,MAAM2pB,EAAajZ,OAAO6lB,KAAK,uBAEzB,kCAGA,sBAAkB5M,GAAY,EACxC,CAec8U,SAEA,uBAAwB,iBAE9B,uBAAwB,2BAExB,yBAA0B,uCAEO,OAA7BN,IACAA,EAAyBtzB,SAAQ,GACjCszB,EAA2B,MAG/B,sBAAyB,eAEH,2BAAjB9wB,EAAQjJ,MACb,4BAAwB,2BAC5B,IAkBJ,yBAAuBpE,UACnB,GAAyB,iBAArBqN,EAAQ8Z,SACR,OAGJ,MAAMoX,EAAkBlxB,EAAQwF,KAAK2rB,QAAU,KAAO,OAEtD,GAAqB,cAAjBnxB,EAAQjJ,KACR,0BAA6BiJ,EAAQ+Z,QACrC,oBAAuB/Z,EAAQA,cAC5B,GAAqB,sBAAjBA,EAAQjJ,KACf,yBAA4B4iB,EAAU3Z,EAASkxB,EAAgB,GAAGA,kBAAgClxB,EAAQga,uBACvG,GAAqB,kBAAjBha,EAAQjJ,KAA0B,CACzC,MAAM+C,EAAQ6f,EAAU3Z,EAASkxB,EAAiB,GAAGA,4BACrDp3B,EAAMmgB,WAAa,IAEnB,yBAA4BngB,EAChC,KAGJ,SACIu3B,YApCJ1+B,eAA2BE,EAAQs+B,EAASG,SAClCP,UAEA,QAAW,SAASl+B,aAAkBs+B,EAAU,EAAI,aAAaG,EAAmB,EAAI,IAClG,EAiCIP,wBACAQ,sBA5GJ5+B,iBACQ,yCACM,2BAEd,EAyGI6+B,sBAxEJ7+B,eAAqC8+B,UACV,SAAY,kBAAmB,CAAEA,SAAUA,KAEpD53B,QAKd,6BAJI,oBAAuB,QAAS,IAKxC,+DC7CA,SAAS63B,IACL,OAAOx5B,KAAKw5B,2BAChB,CAEA/+B,eAAeg/B,IACPD,WACM,SAAY,wBAE1B,CAQA,SACIE,uBA3BJ,WACI15B,KAAKw5B,6BAA8B,EAEnCC,GACJ,EAwBIE,sBAtBJl/B,uBACU,SAAY,mBACtB,EAqBI++B,8BACAC,wBACAG,iCAXJ,SAA0Cl7B,GAClCA,GAAQA,EAAKI,aAAe06B,KAC5BC,GAER,wECAA,SACI/pB,OAxBJjV,eAAsBiE,EAAMsR,GACxB,MACM6pB,EADYn7B,EAAKqc,aAAa,cAE/BhU,KAAIsV,GAAOA,EAAI7N,QACfxH,QAAOrM,GAAUA,IAEtBqV,EAAI+N,QAAQwK,OAAOsR,EAAch8B,OAAS,GAE1C,IAAK,MAAMi8B,KAAgBD,EAAe,CACtC,MAAMp4B,QAAe,SAAY,iBAAiBq4B,KAE5CC,EAAmBj6B,EAAE,SAC3BkQ,EAAIjQ,OAAOg6B,GAEXA,EAAiBh6B,OAAO0B,EAAOsf,MAG/B,wBAA4Btf,EAAQ/C,EAAMq7B,EAC9C,CAEA,OAAOF,EAAch8B,OAAS,CAClC,8NCynBA,QA7mBA,SAA2Bm8B,EAAWC,EAAalW,EAAe,KAAMjD,EAAa,MAgIjF,SAASoZ,EAAcjW,GACnB,OAAKA,EAIEA,EAAOld,KAAIykB,GACG,mBAANA,EACA,gBAAgBA,EAAEpX,aAGlBoX,IARJvH,CAWf,CAxIA7oB,KAAK0lB,WAAaA,EAMlB1lB,KAAK4+B,UAAYA,EAMjB5+B,KAAK6+B,YAAcA,EAMnB7+B,KAAK2oB,aAAeA,EAQpB3oB,KAAKsuB,MAAQA,MAGbtuB,KAAK++B,iBAAmB,IAGxB/+B,KAAKg/B,uBAAyB,IAG9Bh/B,KAAKi/B,YAAc,IASnBj/B,KAAKk/B,aAAe7/B,gBACV,wCAAyC+J,QAAQtJ,EAAS,EASpEE,KAAKm/B,gBAAkB9/B,gBACbsE,EAAA,wCAEA,wCAAyCyF,QAAQtJ,SACjD,uBAAwB,sBAAsB,EAWxDE,KAAKo/B,gBAAkB//B,MAAOS,EAAUN,WAC9BmE,EAAA,wCAEA,iDAAkD7D,EAAU,CAAEN,aAEhEA,SACM,uBAAwB,sBAClC,EAWJQ,KAAKq/B,kBAAoBhgC,MAAOS,EAAUN,WAChCmE,EAAA,kCAEN,MAAMmhB,EAAc,wCAAyCxc,kBACvD,MAAC7I,GAASqlB,EAAYA,EAAYriB,OAAS,SAE3C,yBAA0B,mBAAoB,CAAChD,QAAOK,aAExDN,SACM,uBAAwB,sBAClC,EAiBJQ,KAAKs/B,mBAAqBjgC,UACtB4V,QAAQmhB,KAAK,mKAEb,MAAM,OAAC/0B,KAAWk+B,GAAW93B,EAC7B83B,EAAQl+B,OAASA,EAAO2X,iBAElBzV,EAAA,MAAW,oCAAqCg8B,EAAQ,EAqBlEv/B,KAAKw/B,oBAAsBngC,MAAOogC,EAAM5W,EAAQ6W,KACxB,mBAATD,IACPA,EAAOA,EAAKzmB,YAGhB,MAAMrC,QAAYpT,EAAA,OAAY,cAAe,CACzCqlB,OAAQ6W,EACR5W,OAAQiW,EAAcjW,GACtB8W,YAAaf,EAAUr/B,OACvBqgC,cAAef,EAAYt/B,OAC3BsgC,iBAAkB,QAClBC,eAAgBnX,EAAeA,EAAappB,OAAS,KACrDmgC,iBACD,UAEH,GAAI/oB,EAAIpQ,QAGJ,aAFM5C,EAAA,kCAECgT,EAAIopB,gBAEX,MAAM,IAAIvyB,MAAM,iBAAiBmJ,EAAIlQ,QACzC,EAcJzG,KAAKggC,aAAe3gC,MAAOogC,EAAM5W,EAAS,OACP,kBAA3B4W,GAAM98B,YAAY2Q,MAA4BmsB,GAAMv3B,aAAa,YACjE1B,EAAA,kBAAuB,4OAIdxG,KAAKw/B,oBAAoBC,EAAM5W,GAAQ,IAiBxD7oB,KAAKigC,+CAAiD5gC,MAAOogC,EAAM5W,EAAS,OACzC,aAA3B4W,GAAM98B,YAAY2Q,MAAuBmsB,GAAMv3B,aAAa,cAC5D1B,EAAA,kBAAuB,gKAIdxG,KAAKw/B,oBAAoBC,EAAM5W,GAAQ,IAWxD7oB,KAAKkgC,eAAiB7gC,eACL8gC,EAAA,iBAA6BzgC,GAW9CM,KAAKogC,cAAgB/gC,UACjB,MAAMwZ,QAAc7Y,KAAKkgC,eAAexgC,GAExC,OAAOmZ,EAAMpW,OAAS,EAAIoW,EAAM,GAAK,IAAI,EAU7C7Y,KAAK4Y,QAAUvZ,eAAsBQ,EAAA,gBAAcN,GAanDS,KAAKyc,SAAWpd,MAAO8S,EAAS6e,GAAsB,UAAgBnxB,EAAA,iBAAesS,EAAS6e,GAQ9FhxB,KAAKmxB,YAAc9xB,eAAuBQ,EAAA,oBAAkBsS,GAS5DnS,KAAKqgC,gBAAkB,IAAM5+B,OAAOmD,KAAK07B,aAOzCtgC,KAAKugC,cAAgBt/B,EAAA,sBAOrBjB,KAAKwgC,UAAYv/B,EAAA,kBAQjBjB,KAAKygC,YAAcj6B,EAAA,oBAQnBxG,KAAK0gC,UAAYl6B,EAAA,kBASjBxG,KAAK2gC,eAAiBC,EAAA,OAStB5gC,KAAK6gC,kBAAoBD,EAAA,UAYzB5gC,KAAK8gC,iBAAmBF,EAAA,SASxB5gC,KAAKgI,eAAiB,CAACsL,EAAMpB,IAAS,yBAA0BoB,EAAMpB,GAStElS,KAAKsH,aAAe,CAACgM,EAAMpB,IAAS,uBAAwBoB,EAAMpB,GAelElS,KAAKwlB,WAAa,eAGlBxlB,KAAK+gC,eAAiB,eAQtB/gC,KAAKghC,6BAA+Bzb,GAAQ,yBAA0B,wBAAyB,CAACA,SAMhGvlB,KAAK4N,qBAAuB,IAAM,4CAMlC5N,KAAKmN,iBAAmB,IAAM,wCAM9BnN,KAAKyN,qBAAuB,IAAM,4CAMlCzN,KAAKqN,gBAAkB,IAAM,uCAM7BrN,KAAKsN,oBAAsB,IAAM,2CAQjCtN,KAAKihC,2BAA6B,IAAM,yCAA0CC,gBAQlFlhC,KAAKmhC,2BAA6B,IAAM,yCAA0CC,gBASlFphC,KAAKqhC,0BAA4B,IAAM,IAAIp3B,SAAQC,GAAW,yBAA0B,kCAAmC,CAACH,SAAUG,MAMtIlK,KAAK0N,yBAA2B,IAAM,gDAStC1N,KAAKmV,iBAAmBC,GAAM,2BAA4BA,GAO1DpV,KAAKi6B,oBAAsB,wBAQ3Bj6B,KAAK+9B,YAAc1+B,MAAOE,EAAQs+B,WACxB,gBAAoCt+B,EAAQs+B,GAAS,EAAM,EASrE79B,KAAKshC,eAAiBjiC,MAAOE,EAAQs+B,WAC3B,gBAAoCt+B,EAAQs+B,GAAS,EAAK,EASpE79B,KAAKwuB,aAAe,iBASpBxuB,KAAKmuB,WAAa,eASlBnuB,KAAKyuB,YAAc,gBASnBzuB,KAAK0uB,aAAe,iBASpB1uB,KAAK4uB,YAAc,gBASnB5uB,KAAKgE,iBAAoBzE,IACrB,MAAMuE,EAAoB,wCAEtBA,GACAA,EAAkBE,iBAAiBzE,EACvC,EAWJS,KAAKuhC,mBAAqB,uBAY1BvhC,KAAKwhC,gBAAkB79B,EAAA,gCAQvB3D,KAAKyhC,oBAAsBC,GAAkB,uBAAwB,sBAAuB,CAACniC,OAAQmiC,IASrG1hC,KAAK2hC,aAAe1gC,EAAA,qBAOpBjB,KAAK4hC,WAAa3gC,EAAA,mBAQlBjB,KAAK6hC,eAAiB5gC,EAAA,mBAEtBjB,KAAK8hC,YAAc,CAAC,EACpB9hC,KAAK+hC,iBAAmB,CAAC,EAQzB/hC,KAAK6V,IAAMnJ,IACP,MAAM,OAACnN,GAAUS,KAAK4+B,UAEtBlyB,EAAU,GAAGzL,EAAA,kBAAgByL,IAE7BuI,QAAQY,IAAI,UAAUtW,MAAWmN,KAEjC1M,KAAK8hC,YAAYviC,GAAUS,KAAK8hC,YAAYviC,IAAW,GACvDS,KAAK+hC,iBAAiBxiC,GAAUS,KAAK+hC,iBAAiBxiC,IAAW,IAAI,KAAa,KAC9E,MAAMyiC,EAAWhiC,KAAK8hC,YAAYviC,GAClCS,KAAK8hC,YAAYviC,GAAU,GAE3B,uBAAwB,iBAAkB,CAACA,SAAQyiC,YAAU,GAC9D,KAEHhiC,KAAK8hC,YAAYviC,GAAQ+M,KAAKI,GAC9B1M,KAAK+hC,iBAAiBxiC,GAAQuN,gBAAgB,CAEtD,EChnBA,EA3BAzN,eAA6BsgC,EAAa3W,EAAYL,EAAe,KAAMjD,EAAa,MACpF,MAAMuc,EAAU,CAAC,QAEXpiC,EAAA,2BAEN,MAAM++B,QAAkB/+B,EAAA,gBAAc8/B,GAChCuC,QAAiBriC,EAAA,iBAAempB,GAEtC,MAAO,CACHiZ,QAASA,EACTppB,MAAO5X,EAAA,iBAAeihC,GAAU5+B,GAAQ,CAACA,EAAK/D,OAAQ+D,KACtD6+B,KAAMlhC,EAAA,iBAAeihC,GAAU5+B,GAAQ,CAACA,EAAK/D,OAAQ,IAAI,EAAkBq/B,EAAWt7B,EAAMqlB,EAAcjD,MAC1G0c,QAASC,GACEC,IACH,MAAMC,EAAaL,EAASt2B,QAAOtI,GAAQ++B,EAAcl5B,SAAS7F,EAAK/D,UACjE+D,EAAOi/B,EAAWh2B,MAAK4D,GAAKA,EAAE7F,QAAUg4B,IAE9C,IAAKh/B,EACD,MAAM,IAAIkK,MAAM,8BAA8B80B,KAGlD,OAAOL,EAAQ3+B,EAAK/D,QAAQijC,OAAO,EAInD,wEC1BAnjC,eAAeojC,EAAiB/iC,GAC5B,aAAa,QAAW,UAAUusB,mBAAmBvsB,KACzD,CAQA,SACI+iC,mBACAvC,eARJ7gC,eAA8BK,GAC1B,MAAMyS,QAAgBswB,EAAiB/iC,GAEvC,aAAa,mBAAeyS,EAChC,+DCXe,MAAMuwB,EACjB//B,YAAY2D,GACR,IAAK,MAAMkrB,KAAOlrB,EACdtG,KAAKwxB,GAAOlrB,EAAKkrB,EAEzB,ECFJnyB,eAAesjC,EAAWnQ,GACtB,MAAMhd,SAAoB,wCAAwC6M,QAC5Dve,EAAoB0R,EAAWzB,WAAayB,EAAWzB,WAAW5G,mBAAqB,KAIvFy1B,EAAa,CACf,uBAAwBh+B,KAAKkR,YAC7B,6BAA8B7U,EAAA,2BAC9B,0BAA2B6C,EAAoBA,EAAkBjD,cAAgB,KACjF,eAAgB+D,KAAKC,WAGzB,IAAK,MAAMg+B,KAAcrQ,EACjBA,EAAQqQ,KACRD,EAAWC,GAAcrQ,EAAQqQ,IASzC,OALI5hC,EAAA,uBAEA2hC,EAAWE,OAASrxB,SAASqxB,QAG1BF,CACX,CAyCA,IAAI/X,EAAY,EAChB,MAAMkY,EAAiB,CAAC,EAExB,IAAIC,EAAyB,EAE7B3jC,eAAe0X,EAAKksB,EAAQp9B,EAAKiQ,EAAatV,EAAU,CAAC,GACrD,IAAI8F,EAEJ,MAAMksB,QAAgBmQ,EAAW,CAC7B,uBAAwB7sB,KAEtB,KAAC5D,GAAQ1R,EAEf,GAAIS,EAAA,qBAAoB,CACpB,MAAMiiC,EAAMjiC,EAAA,uBAAqB,YAAY0E,YACvCw9B,EAAYtY,IAElBvkB,QAAa,IAAI2D,SAAQ,CAACC,EAASk5B,KAC/BL,EAAeI,GAAa,CACxBj5B,UACAk5B,SACAC,iBAAkB7iC,EAAQ6iC,gBAG9BH,EAAIt9B,KAAK,iBAAkB,CACvBu9B,UAAWA,EACX3Q,QAASA,EACTyQ,OAAQA,EACRp9B,IAAK,IAAIpE,OAAOmD,KAAK2tB,aAAa1sB,IAClCqM,KAAMA,GACR,GAEV,MAEI5L,QAYR,SAAcT,EAAKo9B,EAAQ/wB,EAAMsgB,EAAS6Q,GACtC,OAAO,IAAIp5B,SAAQ,CAACI,EAAKi5B,KACrB,MAAM9iC,EAAU,CACZqF,IAAKpE,OAAOmD,KAAK2tB,WAAa1sB,EAC9BpC,KAAMw/B,EACNzQ,QAASA,EACTxoB,QAAS,IACTzD,QAAS,CAACg9B,EAAMC,EAAYC,KACxB,MAAMC,EAAc,CAAC,EAErBD,EAAME,wBAAwB3pB,OAAOlR,MAAM,WAAWoH,SAAQ0zB,IAC1D,MAAMC,EAAQD,EAAK96B,MAAM,MACnBg7B,EAASD,EAAME,QACrBL,EAAYI,GAAUD,EAAMnyB,KAAK,KAAK,IAG1CrH,EAAI,CACAk5B,OACA/Q,QAASkR,GACX,EAENj9B,MAAOpH,UACCgkC,GAAmC,MAAjBI,EAAMO,cAGlBC,EAAYhB,EAAQp9B,EAAK49B,EAAMO,OAAQP,EAAM9Q,cAGvD2Q,EAAIG,EAAM9Q,aAAa,GAI/B,GAAIzgB,EAAM,CACN,IACI1R,EAAQ0R,KAAOpG,KAAKC,UAAUmG,EAClC,CAAE,MAAOxJ,GACLuM,QAAQY,IAAI,yBAA0B3D,EAAM,sBAAuBxJ,EACvE,CACAlI,EAAQoyB,YAAc,kBAC1B,CAEAluB,EAAE4tB,KAAK9xB,EAAQ,GAEvB,CAvDqB8xB,CAAKzsB,EAAKo9B,EAAQ/wB,EAAMsgB,IAAWhyB,EAAQ6iC,gBAG5D,MAAMa,EAAuB59B,EAAKksB,QAAQ,gCAM1C,OAJI0R,GAAwBA,EAAqBlqB,SAC7CgpB,EAAyBnrB,KAAKssB,IAAInB,EAAwB79B,SAAS++B,KAGhE59B,EAAKi9B,IAChB,CA+CA,GAAItiC,EAAA,qBAAoB,CAoBpB,SAASmjC,EAAyBC,GAK9B,GAJoC,qBAAhCA,EAAI7R,QAAQ,kBACZ6R,EAAId,KAAOz3B,KAAK0P,MAAM6oB,EAAId,SAGxBc,EAAIlB,aAAaJ,GAEnB,MAAM,IAAIv1B,MAAM,sBAAsB62B,EAAIlB,cAG9CJ,EAAesB,EAAIlB,WAAWj5B,QAAQ,CAClCq5B,KAAMc,EAAId,KACV/Q,QAAS6R,EAAI7R,SAErB,CAjCYvxB,EAAA,uBAAqB,YAAY0E,YAEzC4O,GAAG,mBAAmBlV,MAAOgY,EAAOgtB,KAChCA,EAAIC,YAAc,KAAOD,EAAIC,WAAa,IAC1CF,EAAyBC,IAGF,MAAnBA,EAAIC,YAAsBvB,EAAesB,EAAIlB,YAAYE,sBAGnDY,EAAYI,EAAIpB,OAAQoB,EAAIx+B,IAAKw+B,EAAIC,WAAYD,EAAId,MAG/DR,EAAesB,EAAIlB,WAAWC,OAAO,IAAI51B,MAAM,yBAAyB62B,EAAIC,uBAGzEvB,EAAesB,EAAIlB,UAAU,GAkB5C,CAEA9jC,eAAe4kC,EAAYhB,EAAQp9B,EAAKy+B,EAAYC,GAChD,IAAI73B,EAAU63B,EAEd,GAAwB,iBAAbA,EACP,IAEI73B,GADA63B,EAAWz4B,KAAK0P,MAAM+oB,IACH73B,OACvB,CACA,MAAOhE,GAAI,CAGf,MAAM87B,SAAsB,wCAAsBniB,QAElD,GAAI,CAAC,IAAK,KAAKlZ,SAASm7B,IAAeC,GAAgC,iBAAbA,EAEtD,MADAC,EAAa9D,UAAUh0B,GACjB,IAAIg2B,EAAgB,CACtB+B,WAAY5+B,EACZo9B,SACAqB,gBACGC,IAEJ,CACH,MAAMj6B,EAAQ,GAAGg6B,KAAcrB,KAAUp9B,IACzC2+B,EAAaE,yBAAyBp6B,EAAOoC,GAC7C83B,EAAaG,WAAW,GAAGr6B,OAAWoC,IAC1C,CACJ,CAEA,SACI+c,IAhMJpqB,eAAmBwG,EAAKiQ,GACpB,aAAaiB,EAAK,MAAOlR,EAAKiQ,EAClC,EA+LI8uB,sBArMJvlC,eAAqCwG,EAAKiQ,GACtC,aAAaiB,EAAK,MAAOlR,EAAKiQ,EAAa,CAAEutB,gBAAgB,GACjE,EAoMIwB,KA9LJxlC,eAAoBwG,EAAKqM,EAAM4D,GAC3B,aAAaiB,EAAK,OAAQlR,EAAKiQ,EAAa,CAAE5D,QAClD,EA6LI4yB,IA3LJzlC,eAAmBwG,EAAKqM,EAAM4D,GAC1B,aAAaiB,EAAK,MAAOlR,EAAKiQ,EAAa,CAAE5D,QACjD,EA0LI6yB,MAxLJ1lC,eAAqBwG,EAAKqM,EAAM4D,GAC5B,aAAaiB,EAAK,QAASlR,EAAKiQ,EAAa,CAAE5D,QACnD,EAuLI8nB,OArLJ36B,eAAsBwG,EAAKiQ,GACvB,aAAaiB,EAAK,SAAUlR,EAAKiQ,EACrC,EAoLIkvB,OAlLJ3lC,eAAsBwG,EAAKo/B,GACvB,MAAM7S,EAAW,IAAIC,SAGrB,OAFAD,EAASztB,OAAO,SAAUsgC,SAEbvgC,EAAE4tB,KAAK,CAChBzsB,IAAKpE,OAAOmD,KAAK2tB,WAAa1sB,EAC9B2sB,cAAemQ,IACfzwB,KAAMkgB,EACN3uB,KAAM,MACNuG,QAAS,KACT4oB,aAAa,EACbC,aAAa,GAErB,EAuKI8P,aACAuC,0BAA2B,IAAMlC,+DCrOrC,SAASzB,EAAmB4D,EAAkB7gB,EAASpR,EAAY,MAC/DkyB,EAAe1gC,EAAE+M,UAAW0zB,EAAkB7gB,EAASpR,EAC3D,CAEA,SAASkyB,EAAexwB,EAAKuwB,EAAkB7gB,EAASpR,EAAY,MAChE,GAAI,sBAAmB,CACnBiyB,EAAmBE,EAAkBF,GAErC,IAAIG,EAAY,UAEZpyB,IACAoyB,GAAa,IAAIpyB,IAGjB0B,EAAI2wB,IAAID,IAIRH,GACAvwB,EAAI4wB,KAAKF,EAAWH,GAAkBz8B,IAClC4b,EAAQ5b,GAERA,EAAE+tB,iBACF/tB,EAAE0b,iBAAiB,GAG/B,CACJ,CAKA,SAASihB,EAAkBhS,GACvB,OAAKA,EAIEA,EACF4D,cACA9gB,QAAQ,QAAS,UACjBA,QAAQ,SAAU,OAClBA,QAAQ,WAAY,YACpBA,QAAQ,WAAY,YARdkd,CASf,CAEA,SACIkO,qBACA6D,iBACAK,qBApDJ,SAA8BvyB,GAC1BquB,EAAmB,GAAI,KAAMruB,EACjC,EAmDImyB,mECvDW,MAAMK,EACjB/iC,YAAYgjC,EAASC,EAAiB,KAClC5lC,KAAK2lC,QAAUA,EACf3lC,KAAK6lC,YAAchvB,KAAKC,MACxB9W,KAAK8lC,SAAU,EACf9lC,KAAK4lC,eAAiBA,CAC1B,CAEA94B,iBACS9M,KAAK+lC,kBACN/lC,KAAK8lC,SAAU,EACfn9B,YAAW,IAAM3I,KAAKgmC,kBAE9B,CAEA3mC,6BACI,GAAIW,KAAK8lC,QAAS,CACd9lC,KAAK8lC,SAAU,EAEf,UACU9lC,KAAK2lC,SACf,CACA,MAAOj9B,GAGH,MAFA1I,KAAK8lC,SAAU,EAETp9B,CACV,CACJ,CACJ,CAEAu9B,6BACI,MAAMxwB,GAAYzV,KAAK8lC,QAIvB,OAFA9lC,KAAKyQ,uBAEEgF,CACX,CAEAuwB,gBACShmC,KAAK8lC,UAINjvB,KAAKC,MAAQ9W,KAAK6lC,YAAc7lC,KAAK4lC,gBACrC5lC,KAAK2lC,UACL3lC,KAAK6lC,YAAchvB,KAAKC,MACxB9W,KAAK8lC,SAAU,GAIf9lC,KAAK8M,iBAEb,CAEAzN,+BAA+B0K,GAC3B/J,KAAK+lC,iBAAkB,EAEvB,UACUh8B,GACV,CACA,QACI/J,KAAK+lC,iBAAkB,CAC3B,CACJ,sFC5DJ,SAASv/B,EAAMhG,GACX,MAAM0lC,EAASxhC,EAAE,iKAEgClE,EAAQ+lB,4RA0BzD,OAlBA2f,EAAO35B,KAAK,gBAAgBgZ,KAAK/kB,EAAQ8J,OACzC47B,EAAO35B,KAAK,eAAegZ,KAAK/kB,EAAQkM,SAEpClM,EAAQ8lB,IACR4f,EAAOnzB,KAAK,KAAM,SAASvS,EAAQ8lB,MAGvC5hB,EAAE,oBAAoBC,OAAOuhC,GAE7BA,EAAO1/B,MAAM,CACT2/B,MAAO3lC,EAAQ2lC,OAAS,IACxBC,WAAY5lC,EAAQ4lC,WAGxBF,EAAO3xB,GAAG,mBAAmB7L,GAAKA,EAAEiK,OAAOqnB,WAE3CkM,EAAO1/B,MAAM,QAEN0/B,CACX,CAyCA,SAASxF,EAAUh0B,EAASy5B,EAAQ,KAChClxB,QAAQY,IAAI,gBAAa,UAAWnJ,GAEpClG,EAAM,CACF8D,MAAO,KACPic,KAAM,QACN7Z,QAASA,EACT05B,UAAU,EACVD,SAER,CAoBA,SACI1F,YAjDJ,SAAqB/zB,EAASy5B,EAAQ,KAClClxB,QAAQC,MAAM,gBAAa,WAAYxI,GAEvClG,EAAM,CACF8D,MAAO,KACPic,KAAM,QACN7Z,QAASA,EACT05B,UAAU,EACVD,SAER,EAwCIzF,YACAgE,yBArBJ,SAAkCp6B,EAAOoC,EAASy5B,EAAQ,KACtDlxB,QAAQY,IAAI,gBAAa,UAAWnJ,GAEpClG,EAAM,CACF8D,MAAOA,EACPic,KAAM,QACN7Z,QAASA,EACT05B,UAAU,EACVD,SAER,EAYIE,gBAxCJ,SAAyB35B,EAASy5B,EAAQ,KACtCzF,EAAUh0B,EAASy5B,GAEnB,aAAYz5B,EAChB,EAqCIi4B,WAXJ,SAAoBj4B,GAGhB,MAFA,aAAYA,GAEN,IAAIc,MAAMd,EACpB,EAQI45B,eA3EJ,SAAwB9lC,GACpB,IAAI0lC,EAASxhC,EAAE,UAAUlE,EAAQ8lB,MAE7B4f,EAAOzjC,OAAS,EAChByjC,EAAO35B,KAAK,eAAeoZ,KAAKnlB,EAAQkM,UAGxClM,EAAQ4lC,UAAW,EAEnBF,EAAS1/B,EAAMhG,IAGfA,EAAQmmB,YACRhe,YAAW,IAAMu9B,EAAOlM,UAAUx5B,EAAQmmB,WAElD,EA6DI4f,gBA3DJ,SAAyBjgB,GACrB5hB,EAAE,UAAU4hB,KAAM0T,QACtB,uGChCA36B,eAAemnC,EAA0B1mC,EAAUe,EAAgB,OAAQ4lC,GAAY,GAMnF,GALA,0BAAsB3mC,GAKE,KAFxBA,EAAWA,EAASgJ,MAAM,KAAK,GAAGkR,QAErBvX,OACT,OAAO,KAGX,MAAM+a,EAAO1d,EAASgJ,MAAM,KAAKse,UAE5B5J,EAAKrU,SAAS,SACfqU,EAAKlR,KAAK,QAGd,MAAMo6B,EAAwB,GAC9B,IAAIzrB,EAAc,KACdzL,EAAI,EAER,OACQA,GAAKgO,EAAK/a,SADL,CAKT,MAAM4E,EAAemW,EAAKhO,KAE1B,GAAoB,OAAhByL,EAAsB,CACtB,MAAM9M,QAAc,kBAAc8M,GAAcwrB,GAEhD,IAAKt4B,EAKD,OAJIs4B,GACA,aAAY,mBAAmBxrB,KAG5B,KAGX9M,EAAM4M,cAEN,MAAML,EAAUvM,EAAM4N,iBAEtB,IAAKrB,EAAQjY,OAKT,OAJIgkC,GACA,aAAY,6BAA6BxrB,MAAgB9M,EAAM7D,mBAAmBxK,KAG/E,KAGX,IAAK4a,EAAQ6D,MAAK6R,GAAKA,EAAE7wB,SAAW8H,IAAe,CAC/C,GAAIo/B,EAAW,CACX,MAAMpwB,EAAS,2BAAuBhP,GAEtC4N,QAAQC,MAAM,gBAAa,uBAAuB7N,MAAiBgP,EAASA,EAAO/L,MAAQ,8CAC3E2Q,MAAgB9M,EAAM7D,8BAA8BoQ,EAAQ/O,KAAIykB,GAAK,GAAGA,EAAE7wB,WAAW6wB,EAAE9lB,8FAE3G,CAEA,MAAMwvB,EAAe3rB,EAAMuQ,gBAAgB7d,GAE3C,GAAIi5B,EAAc,CACd,MAAM6M,EAAa7M,EAAa1S,UAAUpW,MAAM,GAEhD,IAAK,MAAMzR,KAAUonC,EACjBD,EAAsBp6B,KAAK/M,EAEnC,CAEA,KACJ,CACJ,CAEAmnC,EAAsBp6B,KAAKjF,GAC3B4T,EAAc5T,CAClB,CAIA,GAFAq/B,EAAsBtf,UAElBsf,EAAsBv9B,SAAStI,GAC/B,OAAO6lC,EAEN,CACD,MAAMpjC,QAAa,kBAAcsjC,EAAiB9mC,IAE5Cg6B,EAAex2B,EAAKob,gBAAgB7d,GAE1C,IAAKi5B,EACD,MAAM,IAAItsB,MAAM,uCAAuClK,EAAK0V,8BAA8BnY,MAI9F,OAAOi5B,EAAa3wB,SAAStI,GAAiBi5B,EAAe4M,CACjE,CACJ,CAkBA,SAASE,EAAiBC,GACtB,IAAKA,EACD,OAAO,KAGX,MAAO/mC,GAAY+mC,EAAc/9B,MAAM,KACjCg+B,EAAWhnC,EAASgJ,MAAM,KAEhC,OAAOg+B,EAASA,EAASrkC,OAAS,EACtC,CAQA,SAASskC,EAA4BF,GACjC,IAAKA,EACD,MAAO,CAAC,EAGZ,MAAO/mC,GAAY+mC,EAAc/9B,MAAM,KAEvC,GAAiB,SAAbhJ,EACA,MAAO,CACHP,OAAQ,OACR8H,aAAc,QAItB,IAAIA,EAAe,OACf9H,EAAS,GAEb,GAAIO,EAAU,CACV,MAAMgnC,EAAWhnC,EAASgJ,MAAM,KAEhCvJ,EAASunC,EAASA,EAASrkC,OAAS,GAEhCqkC,EAASrkC,OAAS,IAClB4E,EAAey/B,EAASA,EAASrkC,OAAS,GAElD,CAEA,MAAO,CACH4E,eACA9H,SAER,CAqBAF,eAAe2nC,EAAaznC,EAAQ8H,EAAe,MAC/C,0BAAsB9H,GAEtB,MAAM+D,QAAa,kBAAc/D,GACjC,IAAK+D,EACD,MAAO,cAGX,IAAI,MAACgH,GAAShH,EAEd,GAAqB,OAAjB+D,EAAuB,CACvB,MAAMgL,EAAW/O,EAAKqX,eAAetT,GAErC,GAAIgL,EAAU,CACV,MAAM+T,EAAS,oBAAgB/T,GAE3B+T,GAAQ7M,SACRjP,EAAQ,GAAG8b,EAAO7M,YAAYjP,IAEtC,CACJ,CAEA,OAAOA,CACX,CAEAjL,eAAe4nC,EAA2BnnC,GACtC,MAAMonC,EAAkB,GAOxB,GALIpnC,EAASoI,WAAW,WACpBpI,EAAWA,EAASk2B,OAAO,IAId,SAAbl2B,EACAonC,EAAgB56B,WAAW06B,EAAalnC,QACrC,CACH,IAAIuH,EAAe,OAEnB,IAAK,MAAM9H,KAAUO,EAASgJ,MAAM,KAChCo+B,EAAgB56B,WAAW06B,EAAaznC,EAAQ8H,IAEhDA,EAAe9H,CAEvB,CAEA,OAAO2nC,CACX,CAnIA,yBAAuBx6B,IACC,aAAjBA,EAAQjJ,OACR,wCAAyCiJ,EAAQnN,QAE7C,yBACsB,yBAAqB,oBAAoB4D,mBAEjDgkC,MAEtB,IA+JH,SACIC,gBAtRJ/nC,eAA+BS,EAAUe,EAAgB,QACrD,MAAMwmC,QAAgBb,EAA0B1mC,EAAUe,GAE1D,OAAOwmC,EAAUA,EAAQ31B,KAAK,KAAO,IACzC,EAmRI80B,4BACAc,yBA/JJ,SAAkCr1B,GAC9B,OAAO,kBAAiCA,IAAgBA,EAAKS,YAAYR,KAAKxO,WAClF,EA8JI6jC,YA1GJ,SAAqBt1B,GACjB,IAAKA,EAED,OADArJ,SAAS,QACF,GAGX,MAAM4U,EAAO,GAEb,KAAOvL,GACCA,EAAKC,KAAK3S,QACVie,EAAKlR,KAAK2F,EAAKC,KAAK3S,QAGxB0S,EAAOA,EAAKS,YAGhB,OAAO8K,EAAK4J,UAAU1V,KAAK,IAC/B,EA0FIk1B,mBACAG,8BACAS,mBApJJnoC,eAAkCwnC,GAC9B,MAAM,OAACtnC,EAAM,aAAE8H,GAAgB0/B,EAA4BF,GAE3D,aAAa,sBAAkBx/B,EAAc9H,EACjD,EAiJIynC,eACAS,iBA5CJpoC,eAAgCS,GAK5B,OAJA,0BAAsBA,UAEEmnC,EAA2BnnC,IAElC4R,KAAK,MAC1B,EAuCIg2B,6BArCJroC,eAA4CS,GACxC,0BAAsBA,GAEtB,MAAMonC,QAAwBD,EAA2BnnC,GAEzD,IAAKonC,GAA8C,IAA3BA,EAAgBzkC,OACpC,MAAO,GAGX,MAAM6H,EAAQ48B,EAAgBA,EAAgBzkC,OAAS,GACjD+a,EAAO0pB,EAAgBl2B,MAAM,EAAGk2B,EAAgBzkC,OAAS,GAEzDklC,EAAiBjjC,EAAE,uCACpBC,OAAOD,EAAE,6BAA6B6gB,KAAKjb,IAOhD,OALIkT,EAAK/a,OAAS,GACdklC,EACKhjC,OAAOD,EAAE,4BAA4B6gB,KAAK,KAAK/H,EAAK9L,KAAK,YAG3Di2B,CACX,EAiBIC,0BAfJ,SAAmC9nC,GAC/B,OAAOA,GAAUqJ,SAAS,eAC9B,gCC3QA,SAAS0+B,EAAOC,GACZ,MAAO,GAAGA,GAAO,EAAI,IAAM,KAAKA,GACpC,CAoDA,SAASvH,EAAcnS,GACnB,MAAO,GAAGA,EAAK2Z,iBAAiBF,EAAOzZ,EAAK4Z,WAAa,MAAMH,EAAOzZ,EAAK6Z,YAC/E,CAcA,SAASC,IACL,SAAUzmC,QAAUA,OAAOq5B,SAAWr5B,OAAOq5B,QAAQr3B,KACzD,CAEA,SAAS0kC,IACL,OAAOC,UAAUvN,SAAS9E,QAAQ,QAAU,CAChD,wBAeA,MAAMsS,EAAY,CACd,IAAK,QACL,IAAK,OACL,IAAK,OACL,IAAK,SACL,IAAK,QACL,IAAK,SACL,IAAK,SACL,IAAK,UAkFT,SAASC,IACD1jC,KAAK2jC,eACL3jC,KAAK2jC,aAAaC,MAAM,QACxB5jC,KAAK2jC,aAAe,KAE5B,CAEA,IAAIE,EAAsB,KAG1B,SAASC,IACLD,EAAsB/jC,EAAE,SAC5B,CAEA,SAASikC,IACL,GAAKF,EAAL,CAIA,GAAIA,EAAoBj0B,SAAS,MAAO,CAIpC,MAAMo0B,EAASH,EACV/zB,QAAQ,wBACRC,KAAK,oBAENi0B,EACAA,EAAOC,QAAQC,KAAK1Q,QAEpBnjB,QAAQY,IAAI,yDAEpB,MACI4yB,EAAoBrQ,QAGxBqQ,EAAsB,IAnBtB,CAoBJ,CAsDA,SAASM,EAAezG,GACpB,MAAuC,oBAA5B,QACA,QAAwBA,GAGxB,QAAQA,EAEvB,CAoCA,MAAM0G,EAAc,yCAEpB,SAASC,EAAS/a,GACd,MAAMgb,EAAWhb,EAAQnb,KAAK,kBAE9B,GAAIm2B,EAAU,CACV,MAAMrjC,EAAMmjC,EAAcE,EAE1BznC,OAAOyE,KAAKL,EAAK,SACrB,CACJ,CAEA,SAASsjC,EAAgBv0B,GAGrBA,EAAIL,GAAG,SAAS7L,IAEZugC,EADoBvkC,EAAEgE,EAAEiK,QAAQ+B,QAAQ,oBACnB,GAE7B,CAMA,MAAM00B,EAAoB,IAAIC,OAAO,sBAAuB,KAoJ5D,GACIC,kBA1fJ,SAA2BC,GACnBA,GACAlY,QAAQ,wBAAwBkY,KAGpC9nC,OAAOqE,SAAS0jC,QACpB,EAqfIhJ,UAnfJ,SAAmBiJ,GACf,IACI,OAAO,IAAI5yB,KAAKA,KAAK2E,MAAMiuB,GAC/B,CACA,MAAO/gC,GACH,MAAM,IAAI8E,MAAM,0BAA0Bi8B,OAAS/gC,EAAEgE,WAAWhE,EAAEiE,QACtE,CACJ,EA6eI4zB,gBACAmJ,eAlbJ,SAAwBtb,GACpB,MAAO,GAbX,SAAoBA,GAIhB,OAAOmS,EAAcnS,EACzB,CAQcub,CAAWvb,MAvDzB,SAAoBA,GAChB,MAAO,GAAGyZ,EAAOzZ,EAAKwb,eAAe/B,EAAOzZ,EAAKyb,eACrD,CAqDkCC,CAAW1b,IAC7C,EAibI2b,mBAjeJ,SAA4BC,GACxB,MAAMC,EAAUpyB,KAAKC,MAAMkyB,EAAK,KAC1BE,EAAUryB,KAAKshB,MAAM8Q,EAAU,IAC/BE,EAAQtyB,KAAKshB,MAAM+Q,EAAU,IAC7BE,EAAOvyB,KAAKshB,MAAMgR,EAAQ,IAC1BE,EAAS,CAACpkB,EAAO3S,IAAS,GAAG2S,KAAS3S,IACtCwzB,EAAW,GAwBjB,OAtBIsD,EAAO,GACPtD,EAASx6B,KAAK+9B,EAAOD,EAAM,MAG3BA,EAAO,IACHD,EAAQ,GAAK,GACbrD,EAASx6B,KAAK+9B,EAAOF,EAAQ,GAAI,OAGjCA,EAAQ,IACJD,EAAU,GAAK,GACfpD,EAASx6B,KAAK+9B,EAAOH,EAAU,GAAI,OAGnCA,EAAU,GACND,EAAU,GAAK,GACfnD,EAASx6B,KAAK+9B,EAAOJ,EAAU,GAAI,QAM5CnD,EAASp1B,KAAK,KACzB,EAmcIkwB,WApYJ,SAAoB0I,GAGhB,OAFAA,EAAOzyB,KAAKssB,IAAItsB,KAAKC,MAAMwyB,EAAO,MAAO,IAE9B,KACA,GAAGA,QAGAzyB,KAAKC,MAAMwyB,EAAO,OAAS,GAA9B,MAEf,EA4XIC,iBAjbJ,WACI,OAAOjc,QAAQC,OAAO,4BAC1B,EAgbIzX,IA9aJ,WACI,MA1DO,GAAG+wB,GADiBzZ,EA2DE,IAAIvX,MA1DX+yB,eAAe/B,EAAOzZ,EAAKyb,iBAAiBhC,EAAOzZ,EAAKoc,gBADlF,IAA+Bpc,CA4D/B,EA6aI8Z,aACAC,QACAsC,UAraJ,SAAmBnU,GACf,OAAS6R,KAAW7R,EAAIhf,SAChB6wB,KAAW7R,EAAIoU,OAC3B,EAmaIC,gBAjaJ,WACI,IAAK,MAAMn7B,KAAKo7B,UACPA,UAAUp7B,IACXyF,QAAQgc,MAAM,gBAAgBzhB,0BAA0Bo7B,UAAUp7B,KAG9E,EA4ZIq7B,WA/YJ,SAAoBpB,GAChB,OAAOA,EAAItzB,QAAQ,gBAAgB20B,GAAKzC,EAAUyC,IACtD,EA8YIC,SAjYJ,SAAkBC,EAAOC,GACrB,MAAM31B,EAAM,CAAC,EAEb,IAAK,MAAMyO,KAAQinB,EAAO,CACtB,MAAOxZ,EAAKpe,GAAS63B,EAAGlnB,GAExBzO,EAAIkc,GAAOpe,CACf,CAEA,OAAOkC,CACX,EAwXIqsB,aAtXJ,SAAsBuJ,GAClB,IAAI3lB,EAAO,GAGX,IAAK,IAAI/V,EAAI,EAAGA,EAAI07B,EAAK17B,IACrB+V,GAHa,iEAGIzG,OAAOjH,KAAKshB,MAAsBgS,GAAhBtzB,KAAKqU,WAG5C,OAAO3G,CACX,EA8WI4D,SA5WJ,WACI,MAA+B,WAAxB1nB,OAAOmD,MAAMwmC,SAEX3pC,OAAOmD,MAAMwmC,QAAU,OAAO/lB,KAAK+iB,UAAUiD,UAC1D,EAyWIC,UAvWJ,WACI,MAA+B,YAAxB7pC,OAAOmD,MAAMwmC,SAEX3pC,OAAOmD,MAAMwmC,SAAW,OAAO/lB,KAAK+iB,UAAUiD,UAC3D,EAoWIE,UA/VJ,SAAmBj4B,EAAMF,GACrB,MACMo4B,EAAU,aADH,IAAI30B,KAAKA,KAAKC,MAAQ,SACD20B,gBAElCh6B,SAASqxB,OAAS,GAAGxvB,KAAQF,GAAS,KAAKo4B,IAC/C,EA2VIE,iBAzVJ,SAA0BjoC,GACtB,MAAO,QAAQA,GACnB,EAwVIkoC,iBAtVJ,SAA0BxrC,GACtB,IAAKA,EACD,MAAO,GAGX,MAAMyrC,EAAezrC,EAAK41B,QAAQ,KAOlC,OALsB,IAAlB6V,IAEAzrC,EAAOA,EAAK61B,OAAO,EAAG4V,IAGnB,QAAQzrC,EAAK82B,cAAc9gB,QAAQ,UAAW,MACzD,EA0UImyB,oBACAuD,WAlSJxsC,eAA0BysC,EAASC,GAAiB,GAC5CA,IACAzD,IACA1jC,KAAK2jC,aAAeuD,GAGxBpD,IAEAoD,EAAQtD,QAERsD,EAAQv3B,GAAG,mBAAmB,KAC1B7P,EAAE,aAAakC,aAAa,SAEvBhC,KAAK2jC,cAAgB3jC,KAAK2jC,eAAiBuD,GAC5CnD,GACJ,WAGkC,+BAAiCtmB,QAChDqR,yBAAyBoY,EACpD,EA+QIpD,qBACAC,oBACAqD,YA/QJ,SAAqBrmB,GACjB,QAAKA,IAEsB,iBAATA,GACd/c,SAAS,8BAA8B+c,iCAChC,IAGXA,EAAOA,EAAKsR,eAEC9tB,SAAS,SACdwc,EAAKxc,SAAS,aAEgC,IAA/CzE,EAAE,SAASihB,KAAKA,GAAMJ,OAAOvL,OAAOvX,QAC/C,EAkQIwpC,kBAhQJ5sC,iBACI,GAAI6oC,IAAc,CACd,MAAM/jC,EAAM4kC,EAAe,oBAAoB5lC,yBACzCgB,EAAIa,YAAYknC,QAAQC,YAClC,CACJ,EA4PIC,yBA1PJ,WACI,MAAM7mB,EAAO9jB,OAAO4qC,eAAerzB,WAC/BovB,UAAU5d,WACV4d,UAAU5d,UAAU8hB,UAAU/mB,EAEtC,EAsPIwjB,iBACAwD,UA5OJ,SAAmBpiC,EAASqiC,EAASC,GACjC,IAAKtiC,IAAYA,EAAQa,KACrB,OAAOb,EAIX,MAAM1D,EAAQ,IAAI+G,MAAMi/B,GAAgB,+BAA+BD,KAEvE,OAAO,IAAIviC,SAAQ,CAACI,EAAKi5B,KACrB,IAAIoJ,GAAW,EAEfviC,EAAQa,MAAK8nB,IACT4Z,GAAW,EAEXriC,EAAIyoB,EAAO,IAGfnqB,YAAW,KACF+jC,GACDpJ,EAAI78B,EACR,GACD+lC,EAAQ,GAEnB,EAsNIG,iBApNJ,SAA0B/3B,GAEtB,MAAMg4B,EAAgBh4B,EAAIrI,KAAK,iCAC/BqgC,EAAcr4B,GAAG,SAAS7L,GAAKA,EAAE0b,oBAGjC+kB,EAAgByD,EACpB,EA8MIzD,kBACAF,WACA4D,oBAzLJ,SAA6Bv5B,GACzB,OAAOA,EAAK6C,QAAQ,oBAAqB,GAC7C,EAwLI22B,qBApLJ,SAA8Bx5B,GAC1B,OAAO81B,EAAkB/jB,KAAK/R,EAClC,EAmLIy5B,MAjLJ,SAAeC,GACX,OAAO,IAAI/iC,SAASC,IAChBvB,WAAWuB,EAAS8iC,EAAQ,GAEpC,EA8KIC,aA5KJ,SAAsBxD,GAClB,OAAOA,EAAItzB,QAAQ,8BAA+B,OACtD,EA2KI+2B,gBAzKJ,WACI,IAAI19B,EAAGqS,EAAGsrB,EAAWC,EAErB,SAASC,EAAiB3pB,EAAGF,GACzB,IAAI4M,EAIJ,GAAIkd,MAAM5pB,IAAM4pB,MAAM9pB,IAAmB,iBAANE,GAA+B,iBAANF,EACxD,OAAO,EAMX,GAAIE,IAAMF,EACN,OAAO,EAMX,GAAkB,mBAANE,GAAiC,mBAANF,GAClCE,aAAa7M,MAAQ2M,aAAa3M,MAClC6M,aAAa2lB,QAAU7lB,aAAa6lB,QACpC3lB,aAAa6pB,QAAU/pB,aAAa+pB,QACpC7pB,aAAathB,QAAUohB,aAAaphB,OACrC,OAAOshB,EAAE1K,aAAewK,EAAExK,WAI9B,KAAM0K,aAAa3T,QAAUyT,aAAazT,QACtC,OAAO,EAGX,GAAI2T,EAAE8pB,cAAchqB,IAAMA,EAAEgqB,cAAc9pB,GACtC,OAAO,EAGX,GAAIA,EAAE/gB,cAAgB6gB,EAAE7gB,YACpB,OAAO,EAGX,GAAI+gB,EAAEiG,YAAcnG,EAAEmG,UAClB,OAAO,EAIX,GAAIwjB,EAAUpX,QAAQrS,IAAM,GAAK0pB,EAAWrX,QAAQvS,IAAM,EACtD,OAAO,EAKX,IAAK4M,KAAK5M,EAAG,CACT,GAAIA,EAAEiqB,eAAerd,KAAO1M,EAAE+pB,eAAerd,GACzC,OAAO,EAEN,UAAW5M,EAAE4M,WAAc1M,EAAE0M,GAC9B,OAAO,CAEf,CAEA,IAAKA,KAAK1M,EAAG,CACT,GAAIF,EAAEiqB,eAAerd,KAAO1M,EAAE+pB,eAAerd,GACzC,OAAO,EAEN,UAAW5M,EAAE4M,WAAc1M,EAAE0M,GAC9B,OAAO,EAGX,cAAgB1M,EAAE0M,IACd,IAAK,SACL,IAAK,WAKD,GAHA+c,EAAU7gC,KAAKoX,GACf0pB,EAAW9gC,KAAKkX,IAEX6pB,EAAiB3pB,EAAE0M,GAAI5M,EAAE4M,IAC1B,OAAO,EAGX+c,EAAUr8B,MACVs8B,EAAWt8B,MACX,MAEJ,QACI,GAAI4S,EAAE0M,KAAO5M,EAAE4M,GACX,OAAO,EAIvB,CAEA,OAAO,CACX,CAEA,GAAIwa,UAAUnoC,OAAS,EACnB,OAAO,EAIX,IAAK+M,EAAI,EAAGqS,EAAI+oB,UAAUnoC,OAAQ+M,EAAIqS,EAAGrS,IAKrC,GAHA29B,EAAY,GACZC,EAAa,IAERC,EAAgBzC,UAAU,GAAIA,UAAUp7B,IACzC,OAAO,EAIf,OAAO,CACX,EAyDIk+B,oBAvDJ,SAA6BlqC,GACzB,MAAMmqC,EAAgB,IAAIC,cAAc,CACpC,YAAa,IAAIC,KAAK,CAACrqC,GAAU,CAACC,KAAM,cACxC,aAAc,IAAIoqC,KAAK,CAACrqC,GAAU,CAACC,KAAM,iBAG7C2kC,UAAU5d,UAAUsjB,MAAM,CAACH,GAC/B,EAiDII,kBA3CJ,SAA2BzqC,GACvB,MAAO,cAAcA,EAAK/D,UAAU0sB,mBAAmB3oB,EAAKgH,oBAAoBuM,KAAKC,OACzF,6FCvfe,MAAMk3B,EACjBrrC,YAAYsrC,GACRjuC,KAAKkuC,SAAW,CAAC,EAEjB,IAAK,MAAM,SAACthB,EAAQ,WAAEuhB,EAAU,OAAEpjB,KAAWkjB,EACrCljB,IACA/qB,KAAKkuC,SAASC,GAAcnuC,KAAKkuC,SAASC,IAAe,GACzDnuC,KAAKkuC,SAASC,GAAYvhB,GAAY7B,GAI9C/qB,KAAKouC,oBAAsB,CAAC,EAC5BpuC,KAAKquC,qBAAuB,CAAC,EAE7BruC,KAAKgwB,WAAa,GAElBhwB,KAAKiwB,cAAgB,GAErBjwB,KAAKsuC,gBAAkB,GAEvBtuC,KAAKuuC,aAAe,GAEpBvuC,KAAKwuC,2BAA6B,GAElCxuC,KAAKyuC,YAAc,GAEnBzuC,KAAKoxB,eAAiB,EAC1B,CAEAznB,aAAawkC,EAAYvhB,GACrB,OAAO5sB,KAAKkuC,SAASC,KAAcvhB,EACvC,CAEA8hB,QAAQnvC,EAAQuW,GACZ9V,KAAKouC,oBAAoB7uC,GAAUS,KAAKouC,oBAAoB7uC,IAAW,GAElES,KAAKouC,oBAAoB7uC,GAAQ4J,SAAS2M,IAC3C9V,KAAKouC,oBAAoB7uC,GAAQ+M,KAAKwJ,GAG1C9V,KAAKquC,qBAAqBv4B,GAAe9V,KAAKquC,qBAAqBv4B,IAAgB,GAE9E9V,KAAKquC,qBAAqBv4B,IAC3B9V,KAAKquC,qBAAqBv4B,GAAaxJ,KAAK/M,EAEpD,CAEAovC,UAAUt8B,EAAUyD,GAChB9V,KAAKgwB,WAAW1jB,KAAK,CAAC+F,WAAUyD,eACpC,CAEA84B,gBACI,OAAO5uC,KAAKgwB,WACPrkB,KAAIyM,GAAOpY,KAAK2J,aAAa,WAAYyO,EAAI/F,YAC7CzG,QAAOwa,KAAYA,GAC5B,CAEAyoB,kBAAkBxnC,EAAcyO,GAC5B9V,KAAKsuC,gBAAgBhiC,KAAKjF,EAC9B,CAEAynC,qBACI,OAAO9uC,KAAKsuC,eAChB,CAEAS,aAAa57B,EAAa2C,GACtB9V,KAAKiwB,cAAc3jB,KAAK,CAAC6G,cAAa2C,eAC1C,CAEAzC,iBAAiByC,EAAc,QAC3B,OAAO9V,KAAKiwB,cACPrkB,QAAOwM,GAAOA,EAAItC,cAAgBA,IAClCnK,KAAIyM,GAAOpY,KAAK2J,aAAa,aAAcyO,EAAIjF,eAC/CvH,QAAOmH,KAAUA,GAC1B,CAEAi8B,YAAYhT,EAAYz8B,EAAQuW,GAC5B9V,KAAKuuC,aAAajiC,KAAK,CAAC0vB,aAAYz8B,SAAQuW,eAChD,CAEAm5B,mBAAmB1vC,GACf,QAASS,KAAKuuC,aAAahiC,MAAK6L,GAAOA,EAAI7Y,SAAWA,GAC1D,CAEA2vC,aACI,OAAOn/B,OAAO6lB,KAAK51B,KAAKouC,oBAC5B,CAEA1kC,eAAenK,EAAQuW,EAAc,MACjC,IAAKvW,EACD,OAAO,EAGX,MAAM4vC,EAAenvC,KAAKouC,oBAAoB7uC,GAC9C,OAAO4vC,QAAkExnC,IAAlDwnC,EAAa5iC,MAAK6iC,GAAOA,IAAQt5B,GAC5D,CAEAu5B,eAAe9vC,EAAQuW,GACnB9V,KAAKwuC,2BAA2BliC,KAAK,CAAC/M,SAAQuW,eAClD,CAEAw5B,sBAAsB/vC,EAAQuW,GAC1B,QAAKvW,GAIES,KAAKwuC,2BAA2BjiC,MAAKsV,GAAKA,EAAEtiB,SAAWA,GAAUsiB,EAAE/L,cAAgBA,GAC9F,CAEAy5B,UAAUj8B,GACNtT,KAAKyuC,YAAYniC,KAAKgH,EAC1B,CAEAk8B,iBAAiBl8B,GACb,OAAOtT,KAAKyuC,YAAYtlC,SAASmK,EACrC,CAEAm8B,iBACI,OAAOzvC,KAAKyuC,WAChB,CAEAiB,iBAAiBllC,GACbxK,KAAKoxB,eAAe9kB,KAAK9B,EAC7B,CAEAmlC,oBACI,OAAO3vC,KAAKoxB,cAChB,CAMAwe,6BACI,OAAO5vC,KAAKgwB,WAAWvtB,OAAS,GACzBzC,KAAKiwB,cAAcxtB,OAAS,CACvC,CAEA8E,UACI,OAAwD,IAAjDwI,OAAO6lB,KAAK51B,KAAKouC,qBAAqB3rC,QACX,IAA3BzC,KAAKgwB,WAAWvtB,QACc,IAA9BzC,KAAKiwB,cAAcxtB,QACa,IAAhCzC,KAAKsuC,gBAAgB7rC,QACQ,IAA7BzC,KAAKuuC,aAAa9rC,QACyB,IAA3CzC,KAAKwuC,2BAA2B/rC,QACJ,IAA5BzC,KAAKyuC,YAAYhsC,QACc,IAA/BzC,KAAKoxB,eAAe3uB,MAC/B,CAEAotC,iBACI,OAAwD,IAAjD9/B,OAAO6lB,KAAK51B,KAAKouC,qBAAqB3rC,QACX,IAA3BzC,KAAKgwB,WAAWvtB,QACc,IAA9BzC,KAAKiwB,cAAcxtB,QACa,IAAhCzC,KAAKsuC,gBAAgB7rC,MAChC,wDCtEJ,SAASqtC,EAAkBrmC,EAAasmC,GACpC,MAAMzsC,EAAOzD,EAAA,cAAYkwC,EAAGnjB,UAE5B,GAAKtpB,EAQL,GAFAmG,EAAYilC,QAAQqB,EAAGnjB,SAAUmjB,EAAGj6B,aAEhCi6B,EAAGC,UAAYD,EAAGnjB,YAAY/sB,EAAA,cAC9BoB,EAAA,0BAAwB,GAAG8uC,EAAG5B,eAAe4B,EAAGnjB,yDAIpD,GAAImjB,EAAGC,UAAYD,EAAGhlB,QAAQnhB,iBACnB/J,EAAA,cAAYkwC,EAAGnjB,cAErB,CACD,GAAItpB,EAAKuX,SAAWk1B,EAAGhlB,OAAOlQ,OAAQ,CAClC,IAAK,MAAM2W,KAAOzhB,OAAO6lB,KAAK/1B,EAAA,sBACtB2xB,EAAIroB,SAAS7F,EAAK/D,gBACXM,EAAA,qBAAmB2xB,GAIlC/nB,EAAY4lC,eAAe/rC,EAAK/D,OAAQwwC,EAAGj6B,YAC/C,CAEAxS,EAAK+U,OAAO03B,EAAGhlB,OACnB,CACJ,CAEA1rB,eAAe4wC,EAAoBxmC,EAAasmC,GAC5C,GAAIA,EAAGC,UAAYD,EAAGnjB,YAAY/sB,EAAA,iBAE9B,YADAoB,EAAA,0BAAwB,GAAG8uC,EAAG5B,eAAe4B,EAAGnjB,oDAIpD,IAAIxG,EAASvmB,EAAA,iBAAekwC,EAAGnjB,UAE/B,GAAImjB,EAAGC,UAAYD,EAAGhlB,QAAQnhB,UAAW,CACrC,GAAIwc,EAAQ,CACR,MAAMiF,EAAYxrB,EAAA,cAAYumB,EAAO7mB,QAC/B0d,EAAapd,EAAA,cAAYumB,EAAO/e,cAElCgkB,IACAA,EAAU3Q,QAAU2Q,EAAU3Q,QAAQ9O,QAAOvE,GAAgBA,IAAiB+e,EAAO/e,sBAC9EgkB,EAAU1Q,eAAeyL,EAAO/e,eAGvC4V,IACAA,EAAW7R,SAAW6R,EAAW7R,SAASQ,QAAOqP,GAAeA,IAAgBmL,EAAO7mB,gBAChF0d,EAAWrC,cAAcwL,EAAO7mB,SAG3CkK,EAAYklC,UAAUoB,EAAGnjB,SAAUmjB,EAAGj6B,oBAE/BjW,EAAA,iBAAekwC,EAAGnjB,SAC7B,CAEA,MACJ,CAEAnjB,EAAYklC,UAAUoB,EAAGnjB,SAAUmjB,EAAGj6B,aAEtC,MAAMuV,EAAYxrB,EAAA,cAAYkwC,EAAGhlB,OAAOxrB,QACxC,IAAI0d,EAAapd,EAAA,cAAYkwC,EAAGhlB,OAAO1jB,eAEnCgkB,GAAcA,EAAUrN,UAAaf,IAKrCA,QAAmBpd,EAAA,gBAAckwC,EAAGhlB,OAAO1jB,eAG3C+e,EACAA,EAAO/N,OAAO03B,EAAGhlB,SAEZM,GAAapO,KAClBpd,EAAA,iBAAekwC,EAAGnjB,UAAYxG,EAAS,IAAI,IAAQvmB,EAAA,QAAOkwC,EAAGhlB,SAG7DM,GACAA,EAAUvQ,UAAUsL,EAAO/e,aAAc+e,EAAO/T,UAGhD4K,GACAA,EAAWjC,SAASoL,EAAO7mB,OAAQ6mB,EAAO/T,SAElD,CAEA,SAAS69B,EAAsBzmC,EAAasmC,GACxC,MAAMI,EAAsB,IAAIr2B,IAEhC,IAAK,MAAMzH,KAAY09B,EAAGK,UAAW,CACjC,MAAMhqB,EAASvmB,EAAA,iBAAewS,GAE1B+T,IACAA,EAAO9M,aAAey2B,EAAGK,UAAU/9B,GAEnC89B,EAAoB/1B,IAAIgM,EAAO/e,cAEvC,CAEA,IAAK,MAAMA,KAAgB8oC,EAAqB,CAC5C,MAAMlzB,EAAapd,EAAA,cAAYwH,GAE3B4V,GACAA,EAAW/B,cAEnB,CAEAzR,EAAYolC,kBAAkBkB,EAAGnjB,SAAUmjB,EAAGj6B,YAClD,CAEA,SAASu6B,EAAuB5mC,EAAasmC,GACzC,IAAI/qB,EAAYnlB,EAAA,mBAAiBkwC,EAAGnjB,UAEpC,GAAImjB,EAAGC,UAAYD,EAAGnjB,YAAY/sB,EAAA,mBAE9B,YADAoB,EAAA,0BAAwB,GAAG8uC,EAAG5B,eAAe4B,EAAGnjB,oDAIpD,GAAImjB,EAAGC,UAAYD,EAAGhlB,QAAQnhB,UAAW,CACrC,GAAIob,EAAW,CACX,MAAMsrB,EAAazwC,EAAA,cAAYmlB,EAAUzlB,QACnCgxB,EAAgC,aAAnBvL,EAAUvhB,MAAuB5D,EAAA,cAAYmlB,EAAU5R,OAEtEk9B,IACAA,EAAW91B,WAAa81B,EAAW91B,WAAW5O,QAAOuH,GAAeA,IAAgB6R,EAAU7R,eAG9Fod,IACAA,EAAW9V,gBAAkB8V,EAAW9V,gBAAgB7O,QAAOuH,GAAeA,IAAgB6R,EAAU7R,eAG5G1J,EAAYslC,aAAagB,EAAGnjB,SAAUmjB,EAAGj6B,oBAElCjW,EAAA,mBAAiBkwC,EAAGnjB,SAC/B,CAEA,MACJ,CAEAnjB,EAAYslC,aAAagB,EAAGnjB,SAAUmjB,EAAGj6B,aAEzC,MAAMw6B,EAAazwC,EAAA,cAAYkwC,EAAGhlB,OAAOxrB,QACnCgxB,EAAgC,aAAnBwf,EAAGhlB,OAAOtnB,MAAuB5D,EAAA,cAAYkwC,EAAGhlB,OAAO3X,OAEtE4R,EACAA,EAAU3M,OAAO03B,EAAGhlB,SACbulB,GAAc/f,KACrBvL,EAAY,IAAI,IAAWnlB,EAAA,QAAOkwC,EAAGhlB,QAErClrB,EAAA,mBAAiBmlB,EAAU7R,aAAe6R,EAEtCsrB,IAAeA,EAAW91B,WAAWrR,SAAS6b,EAAU7R,cACxDm9B,EAAW91B,WAAWlO,KAAK0Y,EAAU7R,aAGrCod,IAAeA,EAAW9V,gBAAgBtR,SAAS6b,EAAU7R,cAC7Dod,EAAW9V,gBAAgBnO,KAAK0Y,EAAU7R,aAGtD,CAEA,SAASo9B,EAAkB9mC,EAAasmC,GACpC,GAAIA,EAAGC,UAAYD,EAAGnjB,YAAY/sB,EAAA,oBAE9B,YADAoB,EAAA,0BAAwB,GAAG8uC,EAAG5B,eAAe4B,EAAGnjB,oDAIpD,MAAMpiB,EAAa3K,EAAA,oBAAkBkwC,EAAGnjB,UAExC,GAAImjB,EAAGC,UAAYD,EAAGhlB,QAAQnhB,WAC1B,GAAIY,EAAY,CACZ,MAAMlH,EAAOkH,EAAWoO,UAEpBtV,GAAQA,EAAKqV,cACbrV,EAAKqV,YAAcrV,EAAKqV,YAAY/M,QAAOgR,GAAOA,EAAIrS,eAAiBC,EAAWD,gBAGtFd,EAAYimC,iBAAiBK,EAAGhlB,eAEzBlrB,EAAA,oBAAkBkwC,EAAGnjB,SAChC,MAXJ,CAgBA,GAAIpiB,EACAA,EAAW6N,OAAO03B,EAAGhlB,YAClB,CACH,MAAMznB,EAAOzD,EAAA,cAAYkwC,EAAGhlB,OAAOzS,SAE/BhV,GAAMqV,aACNrV,EAAKqV,YAAYrM,KAAK,IAAI,IAAYzM,EAAA,QAAOkwC,EAAGhlB,QAExD,CAEAthB,EAAYimC,iBAAiBK,EAAGhlB,OAZhC,CAaJ,CAEA,SACIylB,qBA1RJnxC,eAAoC4uC,GAChC,MAAMxkC,EAAc,IAAIukC,EAAYC,GAEpC,IAAK,MAAM8B,KAAM9B,EACb,IACI,GAAsB,UAAlB8B,EAAG5B,WACH2B,EAAkBrmC,EAAasmC,QAC5B,GAAsB,aAAlBA,EAAG5B,iBACJ8B,EAAoBxmC,EAAasmC,QACpC,GAAsB,eAAlBA,EAAG5B,WACVkC,EAAuB5mC,EAAasmC,QACjC,GAAsB,oBAAlBA,EAAG5B,WACV+B,EAAsBzmC,EAAasmC,QAChC,GAAsB,cAAlBA,EAAG5B,WACV1kC,EAAYulC,YAAYe,EAAGnjB,SAAUmjB,EAAGxwC,OAAQwwC,EAAGj6B,kBAChD,GAAsB,YAAlBi6B,EAAG5B,WAA0B,CACpC,GAAuB,qBAAnB4B,EAAGhlB,OAAOzX,KACV,SAGJ9S,EAAA,MAAYuvC,EAAGhlB,OAAOzX,KAAMy8B,EAAGhlB,OAAO3X,OAEtC3J,EAAY8lC,UAAUQ,EAAGhlB,OAAOzX,KACpC,MAAO,GAAsB,gBAAlBy8B,EAAG5B,WACVoC,EAAkB9mC,EAAasmC,QAC5B,GAAsB,UAAlBA,EAAG5B,YAA4C,iBAAlB4B,EAAG5B,WAIvC,MAAM,IAAI3gC,MAAM,uBAAuBuiC,EAAG5B,cAElD,CACA,MAAOzlC,GACH,MAAM,IAAI8E,MAAM,wBAAwB1B,KAAKC,UAAUgkC,iBAAkBrnC,EAAEgE,WAAWhE,EAAEiE,QAC5F,CAQJ,MAAMukB,EAAiB,GAEvB,IAAK,MAAM,WAACid,EAAU,OAAEpjB,KAAWkjB,EAC1BljB,IAIc,aAAfojB,GAA+BpjB,EAAO1jB,gBAAgBxH,EAAA,cAGlC,eAAfsuC,GACc,aAAhBpjB,EAAOtnB,MACU,aAAhBsnB,EAAOzX,MAAuC,YAAhByX,EAAOzX,MACpCyX,EAAO3X,SAASvT,EAAA,eAErBqxB,EAAe5kB,KAAKye,EAAO3X,OAP3B8d,EAAe5kB,KAAKye,EAAO1jB,eAenC,GAJI6pB,EAAezuB,OAAS,SAClB5C,EAAA,oBAAkBqxB,IAGvBznB,EAAYlC,UAAW,CACpBkC,EAAYmmC,8BACZ,iBAGJ,MAAMp6B,SAAoB,wCAAwC6M,cAC5D7M,EAAWlO,aAAa,mBAAoB,CAACmC,eACvD,CACJ,iBC3EA,MAAMgnC,EAAkB,GAExB,IAAI9sC,EAIA+sC,EAHAC,EAA6BlvC,OAAOmD,KAAKgsC,wBACzCC,EAAiCpvC,OAAOmD,KAAKksC,4BAC7CC,EAA8BtvC,OAAOmD,KAAKgsC,wBAE1CI,EAA0B,GAE9B,SAASpoC,EAAS8D,GACduI,QAAQxO,MAAMxF,EAAA,cAAayL,GAEvB/I,GAAwB,IAAlBA,EAAGstC,YACTttC,EAAGiC,KAAKkG,KAAKC,UAAU,CACnBtI,KAAM,YACNgD,MAAOiG,EACPC,OAAO,IAAIa,OAAQb,QAG/B,CAaAlL,OAAOmH,SAAWA,EAClBnH,OAAO4vB,QAZP,SAAiB3kB,GACbuI,QAAQY,IAAI5U,EAAA,cAAayL,GAErB/I,GAAwB,IAAlBA,EAAGstC,YACTttC,EAAGiC,KAAKkG,KAAKC,UAAU,CACnBtI,KAAM,WACNurB,KAAMtiB,IAGlB,EAUA,IAAIwkC,EAAsB,KAG1B,MAAMC,EAA2B,IAAIr3B,IAiDrCza,eAAe+xC,EAAc/5B,GACzB,MAAM3K,EAAUZ,KAAK0P,MAAMnE,EAAMnF,MAEjC,IAAK,MAAMm/B,KAAkBZ,EACzBY,EAAe3kC,GAGnB,GAAqB,SAAjBA,EAAQjJ,KACRitC,EAAa75B,KAAKC,WAEjB,GAAqB,oBAAjBpK,EAAQjJ,KACbxC,EAAA,0BAAwB,yDAEvB,GAAqB,oBAAjByL,EAAQjJ,WAlDrBpE,eAAqC4uC,GAGjC,GAFAyC,EAAa75B,KAAKC,MAEdm3B,EAAcxrC,OAAS,EAAG,EAblC,SAAiBwrC,GACb,MAAMqD,EAAerD,EAAcriC,QAAOwM,IACrC+4B,EAAyBh3B,IAAI/B,EAAIkO,MACX,YAAnBlO,EAAI+1B,YAA6C,qBAAjB/1B,EAAIwU,YAExC0kB,EAAa7uC,OAAS,GACtBwS,QAAQC,MAAMjU,EAAA,cAAa,yBAA0BqwC,EAE7D,CAMQC,CAAQtD,GAER+C,EAAwB1kC,QAAQ2hC,GAIhC,IAAK,MAAMuD,KAAgBvD,EACvB0C,EAA6B94B,KAAKssB,IAAIwM,EAA4Ba,EAAalrB,IAE3EkrB,EAAaC,WACbZ,EAAiCh5B,KAAKssB,IAAI0M,EAAgCW,EAAalrB,KAO/F,IAHAorB,IAGOR,SACGA,EAGV,IAEIA,EAiFZ7xC,iBACI,GAAI2xC,EAAwBvuC,OAAS,EAAG,CACpC,MAAMkvC,EAAmBX,EACzBA,EAA0B,GAE1B,MAAMY,EAA4BD,EAAiB/lC,QAAOmkC,IAAOoB,EAAyBh3B,IAAI41B,EAAGzpB,MAEjG,UACUrlB,EAAA,kBAAgB,uBAAkC2wC,GAA4B,IACxF,CACA,MAAOlpC,GACHE,EAAS,QAAQF,EAAEgE,YAAYhE,EAAEiE,kBAE5B/H,KAAKqS,OAAUzW,EAAA,KAAW,qBAM3ByU,QAAQY,IAAI,gDAAiD+7B,GAE7DprC,EAAA,kBAAuB,sBAAsBkC,EAAEgE,qCAL/CzL,EAAA,2BAOR,CAEA,IAAK,MAAMuwC,KAAgBI,EACvBT,EAAyB/2B,IAAIo3B,EAAalrB,IAE1CyqB,EAA8Bl5B,KAAKssB,IAAI4M,EAA6BS,EAAalrB,GAEzF,CAzCAurB,EACKjmC,QAAOiW,GAAKA,EAAEiwB,uBAAyBf,IACvC7gC,SAAQ2R,GAAKA,EAAEkwB,mBAEpBF,EAAiCA,EAC5BjmC,QAAOiW,GAAKA,EAAEiwB,sBAAwBf,IAE3Cc,EAA+BjmC,QAAOiW,GAAKhL,KAAKC,MAAQ+K,EAAEmwB,MAAQ,MAC7D9hC,SAAQ2R,GAAK5M,QAAQY,IAAI,8BAA8BgM,EAAEiwB,iDAAiDf,oBAA8CJ,UAAmC94B,KAAKshB,OAAOtiB,KAAKC,MAAQ+K,EAAEmwB,OAAS,UAoCxO,CAlHkCC,SAEhBf,CACV,CAAE,QAEEA,EAAsB,IAC1B,CACJ,CACJ,CAgBcgB,CAAsBxlC,EAAQwF,KAAK+7B,oBAExC,GAAqB,2BAAjBvhC,EAAQjJ,KACb+C,EAAA,kBAAuB,UAAW,UAEjC,GAAqB,8BAAjBkG,EAAQjJ,KACb+C,EAAA,kBAAuB,mBAAoB,UAE1C,GAAqB,qBAAjBkG,EAAQjJ,KACb,uBAAwB,iBAAkB,CAAClE,OAAQmN,EAAQnN,OAAQyiC,SAAUt1B,EAAQs1B,gBAEpF,GAAqB,UAAjBt1B,EAAQjJ,KACb+C,EAAA,oBAAyBkG,EAAQA,cAEhC,GAAqB,mBAAjBA,EAAQjJ,KAA2B,CACxC,MAAM2e,SAAuB,uCAAiCC,QACxDxiB,SAAe,wCAAgCwiB,QAC/CsG,EAAejc,EAAQozB,qBAAuBjgC,EAAM+Y,QAAQlM,EAAQozB,gBAAkB,KAE5F1d,EAAcE,oBAAoB5V,EAAQkzB,cAAejX,EAAcjc,EAAQkc,OAAQlc,EAAQmc,OACnG,CACJ,CAEA,IAAIgpB,EAAiC,GAqErC,SAASM,IACL,MAAMC,EAAM3wC,OAAOqE,SACbusC,EAAe,GAAoB,WAAjBD,EAAIrsC,SAAwB,OAAS,UAAUqsC,EAAIpsC,OAAOosC,EAAInsC,WAGhFtC,EAAK,IAAI2uC,UAAUD,GAKzB,OAJA1uC,EAAG4uC,OAAS,IAAMt9B,QAAQC,MAAMjU,EAAA,cAAa,uBAAuBoxC,oBACpE1uC,EAAG6uC,UAAYpB,EAGRztC,CACX,CAEAtE,eAAeqyC,IACP76B,KAAKC,MAAQ45B,EAAa,KAC1Bz7B,QAAQY,IAAI5U,EAAA,cAAa,6LAGzB0C,EAAGstC,aAAettC,EAAG8uC,KACrB9uC,EAAGiC,KAAKkG,KAAKC,UAAU,CACnBtI,KAAM,OACNivC,mBAAoB/B,KAGnBhtC,EAAGstC,aAAettC,EAAGgvC,QAAUhvC,EAAGstC,aAAettC,EAAGivC,UACzD39B,QAAQY,IAAI5U,EAAA,cAAa,6CAEzB0C,EAAKwuC,IAEb,CAEAxpC,YAAW,KACPhF,EAAKwuC,IAELzB,EAAa75B,KAAKC,MAElB+7B,YAAYnB,EAAU,IAAK,GAC5B,GAEH,SACI9oC,WACAkqC,oBA5MJ,SAA6BzB,GACzBZ,EAAgBnkC,KAAK+kC,EACzB,EA2MI0B,8BA7FJ,WACI,OAjB2BjB,EAiBEvuC,EAAA,gCAhBAwtC,EAClB9mC,QAAQC,WAGnB+K,QAAQC,MAAM,eAAe48B,wBAA4Cf,oBAA8CJ,KAEhH,IAAI1mC,SAAQ,CAACI,EAAKi5B,KACrBuO,EAA+BvlC,KAAK,CAChCwlC,sBAAuBA,EACvBC,eAAgB1nC,EAChB2nC,MAAOn7B,KAAKC,OACf,KAZT,IAA+Bg7B,CAkB/B,EA4FIkB,8BAA+B,IAAMnC,aCxPzC,SAASoC,EAAoBC,GAC5B,IAAIxqC,EAAI,IAAI8E,MAAM,uBAAyB0lC,EAAM,KAEjD,MADAxqC,EAAEyqC,KAAO,mBACHzqC,CACP,CACAuqC,EAAoBrd,KAAO,IAAM,GACjCqd,EAAoB/oC,QAAU+oC,EAC9BA,EAAoB3sB,GAAK,KACzB8sB,EAAO5Q,QAAUyQ,8DCAjB,MAAMhU,UAAoB,IACtBt8B,cACIC,QAEA5C,KAAKod,MAAQ,CACTi2B,MAAO,IAEXrzC,KAAKszC,QAAU,GAEftzC,KAAKoL,SAAW,GAChBpL,KAAKuzC,qBAAuB,EAChC,CAEAplC,SAASsF,GACL,IAAKA,EACD,OAAOzT,KAGX4C,MAAMuL,SAASsF,GAEf,IAAK,MAAMQ,KAAaR,OACO9L,IAAvBsM,EAAU/E,WACV+E,EAAU/E,SAAWlP,KAAKuzC,qBAC1BvzC,KAAKuzC,sBAAwB,IAMrC,OAFAvzC,KAAKoL,SAASqE,MAAK,CAACC,EAAGC,IAAMD,EAAER,SAAWS,EAAET,WAErClP,IACX,CAEAsmB,GAAGA,GAEC,OADAtmB,KAAKod,MAAMkJ,GAAKA,EACTtmB,IACX,CAEAslB,MAAMpL,GAEF,OADAla,KAAKszC,QAAQhnC,KAAK4N,GACXla,IACX,CAEA2jB,IAAIrQ,EAAMF,GAEN,OADApT,KAAKod,MAAMi2B,OAAS,GAAG//B,MAASF,KACzBpT,IACX,CAEAwzC,eAGI,OAFAxzC,KAAK2jB,IAAI,UAAW,QAEb3jB,IACX,CAEAyzC,cAGI,OAFAzzC,KAAK2jB,IAAI,aAAc,KACvB3jB,KAAK2jB,IAAI,YAAa,KACf3jB,IACX,CAEA0zC,UAEI,OADA1zC,KAAK2jB,IAAI,YAAa,KACf3jB,IACX,CAOA2zC,SAASC,GAEL,OADA5zC,KAAK6zC,MAAQD,EACN5zC,IACX,CAEAsU,SAYI,GAXAtU,KAAK8zC,WAEL9zC,KAAKwiB,QAAQzP,KAAK,oBAAqB/S,KAAK8V,aAC5C9V,KAAKwiB,QACAqB,SAAS,aACTlP,KAAK,YAAa3U,MAElBA,KAAK+zC,aACN/zC,KAAKg0C,WAAU,GAGfh0C,KAAK6zC,MAAO,CACZ,MAAMlwB,EAAM3jB,KAAK6zC,MAAM75B,OAAO9R,WAAW,WAAalI,KAAK6zC,MAAQ,UAAU7zC,KAAK6zC,gBAElF7zC,KAAKwiB,QAAQ7d,OAAOgf,EACxB,CAEA,IAAK,MAAM6N,KAAOxxB,KAAKod,MACnB,GAAY,UAARoU,GACA,GAAIxxB,KAAKod,MAAMoU,GAAM,CACjB,IAAI6hB,EAAQrzC,KAAKwiB,QAAQzP,KAAK,SAC9BsgC,EAAQA,EAAQ,GAAGA,MAAUrzC,KAAKod,MAAMoU,KAASxxB,KAAKod,MAAMoU,GAE5DxxB,KAAKwiB,QAAQzP,KAAKye,EAAK6hB,EAC3B,OAGArzC,KAAKwiB,QAAQzP,KAAKye,EAAKxxB,KAAKod,MAAMoU,IAI1C,IAAK,MAAMtX,KAAala,KAAKszC,QACzBtzC,KAAKwiB,QAAQqB,SAAS3J,GAG1B,OAAOla,KAAKwiB,OAChB,CAEAuxB,YACI,OAAO,CACX,CAQAD,WAAY,CAEZE,UAAU7M,GACNnnC,KAAKwiB,QAAQyxB,YAAY,cAAe9M,EAC5C,CAEA+M,cACI,OAAOl0C,KAAKwiB,QAAQhO,SAAS,aACjC,CAEA2/B,UAAUhN,GACNnnC,KAAKwiB,QAAQyxB,YAAY,cAAe9M,EAC5C,CAEAiN,cACI,OAAOp0C,KAAKwiB,QAAQhO,SAAS,aACjC,CAEA6/B,aACI,OAAQr0C,KAAKk0C,gBAAkBl0C,KAAKo0C,aACxC,CAEA5yC,YACI,OAAOxB,KAAKwiB,QAAQ4W,GAAG,WAC3B,CAEAkb,cACI,OAAOt0C,KAAKkP,QAChB,CAEA8qB,SACQh6B,KAAKwiB,SACLxiB,KAAKwiB,QAAQwX,QAErB,CAEAua,kBACI,OAAIv0C,KAAKwiB,QACExiB,KAAKwiB,QAAQ9N,QAAQ,iBAAiB3B,KAAK,eAG3C,IAEf,CAEAyhC,UAAW,EAGf,gFC5KA,MAAMxV,UAA+B,IACjCyV,cAAch1C,GACV,OAAI+wB,MAAMI,QAAQnxB,GACPO,KAAKd,aAAeO,EAAM0J,SAASnJ,KAAKd,YAAYO,OAGpDO,KAAKd,aAAec,KAAKd,YAAYO,QAAUA,CAE9D,CAEAi1C,sBACI,OAAO,0CAA6C10C,KAAKd,WAC7D,CAEAy1C,OAAOp1C,GACH,OAAOS,KAAKT,SAAWA,CAC3B,CAGI+D,WACA,OAAOtD,KAAKd,aAAaoE,IAC7B,CAGI/D,aACA,OAAOS,KAAKsD,MAAM/D,MACtB,CAGIO,eACA,OAAOE,KAAKd,aAAaY,QAC7B,CAGIe,oBACA,OAAOb,KAAKd,aAAa2B,aAC7B,CAEIpB,YACA,OAAOO,KAAKd,aAAaO,KAC7B,CAKAs0C,YACI,QAAS/zC,KAAKsD,IAClB,CAEAjE,gBACQW,KAAK+zC,aACL/zC,KAAKg0C,WAAU,SACTh0C,KAAK40C,gBAAgB50C,KAAKsD,OAGhCtD,KAAKg0C,WAAU,EAEvB,CAQA30C,sBAAsBiE,GAAO,CAE7BjE,yBAAwB,YAACH,EAAW,SAAEY,IAE9BZ,EAAYY,WAAaA,SACnBE,KAAK60C,cAEnB,CAEAx1C,2BACUW,KAAK80C,SACf,CAEAz1C,iCAAgC,YAACH,IAC7Bc,KAAKd,YAAcA,QAEbc,KAAK+0C,sBACf,CAEA11C,mCACUW,KAAK80C,SACf,CAGAz1C,qCAAoC,YAACH,EAAW,SAAEY,IAC9CE,KAAKd,YAAcA,EAGfc,KAAKF,WAAaA,SACZE,KAAK80C,SAEnB,CAEAE,qBAAoB,YAAC91C,IAEjBc,KAAKd,YAAcA,CACvB,CAEAG,gCAA+B,OAACE,IACxBS,KAAK20C,OAAOp1C,UACNS,KAAK80C,SAEnB,CAEAz1C,iCACUW,KAAK80C,SACf,EAGJ,sECvGA,MAAM/V,UAAyB,IAEvBkW,kBAAgB,MAAO,iBAAmB,CAE1CC,oBAAkB,MAAO,EAAI,CAE7BC,WAAS,MAAO,CAAC,CAAG,CAExBxyC,cACIC,QAEA5C,KAAKmO,SAASnO,KAAKk1C,cACvB,CAMApB,WACI9zC,KAAKwiB,QAAU9d,EAnCJ,wRAoCX1E,KAAKwzC,eACLxzC,KAAKwiB,QAAQjW,KAAK,iBAAiBwG,KAAK,cAAe,IAAI/S,KAAK8V,eAEhE9V,KAAKo1C,aAAep1C,KAAKwiB,QAAQjW,KAAK,iBACtCvM,KAAKo1C,aAAariC,KAAK,KAAM/S,KAAK8V,aAElC9V,KAAKq1C,MAAQr1C,KAAKo1C,aAAa7oC,KAAK,cAEpCvM,KAAKs1C,OAASt1C,KAAKwiB,QAAQjW,KAAK,mCAChCvM,KAAKs1C,OAAO/vB,KAAKvlB,KAAKi1C,aAEtBj1C,KAAKu1C,SAAWv1C,KAAKwiB,QAAQjW,KAAK,qCAClCvM,KAAKu1C,SAAS5yB,QAEd,IAAK,MAAM6yB,KAAgBx1C,KAAKoL,SAC5BpL,KAAKu1C,SAAS5wC,OAAO6wC,EAAalhC,UAGtCtU,KAAKkW,YAAclW,KAAKy1C,cAC5B,CAQAp2C,qBAAsB,EAG1B,iCCpEA+zC,EAAO5Q,QAAUJ,QAAQ,cCCrBsT,yBAA2B,CAAC,ECD5BC,WACAC,kBDGJ,SAASC,oBAAoBC,GAE5B,IAAIC,EAAeL,yBAAyBI,GAC5C,QAAqBnuC,IAAjBouC,EACH,OAAOA,EAAavT,QAGrB,IAAI4Q,EAASsC,yBAAyBI,GAAY,CAGjDtT,QAAS,CAAC,GAOX,OAHAwT,oBAAoBF,GAAU1C,EAAQA,EAAO5Q,QAASqT,qBAG/CzC,EAAO5Q,OACf,CAGAqT,oBAAoBI,EAAID,oBExBxBH,oBAAoBK,EAAI,CAAC1T,EAAS2T,KACjC,IAAI,IAAI3kB,KAAO2kB,EACXN,oBAAoBO,EAAED,EAAY3kB,KAASqkB,oBAAoBO,EAAE5T,EAAShR,IAC5EzhB,OAAOsmC,eAAe7T,EAAShR,EAAK,CAAE8kB,YAAY,EAAM7sB,IAAK0sB,EAAW3kB,IAE1E,ECNDqkB,oBAAoBU,EAAI,CAAC,EAGzBV,oBAAoBntC,EAAK8tC,GACjBvsC,QAAQwM,IAAI1G,OAAO6lB,KAAKigB,oBAAoBU,GAAGE,QAAO,CAAC//B,EAAU8a,KACvEqkB,oBAAoBU,EAAE/kB,GAAKglB,EAAS9/B,GAC7BA,IACL,KCNJm/B,oBAAoBa,EAAKF,GAEZA,EAAU,MCHvBX,oBAAoBO,EAAI,CAAC9gC,EAAKX,IAAU5E,OAAO4Z,UAAU8jB,eAAe12B,KAAKzB,EAAKX,GJA9EghC,WAAa,CAAC,EACdC,kBAAoB,WAExBC,oBAAoBh0B,EAAI,CAAChc,EAAK8wC,EAAMnlB,EAAKglB,KACxC,GAAGb,WAAW9vC,GAAQ8vC,WAAW9vC,GAAKyG,KAAKqqC,OAA3C,CACA,IAAI/tB,EAAQguB,EACZ,QAAWjvC,IAAR6pB,EAEF,IADA,IAAIqlB,EAAUplC,SAASqlC,qBAAqB,UACpCtnC,EAAI,EAAGA,EAAIqnC,EAAQp0C,OAAQ+M,IAAK,CACvC,IAAIs7B,EAAI+L,EAAQrnC,GAChB,GAAGs7B,EAAEhrB,aAAa,QAAUja,GAAOilC,EAAEhrB,aAAa,iBAAmB81B,kBAAoBpkB,EAAK,CAAE5I,EAASkiB,EAAG,KAAO,CACpH,CAEGliB,IACHguB,GAAa,GACbhuB,EAASnX,SAASslC,cAAc,WAEzBC,QAAU,QACjBpuB,EAAO5e,QAAU,IACb6rC,oBAAoBttC,IACvBqgB,EAAOquB,aAAa,QAASpB,oBAAoBttC,IAElDqgB,EAAOquB,aAAa,eAAgBrB,kBAAoBpkB,GACxD5I,EAAOsuB,IAAMrxC,GAEd8vC,WAAW9vC,GAAO,CAAC8wC,GACnB,IAAIQ,EAAmB,CAACC,EAAM//B,KAE7BuR,EAAOyuB,QAAUzuB,EAAO0uB,OAAS,KACjCC,aAAavtC,GACb,IAAIwtC,EAAU7B,WAAW9vC,GAIzB,UAHO8vC,WAAW9vC,GAClB+iB,EAAO6uB,YAAc7uB,EAAO6uB,WAAWC,YAAY9uB,GACnD4uB,GAAWA,EAAQtnC,SAAS+6B,GAAQA,EAAG5zB,KACpC+/B,EAAM,OAAOA,EAAK//B,EAAM,EAExBrN,EAAUrB,WAAWwuC,EAAiB3R,KAAK,UAAM79B,EAAW,CAAElE,KAAM,UAAWkP,OAAQiW,IAAW,MACtGA,EAAOyuB,QAAUF,EAAiB3R,KAAK,KAAM5c,EAAOyuB,SACpDzuB,EAAO0uB,OAASH,EAAiB3R,KAAK,KAAM5c,EAAO0uB,QACnDV,GAAcnlC,SAASkmC,KAAKC,YAAYhvB,EAnCkB,CAmCX,EKtChDitB,oBAAoBgC,EAAKrV,IACH,oBAAXsV,QAA0BA,OAAOC,aAC1ChoC,OAAOsmC,eAAe7T,EAASsV,OAAOC,YAAa,CAAE3kC,MAAO,WAE7DrD,OAAOsmC,eAAe7T,EAAS,aAAc,CAAEpvB,OAAO,GAAO,ECL9DyiC,oBAAoBzlB,EAAI,iCCKxB,IAAI4nB,EAAkB,CACrB,IAAK,EACL,IAAK,EACL,IAAK,GAGNnC,oBAAoBU,EAAE0B,EAAI,CAACzB,EAAS9/B,KAElC,IAAIwhC,EAAqBrC,oBAAoBO,EAAE4B,EAAiBxB,GAAWwB,EAAgBxB,QAAW7uC,EACtG,GAA0B,IAAvBuwC,EAGF,GAAGA,EACFxhC,EAASpK,KAAK4rC,EAAmB,QAC3B,CAGL,IAAI/tC,EAAU,IAAIF,SAAQ,CAACC,EAASk5B,IAAY8U,EAAqBF,EAAgBxB,GAAW,CAACtsC,EAASk5B,KAC1G1sB,EAASpK,KAAK4rC,EAAmB,GAAK/tC,GAGtC,IAAItE,EAAMgwC,oBAAoBzlB,EAAIylB,oBAAoBa,EAAEF,GAEpD/vC,EAAQ,IAAI+G,MAgBhBqoC,oBAAoBh0B,EAAEhc,GAfFwR,IACnB,GAAGw+B,oBAAoBO,EAAE4B,EAAiBxB,KAEf,KAD1B0B,EAAqBF,EAAgBxB,MACRwB,EAAgBxB,QAAW7uC,GACrDuwC,GAAoB,CACtB,IAAIC,EAAY9gC,IAAyB,SAAfA,EAAM5T,KAAkB,UAAY4T,EAAM5T,MAChE20C,EAAU/gC,GAASA,EAAM1E,QAAU0E,EAAM1E,OAAOukC,IACpDzwC,EAAMiG,QAAU,iBAAmB8pC,EAAU,cAAgB2B,EAAY,KAAOC,EAAU,IAC1F3xC,EAAM6M,KAAO,iBACb7M,EAAMhD,KAAO00C,EACb1xC,EAAM4xC,QAAUD,EAChBF,EAAmB,GAAGzxC,EACvB,CACD,GAEwC,SAAW+vC,EAASA,EAE/D,CACD,EAcF,IAAI8B,EAAuB,CAACC,EAA4BrmC,KACvD,IAGI4jC,EAAUU,GAHTgC,EAAUC,EAAaC,GAAWxmC,EAGhB1C,EAAI,EAC3B,GAAGgpC,EAASj6B,MAAM+H,GAAgC,IAAxB0xB,EAAgB1xB,KAAa,CACtD,IAAIwvB,KAAY2C,EACZ5C,oBAAoBO,EAAEqC,EAAa3C,KACrCD,oBAAoBI,EAAEH,GAAY2C,EAAY3C,IAG7C4C,GAAsBA,EAAQ7C,oBAClC,CAEA,IADG0C,GAA4BA,EAA2BrmC,GACrD1C,EAAIgpC,EAAS/1C,OAAQ+M,IACzBgnC,EAAUgC,EAAShpC,GAChBqmC,oBAAoBO,EAAE4B,EAAiBxB,IAAYwB,EAAgBxB,IACrEwB,EAAgBxB,GAAS,KAE1BwB,EAAgBxB,GAAW,CAC5B,EAIGmC,EAAqBC,OAA4B,oBAAIA,OAA4B,qBAAK,GAC1FD,EAAmBzoC,QAAQooC,EAAqB9S,KAAK,KAAM,IAC3DmT,EAAmBrsC,KAAOgsC,EAAqB9S,KAAK,KAAMmT,EAAmBrsC,KAAKk5B,KAAKmT,6PChFvF,MAAME,EAAyB,iBAwB/Bx5C,eAAey5C,EAAmBC,EAAM9tC,EAAIzK,EAAU,CAAC,GACnD,MAAMw4C,EAAe,8CAErB,IAAItyC,QAAgBnD,EAAA,MAAW,sBAAsB0oB,mBAAmB8sB,mBAAsBC,KAE1FD,EAAK/+B,OAAOvX,QAAU,GAAKjC,EAAQy4C,qBACnCvyC,EAAU,CACN,CACIrF,OAAQ,cACR63C,UAAWH,EACX1xC,aAAc2xC,GAAgB,OAC9BG,yBAA0B,aAAal4C,EAAA,mBAAiB83C,QAE9DK,OAAO1yC,IAGTqyC,EAAK7iB,MAAM,oBAAsB11B,EAAQ64C,qBACzC3yC,EAAU,CACN,CACIrF,OAAQ,gBACRi4C,aAAcP,EACdI,yBAA0B,YAAYl4C,EAAA,mBAAiB83C,QAE7DK,OAAO1yC,IAGbuE,EAAGvE,EACP,CAEA,SAAS6yC,EAAU3kC,GACX3T,EAAA,qBAIJ2T,EAAI4kC,oBAAoB,IACxB5kC,EAAIhO,aAAa,MAAO,IAAI9B,QAAQ,UACxC,CAaA,SAAS20C,EAAgB7kC,GACrB,GAAI3T,EAAA,mBACA,OAGJ2T,EAAI4kC,oBAAoB,IACxB5kC,EAAIhO,aAAa,MAAO,IACxBgO,EAAI9P,QAAQ,SAGZ,MAAM4D,EAAIhE,EAAEg1C,MAAM,WAClBhxC,EAAE2b,MAAQ,GACVzP,EAAI9P,QAAQ4D,EAChB,CAgMA,SACIixC,8BAnRJt6C,eAA6Cu6C,GACzC,aAAa,IAAI3vC,SAAQ,CAACI,EAAKi5B,KAC3BwV,EAAmBc,GAAWC,IAC1BxvC,EAAIwvC,EAAKluC,KAAIyM,IACF,CACH/W,OAAQ+W,EAAI/W,OACZ63C,UAAW9gC,EAAI8gC,UACf5yB,GAAI,IAAIlO,EAAI0hC,gBACZxmC,KAAM8E,EAAI0hC,cACVC,KAAM,IAAI3hC,EAAItY,WACdA,SAAUsY,EAAItY,SACdq5C,yBAA0B/gC,EAAI+gC,6BAEnC,GACJ,CACCF,oBAAoB,GACtB,GAEV,EAkQIe,qBAhMJ,SAA8BplC,EAAKpU,GAC/B,GAAIoU,EAAIJ,SAAS,4BAA8BvT,EAAA,mBAI3C,OAFA2T,EAAI2wB,IAAI,6BAED3wB,EAGXpU,EAAUA,GAAW,CAAC,EAEtBoU,EAAIiP,SAAS,2BAEb,MAAMo2B,EAAmBv1C,EAAE,OAClBmf,SAAS,sDACTlP,KAAK,QAAS,QAEjBulC,EAAyBx1C,EAAE,OACxBmf,SAAS,wDACTlP,KAAK,QAAS,UAEjBwlC,EAA0Bz1C,EAAE,OAC7Bmf,SAAS,oEAERu2B,EAAe11C,EAAE,SAClBmf,SAAS,sBACTlf,OAAOs1C,GACPt1C,OAAOu1C,GAEP15C,EAAQ65C,4BACTD,EAAaz1C,OAAOw1C,GAGxBvlC,EAAI0lC,MAAMF,GAEVH,EAAiB1lC,GAAG,SAAS,IAAMglC,EAAU3kC,KAE7CslC,EAAuB3lC,GAAG,SAAS7L,IAC/B+wC,EAAgB7kC,IAIT,KAGX,IAAI2lC,EAAsB,CAAC,EAqF3B,OApFI/5C,EAAQ+4B,YACRghB,EAAoBC,sBAAwBh6C,EAAQ+4B,UACpDghB,EAAoBrlC,OAAQ,GAGhCN,EAAIhO,aAAa,IACV2zC,EACHE,SAAUhpC,SAASipC,cAAc,QACjCC,MAAM,EACNC,YAAY,EAGZC,aAAa,EACbC,UAAW,EACXC,iBAAiB,GAClB,CACC,CACIC,OAAQ,CAACjC,EAAM9tC,IAAO6tC,EAAmBC,EAAM9tC,EAAIzK,GACnDy6C,WAAY,gBACZC,UAAW,CACPC,WAAYA,GAAcA,EAAWhC,0BAGzC/kB,OAAO,KAIfxf,EAAIL,GAAG,yBAAyBlV,MAAOgY,EAAO8jC,KAC1C,GAA0B,kBAAtBA,EAAW95C,OAUX,OATAuT,EAAI4kC,oBAAoB,MACxB5kC,EAAIwmC,wBAAwBD,EAAW7B,cAEvC1kC,EAAIhO,aAAa,MAAOu0C,EAAW7B,cAEnC1kC,EAAIhO,aAAa,cAEjBgO,EAAI9P,QAAQ,oCAAqC,CAACq2C,IAKtD,GAA0B,gBAAtBA,EAAW95C,OAA0B,CACrC,MAAM,QAACkF,EAAO,SAAE4hB,EAAQ,eAAEwQ,SAAwB,qBAElD,IAAKpyB,EACD,OAGJ,MAAM,KAACjD,SAAc,eAA6B63C,EAAW9zC,aAAc,CACvEiD,MAAO6wC,EAAWjC,UAClB15C,UAAU,EACViE,KAAM0kB,EACNwQ,eAAgBA,IAGd93B,EAAgB,yCAA0CA,cAChEs6C,EAAWr7C,SAAWwD,EAAKqb,sBAAsB9d,EACrD,CAEA+T,EAAI4kC,oBAAoB2B,EAAWr7C,UACnC8U,EAAIwmC,wBAAwB,MAE5BxmC,EAAIhO,aAAa,MAAOu0C,EAAWjC,WAEnCtkC,EAAIhO,aAAa,SAEjBgO,EAAI9P,QAAQ,4BAA6B,CAACq2C,GAAY,IAG1DvmC,EAAIL,GAAG,uBAAuB,KACrBK,EAAIwQ,MAAMpL,QACXu/B,EAAU3kC,EACd,IAGJA,EAAIL,GAAG,uBAAuB,KACtBK,EAAI7B,KAAK,aACT6B,EAAIhO,aAAa,QACrB,IAIJgO,EAAI2wB,IAAI,6BAED3wB,CACX,EA+DI6kC,kBACA4B,QA5NJ,SAAiBzmC,EAAK2Q,GACdtkB,EAAA,qBAIJ2T,EAAI4kC,oBAAoB,IACxB5kC,EACKhO,aAAa,MAAO2e,EAAKvL,QACzBpT,aAAa,QACtB,EAoNI00C,KA/DJ,WACI52C,EAAEumC,GAAGsQ,oBAAsB,WACvB,OAAK72C,EAAE1E,MAAMolB,MAAMpL,OAGRtV,EAAE1E,MAAM+S,KAAK8lC,GAFb,EAIf,EAEAn0C,EAAEumC,GAAGuQ,kBAAoB,WACrB,MAAM17C,EAAW4E,EAAE1E,MAAMu7C,sBACzB,IAAKz7C,EACD,OAAO,KAGX,MAAMs9B,EAASt9B,EAASgJ,MAAM,KAE9B,OAAOs0B,EAAO36B,QAAU,EAAI26B,EAAOA,EAAO36B,OAAS,GAAK,IAC5D,EAEAiC,EAAEumC,GAAGuO,oBAAsB,SAAU15C,GACjCA,EAAWA,GAAY,GAEvB4E,EAAE1E,MAAM+S,KAAK8lC,EAAwB/4C,GAErC4E,EAAE1E,MACG0U,QAAQ,gBACRnI,KAAK,+BACL0nC,YAAY,YAAan0C,EAASka,QAClCjH,KAAK,OAAQ,IAAIjT,IAC1B,EAEA4E,EAAEumC,GAAGwQ,wBAA0B,WAC3B,OAAK/2C,EAAE1E,MAAMolB,MAAMpL,OAGRtV,EAAE1E,MAAM+S,KA9PQ,sBA4PhB,EAIf,EAEArO,EAAEumC,GAAGmQ,wBAA0B,SAAU9B,GACjCA,GACA50C,EAAE1E,MACG0U,QAAQ,gBACRnI,KAAK,+BACL0nC,YAAY,YAAY,EAErC,EAEAvvC,EAAEumC,GAAG7hC,QAAU/J,eAAgBE,GAC3B,MAAM+D,EAAO/D,QAAeM,EAAA,gBAAcN,GAAQ,GAAQ,KAE1DmF,EAAE1E,MACGolB,IAAI9hB,EAAOA,EAAKgH,MAAQ,IACxBkvC,oBAAoBj6C,EAC7B,CACJ,mCC1QA,SAASi4B,EAAKkkB,GAGV,OAFAjqC,SAASkqC,YAAYD,IAEd,CACX,CAEA,QAjBA,WACQz6C,EAAA,sBAAsBA,EAAA,kBACtB,uBAAmC,UAAU,IAAMu2B,EAAK,UACxD,uBAAmC,UAAU,IAAMA,EAAK,WACxD,uBAAmC,UAAU,IAAMA,EAAK,SACxD,uBAAmC,UAAU,IAAMA,EAAK,eACxD,uBAAmC,UAAU,IAAMA,EAAK,UACxD,uBAAmC,UAAU,IAAMA,EAAK,UAEhE,0FCwHA,QAlIA,WACI,MAAMmE,EAAW16B,EAAA,uBAAqB,YAEhC26C,EAAS36C,EAAA,uBAAqB,qBAC9B,YAAC+D,GAAe42C,EAAOz4C,mBAE7B6B,EAAYuP,GAAG,gBAAgB,CAAC8C,EAAOwR,KACnC,MAAM,UAACgzB,GAAahzB,EACdizB,EAAUjzB,EAAOkzB,cAAc/hC,OAAOvX,OAAS,EAE/Cu5C,EAD6B,WAArBlhB,QAAQD,SACW,OAAS,OAEpChY,EAAQ,GAEd,GAAIgG,EAAOozB,eAAgB,CACvB,IAAK,MAAMd,KAActyB,EAAOqzB,sBAC5Br5B,EAAMvW,KAAK,CACPhC,MAAO6wC,EACPt2B,QAAS,qBACTs3B,mBAAoBhB,EACpBl3B,OAAQ,gBAIhBpB,EAAMvW,KAAK,CACPhC,MAAO,MAAMue,EAAOozB,uBACpBh4B,OAAQ,aACRK,QAAS,IAAMtf,EAAYknC,QAAQkQ,gCAAgCvzB,EAAOozB,kBAG9Ep5B,EAAMvW,KAAK,CAAEhC,MAAO,QACxB,CAmDA,GAjDIue,EAAOwzB,YACPx5B,EAAMvW,KAAK,CACPkY,QAASq3B,EAAUS,QAAUR,EAC7BxxC,MAAO,WAAW0xC,MAClB/3B,OAAQ,YACRK,QAAS,IAAMtf,EAAYslB,SAI/BzB,EAAOwzB,YAAcP,IACrBj5B,EAAMvW,KAAK,CACPkY,QAASq3B,EAAUU,SAAWT,EAC9BxxC,MAAO,WAAW0xC,MAClB/3B,OAAQ,aACRK,QAAS,IAAMtf,EAAYulB,SAI9B,CAAC,GAAI,cAAe,uBAAuBphB,SAAS0f,EAAO2zB,UAAiC,SAArB3zB,EAAO4zB,WAC/E55B,EAAMvW,KAAK,CACPhC,MAAO,UACP2Z,OAAQ,aACRK,QAAS,KACLqX,EAASnR,UAAUsjB,MAAM,CACrB4O,SAAU7zB,EAAO8zB,SACjBp3B,KAAMsD,EAAO2zB,SACf,IAKV3zB,EAAOwzB,YACPx5B,EAAMvW,KAAK,CACPkY,QAASq3B,EAAUe,SACnBtyC,MAAO,WAAW0xC,MAClB/3B,OAAQ,cACRK,QAAS,IAAMtf,EAAY63C,UAI/Bh0B,EAAOwzB,YACPx5B,EAAMvW,KAAK,CACPkY,QAASq3B,EAAUe,SACnBtyC,MAAO,eAAe0xC,YACtB/3B,OAAQ,cACRK,QAAS,IAAMtf,EAAY83C,uBAI/BhB,EAAS,CACT,MAAMiB,EAAqBl0B,EAAOkzB,cAAct5C,OAAS,GACnD,GAAIomB,EAAOkzB,cAAc/lB,OAAO,EAAG,OACnCnN,EAAOkzB,cAGPiB,EAAyBx8C,EAAA,MAAY,0BACrCy8C,EAAwBz8C,EAAA,MAAY,yBAC1C,IAAI08C,EACAC,EACAH,GAA0BC,GAC1BC,EAAmBF,EACnBG,EAAkBF,IAElBC,EAAmB,aACnBC,EAAkB,uCAItB,IAAIC,EAAYD,EAAgBhnC,QAAQ,YAAa8V,mBAAmBpD,EAAOkzB,gBAE/El5B,EAAMvW,KAAK,CACPkY,QAASq3B,EAAUe,SACnBtyC,MAAO,KAAK4yC,SAAwBH,KACpC94B,OAAQ,mBACRK,QAAS,IAAMqX,EAASzE,MAAMmmB,aAAaD,IAEnD,CAEA,GAAqB,IAAjBv6B,EAAMpgB,OACN,OAGJ,MAAM66C,EAAYppC,EAAA,mBAElB,SAAiB,CACbwP,EAAGmF,EAAOnF,EAAI45B,EACd95B,EAAGqF,EAAOrF,EAAI85B,EACdz6B,QACA0B,sBAAuB,EAAEM,UAASs3B,yBACd,uBAAZt3B,GACA7f,EAAYu4C,WAAWpB,EAC3B,GAEN,GAEV,kCCnIe,MAAMqB,UAAkB,IACnC1J,WACI9zC,KAAKwiB,QAAU9d,EAAE,SACjB1E,KAAKy9C,gBACT,CAEAA,iBACI,IAAK,MAAMl0B,KAAUvpB,KAAKoL,SACtBpL,KAAKwiB,QAAQ7d,OAAO4kB,EAAOjV,SAEnC,ECVW,MAAMopC,UAAsBF,EACvC76C,YAAYg7C,GAGR,GAFA/6C,SAEK+6C,IAAc,CAAC,MAAO,UAAUx0C,SAASw0C,GAC1C,MAAM,IAAInwC,MAAM,gCAAgCmwC,oCAGpD39C,KAAKod,MAAMi2B,MAAQ,kCAAkCsK,IACzD,ECkBW,MAAMC,UAA8B,IAC/C9J,WACI9zC,KAAKwiB,QAAU9d,EA7BX,uvBA8BR,CAEAm5C,oBAAoBC,GAChB99C,KAAKwiB,QAAQ2K,OAAO2wB,EAAgBl5C,KAAKm5C,eAC7C,EC/BJ,MAAM,EAAM,kRAaqBt8C,OAAOmD,KAAKuvB,4SAUZ1yB,OAAOmD,KAAKuvB,i+MAmM9B,MAAM6pB,UAAyB,IAC1Cr7C,cACIC,QAEA5C,KAAKi+C,sBAAwB,IAAIL,CACrC,CAEA9J,WACI9zC,KAAKwiB,QAAU9d,EAAE,GAEjB1E,KAAKk+C,UAAYl+C,KAAKwiB,QAAQjW,KAAK,4BACnC,MAAM2hB,EAAUluB,KAAKwiB,QAAQjW,KAAK,uBAClC2hB,EAAQlD,QAAQ,CAAElmB,QAAS,UAC3BopB,EAAQ3Z,GAAG,SAAS,IAAM2Z,EAAQlD,QAAQ,UAE1ChrB,KAAKwiB,QAAQjW,KAAK,6BAA6BgI,GAAG,SAAS,IAAMvU,KAAKgI,eAAe,qBAErF,MAAMkgC,EAAajnC,EAAA,qBAEnBjB,KAAKwiB,QAAQjW,KAAK,kBAAkB4gB,QAAQ+a,GAC5CloC,KAAKwiB,QAAQjW,KAAK,0BAA0B4gB,OAAO+a,GACnDloC,KAAKwiB,QAAQjW,KAAK,oCAAoC4gB,QAAQ+a,GAAcjnC,EAAA,qBAC5EjB,KAAKwiB,QAAQjW,KAAK,qCAAqC4gB,QAAQ+a,GAAcjnC,EAAA,oBAE7EjB,KAAKwiB,QAAQjO,GAAG,QAAS,kBAAkB7L,IACnChE,EAAEgE,EAAEiK,QAAQ0D,OAAO,kBAIvBrW,KAAKk+C,UAAUC,SAAS,SAAS,IAGrCn+C,KAAKwiB,QAAQjW,KAAK,wCAAwC5H,OACtD3E,KAAKi+C,sBAAsB3pC,UAG/BtU,KAAKo+C,6BAA+Bp+C,KAAKwiB,QAAQjW,KAAK,oCAEjDtL,EAAA,sBACDjB,KAAKwiB,QAAQjW,KAAK,mBAAmBmW,OAGzC1iB,KAAKq+C,WAAar+C,KAAKwiB,QAAQjW,KAAK,eACpCvM,KAAKwiB,QAAQjO,GAAG,oBAAoB,IAAMvU,KAAKs+C,oBAE/Ct+C,KAAKwiB,QAAQjW,KAAK,iBAAiBgI,GAAG,SAElC,IAAM5L,YAAW,IAAM3I,KAAKs+C,mBAAmB,OAGnDt+C,KAAK69C,sBAELhL,aAAY,IAAM7yC,KAAK69C,uBAAuB,MAClD,CAEAS,kBACI,IAAKr9C,EAAA,qBACD,OAGJ,MAAMyW,EAAazW,EAAA,uBAAqB,YAAY2W,SAASG,gBACvDwmC,EAAc1mC,KAAKC,MAAmB,IAAbJ,GAE/B1X,KAAKq+C,WAAW94B,KAAK,GAAGg5B,KAC5B,CAEAl/C,4BAGI,SAFMmB,EAAA,qBAEiC,SAAnCA,EAAA,MAAY,mBACZ,OAGJ,MAAMs9C,QAAsB99C,KAAKw+C,qBACjCx+C,KAAKi+C,sBAAsBJ,oBAAoBC,GAC/C99C,KAAKo+C,6BAA6BjxB,OAAO2wB,EAAgBl5C,KAAKm5C,gBAC9D/9C,KAAKo+C,6BAA6B7xC,KAAK,iBAAiBgZ,KAAK,WAAWu4B,qCAC5E,CAEAz+C,2BACI,MAEMiH,QAAam4C,MAFM,8DAGnBvsC,QAAa5L,EAAKo4C,OAExB,OAAOxsC,GAAMysC,UAAUC,UAAU,EACrC,CAEAC,+BACIp9C,OAAOyE,KAAK,mDAChB,CAEAY,4BACI9G,KAAKk+C,UAAUC,SAAS,OAC5B,CAEAt3C,oBACI7G,KAAKk+C,UAAUC,SAAS,OAC5B,kCCpQJ,SACIW,SA3DJz/C,eAAwBE,EAAQ+T,EAAMF,EAAQ,UACpC7P,EAAA,MAAW,SAAShE,cAAoB,CAC1CkE,KAAM,QACN6P,KAAMA,EACNF,MAAOA,GAEf,EAsDI2rC,SApDJ1/C,eAAwBE,EAAQ+T,EAAMF,EAAQ,UACpC7P,EAAA,MAAW,SAAShE,kBAAwB,CAC9CkE,KAAM,QACN6P,KAAMA,EACNF,MAAOA,GAEf,EA+CI4rC,oBA7CJ3/C,eAAmCE,EAAQ4T,SACjC5P,EAAA,SAAc,SAAShE,gBAAqB4T,IACtD,EA4CI8rC,YAnCJ,SAAqBC,EAASC,GAC1B,IAAKA,IAAiBD,EAClB,OAAO,EAGX,MAAME,EAAWv/C,EAAA,cAAYq/C,EAAQ3/C,QAErC,IAAK6/C,EAED,OAAO,EAGX,MAAMC,EAAc,CAACF,KAAiBA,EAAan+B,mCAEnD,IAAK,MAAMs+B,KAAcD,EACrB,GAAIC,EAAW//C,SAAW6/C,EAAS7/C,OAC/B,OAAO,EAIf,GAAIS,KAAK8Y,cACL,IAAK,MAAMwmC,KAAcD,EACrB,GAAIC,EAAWh+B,YAAY89B,EAAS7/C,QAAQ,GACxC,OAAO,EAKnB,OAAO,CACX,GC7CA,IAAUmJ,EAIA8G,GAJA9G,EAAqCjH,QAA9B89C,cAAqC,SAAW72C,EAAEmvC,GAAgB,IAAI/M,EAAEta,MAAM7G,UAAU3Y,MAAUxB,EAAE9G,EAAEuM,QAAYshC,OAAY,IAAH/mC,EAAe,WAAW,EAAE,SAAS3D,GAAG2D,EAAE/I,MAAMoF,EAAE,EAAE,SAAS2zC,EAAEC,EAAErJ,EAAEF,IAAGA,EAAEA,GAAG2B,GAAGnvC,EAAE7F,UAAyBuzC,EAAEzsB,UAAU+1B,SAAQtJ,EAAEzsB,UAAU+1B,OAAO,SAAS7zC,GAAOqqC,EAAEyJ,cAAc9zC,KAAW7L,KAAKQ,QAAQ01C,EAAE0J,QAAO,EAAK5/C,KAAKQ,QAAQqL,GAAE,GAAEqqC,EAAEjL,GAAGwU,GAAG,SAAS5zC,GAAG,MAAa,iBAAHA,EAAiF,SAAWA,EAAEgsC,EAAE/M,GAAG,IAAIp7B,EAAMgnC,EAAE,OAAO+I,MAAM5H,MAA0O,OAApOhsC,EAAE8nB,MAAK,SAAS9nB,EAAGnD,GAAG,IAAI8G,EAAE0mC,EAAEhkC,KAAKxJ,EAAE+2C,GAAG,GAAIjwC,EAAJ,CAAwE,IAAIgwC,EAAEhwC,EAAEqoC,GAAG,GAAI2H,GAAgB,KAAb3H,EAAE/4B,OAAO,GAAhB,CAAgE,IAAIs3B,EAAEoJ,EAAEK,MAAMrwC,EAAEs7B,GAAGp7B,OAAM/H,IAAJ+H,EAAc0mC,EAAE1mC,CAAtC,MAAtC6mC,EAAE,GAAGG,0BAA1C,MAAhEH,EAAE,GAAGkJ,gDAAgD/I,IAA6H,SAAc/uC,IAAJ+H,EAAcA,EAAE7D,CAAC,CAAhV2D,CAAExP,KAAK6L,EAAlCi/B,EAAE/zB,KAAK6zB,UAAU,KAA2V,SAAW/+B,EAAG2zC,GAAG3zC,EAAE8nB,MAAK,SAAS9nB,EAAGnD,GAAG,IAAI8G,EAAE0mC,EAAEhkC,KAAKxJ,EAAE+2C,GAAMjwC,GAAGA,EAAEkwC,OAAOF,GAAGhwC,EAAEswC,UAAatwC,EAAE,IAAI4mC,EAAE1tC,EAAE82C,GAAGtJ,EAAEhkC,KAAKxJ,EAAE+2C,EAAEjwC,GAAG,GAAE,CAA5bgwC,CAAEx/C,KAAK6L,GAAU7L,KAAI,EAAwa0P,EAAEwmC,GAAE,CAAC,SAASxmC,EAAE7D,IAAOA,GAAGA,GAAGA,EAAEk0C,UAAgBl0C,EAAEk0C,QAAQP,EAAC,CAAgB,OAAf9vC,EAAEmoC,GAAGnvC,EAAE7F,QAAe28C,CAAC,CAA37BhwC,CAAE9G,EAAEA,EAAE7F,QACOpB,OAAdu+C,QAAqB,WAA0B,SAAS/J,EAAEpqC,GAAG,IAAInD,EAAEiP,WAAW9L,GAAuC,OAAb,GAAjBA,EAAEkqB,QAAQ,OAAWuX,MAAM5kC,IAAaA,CAAC,CAAe,IAAI8G,EAAkB,oBAATyF,QAA3B,WAAa,EAAqC,SAASpJ,GAAGoJ,QAAQxO,MAAMoF,EAAE,EAAM2X,EAAE,CAAC,cAAc,eAAe,aAAa,gBAAgB,aAAa,cAAc,YAAY,eAAe,kBAAkB,mBAAmB,iBAAiB,qBAAyB7T,EAAE6T,EAAE/gB,OAAmJ,SAASw9C,EAAEp0C,GAAG,IAAInD,EAAE4kB,iBAAiBzhB,GAA2H,OAApHnD,GAAG8G,EAAE,kBAAkB9G,6FAAoGA,CAAC,CAAC,IAAgBgb,EAAZ87B,GAAE,EAAY,SAASU,IAAI,IAAGV,EAAH,CAAaA,GAAE,EAAK,IAAI3zC,EAAE4F,SAASslC,cAAc,OAAOlrC,EAAEwnC,MAAM8M,MAAM,QAAQt0C,EAAEwnC,MAAM+M,QAAQ,kBAAkBv0C,EAAEwnC,MAAMgN,YAAY,QAAQx0C,EAAEwnC,MAAMiN,YAAY,kBAAkBz0C,EAAEwnC,MAAMkN,UAAU,aAAa,IAAI73C,EAAE+I,SAAS8xB,MAAM9xB,SAASuR,gBAAgBta,EAAEkvC,YAAY/rC,GAAG,IAAI2D,EAAEywC,EAAEp0C,GAAGuqC,EAAEoK,eAAe98B,EAAc,KAAZuyB,EAAEzmC,EAAE2wC,OAAYz3C,EAAEgvC,YAAY7rC,EAAhU,CAAkU,CAAC,SAASuqC,EAAEvqC,GAA0D,GAAvDq0C,IAAiB,iBAAHr0C,IAAaA,EAAE4F,SAASipC,cAAc7uC,IAAOA,GAAa,iBAAHA,GAAcA,EAAE40C,SAA9B,CAA+C,IAAI/3C,EAAEu3C,EAAEp0C,GAAG,GAAc,QAAXnD,EAAEkb,QAAiB,OAAxzB,WAA4F,IAA/E,IAAI/X,EAAE,CAACs0C,MAAM,EAAEO,OAAO,EAAEC,WAAW,EAAEC,YAAY,EAAEv9B,WAAW,EAAEF,YAAY,GAAWza,EAAE,EAAEA,EAAEiH,EAAEjH,IAAgBmD,EAAL2X,EAAE9a,IAAQ,EAAE,OAAOmD,CAAC,CAAorBg1C,GAAI,IAAIrxC,EAAE,CAAC,EAAEA,EAAE2wC,MAAMt0C,EAAEi1C,YAAYtxC,EAAEkxC,OAAO70C,EAAEk1C,aAA2D,IAA9C,IAAIvB,EAAEhwC,EAAEwxC,YAAyB,cAAbt4C,EAAE63C,UAAgCnK,EAAE,EAAGA,EAAEzmC,EAAGymC,IAAI,CAAC,IAAIyB,EAAEr0B,EAAE4yB,GAAOtL,EAAEpiC,EAAEmvC,GAAOnoC,EAAEiI,WAAWmzB,GAAGt7B,EAAEqoC,GAAIvK,MAAM59B,GAAK,EAAFA,CAAG,CAAC,IAAIgnC,EAAElnC,EAAEyxC,YAAYzxC,EAAE0xC,aAAiBzB,EAAEjwC,EAAE2xC,WAAW3xC,EAAE4xC,cAAkBlL,EAAE1mC,EAAE6xC,WAAW7xC,EAAE8xC,YAAgB/K,EAAE/mC,EAAE+xC,UAAU/xC,EAAEgyC,aAAiBpxB,EAAE5gB,EAAEiyC,gBAAgBjyC,EAAEkyC,iBAAqBvxC,EAAEX,EAAEmyC,eAAenyC,EAAEoyC,kBAAsB3xC,EAAEuvC,GAAG97B,EAAM7B,EAAEo0B,EAAEvtC,EAAEy3C,QAAc,IAAJt+B,IAAWrS,EAAE2wC,MAAMt+B,GAAG5R,EAAE,EAAEymC,EAAEtmB,IAAG,IAAIyxB,EAAE5L,EAAEvtC,EAAEg4C,QAAmJ,OAApI,IAAJmB,IAAWryC,EAAEkxC,OAAOmB,GAAG5xC,EAAE,EAAEwvC,EAAEtvC,IAAGX,EAAEmxC,WAAWnxC,EAAE2wC,OAAOzJ,EAAEtmB,GAAG5gB,EAAEoxC,YAAYpxC,EAAEkxC,QAAQjB,EAAEtvC,GAAGX,EAAE6T,WAAW7T,EAAE2wC,MAAMjK,EAAE1mC,EAAE2T,YAAY3T,EAAEkxC,OAAOnK,EAAS/mC,CAAtqB,CAAuqB,CAAC,OAAO4mC,CAAC,CAAh2D1tC,IAAo5D,oBAARjH,OAAoBA,YAAO,GAAlDqgD,UAAuD,WAAW,SAASj2C,IAAI,CAAC,IAAInD,EAAEmD,EAAE8d,UAAwvB,OAA9uBjhB,EAAE6L,GAAG,SAAS1I,EAAGnD,GAAG,GAAImD,GAAInD,EAAR,CAAkB,IAAI8G,EAAExP,KAAK+hD,QAAQ/hD,KAAK+hD,SAAS,CAAC,EAAMvC,EAAEhwC,EAAE3D,GAAG2D,EAAE3D,IAAI,GAAkC,OAAb,GAAf2zC,EAAEzpB,QAAQrtB,IAAQ82C,EAAElzC,KAAK5D,GAAU1I,IAA/F,CAAmG,EAAE0I,EAAEs5C,KAAK,SAASn2C,EAAGnD,GAAG,GAAImD,GAAInD,EAAR,CAAkB1I,KAAKuU,GAAG1I,EAAEnD,GAAG,IAAI8G,EAAExP,KAAKiiD,YAAYjiD,KAAKiiD,aAAa,CAAC,EAAgC,OAAxBzyC,EAAE3D,GAAG2D,EAAE3D,IAAI,CAAC,GAAInD,IAAG,EAAY1I,IAA/F,CAAmG,EAAE0I,EAAE68B,IAAI,SAAS15B,EAAGnD,GAAG,IAAI8G,EAAExP,KAAK+hD,SAAS/hD,KAAK+hD,QAAQl2C,GAAG,GAAI2D,GAAIA,EAAE/M,OAAV,CAAyB,IAAI+8C,EAAEhwC,EAAEumB,QAAQrtB,GAA2B,OAAjB,GAAJ82C,GAAOhwC,EAAE0yC,OAAO1C,EAAE,GAAUx/C,IAAnD,CAAuD,EAAE0I,EAAEy5C,UAAU,SAASt2C,EAAGnD,GAAG,IAAI8G,EAAExP,KAAK+hD,SAAS/hD,KAAK+hD,QAAQl2C,GAAG,GAAI2D,GAAIA,EAAE/M,OAAV,CAAyB+M,EAAEA,EAAEwB,MAAM,GAAGtI,EAAEA,GAAG,GAA+C,IAA5C,IAAI82C,EAAEx/C,KAAKiiD,aAAajiD,KAAKiiD,YAAYp2C,GAAWuqC,EAAE,EAAGA,EAAE5mC,EAAE/M,OAAQ2zC,IAAI,CAAC,IAAIyB,EAAEroC,EAAE4mC,GAASoJ,GAAGA,EAAE3H,KAAS73C,KAAKulC,IAAI15B,EAAEgsC,UAAU2H,EAAE3H,IAAGA,EAAEgI,MAAM7/C,KAAK0I,EAAE,CAAC,OAAO1I,IAAhL,CAAoL,EAAE0I,EAAE05C,OAAO,kBAAkBpiD,KAAK+hD,eAAe/hD,KAAKiiD,WAAW,EAASp2C,CAAC,CAA90BnD,GACr6D,SAAUA,EAAE8G,GAAG9G,EAAE25C,WAAqC,SAAWjM,EAAE1tC,GAAiB,SAAS82C,IAAI,CAAC,IAAI3H,EAAE2H,EAAE71B,UAAU5Z,OAAOuc,OAAO5jB,EAAEihB,WAAWkuB,EAAEyK,eAAe,SAASz2C,GAAG7L,KAAKuiD,gBAAgB12C,GAAE,EAAK,EAAEgsC,EAAE2K,iBAAiB,SAAS32C,GAAG7L,KAAKuiD,gBAAgB12C,GAAE,EAAM,EAAEgsC,EAAE0K,gBAAgB,SAAS12C,EAAEnD,GAA0B,IAAI8G,GAA3B9G,OAAMf,IAAJe,GAAmBA,GAAU,mBAAmB,sBAA0B82C,EAAE,YAAepJ,EAAEqM,aAAcjD,EAAE,cAAsB,iBAAiBpJ,IAAGoJ,EAAE,cAAa3zC,EAAE2D,GAAGgwC,EAAEx/C,KAAK,EAAE63C,EAAEhjC,YAAY,SAAShJ,GAAG,IAAInD,EAAE,KAAKmD,EAAEpI,OAAUzD,KAAK0I,IAAI1I,KAAK0I,GAAGmD,EAAG,EAAEgsC,EAAE6K,SAAS,SAAS72C,GAAG,IAAI,IAAInD,EAAE,EAAGA,EAAEmD,EAAEpJ,OAAQiG,IAAI,CAAC,IAAI8G,EAAE3D,EAAEnD,GAAG,GAAG8G,EAAEmzC,YAAY3iD,KAAK4iD,kBAAmB,OAAOpzC,CAAE,CAAC,EAAEqoC,EAAEgL,YAAY,SAASh3C,GAAG,IAAInD,EAAEmD,EAAEi3C,OAAUp6C,GAAQ,IAAJA,GAAW,IAAJA,GAAe1I,KAAK+iD,aAAal3C,EAAEA,EAAE,EAAEgsC,EAAEmL,aAAa,SAASn3C,GAAG7L,KAAK+iD,aAAal3C,EAAEA,EAAEo3C,eAAe,GAAG,EAAEpL,EAAEqL,cAAc,SAASr3C,GAAG7L,KAAK+iD,aAAal3C,EAAEA,EAAE,EAAEgsC,EAAEkL,aAAa,SAASl3C,EAAGnD,GAAMmD,EAAEi3C,QAAQ9iD,KAAKmjD,gBAAsBnjD,KAAKmjD,eAAc,EAAKnjD,KAAK4iD,uBAAgCj7C,IAAde,EAAE06C,UAAsB16C,EAAE06C,UAAU16C,EAAEi6C,WAAW3iD,KAAKqjD,YAAYx3C,EAAEnD,GAAE,EAAEmvC,EAAEwL,YAAY,SAASx3C,EAAGnD,GAAG1I,KAAKsjD,qBAAqBz3C,GAAG7L,KAAKmiD,UAAU,cAAc,CAACt2C,EAAEnD,GAAG,EAAE,IAAIoiC,EAAE,CAACyY,UAAU,CAAC,YAAY,WAAWC,WAAW,CAAC,YAAY,WAAW,eAAeC,YAAY,CAAC,cAAc,YAAY,kBAAooD,OAAlnD5L,EAAEyL,qBAAqB,SAASz3C,GAAG,GAAIA,EAAJ,CAAc,IAAInD,EAAEoiC,EAAEj/B,EAAEpI,MAAMiF,EAAEwH,SAAQ,SAASrE,GAAGuqC,EAAEh/B,iBAAiBvL,EAAE7L,KAAK,GAAEA,MAAMA,KAAK0jD,oBAAoBh7C,CAAlG,CAAmG,EAAEmvC,EAAE8L,uBAAuB,WAAe3jD,KAAK0jD,sBAA4B1jD,KAAK0jD,oBAAoBxzC,SAAQ,SAASrE,GAAGuqC,EAAEwN,oBAAoB/3C,EAAE7L,KAAK,GAAEA,aAAaA,KAAK0jD,oBAAmB,EAAE7L,EAAEgM,YAAY,SAASh4C,GAAG7L,KAAK8jD,aAAaj4C,EAAEA,EAAE,EAAEgsC,EAAEkM,cAAc,SAASl4C,GAAMA,EAAEu3C,WAAWpjD,KAAK4iD,mBAAmB5iD,KAAK8jD,aAAaj4C,EAAEA,EAAG,EAAEgsC,EAAEmM,YAAY,SAASn4C,GAAG,IAAInD,EAAE1I,KAAK0iD,SAAS72C,EAAEo3C,gBAAmBv6C,GAAG1I,KAAK8jD,aAAaj4C,EAAEnD,EAAG,EAAEmvC,EAAEiM,aAAa,SAASj4C,EAAGnD,GAAG1I,KAAKikD,YAAYp4C,EAAEnD,EAAE,EAAEmvC,EAAEoM,YAAY,SAASp4C,EAAGnD,GAAG1I,KAAKmiD,UAAU,cAAc,CAACt2C,EAAEnD,GAAG,EAAEmvC,EAAEqM,UAAU,SAASr4C,GAAG7L,KAAKmkD,WAAWt4C,EAAEA,EAAE,EAAEgsC,EAAEuM,YAAY,SAASv4C,GAAMA,EAAEu3C,WAAWpjD,KAAK4iD,mBAAmB5iD,KAAKmkD,WAAWt4C,EAAEA,EAAG,EAAEgsC,EAAEwM,WAAW,SAASx4C,GAAG,IAAInD,EAAE1I,KAAK0iD,SAAS72C,EAAEo3C,gBAAmBv6C,GAAG1I,KAAKmkD,WAAWt4C,EAAEnD,EAAG,EAAEmvC,EAAEsM,WAAW,SAASt4C,EAAGnD,GAAG1I,KAAKskD,eAAetkD,KAAKukD,UAAU14C,EAAEnD,EAAE,EAAEmvC,EAAE0M,UAAU,SAAS14C,EAAGnD,GAAG1I,KAAKmiD,UAAU,YAAY,CAACt2C,EAAEnD,GAAG,EAAEmvC,EAAEyM,aAAa,WAAWtkD,KAAKwkD,gBAAgBxkD,KAAK2jD,yBAAyB3jD,KAAKykD,aAAa,EAAE5M,EAAE2M,cAAc,WAAWxkD,KAAKmjD,eAAc,SAAanjD,KAAK4iD,iBAAiB,EAAE/K,EAAE4M,YAA76E,WAAa,EAA86E5M,EAAE6M,gBAAgB,SAAS74C,GAAMA,EAAEu3C,WAAWpjD,KAAK4iD,mBAAmB5iD,KAAK2kD,eAAe94C,EAAEA,EAAG,EAAEgsC,EAAE+M,cAAc,SAAS/4C,GAAG,IAAInD,EAAE1I,KAAK0iD,SAAS72C,EAAEo3C,gBAAmBv6C,GAAG1I,KAAK2kD,eAAe94C,EAAEnD,EAAG,EAAEmvC,EAAE8M,eAAe,SAAS94C,EAAGnD,GAAG1I,KAAKskD,eAAetkD,KAAK6kD,cAAch5C,EAAEnD,EAAE,EAAEmvC,EAAEgN,cAAc,SAASh5C,EAAGnD,GAAG1I,KAAKmiD,UAAU,gBAAgB,CAACt2C,EAAEnD,GAAG,EAAE82C,EAAEsF,gBAAgB,SAASj5C,GAAG,MAAM,CAAC6X,EAAE7X,EAAE8Y,MAAMnB,EAAE3X,EAAE+Y,MAAM,EAAS46B,CAAC,CAA/3FhwC,CAAE9G,EAAEA,EAAEo5C,UAAW,CAA7C,CAA+CrgD,QAC/C,SAAUiH,EAAE8G,GAAG9G,EAAEq8C,WAAsC,SAAWlN,EAAEnvC,GAAG,SAAS8G,IAAI,CAAC,IAAIgwC,EAAEhwC,EAAEma,UAAU5Z,OAAOuc,OAAO5jB,EAAEihB,WAAW61B,EAAEwF,YAAY,WAAWhlD,KAAKilD,cAAa,EAAK,EAAEzF,EAAE0F,cAAc,WAAWllD,KAAKilD,cAAa,EAAM,EAAEzF,EAAEyF,aAAa,SAASp5C,GAA6G,IAAnF,IAAInD,GAA3BmD,OAAMlE,IAAJkE,GAAmBA,GAAU,mBAAmB,sBAA0B2D,EAAE3D,EAAE7L,KAAKmlD,kBAAkB,GAAW3F,EAAE,EAAEA,EAAEx/C,KAAKolD,QAAQ3iD,OAAO+8C,IAAI,CAAC,IAAIpJ,EAAEp2C,KAAKolD,QAAQ5F,GAAGx/C,KAAKuiD,gBAAgBnM,EAAEvqC,GAAGuqC,EAAE1tC,GAAG,QAAQ1I,MAAS63C,EAAE4K,eAAcrM,EAAE/C,MAAMgS,YAAY71C,EAAE,CAAC,EAAEgwC,EAAE2F,kBAAkB,OAAO3F,EAAE6D,YAAY,SAASx3C,EAAEnD,GAAS1I,KAAKslD,gBAAgBz5C,KAAiB7L,KAAKulD,mBAAmB78C,EAAEmD,EAAE4qB,iBAAiBz2B,KAAKwlD,kBAAkBxlD,KAAKsjD,qBAAqBz3C,GAAG7L,KAAKmiD,UAAU,cAAc,CAACt2C,EAAEnD,IAAG,EAAE,IAAI0tC,EAAE,CAACqP,UAAS,EAAKC,OAAM,EAAKC,QAAO,EAAKC,QAAO,GAAU9a,EAAE,CAAC+a,OAAM,EAAKC,UAAS,EAAKhD,QAAO,EAAKiD,QAAO,EAAKC,OAAM,EAAK7zB,MAAK,GAA6rD,OAAvrDqtB,EAAE8F,gBAAgB,SAASz5C,GAAG,IAAInD,EAAE0tC,EAAEvqC,EAAE8G,OAAOszC,UAAcz2C,EAAEs7B,EAAEj/B,EAAE8G,OAAOlP,MAAU+7C,GAAG92C,GAAG8G,EAA8B,OAAxBgwC,GAAGx/C,KAAKwkD,gBAAuBhF,CAAC,EAAEA,EAAEgG,gBAAgB,WAAW,IAAI35C,EAAE4F,SAASy0C,cAAoBr6C,GAAGA,EAAEs6C,MAAMt6C,GAAG4F,SAAS8xB,MAAW13B,EAAEs6C,MAAO,EAAE3G,EAAEyE,YAAY,SAASp4C,EAAEnD,GAAG,IAAI8G,EAAExP,KAAKomD,iBAAiBv6C,EAAEnD,GAAG1I,KAAKmiD,UAAU,cAAc,CAACt2C,EAAEnD,EAAE8G,IAAIxP,KAAKqmD,UAAUx6C,EAAEnD,EAAE8G,EAAE,EAAEgwC,EAAE4G,iBAAiB,SAASv6C,EAAEnD,GAAG,IAAI8G,EAAE,CAACkU,EAAEhb,EAAEic,MAAM3kB,KAAKulD,mBAAmB5gC,MAAMnB,EAAE9a,EAAEkc,MAAM5kB,KAAKulD,mBAAmB3gC,OAAyE,OAA9D5kB,KAAKsmD,YAAYtmD,KAAKumD,eAAe/2C,IAAIxP,KAAKwmD,WAAW36C,EAAEnD,GAAU8G,CAAC,EAAEgwC,EAAE+G,eAAe,SAAS16C,GAAG,OAAOgM,KAAK4uC,IAAI56C,EAAE6X,GAAG,GAAG7L,KAAK4uC,IAAI56C,EAAE2X,GAAG,CAAC,EAAEg8B,EAAE+E,UAAU,SAAS14C,EAAEnD,GAAG1I,KAAKmiD,UAAU,YAAY,CAACt2C,EAAEnD,IAAI1I,KAAK0mD,eAAe76C,EAAEnD,EAAE,EAAE82C,EAAEkH,eAAe,SAAS76C,EAAEnD,GAAM1I,KAAKsmD,WAAYtmD,KAAK2mD,SAAS96C,EAAEnD,GAAQ1I,KAAK4mD,aAAa/6C,EAAEnD,EAAG,EAAE82C,EAAEgH,WAAW,SAAS36C,EAAEnD,GAAG1I,KAAKsmD,YAAW,EAAKtmD,KAAK6mD,oBAAmB,EAAK7mD,KAAK8mD,UAAUj7C,EAAEnD,EAAE,EAAE82C,EAAEsH,UAAU,SAASj7C,EAAEnD,GAAG1I,KAAKmiD,UAAU,YAAY,CAACt2C,EAAEnD,GAAG,EAAE82C,EAAE6G,UAAU,SAASx6C,EAAEnD,EAAE8G,GAAOxP,KAAKsmD,YAAmBtmD,KAAK+mD,SAASl7C,EAAEnD,EAAE8G,EAAE,EAAEgwC,EAAEuH,SAAS,SAASl7C,EAAEnD,EAAE8G,GAAG3D,EAAE4qB,iBAAiBz2B,KAAKmiD,UAAU,WAAW,CAACt2C,EAAEnD,EAAE8G,GAAG,EAAEgwC,EAAEmH,SAAS,SAAS96C,EAAEnD,GAAG1I,KAAKsmD,YAAW,EAAM39C,WAAW,kBAAkB3I,KAAK6mD,kBAAkB,EAAErhB,KAAKxlC,OAAOA,KAAKgnD,QAAQn7C,EAAEnD,EAAE,EAAE82C,EAAEwH,QAAQ,SAASn7C,EAAEnD,GAAG1I,KAAKmiD,UAAU,UAAU,CAACt2C,EAAEnD,GAAG,EAAE82C,EAAEyH,QAAQ,SAASp7C,GAAM7L,KAAK6mD,oBAAoBh7C,EAAE4qB,gBAAiB,EAAE+oB,EAAEoH,aAAa,SAAS/6C,EAAEnD,GAAM1I,KAAKknD,mBAA2B,WAARr7C,EAAEpI,OAAwBzD,KAAKmnD,YAAYt7C,EAAEnD,GAAc,WAARmD,EAAEpI,OAAiBzD,KAAKknD,mBAAkB,EAAKv+C,WAAW,kBAAkB3I,KAAKknD,iBAAiB,EAAE1hB,KAAKxlC,MAAM,MAAK,EAAEw/C,EAAE2H,YAAY,SAASt7C,EAAEnD,GAAG1I,KAAKmiD,UAAU,cAAc,CAACt2C,EAAEnD,GAAG,EAAE8G,EAAEs1C,gBAAgBp8C,EAAEo8C,gBAAuBt1C,CAAC,CAAvhFA,CAAE9G,EAAEA,EAAE25C,WAAY,CAA9C,CAAgD5gD,SACtC+N,EAAiD/N,QAA1C2lD,YAAiD,SAAWvP,EAAEnB,EAAEhuC,GAAG,SAAS8G,EAAE3D,EAAEnD,GAAG,IAAI,IAAI8G,KAAK9G,EAAGmD,EAAE2D,GAAG9G,EAAE8G,GAAG,OAAO3D,CAAC,CAAe,IAAIuqC,EAAEyB,EAAEh1C,OAAO,SAASioC,EAAEj/B,EAAEnD,GAAG1I,KAAKqnD,QAAkB,iBAAHx7C,EAAY4F,SAASipC,cAAc7uC,GAAGA,EAAKuqC,IAAGp2C,KAAKsnD,SAASlR,EAAEp2C,KAAKqnD,UAASrnD,KAAKQ,QAAQgP,EAAE,CAAC,EAAExP,KAAK2C,YAAY4kD,UAAUvnD,KAAK0/C,OAAOh3C,GAAG1I,KAAKwnD,SAAS,CAAC,IAAI93C,EAAEo7B,EAAEnhB,UAAU5Z,OAAOuc,OAAO5jB,EAAEihB,WAAWmhB,EAAEyc,SAAS,CAAC,EAAE73C,EAAEgwC,OAAO,SAAS7zC,GAAG2D,EAAExP,KAAKQ,QAAQqL,EAAE,EAAE,IAAI4zC,EAAE,CAACgI,UAAS,EAAKC,UAAS,EAAKC,OAAM,GAAytG,SAASzR,EAAErqC,EAAEnD,EAAE8G,GAAgB,OAAbA,EAAEA,GAAG,QAAe9G,EAAEmP,KAAKrI,GAAG3D,EAAEnD,GAAGA,EAAEmD,CAAC,CAA47C,OAAvsJ6D,EAAE83C,QAAQ,WAAWxnD,KAAKkP,SAAS,CAAC,EAAElP,KAAK4nD,eAAe5nD,KAAK6nD,WAAW,CAACnkC,EAAE,EAAEF,EAAE,GAAGxjB,KAAK8nD,UAAU,CAACpkC,EAAE,EAAEF,EAAE,GAAGxjB,KAAK+nD,cAAcv4C,EAAE,CAAC,EAAExP,KAAKkP,UAAU,IAAIrD,EAAEyhB,iBAAiBttB,KAAKqnD,SAAa5H,EAAE5zC,EAAEqD,YAAWlP,KAAKqnD,QAAQhU,MAAMnkC,SAAS,YAAWlP,KAAKuU,GAAG,cAAcvU,KAAKgoD,eAAehoD,KAAKuU,GAAG,YAAYvU,KAAKioD,aAAajoD,KAAKkoD,SAASloD,KAAKmoD,YAAY,EAAEz4C,EAAEy4C,WAAW,WAAWnoD,KAAKolD,QAAQplD,KAAKQ,QAAQ4nD,OAAOpoD,KAAKqnD,QAAQ9yB,iBAAiBv0B,KAAKQ,QAAQ4nD,QAAQ,CAACpoD,KAAKqnD,SAASrnD,KAAKglD,aAAa,EAAEt1C,EAAE24C,cAAc,SAASx8C,EAAEnD,EAAE8G,GAAG,IAAIgwC,EAAE,CAAC92C,GAAG0wC,OAAO5pC,GAAGxP,KAAKmiD,UAAUt2C,EAAE2zC,GAAGx/C,KAAKsoD,oBAAoBz8C,EAAEnD,EAAE8G,EAAE,EAAEE,EAAE44C,oBAAoB,SAASz8C,EAAEnD,EAAE8G,GAAG,IAAIgwC,EAAE3H,EAAEh1C,OAAO,GAAI28C,GAAIx/C,KAAKsnD,SAAb,CAA8B,IAAIlR,EAAEoJ,EAAE9F,MAAMhxC,GAAG0tC,EAAE3yC,KAAKoI,EAAE7L,KAAKsnD,SAASxiD,QAAQsxC,EAAE5mC,EAAnD,CAAqD,EAAEE,EAAEk4C,aAAa,WAAW,IAAI/7C,EAAEyhB,iBAAiBttB,KAAKqnD,SAAa3+C,EAAE1I,KAAKuoD,kBAAkB18C,EAAE0X,KAAK,SAAa/T,EAAExP,KAAKuoD,kBAAkB18C,EAAEyX,IAAI,UAAUtjB,KAAKkP,SAASwU,EAAE4pB,MAAM5kC,GAAG,EAAEA,EAAE1I,KAAKkP,SAASsU,EAAE8pB,MAAM99B,GAAG,EAAEA,EAAExP,KAAKwoD,sBAAsB38C,EAAE,EAAE6D,EAAE64C,kBAAkB,SAAS18C,EAAEnD,GAAG,IAAoB,GAAjBmD,EAAEkqB,QAAQ,KAAS,CAAC,IAAIvmB,EAAEknC,EAAE12C,KAAKqnD,QAAQ5P,YAAY,OAAOjoC,EAAImI,WAAW9L,GAAG,IAAI2D,EAAE9G,GAAtB,CAAwB,CAAC,OAAOvD,SAAS0G,EAAE,GAAG,EAAE6D,EAAE84C,sBAAsB,SAAS38C,GAAG,IAAInD,EAAEmD,EAAE48C,UAAU,GAAyB,IAAtB//C,EAAEqtB,QAAQ,UAAb,CAAmC,IAAIvmB,EAAE9G,EAAEI,MAAM,KAAS02C,EAA0B,IAAxB92C,EAAEqtB,QAAQ,YAAgB,GAAG,EAAMqgB,EAAEjxC,SAASqK,EAAEgwC,GAAG,IAAQ3H,EAAE1yC,SAASqK,EAAEgwC,EAAE,GAAG,IAAIx/C,KAAKkP,SAASwU,GAAG0yB,EAAEp2C,KAAKkP,SAASsU,GAAGq0B,CAA/I,CAAgJ,EAAEnoC,EAAEg5C,cAAc,SAAS78C,EAAEnD,GAAG1I,KAAKqnD,QAAQsB,UAAUvuC,IAAI,mBAAmBpa,KAAKsoD,oBAAoB,cAAcz8C,EAAE,CAACnD,GAAG,EAAEgH,EAAE2zC,YAAY,SAASx3C,EAAEnD,GAAS1I,KAAKslD,gBAAgBz5C,IAAW7L,KAAK+zC,WAAuC/zC,KAAKulD,mBAAmB,CAAC5gC,MAAMjc,EAAEic,MAAMC,MAAMlc,EAAEkc,OAAO/Y,EAAE4qB,iBAAiBz2B,KAAKwlD,kBAAkBxlD,KAAKsjD,qBAAqBz3C,GAAG7L,KAAKqnD,QAAQsB,UAAUvuC,IAAI,mBAAmBpa,KAAKqoD,cAAc,cAAcx8C,EAAE,CAACnD,KAA3O1I,KAAKwkD,eAAyO,EAAE90C,EAAEo3C,UAAU,SAASj7C,EAAEnD,GAAO1I,KAAK+zC,YAAkB/zC,KAAK4nD,eAAe5nD,KAAK4oD,qBAAqB5oD,KAAK+nD,cAAcrkC,EAAE1jB,KAAKkP,SAASwU,EAAE1jB,KAAK+nD,cAAcvkC,EAAExjB,KAAKkP,SAASsU,EAAExjB,KAAK6oD,aAAa7oD,KAAK8nD,UAAUpkC,EAAE,EAAE1jB,KAAK8nD,UAAUtkC,EAAE,EAAExjB,KAAKqnD,QAAQsB,UAAUvuC,IAAI,eAAepa,KAAKqoD,cAAc,YAAYx8C,EAAE,CAACnD,IAAI1I,KAAK8oD,UAAS,EAAEp5C,EAAEk5C,mBAAmB,WAAW,IAAI/8C,EAAE7L,KAAK+oD,eAAe,GAAIl9C,EAAJ,CAAc,IAAInD,EAAEguC,EAAE12C,KAAKqnD,SAAa73C,EAAEknC,EAAE7qC,GAAO2zC,EAAEx/C,KAAKqnD,QAAQ2B,wBAA4B5S,EAAEvqC,EAAEm9C,wBAA4BnR,EAAEroC,EAAEiyC,gBAAgBjyC,EAAEkyC,iBAAqB5W,EAAEt7B,EAAEmyC,eAAenyC,EAAEoyC,kBAAsBlyC,EAAE1P,KAAKipD,sBAAsB,CAACvlC,EAAE87B,EAAEj8B,MAAM6yB,EAAE7yB,KAAK/T,EAAEiyC,iBAAiBj+B,EAAEg8B,EAAEl8B,KAAK8yB,EAAE9yB,IAAI9T,EAAEmyC,iBAAiB3hD,KAAKkpD,YAAY,CAAC/I,MAAM3wC,EAAE2wC,MAAMtI,EAAEnoC,EAAEgU,EAAEhb,EAAEy3C,MAAMO,OAAOlxC,EAAEkxC,OAAO5V,EAAEp7B,EAAE8T,EAAE9a,EAAEg4C,OAAjX,CAAwX,EAAEhxC,EAAEq5C,aAAa,WAAW,IAAIl9C,EAAE7L,KAAKQ,QAAQ2oD,YAAY,GAAIt9C,EAAyC,OAAzBA,aAAau9C,YAAyBv9C,EAAe,iBAAHA,EAAoB4F,SAASipC,cAAc7uC,GAAU7L,KAAKqnD,QAAQ5P,UAAU,EAAE/nC,EAAEs4C,cAAc,SAASn8C,EAAEnD,EAAE8G,GAAGxP,KAAKsoD,oBAAoB,cAAcz8C,EAAE,CAACnD,EAAE8G,GAAG,EAAEE,EAAEq3C,SAAS,SAASl7C,EAAEnD,EAAE8G,GAAG,GAAIxP,KAAK+zC,UAAT,CAA2B,IAAIyL,EAAEhwC,EAAEkU,EAAM0yB,EAAE5mC,EAAEgU,EAAMq0B,EAAE73C,KAAKQ,QAAQ6oD,KAASve,EAAE+M,GAAGA,EAAE,GAAOnoC,EAAEmoC,GAAGA,EAAE,GAAG2H,EAAEtJ,EAAEsJ,EAAE1U,GAAGsL,EAAEF,EAAEE,EAAE1mC,GAAG8vC,EAAEx/C,KAAKspD,YAAY,IAAI9J,EAAE1U,GAAGsL,EAAEp2C,KAAKspD,YAAY,IAAIlT,EAAE1mC,GAAG8vC,EAAqB,KAAnBx/C,KAAKQ,QAAQ+oD,KAAU,EAAE/J,EAAEpJ,EAAqB,KAAnBp2C,KAAKQ,QAAQ+oD,KAAU,EAAEnT,EAAEp2C,KAAKkP,SAASwU,EAAE1jB,KAAK+nD,cAAcrkC,EAAE87B,EAAEx/C,KAAKkP,SAASsU,EAAExjB,KAAK+nD,cAAcvkC,EAAE4yB,EAAEp2C,KAAK8nD,UAAUpkC,EAAE87B,EAAEx/C,KAAK8nD,UAAUtkC,EAAE4yB,EAAEp2C,KAAKqoD,cAAc,WAAWx8C,EAAE,CAACnD,EAAE8G,GAApW,CAAuW,EAA2DE,EAAE45C,YAAY,SAASz9C,EAAEnD,EAAE8G,GAAG,IAAIxP,KAAKQ,QAAQ2oD,YAAa,OAAOzgD,EAAE,IAAI82C,EAAK,KAAH3zC,EAAO,QAAQ,SAAiDgsC,EAAE3B,GAApCl2C,KAAKipD,sBAAsBp9C,GAAc2D,EAAE,QAAYs7B,EAAE9qC,KAAKkpD,YAAY1J,GAAoB,OAAjB1U,EAAEoL,EAAEpL,EAAEt7B,EAAE,SAAgBqI,KAAKssB,IAAI0T,EAAEhgC,KAAK2xC,IAAI1e,EAAEpiC,GAAG,EAAEgH,EAAEu4C,YAAY,SAASp8C,EAAEnD,GAAG1I,KAAKqnD,QAAQsB,UAAU3uB,OAAO,mBAAmBh6B,KAAKsoD,oBAAoB,YAAYz8C,EAAE,CAACnD,GAAG,EAAEgH,EAAEs3C,QAAQ,SAASn7C,EAAEnD,GAAO1I,KAAK+zC,YAAkB/zC,KAAKqnD,QAAQhU,MAAMoV,UAAU,GAAGzoD,KAAK6oD,aAAa7oD,KAAKqnD,QAAQsB,UAAU3uB,OAAO,eAAeh6B,KAAKqoD,cAAc,UAAUx8C,EAAE,CAACnD,IAAG,EAAEgH,EAAEo5C,QAAQ,WAAW,GAAI9oD,KAAKsmD,WAAT,CAA4BtmD,KAAKypD,eAAe,IAAI/gD,EAAE1I,KAAK0pD,uBAAsB,WAAahhD,EAAEogD,SAAS,GAA9E,CAAgF,EAAEp5C,EAAEm5C,WAAW,WAAW7oD,KAAKqnD,QAAQhU,MAAM9vB,KAAK,GAAGvjB,KAAKkP,SAASwU,MAAM1jB,KAAKqnD,QAAQhU,MAAM/vB,IAAI,GAAGtjB,KAAKkP,SAASsU,KAAK,EAAE9T,EAAE+5C,aAAa,WAAWzpD,KAAKqnD,QAAQhU,MAAMoV,UAAU,gBAAgBzoD,KAAK8nD,UAAUpkC,QAAQ1jB,KAAK8nD,UAAUtkC,SAAS,EAAE9T,EAAEy3C,YAAY,SAASt7C,EAAGnD,GAAG1I,KAAKqoD,cAAc,cAAcx8C,EAAE,CAACnD,GAAG,EAAEgH,EAAEi6C,YAAY,SAAS99C,EAAGnD,GAAG1I,KAAKkP,SAASwU,EAAE7X,EAAE7L,KAAKkP,SAASsU,EAAE9a,EAAE1I,KAAK6oD,YAAY,EAAEn5C,EAAEw4C,OAAO,WAAWloD,KAAK+zC,WAAU,CAAI,EAAErkC,EAAEk6C,QAAQ,WAAW5pD,KAAK+zC,WAAU,EAAS/zC,KAAKsmD,YAAYtmD,KAAKgnD,SAAU,EAAEt3C,EAAEm6C,QAAQ,WAAW7pD,KAAK4pD,UAAU5pD,KAAKqnD,QAAQhU,MAAMoV,UAAU,GAAGzoD,KAAKqnD,QAAQhU,MAAM9vB,KAAK,GAAGvjB,KAAKqnD,QAAQhU,MAAM/vB,IAAI,GAAGtjB,KAAKqnD,QAAQhU,MAAMnkC,SAAS,GAAGlP,KAAKklD,gBAAmBllD,KAAKsnD,UAAUtnD,KAAKsnD,SAASwC,WAAW,cAAe,EAAEp6C,EAAEowC,MAA7/J,WAAa,EAA2/J1J,GAAGA,EAAE2J,SAAS3J,EAAE2J,QAAQ,cAAcjV,GAAUA,CAAC,CAAnqK0U,CAAEhwC,EAAEA,EAAEwwC,QAAQxwC,EAAEu1C,YAE7C,MAAMqC,EAAc3lD,OAAO2lD,YAyNZ,MAAM2C,UAAqB,IACtCjW,WACI9zC,KAAKwiB,QAAU9d,EAjMH,swJAmMZ1E,KAAKgqD,cAAgB,GAErBhqD,KAAKiqD,aACLjqD,KAAKkqD,cACLlqD,KAAKmqD,mBACLnqD,KAAKoqD,iBACLpqD,KAAKqqD,cACLrqD,KAAKsqD,aACLtqD,KAAKuqD,gBAELvqD,KAAKwiB,QAAQjO,GAAG,cAAe,aAAa7L,IACxCA,EAAE+tB,iBAEF,MAAMh3B,EAAQiF,EAAEgE,EAAEiK,QAAQ+B,QAAQ,aAAa3B,KAAK,eAEpD,SAAiB,CACb2Q,EAAGhb,EAAEic,MACLnB,EAAG9a,EAAEkc,MACL/B,MAAO,CACH,CAACvY,MAAO,KAAMua,QAAS,WAAYZ,OAAQ,WAC3C,CAAC3Z,MAAO,UAAWua,QAAS,iBAAkBZ,OAAQ,WACtD,CAAC3Z,MAAO,UAAWua,QAAS,eAAgBZ,OAAQ,WACpD,CAAC3Z,MAAO,aAAcua,QAAS,qBAAsBZ,OAAQ,sBAEjEM,sBAAuB,EAAEM,cACrB7kB,KAAKgI,eAAe6c,EAAS,CAACplB,SAAO,GAE3C,GAEV,CAEAwqD,aACIjqD,KAAKwqD,OAAS9lD,EAAE,WAChB1E,KAAKwiB,QAAQ7d,OAAO3E,KAAKwqD,OAC7B,CAEAN,cAMI,IAAIO,gBALmBxK,IACnBjgD,KAAK0qD,+BACL1qD,KAAKsqD,YAAY,IAGcK,QAAQ3qD,KAAKwiB,QAAQ,IAExDxiB,KAAK4qD,OAAO16C,SAAS26C,GAAU7qD,KAAK8qD,iBAAiBD,IACzD,CAEAN,gBACIvqD,KAAKwiB,QAAQ2kB,MACjB,CAEIyjB,aACA,OAAOp6B,MAAM7G,UAAU3Y,MAAM+F,KAAK/W,KAAKwiB,QAAQjW,KAAK,aACxD,CAEIw+C,oBACA,OAAO/qD,KAAKwiB,QAAQjW,KAAK,4BAC7B,CAEIy+C,gBACA,MAAMC,EAAejrD,KAAK4qD,OAAOnoD,OAC3ByoD,EAAqBlrD,KAAK+qD,cAAc,GAAG9nC,YArRnC,GACG,GAqRXkoC,EApRO,GAoRQF,EAAe,GAC9BG,GAAeF,EAAqBC,GAAeF,EACnDI,EAAqBxzC,KAAKssB,IA3RR,GA2RqCtsB,KAAK2xC,IA1R1C,IA0RuE4B,IACzFE,EAA4BzzC,KAAKshB,MAAMkyB,GAIvCE,EAAS,GACf,IAAIC,EAHiCN,GADHI,EAA4BL,EAAeE,GAM7E,IAAK,IAAI37C,EAAI,EAAGA,EAAIy7C,EAAcz7C,GAAK,EAAG,CACtC,MAAMi8C,EAAaH,EAnSC,KAmSsDE,EAAsB,EAAI,EAAI,EAExGD,EAAOj/C,KAAKg/C,EAA4BG,GAEpCD,EAAsB,IACtBA,GAAuB,EAE/B,CAMA,OAJIxrD,KAAK0rD,SACL1rD,KAAK0rD,QAAQ/nC,IAAI,QAAS,GAAG6nC,EA1ShB,QA6SVD,CACX,CAEAI,kBACI,MAAMC,EAAe,GAErB,IAAI18C,EArTuB,EAgU3B,OAVAlP,KAAKgrD,UAAU96C,SAAQiwC,IACnByL,EAAat/C,KAAK4C,GAClBA,GAAYixC,EArTH,CAqTuB,IAGpCjxC,GAxTa,EA6TN,CAAC08C,eAAcC,eAHC38C,EAGe48C,eAFf58C,EAAW,GAGtC,CAEAo7C,aACI,MAAMyB,EAAqB/rD,KAAKgrD,UAEhChrD,KAAK4qD,OAAO16C,SAAQ,CAAC26C,EAAOr7C,KACxB,MAAM2wC,EAAQ4L,EAAmBv8C,GAEjCq7C,EAAMxX,MAAM8M,MAAQ,GAAGA,MACvB0K,EAAMmB,gBAAgB,YACtBnB,EAAMmB,gBAAgB,cACtBnB,EAAMmB,gBAAgB,WAElB7L,EAzUO,IAyUiB0K,EAAM5T,aAAa,WAAY,IACvDkJ,EAzUS,IAyUiB0K,EAAM5T,aAAa,aAAc,IAC3DkJ,EAzUM,IAyUiB0K,EAAM5T,aAAa,UAAW,GAAG,IAGhE,IAAIgV,EAAY,GAEhB,MAAM,aAACL,EAAY,eAAEC,EAAc,eAAEC,GAAkB9rD,KAAK2rD,kBAE5DC,EAAa17C,SAAQ,CAAChB,EAAUM,KAC5By8C,GAAa,uBAAwBz8C,EAAI,+BAAiCN,cAAsB,IAGpG+8C,GAAa,0CAA2CJ,gBACxDI,GAAa,4CAA6CH,gBAE1D9rD,KAAKwqD,OAAO7kC,KAAKsmC,EACrB,CAEAC,OAAOzsD,GACH,MAAM0sD,EAAOznD,EAzVL,gTAyVgBqO,KAAK,cAAetT,GAE5C,mCAA+C0sD,GAE/CA,EAAKtoC,SAAS,2BAEdlb,YAAW,IAAMwjD,EAAKC,YAAY,4BAA4B,KAE9DpsD,KAAKqsD,QAAQC,OAAOH,GACpBnsD,KAAKuqD,gBACLvqD,KAAK8qD,iBAAiBqB,GACtBnsD,KAAKusD,YAAYJ,EAAM,QACvBnsD,KAAK0qD,+BACL1qD,KAAKsqD,aACLtqD,KAAKmqD,kBACT,CAEAqC,uBAAsB,IAAC53C,IACnB,MAAMnV,EAAQmV,EAAIF,QAAQ,aAAa3B,KAAK,eAE5C,uCAAwCtT,EAC5C,CAEAqrD,iBAAiBqB,GACbA,EAAK53C,GAAG,aAAa7L,IACjB,GAAgB,IAAZA,EAAE2b,MAGF,OAFA,uCAAwC8nC,EAAKp5C,KAAK,iBAE3C,CACX,GAER,CAEI05C,kBACA,OAAOzsD,KAAKwiB,QAAQjW,KAAK,qBAAqB,EAClD,CAEAzF,4BACI,IAAIhD,EAAoB,wCAExB,IAAKA,EACD,OAGAA,EAAkBkD,YAClBlD,EAAoB,wCAAyCA,EAAkBkD,YAGnF,MAAM6jD,EAAQ7qD,KAAK0sD,WAAW5oD,EAAkBrE,OAAO,GACjDgtD,EAAczsD,KAAKysD,YACrBA,IAAgB5B,IAChB4B,GAAaA,EAAYT,gBAAgB,UACzCnB,GAAOA,EAAM5T,aAAa,SAAU,IAC5C,CAEA0V,4BAA2B,YAACztD,IACnBA,EAAY8H,WACbhH,KAAKksD,OAAOhtD,EAAYO,MAEhC,CAEAmtD,UAAUntD,GACN,MAAMorD,EAAQ7qD,KAAK0sD,WAAWjtD,GAAO,GAEjCorD,IACAA,EAAMpT,WAAWC,YAAYmT,GAC7B7qD,KAAK0qD,+BACL1qD,KAAKsqD,aACLtqD,KAAKmqD,mBACLnqD,KAAKuqD,gBAEb,CAEAsC,mBACI,OAAO7sD,KAAK4qD,OAAOj/C,KAAIyJ,GAAMA,EAAG0K,aAAa,gBACjD,CAEAysC,YAAYJ,EAAM7hD,GACd6hD,EAAKp5C,KAAK,QAASzI,GACnB6hD,EAAK5/C,KAAK,mBACLgZ,KAAKjb,EACd,CAEAoiD,WAAWjtD,GACP,OAAOO,KAAKwiB,QAAQjW,KAAK,iBAAiB9M,MAC9C,CAEAqtD,SAASX,GACL,OAAOA,EAAKp5C,KAAK,cACrB,CAEAg6C,yBAAwB,OAACt+C,IACrB,IAAK,MAAMhP,KAASgP,EAChBzO,KAAK4sD,UAAUntD,EAEvB,CAEAirD,+BACI1qD,KAAK4qD,OAAO16C,SAAS26C,GAAUA,EAAMlC,UAAU3uB,OAAO,8BAC1D,CAEAmwB,mBACI,MAAMS,EAAS5qD,KAAK4qD,QACd,aAACgB,GAAgB5rD,KAAK2rD,kBAExB3rD,KAAKsmD,aACLtmD,KAAKsmD,YAAa,EAClBtmD,KAAKwiB,QAAQ4pC,YAAY,6BACzBpsD,KAAKgtD,oBAAoB3F,QAAQsB,UAAU3uB,OAAO,wBAClDh6B,KAAKgtD,oBAAoB3F,QAAQhU,MAAMoV,UAAY,GACnDzoD,KAAKgtD,oBAAoBhG,UACzBhnD,KAAKgtD,oBAAoB1G,YAAa,EACtCtmD,KAAKgtD,oBAAoBvD,aAAexJ,MACxCjgD,KAAKgtD,oBAAoBnD,UACzB7pD,KAAKgtD,oBAAsB,MAG/BhtD,KAAKgqD,cAAc95C,SAAQgmC,GAAKA,EAAE2T,YAElCe,EAAO16C,SAAQ,CAAC26C,EAAOoC,KACnB,MAAMC,EAAuBtB,EAAaqB,GACpCE,EAAc,IAAI/F,EAAYyD,EAAO,CACvCtB,KAAM,IACNnB,OAAQ,wBACRe,YAAanpD,KAAK+qD,cAAc,KAGpC/qD,KAAKgqD,cAAc19C,KAAK6gD,GAExBA,EAAY54C,GAAG,eAAe0rC,IAC1B,yCAA0C4K,EAAM/qC,aAAa,eAAe,IAGhFqtC,EAAY54C,GAAG,aAAa0rC,IACxBjgD,KAAKsmD,YAAa,EAClBtmD,KAAKgtD,oBAAsBG,EAC3BtC,EAAMlC,UAAUvuC,IAAI,wBACpBpa,KAAKwiB,QAAQqB,SAAS,4BAA4B,IAGtDspC,EAAY54C,GAAG,WAAW0rC,IACtBjgD,KAAKsmD,YAAa,EAClB,MAAM8G,EAAkBz1C,WAAWkzC,EAAMxX,MAAM9vB,MAC/CsnC,EAAMxX,MAAMoV,UAAY,uBAGxBiB,uBAAsBzJ,IAClB4K,EAAMxX,MAAM9vB,KAAO,IACnBsnC,EAAMxX,MAAMoV,UAAY,eAAgB2E,aAExC1D,uBAAsBzJ,IAClB4K,EAAMlC,UAAU3uB,OAAO,wBACvBh6B,KAAKwiB,QAAQ4pC,YAAY,6BAEzBvB,EAAMlC,UAAUvuC,IAAI,6BAEpBsvC,uBAAsBzJ,IAClB4K,EAAMxX,MAAMoV,UAAY,GAExBzoD,KAAKsqD,aACLtqD,KAAKmqD,kBAAkB,GAC1B,GACJ,GACJ,IAGLgD,EAAY54C,GAAG,YAAY,CAAC8C,EAAOg2C,EAASC,KAExC,MAAM1C,EAAS5qD,KAAK4qD,OACd2C,EAAe3C,EAAO70B,QAAQ80B,GAE9B2C,EAAsBN,EAAuBI,EAAW5pC,EACxD+pC,EAAyBztD,KAAK0U,QAAQ84C,EAAqB5B,GAC3D8B,EAAmB71C,KAAKssB,IAAI,EAAGtsB,KAAK2xC,IAAIoB,EAAOnoD,OAAQgrD,IAEzDF,IAAiBG,GACjB1tD,KAAK2tD,eAAe9C,EAAO0C,EAAcG,GAGzC71C,KAAK4uC,IAAI6G,EAAW9pC,GAAK,KACzBxjB,KAAKgI,eAAe,qBAAsB,CAACvI,MAAOO,KAAK8sD,SAASpoD,EAAEmmD,KACtE,GACF,GAEV,CAEA8C,eAAe9C,EAAO+C,EAAaF,GAC/B,GAAIA,EAAmBE,EACnB/C,EAAMpT,WAAWoW,aAAahD,EAAO7qD,KAAK4qD,OAAO8C,QAC9C,CACH,MAAMI,EAAW9tD,KAAK4qD,OAAO8C,EAAmB,IAAM1tD,KAAKqsD,QAAQ,GAEnExB,EAAMpT,WAAWoW,aAAahD,EAAOiD,EACzC,CACA9tD,KAAKsH,aAAa,aAAc,CAACgI,cAAetP,KAAK6sD,qBACrD7sD,KAAKsqD,YACT,CAEAF,iBACIpqD,KAAKqsD,QAAU3nD,EAthBI,qFAwhBnB1E,KAAK+qD,cAAcpmD,OAAO3E,KAAKqsD,QACnC,CAEAhC,cACIrqD,KAAK0rD,QAAUhnD,EA3hBJ,sCA6hBX1E,KAAK+qD,cAAcpmD,OAAO3E,KAAK0rD,QACnC,CAEAh3C,QAAQtB,EAAO43B,GACX,IAAIt2B,EAAUq5C,IACVC,GAAgB,EASpB,OAPAhjB,EAAM96B,SAAQ,CAACD,EAAGT,KACVqI,KAAK4uC,IAAIrzC,EAAQnD,GAAKyE,IACtBA,EAAUmD,KAAK4uC,IAAIrzC,EAAQnD,GAC3B+9C,EAAex+C,EACnB,IAGGw+C,CACX,CAEAC,+BAA8B,YAAC/uD,IAC3Bc,KAAK8G,4BAEL9G,KAAKkuD,cAAchvD,EAAY8H,WAAa9H,EAAYO,MAC5D,CAEAoH,mBAAkB,YAAC3H,IACfc,KAAKkuD,cAAchvD,EAAY8H,WAAa9H,EAAYO,MAC5D,CAEAmQ,yBAAwB,aAACC,EAAY,aAAEC,IAC9BD,GAAiBC,IAMtB9P,KAAK0sD,WAAW78C,GAAckD,KAAK,cAAejD,GAClD9P,KAAKkuD,cAAcp+C,GACvB,CAEAq+C,uBAAsB,UAACnnD,EAAS,YAAEkK,IAC9B,QAAkBvJ,IAAdX,QAA2CW,IAAhBuJ,EAE3B,OAEJ,MAAM25C,EAAQ7qD,KAAK0sD,WAAW1lD,GAAW,GACzC6jD,EAAMpT,WAAWoW,aAAahD,EAAO7qD,KAAK4qD,OAAO15C,GACrD,CAEAg9C,cAAczuD,GACV,MAAM0sD,EAAOnsD,KAAK0sD,WAAWjtD,GAEvBP,EAAc,wCAAyCO,GAE7DO,KAAKouD,UAAUjC,EAAMjtD,EACzB,CAMAG,gBAAgB8sD,EAAMjtD,GAClB,IAAKitD,EAAK1pD,OACN,OAGJ,IAAK,MAAM4rD,KAAS79B,MAAMC,KAAK07B,EAAK,GAAGxD,WACrB,aAAV0F,GACAlC,EAAKC,YAAYiC,GAIzB,GAAInvD,EAAa,CACb,MAAM6yB,EAAclyB,EAAA,yBAAuBX,EAAY2B,eAEnDkxB,GACAo6B,EAAK5/C,KAAK,kBACL6/C,cACAvoC,SAAS,iBACTA,SAASkO,EAAY3S,yBAE1B+sC,EAAK5/C,KAAK,qBAAqBoX,IAAI,aAAcoO,EAAYhQ,mCAG7DoqC,EAAK5/C,KAAK,qBAAqB+hD,WAAW,QAElD,CAEA,MAAM,KAAChrD,GAAQpE,EAEf,IAAKoE,EAED,YADAtD,KAAKusD,YAAYJ,EAAM,QAI3B,MAAM7hD,QAAcpL,EAAYqS,qBAChCvR,KAAKusD,YAAYJ,EAAM7hD,GAEvB6hD,EAAKtoC,SAASvgB,EAAKse,eACnBuqC,EAAKtoC,SAAS5iB,EAAA,yBAAuBqC,EAAKG,OAC1C0oD,EAAKtoC,SAAS5iB,EAAA,yBAAuBqC,EAAKnD,MAC9C,CAEAd,6BAA4B,YAACoK,IACzB,IAAK,MAAMvK,KAAe,kCACtB,GAAKA,EAAYK,SAIbkK,EAAYC,eAAexK,EAAYK,SACvCkK,EAAY4J,mBAAmB9G,MAAKwG,GAChC,CAAC,YAAa,qBAAsB,+BAA+B5J,SAAS4J,EAAKO,OAC9E,cAA6BP,EAAM7T,EAAYoE,SACxD,CACE,MAAM6oD,EAAOnsD,KAAK0sD,WAAWxtD,EAAYO,OAEzCO,KAAKouD,UAAUjC,EAAMjtD,EACzB,CAER,CAEAqvD,qBACI,IAAK,MAAMrvD,KAAe,kCAAoC,CAC1D,MAAMitD,EAAOnsD,KAAK0sD,WAAWxtD,EAAYO,OAEzCO,KAAKouD,UAAUjC,EAAMjtD,EACzB,CACJ,CAEAmS,yBAAwB,MAAC5R,IACrB,MAAM0sD,EAAOnsD,KAAK0sD,WAAWjtD,GAE7B,GAAI0sD,EAAM,CACN,MAAMjtD,EAAc,wCAAyCO,GAE7DO,KAAKouD,UAAUjC,EAAMjtD,EACzB,CACJ,ECpqBW,MAAMsvD,UAA8B,IAC/C1a,WACI,IAAK7yC,EAAA,sBAAsBT,EAAA,KAAW,yBAClC,OAAOR,KAAKwiB,QAAU9d,EAAE,SAG5B1E,KAAKwiB,QAAU9d,EA9CX,krCA+CJ1E,KAAKwzC,eAEL,MAAMib,EAAUzuD,KAAKwiB,QAAQjW,KAAK,YAC5BmiD,EAAe1uD,KAAKwiB,QAAQjW,KAAK,iBACjCoiD,EAAe3uD,KAAKwiB,QAAQjW,KAAK,iBACjCqiD,EAAY5uD,KAAKwiB,QAAQjW,KAAK,cAIpC5D,YAAW,KACP,MAAMizC,EAAS36C,EAAA,uBAAqB,oBAChC26C,EAAO16C,cAAc2tD,oBAAoBC,iBACzCL,EAAQ5qC,SAAS,SACrB,GACD,KAEH4qC,EAAQl6C,GAAG,SAAS,KAChBk6C,EAAQ3pD,QAAQ,QAChB,MACMiqD,EADS9tD,EAAA,uBAAqB,oBACPC,cAAc2tD,mBACrBE,EAAcD,iBAEhCC,EAAcC,gBAAe,GAC7BP,EAAQrC,YAAY,YAEpB2C,EAAcC,gBAAe,GAC7BP,EAAQ5qC,SAAS,UACrB,IAGJ6qC,EAAan6C,GAAG,SAAS,KACrBm6C,EAAa5pD,QAAQ,QACN7D,EAAA,uBAAqB,oBAC7BC,cAAc2tD,mBAAmBI,UAAU,IAGtDN,EAAap6C,GAAG,SAAS,KACrBo6C,EAAa7pD,QAAQ,QACrB,MACMiqD,EADS9tD,EAAA,uBAAqB,oBACPC,cAAc2tD,mBAEvCE,EAAcG,cACdH,EAAcI,aAEdJ,EAAcK,UAClB,IAGJR,EAAUr6C,GAAG,SAAS,KAClBq6C,EAAU9pD,QAAQ,QACH7D,EAAA,uBAAqB,oBAC7BC,cAAc2tD,mBAAmBQ,OAAO,GAEvD,ECpGW,MAAMC,UAA0B5R,EAC3C/6C,cACIC,MAAM,UAEN5C,KAAKsmB,GAAG,aACRtmB,KAAK2jB,IAAI,SAAU,QACnB3jB,KAAKyzC,aACT,CAEAM,YACI,OAAOnxC,MAAMmxC,aAAevzC,EAAA,KAAW,kBAC3C,CAEA+uD,uBAAsB,YAAC9lD,IACnB,GAAIA,EAAY+lC,iBAAiB,mBAAoB,CACjD,MAAMggB,EAAUxvD,KAAK+zC,YAGrB,GAFA/zC,KAAKg0C,UAAUwb,GAEXA,EACAxvD,KAAKsH,aAAa,iBACf,CACH,MAAMxD,EAAoB,wCAC1B9D,KAAKsH,aAAa,gBAAiB,CAAC7H,MAAOqE,EAAkBrE,OACjE,CACJ,CACJ,0TCRJ,MAqHMgwD,EAA6B,IAG7BC,EAAyBhnD,GAAKA,EAAE0b,kBAEvB,MAAMurC,UAAuB,IACxChtD,cACIC,QAEA5C,KAAK4vD,SAAW,MACpB,CAEA9b,WACI9zC,KAAKwiB,QAAU9d,EAlIX,ssGAmIJ1E,KAAK6vD,MAAQ7vD,KAAKwiB,QAAQjW,KAAK,SAC/BvM,KAAK8vD,aAAe9vD,KAAKwiB,QAAQjW,KAAK,iBAEtCvM,KAAK6vD,MAAMt7C,GAAG,YAAa,mBAAmB,IAAM,gBACpDvU,KAAK6vD,MAAMt7C,GAAG,YAAa,0BAA0B7L,GAAK1I,KAAK+vD,cAAcrnD,KAC7E1I,KAAK6vD,MAAMt7C,GAAG,YAAa,oBAAoB7L,IAC3C,MAAMuJ,EAAOvN,EAAEsrD,GAAGC,UAAUC,QAAQxnD,GAC9B+J,EAAiB1S,EAAA,cAAwBkS,GAE/C,eAA6BQ,EAAgB,CACzC/O,YAAauO,EAAKC,KAAKxO,aACzB,IAGN1D,KAAK6vD,MAAMt7C,GAAG,YAAa,2BAA2B7L,IAClD,MAAMuJ,EAAOvN,EAAEsrD,GAAGC,UAAUC,QAAQxnD,GAEpC1I,KAAKgI,eAAe,YAAa,CAACzI,OAAQ0S,EAAKC,KAAK3S,QAAQ,IAIhES,KAAK6vD,MAAMt7C,GAAG,YAAa,oBAAoB7L,IAC3C,GAAgB,IAAZA,EAAE2b,MAAa,CACf,MAAMpS,EAAOvN,EAAEsrD,GAAGC,UAAUC,QAAQxnD,GAE9B5I,EAAWC,EAAA,cAAwBkS,GAErCnS,GACA,iDAAkDA,GAGtD4I,EAAE0b,kBACF1b,EAAE+tB,gBACN,KAGJz2B,KAAKmwD,mBAAqBnwD,KAAKwiB,QAAQjW,KAAK,wBAC5CvM,KAAKowD,2BAA6BpwD,KAAKmwD,mBAAmB5jD,KAAK,wBAC/DvM,KAAKqwD,sBAAwBrwD,KAAKmwD,mBAAmB5jD,KAAK,4BAE1DvM,KAAKswD,oBAAsBtwD,KAAKwiB,QAAQjW,KAAK,yBAC7CvM,KAAKswD,oBAAoB/7C,GAAG,SAAS7L,IACjC,GAAI1I,KAAKmwD,mBAAmB/2B,GAAG,YAE3B,YADAp5B,KAAKmwD,mBAAmBztC,OAI5B1iB,KAAKowD,2BAA2Bz7C,KAAK,UAAW3U,KAAKuwD,mBACrDvwD,KAAKqwD,sBAAsB17C,KAAK,UAAW3U,KAAKwwD,sBAEhD,MAAMltC,EAAMtjB,KAAK8vD,aAAa,GAAGW,UAAazwD,KAAKmwD,mBAAmBhtC,cAChEI,EAAO1L,KAAKssB,IACd,EACAnkC,KAAK8vD,aAAa,GAAGY,WAAa1wD,KAAKmwD,mBAAmB9sC,aAAerjB,KAAK8vD,aAAazsC,cAQ/F,OALArjB,KAAKmwD,mBAAmBxsC,IAAI,CACxBL,MACAC,SACD4jB,QAEI,CAAK,IAGhBnnC,KAAKmwD,mBAAmB57C,GAAG,SAAS7L,IAAMA,EAAE0b,iBAAiB,IAE7D1f,EAAE+M,UAAU8C,GAAG,SAAS,IAAMvU,KAAKmwD,mBAAmBztC,SAEtD1iB,KAAK2wD,wBAA0B3wD,KAAKmwD,mBAAmB5jD,KAAK,8BAC5DvM,KAAK2wD,wBAAwBp8C,GAAG,SAASlV,gBAC/BW,KAAK4wD,qBAAqB5wD,KAAKowD,2BAA2Bz7C,KAAK,kBAC/D3U,KAAK6wD,wBAAwB7wD,KAAKqwD,sBAAsB17C,KAAK,YAEnE3U,KAAKmwD,mBAAmBztC,OAExB1iB,KAAK8wD,qBAAqB,IAI9B7mD,QAAQwM,IAAI,CAACjW,EAAA,qBAA4BX,EAAA,6BAA2BmL,MAAK,IAAMhL,KAAK+wD,kBAEpF/wD,KAAKgxD,uBACT,CAEAA,wBAqBIhxD,KAAK6vD,MAAMt7C,GAAG,aAAc,wBAAwB7L,IAChDA,EAAEuoD,cAAc3mD,MAhBA,EAACob,EAAYwrC,KAC7B,MAAMC,EAAYzrC,EAAW0rC,SACvBC,EAAqBF,EAAU7tC,IAAMoC,EAAWvC,aAAY,GAC5DmuC,EAAsBH,EAAU5tC,KAAOmC,EAAWrC,YAAW,GAE7DkuC,EAAYL,EAAKE,SACjBI,EAAqBD,EAAUjuC,IAAM4tC,EAAK/tC,aAAY,GACtDsuC,EAAsBF,EAAUhuC,KAAO2tC,EAAK7tC,YAAW,GAE7D,OAAOguC,EAAqBG,GACrBL,EAAU7tC,IAAMiuC,EAAUjuC,KAC1BguC,EAAsBG,GACtBN,EAAU5tC,KAAOguC,EAAUhuC,IAAI,EAIdmuC,CAAY1xD,KAAK6vD,MAAOnrD,EAAEgE,EAAEuoD,gBAC9C,GACAvoD,EAAEuoD,cAAcU,SAAS,GAEvC,CAEIpB,wBACA,OAAO/vD,EAAA,KAAW,qBAAqBR,KAAK4vD,WAChD,CAEAvwD,2BAA2B+lB,SACjB5kB,EAAA,OAAa,qBAAqBR,KAAK4vD,WAAYxqC,EAAIpM,WACjE,CAEIw3C,2BACA,OAAOhwD,EAAA,KAAW,uBACtB,CAEAnB,8BAA8B+lB,SACpB5kB,EAAA,OAAa,uBAAwB4kB,EAAIpM,WACnD,CAEA+3C,gBACI,MAAMa,EAAW,CAAC5xD,KAAK6xD,mBAEvB7xD,KAAK6vD,MAAMI,UAAU,CACjB6B,gBAAgB,EAChBC,UAAU,EACVC,WAAY,CAAC,OAAQ,SAAU,UAC/BhX,OAAQ4W,EACRK,UAAW,CACP3uC,IAAK,IACL4uC,OAAQ,KAEZC,aAAcnyD,KAAK6vD,MACnBuC,eAAgB,EAChBC,MAAO,CAACh7C,EAAOnF,KACXlS,KAAKsyD,mBAEL,MAAMC,EAAargD,EAAKqgD,WAClBtgD,EAAOC,EAAKD,KAElB,GAAIA,EAAKugD,cAA+B,SAAfD,EAKrB,OAJAvyD,KAAKgI,eAAe,wBAAyB,CACzC+J,wBAAyB/R,KAAKyyD,2BAA2BxgD,MAGtD,EAEN,GAAmB,UAAfsgD,GAAyC,SAAfA,EAAuB,CACtD,GAAIl7C,EAAMq7C,SAAU,CAChB,MAAMC,EAAa3yD,KAAKwS,gBAExB,GAAImgD,EAAWjgD,cAAgBT,EAAKS,YAChC,OAKJ,SAASkgD,EAAgBC,EAAOC,GAC5B,IAAK,IAAItjD,EAAI,EAAGqjD,GAASA,IAAUC,GAAUtjD,EAAI,IAAOA,IACpDqjD,EAAME,aAAY,GAClBF,EAAQA,EAAMG,iBAGlBF,EAAOC,aACX,CATA/yD,KAAKizD,qBAWDN,EAAWO,WAAajhD,EAAKihD,WAC7BN,EAAgBD,EAAY1gD,GAE5B2gD,EAAgB3gD,EAAM0gD,GAG1B1gD,EAAKkhD,UAAS,EAClB,MACK,IAAMlyD,EAAA,iBAAiBoW,EAAMC,SAAarW,EAAA,iBAAiBoW,EAAMqzB,QAAU,CAC5E,MAAM5qC,EAAWC,EAAA,cAAwBkS,GACzC,iDAAkDnS,EACtD,MACSuX,EAAM+7C,QACXnhD,EAAK8gD,aAAa9gD,EAAKugD,cACvBvgD,EAAKkhD,UAAS,IAETjhD,EAAKD,KAAKlJ,WAEf/I,KAAKD,KAAKszD,YAAW,GAGrBphD,EAAKqhD,YAGT,OAAO,CACX,GAEJC,eAAgB,CAACl8C,GAAQpF,UAOyB,YAA1C,uBAI4B,SAArBA,EAAKC,KAAK3S,OAIO,YAArB0S,EAAKC,KAAK3S,OAErBC,SAAUH,MAAOgY,EAAOnF,KAEpB,WAEAlS,KAAKizD,qBAEL,MAAMnzD,EAAWC,EAAA,cAAwBmS,EAAKD,MAExCnO,EAAoB,8CACpBA,EAAkBsF,QAAQtJ,EAAS,EAE7C0zD,OAAQ,CAACn8C,EAAOnF,IAASlS,KAAKyzD,YAAYvhD,EAAKD,KAAKC,KAAKG,UAAU,GACnEqhD,SAAU,CAACr8C,EAAOnF,IAASlS,KAAKyzD,YAAYvhD,EAAKD,KAAKC,KAAKG,UAAU,GACrEzG,OAAQ,CACJmc,SAAS,EACT4rC,KAAM,OACNC,YAAY,GAEhBC,KAAM,CACFC,aAAc,IACdC,oBAAoB,EACpBjN,UAAW,CAAC70C,EAAMC,KACd,GAAI,CAAC,OAAQ,UAAW,UAAW,wBAAyB,uBAAuB/I,SAAS8I,EAAKC,KAAK3S,SAC/F0S,EAAKC,KAAK3S,OAAO2I,WAAW,YAC/B,OAAO,EAGX,MAAM2Q,EAAQ7Y,KAAKgS,yBAAyBC,GAAMtG,KAAIsG,IAAQ,CAC1D1S,OAAQ0S,EAAKC,KAAK3S,OAClB8S,SAAUJ,EAAKC,KAAKG,SACpB/H,MAAO2H,EAAK3H,UAgBhB,OAbqB,IAAjBuO,EAAMpW,OACN,eAAuBoW,EAAM,GAAGtZ,OAAQ,CAACmrB,eAAe,EAAMgN,oBAAoB,IAC7E1sB,MAAKkZ,GAAShS,EAAK8hD,aAAaC,QAAQ,YAAa/vC,EAAM,GAAGyG,aAGnE1gB,QAAQwM,IAAIoC,EAAMlN,KAAIrI,GAAQ,eAAuBA,EAAK/D,OAAQ,CAACmrB,eAAe,EAAMgN,oBAAoB,OAAS1sB,MAAKyf,IACtH,MAAMypC,EAAQxvD,EAAE,QAAQC,UAAU8lB,EAAM9e,KAAIuY,GAASxf,EAAE,QAAQC,OAAOuf,MAEtEhS,EAAK8hD,aAAaC,QAAQ,YAAaC,EAAM,GAAGvpC,UAAU,IAIlEzY,EAAK8hD,aAAaC,QAAQ,OAAQnoD,KAAKC,UAAU8M,KAC1C,CAAI,EAEfs7C,UAAW,CAACliD,EAAMC,IACa,WAAvBD,EAAKC,KAAKiW,UAEkB,YAArBlW,EAAKC,KAAK3S,SAEV0S,EAAKC,KAAK3S,OAAO2I,WAAW,cAEL,aAAvB+J,EAAKC,KAAKiW,SACV,CAAC,SAAU,UACX,CAAC,wBAAyB,uBAAuBhf,SAAS8I,EAAKC,KAAK3S,SACpE,CAAC,SAKhB60D,SAAU/0D,MAAO4S,EAAMC,KACnB,GAAsB,SAAjBA,EAAKmiD,SAA6C,WAAvBpiD,EAAKC,KAAKiW,UACrC,CAAC,QAAS,UAAUhf,SAAS+I,EAAKmiD,WAC3BpiD,EAAKC,KAAK3S,SAAW,wBAA4E,WAAnC0S,EAAKS,YAAYR,KAAKiW,UAI5F,kBAFMyY,EAAA,OAAmB,iBAK7B,MAAMozB,EAAe9hD,EAAK8hD,aAE1B,GAAIA,GAAgBA,EAAa9hC,OAAS8hC,EAAa9hC,MAAMzvB,OAAS,EAAG,CACrE,MAAMyvB,EAAQ,IAAI8hC,EAAa9hC,cAEH,qFAEdD,YAAY,QAAShgB,EAAKC,KAAK3S,OAAQ2yB,EAAO,CACxDoiC,YAAY,EACZC,cAAc,EACdC,oBAAoB,EACpBC,oBAAoB,EACpBC,iBAAiB,EACjBC,8BAA8B,GAEtC,KACK,CACD,MAAMC,EAAUZ,EAAaa,QAAQ,QACrC,IAAIh8C,EAAQ,KAEZ,IACIA,EAAQ/M,KAAK0P,MAAMo5C,EACvB,CACA,MAAOlsD,GAEH,YADAE,SAAS,sBAAsBgsD,yBAEnC,CAKA,MAAME,EAAoBj8C,EAAMlN,KAAIrI,GAAQA,EAAK+O,WAEjD,GAAqB,WAAjBH,EAAKmiD,QACL,qBAA+BS,EAAmB7iD,EAAKC,KAAKG,eACzD,GAAqB,UAAjBH,EAAKmiD,QACZ,oBAA8BS,EAAmB7iD,EAAKC,KAAKG,cACxD,IAAqB,SAAjBH,EAAKmiD,QAGZ,MAAM,IAAI7mD,MAAM,oBAAoB0E,EAAKmiD,YAFzC,qBAA+BS,EAAmB7iD,EAAKC,KAAKG,SAGhE,CACJ,IAGR0iD,SAAU,CAAC19C,EAAOnF,KACd,MAAM,OAAC3S,EAAM,SAAE4oB,GAAYjW,EAAKD,KAAKC,KAErC,GAAiB,WAAbiW,EAAuB,CAIvB,GAHiBpoB,EAAA,cAAwBmS,EAAKD,KAAKS,aAGtCvJ,SAAS5J,GAElB,YADA2S,EAAK4gB,OAAS,IAIlB5gB,EAAK4gB,OAASjzB,EAAA,uBAAqBN,GAAQyL,MAAK,KAC5C,MAAM1H,EAAOzD,EAAA,yBAAuBN,GAEpC,IAAI4rB,EAAe7nB,EAAKkZ,kBAMxB,MAJkB,WAAdlZ,EAAKG,MAAqB0nB,EAAa1oB,OAASgtD,IAChDtkC,EAAeA,EAAana,MAAM,EAAGy+C,IAGlC5vD,EAAA,iBAAesrB,EAAa,IACpCngB,MAAK,KACJ,MAAM1H,EAAOzD,EAAA,yBAAuBN,GAEpC,OAAOS,KAAKg1D,gBAAgB1xD,EAAK,GAEzC,MAEI4O,EAAK4gB,OAASjzB,EAAA,oBAAkBN,GAAQyL,MAAK1H,GAAQtD,KAAKg1D,gBAAgB1xD,IAC9E,EAEJ2xD,OAAQ,CACJC,uBAAuB,GAE3BC,aAAc91D,eAAgBgY,EAAOnF,GACjC,MAAMD,EAAOC,EAAKD,KAElB,IAAKA,EAAKC,KAAK3S,OAGX,OAGJ,MAAM+D,QAAazD,EAAA,gBAAcoS,EAAKC,KAAK3S,QAAQ,GAEnD,IAAK+D,EACD,OAGJ,MAAMQ,EAAoB,wCAEpBsxD,EAAQ1wD,EAAEuN,EAAKojD,MAErBD,EAAM7oD,KAAK,qBAAqBytB,SAEhC,MAAMs7B,EAAgBxxD,GAAqBA,EAAkBjD,gBAAkByC,EAAK/D,QAA0B,SAAhB+D,EAAK/D,OAEnG,GAAI+D,EAAK4c,SAAS,eAAiBo1C,EAAe,CAC9C,MAAMC,EAAwB7wD,EAAE,qGAC3B6P,GAAG,QAASm7C,GAEjB0F,EAAMzwD,OAAO4wD,EACjB,CAEA,GAAkB,WAAdjyD,EAAKG,KAAmB,CACxB,MAAM+xD,EAAuB9wD,EAAE,gGAC1B6P,GAAG,QAASm7C,GAEjB0F,EAAMzwD,OAAO6wD,EACjB,CAEA,IAAK,CAAC,SAAU,YAAYrsD,SAAS7F,EAAKG,QAAUH,EAAK+E,cAAgB/E,EAAK8E,oBAAqB,CAC/F,MAAMqtD,EAAyB/wD,EAAE,mFAC5B6P,GAAG,QAASm7C,GAEjB0F,EAAMzwD,OAAO8wD,EACjB,CAEA,GAAIH,EAAe,CACf,MAAMI,EAAiBhxD,EAAE,sFACpB6P,GAAG,QAASm7C,GAEjB0F,EAAMzwD,OAAO+wD,EACjB,CACJ,EAEAC,aAAc,CAACt+C,EAAOnF,KAClBA,EAAKD,KAAK2jD,OAAOC,IAGTA,EAAQC,eAAiBD,EAAQr8C,cACjCq8C,EAAQv5B,MACZ,GACF,EAENy5B,OAAQ,CAAC1+C,GAAQpF,WACiC,SAA1C,wBACwB,YAArBA,EAAKC,KAAK3S,QACV0S,EAAKugD,aAIRvgD,EAAK8gD,aAAY,GAKrBruD,EAAEuN,EAAKojD,MAAM9oD,KAAK,0BAA0BwG,KAAK,QAC7Cd,EAAKugD,aAAe,eAAiB,GAAG,IAI/CvxD,EAAA,oBACDjB,KAAKg2D,aAAahrD,MAAKirD,IACnB,IAAK,MAAMzkC,KAAOykC,EAAS,CACvB,MAAM3xC,EAAU2xC,EAAQzkC,GAExB9sB,EAAE1E,KAAKD,KAAK2lB,YAAYnR,GAAG,UAAW,KAAMid,GAAK8E,IAC7C,MAAMrkB,EAAOjS,KAAKD,KAAKyS,gBACvB,OAAO8R,EAAQrS,EAAMqkB,EAAI,GAGjC,KAIRt2B,KAAK6vD,MAAMt7C,GAAG,cAAe,mBAAmB7L,IAC5C,MAAMuJ,EAAOvN,EAAEsrD,GAAGC,UAAUC,QAAQxnD,GAepC,OAda7I,EAAA,yBAAuBoS,EAAKC,KAAK3S,QAErC6I,oBACL,oFAA4C4C,MAAK,EAAEqX,QAAS6zC,MAC5B,IAAIA,EAAoBl2D,KAAMiS,GACtCk1B,KAAKz+B,EAAE,IAG/B,oFAAwCsC,MAAK,EAAEqX,QAAS8zC,MAC5B,IAAIA,EAAgBn2D,KAAMiS,GAClCk1B,KAAKz+B,EAAE,KAIxB,CAAK,IAGhB1I,KAAKD,KAAO2E,EAAEsrD,GAAGC,UAAUmG,QAAQp2D,KAAK6vD,MAC5C,CAEAgC,kBACI,OAAO7xD,KAAKq2D,YAAYx2D,EAAA,kBAAgB,aAC5C,CAKAm1D,gBAAgB/3C,GACZhc,EAAA,wBAAsBgc,GAEtB,MAAMq5C,EAAW,GAEX/F,EAAoBvwD,KAAKuwD,kBAE/B,IAAI9wC,EAAgBxC,EAAWuC,2BAEP,WAApBvC,EAAWxZ,MAAqBgc,EAAchd,OAASgtD,IACvDhwC,EAAgBA,EAAczO,MAAM,EAAGy+C,IAG3C,IAAK,MAAMrpC,KAAU3G,EAAe,CAChC,GAAI8wC,GACanqC,EAAO1M,mBAEXwG,SAAS,YACd,SAIR,MAAMjO,EAAOjS,KAAKq2D,YAAYjwC,GAE9BkwC,EAAShqD,KAAK2F,EAClB,CAEA,OAAOqkD,CACX,CAEAj3D,iBAAiB4S,GACb,MAAM3O,EAAOzD,EAAA,yBAAuBoS,EAAKC,KAAK3S,QACxC6mB,EAASvmB,EAAA,kBAAgBoS,EAAKC,KAAKG,UAEzC,IAAK/O,EAED,YADA2R,QAAQY,IAAI,0CAA0C5D,EAAKC,KAAK3S,0BAE7D,IAAK6mB,EAER,YADAnR,QAAQY,IAAI,4CAA4C5D,EAAKC,KAAKG,4BAItE,MAAM/H,EAAQ,GAAG8b,EAAO7M,OAAS,GAAI6M,EAAO7M,YAAe,KAAKjW,EAAKgH,QAErE2H,EAAKC,KAAKxO,YAAcJ,EAAKI,YAC7BuO,EAAKC,KAAKiW,SAAW7kB,EAAKG,KAC1BwO,EAAKoW,OAAS/kB,EAAK+b,WACnBpN,EAAKsU,KAAOjjB,EAAK2b,UACjBhN,EAAKskD,aAAev2D,KAAKw2D,gBAAgBlzD,GACzC2O,EAAK3H,MAAQrJ,EAAA,mBAAiBqJ,GAE1B2H,EAAKuH,eAAiB4M,EAAO5M,kBACvBvH,EAAKwhD,YAAYrtC,EAAO5M,WAAY,CAACi9C,UAAU,EAAMC,aAAa,IAG5EzkD,EAAKqW,aACT,CAMA+tC,YAAYjwC,EAAQuwC,GAAY,GAC5B,MAAMrzD,EAAO8iB,EAAO1M,mBAEpB,IAAKpW,EACD,MAAM,IAAIkK,MAAM,WAAW4Y,EAAO/T,gCAAgC+T,EAAO7mB,WAG7E,MAAM+K,EAAQ,GAAG8b,EAAO7M,OAAS,GAAI6M,EAAO7M,YAAe,KAAKjW,EAAKgH,QAE/D+U,EAAW/b,EAAK+b,WAEhBpN,EAAO,CACT1S,OAAQ+D,EAAK/D,OACb8H,aAAc+e,EAAO/e,aACrBgL,SAAU+T,EAAO/T,SACjB3O,YAAaJ,EAAKI,YAClBykB,SAAU7kB,EAAKG,KACf6G,MAAOrJ,EAAA,mBAAiBqJ,GACxBisD,aAAcv2D,KAAKw2D,gBAAgBlzD,GACnCijB,KAAMjjB,EAAK2b,QAAQI,GACnBu3C,OAAQtzD,EAAK/D,OACbs3D,MAAM,EACNxuC,OAAQhJ,EACRy3C,SAAU1wC,EAAO5M,YAA4B,WAAdlW,EAAKG,KACpC+tB,IAAKvwB,EAAA,qBAAmB,KAO5B,OAJIoe,GAAYpN,EAAK6kD,WAAaH,IAC9B1kD,EAAK7G,SAAWpL,KAAKg1D,gBAAgB1xD,IAGlC2O,CACX,CAEAukD,gBAAgBlzD,GACZrC,EAAA,wBAAsBqC,GAEtB,MAAMizD,EAAe,GAEjBjzD,EAAKI,aACL6yD,EAAajqD,KAAK,aAGlBhJ,EAAKif,YACLg0C,EAAajqD,KAAK,UAGlBhJ,EAAKwY,mBAAmBrZ,OAAS,GACda,EAAKwY,mBACnBnQ,KAAIpM,GAAUM,EAAA,cAAYN,KAC1BqM,QAAOtI,KAAUA,IACjBsI,QAAOtI,IACH,CAAC,SAAU,gBAAgB6F,SAAS7F,EAAK/D,SACzB,WAAd+D,EAAKG,OAEDhB,OAAS,GACpB8zD,EAAajqD,KAAK,oBAI1B,MAAMyqD,EAAWzzD,EAAKse,cAElBm1C,GACAR,EAAajqD,KAAKyqD,GAGtBR,EAAajqD,KAAKrL,EAAA,yBAAuBqC,EAAKG,OAE1CH,EAAKnD,MACLo2D,EAAajqD,KAAKrL,EAAA,yBAAuBqC,EAAKnD,OAG9CmD,EAAK4c,SAAS,aACdq2C,EAAajqD,KAAK,YAGtB,MAAM0qD,EAAa1zD,EAAKgc,gBAMxB,OAJI03C,GACAT,EAAajqD,KAAK0qD,GAGfT,EAAa7kD,KAAK,IAC7B,CAGAulD,iBAAiBC,GAAgB,GAC7B,OAAOl3D,KAAKD,KAAKk3D,iBAAiBC,EACtC,CAGAllD,yBAAyBC,EAAO,MAC5B,MAAMklD,EAAQn3D,KAAKi3D,kBAAiB,GAapC,OAVIhlD,IAASklD,EAAM5qD,MAAKizC,GAAKA,EAAEhuB,MAAQvf,EAAKuf,OACxC2lC,EAAM7qD,KAAK2F,GAGM,IAAjBklD,EAAM10D,QACN00D,EAAM7qD,KAAKtM,KAAKwS,iBAKb2kD,EAAMvrD,QAAOqG,GAAkD,SAA1C,wBACmC,YAArBA,EAAKC,KAAK3S,QACxD,CAEAF,kCAAkC4S,EAAMuH,GACpC,IAAKvH,EAAM,CACP,MAAMpR,EAAgB,uBAEtBoR,EAAOjS,KAAKo3D,iBAAiBv2D,GAAe,EAChD,CAEA,MAAM,UAACyR,SAAmB/O,EAAA,MAAW,YAAY0O,EAAKC,KAAKG,6BAA6BmH,EAAa,EAAI,KAEzG3Z,EAAA,oBAAkByS,GAAW,GACxBpC,SAAQkW,GAAUA,EAAO5M,aAAeA,UAEvCxZ,KAAKq3D,aAAYh4D,gBACb4S,EAAKqqB,MAAK,GAEZrqB,EAAKC,KAAK3S,SAAW,8BACf0S,EAAKwhD,YAAYj6C,EAAY,CAACi9C,UAAU,EAAMC,aAAa,GACrE,UAGE12D,KAAKs3D,qBAAoB,EAGnC,CAEAj4D,iBAAiB4S,EAAO,YACdjS,KAAKu3D,4BAA4BtlD,GAAM,EACjD,CAEA5S,mBAAmB4S,EAAO,YAChBjS,KAAKu3D,4BAA4BtlD,GAAM,EACjD,CAEAulD,oBAAqBx3D,KAAKy3D,cAAe,CAKzCjlD,gBACI,OAAOxS,KAAKD,KAAKyS,eACrB,CAOAklD,iBACI,OAAO13D,KAAKD,KAAK43D,cACrB,CAEA1E,qBACI,IAAK,MAAM2E,KAAgB53D,KAAKi3D,mBAC5BW,EAAa7E,aAAY,EAEjC,CAEA1zD,gCACI,MAAMsO,EAAgB,wCAEtB,GAAIA,GAAiBA,EAAc7N,SAAU,CACzCE,KAAKD,KAAK2lB,WAAW0S,QACrBp4B,KAAKD,KAAKozD,UAAS,GAEnB,MAAMlhD,QAAajS,KAAK63D,aAAalqD,EAAc7N,UAE/CmS,UACMA,EAAK6lD,YAAY,CAACC,gBAAgB,IACxC9lD,EAAKqhD,WAAU,EAAM,CAACmD,UAAU,EAAMuB,SAAS,IAEvD,CACJ,CAEA34D,uBACIW,KAAKD,KAAK2lB,WAAW0S,QACrBp4B,KAAKD,KAAKozD,UAAS,EACvB,CAGA9zD,sBAAsBS,EAAU0zD,GAAS,EAAO/sB,GAAY,GACxDxlC,EAAA,wBAAsBnB,GAEtB,IAAI23C,EAAaz3C,KAAKo3D,iBAAiB,QAAQ,GAE3Cv/B,QAAiC93B,EAAA,4BAAsCD,EAAUE,KAAKa,cAAe4lC,GAEzG,GAAK5O,EAAL,CAQAA,EAA2BA,EAAyB7mB,MAAM,GAE1D,IAAK,MAAMiK,KAAe4c,EAEtB,GAAI4f,EAAY,CACPA,EAAWwgB,kBACNxgB,EAAWnb,OAGjBk3B,IACK/b,EAAWj+B,oBACNi+B,EAAWgc,aAAY,EAAM,CAACiD,aAAa,IAKtC72D,EAAA,kBAAgB43C,EAAWvlC,KAAKG,UACxCmH,YAAa,SAGlBxZ,KAAKk4D,WAAWzgB,GAEtB,IAAI0gB,EAAiBn4D,KAAKo4D,cAAc3gB,EAAYx8B,GAEpD,IAAKk9C,UACK1gB,EAAWnb,MAAK,GAEtB67B,EAAiBn4D,KAAKo4D,cAAc3gB,EAAYx8B,IAE3Ck9C,GAAgB,CACjB,GAAI1xB,EAAW,CAKX,MAAMpb,QAAkBxrB,EAAA,gBAAcob,GAEjCoQ,GAAgC,UAAnBA,EAAU5nB,MACxBE,EAAA,WAAY,4CAA4CsX,0BAAoCw8B,EAAWvlC,KAAK3S,4BAA4B,6CAA4DO,IAE5M,CAEA,MACJ,CAGJ23C,EAAa0gB,CACjB,CAGJ,OAAO1gB,CApDP,CALQhR,GACA79B,SAAS,wBAAyB9I,EAyD9C,CAGAs4D,cAAc3gB,EAAYx8B,GACtB,OAAOw8B,EAAWrvB,cAAc7b,MAAK8rD,GAAaA,EAAUnmD,KAAK3S,SAAW0b,GAChF,CAGA5b,mBAAmBS,EAAU2mC,GAAY,GACrC,OAAOzmC,KAAKs4D,gBAAgBx4D,GAAU,EAAM2mC,EAChD,CAGA8xB,iBAAiBnyC,GAGb,OAFAnlB,EAAA,wBAAsBmlB,GAEfpmB,KAAKo3D,iBAAiBhxC,EAAO7mB,QAAQqM,QAAOqG,GAAQA,EAAKC,KAAKG,WAAa+T,EAAO/T,UAC7F,CAGA+kD,iBAAiB73D,GACb0B,EAAA,wBAAsB1B,GAGtB,OADaS,KAAKD,KAAKy4D,cAAcj5D,IAChB,EACzB,CAEAw0C,YACI,QAAS/zC,KAAKd,WAClB,CAEAG,gBACIW,KAAKg0C,UAAUh0C,KAAK+zC,aACpB/zC,KAAKmwD,mBAAmBztC,OAExB1iB,KAAKsyD,mBAEL,MAAMmG,EAAgBz4D,KAAKwS,gBAErBkmD,EAAgB14D,KAAKd,aAAaY,YAC/BC,EAAA,4BAAsCC,KAAKd,YAAYY,iBAAmB,uCACtEE,KAAKs4D,gBAAgBt4D,KAAKd,YAAYY,UAEnD,GAAI44D,IAAkBD,EAAe,CACjC,IAAIE,GAAuB,EAEvBF,IACAE,EAAuBF,EAAcG,WAErCH,EAAcnF,WAAU,GACxBmF,EAActF,UAAS,IAGvBuF,IACKA,EAAcl3D,mBACTxB,KAAK63D,aAAa73D,KAAKd,YAAYY,UAG7C44D,EAAcpF,WAAU,EAAM,CAACmD,UAAU,EAAMuB,SAAUW,IACzDD,EAAcZ,YAAY,CAACC,gBAAgB,IAEnD,CAEA/3D,KAAKs3D,qBAAoB,EAC7B,CAEAj4D,oBAAoBqJ,GAChB,MAAMiqD,EAAajuD,EAAEsrD,GAAGC,UAAUC,QAAQxnD,GAE1CiqD,EAAWr2B,MAAK,GAChBq2B,EAAWc,aAAY,EAAM,CAACiD,aAAa,IAE3C,sBAAyB,cAC7B,CAEAr3D,kBAAkB4L,GACd,IAEIjL,KAAKD,KAAK84D,cAAa,SAEjB5tD,GACV,CACA,QACIjL,KAAKD,KAAK84D,cAAa,EAC3B,CACJ,CAEAvG,mBACQtyD,KAAK84D,uBACLvhB,aAAav3C,KAAK84D,uBAGtB94D,KAAK84D,sBAAwBnwD,YAAW,KACpC,IAAK3I,KAAKwwD,qBACN,OASJ,MAAMuI,EAAwB,IAAIj/C,IAC9B,uCACKnO,KAAIpD,GAAMA,EAAGM,gBACbgV,QAGT,IAAIm7C,GAAmB,EAEvBh5D,KAAKD,KAAKk5D,cAAcrD,OAAM3jD,IACtBA,EAAKuH,eAAiBu/C,EAAsB5+C,IAAIlI,EAAKC,KAAK3S,UAC1D0S,EAAKwhD,aAAY,GAEbuF,IACA,sBAAyB,qBACzBA,GAAmB,GAE3B,IACD,GAEHh5D,KAAKs3D,qBAAoB,EAAK,GAC/B,IACP,CAEAj4D,6BAA4B,YAACoK,IAGzB,GAFAzJ,KAAKsyD,mBAED7oD,EAAYomC,iBACZ,OAGJ,MAAMqpB,EAAUl5D,MAAK,IAEfm5D,EAAa,CACfC,gBAAiB,IAAIt/C,IACrBu/C,gBAAiB,IAAIv/C,KAGzB9Z,MAAK,EAAsByJ,EAAY4J,mBAAoB8lD,GAE3D,MAAM,gBAAEG,EAAe,oBAAEC,SAA8Bv5D,MAAK,EAAmByJ,EAAYmlC,gBAAiBuqB,GAE5G,IAAK,MAAM55D,KAAUkK,EAAYylC,aAC7BiqB,EAAWC,gBAAgBh/C,IAAI7a,SAG7BS,MAAK,EAAoBm5D,EAAY1vD,SAErCzJ,MAAK,EAAek5D,EAASI,EAAiBC,IAEhDJ,EAAWE,gBAAgB/uB,KAAO,GAAK6uB,EAAWC,gBAAgB9uB,KAAO,IAEzEtqC,KAAKs3D,qBAAoB,EAEjC,CAEA,GAAsBrnC,EAAekpC,GACjC,IAAK,MAAMja,KAAWjvB,EAAe,CACjC,MAAMupC,EAAiB,CAAC,YAAa,WAAY,YAAa,qBAAsB,SAEpF,GAAqB,UAAjBta,EAAQz7C,MAAoB+1D,EAAerwD,SAAS+1C,EAAQ5rC,MACxD4rC,EAAQpmC,cACRqgD,EAAWE,gBAAgBj/C,IAAI8kC,EAAQ3/C,QAEvC45D,EAAWC,gBAAgBh/C,IAAI8kC,EAAQ3/C,aAExC,GAAqB,UAAjB2/C,EAAQz7C,MAAqC,aAAjBy7C,EAAQ5rC,KAAqB,CAChE,MAAMhQ,EAAOzD,EAAA,yBAAuBq/C,EAAQ3/C,QAE5C,GAAI+D,EAGA,IAAK,MAAM2Z,KAAc3Z,EAAKyY,iBAC1Bo9C,EAAWE,gBAAgBj/C,IAAI6C,EAAW1d,OAGtD,MAAO,GAAqB,aAAjB2/C,EAAQz7C,MAAyC,aAAjBy7C,EAAQ5rC,MAAwC,YAAjB4rC,EAAQ5rC,MAG3E,GAAqB,aAAjB4rC,EAAQz7C,MAAwC,cAAjBy7C,EAAQ5rC,KAAsB,CACpE,MAAMhQ,EAAOzD,EAAA,yBAAuBq/C,EAAQ3/C,QAExC+D,GAAQA,EAAKkZ,kBAAkBrT,SAAS+1C,EAAQ9rC,QAIhD+lD,EAAWE,gBAAgBj/C,IAAI8kC,EAAQ3/C,OAE/C,OAVI45D,EAAWE,gBAAgBj/C,IAAI8kC,EAAQ3/C,OAW/C,CACJ,CAEAF,QAAyB2wB,EAAYmpC,GACjC,MAAMM,EAAqBzpC,EAAW1uB,OAAM+uB,KAAeA,EAAUzmB,YAGrE,IAAI0vD,EAAkB,KAClBC,EAAsB,GAE1B,IAAK,MAAMlpC,KAAaL,EASpB,GAR+B,WAA3BK,EAAUhpB,aAEV8xD,EAAWE,gBAAgBj/C,IAAIiW,EAAU9wB,QAGzC45D,EAAWC,gBAAgBh/C,IAAIiW,EAAU9wB,QAGzC8wB,EAAUzmB,UACV,IAAK,MAAMqI,KAAQjS,KAAKu4D,iBAAiBloC,GAAY,CACjD,GAAIpe,EAAKlJ,WACL,GAAI0wD,EAAoB,CACpB,MAAMf,EAAgBzmD,EAAK+gD,kBACpB/gD,EAAKynD,kBACLznD,EAAKS,YAERgmD,GACAA,EAAcpF,WAAU,EAAM,CAACmD,UAAU,EAAMuB,SAAS,GAEhE,MACIsB,EAAkBrnD,EAItBA,EAAKS,aACLT,EAAK+nB,SAGTm/B,EAAWC,gBAAgBh/C,IAAIiW,EAAUhpB,aAC7C,MAEA,IAAK,MAAMowC,KAAcz3C,KAAKo3D,iBAAiB/mC,EAAUhpB,cAAe,CAGpE,GAFAkyD,EAAoBjtD,KAAKmrC,GAErBA,EAAWp4B,aAAeo4B,EAAWwgB,WACrC,SAGJ,MAAM30D,QAAazD,EAAA,gBAAcwwB,EAAU9wB,QACrCo6D,EAAc95D,EAAA,kBAAgBwwB,EAAUhe,UACxCunD,GAAaniB,EAAWrvB,eAAiB,IAAI7b,MAAK4B,GAASA,EAAM+D,KAAK3S,SAAW8wB,EAAU9wB,SAC7Fq6D,EAEIvpC,EAAU7W,aAAeogD,EAAUpgD,cACnC2/C,EAAWE,gBAAgBj/C,IAAIu/C,EAAYp6D,SAK/Ck4C,EAAWoiB,YAAY,CAAC75D,KAAKq2D,YAAYsD,GAAa,KAElDA,EAAYngD,YAAclW,EAAKwG,eAC/BqvD,EAAWE,gBAAgBj/C,IAAIu/C,EAAYp6D,QAG/CS,KAAKkb,aAAau8B,GAGlB0hB,EAAWC,gBAAgBh/C,IAAIiW,EAAUhpB,cAEjD,CAIR,MAAO,CACHiyD,kBACAC,sBAER,CAEAl6D,QAA0B85D,EAAY1vD,SAC5BzJ,KAAKq3D,aAAYh4D,UACnB,IAAK,MAAME,KAAU45D,EAAWE,gBAC5B,IAAK,MAAMpnD,KAAQjS,KAAKo3D,iBAAiB73D,SAC/B0S,EAAKqqB,MAAK,GAEhB68B,EAAWC,gBAAgBh/C,IAAI7a,GAIvC,IAAK,MAAM8H,KAAgBoC,EAAYqlC,qBACnC,IAAK,MAAM78B,KAAQjS,KAAKo3D,iBAAiB/vD,GACjC4K,EAAKgmD,YACLj4D,KAAKkb,aAAajJ,EAG9B,IAIJ,IAAK,MAAM1S,KAAU45D,EAAWC,gBAC5B,IAAK,MAAMnnD,KAAQjS,KAAKo3D,iBAAiB73D,SAC/BS,KAAKk4D,WAAWjmD,EAGlC,CAEA,KACI,MAAMinD,EAAU,CACZY,eAAgB,KAChBC,kBAAmB,KACnBC,aAAc,MAGZrH,EAAa3yD,KAAKwS,gBACxB0mD,EAAQa,kBAAoBpH,GAAYiG,WACxCM,EAAQY,eAAiBnH,EAAa5yD,EAAA,cAAwB4yD,GAAc,KAC5E,MAAMsH,EAAWtH,EAAcA,EAAWK,kBAAoBL,EAAW+G,kBAAoB/G,EAAWjgD,YAAe,KAEvH,OADAwmD,EAAQc,aAAeC,EAAWl6D,EAAA,cAAwBk6D,GAAY,KAC/Df,CACX,CAEA75D,QAAqB65D,EAASI,EAAiBC,GAC3C,GAAID,EACA,IAAK,MAAM7hB,KAAc8hB,EAAqB,CAC1C,MAAMK,GAAaniB,EAAWrvB,eAAiB,IAAI7b,MAAK4B,GAASA,EAAM+D,KAAK3S,SAAW+5D,EAAgBpnD,KAAK3S,SAC5G,GAAIq6D,EAAW,CACXV,EAAQY,eAAiB/5D,EAAA,cAAwB65D,GACjD,KACJ,CACJ,CAGJ,IAAKV,EAAQY,eACT,OAGJ,IAAI7nD,QAAajS,KAAK63D,aAAaqB,EAAQY,gBAAgB,GAC3D,GAAI7nD,GAAQA,EAAKC,KAAK3S,SAAWQ,EAAA,mBAA6Bm5D,EAAQY,gBAAiB,CAGnF,MAAMI,EAAYl6D,KAAKo3D,iBAAiBr3D,EAAA,mBAA6Bm5D,EAAQY,iBAG7E7nD,EAA4B,IAArBioD,EAAUz3D,OAAey3D,EAAU,GAAK,IACnD,CAEIjoD,GACIinD,EAAQa,mBAER/5D,KAAKD,KAAK2lB,WAAW0S,cAGnBnmB,EAAKqhD,WAAU,EAAM,CAACmD,UAAU,EAAMuB,SAAUkB,EAAQa,sBAG9D9nD,QAAajS,KAAK63D,aAAaqB,EAAQc,cAAc,GAEjD/nD,GAMA,wCAAyC7I,QAAQ8vD,EAAQc,cAAchvD,MAAK,KACxE,MAAM0tD,EAAgB14D,KAAKwS,gBAGvBkmD,GAAiBQ,EAAQa,mBACzBrB,EAAcvF,UAAS,EAC3B,IAIhB,CAEAj4C,aAAajJ,GACTA,EAAKiJ,cAAa,CAACi/C,EAAOC,KACtB,MAAMC,EAAUx6D,EAAA,iBAAes6D,EAAMjoD,KAAKG,UACpCioD,EAAUz6D,EAAA,iBAAeu6D,EAAMloD,KAAKG,UAE1C,OAAKgoD,GAAYC,EAIVD,EAAQ/gD,aAAeghD,EAAQhhD,aAH3B,CAGuC,GAE1D,CAEAm6C,YAAYphD,EAAUmH,GAClBvY,EAAA,wBAAsBoR,GAEtB,MAAM+T,EAASvmB,EAAA,kBAAgBwS,GAAU,GAEzC,IAAK+T,EACD,OAAI/T,GAAYA,EAASnK,WAAW,aAEhC,OAGAU,SAAS,cAAcyJ,KAK/B+T,EAAO5M,WAAaA,EAEpBjW,EAAA,MAAW,YAAY8O,cAAqBmH,EAAa,EAAI,IACjE,CAEAna,4BACI,MAAMszD,EAAa3yD,KAAKwS,gBAElBsnD,EAAgC,OAAfnH,EAAsB5yD,EAAA,cAAwB4yD,GAAc,KAE7E4H,EAAWv6D,KAAK6xD,kBAQtB,SANM7xD,KAAKq3D,aAAYh4D,gBACbW,KAAKD,KAAKypC,OAAO,CAAC+wB,GAAU,UAGhCv6D,KAAKs3D,qBAAoB,GAE3BwC,EAAgB,CAChB,MAAM7nD,QAAajS,KAAKs4D,gBAAgBwB,GAAgB,GAEpD7nD,SACMA,EAAKqhD,WAAU,EAAM,CAACmD,UAAU,EAAMuB,SAAS,GAE7D,CACJ,CAEA34D,+BAA8B,MAACI,IACvBO,KAAKy0C,cAAch1C,UACbO,KAAKs3D,qBAAoB,EAEvC,CAEAj4D,0BAA0Bm7D,GAAc,GACpC,IAAKx6D,KAAKd,YACN,OAGJ,MAAMu7D,QAAwB16D,EAAA,kBAA4BC,KAAKd,YAAY2B,gBAEtE25D,GAAex6D,KAAK06D,8BAAgCD,KAMzDz6D,KAAK06D,4BAA8BD,QAE7Bz6D,KAAKs4D,gBAAgBmC,GAEY,SAAnCz6D,KAAKd,YAAY2B,eACjBb,KAAKD,KAAK46D,cACV36D,KAAK46D,kBAAiB,KAGtB56D,KAAKD,KAAK86D,gBAAe5oD,GACrBA,EAAKC,KAAK3S,SAAWS,KAAKd,YAAY2B,eACnCd,EAAA,cAAwBkS,KAAUwoD,IAEzCz6D,KAAK46D,kBAAiB,IAE9B,CAEAA,iBAAiBzzB,GACb,MAAM2zB,EAAa96D,KAAKo3D,iBAAiB,WAAW,GACpD1yD,EAAEo2D,EAAWC,IAAI9mB,YAAY,yBAA0B9M,EAC3D,CAEAonB,qBACIvuD,KAAK8wD,qBACT,CAEAzxD,mBACI,MAAM6zB,QAAgB,6BAA0C,aAC1D8nC,EAAY,CAAC,EAEnB,IAAK,MAAM35D,KAAU6xB,EACjB,IAAK,MAAMG,KAAYhyB,EAAO+xB,mBAC1B4nC,EAAU,sBAAkC3nC,IAAaphB,IACrD,MAAMnS,EAAWC,EAAA,cAAwBkS,GAIzC,OAFAjS,KAAKgI,eAAe3G,EAAO8xB,WAAY,CAAClhB,OAAMnS,cAEvC,CAAK,EAKxB,OAAOk7D,CACX,CAKAC,6BAA6BhpD,GAGzB,OAFcjS,KAAKgS,yBAAyBC,GAE/BtG,KAAIsG,GAAQA,EAAKC,KAAKG,UACvC,CAKAogD,2BAA2BxgD,GAGvB,OAFcjS,KAAKgS,yBAAyBC,GAE/BtG,KAAIsG,GAAQA,EAAKC,KAAK3S,QACvC,CAEAF,0BAAyB,KAAC4S,IACtB,MAAMK,EAAYtS,KAAKi7D,6BAA6BhpD,GAC/CrG,QAAOyG,IAAaA,EAASnK,WAAW,WAExCoK,EAAU7P,eAIT,gBAA0B6P,GAEhCtS,KAAKizD,qBACT,CAEAiI,mBAAmBjpD,GACf,GAAyB,SAArBA,EAAKC,KAAK3S,OACV,OAAO,EAGX,MAAM0d,EAAapd,EAAA,yBAAuBoS,EAAKS,YAAYR,KAAK3S,QAEhE,OAAQ0d,GAAYiD,SAAS,SACjC,CAEAi7C,mBAAkB,KAAClpD,IACf,IAAKjS,KAAKk7D,mBAAmBjpD,GACzB,OAGJ,MAAMmpD,EAAanpD,EAAKynD,iBAEL,OAAf0B,GACA,qBAA+B,CAACnpD,EAAKC,KAAKG,UAAW+oD,EAAWlpD,KAAKG,SAE7E,CAEAgpD,qBAAoB,KAACppD,IACjB,IAAKjS,KAAKk7D,mBAAmBjpD,GACzB,OAGJ,MAAMqpD,EAAYrpD,EAAK+gD,iBAEL,OAAdsI,GACA,oBAA8B,CAACrpD,EAAKC,KAAKG,UAAWipD,EAAUppD,KAAKG,SAE3E,CAEAkpD,8BAA6B,KAACtpD,IAC1B,0BAAoCA,EACxC,CAEAupD,gCAA+B,KAACvpD,IAC5B,MAAMwpD,EAASxpD,EAAKynD,iBAEL,OAAX+B,GACA,qBAA+B,CAACxpD,EAAKC,KAAKG,UAAWopD,EAAOvpD,KAAKG,SAEzE,CAEAqpD,iCACI,MAAMzpD,EAAOjS,KAAK03D,iBAElB,IAAKzlD,EACD,OAGAA,EAAKlJ,YACLkJ,EAAK8gD,aAAY,GAGrB,MAAM4I,EAAc1pD,EAAKynD,iBAErBiC,IACAA,EAAYrI,WAAU,EAAM,CAACmD,UAAU,IAEnCkF,EAAYnJ,cACZvgD,EAAK8gD,aAAY,GAGrB4I,EAAY5I,aAAY,GAEhC,CAEA6I,iCACI,MAAM3pD,EAAOjS,KAAK03D,iBAElB,IAAKzlD,EACD,OAGAA,EAAKlJ,YACLkJ,EAAK8gD,aAAY,GAGrB,MAAM8I,EAAc5pD,EAAK+gD,iBAErB6I,IACAA,EAAYvI,WAAU,EAAM,CAACmD,UAAU,IAEnCoF,EAAYrJ,cACZvgD,EAAK8gD,aAAY,GAGrB8I,EAAY9I,aAAY,GAEhC,CAEA+I,sBAAqB,KAAC7pD,IAClBjS,KAAK+7D,WAAW9pD,EACpB,CAEA+pD,wBAAuB,KAAC/pD,IACpBjS,KAAKy3D,aAAaxlD,EACtB,CAEA5S,qCAAoC,KAAC4S,IACjCjS,KAAKgI,eAAe,oBAAqB,CAACrI,eAAgBsS,EAAKC,KAAK3S,QACxE,CAEA08D,+BAA8B,KAAChqD,IAC3B,IAAK,MAAM9D,KAAS8D,EAAKS,YAAY0V,cACjCja,EAAM4kD,aAAY,EAE1B,CAEAmJ,6BAA4B,KAACjqD,IACzBuY,EAAA,OAAexqB,KAAKi7D,6BAA6BhpD,GACrD,CAEAkqD,4BAA2B,KAAClqD,IACxBuY,EAAA,MAAcxqB,KAAKi7D,6BAA6BhpD,GACpD,CAEAmqD,gCAA+B,KAACnqD,IAC5BuY,EAAA,YAAoBvY,EAAKC,KAAKG,SAClC,CAEAgqD,qCAAoC,KAACpqD,IACjCuY,EAAA,aAAqBvY,EAAKC,KAAKG,SACnC,CAEAhT,yBAAwB,KAAC4S,IACrB,MAAMnS,EAAWC,EAAA,cAAwBkS,GAEzCjS,KAAKgI,eAAe,mBAAoB,CAAClI,WAAUw8D,YAAa,WACpE,CAEAj9D,6BAA4B,KAAC4S,IACzBjS,KAAKgI,eAAe,mBAAoB,CAACzI,OAAQ0S,EAAKC,KAAK3S,QAC/D,CAEAg9D,sBAAqB,KAACtqD,IAClB,yBAA0B,eAC9B,CAEAuqD,uBAAsB,KAACvqD,IACnB,gBAAoCA,EAAKC,KAAK3S,QAAQ,GAAM,EAChE,CAEAk9D,yBAAwB,KAACxqD,IACrB,gBAAoCA,EAAKC,KAAK3S,QAAQ,GAAO,EACjE,CAEAm9D,yBAAwB,KAACzqD,IACrB,MAAM0qD,EAAmB38D,KAAKgS,yBAAyBC,GAEvD,IAAK,MAAM2qD,KAAmBD,EAAkB,CAG5C,GAFa98D,EAAA,yBAAuB+8D,EAAgB1qD,KAAK3S,QAEhDmE,cAAgB,kCACrB,SAGJ,MAAM0iB,EAASvmB,EAAA,kBAAgB+8D,EAAgB1qD,KAAKG,UAEpD,qBAAmCuqD,EAAgB1qD,KAAK3S,OAAQ6mB,EAAO/e,aAC3E,CACJ,CAEAw1D,8BAA6B,KAAC5qD,EAAI,0BAAEG,IAChC,qBAA+BA,EAA2B,sBAC9D,CAEA0qD,gCAA+B,KAAC7qD,EAAI,0BAAEG,IAClC,qBAA+BA,EAA2B,wBAC9D,CAEA2qD,wBAAuB,KAAC9qD,IACpBjS,KAAKg9D,mBAAmB/qD,EAAM,OAClC,CAEAgrD,0BAAyB,KAAChrD,IACtBjS,KAAKg9D,mBAAmB/qD,EAAM,SAClC,CAEAirD,0BAAyB,KAACjrD,IACtBjS,KAAKg9D,mBAAmB/qD,EAAM,eAClC,CAEAkrD,0BAAyB,KAAClrD,IACtBjS,KAAKg9D,mBAAmB/qD,EAAM,SAClC,CAEA5S,yBAAyB4S,EAAMmrD,GAC3B,MAAM92D,QAAa/C,EAAA,OAAY,2BAA2B0O,EAAKC,KAAK3S,UAAU69D,KAEzE92D,EAAKC,SACN,oBAAuBD,EAAKoG,eAG1B/I,EAAA,kCAEN,wCAAyCyF,QAAQ9C,EAAKhD,KAAK/D,OAC/D,kCChnDW,MAAM89D,UAAwB,IACzC16D,cACIC,QAEA5C,KAAKs9D,aAAe,IAAI,KAAaj+D,UACjC,MAAMiL,EAAQtK,KAAKu9D,WAAWn4C,MAE9B,qCAAwDplB,KAAKsD,YAEvDC,EAAA,MAAW,SAASvD,KAAKT,eAAgB,CAAC+K,SAAQtK,KAAK8V,YAAY,IAG7E9V,KAAKw9D,oBAAqB,EAE1B,kCAAmCx9D,KACvC,CAEA8zC,WACI9zC,KAAKwiB,QAAU9d,EAzCX,ihBA0CJ1E,KAAKu9D,WAAav9D,KAAKwiB,QAAQjW,KAAK,eAEpCvM,KAAKu9D,WAAWhpD,GAAG,SAAS,IAAMvU,KAAKs9D,aAAaxwD,mBAEpD9M,KAAKu9D,WAAWhpD,GAAG,QAAQ,KACvBvU,KAAKs9D,aAAa7sD,uBAElBzQ,KAAKw9D,oBAAqB,CAAK,IAGnC,mBAA+Bx9D,KAAKu9D,WAAY,OAAO,KAC/Cv9D,KAAKw9D,oBAAsBx9D,KAAKd,YAAY6J,YAC5C,gBAA0BgH,OAAOqL,OAAOpb,KAAKd,YAAYoE,KAAKqX,gBAClE,IAGJ,mBAA+B3a,KAAKu9D,WAAY,UAAU,KACtDv9D,KAAKgI,eAAe,gBAAiB,CAACvI,MAAOO,KAAKd,YAAYO,OAAO,GAE7E,CAEAJ,sBAAsBiE,GAClB,MAAMm6D,EAAcn6D,EAAKI,cAAgB,mCAClC,CAAC,UAAW,wBAAyB,uBAAuByF,SAAS7F,EAAK/D,SAClC,YAAxCS,KAAKd,YAAYC,UAAU4B,SAElCf,KAAKu9D,WAAWn4C,IACZq4C,QACYz9D,KAAKd,YAAYqS,qBACvBjO,EAAKgH,OAEftK,KAAKu9D,WAAW5oD,KAAK,WAAY8oD,GAEjCz9D,KAAK09D,mBAAmBp6D,EAC5B,CAGAo6D,mBAAmBp6D,GACftD,KAAKu9D,WAAWtpB,YAAY,cAAe3wC,EAAKI,YACpD,CAEArE,6BAA4B,YAACH,IACrBc,KAAKy0C,cAAcv1C,EAAYO,cACzBO,KAAKs9D,aAAa7sD,sBAEhC,CAEApR,oCAAmC,OAACoP,IAC5BzO,KAAKy0C,cAAchmC,UACbzO,KAAKs9D,aAAa7sD,sBAEhC,CAEAktD,oBACQ39D,KAAKd,aAAec,KAAKd,YAAY6J,YACrC/I,KAAKu9D,WAAWz4D,QAAQ,QAEhC,CAEA84D,0BAAyB,UAACh6D,GAAa,CAACA,WAAW,IAC3C5D,KAAKd,aAAec,KAAKd,YAAY6J,aACrC/I,KAAKu9D,WACAz4D,QAAQ,SACRA,QAAQ,UAEb9E,KAAKw9D,mBAAqB55D,EAElC,CAEA2rD,uBAAsB,YAAC9lD,IACfA,EAAYC,eAAe1J,KAAKT,SAEhCS,KAAK09D,mBAAmB19D,KAAKsD,MAG7BmG,EAAYC,eAAe1J,KAAKT,OAAQS,KAAK8V,cAC7C9V,KAAK80C,SAEb,CAEAtkC,oBACI,OAAOxQ,KAAKs9D,aAAar3B,4BAC7B,EC1CJ,QAnFA,UAAuC,IAAErxB,EAAG,cAAEipD,EAAa,KAAE33D,IACpD0O,EAAIJ,SAAS,cACdI,EAAIhO,aAAa,CACb6zC,SAAUhpC,SAASipC,cAAc,QACjCC,MAAM,EACNE,aAAa,EACbC,UAAW,EACXC,iBAAiB,GAClB,CAAC,CACAE,WAAY,OAEZ7mB,OAAO,EACP4mB,OAAQ37C,MAAO05C,EAAM9tC,KACjB,MAAMxH,EAAgC,mBAAlBo6D,EAA+BA,IAAkBA,EAKrE5yD,SAHoB1H,EAAA,MAAW,yBAAyBE,WAAcwoB,mBAAmB8sB,OACpEptC,KAAI2H,IAAQ,CAAEA,WAEzB,KAIlBsB,EAAIL,GAAG,uBAAuB,KACtBK,EAAI7B,KAAK,aACT6B,EAAIhO,aAAa,QACrB,KAIJV,GACA0O,EAAIhO,aAAa,OAEzB,EAmDA,EAjDAvH,gBAA0C,IAAEuV,EAAG,KAAE1O,EAAI,aAAE43D,IAC/ClpD,EAAIJ,SAAS,aAGbI,EAAIhO,aAAa,WAGrB,MAAMm3D,EAAgBD,IAEtB,GAA6B,KAAzBC,EAAc/jD,OACd,OAGJ,MAAMgkD,SAAyBz6D,EAAA,MAAW,oBAAoB0oB,mBAAmB8xC,OAC5EpyD,KAAIqZ,IAAa,CAAG5R,MAAO4R,MAED,IAA3Bg5C,EAAgBv7D,SAIpBmS,EAAIhO,aAAa,CACb6zC,SAAUhpC,SAASipC,cAAc,QACjCC,MAAM,EACNE,aAAa,EACbC,UAAW,EACXC,iBAAiB,GAClB,CAAC,CACAE,WAAY,QACZ7mB,OAAO,EACP4mB,OAAQ37C,eAAgB05C,EAAM9tC,GAC1B8tC,EAAOA,EAAK9hB,cAIZhsB,EAFiB+yD,EAAgBpyD,QAAOmH,GAAQA,EAAKK,MAAM6jB,cAAc9tB,SAAS4vC,KAGtF,KAGJnkC,EAAIL,GAAG,uBAAuB,KACtBK,EAAI7B,KAAK,aACT6B,EAAIhO,aAAa,QACrB,IAGAV,GACA0O,EAAIhO,aAAa,QAEzB,kCC5EA,MAqKMq3D,EAAc,CAChB,MAAS,OACT,mBAAoB,SACpB,SAAY,OACZ,sBAAuB,UAGrBC,GAAY,CACd,MAAS,CACL,kBAAqB,2CACrB,aAAgB,8BAChB,SAAY,iDACZ,kBAAqB,uBACrB,IAAO,iUAOP,cAAiB,mCACjB,UAAa,oEACb,iBAAoB,0BACpB,OAAU,iBACV,cAAiB,qBACjB,iBAAoB,cACpB,IAAO,0BACP,uBAA0B,cAC1B,SAAY,0BACZ,qBAAwB,yDACxB,OAAU,sCACV,SAAY,kDACZ,SAAY,2DACZ,UAAa,uFACb,SAAY,aACZ,qBAAwB,+EACxB,uBAA0B,+EAC1B,OAAU,0CACV,UAAa,mBACb,mBAAsB,yBACtB,4BAA+B,yBAC/B,sBAAyB,iBACzB,kBAAqB,6CACrB,WAAc,qBACd,oBAAuB,qCACvB,MAAS,yEACT,eAAkB,+BAClB,eAAkB,gBAClB,eAAkB,iCAClB,oBAAuB,8BACvB,kBAAqB,mEACrB,WAAc,sDACd,oBAAuB,qCACvB,UAAa,sBACb,iBAAoB,wBACpB,SAAY,8BACZ,2BAA8B,yDAC9B,iBAAoB,wDACpB,WAAc,wBACd,iBAAoB,0BACpB,cAAiB,4BACjB,cAAiB,ypBAQjB,SAAY,wBACZ,IAAO,sGACP,MAAS,wDACT,iBAAoB,qDACpB,oBAAuB,oCACvB,cAAiB,iBACjB,mBAAsB,wBACtB,mBAAsB,oBACtB,cAAiB,wBACjB,oBAAuB,+BAE3B,SAAY,CACR,kBAAqB,mQACrB,uBAA0B,kFAC1B,qBAAwB,qBACxB,uBAA0B,0EAC1B,gBAAmB,qDACnB,kBAAqB,WACrB,oBAAuB,+CACvB,kBAAqB,qCACrB,oBAAuB,oDACvB,uBAA0B,kFAC1B,qBAAwB,sIACxB,SAAY,oLACZ,QAAW,6KACX,WAAc,oDACd,OAAU,2BACV,SAAY,iGACZ,QAAW,uEACX,cAAiB,uKACjB,aAAgB,iHAIT,MAAMC,WAA8B,IAC/C9+D,gBAGIW,KAAK0iB,MACT,CAEAoxB,WACI9zC,KAAKo+D,yBAA2B,IAAI,KAAa/+D,SAAYW,KAAKq+D,sBAAsB,KAExFr+D,KAAKwiB,QAAU9d,EAtRX,u+KAwRJ,mBAA+B1E,KAAKwiB,QAAS,eAAe,IAAMxiB,KAAKs+D,iBACvE,mBAA+Bt+D,KAAKwiB,QAAS,OAAO,IAAMxiB,KAAKu+D,mBAG/Dv+D,KAAKs1C,OAASt1C,KAAKwiB,QAAQjW,KAAK,sBAEhCvM,KAAKw+D,WAAax+D,KAAKwiB,QAAQjW,KAAK,oBACpCvM,KAAKw+D,WAAWjqD,GAAG,SAASkqD,IACnBA,EAAGC,eAAeC,aACnB3+D,KAAK4+D,qBACT,IAEJ5+D,KAAKw+D,WAAWjqD,GAAG,UAAU,IAAMvU,KAAK4+D,wBACxC5+D,KAAKw+D,WAAWjqD,GAAG,uBAAuB,IAAMvU,KAAK4+D,wBAErD5+D,KAAKw+D,WAAWjqD,GAAG,SAAS,KACxB,EAA2D,CACvDK,IAAK5U,KAAKw+D,WACVX,cAAe,IAAM,CAAC,WAAY,uBAAuB10D,SAASnJ,KAAK6+D,UAAY,WAAa,QAChG34D,MAAM,GACR,IAGNlG,KAAK8+D,UAAY9+D,KAAKwiB,QAAQjW,KAAK,mBACnCvM,KAAK++D,YAAc/+D,KAAKwiB,QAAQjW,KAAK,qBACrCvM,KAAK++D,YAAYxqD,GAAG,SAASkqD,IACpBA,EAAGC,eAAeC,aACnB3+D,KAAK4+D,qBACT,IAEJ5+D,KAAK++D,YAAYxqD,GAAG,UAAU,IAAMvU,KAAK4+D,wBACzC5+D,KAAK++D,YAAYxqD,GAAG,uBAAuB,IAAMvU,KAAK4+D,wBACtD5+D,KAAK++D,YAAYxqD,GAAG,SAAS,KACzB,EAAwD,CACpDK,IAAK5U,KAAK++D,YACV74D,MAAM,EACN43D,aAAc,IAAM99D,KAAKw+D,WAAWp5C,OACtC,IAGNplB,KAAKg/D,aAAeh/D,KAAKwiB,QAAQjW,KAAK,sBACtCvM,KAAKi/D,eAAiBj/D,KAAKwiB,QAAQjW,KAAK,wBACxCvM,KAAKi/D,eAAe1qD,GAAG,UAAU,IAAMvU,KAAK4+D,wBAE5C5+D,KAAKk/D,kBAAoBl/D,KAAKwiB,QAAQjW,KAAK,4BAC3CvM,KAAKm/D,oBAAsBn/D,KAAKwiB,QAAQjW,KAAK,8BAC7CvM,KAAKm/D,oBAAoB5qD,GAAG,UAAU,IAAMvU,KAAK4+D,wBAEjD5+D,KAAKo/D,iBAAmBp/D,KAAKwiB,QAAQjW,KAAK,0BAC1CvM,KAAKq/D,mBAAqBr/D,KAAKwiB,QAAQjW,KAAK,4BAC5CvM,KAAKq/D,mBAAmB9qD,GAAG,UAAU,IAAMvU,KAAK4+D,wBAEhD5+D,KAAKs/D,cAAgBt/D,KAAKwiB,QAAQjW,KAAK,wBACvCvM,KAAKu/D,gBAAkBv/D,KAAKwiB,QAAQjW,KAAK,0BACzCvM,KAAKu/D,gBAAgBhrD,GAAG,UAAU,IAAMvU,KAAK4+D,wBAE7C5+D,KAAKw/D,oBAAsBx/D,KAAKwiB,QAAQjW,KAAK,8BAC7CvM,KAAKy/D,sBAAwBz/D,KAAKwiB,QAAQjW,KAAK,gCAC/CvM,KAAKy/D,sBAAsBlrD,GAAG,UAAU,IAAMvU,KAAK4+D,wBAEnD5+D,KAAK0/D,oBAAsB1/D,KAAKwiB,QAAQjW,KAAK,8BAC7CvM,KAAK2/D,sBAAwB3/D,KAAKwiB,QAAQjW,KAAK,gCAC/CvM,KAAK2/D,sBAAsBprD,GAAG,SAASkqD,IAC9BA,EAAGC,eAAeC,aACnB3+D,KAAK4+D,qBACT,IAGJ5+D,KAAK4/D,eAAiB5/D,KAAKwiB,QAAQjW,KAAK,yBACxCvM,KAAK6/D,iBAAmB7/D,KAAKwiB,QAAQjW,KAAK,2BAE1C,uBAA6CvM,KAAK6/D,iBAAkB,CAAC5mB,oBAAoB,IACpF1kC,GAAG,6BAA6B,CAAC8C,EAAO8jC,EAAY2kB,KACjD,IAAK3kB,EAAWr7C,SACZ,OAAO,EAGX,MAAMigE,EAAa5kB,EAAWr7C,SAASgJ,MAAM,KAE7C9I,KAAKglB,UAAU5R,MAAQ2sD,EAAWA,EAAWt9D,OAAS,GAEtDzC,KAAKgI,eAAe,sBAAuB,CAAEwS,WAAYxa,KAAKggE,gBAC9DhgE,KAAKq+D,oBAAoB,IAGjCr+D,KAAKigE,kBAAoBjgE,KAAKwiB,QAAQjW,KAAK,2BAC3CvM,KAAKigE,kBAAkB1rD,GAAG,UAAU,IAAMvU,KAAK4+D,wBAE/C5+D,KAAKkgE,uBAAyBlgE,KAAKwiB,QAAQjW,KAAK,6BAChDvM,KAAKkgE,uBAAuB3rD,GAAG,SAAS,IAAMvU,KAAKu+D,mBAEnDv+D,KAAKmgE,eAAiBngE,KAAKwiB,QAAQjW,KAAK,qBAExCvM,KAAKogE,+BAAiCpgE,KAAKwiB,QAAQjW,KAAK,sCAExDvM,KAAKqgE,oBAAsBrgE,KAAKwiB,QAAQjW,KAAK,uCAC7CvM,KAAKqgE,oBAAoB9rD,GAAG,SAAS,IAAMvU,KAAKs+D,iBAEhDt+D,KAAKsgE,cAAgBtgE,KAAKwiB,QAAQjW,KAAK,uBACvCvM,KAAKsgE,cAAc/rD,GAAG,SAASlV,gBACrBW,KAAKgI,eAAe,sBAAuB,CAC7CwS,WAAYxa,KAAKggE,cAAcp0D,QAAOmH,GAAQA,IAAS/S,KAAKglB,oBAG1DhlB,KAAKgI,eAAe,kBAE1BhI,KAAK0iB,MAAM,IAGf1iB,KAAKugE,UAAYvgE,KAAKwiB,QAAQjW,KAAK,cAEnCvM,KAAKwgE,uBAAyBxgE,KAAKwiB,QAAQjW,KAAK,4BAChDvM,KAAKygE,mBAAqBzgE,KAAKwgE,uBAAuBj0D,KAAK,uBAC3DvM,KAAK0gE,kBAAoB1gE,KAAKwgE,uBAAuBj0D,KAAK,uBAC1DvM,KAAK2gE,uBAAyB3gE,KAAKwgE,uBAAuBj0D,KAAK,6BAE/D7H,EAAEjD,QAAQ8S,GAAG,aAAa7L,IACjBhE,EAAEgE,EAAEiK,QAAQ+B,QAAQ1U,KAAKwiB,QAAQ,IAAI/f,QAClCiC,EAAEgE,EAAEiK,QAAQ+B,QAAQ,yBAAyBjS,QAC7CiC,EAAEgE,EAAEiK,QAAQ+B,QAAQ,2BAA2BjS,QACnDzC,KAAK0iB,MACT,GAER,CAEArjB,2BAA0B,cAAC2gE,EAAa,UAAEh7C,EAAS,QAAE47C,EAAO,EAAEl9C,EAAC,EAAEF,EAAC,MAAE4U,IAChE,IAAKpT,EAGD,YAFAhlB,KAAK0iB,OAKTzhB,EAAA,6BAEAjB,KAAK6+D,SAAW7+D,KAAK6gE,YAAY77C,GAEjC,MAAM87C,EACgB,qBAAlB9gE,KAAK6+D,SAAkC75C,EAAU1R,KAAK0iB,OAAO,GACpC,wBAAlBh2B,KAAK6+D,SAAqC75C,EAAU1R,KAAK0iB,OAAO,GAAKhR,EAAU1R,KAEpF6iC,EAAan2C,KAAK6+D,SAASz4D,SAAS,eACpC,UAAwC4e,EAAU5R,OAClD,CAAC,EA6DP,GA3DApT,KAAKs1C,OAAO/vB,KAAK04C,EAAYj+D,KAAK6+D,WAElC7+D,KAAKggE,cAAgBA,EACrBhgE,KAAKglB,UAAYA,EAGjBhlB,KAAKq+D,qBAELr+D,KAAKogE,+BAA+BjzC,SAASyzC,GAEzCA,EACA5gE,KAAKmgE,eAAez9C,OAGpB1iB,KAAKmgE,eACAh5B,OACAxkB,QACAhe,OAA0B,UAAnBqgB,EAAUvhB,KAAmB,QAAU,YAC9CkB,OAAO,sBACPA,aAAa,eAAuBqgB,EAAUzlB,SAGvDS,KAAKw+D,WACAp5C,IAAI07C,GACJ/tD,KAAK,YAAY,KAAO6tD,IAE7B5gE,KAAK8+D,UAAU3xC,OAAyB,UAAlBntB,KAAK6+D,UAC3B7+D,KAAK4/D,eAAezyC,OAAyB,aAAlBntB,KAAK6+D,UAEhC7+D,KAAKg/D,aAAa7xC,OAAO,CAAC,mBAAoB,uBAAuBhkB,SAASnJ,KAAK6+D,WACnF7+D,KAAKi/D,eACAtqD,KAAK,YAAawhC,EAAW90B,YAC7BtO,KAAK,YAAY,KAAO6tD,IAE7B5gE,KAAKk/D,kBAAkB/xC,SAASgpB,EAAW90B,YAC3CrhB,KAAKm/D,oBACA/5C,IAAI+wB,EAAW7Y,eACfvqB,KAAK,YAAY,KAAO6tD,IAE7B5gE,KAAKo/D,iBAAiBjyC,OAAO,CAAC,mBAAoB,uBAAuBhkB,SAASnJ,KAAK6+D,WACvF7+D,KAAKq/D,mBACAj6C,IAAI+wB,EAAWhZ,cACfpqB,KAAK,YAAY,KAAO6tD,IAE7B5gE,KAAKs/D,cAAcnyC,OAAyB,qBAAlBntB,KAAK6+D,UAC/B7+D,KAAKu/D,gBACAn6C,IAAI+wB,EAAWjZ,WACfnqB,KAAK,YAAY,KAAO6tD,IAE7B5gE,KAAKw/D,oBAAoBryC,OAAyB,qBAAlBntB,KAAK6+D,UAA4D,WAAzB1oB,EAAWjZ,WACnFl9B,KAAKy/D,sBACAr6C,IAAI+wB,EAAW9Y,iBACftqB,KAAK,YAAY,KAAO6tD,IAE7B5gE,KAAK0/D,oBAAoBvyC,OAAyB,wBAAlBntB,KAAK6+D,UACrC7+D,KAAK2/D,sBACAv6C,IAAI+wB,EAAW5Y,iBACfxqB,KAAK,YAAY,KAAO6tD,IAEN,UAAnB57C,EAAUvhB,KACVzD,KAAK++D,YACA35C,IAAIJ,EAAU5R,OACdL,KAAK,YAAY,KAAO6tD,SAE5B,GAAuB,aAAnB57C,EAAUvhB,OACfzD,KAAK6/D,iBACA9sD,KAAK,YAAY,KAAO6tD,IACxBx7C,IAAI,IACJo0B,oBAAoB,IAErBx0B,EAAU5R,OAAO,CACjB,MAAMmd,QAAmB1wB,EAAA,gBAAcmlB,EAAU5R,OAE7Cmd,GACAvwB,KAAK6/D,iBACAz6C,IAAImL,EAAaA,EAAWjmB,MAAQ,IACpCkvC,oBAAoBx0B,EAAU5R,MAE3C,CAGJpT,KAAKigE,kBACAtrD,KAAK,YAAaqQ,EAAUlM,eAC5B/F,KAAK,YAAY,KAAO6tD,IAE7B5gE,KAAK+gE,aAEL/gE,KAAKg0C,WAAU,GAEf,MAAMod,EAASpxD,KAAKqW,OAAOmM,QAAQ4uC,SAC7B4P,EAAchhE,KAAKihE,kBAAkBv9C,EAAG0tC,GAE9CpxD,KAAKwiB,QACAmB,IAAI,OAAQq9C,EAAYz9C,MACxBI,IAAI,QAASq9C,EAAYE,OACzBv9C,IAAI,MAAOH,EAAI4tC,EAAO9tC,IAAM,IAC5BK,IAAI,aACD3jB,KAAKwiB,QAAQW,cAAgBK,EAAI9e,EAAEjD,QAAQi/C,SAAW,GAChDh8C,EAAEjD,QAAQi/C,SAAWl9B,EAAI,GACzB,KAEA,SAAV4U,GACAp4B,KAAKw+D,WACA15D,QAAQ,SACRA,QAAQ,SAErB,CAEAm8D,kBAAkBv9C,EAAG0tC,GACjB,IAAI7tC,EAAOG,EAAI0tC,EAAO7tC,KAAOvjB,KAAKwiB,QAAQa,aAAe,EACrD69C,EAAQ,GAaZ,OAXI39C,EAAO,EACPA,EAAO,GAEWA,EAAOvjB,KAAKwiB,QAAQa,aAEtBrjB,KAAKqW,OAAOmM,QAAQa,aAAe,KAC/CE,EAAO,GACP29C,EAAQ,IAIT,CAAC39C,OAAM29C,QAClB,CAEA7hE,2BACUW,KAAKgI,eAAe,kBAE1BhI,KAAK0iB,OAELzhB,EAAA,2BACJ,CAEA5B,6BACUW,KAAKgI,eAAe,oBAE1BhI,KAAK0iB,OAELzhB,EAAA,2BACJ,CAEA29D,sBACI5+D,KAAKmhE,0BACLnhE,KAAK+gE,aACL/gE,KAAKo+D,yBAAyBtxD,gBAClC,CAEAi0D,aACI,MAAMD,EAAW9gE,KAAKw+D,WAAWp5C,MAE7BplB,KAAK6+D,YAAYX,IAAa4C,KAAY5C,GAAUl+D,KAAK6+D,UACzD7+D,KAAKugE,UACA59C,QACAhe,OAAOD,EAAE,kBACLC,OAAOD,EAAE,YAAY6gB,KAAKu7C,IAC1Bn8D,OAAO,OACPA,OAAOu5D,GAAUl+D,KAAK6+D,UAAUiC,KAEpC35B,OAGLnnC,KAAKugE,UAAU59C,QAAQD,MAE/B,CAEArjB,2BACI,IAAI,QAACqH,EAAO,MAAEuf,SAAe1iB,EAAA,OAAY,iBAAkBvD,KAAKglB,WAEhE,IAAK,MAAM3a,KAAO3D,EACd2D,EAAI9K,OAAS8K,EAAIxB,cAAcwB,EAAIxB,cAAcpG,OAAS,GAK9D,GAFAiE,EAAUA,EAAQkF,QAAO,EAAErM,YAAYA,IAAWS,KAAKT,SAEhC,IAAnBmH,EAAQjE,OACRzC,KAAKwgE,uBAAuB99C,WACzB,CACH1iB,KAAKwgE,uBAAuBr5B,OAC5BnnC,KAAKygE,mBAAmBl7C,KAAK,OAAOvlB,KAAKglB,UAAUvhB,UAAUzD,KAAKglB,UAAU1R,YAE5EtT,KAAK0gE,kBAAkB/9C,QAEvB,MAAMy+C,EAAmB16D,EAAQjE,QA5brB,GA4biDiE,EAAUA,EAAQsK,MAAM,EA5bzE,IA6bNqwD,QAAuBxhE,EAAA,iBAAeuhE,EAAiBz1D,KAAItB,GAAOA,EAAI9K,UACtEsB,EAAgB,yCAA0CA,cAEhE,IAAK,MAAMyC,KAAQ+9D,EAAgB,CAC/B,MAAMvhE,EAAWwD,EAAKqb,sBAAsB9d,GACtC+2B,QAAkB,eAAuB93B,EAAU,CAAC23B,cAAc,IAExEz3B,KAAK0gE,kBAAkB/7D,OACnBD,EAAE,QAAQC,OAAOizB,GAEzB,CAEIlxB,EAAQjE,OAzcA,GA0cRzC,KAAK2gE,uBAAuBx5B,OAAO5hB,KAAK,WAAWU,EA1c3C,YA4cRjmB,KAAK2gE,uBAAuBj+C,MAEpC,CACJ,CAEAm+C,YAAY77C,GACR,MAAuB,UAAnBA,EAAUvhB,KACNuhB,EAAU1R,KAAKpL,WAAW,UACnB,mBACA8c,EAAU1R,KAAKpL,WAAW,aAC1B,sBAEA,QAGa,aAAnB8c,EAAUvhB,KACR,gBAGPzD,KAAKs1C,OAAO/vB,KAAK,GAEzB,CAEA47C,0BACI,IAAIL,EAAW9gE,KAAKw+D,WAAWp5C,MAE1BnkB,EAAA,6BAA2B6/D,KAE5BA,EAAW7/D,EAAA,4BAA0B6/D,GAErC9gE,KAAKw+D,WAAWp5C,IAAI07C,IAGF,qBAAlB9gE,KAAK6+D,SACLiC,EAAW,SAASA,IACK,wBAAlB9gE,KAAK6+D,WACZiC,EAAW,YAAYA,KAG3B9gE,KAAKglB,UAAU1R,KAAOwtD,EACtB9gE,KAAKglB,UAAUlM,cAAgB9Y,KAAKigE,kBAAkB7mC,GAAG,YAErDp5B,KAAK6+D,SAASz4D,SAAS,eACvBpG,KAAKglB,UAAU5R,MAAQpT,KAAKshE,uBAEL,aAAlBthE,KAAK6+D,SACV7+D,KAAKglB,UAAU5R,MAAQpT,KAAK6/D,iBAAiBrkB,oBAG7Cx7C,KAAKglB,UAAU5R,MAAQpT,KAAK++D,YAAY35C,MAG5CplB,KAAKgI,eAAe,sBAAuB,CAAEwS,WAAYxa,KAAKggE,eAClE,CAEAsB,uBACI,MAAMjyC,EAAQ,GAYd,GAVIrvB,KAAKi/D,eAAe7lC,GAAG,cACvB/J,EAAM/iB,KAAK,YAE4B,KAAnCtM,KAAKm/D,oBAAoB/5C,OACzBiK,EAAM/iB,KAAK,SAAStM,KAAKm/D,oBAAoB/5C,UAIrDiK,EAAM/iB,KAAKtM,KAAKq/D,mBAAmBj6C,OAEb,qBAAlBplB,KAAK6+D,SACLxvC,EAAM/iB,KAAKtM,KAAKu/D,gBAAgBn6C,OAEG,WAA/BplB,KAAKu/D,gBAAgBn6C,OAA2D,KAArCplB,KAAKy/D,sBAAsBr6C,OACtEiK,EAAM/iB,KAAK,aAAatM,KAAKy/D,sBAAsBr6C,cAEpD,GAAsB,wBAAlBplB,KAAK6+D,UAAsC7+D,KAAK2/D,sBAAsBv6C,MAAMpL,OAAOvX,OAAS,EAAG,CACtG,MAAM8+D,EAAsBvhE,KAAK2/D,sBAAsBv6C,MAEvDiK,EAAM/iB,KAAK,WAAWrL,EAAA,4BAA0BsgE,KACpD,CAQA,OANAvhE,KAAKw/D,oBAAoBryC,OACH,qBAAlBntB,KAAK6+D,UAC6B,WAA/B7+D,KAAKu/D,gBAAgBn6C,OAE5BplB,KAAKk/D,kBAAkB/xC,OAAOntB,KAAKi/D,eAAe7lC,GAAG,aAE9C/J,EAAM3d,KAAK,IACtB,CAEAgR,OACI1iB,KAAKg0C,WAAU,EACnB,CAEAxuB,WAAWjmB,GACP,OAAOmF,EAAE,MAAO,CACZ2H,KAAM,SAAS9M,IACf+lB,MAAO,kBAEf,CAEAjmB,qBACIW,KAAK0iB,MACT,EC/tBJ,SAAS8+C,GAAI/3B,GACTA,EAAMA,EAAIzvB,OAEV,MAAM+iB,EAAS,GAEf,IAAI0kC,GAAS,EACTC,EAAc,GAElB,SAASC,EAAiBC,GACtB,MAAO,CAAC,IAAK,IAAK,IAAK,IAAK,KAAKz4D,SAASy4D,EAC9C,CAEA,SAASC,IACL,OAA2B,IAAvBH,EAAYj/D,QAILk/D,EAAiBD,EAAYA,EAAYj/D,OAAS,GAEjE,CAKA,SAASq/D,EAAWC,GACI,KAAhBL,IAIJ3kC,EAAOzwB,KAAK,CACRiZ,KAAMm8C,EACNM,WAAYD,EAAWL,EAAYj/D,OAAS,EAC5Cs/D,SAAUA,IAGdL,EAAc,GAClB,CAEA,IAAK,IAAIlyD,EAAI,EAAGA,EAAIi6B,EAAIhnC,OAAQ+M,IAAK,CACjC,MAAMoyD,EAAMn4B,EAAIj6B,GAEhB,GAAY,OAARoyD,EAYC,GAAI,CAAC,IAAK,IAAK,KAAKz4D,SAASy4D,GACzBH,EAOIA,IAAWG,GAChBH,GAAS,EAETK,EAAWtyD,EAAI,IAIfkyD,GAAeE,GAbXC,KACAC,EAAWtyD,EAAI,GAGnBiyD,EAASG,OANZ,CAmBA,IAAKH,EAAQ,CACd,GAA2B,IAAvBC,EAAYj/D,SAAyB,MAARm/D,GAAuB,MAARA,GAAc,CAC1DF,EAAcE,EAEd,QACJ,CACK,GAAY,MAARA,EAAa,CAClBE,EAAWtyD,EAAI,GACf,QACJ,CACK,GAAI,CAAC,IAAK,KAAKrG,SAASy4D,GAAM,CAC/BE,EAAWtyD,EAAI,GAEfkyD,EAAcE,EAEdE,EAAWtyD,GAEX,QACJ,CACK,GAAIqyD,MAA6BF,EAAiBC,GAAM,CACzDE,EAAWtyD,EAAI,GAEfkyD,GAAeE,EACf,QACJ,CACJ,CAEAF,GAAeE,CAFf,MAvDSpyD,EAAI,EAAKi6B,EAAIhnC,QACd+M,IAEAkyD,GAAej4B,EAAIj6B,IAGnBkyD,GAAeE,CAoD3B,CAIA,OAFAE,EAAWr4B,EAAIhnC,OAAS,GAEjBs6B,CACX,CAEA,SAASklC,GAAmBnB,GACxB,GAAwB,IAApBA,EAASr+D,OACT,MAAM,IAAI+K,MAAM,mBAGpB,IAAKvM,EAAA,6BAA2B6/D,GAC5B,MAAM,IAAItzD,MAAM,SAASszD,gCAEjC,CAEA,SAAStlD,GAAMuhB,EAAQ0M,EAAKy4B,GAAsB,GAC9C,MAAM9kD,EAAQ,GAEd,SAAS+kD,EAAQ3yD,GACb,IAAI,WAACwyD,EAAU,SAAED,GAAYhlC,EAAOvtB,GAIpC,OAHAwyD,EAAanqD,KAAKssB,IAAI,EAAG69B,EAAa,IACtCD,EAAWlqD,KAAK2xC,IAAI/f,EAAIhnC,OAAQs/D,EAAW,IAEpC,IAAmB,IAAfC,EAAmB,MAAQ,KAAKv4B,EAAIzT,OAAOgsC,EAAYD,EAAWC,KAAcD,IAAat4B,EAAIhnC,OAAS,MAAQ,KACjI,CAEA,IAAK,IAAI+M,EAAI,EAAGA,EAAIutB,EAAOt6B,OAAQ+M,IAAK,CACpC,MAAM,KAAC+V,EAAI,WAAEy8C,GAAcjlC,EAAOvtB,GAElC,SAASsJ,IACL,OAAIikB,EAAOt6B,OAAS+M,EAAI,GACM,MAAvButB,EAAOvtB,EAAI,GAAG+V,MACS,SAAvBwX,EAAOvtB,EAAI,GAAG+V,MACS,MAAvBwX,EAAOvtB,EAAI,GAAG+V,OAEjB/V,GAAK,GAEE,EAKf,CAEA,GAAI+V,EAAKrd,WAAW,KAAM,CACtB,MAAMk6D,EAAY78C,EAAKyQ,OAAO,GAE9BisC,GAAmBG,GAEnB,MAAMrvD,EAAO,CACTtP,KAAM,QACN6P,KAAM8uD,EACNtpD,cAAeA,IACfkpD,WAAYA,EACZD,SAAUhlC,EAAOvtB,GAAGuyD,UAGxB,GAAIvyD,EAAI,EAAIutB,EAAOt6B,QAAiC,MAAvBs6B,EAAOvtB,EAAI,GAAG+V,KAAc,CACrD,GAAI/V,EAAI,GAAKutB,EAAOt6B,OAChB,MAAM,IAAI+K,MAAM,GAAG20D,EAAQ3yD,YAAY+V,SAG3C/V,GAAK,EAELuD,EAAKK,MAAQ2pB,EAAOvtB,GAAG+V,KACvBxS,EAAKgvD,SAAWhlC,EAAOvtB,GAAGuyD,QAC9B,CAEA3kD,EAAM9Q,KAAKyG,EACf,KACK,KAAIwS,EAAKrd,WAAW,KAqCrB,MAAM,IAAIsF,MAAM,GAAG20D,EAAQ3yD,eAAe+V,MArCf,CAC3B,MAAM88C,EAAe98C,EAAKyQ,OAAO,GAEjCisC,GAAmBI,GAEnB,MAAMtvD,EAAO,CACTtP,KAAM,WACN6P,KAAM+uD,EACNvpD,cAAeA,IACfkpD,WAAYA,EACZD,SAAUhlC,EAAOvtB,GAAGuyD,UAKxB,GAFA3kD,EAAM9Q,KAAKyG,GAEPvD,EAAI,GAAKutB,EAAOt6B,QAAiC,MAAvBs6B,EAAOvtB,EAAI,GAAG+V,KAAc,CACtD,GAAI28C,EACA,MAGA,MAAM,IAAI10D,MAAM,GAAG20D,EAAQ3yD,YAAY+V,eAE/C,CAEA/V,GAAK,EAEL,IAAI1P,EAAWi9B,EAAOvtB,GAAG+V,KACrBzlB,EAASoI,WAAW,OACpBpI,EAAWA,EAASk2B,OAAO,IAG/B,MAAMz2B,EAASO,EAASgJ,MAAM,KAAKgI,MAEnCiC,EAAKK,MAAQ7T,EACbwT,EAAKgvD,SAAWhlC,EAAOvtB,GAAGuyD,QAC9B,CAGA,CACJ,CAEA,OAAO3kD,CACX,CAQA,SANA,SAAqBqsB,EAAKy4B,GAAsB,GAG5C,OAAO1mD,GAFQgmD,GAAI/3B,GAEEA,EAAKy4B,EAC9B,gEClNA,MAiHMI,GAAe,CACjBC,cAAe,CACX,UACA,OACA,aACA,OACA,SACA,YACA,gBACA,OACA,cACA,YACA,aACA,QACA,eACA,aACA,eACA,cACA,cACA,OACA,WACA,kBACA,QACA,eACA,kBACA,sBACA,SACA,cACA,eACA,oBACA,mBACA,oBACA,qBACA,uBACA,kBACA,qBACA,OACA,YACA,sBACA,YACA,YACA,cACA,YACA,cACA,iBACA,4BACA,2BAEJC,QAAS,CACL3/C,MAAO,IAEX4/C,YAAa,aACbC,QAjGiB,CACjBC,MAAO,CACH,CACIC,OAAQ,IACRC,KAAMjpB,GAAa,gCAAsDA,GACzEkpB,aAAc/+C,IACV,MAAMg/C,EAActxD,SAASslC,cAAc,UAI3C,OAFAgsB,EAAYC,UAAY,GAAGj/C,EAAKo1B,4BAEzB4pB,CAAW,EAEtBE,kBAAmB,GAEvB,CACIL,OAAQ,IACRC,KAAMxjE,gBACkBkE,EAAA,MAAW,qCAAqC0oB,mBAAmB2tB,OAE1EjuC,KAAI2H,IACN,CACHgT,GAAI,IAAIhT,IACRA,KAAMA,MAIlB2vD,kBAAmB,GAEvB,CACIL,OAAQ,IACRC,KAAMxjE,gBACkBkE,EAAA,MAAW,wCAAwC0oB,mBAAmB2tB,OAE7EjuC,KAAI2H,IACN,CACHgT,GAAI,IAAIhT,IACRA,KAAMA,MAIlB2vD,kBAAmB,MA4DhB,MAAMC,WAA8B,IAC/CvgE,YAAYwgE,GACRvgE,QAEA5C,KAAKmjE,sBAAwBA,CACjC,CAEArvB,WACI9zC,KAAKwiB,QAAU9d,EAzKX,2wDA0KJ1E,KAAKojE,QAAUpjE,KAAKwiB,QAAQjW,KAAK,0BAEjCvM,KAAKkW,YAAclW,KAAKqjE,aAExBrjE,KAAKojE,QAAQ7uD,GAAG,WAAWlV,UACP,KAAZqJ,EAAE2b,OAEF1b,YAAW,IAAM3I,KAAK88B,QAAQ,KAGlC98B,KAAKmjE,sBAAsBzgD,MAAM,IAGrC1iB,KAAKojE,QAAQ7uD,GAAG,QAAQ,IAAMvU,KAAK88B,SAEnC98B,KAAKsjE,uBAAyBtjE,KAAKwiB,QAAQjW,KAAK,6BAChDvM,KAAKsjE,uBAAuB/uD,GAAG,SAAS7L,GAAK1I,KAAKujE,gBAAgB76D,KAElE1I,KAAKwjE,sBAAwBxjE,KAAKwiB,QAAQjW,KAAK,2BAC/CvM,KAAKwjE,sBAAsBjvD,GAAG,SAAS,IAAMvU,KAAK88B,SAElD98B,KAAKyjE,QAAUzjE,KAAKwiB,QAAQjW,KAAK,oBACrC,CAEAg3D,gBAAgB76D,GACZ,SAAwB,CACpBgb,EAAGhb,EAAEic,MACLnB,EAAG9a,EAAEkc,MACLnB,YAAa,OACbZ,MAAO,CACH,CAACvY,MAAO,+CAAgDua,QAAS,cAAeZ,OAAQ,cACxF,CAAC3Z,MAAO,kDAAmDua,QAAS,iBAAkBZ,OAAQ,kBAC9F,CAAC3Z,MAAO,QACR,CAACA,MAAO,UAAWua,QAAS,wBAAyBZ,OAAQ,eAC7D,CAAC3Z,MAAO,UAAWua,QAAS,2BAA4BZ,OAAQ,gBAEpEM,sBAAuB,EAAEM,aAAa7kB,KAAK0jE,6BAA6B7+C,IAEhF,CAGAxlB,wBAAuB,MAACI,IAChBO,KAAKy0C,cAAch1C,WACbO,KAAK80C,UAEX90C,KAAK0jE,6BAA6B,eAE1C,CAGArkE,2BAA0B,MAACI,IACnBO,KAAKy0C,cAAch1C,WACbO,KAAK80C,UAEX90C,KAAK0jE,6BAA6B,kBAE1C,CAEArkE,mCAAmCwlB,GAC/B,MAAMzH,EAAQpd,KAAK2jE,kBAEnB,IAAKvmD,EACD,OAGJ,IAAI3Z,EAAM6P,EAAMF,EAEhB,GAAgB,gBAAZyR,EACAphB,EAAO,QACP6P,EAAO,UACPF,EAAQ,QACL,GAAgB,mBAAZyR,EACPphB,EAAO,WACP6P,EAAO,aACPF,EAAQ,QACL,GAAgB,0BAAZyR,EACPphB,EAAO,QACP6P,EAAO,gBACPF,EAAQ,2BACL,IAAgB,6BAAZyR,EAKP,OAJAphB,EAAO,QACP6P,EAAO,sBACPF,EAAQ,iBAGZ,CAEAgK,EAAM9Q,KAAK,CACP7I,OACA6P,OACAF,QACA0F,eAAe,UAGb9Y,KAAK4jE,sBAAsBxmD,GAAO,GAExCpd,KAAKojE,QAAQS,UAAU7jE,KAAKojE,QAAQ,GAAGU,cAEvC,MAAMC,EAAO/jE,KAAKojE,QAAQ,GAAGpa,wBAE7BrgD,YAAW,KAEP3I,KAAKmjE,sBAAsBa,oBAAoB,CAC3ChE,cAAe5iD,EACf4H,UAAW5H,EAAMA,EAAM3a,OAAS,GAChCm+D,SAAS,EACTl9C,GAAIqgD,EAAKxgD,KAAOwgD,EAAK7C,OAAS,EAC9B19C,EAAGugD,EAAK7R,OACR95B,MAAO,QACT,GACH,IACP,CAEA/4B,aACI,GAAIW,KAAKikE,oBAAsBjkE,KAAKT,OAGhC,YADA0V,QAAQmhB,KAAK,2DAIjB,MAAM5b,EAAaxa,KAAK2jE,kBAEpBnpD,UACMjX,EAAA,MAAW,SAASvD,KAAKT,oBAAqBib,EAAYxa,KAAK8V,aAErE9V,KAAKwjE,sBAAsBU,UAG3BlkE,KAAKojE,QAAQz/C,IAAI,UAAW,GAG5Bhb,YAAW,IAAM3I,KAAKojE,QAAQz/C,IAAI,UAAW,IAAI,KAEzD,CAEAggD,kBACI,IACI,OAAO,GAA4B3jE,KAAKmkE,sBAC5C,CACA,MAAOz7D,GACH1I,KAAKyjE,QAAQl+C,KAAK7c,EAAEgE,SAAS03D,WACjC,CACJ,CAEAD,sBACI,MAAM16B,EAAMzpC,KAAKy4B,WAAWo8B,UACvB1+C,QAAQ,mDAAoD,MAC5DA,QAAQ,UAAW,KAExB,OAAOzR,EAAE,SAASihB,KAAK8jB,GAAKlkB,MAChC,CAEAlmB,yBACU,oBAA6B,eAEnCW,KAAKwiB,QAAQ2kB,OAEbnnC,KAAKojE,QAAQ7uD,GAAG,SAAS7L,GAAK1I,KAAKqkE,kBAAkB37D,KAGrD1I,KAAKy4B,iBAAmB6rC,cAAch4C,OAAOtsB,KAAKojE,QAAQ,GAAId,IAC9DtiE,KAAKy4B,WAAW8rC,MAAM9yD,SAAS8C,GAAG,eAAe,IAAMvU,KAAKwkE,gBAC5DxkE,KAAKy4B,WAAWoQ,QAAQC,KAAKr3B,SAAS8C,GAAG,SAAS,CAAC8C,EAAOnF,KAEtDA,EAAKukB,iBACLpf,EAAMotD,MAAM,GACb,CAACC,SAAU,SAGd1kE,KAAKy4B,WAAWoQ,QAAQC,KAAK67B,QAAOC,GAAUA,EAAO3tB,aAAa,aAAc,QAASj3C,KAAKy4B,WAAWoQ,QAAQC,KAAKr3B,SAASozD,YAInI,CAEAL,cACIxkE,KAAKikE,kBAAoBjkE,KAAKT,OAE1BS,KAAK8kE,mBAAqB9kE,KAAKy4B,WAAWo8B,UAC1C70D,KAAKwjE,sBAAsBU,UAG3BlkE,KAAKwjE,sBAAsBuB,SAG3B/kE,KAAKyjE,QAAQrqC,GAAG,aAGhBp5B,KAAKyjE,QAAQ/gD,MAErB,CAEArjB,wBAAwBqJ,GACpB,MAAMs8D,EAAMhlE,KAAKy4B,WAAW8rC,MAAM9yD,SAASwzD,UAAUC,mBAErD,GAAIF,GAAOA,EAAIG,UAAYH,EAAIG,SAASjzD,KAAM,CAC1C,MAAMkzD,EAAaplE,KAAKqlE,cAAcL,GAEtC,IAAIM,EAEJ,IACIA,EAAc,GAA4BtlE,KAAKmkE,uBAAuB,EAC1E,CACA,MAAOz7D,GAEH,OAAO,IACX,CAEA,IAAI68D,EAAc,KAElB,IAAK,MAAMxyD,KAAQuyD,EACf,GAAIF,EAAaryD,EAAKivD,YAAcoD,GAAcryD,EAAKgvD,SAAU,CAC7DwD,EAAcxyD,EACd,KACJ,CAGJpK,YAAW,KACH48D,GACAvlE,KAAKojE,QAAQp4C,QAAQ,QAErBhrB,KAAKmjE,sBAAsBa,oBAAoB,CAC3ChE,cAAesF,EACftgD,UAAWugD,EACX3E,SAAS,EACTl9C,EAAGhb,EAAEic,MACLnB,EAAG9a,EAAEkc,SAIT5kB,KAAKwlE,iBACT,GACD,IACP,MAEIxlE,KAAKwlE,iBAEb,CAEAA,kBACIxlE,KAAKmjE,sBAAsBzgD,OAE3B1iB,KAAKojE,QAAQp4C,QAAQ,CACjBlmB,QAAS,QACT6gB,MAAM,EACNrb,MAtaM,4LAuaNkvB,UAAW,SACX43B,OAAQ,SAGZpxD,KAAKojE,QAAQp4C,QAAQ,OACzB,CAEAq6C,cAAcL,GACV,IAAII,EAAaJ,EAAI5T,OAAS4T,EAAIG,SAASM,YAEvCC,EAAUV,EAAIG,SAElB,KAAOO,EAAQC,iBACXD,EAAUA,EAAQC,gBAEG,cAAjBD,EAAQpyD,KACR8xD,GAAcM,EAAQE,OAAOn8C,IAAI,YAAYhnB,OAAS,EAEtD2iE,GAAcM,EAAQxzD,KAAKzP,OAInC,OAAO2iE,CACX,CAEA/lE,6BAA6BuV,EAAKvI,GAC9B,MAAM,OAAC9M,GAAU,gCAAwC8M,GACnD/I,QAAazD,EAAA,gBAAcN,GAAQ,GAEnC+K,EAAQhH,EAAOA,EAAKgH,MAAQ,YAElCsK,EAAI2Q,KAAKjb,EACb,CAEAjL,sBAAsBiE,SACZtD,KAAK4jE,sBAAsBtgE,EAAK6Z,sBAAsB,EAChE,CAEA9d,4BAA4BwmE,EAAiBC,GAEzCD,EAAgBp2D,MAAK,CAACC,EAAGC,IAAMD,EAAER,SAAWS,EAAET,WAE9C,IAAI62D,SAAmB,sBAAmCF,GAAiB,IAAOlgD,OAE9EogD,EAAUtjE,OAAS,IACnBsjE,GAAa,UAGjB/lE,KAAKy4B,WAAWw7B,QAAQ8R,GAEpBD,IACA9lE,KAAK8kE,iBAAmB9kE,KAAKy4B,WAAWo8B,UAExC70D,KAAKwjE,sBAAsBU,QAAQ,GAE3C,CAEA7kE,iCAAiCiL,GAC7B,MAAM,KAAChH,SAAc,6BAA2CtD,KAAKF,SAAU,CAC3EN,UAAU,EACV8K,MAAOA,IAGX,OAAOhH,EAAKqb,uBAChB,CAEAtf,0BAA0Bmb,SAChBxa,KAAK4jE,sBAAsBppD,GAAY,EACjD,CAEA4d,QACIp4B,KAAKojE,QAAQt+D,QAAQ,SAErB9E,KAAKy4B,WAAW8rC,MAAMI,QAAQC,IAC1B,MAAMoB,EAAapB,EAAOqB,iBAAiBjmE,KAAKy4B,WAAW8rC,MAAM9yD,SAASozD,UAAW,OAErFD,EAAOsB,aAAaF,EAAW,GAEvC,CAEAzW,uBAAsB,YAAC9lD,IACfA,EAAY4J,iBAAiBrT,KAAK8V,aAAavJ,MAAKwG,GAAQ,cAA6BA,EAAM/S,KAAKsD,SACpGtD,KAAK80C,SAEb,EC/eW,MAAMqxB,WAAiC,IAC9C7yD,WACA,MAAO,iBACX,CAEI8yD,oBACA,MAAO,gCACX,CAEAzjE,cACIC,QAEA5C,KAAKmjE,uBAAwB,IAAIhF,IAC5B3qB,eACAp9B,UAAUpW,MAEfA,KAAKqmE,sBAAwB,IAAInD,GAAsBljE,KAAKmjE,uBACvD3vB,eACAp9B,UAAUpW,MAEfA,KAAKmO,MAAMnO,KAAKqmE,sBAAuBrmE,KAAKmjE,sBAChD,CAEAmD,WACI,MAAO,CACHn/B,MAAOnnC,KAAKsD,KAAK8E,oBACjBkC,MAAO,QACPic,KAAM,mBAEd,CAEAutB,WACI9zC,KAAKwiB,QAAU9d,EApDX,8ZAqDJ1E,KAAKwzC,eAELxzC,KAAKwiB,QAAQjW,KAAK,4BAA4Bg6D,YAAYvmE,KAAKqmE,sBAAsB/xD,UACrFtU,KAAKwiB,QAAQ7d,OAAO3E,KAAKmjE,sBAAsB7uD,UAE/CtU,KAAKs1C,OAAS5wC,EAAE,QACpB,CAEArF,oCACUW,KAAKqmE,sBAAsBvpC,MACrC,CAEAz9B,sCACUW,KAAKqmE,sBAAsBvxB,SACrC,CAEAz1C,kCAAiC,WAACmb,UACxBxa,KAAKqmE,sBAAsBG,oBAAoBhsD,EACzD,CAEA4d,QACIp4B,KAAKqmE,sBAAsBjuC,OAC/B,EC5BW,MAAMquC,WAA0B,IAC3C1yB,YACI,MAA2B,aAApB/zC,KAAKsD,MAAMG,IACtB,CAEAqwC,WACI9zC,KAAKwiB,QAAU9d,EAhDX,otEAiDJ1E,KAAKwiB,QAAQjO,GAAG,oBAAoB,IAAMvU,KAAK0mE,kBAAkB1mE,KAAKsD,QAEtEtD,KAAK2mE,iCAAmC3mE,KAAKwiB,QAAQjW,KAAK,sDAC1DvM,KAAK4mE,kBAAoB5mE,KAAKwiB,QAAQjW,KAAK,wBAC3CvM,KAAK6mE,uBAAyB7mE,KAAKwiB,QAAQjW,KAAK,6BAChDvM,KAAK8mE,kBAAoB9mE,KAAKwiB,QAAQjW,KAAK,uBAC3CvM,KAAK+mE,kBAAoB/mE,KAAKwiB,QAAQjW,KAAK,uBAE3CvM,KAAKgnE,kBAAoBhnE,KAAKwiB,QAAQjW,KAAK,uBAC3CvM,KAAKgnE,kBAAkBzyD,GAAG,SAAS,KAC3BvU,KAAKgnE,kBAAkBxyD,SAAS,aAIpCxU,KAAKgI,eAAe,mBAAoB,CACpClI,SAAUE,KAAKd,YAAYY,SAC3Bw8D,YAAa,UACf,IAGNt8D,KAAKinE,kBAAoBjnE,KAAKwiB,QAAQjW,KAAK,wBAC3CvM,KAAKinE,kBAAkB1yD,GAAG,SAAS,IAAMvU,KAAKgI,eAAe,mBAAoB,CAACzI,OAAQS,KAAKT,WAE/FS,KAAKwiB,QAAQjO,GAAG,QAAS,kBAAkB,IAAMvU,KAAKwiB,QAAQjW,KAAK,4BAA4B4xC,SAAS,YAExGn+C,KAAKknE,0BAA4BlnE,KAAKwiB,QAAQjW,KAAK,gCACnDvM,KAAKmnE,sBAAwBnnE,KAAKwiB,QAAQjW,KAAK,4BAE/CvM,KAAKonE,kBAAoBpnE,KAAKwiB,QAAQjW,KAAK,uBAC3CvM,KAAKonE,kBAAkB7yD,GAAG,SAAS,KACN,SAArBvU,KAAKsD,KAAK/D,QAId,gBAA0B,CAACS,KAAKsD,KAAKqY,oBAAoB,GAAGtJ,WAAW,EAAK,GAEpF,CAEAhT,wBAAwBiE,GACpBtD,KAAK2mE,iCAAiCx5C,OAAO7pB,EAAKuZ,uCAElD7c,KAAKqnE,eAAernE,KAAK4mE,kBAAmB,CAAC,OAAQ,OAAQ,QAAQz9D,SAAS7F,EAAKG,OAEnFzD,KAAKqnE,eAAernE,KAAK8mE,kBAAmB,CAAC,OAAQ,OAAQ,cAAe,UAAW,UAAU39D,SAAS7F,EAAKG,OAE/GzD,KAAKqnE,eAAernE,KAAK6mE,uBAAwB,CAAC,OAAQ,QAAQ19D,SAAS7F,EAAKG,OAEhFzD,KAAK+mE,kBAAkB55C,OAAqB,WAAd7pB,EAAKG,MAEnCzD,KAAKqnE,eAAernE,KAAKknE,0BAA2BjmE,EAAA,uBAAuB,CAAC,SAAU,QAAQkI,SAAS7F,EAAKG,OAC5GzD,KAAKqnE,eAAernE,KAAKmnE,sBACrBlmE,EAAA,uBACIA,EAAA,kBACA,CAAC,SAAU,QAAQkI,SAAS7F,EAAKG,OAIzCzD,KAAKqnE,eAAernE,KAAKgnE,mBAAoB,CAAC,eAAe79D,SAAS7F,EAAK/D,SAE3ES,KAAKqnE,eAAernE,KAAKinE,mBAAoB,CAAC,UAAU99D,SAAS7F,EAAKG,MAC1E,CAEApE,yCACI,UAAWuhC,EAAA,UAAsB,0CAA0C5gC,KAAKsD,KAAKgH,iDACjF,OAGJ,MAAOE,WAAY88D,SAAuB/jE,EAAA,OAAY,SAASvD,KAAKT,gCAE/D+nE,GAKL,sBAAyB,SAASA,EAAch9D,kDAC1C3G,EAAA,wCACA,wCAAyCyF,QAAQk+D,EAAchvD,QAAS,CAC1EnZ,UAAW,CACP4B,SAAU,cACVwJ,aAAc+8D,EAAc/8D,iBAThC,sBAAyB,oBAAoBvK,KAAKsD,KAAKgH,iBAY/D,CAEA+8D,eAAezyD,EAAKszC,GACZA,EACAtzC,EAAI05C,WAAW,YAEf15C,EAAI7B,KAAK,WAAY,WAE7B,CAEAw8C,uBAAsB,YAAC9lD,IACfA,EAAYC,eAAe1J,KAAKT,SAChCS,KAAK80C,SAEb,ECvJW,MAAMyyB,WAAmB,IAEpCpgE,iBAAkB,CAElB2sC,WAGI,OAFA9zC,KAAKwzC,eAEE5wC,MAAMkxC,UACjB,CAGAz0C,gBAAgBiE,GAAO,CAEvBjE,gBAC2BW,KAAK2C,YAAY6kE,kBACXxnE,KAAKqW,OAAOoxD,iBAGrCznE,KAAKg0C,WAAU,GAEfh0C,KAAKw0C,YAGLx0C,KAAKg0C,WAAU,SAETh0C,KAAK0nE,UAAU1nE,KAAKsD,MAE1BtD,KAAKsH,aAAa,sBAAuB,CAAC7H,MAAOO,KAAKd,YAAYO,QAE1E,CAEAsJ,WACI,OAAO/I,KAAKwiB,QAAQ4W,GAAG,aAAep5B,KAAKd,aAAaO,QAAU,gCACtE,CAGAo1D,UAAW,CAEXz8B,QAAS,CAET/4B,wCAAuC,YAACH,IAChCc,KAAKy0C,cAAcv1C,EAAYO,eACzBO,KAAK80C,UAEX90C,KAAKo4B,QAEb,CAGA5hB,sBAAsBlD,EAAMpB,GACxB,MAAI,CAAC,uBAAwB,kBAAkB/I,SAASmK,GAE7C1Q,MAAM4T,sBAAsB,iBAAkBtE,GAEvC,qBAAToB,EACE1Q,MAAM4T,sBAAsBlD,EAAMpB,GAGlCjI,QAAQC,SAEvB,mCC7DJ,MAAMy9D,GAAkB,CACpB,CAAEtlD,SAAS,EAAM/X,MAAO,MAAOnK,KAAM,cACrC,CAAEmK,MAAO,MAAOnK,KAAM,YACtB,CAAEmK,MAAO,QAASnK,KAAM,mBACxB,CAAEmK,MAAO,UAAWnK,KAAM,sBAC1B,CAAEmK,MAAO,WAAYnK,KAAM,mBAC3B,CAAEmK,MAAO,YAAanK,KAAM,oBAC5B,CAAEkiB,SAAS,EAAM/X,MAAO,IAAKnK,KAAM,eACnC,CAAEkiB,SAAS,EAAM/X,MAAO,KAAMnK,KAAM,iBACpC,CAAEkiB,SAAS,EAAM/X,MAAO,MAAOnK,KAAM,iBACrC,CAAEmK,MAAO,UAAWnK,KAAM,kBAC1B,CAAEmK,MAAO,gBAAiBnK,KAAM,wBAChC,CAAEmK,MAAO,4BAA6BnK,KAAM,cAC5C,CAAEmK,MAAO,QAASnK,KAAM,gBACxB,CAAEmK,MAAO,QAASnK,KAAM,gBACxB,CAAEmK,MAAO,eAAgBnK,KAAM,qBAC/B,CAAEmK,MAAO,cAAenK,KAAM,sBAC9B,CAAEmK,MAAO,MAAOnK,KAAM,oBACtB,CAAEmK,MAAO,UAAWnK,KAAM,kBAC1B,CAAEkiB,SAAS,EAAM/X,MAAO,MAAOnK,KAAM,YACrC,CAAEmK,MAAO,SAAUnK,KAAM,8BACzB,CAAEmK,MAAO,SAAUnK,KAAM,iBACzB,CAAEmK,MAAO,IAAKnK,KAAM,YACpB,CAAEmK,MAAO,OAAQnK,KAAM,oBACvB,CAAEmK,MAAO,OAAQnK,KAAM,eACvB,CAAEmK,MAAO,SAAUnK,KAAM,iBACzB,CAAEmK,MAAO,aAAcnK,KAAM,qBAC7B,CAAEmK,MAAO,MAAOnK,KAAM,uBACtB,CAAEmK,MAAO,QAASnK,KAAM,gBACxB,CAAEmK,MAAO,OAAQnK,KAAM,eACvB,CAAEmK,MAAO,MAAOnK,KAAM,cACtB,CAAEmK,MAAO,MAAOnK,KAAM,mBACtB,CAAEmK,MAAO,SAAUnK,KAAM,iBACzB,CAAEmK,MAAO,MAAOnK,KAAM,cACtB,CAAEmK,MAAO,sBAAuBnK,KAAM,qBACtC,CAAEmK,MAAO,gBAAiBnK,KAAM,qBAChC,CAAEmK,MAAO,SAAUnK,KAAM,iBACzB,CAAEmK,MAAO,QAASnK,KAAM,gBACxB,CAAEmK,MAAO,KAAMnK,KAAM,iBACrB,CAAEmK,MAAO,SAAUnK,KAAM,iBACzB,CAAEmK,MAAO,MAAOnK,KAAM,cACtB,CAAEmK,MAAO,QAASnK,KAAM,gBACxB,CAAEmK,MAAO,UAAWnK,KAAM,kBAC1B,CAAEmK,MAAO,MAAOnK,KAAM,cACtB,CAAEmK,MAAO,UAAWnK,KAAM,kBAC1B,CAAEmK,MAAO,oBAAqBnK,KAAM,cACpC,CAAEkiB,SAAS,EAAM/X,MAAO,KAAMnK,KAAM,aACpC,CAAEkiB,SAAS,EAAM/X,MAAO,SAAUnK,KAAM,iBACxC,CAAEmK,MAAO,OAAQnK,KAAM,eACvB,CAAEkiB,SAAS,EAAM/X,MAAO,UAAWnK,KAAM,kBACzC,CAAEmK,MAAO,qBAAsBnK,KAAM,2BACrC,CAAEmK,MAAO,OAAQnK,KAAM,eACvB,CAAEkiB,SAAS,EAAM/X,MAAO,OAAQnK,KAAM,aACtC,CAAEkiB,SAAS,EAAM/X,MAAO,OAAQnK,KAAM,gBACtC,CAAEmK,MAAO,OAAQnK,KAAM,eACvB,CAAEmK,MAAO,MAAOnK,KAAM,cACtB,CAAEkiB,SAAS,EAAM/X,MAAO,OAAQnK,KAAM,eACtC,CAAEmK,MAAO,YAAanK,KAAM,qBAC5B,CAAEmK,MAAO,SAAUnK,KAAM,eACzB,CAAEkiB,SAAS,EAAM/X,MAAO,aAAcnK,KAAM,sCAC5C,CAAEkiB,SAAS,EAAM/X,MAAO,cAAenK,KAAM,uCAC7C,CAAEkiB,SAAS,EAAM/X,MAAO,OAAQnK,KAAM,oBACtC,CAAEmK,MAAO,UAAWnK,KAAM,uBAC1B,CAAEmK,MAAO,MAAOnK,KAAM,YACtB,CAAEmK,MAAO,QAASnK,KAAM,gBACxB,CAAEkiB,SAAS,EAAM/X,MAAO,SAAUnK,KAAM,iBACxC,CAAEmK,MAAO,QAASnK,KAAM,gBACxB,CAAEmK,MAAO,OAAQnK,KAAM,eACvB,CAAEmK,MAAO,aAAcnK,KAAM,qBAC7B,CAAEmK,MAAO,MAAOnK,KAAM,cACtB,CAAEmK,MAAO,cAAenK,KAAM,kBAC9B,CAAEkiB,SAAS,EAAM/X,MAAO,WAAYnK,KAAM,mBAC1C,CAAEmK,MAAO,cAAenK,KAAM,sBAC9B,CAAEmK,MAAO,OAAQnK,KAAM,oBACvB,CAAEmK,MAAO,OAAQnK,KAAM,aACvB,CAAEmK,MAAO,WAAYnK,KAAM,mBAC3B,CAAEmK,MAAO,SAAUnK,KAAM,gBACzB,CAAEmK,MAAO,SAAUnK,KAAM,iBACzB,CAAEmK,MAAO,UAAWnK,KAAM,kBAC1B,CAAEmK,MAAO,QAASnK,KAAM,gBACxB,CAAEmK,MAAO,QAASnK,KAAM,gBACxB,CAAEmK,MAAO,QAASnK,KAAM,qBACxB,CAAEmK,MAAO,OAAQnK,KAAM,eACvB,CAAEmK,MAAO,WAAYnK,KAAM,yBAC3B,CAAEmK,MAAO,cAAenK,KAAM,qBAC9B,CAAEmK,MAAO,QAASnK,KAAM,gBACxB,CAAEmK,MAAO,SAAUnK,KAAM,iBACzB,CAAEmK,MAAO,KAAMnK,KAAM,aACrB,CAAEmK,MAAO,SAAUnK,KAAM,iBACzB,CAAEmK,MAAO,SAAUnK,KAAM,QACzB,CAAEkiB,SAAS,EAAM/X,MAAO,OAAQnK,KAAM,eACtC,CAAEmK,MAAO,MAAOnK,KAAM,mBACtB,CAAEkiB,SAAS,EAAM/X,MAAO,MAAOnK,KAAM,cACrC,CAAEmK,MAAO,MAAOnK,KAAM,cACtB,CAAEmK,MAAO,QAASnK,KAAM,gBACxB,CAAEmK,MAAO,aAAcnK,KAAM,gBAC7B,CAAEmK,MAAO,aAAcnK,KAAM,4BAC7B,CAAEmK,MAAO,OAAQnK,KAAM,qBACvB,CAAEmK,MAAO,WAAYnK,KAAM,mBAC3B,CAAEmK,MAAO,MAAOnK,KAAM,cACtB,CAAEmK,MAAO,SAAUnK,KAAM,iBACzB,CAAEkiB,SAAS,EAAM/X,MAAO,SAAUnK,KAAM,iBACxC,CAAEmK,MAAO,IAAKnK,KAAM,YACpB,CAAEmK,MAAO,IAAKnK,KAAM,eACpB,CAAEmK,MAAO,mBAAoBnK,KAAM,cACnC,CAAEmK,MAAO,cAAenK,KAAM,sBAC9B,CAAEmK,MAAO,WAAYnK,KAAM,mBAC3B,CAAEkiB,SAAS,EAAM/X,MAAO,OAAQnK,KAAM,eACtC,CAAEmK,MAAO,OAAQnK,KAAM,kBACvB,CAAEmK,MAAO,MAAOnK,KAAM,cACtB,CAAEmK,MAAO,OAAQnK,KAAM,eACvB,CAAEmK,MAAO,QAASnK,KAAM,gBACxB,CAAEmK,MAAO,SAAUnK,KAAM,iBACzB,CAAEmK,MAAO,OAAQnK,KAAM,eACvB,CAAEkiB,SAAS,EAAM/X,MAAO,eAAgBnK,KAAM,aAC9C,CAAEmK,MAAO,QAASnK,KAAM,qBACxB,CAAEmK,MAAO,OAAQnK,KAAM,eACvB,CAAEmK,MAAO,YAAanK,KAAM,gBAC5B,CAAEmK,MAAO,SAAUnK,KAAM,iBACzB,CAAEmK,MAAO,MAAOnK,KAAM,cACtB,CAAEmK,MAAO,OAAQnK,KAAM,eACvB,CAAEmK,MAAO,MAAOnK,KAAM,cACtB,CAAEmK,MAAO,SAAUnK,KAAM,4BACzB,CAAEmK,MAAO,cAAenK,KAAM,sBAC9B,CAAEkiB,SAAS,EAAM/X,MAAO,MAAOnK,KAAM,cACrC,CAAEmK,MAAO,SAAUnK,KAAM,iBACzB,CAAEkiB,SAAS,EAAM/X,MAAO,mBAAoBnK,KAAM,gCAClD,CAAEmK,MAAO,WAAYnK,KAAM,mBAC3B,CAAEmK,MAAO,OAAQnK,KAAM,eACvB,CAAEmK,MAAO,SAAUnK,KAAM,eACzB,CAAEkiB,SAAS,EAAM/X,MAAO,QAASnK,KAAM,gBACvC,CAAEmK,MAAO,gBAAiBnK,KAAM,wBAChC,CAAEmK,MAAO,MAAOnK,KAAM,cACtB,CAAEmK,MAAO,UAAWnK,KAAM,kBAC1B,CAAEmK,MAAO,cAAenK,KAAM,qBAC9B,CAAEmK,MAAO,YAAanK,KAAM,aAC5B,CAAEmK,MAAO,OAAQnK,KAAM,eACvB,CAAEmK,MAAO,UAAWnK,KAAM,kBAC1B,CAAEmK,MAAO,QAASnK,KAAM,cACxB,CAAEmK,MAAO,OAAQnK,KAAM,eACvB,CAAEmK,MAAO,WAAYnK,KAAM,mBAC3B,CAAEmK,MAAO,SAAUnK,KAAM,eACzB,CAAEmK,MAAO,OAAQnK,KAAM,eACvB,CAAEmK,MAAO,aAAcnK,KAAM,0BAC7B,CAAEmK,MAAO,iBAAkBnK,KAAM,uBACjC,CAAEmK,MAAO,SAAUnK,KAAM,aACzB,CAAEmK,MAAO,WAAYnK,KAAM,iBAC3B,CAAEmK,MAAO,WAAYnK,KAAM,iBAC3B,CAAEmK,MAAO,UAAWnK,KAAM,kBAC1B,CAAEmK,MAAO,OAAQnK,KAAM,eACvB,CAAEmK,MAAO,WAAYnK,KAAM,cAC3B,CAAEmK,MAAO,UAAWnK,KAAM,iBAC1B,CAAEkiB,SAAS,EAAM/X,MAAO,MAAOnK,KAAM,YACrC,CAAEmK,MAAO,SAAUnK,KAAM,sBACzB,CAAEmK,MAAO,KAAMnK,KAAM,aACrB,CAAEmK,MAAO,QAASnK,KAAM,gBACxB,CAAEkiB,SAAS,EAAM/X,MAAO,OAAQnK,KAAM,eACtC,CAAEmK,MAAO,MAAOnK,KAAM,eAG1B,IAAI,GAAY,KAEhB,SAASynE,KACL,GAAY97D,KAAK0P,MAAM1P,KAAKC,UAAU47D,KAEtC,MAAME,EAAmBrnE,EAAA,UAAgB,uBAClCmnE,GAAgB/7D,QAAOk8D,GAAMA,EAAGzlD,UAAS1W,KAAIm8D,GAAMA,EAAG3nE,OAE7D,IAAK,MAAM2nE,KAAM,GACbA,EAAGtjD,QAAUqjD,EAAiB1+D,SAAS2+D,EAAG3nE,OAAqB,eAAZ2nE,EAAG3nE,IAE9D,CAUA,UACI4nE,aATJ1oE,iBAKI,OAJkB,OAAd,IACAuoE,KAGG,EACX,EAIIA,mDClLW,MAAMI,WAA+BT,GAChDU,kBAAkBC,GACdloE,KAAKwiB,QAAQjO,GAAG,WAAY,OAAO7L,GAAK1I,KAAKmoE,sBAAsBzjE,EAAEgE,EAAEiK,WAEvE3S,KAAKwiB,QAAQjO,GAAG,QAAS,OAAO7L,IAC5B,MAAMguB,EAA0B,IAAZhuB,EAAE2b,MAChBsS,EAA4B,IAAZjuB,EAAE2b,MAClB/M,EAAUrW,EAAA,kBAAgByH,GAE3BguB,GAAepf,GAAYqf,EAC5B32B,KAAKooE,kBAAkB1jE,EAAEgE,EAAEiK,SAEtB+jB,GAAewxC,GACpBloE,KAAKmoE,sBAAsBzjE,EAAEgE,EAAEiK,QACnC,GAER,CAEAtT,4BAA4B8sB,GACxB,MAAM,OAAE5sB,EAAM,UAAEJ,SAAoBa,KAAKqoE,eAAel8C,GAEpD5sB,EACA,wCAAyC6J,QAAQ7J,EAAQ,CAAEJ,cAE3DsC,OAAOyE,KAAKimB,EAAKxX,KAAK,OAAQ,SAEtC,CAEAyzD,kBAAkBj8C,GACd,MAAM,OAAE5sB,EAAM,UAAEJ,GAAca,KAAKqoE,eAAel8C,GAE9C5sB,EACA,iDAAkDA,EAAQ,CAAEJ,cAE5DsC,OAAOyE,KAAKimB,EAAKxX,KAAK,OAAQ,SAEtC,CAEAtV,qBAAqB8sB,GACjB,MAAMm8C,EAASn8C,EAAKxX,KAAK,OAEnB4zD,EAAiBD,EAAOpyC,MAAM,oCACpC,GAAIqyC,EACA,MAAO,CACHhpE,OAAQgpE,EAAe,GACvBppE,UAAW,CAAC,GAIpB,MAAMqpE,EAAkBF,EAAOpyC,MAAM,gDACrC,GAAIsyC,EAAiB,CACjB,MAAMj+D,EAAei+D,EAAgB,GAGrC,MAAO,CACHjpE,cAHqBM,EAAA,sBAAoB0K,IAGtB+N,QACnBnZ,UAAW,CACP4B,SAAU,cACVwJ,aAAcA,GAG1B,CAEA,OAAO,IACX,CAEAlL,uBAAuBE,EAAQqV,GAC3B,MAAMtR,QAAazD,EAAA,gBAAcN,GAEjC,GAAI+D,EAAM,CACN,MAAMmlE,EAAW/jE,EAAE,sCAEbwf,QAAc,eAAuB5gB,EAAK/D,OAAQ,CACpD+rB,aAAa,IAGjBm9C,EAAS9lD,QAAQhe,OACbD,EAAE,mCACGC,OAAOuf,IAGhB,MAAM,iBAACgH,EAAgB,KAAEznB,SAAc,wBAAmCH,GAE1EmlE,EAAS9jE,OACLD,EAAE,yCAAyCjB,OACtCkB,OAAOumB,IAGhBtW,EAAI+N,QAAQhe,OAAO8jE,EACvB,CACJ,CAEAppE,6BAA6BuV,EAAKvI,EAAO,YAC/B,2BAAmCuI,EAAKvI,EAClD,CAEAo1B,oBAAoB/b,EAAYnmB,GACxBmmB,GACAA,EAAWnZ,KAAK,yBAAyBhN,OAAYo0B,MAAK,CAACssB,EAAG7qC,KAC1DpV,KAAK0oE,iBAAiBnpE,EAAQmF,EAAE0Q,GAAI,GAGhD,ECjGJ,MAEM,GAAe,CACjButD,MAAO,CACH,CACIC,OAAQ,IACRC,KAAMjpB,GAAa,gCAAsDA,GACzEkpB,aAAc/+C,IACV,MAAMg/C,EAActxD,SAASslC,cAAc,UAI3C,OAFAgsB,EAAYC,UAAY,GAAGj/C,EAAKo1B,4BAEzB4pB,CAAW,EAEtBE,kBAAmB,sCCG/B,SA3BA,SAAuC0F,GACnC,IACIA,EAAc51D,KAAK,kBAAmB,QAiB9C,SAAqBs0C,GACjB,MAAM4d,EAAYxjE,OAAO4qC,eACnBu8B,EAAQn3D,SAASo3D,cACvBD,EAAME,mBAAmBzhB,GACzB4d,EAAU8D,kBACV9D,EAAU+D,SAASJ,EACvB,CAtBQK,CAAYN,EAAcl/C,IAAI,IAEdhY,SAASkqC,YAAY,QAGjC,sBAAyB,iCAEzB,0BAA6B,yCAErC,CACA,QACIl6C,OAAO4qC,eAAe08B,kBACtBJ,EAAcra,WAAW,kBAC7B,CACJ,mCCPA,MAAM4a,GAAyB,CAC3B,CAAE,QAAS,CACPpjE,SAAU,EACVwgB,GAAI,QACJ7jB,OAAQ,GACR0mE,SAAU,KAEd,CAAE,QAAS,CAAEhpD,MAAO,GAAImG,GAAI,QAASywC,SAAU,sBAG7CqS,GAAwB,CAC1B,CAAE,QAAS,CACPtjE,SAAU,EACVwgB,GAAI,QACJ7jB,OAAQ,GACR0mE,SAAU,KAEd,CAAE,QAAS,CAAEhpD,MAAO,GAAImG,GAAI,QAASywC,SAAU,qBAC/C,CAAE,QAAS,CACPjxD,SAAU,EACVwgB,GAAI,SACJ7jB,OAAQ,GACRk7C,WAAY,EACZwrB,SAAU,MAIZE,GAA2B,CAC7B,CAAE,QAAS,CACPvjE,SAAU,EACVwgB,GAAI,QACJ7jB,OAAQ,GACR0mE,SAAU,KAEd,CAAE,QAAS,CAAEhpD,MAAO,GAAIra,SAAU,GAAKwgB,GAAI,eAAgBywC,SAAU,qBACrE,CAAE,QAAS,CAAE52C,MAAO,GAAIra,SAAU,GAAKwgB,GAAI,eAAgBywC,SAAU,qBACrE,CAAE,QAAS,CACPjxD,SAAU,EACVwgB,GAAI,SACJ7jB,OAAQ,GACRk7C,WAAY,EACZwrB,SAAU,MAIZG,GAAe,CACjB,CAAE,QAAS,CACPxjE,SAAU,EACVwgB,GAAI,QACJ7jB,OAAQ,GACR0mE,SAAU,MAWlB,IAAII,GAAmB,EC3DvB,SAASC,GAAS/pC,EAAMgqC,EAAQC,GAAY,GACxC,IAAI1/D,EAAS2/D,EAAMxH,EAASyH,EAAW92C,EAGvC,SAAS+2C,IACL,MAAMC,EAAOjzD,KAAKC,MAAQ8yD,EAEtBE,EAAOL,GAAUK,GAAQ,EACzB9/D,EAAUrB,WAAWkhE,EAAOJ,EAASK,IAErC9/D,EAAU,KACL0/D,IACD52C,EAAS2M,EAAKogB,MAAMsiB,EAASwH,GAC7BxH,EAAUwH,EAAO,MAG7B,CAdI,MAAQF,IAAQA,EAAS,KAgB7B,MAAMM,EAAY,WACd5H,EAAUniE,KACV2pE,EAAO/+B,UACPg/B,EAAY/yD,KAAKC,MACjB,MAAMkzD,EAAUN,IAAc1/D,EAO9B,OANKA,IAASA,EAAUrB,WAAWkhE,EAAOJ,IACtCO,IACAl3C,EAAS2M,EAAKogB,MAAMsiB,EAASwH,GAC7BxH,EAAUwH,EAAO,MAGd72C,CACX,EAmBA,OAjBAi3C,EAAUE,MAAQ,WACVjgE,IACAutC,aAAavtC,GACbA,EAAU,KAElB,EAEA+/D,EAAUG,MAAQ,WACVlgE,IACA8oB,EAAS2M,EAAKogB,MAAMsiB,EAASwH,GAC7BxH,EAAUwH,EAAO,KAEjBpyB,aAAavtC,GACbA,EAAU,KAElB,EAEO+/D,CACX,CAGAP,GAASA,SAAWA,GAEpB,aC/DM,MAACz8B,IAAS9rC,EAAA,wCCGhB,MAAMkpE,GAAMlpE,EAAA,mBAgCG,MAAMmpE,WAAsB,IACvCznE,YAAY0nE,GACRznE,QAEA5C,KAAKqqE,WAAaA,CACtB,CAEAv2B,WACI9zC,KAAKwiB,QAAU9d,EAtCX,g5BAwCJ,MAAM4lE,EAAgB7oE,OAAO6rB,iBAAiB7b,SAASuR,iBACvDhjB,KAAKuqE,WAAaD,EAAc/8C,iBAAiB,kBAAkBvT,OAEnEha,KAAK0lB,WAAa1lB,KAAKwiB,QAAQjW,KAAK,uBACpCvM,KAAKwqE,eAAiBxqE,KAAKwiB,QAAQjW,KAAK,mBAExC,IAAIk+C,gBAAe,IAAMzqD,KAAKyqE,kBAAiB9f,QAAQ3qD,KAAK0lB,WAAW,IAEvE1lB,KAAKwiB,QAAQjW,KAAK,6BAA6BgI,GAAG,SAAUlV,UACxD,MAAMoE,EAAOiB,EAAEgE,EAAEiK,QAAQ+B,QAAQ,UAAU3B,KAAK,mBAE1C,WAA0B/S,KAAKT,OAAQ,UAAWkE,EAAK,IAGjEb,MAAMkxC,UACV,CAEA22B,gBACI,IAAKzqE,KAAK0qE,MACN,OAGJ,MAAM5mD,EAAU9jB,KAAKwiB,QAAQnM,SAE7BrW,KAAK0qE,MACAhqB,OAAO58B,EAAQ48B,UACfP,MAAMr8B,EAAQq8B,QACvB,CAEA9gD,sBAAsBiE,GAClBtD,KAAKwiB,QAAQ2kB,OAEbnnC,KAAK2jB,IAAM,CACPgnD,WAAY3qE,KAAK0lB,WAAW/B,IAAI,eAChCinD,UAAW5qE,KAAK6qE,QAAQ7qE,KAAK0lB,WAAW/B,IAAI,UAC5CmnD,eAAgB9qE,KAAK6qE,QAAQ7qE,KAAKwqE,eAAe7mD,IAAI,WAGzD3jB,KAAK+qE,QAAiD,SAAvC/qE,KAAKsD,KAAKic,cAAc,WAAwB,OAAS,aAElE,oBAA6B,kBAEnCvf,KAAK0qE,MAAQM,aAAahrE,KAAK0lB,WAAW,IACrCy6B,MAAMngD,KAAK0lB,WAAWy6B,SACtBO,OAAO1gD,KAAK0lB,WAAWg7B,UACvBuqB,QAAO/2D,GAAQlU,KAAKkrE,aAAah3D,EAAKi3D,KACtCC,aAAa,KACbC,gBAAgB,KAChBC,kBAAiB,CAACr5D,EAAMgc,IAAQjuB,KAAKurE,UAAUt5D,EAAMjS,KAAKwrE,gBAAgBv5D,GAAOgc,KACjFw9C,sBAAqB,CAACx5D,EAAMgc,IAAQjuB,KAAKurE,UAAUt5D,EAAMjS,KAAKwrE,gBAAgBv5D,GAAOgc,KACrFw9C,sBAAqB,CAACx5D,EAAM8H,EAAOkU,KAChCA,EAAIy9C,UAAY3xD,EAChBkU,EAAI09C,YACJ19C,EAAI29C,IAAI35D,EAAKyR,EAAGzR,EAAKuR,EAAGxjB,KAAK6rE,gBAAgB55D,EAAKqU,IAAK,EAAG,EAAIzO,KAAKi0D,IAAI,GACvE79C,EAAI89C,MAAM,IAEbC,WAAU/5D,GAAQk4D,GAAIl4D,EAAKqB,QAC3B24D,QAAQ,GACRC,YAAY,IACZC,2BAA2B,GAC3BC,2BAA2B,GAC3BC,UAAU,GACVC,WAAU,IAAMtsE,KAAK2jB,IAAImnD,iBACzByB,aAAYt6D,GAAQ,wCAAyC7I,QAAQ6I,EAAKqU,MAC1EkmD,kBAAiB,CAACv6D,EAAMvJ,IAAM,qBAAuCuJ,EAAKqU,GAAI5d,KAE9D,SAAjB1I,KAAK+qE,SACL/qE,KAAK0qE,MACA+B,WAAU5qD,GAAK,GAAGsoD,GAAItoD,EAAEm5B,OAAO1nC,mBAAmB62D,GAAItoD,EAAEvO,oBAAoB62D,GAAItoD,EAAElP,OAAOW,UACzFo5D,kBAAiB,CAAC3yB,EAAM9rB,IAAQjuB,KAAK2sE,UAAU5yB,EAAM9rB,KACrD2+C,sBAAqB,IAAM,UAGpC,MAAMC,EAAgB7sE,KAAK8sE,mBACrB56D,QAAalS,KAAK+sE,sBAAsBF,GAExCG,EAAgB96D,EAAKilD,MAAM10D,OAASyP,EAAKuY,MAAMhoB,OAE/CwqE,GAAU,GADOp1D,KAAKq1D,IAAIF,EAAe,KAEzCG,EAAgBt1D,KAAK2xC,KAAK,EAAGyjB,GAEnCjtE,KAAK0qE,MAAM0C,QAAQ,QAAQC,SAAS,IACpCrtE,KAAK0qE,MAAM0C,QAAQ,UAAUE,SAAS,IACtCttE,KAAK0qE,MAAM0C,QAAQ,UAAUE,SAASH,GACtCntE,KAAK0qE,MAAM0C,QAAQ,UAAUG,YAAY,KAEzCvtE,KAAKwtE,WAAWt7D,EACpB,CAEA46D,mBACI,GAAwB,WAApB9sE,KAAKqqE,WACL,OAAOrqE,KAAKT,OAGhB,IAAIstE,EAAgB7sE,KAAKsD,KAAKic,cAAc,iBAQ5C,MANsB,YAAlBstD,EACAA,EAAgB,uBACRA,IACRA,EAAgB,wCAAyCxlE,cAGtDwlE,CACX,CAEArB,gBAAgBv5D,GACZ,OAAIA,EAAK8H,MACE9H,EAAK8H,MACe,WAApB/Z,KAAKqqE,YAA2Bp4D,EAAKqU,KAAOtmB,KAAKT,OACjD,MAEAS,KAAKytE,wBAAwBx7D,EAAKxO,KAEjD,CAEAgqE,wBAAwBhkC,GACI,SAApBzpC,KAAKuqE,aACL9gC,EAAM,IAAIA,KAGd,IAAIx8B,EAAO,EACX,IAAK,IAAIuC,EAAI,EAAGA,EAAIi6B,EAAIhnC,OAAQ+M,IAC5BvC,EAAOw8B,EAAIikC,WAAWl+D,KAAOvC,GAAQ,GAAKA,GAG9C,IAAI8M,EAAQ,IACZ,IAAK,IAAIvK,EAAI,EAAGA,EAAI,EAAGA,IAGnBuK,GAAS,MAFM9M,GAAa,EAAJuC,EAAU,KAEbwJ,SAAS,MAAOgd,QAAQ,GAEjD,OAAOjc,CACX,CAEA8wD,QAAQ8C,GACJ,MAAO,IAAIA,EAAIz3C,MAAM,oCAChBllB,MAAM,GACNrF,KAAI6zC,GAAKr6C,SAASq6C,EAAG,IAAIxmC,SAAS,IAAI40D,SAAS,EAAG,OAClDl8D,KAAK,KACd,CAEAw5D,aAAa2C,GACT7tE,KAAKs9C,UAAYuwB,CACrB,CAEAtC,UAAUt5D,EAAM8H,EAAOkU,GACnB,MAAM,EAACvK,EAAC,EAAEF,GAAKvR,EACTq4B,EAAOtqC,KAAK6rE,gBAAgB55D,EAAKqU,IAWvC,GATA2H,EAAIy9C,UAAY3xD,EAChBkU,EAAI09C,YACJ19C,EAAI29C,IAAIloD,EAAGF,EAAG8mB,EAAM,EAAG,EAAIzyB,KAAKi0D,IAAI,GACpC79C,EAAI89C,SAEa/rE,KAAKs9C,UAAY,GAC1Bt9C,KAAKs9C,UAAY,GAAKhT,EAAO,GAC7BtqC,KAAKs9C,UAAY,IAAOhT,EAAO,IAGnC,OAGJrc,EAAIy9C,UAAY1rE,KAAK2jB,IAAIinD,UACzB38C,EAAI6/C,KAAO,GAAGxjC,OAAUtqC,KAAK2jB,IAAIgnD,aACjC18C,EAAI8/C,UAAY,SAChB9/C,EAAI+/C,aAAe,SAEnB,IAAI1jE,EAAQ2H,EAAKqB,KAEbhJ,EAAM7H,OAAS,KACf6H,EAAQ,GAAGA,EAAM0rB,OAAO,EAAG,UAG/B/H,EAAIggD,SAAS3jE,EAAOoZ,EAAGF,EAAI3L,KAAKC,MAAa,IAAPwyB,GAC1C,CAEAqiC,UAAU5yB,EAAM9rB,GACZ,GAAIjuB,KAAKs9C,UAAY,EACjB,OAGJrvB,EAAI6/C,KAAO,OAAO9tE,KAAK2jB,IAAIgnD,aAC3B18C,EAAI8/C,UAAY,SAChB9/C,EAAI+/C,aAAe,SACnB//C,EAAIy9C,UAAY1rE,KAAK2jB,IAAImnD,eAEzB,MAAM,OAAC9vB,EAAM,OAAEroC,GAAUonC,EAEnBr2B,GAAKs3B,EAAOt3B,EAAI/Q,EAAO+Q,GAAK,EAC5BF,GAAKw3B,EAAOx3B,EAAI7Q,EAAO6Q,GAAK,EAElCyK,EAAI6O,OACJ7O,EAAIigD,UAAUxqD,EAAGF,GAEjB,MAAM/L,EAASujC,EAAOx3B,EAAI7Q,EAAO6Q,EAC3B2qD,EAASnzB,EAAOt3B,EAAI/Q,EAAO+Q,EAEjC,IAAI0qD,EAAQv2D,KAAKw2D,MAAM52D,EAAQ02D,GAC3BG,EAAQ,GAERF,GAASv2D,KAAKi0D,GAAK,GAAKsC,EAAQv2D,KAAKi0D,GAAK,KAC1CsC,GAASv2D,KAAKi0D,GACdwC,GAAS,GAGbrgD,EAAIsgD,OAAOH,GACXngD,EAAIggD,SAASl0B,EAAKzmC,KAAM,EAAGg7D,GAC3BrgD,EAAIugD,SACR,CAEAnvE,4BAA4BwtE,GACxB,MAAMvmE,QAAa/C,EAAA,OAAY,YAAYspE,KAAiB7sE,KAAK+qE,WAEjE/qE,KAAKyuE,mBAAmBnoE,GAExB,MAAMmkB,EAAQzqB,KAAK0uE,gBAAgBpoE,EAAKmkB,OASxC,OAPAzqB,KAAKm3D,MAAQ7wD,EAAKuS,MAAMlN,KAAI,EAAEpM,EAAQ+K,EAAO7G,EAAMsW,MAAW,CAC1DuM,GAAI/mB,EACJ+T,KAAMhJ,EACN7G,KAAMA,EACNsW,MAAOA,MAGJ,CACHo9C,MAAOn3D,KAAKm3D,MACZ1sC,MAAOA,EAAM9e,KAAIouC,IAAQ,CACrBzzB,GAAI,GAAGyzB,EAAK40B,gBAAgB50B,EAAK3rC,eACjC4sC,OAAQjB,EAAK40B,aACbh8D,OAAQonC,EAAK3rC,aACbkF,KAAMymC,EAAK60B,MAAMl9D,KAAK,UAGlC,CAEAg9D,gBAAgBjkD,GACZ,MAAMokD,EAA6B,CAAC,EAEpC,IAAK,MAAM90B,KAAQtvB,EAAO,CACtB,MAAM+G,EAAM,GAAGuoB,EAAK40B,gBAAgB50B,EAAK3rC,eAErCojB,KAAOq9C,EACFA,EAA2Br9C,GAAKo9C,MAAMzlE,SAAS4wC,EAAKzmC,OACrDu7D,EAA2Br9C,GAAKo9C,MAAMtiE,KAAKytC,EAAKzmC,MAGpDu7D,EAA2Br9C,GAAO,CAC9BlL,GAAIkL,EACJm9C,aAAc50B,EAAK40B,aACnBvgE,aAAc2rC,EAAK3rC,aACnBwgE,MAAO,CAAC70B,EAAKzmC,MAGzB,CAEA,OAAOvD,OAAOqL,OAAOyzD,EACzB,CAEAJ,mBAAmBnoE,GAGf,GAFAtG,KAAK6rE,gBAAkB,CAAC,EAEH,SAAjB7rE,KAAK+qE,QAAoB,CACzB,MAAM,2BAAC+D,GAA8BxoE,EAErC,IAAK,MAAM/G,KAAUuvE,EAA4B,CAC7C9uE,KAAK6rE,gBAAgBtsE,GAAU,EAE/B,MAAM0mB,EAAQ6oD,EAA2BvvE,GAErC0mB,EAAQ,IACRjmB,KAAK6rE,gBAAgBtsE,IAAW,EAAIsY,KAAKC,MAAMD,KAAKhC,IAAIoQ,GAASpO,KAAKhC,IAAI,MAElF,CACJ,MACK,GAAqB,SAAjB7V,KAAK+qE,QAAoB,CAC9B,MAAMgE,EAAoB,CAAC,EAE3B,IAAK,MAAMh1B,KAAQzzC,EAAKmkB,MACpBskD,EAAkBh1B,EAAK3rC,cAAgB,GAAK2gE,EAAkBh1B,EAAK3rC,eAAiB,GAGxF,IAAK,MAAO7O,KAAW+G,EAAKuS,MACxB7Y,KAAK6rE,gBAAgBtsE,GAAU,EAE3BA,KAAUwvE,IACV/uE,KAAK6rE,gBAAgBtsE,IAAWsY,KAAK2xC,IAAI3xC,KAAKq1D,IAAI6B,EAAkBxvE,GAAS,IAAM,IAG/F,CACJ,CAEAiuE,WAAWt7D,GACPlS,KAAK0qE,MAAMsE,UAAU98D,GAEG,WAApBlS,KAAKqqE,YAA+C,WAApBrqE,KAAKsD,MAAMG,KAC3CkF,YAAW,KACP3I,KAAKyqE,gBAEL,MAAMwE,EAAkBjvE,KAAKkvE,kCAAkCh9D,GAE/DlS,KAAK0qE,MAAMyE,UAAU,IAAK,IAAIl9D,GAAQg9D,EAAgB90D,IAAIlI,EAAKqU,MAE3D2oD,EAAgB3kC,KAAO,IACvBtqC,KAAK0qE,MAAMW,gBAAgB,GAC/B,GACD,KAGCn5D,EAAKilD,MAAM10D,OAAS,GACpBkG,YAAW,KACP3I,KAAKyqE,gBAEL,MAAM2E,EAAmBpvE,KAAKqvE,oBAAoBn9D,GAE9Ck9D,EAAiB9kC,KAAO,GACxBtqC,KAAK0qE,MAAMyE,UAAU,IAAK,IAAIl9D,GAAQm9D,EAAiBj1D,IAAIlI,EAAKqU,MAGhE8oD,EAAiB9kC,KAAO,IACxBtqC,KAAK0qE,MAAMW,gBAAgB,GAC/B,GACD,IAGf,CAEAgE,oBAAoBn9D,GAChB,MAAMC,EAAU,IAAI2H,IAEpB,IAAK,MAAMigC,KAAQ7nC,EAAKuY,MACpBtY,EAAQiI,IAAI2/B,EAAKiB,OAAO10B,IACxBnU,EAAQiI,IAAI2/B,EAAKpnC,OAAO2T,IAG5B,OAAOnU,CACX,CAEA+8D,kCAAkCh9D,GAC9B,SAASw8D,EAAgBjkD,EAAOhnB,GAC5B,MAAMkI,EAAM,CAAC,EAEb,IAAK,MAAMouC,KAAQtvB,EAAO,CACtB,MAAM+G,EAAMuoB,EAAKt2C,GAAM6iB,GACvB3a,EAAI6lB,GAAO7lB,EAAI6lB,IAAQ,GACvB7lB,EAAI6lB,GAAKllB,KAAKytC,EAClB,CAEA,OAAOpuC,CACX,CAEA,MAAM2jE,EAAgBZ,EAAgBx8D,EAAKuY,MAAO,UAC5C8kD,EAAgBb,EAAgBx8D,EAAKuY,MAAO,UAE5CwkD,EAAkB,IAAIn1D,IAmB5B,OAjBA,SAAS01D,EAAcjwE,GACnB,IAAI0vE,EAAgB90D,IAAI5a,GAAxB,CAIA0vE,EAAgB70D,IAAI7a,GAEpB,IAAK,MAAMw6C,KAAQu1B,EAAc/vE,IAAW,GACxCiwE,EAAcz1B,EAAKpnC,OAAO2T,IAG9B,IAAK,MAAMyzB,KAAQw1B,EAAchwE,IAAW,GACxCiwE,EAAcz1B,EAAKiB,OAAO10B,GAT9B,CAWJ,CAEAkpD,CAAcxvE,KAAKT,QACZ0vE,CACX,CAEAz6B,UACIx0C,KAAK0lB,WAAWC,KAAK,GACzB,CAEA4pC,uBAAsB,YAAC9lD,IACfA,EAAY4J,iBAAiBrT,KAAK8V,aAAavJ,MAC/CwG,GACkB,UAAdA,EAAKtP,MACF,CAAC,UAAW,iBAAiB0F,SAAS4J,EAAKO,OAC3C,cAA6BP,EAAM/S,KAAKsD,SAE/CtD,KAAK80C,SAEb,ECnbW,MAAM26B,WAAsB,IACvC9sE,cACIC,QAEA5C,KAAKwzC,cACT,CAEAn0C,mBAAmBiU,EAAMF,GACrB,MAAM3L,EAAO,CAAE,CAAC6L,GAAOF,SAEjBpT,KAAK0vE,sBAAsBjoE,EACrC,CAEApI,4BAA4BoI,SAClBlE,EAAA,MAAW,UAAWkE,GAE5BzH,KAAK2vE,wBACT,CAEAA,yBACI,yBAA4B,CACxBrpD,GAAI,uBACJhc,MAAO,OACPoC,QAAS,WACT6Z,KAAM,SACNI,WAAY,KAEpB,CAEAtnB,2BAA2BiU,EAAMs8D,GAC7B,MAAMC,EAAYD,EAAUj7D,KAAK,WAEjC,aAAa3U,KAAK8vE,aAAax8D,EAAMu8D,EAAY,OAAS,QAC9D,CAEAE,iBAAiBH,EAAWI,GACxBJ,EAAUj7D,KAAK,UAA2B,SAAhBq7D,EAC9B,CAEAC,cAAczvE,GAAU,CAExBnB,sBAAsBiE,GAClB,MAAM9C,QAAgB+C,EAAA,MAAW,WAEjCvD,KAAKiwE,cAAczvE,EACvB,CAEAnB,6BAA4B,YAACoK,IACrBA,EAAYgmC,iBAAiBhtC,OAAS,GACtCzC,KAAK80C,SAEb,ECpDJ,MAAMo7B,GAAgB,CAClB,CAAE98D,MAAO,QAAS+M,MAAO,iBACzB,CAAE/M,MAAO,QAAS+M,MAAO,SACzB,CAAE/M,MAAO,aAAc+M,MAAO,cAC9B,CAAE/M,MAAO,YAAa+M,MAAO,aAC7B,CAAE/M,MAAO,QAAS+M,MAAO,SACzB,CAAE/M,MAAO,UAAW+M,MAAO,WAC3B,CAAE/M,MAAO,YAAa+M,MAAO,aAC7B,CAAE/M,MAAO,SAAU+M,MAAO,UAC1B,CAAE/M,MAAO,eAAgB+M,MAAO,gBAChC,CAAE/M,MAAO,kBAAmB+M,MAAO,mBACnC,CAAE/M,MAAO,UAAW+M,MAAO,WAC3B,CAAE/M,MAAO,WAAY+M,MAAO,YAC5B,CAAE/M,MAAO,cAAe+M,MAAO,eAC/B,CAAE/M,MAAO,kBAAmB+M,MAAO,mBACnC,CAAE/M,MAAO,SAAU+M,MAAO,UAC1B,CAAE/M,MAAO,sBAAuB+M,MAAO,uBACvC,CAAE/M,MAAO,cAAe+M,MAAO,eAC/B,CAAE/M,MAAO,iBAAkB+M,MAAO,kBAClC,CAAE/M,MAAO,SAAU+M,MAAO,UAC1B,CAAE/M,MAAO,eAAgB+M,MAAO,gBAChC,CAAE/M,MAAO,WAAY+M,MAAO,YAC5B,CAAE/M,MAAO,gBAAiB+M,MAAO,iBACjC,CAAE/M,MAAO,kBAAmB+M,MAAO,oBCiCvC,IAAIgwD,GCjDAC,GAAQ,ECPZ,MAiCMC,GAAiB,CACnB,KAAQ,0CACR,MAAS,uCACT,WAAc,sCACd,OAAU,6CCrBC,MAAMC,WAAyB,IAC1Cx8B,WACI9zC,KAAKwiB,QAAU9d,EAlBX,4eAmBJ1E,KAAKuwE,oBAAsBvwE,KAAKwiB,QAAQjW,KAAK,yBAC7CvM,KAAKwwE,mBAAqBxwE,KAAKwiB,QAAQjW,KAAK,+BAE5CvM,KAAKwwE,mBAAmBj8D,GAAG,SAAS,IAAMvU,KAAKs8B,QACnD,CAEAm0C,iBACIzwE,KAAKuwE,oBAAoB1M,UAAU7jE,KAAKuwE,oBAAoB,GAAGzM,aACnE,CAEAzkE,sBACUW,KAAKs8B,MACf,CAEAj9B,aACI,MAAMqxE,QAAmBntE,EAAA,MAAW,eAEpCvD,KAAKuwE,oBAAoBhrD,KAAKmrD,GAE9B1wE,KAAKywE,gBACT,ECPJ,MAmBME,GAAkB,CACpBC,mBAAoB,CClCT,cAA2BnB,GACtC37B,WACI9zC,KAAKwiB,QAAU9d,EAnBX,saAoBJ1E,KAAK6wE,aAAe7wE,KAAKwiB,QAAQjW,KAAK,iBACtCvM,KAAK8wE,oBAAsB9wE,KAAKwiB,QAAQjW,KAAK,yBAE7CvM,KAAK6wE,aAAat8D,GAAG,UAAUlV,UAC3B,MAAM0xE,EAAW/wE,KAAK6wE,aAAazrD,YAE7B7hB,EAAA,MAAW,iBAAiBwtE,KAElC9vE,EAAA,0BAAwB,eAAe,IAG3CjB,KAAK8wE,oBAAoBv8D,GAAG,UAAU,IAAMvU,KAAKgxE,qBAAqB,qBAAsBhxE,KAAK8wE,sBACrG,CAEAzxE,oBAAoBmB,GAChB,MAAMywE,EAAS,CACX,CAAE7rD,IAAK,QAAS9a,MAAO,MACvB,CAAE8a,IAAK,OAAQ9a,MAAO,OACxB8uC,aAAa71C,EAAA,MAAW,wBAE1BvD,KAAK6wE,aAAaluD,QAElB,IAAK,MAAMiL,KAASqjD,EAChBjxE,KAAK6wE,aAAalsE,OAAOD,EAAE,YACtBqO,KAAK,QAAS6a,EAAMxI,KACpBrS,KAAK,eAAgB6a,EAAMruB,QAC3BgmB,KAAKqI,EAAMtjB,QAGpBtK,KAAK6wE,aAAazrD,IAAI5kB,EAAQotB,OAE9B5tB,KAAK+vE,iBAAiB/vE,KAAK8wE,oBAAqBtwE,EAAQ0wE,mBAC5D,GNmEW,cAA2BzB,GACtC37B,WACI9zC,KAAKwiB,QAAU9d,EAhGX,iuFAkGJ1E,KAAKmxE,cAAgBnxE,KAAKwiB,QAAQjW,KAAK,mBACvCvM,KAAKoxE,gBAAkBpxE,KAAKwiB,QAAQjW,KAAK,qBAEzCvM,KAAKqxE,cAAgBrxE,KAAKwiB,QAAQjW,KAAK,mBACvCvM,KAAKsxE,gBAAkBtxE,KAAKwiB,QAAQjW,KAAK,qBAEzCvM,KAAKuxE,gBAAkBvxE,KAAKwiB,QAAQjW,KAAK,qBACzCvM,KAAKwxE,kBAAoBxxE,KAAKwiB,QAAQjW,KAAK,uBAE3CvM,KAAKyxE,mBAAqBzxE,KAAKwiB,QAAQjW,KAAK,wBAC5CvM,KAAK0xE,qBAAuB1xE,KAAKwiB,QAAQjW,KAAK,0BAE9CvM,KAAKwiB,QAAQjW,KAAK,2BAA2BgI,GAAG,SAAS,IAAMtT,EAAA,0BAAwB,oCAC3F,CAEA5B,oBAAoBmB,GAChB,GAAmC,SAA/BA,EAAQ0wE,mBAER,YADAlxE,KAAKg0C,WAAU,GAInBh0C,KAAKg0C,WAAU,GAEfh0C,KAAKmxE,cAAc/rD,IAAI5kB,EAAQmxE,cAC/B3xE,KAAK4xE,sBAAsB5xE,KAAKoxE,gBAAiB5wE,EAAQqxE,gBAEzD7xE,KAAKqxE,cAAcjsD,IAAI5kB,EAAQsxE,cAC/B9xE,KAAK4xE,sBAAsB5xE,KAAKsxE,gBAAiB9wE,EAAQuxE,gBAEzD/xE,KAAKuxE,gBAAgBnsD,IAAI5kB,EAAQwxE,gBACjChyE,KAAK4xE,sBAAsB5xE,KAAKwxE,kBAAmBhxE,EAAQyxE,kBAE3DjyE,KAAKyxE,mBAAmBrsD,IAAI5kB,EAAQ0xE,mBACpClyE,KAAK4xE,sBAAsB5xE,KAAK0xE,qBAAsBlxE,EAAQ2xE,qBAE9D,MAAMC,EAAgB,CAClB,iBAAkB,eAClB,iBAAkB,eAClB,mBAAoB,iBACpB,sBAAuB,qBAG3B,IAAK,MAAMC,KAAcD,EACrBpyE,KAAK,IAAIqyE,KAAc99D,GAAG,UAAU,IAChCvU,KAAK8vE,aAAauC,EAAYryE,KAAK,IAAIqyE,KAAcjtD,QAEjE,CAEAwsD,sBAAsBU,EAASC,GAC3BD,EAAQ3vD,QAER,IAAK,MAAM,MAACvP,EAAK,MAAE+M,KAAU+vD,GACzBoC,EAAQ3tE,OAAOD,EAAE,YACZqO,KAAK,QAASK,GACduB,KAAK,WAAYvB,IAAUm/D,GAC3BhtD,KAAKpF,GAElB,GO5KW,cAAgCsvD,GAC3C17B,YACI,OAAOnxC,MAAMmxC,aAAe9yC,EAAA,oBAChC,CAEA6yC,WACI9zC,KAAKwiB,QAAU9d,EAdX,0OAeJ1E,KAAKwyE,kBAAoBxyE,KAAKwiB,QAAQjW,KAAK,uBAC3CvM,KAAKwyE,kBAAkBj+D,GAAG,UAAU,KAAQ,yBAA0B,uBAAwB,CAACmD,WAAY1X,KAAKwyE,kBAAkBptD,OAAO,GAC7I,CAEA/lB,oBAAoBmB,GAChBR,KAAKwyE,kBAAkBptD,IAAI5kB,EAAQkX,WACvC,GCbW,cAAoC+3D,GAC/C37B,WACI9zC,KAAKwiB,QAAU9d,EAZX,yOAaJ1E,KAAKyyE,sBAAwBzyE,KAAKwiB,QAAQjW,KAAK,4BAC/CvM,KAAKyyE,sBAAsBl+D,GAAG,UAAU,KACpC,MAAMm+D,EAA6D,SAArC1yE,KAAKyyE,sBAAsBrtD,MAAmB,OAAS,QAErFplB,KAAK8vE,aAAa,wBAAyB4C,EAAsB,GAEzE,CAEArzE,oBAAoBmB,GAChBR,KAAKyyE,sBAAsBrtD,IAAsC,SAAlC5kB,EAAQkyE,sBAAmC,OAAS,OACvF,GCHW,cAAqCjD,GAChD37B,WACI9zC,KAAKwiB,QAAU9d,EArBX,6eAuBJ1E,KAAK2yE,iBAAmB3yE,KAAKwiB,QAAQjW,KAAK,sBAE1CvM,KAAK2yE,iBAAiBp+D,GAAG,UAAUlV,SAC/BW,KAAK8vE,aAAa,kBAAmB9vE,KAAK2yE,iBAAiBvtD,SAE/DplB,KAAKwiB,QAAQjW,KAAK,2BAA2BgI,GAAG,SAAS,IAAMtT,EAAA,0BAAwB,oCAC3F,CAEA5B,oBAAoBmB,GAChBR,KAAK2yE,iBAAiBvtD,IAAI5kB,EAAQoyE,gBACtC,GCpBW,cAA4BnD,GACvC37B,WACI9zC,KAAKwiB,QAAU9d,EAhBX,2UAkBJ1E,KAAK6yE,gCAAkC7yE,KAAKwiB,QAAQjW,KAAK,uCACzDvM,KAAK6yE,gCAAgCt+D,GAAG,UAAU,IAC9CvU,KAAKgxE,qBAAqB,iCAAkChxE,KAAK6yE,mCAErE7yE,KAAK8yE,yBAA2B9yE,KAAKwiB,QAAQjW,KAAK,gCAClDvM,KAAK8yE,yBAAyBv+D,GAAG,UAAU,IACvCvU,KAAKgxE,qBAAqB,0BAA2BhxE,KAAK8yE,2BAClE,CAEAzzE,oBAAoBmB,GAChBR,KAAK+vE,iBAAiB/vE,KAAK6yE,gCAAiCryE,EAAQuyE,gCACpE/yE,KAAK+vE,iBAAiB/vE,KAAK8yE,yBAA0BtyE,EAAQwyE,wBACjE,IL+BAC,kBAAmB,CJFR,cAAuCxD,GAClD37B,WACI9zC,KAAKwiB,QAAU9d,EA1DX,y+CA4DJ1E,KAAKwiB,QAAQjW,KAAK,0CAA0CgI,GAAG,SAAS,IAAMtT,EAAA,8BAE9E,MAAMiyE,EAASlzE,KAAKwiB,QAAQjW,KAAK,kCAEjChJ,EAAA,MAAW,oBAAoByH,MAAKkoB,IAChCi9C,GAAcj9C,EAEd,IAAK,MAAM7xB,KAAU6xB,EAAS,CAC1B,MAAMigD,EAAMzuE,EAAE,QAEVrD,EAAO+xE,UACPD,EAAIxuE,OACAD,EAAE,oBACGqO,KAAK,QAAQ,0EACbwS,KAAKlkB,EAAO+xE,YAIrBD,EAAIxuE,OAAOD,EAAE,QAAQ6gB,KAAKlkB,EAAO8xB,aAC5BxuB,OAAOD,EAAE,QAAQC,OACdD,EAAE,4CACG0gB,IAAI/jB,EAAO+xB,mBAAmB1hB,KAAK,OACnCqB,KAAK,4BAA6B1R,EAAO8xB,YACzCpgB,KAAK,kCAAmC1R,EAAOgyE,iBAAiB3hE,KAAK,SAG7E/M,OAAOD,EAAE,QAAQ6gB,KAAKlkB,EAAOgyE,iBAAiB3hE,KAAK,QACnD/M,OAAOD,EAAE,QAAQ6gB,KAAKlkB,EAAOiyE,cAGtCJ,EAAOvuE,OAAOwuE,EAClB,KAGJD,EAAO3+D,GAAG,SAAU,sBAAsB7L,IACtC,MAAM6qE,EAASvzE,KAAKwiB,QAAQjW,KAAK7D,EAAEiK,QAC7BwgB,EAAaogD,EAAOxgE,KAAK,6BACzB8gB,EAAY0/C,EAAOnuD,MACNjP,QAAQ,KAAM,UACdrN,MAAM,KACN6C,KAAI0nB,GAAYA,EAASld,QAAQ,SAAU,QAC3CvK,QAAOynB,KAAcA,IAElCg/C,EAAa,oBAAoBl/C,EAAW6C,OAAO,EAAG,GAAGw9C,gBAAgBrgD,EAAW6C,OAAO,KAEjGh2B,KAAK8vE,aAAauC,EAAYvmE,KAAKC,UAAU8nB,GAAW,IAG5D7zB,KAAKwiB,QAAQjW,KAAK,kDAAkDgI,GAAG,SAASlV,gBACjEuhC,EAAA,UAAsB,iBAIjCsyC,EAAO3mE,KAAK,sBAAsBonB,MAAK,CAAC8/C,EAAQr+D,KAC5C,MAAMi+D,EAAmBrzE,KAAKwiB,QAAQjW,KAAK6I,GAAIrC,KAAK,mCAEhD/S,KAAKwiB,QAAQjW,KAAK6I,GAAIgQ,QAAUiuD,GAChCrzE,KAAKwiB,QAAQjW,KAAK6I,GACbgQ,IAAIiuD,GACJvuE,QAAQ,SACjB,GACF,IAGN,MAAM4uE,EAAU1zE,KAAKwiB,QAAQjW,KAAK,6BAElCmnE,EAAQn/D,GAAG,SAAS,KAChB,MAAM3I,EAAS8nE,EAAQtuD,MAAMpL,OAAOid,cAEpCi8C,EAAO3mE,KAAK,MAAMonB,MAAK,CAACnkB,EAAG4F,KACvB,IAAKxJ,EAED,YADA5L,KAAKwiB,QAAQjW,KAAK6I,GAAI+xB,OAI1B,MAAMhU,EAAanzB,KAAKwiB,QAAQjW,KAAK6I,GAAI7I,KAAK,SAASwG,KAAK,6BAE5D,IAAKogB,EAED,YADAnzB,KAAKwiB,QAAQjW,KAAK6I,GAAIsN,OAI1B,MAAMrhB,EAAS8uE,GAAY5jE,MAAKonE,GAAOA,EAAIxgD,aAAeA,IAErD9xB,EAKLrB,KAAKwiB,QAAQjW,KAAK6I,GAAI+X,UAClB9rB,EAAO8xB,WAAW8D,cAAc9tB,SAASyC,IACtCvK,EAAOgyE,iBAAiB90D,MAAK8U,GAAYA,EAAS4D,cAAc9tB,SAASyC,MACzEvK,EAAO+xB,mBAAmB7U,MAAK8U,GAAYA,EAAS4D,cAAc9tB,SAASyC,MAC1EvK,EAAOiyE,aAAejyE,EAAOiyE,YAAYr8C,cAAc9tB,SAASyC,KARpE5L,KAAKwiB,QAAQjW,KAAK6I,GAAIsN,MASxB,GACJ,GAEV,IIlGAkxD,kBAAmB,CMnDR,cAAkCnE,GAC7C37B,WACI9zC,KAAKwiB,QAAU9d,EAbX,sRAcJ1E,KAAKq1C,MAAQ3wC,EAAE,QACf1E,KAAK6zE,cAAgB7zE,KAAKwiB,QAAQjW,KAAK,kBACvCvM,KAAK6zE,cAAct/D,GAAG,UAAU,KAC5B,MAAMu/D,EAAkB9zE,KAAK6zE,cAAczuD,MAE3CplB,KAAK+zE,gBAAgB,iBAAkBD,GAEvC9zE,KAAK8vE,aAAa,eAAgBgE,EAAgB,GAE1D,CAEAz0E,oBAAoBmB,GAChBR,KAAK6zE,cAAczuD,IAAI5kB,EAAQwzE,aACnC,CAEAD,gBAAgBx6D,EAAQnG,GACpB,IAAK,MAAMi7C,KAAS79B,MAAMC,KAAKzwB,KAAKq1C,MAAM,GAAGsT,WACrC0F,EAAMnmD,WAAWqR,IACjBvZ,KAAKq1C,MAAM+W,YAAYiC,GAI/BruD,KAAKq1C,MAAMxxB,SAAStK,EAASnG,EACjC,GCxBW,cAAqCq8D,GAChD37B,WACI9zC,KAAKwiB,QAAU9d,EAfX,+VAgBJ1E,KAAKi0E,gBAAkBj0E,KAAKwiB,QAAQjW,KAAK,qBACzCvM,KAAKi0E,gBAAgB1/D,GAAG,UAAU,IAC9BvU,KAAK8vE,aAAa,iBAAkB9vE,KAAKi0E,gBAAgB7uD,QACjE,CAEA/lB,oBAAoBmB,GAChBR,KAAKi0E,gBAAgB7uD,IAAI5kB,EAAQ0zE,eACrC,GCHW,cAAoCzE,GAC/C37B,WACI9zC,KAAKwiB,QAAU9d,EAtBX,+wBAuBJ1E,KAAKm0E,KAAOn0E,KAAKwiB,QAAQjW,KAAK,+BAC9BvM,KAAKm0E,KAAK5/D,GAAG,UAAU,KACnB,MAAM6/D,EAAUp0E,KAAKwiB,QAAQjW,KAAK,wDAAwDZ,KAAI,WAC1F,OAAO3L,KAAKoT,KAChB,IAAGqW,MACHzpB,KAAK8vE,aAAa,iBAAkBhkE,KAAKC,UAAUqoE,GAAS,GAEpE,CAEA/0E,oBAAoBmB,GAChB,MAAM4zE,EAAUtoE,KAAK0P,MAAMhb,EAAQ6zE,gBACnCr0E,KAAKwiB,QAAQjW,KAAK,gDAAgDonB,MAAK,YACxB,IAAvCjvB,EAAE4vE,QAAQ5vE,EAAE1E,MAAMolB,MAAOgvD,GACzB1vE,EAAE1E,MAAM2U,KAAK,WAAW,GAExBjQ,EAAE1E,MAAM2U,KAAK,WAAW,EAEhC,GACJ,GC7BW,cAA0C86D,GACrD37B,WACI9zC,KAAKwiB,QAAU9d,EAdX,4SAeJ1E,KAAKu0E,sBAAwBv0E,KAAKwiB,QAAQjW,KAAK,4BAC/CvM,KAAKu0E,sBAAsBhgE,GAAG,UAAU,IACpCvU,KAAK8vE,aAAa,uBAAwB9vE,KAAKu0E,sBAAsBnvD,QAC7E,CAEA/lB,oBAAoBmB,GAChBR,KAAKu0E,sBAAsBnvD,IAAI5kB,EAAQg0E,qBAC3C,IT8CAC,kBAAmB,CU3DR,cAAoChF,GAC/C37B,WACI9zC,KAAKwiB,QAAU9d,EAXX,0LAYJ1E,KAAK00E,kBAAoB10E,KAAKwiB,QAAQjW,KAAK,uBAC3CvM,KAAK00E,kBAAkBngE,GAAG,UAAU,IAChCvU,KAAKgxE,qBAAqB,mBAAoBhxE,KAAK00E,oBAC3D,CAEAr1E,oBAAoBmB,GAChBR,KAAK+vE,iBAAiB/vE,KAAK00E,kBAAmBl0E,EAAQm0E,iBAC1D,GCVW,cAA+BlF,GAC1C37B,WACI9zC,KAAKwiB,QAAU9d,EAXX,sLAYJ1E,KAAK40E,qBAAuB50E,KAAKwiB,QAAQjW,KAAK,sBAC9CvM,KAAK40E,qBAAqBrgE,GAAG,UAAU,IACnCvU,KAAKgxE,qBAAqB,sBAAuBhxE,KAAK40E,uBAC9D,CAEAv1E,oBAAoBmB,GAChBR,KAAK+vE,iBAAiB/vE,KAAK40E,qBAAsBp0E,EAAQq0E,oBAC7D,GCPW,cAA0CpF,GACrD37B,WACI9zC,KAAKwiB,QAAU9d,EAdX,4SAeJ1E,KAAK80E,sBAAwB90E,KAAKwiB,QAAQjW,KAAK,4BAC/CvM,KAAK80E,sBAAsBvgE,GAAG,UAAU,IACpCvU,KAAK8vE,aAAa,uBAAwB9vE,KAAK80E,sBAAsB1vD,QAC7E,CAEA/lB,oBAAoBmB,GAChBR,KAAK80E,sBAAsB1vD,IAAI5kB,EAAQu0E,qBAC3C,GfZW,cAAmCtF,GAC9C37B,WACI9zC,KAAKwiB,QAAU9d,EAXX,wJAYJ1E,KAAKg1E,WAAah1E,KAAKwiB,QAAQjW,KAAK,sBACxC,CAEAlN,oBAAoBmB,GAChBR,KAAKg1E,WAAWryD,QAEhB,IAAK,MAAMsyD,WAAkB,kBAAiC,CAC1D,MAAM3uD,EAAK,kBAAqB8pD,KAEhCpwE,KAAKg1E,WAAWrwE,OAAOD,EAAE,QACpBC,OAAOD,EAAE,2BACLqO,KAAK,KAAMuT,GACXvT,KAAK,iBAAkBkiE,EAAS90E,MAChCwU,KAAK,UAAWsgE,EAASzwD,UAC7BjQ,GAAG,UAAU,IAAMvU,KAAK88B,SACxBn4B,OAAO,YACPA,OAAOD,EAAE,WACLqO,KAAK,MAAOuT,GACZf,KAAK0vD,EAAS3qE,QAE3B,CACJ,CAEAjL,aACI,MAAMwoE,EAAmB,GAEzB7nE,KAAKg1E,WAAWzoE,KAAK,iBAAiBonB,MAClC,CAACnkB,EAAG4F,IAAOyyD,EAAiBv7D,KAAKtM,KAAKwiB,QAAQjW,KAAK6I,GAAIrC,KAAK,2BAE1D/S,KAAK8vE,aAAa,qBAAsBhkE,KAAKC,UAAU87D,IAE7D,kBACJ,IG6BAqN,eAAgB,CarCL,cAA2BzF,GACtC37B,WACI9zC,KAAKwiB,QAAU9d,EAvCX,skCAyCJ1E,KAAKm1E,qBAAuBn1E,KAAKwiB,QAAQjW,KAAK,2BAC9CvM,KAAKo1E,kBAAoBp1E,KAAKwiB,QAAQjW,KAAK,uBAE3CvM,KAAKm1E,qBAAqB5gE,GAAG,UAAU,IACnCvU,KAAK8vE,aAAa,sBAAuB9vE,KAAKm1E,qBAAqB/vD,SAEvEplB,KAAKo1E,kBAAkB7gE,GAAG,UAAU,IAChCvU,KAAK8vE,aAAa,mBAAoB9vE,KAAKo1E,kBAAkBhwD,MAAMpL,QAAU,QAEjFha,KAAKq1E,6BAA+Br1E,KAAKwiB,QAAQjW,KAAK,kCAEtDvM,KAAKq1E,6BAA6B9gE,GAAG,UAAU,IAC3CvU,KAAKgxE,qBAAqB,8BAA+BhxE,KAAKq1E,gCAElEr1E,KAAKs1E,wBAA0Bt1E,KAAKwiB,QAAQjW,KAAK,6BACjDvM,KAAKu1E,yBAA2Bv1E,KAAKwiB,QAAQjW,KAAK,qCAElDvM,KAAKs1E,wBAAwB/gE,GAAG,UAAU,KACtCvU,KAAKgxE,qBAAqB,iBAAkBhxE,KAAKs1E,yBACjDt1E,KAAKw1E,qBAAqB,GAElC,CAEAvF,cAAczvE,GACVR,KAAKm1E,qBAAqB/vD,IAAI5kB,EAAQi1E,qBACtCz1E,KAAKo1E,kBAAkBhwD,IAAI5kB,EAAQk1E,kBAEnC11E,KAAK+vE,iBAAiB/vE,KAAKq1E,6BAA8B70E,EAAQm1E,6BACjE31E,KAAK+vE,iBAAiB/vE,KAAKs1E,wBAAyB90E,EAAQo1E,gBAE5D51E,KAAKw1E,qBACT,CAEAA,sBACQx1E,KAAKs1E,wBAAwB3gE,KAAK,WAClC3U,KAAKu1E,yBAAyBnpB,YAAY,kBAE1CpsD,KAAKu1E,yBAAyB1xD,SAAS,iBAE/C,IbLAgyD,mBAAoB,CcnDT,cAAgCpG,GAC3C37B,WAcI,GAbA9zC,KAAKwiB,QAAU9d,EAzBX,knBA2BJ1E,KAAK81E,mBAAqB91E,KAAKwiB,QAAQjW,KAAK,wBAC5CvM,KAAK+1E,wBAA0B/1E,KAAKwiB,QAAQjW,KAAK,8BAEjDvM,KAAK81E,mBAAmBvhE,GAAG,UAAU,IACjCvU,KAAKgxE,qBAAqB,oBAAqBhxE,KAAK81E,sBAExD91E,KAAK+1E,wBAAwBxhE,GAAG,UAAU,IACtCvU,KAAK8vE,aAAa,yBAA0B9vE,KAAK+1E,wBAAwB3wD,SAE7EplB,KAAKg2E,wBAA0Bh2E,KAAKwiB,QAAQjW,KAAK,6BAE7CtL,EAAA,qBAAoB,CACpB,MAAM,YAAE+D,GAAgB/D,EAAA,uBAAqB,oBAAoBkC,mBAEjEnD,KAAKg2E,wBAAwBzwD,KAAKvgB,EAAYknC,QAAQ+pC,+BAA+BvkE,KAAK,MAC9F,CACJ,CAEAu+D,cAAczvE,GACVR,KAAK+vE,iBAAiB/vE,KAAK81E,mBAAoBt1E,EAAQ01E,mBACvDl2E,KAAK+1E,wBAAwB3wD,IAAI5kB,EAAQ21E,uBAC7C,Id2BAC,iBAAkB,CejCP,cAA8B3G,GACzC37B,WACI9zC,KAAKwiB,QAAU9d,EA1CX,m4CA4CJ1E,KAAKq2E,iBAAmBr2E,KAAKwiB,QAAQjW,KAAK,qBAC1CvM,KAAKs2E,oBAAsBt2E,KAAKwiB,QAAQjW,KAAK,yBAC7CvM,KAAKu2E,aAAev2E,KAAKwiB,QAAQjW,KAAK,iBACtCvM,KAAKw2E,cAAgBx2E,KAAKwiB,QAAQjW,KAAK,kBACvCvM,KAAKy2E,cAAgBz2E,KAAKwiB,QAAQjW,KAAK,kBACvCvM,KAAK02E,oBAAsB12E,KAAKwiB,QAAQjW,KAAK,yBAC7CvM,KAAK22E,qBAAuB32E,KAAKwiB,QAAQjW,KAAK,0BAE9CvM,KAAK22E,qBAAqBpiE,GAAG,SAASlV,UAClC,GAAI4vB,QAAQ,gCAAiC,OACnC1rB,EAAA,OAAY,sFAElB,MAAM/C,QAAgB+C,EAAA,MAAW,WACjCvD,KAAKiwE,cAAczvE,GAEnB,oBAAuB,mDAC3B,KAGJR,KAAKs2E,oBAAoB/hE,GAAG,UAAU,IAAMvU,KAAK88B,SAEjD98B,KAAK42E,yBAA2B52E,KAAKwiB,QAAQjW,KAAK,yCAClDvM,KAAK42E,yBAAyBriE,GAAG,UAAU,IACvCvU,KAAK8vE,aAAa,0BAA2B9vE,KAAK42E,yBAAyBxxD,QACnF,CAEA6qD,cAAczvE,GACV,MAAMq2E,EAA0C,SAA1Br2E,EAAQq2E,cAE9B72E,KAAKwiB,QAAQjW,KAAK,4BAA4B4gB,OAAO0pD,GACrD72E,KAAKq2E,iBAAiB9wD,KAAKsxD,EAAgB,OAAS,QACpD72E,KAAK02E,oBAAoBnxD,KAAKsxD,EAAgB,OAAS,QACvD72E,KAAK42E,yBAAyBxxD,IAAI5kB,EAAQs2E,wBAC9C,CAEAh6C,OACI,MAAMi6C,EAAc/2E,KAAKu2E,aAAanxD,MAChC4xD,EAAeh3E,KAAKw2E,cAAcpxD,MAClC6xD,EAAej3E,KAAKy2E,cAAcrxD,MAMxC,OAJAplB,KAAKu2E,aAAanxD,IAAI,IACtBplB,KAAKw2E,cAAcpxD,IAAI,IACvBplB,KAAKy2E,cAAcrxD,IAAI,IAEnB4xD,IAAiBC,GACjB,oBAAuB,oCAChB,IAGX1zE,EAAA,OAAY,kBAAmB,CAC3B,iBAAoBwzE,EACpB,aAAgBC,IACjBhsE,MAAK8nB,IACAA,EAAOvsB,SACP,oBAAuB,2EAGvB,6BAGA,oBAAuBusB,EAAOpmB,QAClC,KAGG,EACX,IfnCAwqE,cAAe,CgB/BJ,cAA2BzH,GACtC37B,WACI9zC,KAAKwiB,QAAU9d,EA7CX,qsCA+CJ1E,KAAKwiB,QAAQjW,KAAK,uBAAuBgI,GAAG,SAASlV,UACjD,MAAM83E,QAAkBv2C,EAAA,SAAqB,CACzCt2B,MAAO,cACPoC,QAAS,YACT0qE,aAAc,QAGlB,IAAKD,EAAUn9D,OAEX,YADA,oBAAuB,YAI3B,MAAM,UAACq9D,SAAmB9zE,EAAA,OAAY,eAAgB,CAAC4zE,oBAEjDv2C,EAAA,SAAqB,CACvBt2B,MAAO,cACPoC,QAAS,kDACT0qE,aAAcC,IAGlBr3E,KAAKs3E,eAAe,IAGxBt3E,KAAKs3E,eACT,CAEAj4E,sBACI,MAAMk4E,EAAev3E,KAAKwiB,QAAQjW,KAAK,kBACjCirE,EAAex3E,KAAKwiB,QAAQjW,KAAK,iBAEjCwwB,QAAex5B,EAAA,MAAW,gBAEhCg0E,EAAapqD,OAAyB,IAAlB4P,EAAOt6B,QAC3B+0E,EAAarqD,OAAO4P,EAAOt6B,OAAS,GAEpC,MAAMg1E,EAAmBD,EAAajrE,KAAK,SAC3CkrE,EAAiB90D,QAEjB,IAAK,MAAMsa,KAASF,EAChB06C,EAAiB9yE,OACbD,EAAE,QACGC,OAAOD,EAAE,QAAQ6gB,KAAK0X,EAAM3pB,OAC5B3O,OAAOD,EAAE,QAAQ6gB,KAAK0X,EAAMy6C,iBAC5B/yE,OAAOD,EAAE,QAAQC,OACdD,EAAE,qEACG6P,GAAG,SAAS,IAAMvU,KAAK23E,YAAY16C,EAAM26C,aAAc36C,EAAM3pB,QAClE5O,EAAE,yEACG6P,GAAG,SAAS,IAAMvU,KAAK63E,YAAY56C,EAAM26C,aAAc36C,EAAM3pB,UAItF,CAEAjU,kBAAkBu4E,EAAcE,GAC5B,MAAMX,QAAkBv2C,EAAA,SAAqB,CACzCt2B,MAAO,QACPoC,QAAS,YACT0qE,aAAcU,IAGbX,GAAWn9D,eAIVzW,EAAA,QAAa,gBAAgBq0E,IAAgB,CAACtkE,KAAM6jE,IAE1Dn3E,KAAKs3E,gBACT,CAEAj4E,kBAAkBu4E,EAActkE,SACjBstB,EAAA,UAAsB,kBAAkBttB,eAI7C/P,EAAA,SAAc,gBAAgBq0E,KAEpC53E,KAAKs3E,gBACT,IhBjDAS,eAAgB,CiBjCL,cAA4BtI,GACvC37B,WACI9zC,KAAKwiB,QAAU9d,EA7CX,k7BA+CJ1E,KAAKg4E,sBAAwBh4E,KAAKwiB,QAAQjW,KAAK,2BAE/CvM,KAAKg4E,sBAAsBzjE,GAAG,SAASlV,UACnC,MAAM,WAAC44E,SAAoB10E,EAAA,OAAY,4BAEvC,sBAAyB,UAAU00E,IAAc,KAEjDj4E,KAAK80C,SAAS,IAGlB90C,KAAKk4E,oBAAsBl4E,KAAKwiB,QAAQjW,KAAK,yBAC7CvM,KAAKm4E,qBAAuBn4E,KAAKwiB,QAAQjW,KAAK,0BAC9CvM,KAAKo4E,sBAAwBp4E,KAAKwiB,QAAQjW,KAAK,2BAE/CvM,KAAKk4E,oBAAoB3jE,GAAG,UAAU,IAClCvU,KAAKgxE,qBAAqB,qBAAsBhxE,KAAKk4E,uBAEzDl4E,KAAKm4E,qBAAqB5jE,GAAG,UAAU,IACnCvU,KAAKgxE,qBAAqB,sBAAuBhxE,KAAKm4E,wBAE1Dn4E,KAAKo4E,sBAAsB7jE,GAAG,UAAU,IACpCvU,KAAKgxE,qBAAqB,uBAAwBhxE,KAAKo4E,yBAE3Dp4E,KAAKq4E,oBAAsBr4E,KAAKwiB,QAAQjW,KAAK,wBACjD,CAEA0jE,cAAczvE,GACVR,KAAK+vE,iBAAiB/vE,KAAKk4E,oBAAqB13E,EAAQ83E,oBACxDt4E,KAAK+vE,iBAAiB/vE,KAAKm4E,qBAAsB33E,EAAQ+3E,qBACzDv4E,KAAK+vE,iBAAiB/vE,KAAKo4E,sBAAuB53E,EAAQg4E,sBAE1Dj1E,EAAA,MAAW,oBAAoByH,MAAKytE,IAChCz4E,KAAKq4E,oBAAoB11D,QAEpB81D,EAAYh2E,SACbg2E,EAAc,CAAC,CAAC99C,SAAU,QAAS+9C,MAAO,MAG9C,IAAK,MAAM,SAAC/9C,EAAQ,MAAE+9C,KAAUD,EAC5Bz4E,KAAKq4E,oBAAoB1zE,OAAOD,EAAE,QAAQ6gB,KAAK,GAAGoV,KAAY+9C,EAAQ,MAAMA,IAAU,MAC1F,GAER,IjBZAC,aAAc,CkBtCH,cAA0BlJ,GACrC37B,WACI9zC,KAAKwiB,QAAU9d,EAzCX,q0CA2CJ1E,KAAK44E,MAAQ54E,KAAKwiB,QAAQjW,KAAK,oBAC/BvM,KAAK64E,gBAAkB74E,KAAKwiB,QAAQjW,KAAK,qBACzCvM,KAAK84E,mBAAqB94E,KAAKwiB,QAAQjW,KAAK,wBAC5CvM,KAAK+4E,WAAa/4E,KAAKwiB,QAAQjW,KAAK,eACpCvM,KAAKg5E,gBAAkBh5E,KAAKwiB,QAAQjW,KAAK,qBAEzCvM,KAAK44E,MAAMrkE,GAAG,UAAU,IAAMvU,KAAK88B,SAEnC98B,KAAKg5E,gBAAgBzkE,GAAG,SAASlV,UAC7B,MAAMyzB,QAAevvB,EAAA,OAAY,aAE7BuvB,EAAOvsB,QACP,sBAAyBusB,EAAOpmB,SAGhC,oBAAuB,wCAAwComB,EAAOpmB,UAC1E,GAER,CAEAujE,cAAczvE,GACVR,KAAK64E,gBAAgBzzD,IAAI5kB,EAAQy4E,gBACjCj5E,KAAK84E,mBAAmB1zD,IAAI5kB,EAAQ04E,mBACpCl5E,KAAK+4E,WAAW3zD,IAAI5kB,EAAQ24E,UAChC,CAEAr8C,OAOI,OANA98B,KAAK0vE,sBAAsB,CACvB,eAAkB1vE,KAAK64E,gBAAgBzzD,MACvC,kBAAqBplB,KAAK84E,mBAAmB1zD,MAC7C,UAAaplB,KAAK+4E,WAAW3zD,SAG1B,CACX,IlBCAg0D,cAAe,CFvCJ,cAAkC3J,GAC7C17B,YACI,OAAOnxC,MAAMmxC,aAAe9yC,EAAA,oBAChC,CAEA6yC,WACI9zC,KAAKwiB,QAAU9d,EA9CX,usCAgDJ1E,KAAK44E,MAAQ54E,KAAKwiB,QAAQjW,KAAK,oBAC/BvM,KAAKq5E,8BAAgCr5E,KAAKwiB,QAAQjW,KAAK,oCACvDvM,KAAKs5E,wBAA0Bt5E,KAAKwiB,QAAQjW,KAAK,8BACjDvM,KAAKu5E,uBAAyBv5E,KAAKwiB,QAAQjW,KAAK,6BAEhDvM,KAAKq5E,8BAA8B9kE,GAAG,UAAU,KAC5C,MAAMilE,EAAyBx5E,KAAKq5E,8BAA8Bj0D,MAClEplB,KAAKs5E,wBAAwB,GAAGlmE,MAAQomE,EACxCx5E,KAAKu5E,uBAAuB,GAAGnmE,MAAQi9D,GAAemJ,EAAuB,IAGjFx5E,KAAK44E,MAAMrkE,GAAG,UAAU,KACpBvU,KAAK0vE,sBAAsB,CACvB,uBAA0B1vE,KAAKs5E,wBAAwBl0D,MACvD,sBAAyBplB,KAAKu5E,uBAAuBn0D,OACvD,GAEV,CAEA/lB,oBAAoBmB,GAChBR,KAAKq5E,8BAA8Bj0D,IAAI,IACvCplB,KAAKs5E,wBAAwB,GAAGlmE,MAAQ5S,EAAQw8C,uBAChDh9C,KAAKu5E,uBAAuB,GAAGnmE,MAAQ5S,EAAQy8C,qBACnD,GqB9DW,cAA0BwyB,GACrC37B,WACI9zC,KAAKwiB,QAAU9d,EAZX,yKAaJ1E,KAAKy5E,aAAez5E,KAAKwiB,QAAQjW,KAAK,iBACtCvM,KAAKy5E,aAAallE,GAAG,UAAU,IAC3BvU,KAAK8vE,aAAa,cAAgB9vE,KAAKy5E,aAAargD,GAAG,YAAuB,QAAT,SAC7E,CAEA/5B,oBAAoBmB,GAChBR,KAAKy5E,aAAa9kE,KAAK,UAAmC,SAAxBnU,EAAQk5E,YAC9C,GCFW,cAAwCjK,GACnD37B,WACI9zC,KAAKwiB,QAAU9d,EAlBX,sfAmBJ1E,KAAK25E,iCAAmC35E,KAAKwiB,QAAQjW,KAAK,yCAC1DvM,KAAK25E,iCAAiCplE,GAAG,UAAU,IAAMvU,KAAK8vE,aAAa,kCAAmC9vE,KAAK25E,iCAAiCv0D,SAEpJplB,KAAK45E,yBAA2B55E,KAAKwiB,QAAQjW,KAAK,mCAClDvM,KAAK45E,yBAAyBrlE,GAAG,SAAS,KACtChR,EAAA,OAAY,iCAAiCyH,MAAK,KAC9C,sBAAyB,aAAa,GACxC,GAEV,CAEA3L,oBAAoBmB,GAChBR,KAAK25E,iCAAiCv0D,IAAI5kB,EAAQq5E,gCACtD,GChBW,cAA8CpK,GACzD37B,WACI9zC,KAAKwiB,QAAU9d,EAlBX,6cAmBJ1E,KAAK85E,0CAA4C95E,KAAKwiB,QAAQjW,KAAK,mDACnEvM,KAAK85E,0CAA0CvlE,GAAG,UAAU,IAAMvU,KAAK8vE,aAAa,qCAAsC9vE,KAAK85E,0CAA0C10D,SAEzKplB,KAAK+5E,iCAAmC/5E,KAAKwiB,QAAQjW,KAAK,wCAC1DvM,KAAK+5E,iCAAiCxlE,GAAG,SAAS,KAC9ChR,EAAA,OAAY,sCAAsCyH,MAAK,KACnD,sBAAyB,cAAc,GACzC,GAEV,CAEA3L,oBAAoBmB,GAChBR,KAAK85E,0CAA0C10D,IAAI5kB,EAAQw5E,mCAC/D,GCtBW,cAA+CvK,GAC1D37B,WACI9zC,KAAKwiB,QAAU9d,EAdX,qZAeJ1E,KAAKi6E,uBAAyBj6E,KAAKwiB,QAAQjW,KAAK,+CAChDvM,KAAKi6E,uBAAuB1lE,GAAG,UAAU,IACrCvU,KAAK8vE,aAAa,+BAAgC9vE,KAAKi6E,uBAAuB70D,QACtF,CAEA/lB,oBAAoBmB,GAChBR,KAAKi6E,uBAAuB70D,IAAI5kB,EAAQ05E,6BAC5C,GCZW,cAAwCzK,GACnD37B,WACI9zC,KAAKwiB,QAAU9d,EAZX,uMAaJ1E,KAAKm6E,iBAAmBn6E,KAAKwiB,QAAQjW,KAAK,sBAC1CvM,KAAKm6E,iBAAiB5lE,GAAG,UAAU,IAC/BvU,KAAKgxE,qBAAqB,kBAAmBhxE,KAAKm6E,mBAC1D,CAEA96E,oBAAoBmB,GAChBR,KAAK+vE,iBAAiB/vE,KAAKm6E,iBAAkB35E,EAAQ45E,gBACzD,IvBoEAC,iBAAkB,CwB7EP,cAA4C5K,GACvD37B,WACI9zC,KAAKwiB,QAAU9d,EAXX,iMAYJ1E,KAAKs6E,sBAAwBt6E,KAAKwiB,QAAQjW,KAAK,2BAC/CvM,KAAKs6E,sBAAsB/lE,GAAG,SAASlV,UACnC,sBAAyB,iBAEzB,MAAM,QAACqH,SAAiBnD,EAAA,MAAW,4BAEZ,IAAnBmD,EAAQjE,QAA+C,OAA/BiE,EAAQ,GAAG6zE,gBACnC,sBAAyB,oBAGzB,sBAAyB,2BAA2BzuE,KAAKC,UAAUrF,EAAS,KAAM,KAAM,KAC5F,GAER,GClBW,cAAuC+oE,GAClD37B,WACI9zC,KAAKwiB,QAAU9d,EATX,yJAUJ1E,KAAKw6E,mCAAqCx6E,KAAKwiB,QAAQjW,KAAK,2CAC5DvM,KAAKw6E,mCAAmCjmE,GAAG,SAASlV,UAChD,sBAAyB,uBAEnBkE,EAAA,OAAY,4CAElB,sBAAyB,gBAAgB,GAEjD,GCKW,cAA2CksE,GACtD37B,WACI9zC,KAAKwiB,QAAU9d,EAzBX,6oBA0BJ1E,KAAKy6E,qBAAuBz6E,KAAKwiB,QAAQjW,KAAK,0BAC9CvM,KAAK06E,sBAAwB16E,KAAKwiB,QAAQjW,KAAK,2BAC/CvM,KAAKy6E,qBAAqBlmE,GAAG,SAASlV,UAClC,sBAAyB,iBAEzB,MAAMiH,QAAa/C,EAAA,OAAY,2BAE1B+C,EAAKC,QAIN,sBAAyB,wCAAwCD,EAAKq0E,qBAAsB,KAH5F,oBAAuB,0BAM3B36E,KAAK80C,SAAS,IAGlB90C,KAAK06E,sBAAsBnmE,GAAG,SAASlV,UACnC,sBAAyB,gBAEzB,MAAMiH,QAAa/C,EAAA,OAAY,4BAE1B+C,EAAKC,QAIN,sBAAyB,0CAA0CD,EAAKq0E,qBAAsB,KAH9F,oBAAuB,0BAM3B36E,KAAK80C,SAAS,IAGlB90C,KAAK46E,6BAA+B56E,KAAKwiB,QAAQjW,KAAK,iCAC1D,CAEA0jE,cAAczvE,GACV+C,EAAA,MAAW,iCAAiCyH,MAAK6vE,IAC7C76E,KAAK46E,6BAA6Bj4D,QAE7Bk4D,EAAoBp4E,SACrBo4E,EAAsB,CAAC,CAAClgD,SAAU,gBAGtC,IAAK,MAAM,SAACA,KAAakgD,EACrB76E,KAAK46E,6BAA6Bj2E,OAAOD,EAAE,QAAQ6gB,KAAKoV,GAC5D,GAER,GCjEW,cAAkC80C,GAC7C37B,WACI9zC,KAAKwiB,QAAU9d,EAVX,uMAWJ1E,KAAK86E,qBAAuB96E,KAAKwiB,QAAQjW,KAAK,2BAC9CvM,KAAK+6E,yBAA2B/6E,KAAKwiB,QAAQjW,KAAK,+BAClDvM,KAAK86E,qBAAqBvmE,GAAG,SAASlV,gBAC5BkE,EAAA,OAAY,wBAElB,sBAAyB,UAAU,IAGvCvD,KAAK+6E,yBAAyBxmE,GAAG,SAASlV,UACtC,sBAAyB,qBAEnBkE,EAAA,OAAY,4BAElB,sBAAyB,WAAW,GAE5C,CAEAlE,oBAAoBmB,GAEpB,GCrBW,cAAoCivE,GAC/C37B,WACI9zC,KAAKwiB,QAAU9d,EAXX,kLAYJ1E,KAAKg7E,sBAAwBh7E,KAAKwiB,QAAQjW,KAAK,2BAC/CvM,KAAKg7E,sBAAsBzmE,GAAG,SAASlV,UACnC,sBAAyB,kBAEnBkE,EAAA,OAAY,4BAElB,sBAAyB,SAAS,GAE1C,I5ByEA03E,YAAa,CAAE3K,K6BjDJ,MAAM4K,WAAgC,IACjDv4E,YAAY6H,EAAY2wE,GACpBv4E,QAEA5C,KAAKwK,WAAaA,EAClBxK,KAAKm7E,aAAeA,CACxB,CAEI5wE,mBACA,OAAOvK,KAAKwK,WAAWD,YAC3B,CAEAupC,WACI9zC,KAAKwiB,QAAU9d,EApDX,muDAqDJ1E,KAAKwiB,QAAQjO,GAAG,QAAS,kBAAkB,IAAMvU,KAAKwiB,QAAQjW,KAAK,4BAA4B4xC,SAAS,YAExGn+C,KAAKo7E,wBAA0Bp7E,KAAKwiB,QAAQjW,KAAK,yCACjDvM,KAAKo7E,wBAAwB7mE,GAAG,UAAUlV,UACtC,MAAM4lC,EAAejlC,KAAKo7E,wBAAwB,GAAGlpD,MAAM,GAC3DlyB,KAAKo7E,wBAAwBh2D,IAAI,WAEZ7hB,EAAA,SAAc,eAAevD,KAAKuK,oBAAqB06B,IAEjEo2C,SACP,sBAAyB,aAEzB,oBAAuB,8CAC3B,IAGCr7E,KAAKm7E,eAGwBn7E,KAAKwiB,QAAQjW,KAAK,2CAE3CsX,SAAS,YACTlf,OAAOD,EAAE,8CACLqO,KAAK,QAAS,qCAEa/S,KAAKwiB,QAAQjW,KAAK,iDAEjDsX,SAAS,YACTlf,OAAOD,EAAE,8CACLqO,KAAK,QAAS,sCAGtB9R,EAAA,sBACmCjB,KAAKwiB,QAAQjW,KAAK,iDAEjDsX,SAAS,YACTlf,OAAOD,EAAE,8CACLqO,KAAK,QAAS,mEAG/B,CAEA1T,oCACU,8BAAqCW,KAAKuK,aAAcvK,KAAKwK,WAAWrK,KAClF,CAEAd,0CACU,0BAAiCW,KAAKuK,aAAcvK,KAAKwK,WAAWrK,KAC9E,CAEAd,wCACU,wBAA+BW,KAAKuK,aAC9C,CAEAlL,2CACIW,KAAKo7E,wBAAwBt2E,QAAQ,QACzC,CAEAzF,6CACIW,KAAKqW,OAAOilE,+BAChB,CAEAj8E,sCACeuhC,EAAA,UAAsB,cAAc5gC,KAAKwK,WAAWF,mBAIzD/G,EAAA,SAAc,eAAevD,KAAKuK,gBACxC,sBAAyB,UAAUvK,KAAKwK,WAAWF,UACvD,CAEAjL,yCACI,UAAWuhC,EAAA,UAAsB,gDAAgD5gC,KAAKwK,WAAWF,gCAC7F,OAGJ,MAAOhH,KAAMi4E,SAAiBh4E,EAAA,OAAY,eAAevD,KAAKuK,gCAC9D,sBAAyB,OAAOvK,KAAKwK,WAAWF,uBAC1C3G,EAAA,wCACA,wCAAyCyF,QAAQmyE,EAAQh8E,OACnE,CAEAF,gCACI,MAAMm8E,QAAwB56C,EAAA,SAAqB,CAC/Ct2B,MAAO,QACPoC,QAAS,YACT0qE,aAAcp3E,KAAKwK,WAAWF,QAG7BkxE,GAAiBxhE,cAIhBzW,EAAA,MAAW,eAAevD,KAAKuK,sBAAuB,CAACD,MAAOkxE,GACxE,ECnJJ,MAAM,GAAM,+iFAwFG,MAAMC,WAA+B,IAChD94E,YAAY6H,EAAY2wE,GACpBv4E,QAEA5C,KAAKwzC,eACLxzC,KAAKwK,WAAaA,EAClBxK,KAAK07E,wBAA0B,IAAIR,GAAwB1wE,EAAY2wE,GACvEn7E,KAAKm7E,aAAeA,EACpBn7E,KAAKmO,MAAMnO,KAAK07E,wBACpB,CAEA5nC,WACI9zC,KAAKwiB,QAAU9d,EAAE,IACjB1E,KAAK80C,UAELlyC,MAAMkxC,UACV,CAEAz0C,gBACIW,KAAKwiB,QAAQjW,KAAK,8BACboW,QACAhe,OACGD,EAAE,IACG6H,KAAK,8BACLoZ,QAEb3lB,KAAKyoE,SAAWzoE,KAAKwiB,QAAQjW,KAAK,8BAClCvM,KAAKyoE,SAAS5kD,SAAS7jB,KAAKm7E,aAAe,cAAgB,aAEtDn7E,KAAKm7E,aAWNn7E,KAAKyoE,SAASl8D,KAAK,qBACdgZ,KAAKvlB,KAAKwK,WAAWF,OAX1BtK,KAAKyoE,SAASl8D,KAAK,qBAAqB5H,aAC9B,eAAuB3E,KAAKwK,WAAW8N,QAAS,CAClDhO,MAAOtK,KAAKwK,WAAWF,MACvBnL,UAAW,CACP4B,SAAU,cACVwJ,aAAcvK,KAAKwK,WAAWD,iBAS9C,MAAMoxE,EAAmB37E,KAAKyoE,SAASl8D,KAAK,iCACtC,gCAACmM,GAAmC1Y,KAAKwK,WAE/C,GAAIkO,EAAiC,CACjC1Y,KAAKyoE,SAAS5kD,SAAS,0BAEvB,MAAM+3D,EAA0B36E,EAAA,kBAAgByX,IAAkCmjE,UAG5EC,EADoBF,EADgD,IAAvDp7E,EAAA,SAAe,sCAEYqW,KAAKC,MAEnD6kE,EAAiBx0C,OAEb20C,GAAqB,IACrBH,EAAiBp2D,KAAK,SAAStkB,EAAA,2BAAyB66E,aAExDH,EAAiBp2D,KAAK,eAG1Bo2D,EAAiBh3E,OAAO,gDAC5B,MACI3E,KAAKyoE,SAASrc,YAAY,0BAC1BuvB,EAAiBj5D,OAGrB1iB,KAAKyoE,SAASl8D,KAAK,uBACdgZ,KAAK,MAAMvlB,KAAKwK,WAAW+N,WAAWtX,EAAA,mBAAiBjB,KAAKwK,WAAWhB,kBAC5ExJ,KAAKyoE,SAASl8D,KAAK,iCAAiC5H,OAAO3E,KAAK07E,wBAAwBpnE,UAExF,MAAM,iBAAC4W,SAA0B,wBAAmClrB,KAAKwK,WAAY,CAAE4hB,aAAcpsB,KAAKm7E,eAC1Gn7E,KAAKyoE,SAASl8D,KAAK,+BAA+B5H,OAAOumB,EAC7D,CAEA7rB,sCACI,GAA6B,UAAzBW,KAAKwK,WAAW+N,KAChB,GAA2CvY,KAAKyoE,SAASl8D,KAAK,oCAC3D,IAA6B,SAAzBvM,KAAKwK,WAAW+N,KAavB,MAAM,IAAI/K,MAAM,iCAAiCxN,KAAKwK,WAAW+N,UAbzB,CACxC,MAAM2L,QAAc,eAAuBlkB,KAAKwK,WAAW8N,QAAS,CAChEoS,eAAe,EACfvrB,UAAW,CACP4B,SAAU,cACVwJ,aAAcvK,KAAKwK,WAAWD,gBAItCtJ,EAAA,4BAA0BijB,EAAM,GAAGyG,WAEnC,sBAAyB,eAC7B,CAEA,CACJ,CAEAtrB,6BAA4B,YAACoK,IACzB,MAAM8nB,EAAgB9nB,EAAYkmC,oBAAoBpjC,MAAKqQ,GAAOA,EAAIrS,eAAiBvK,KAAKwK,WAAWD,eAEnGgnB,IACIA,EAAc3nB,UACd5J,KAAKg0C,WAAU,GAEfh0C,KAAK80C,UAGjB,EC7KJ,MAeMinC,GAAoB,CACtB,MCHW,cAA8BxU,GACzCpgE,iBAAmB,MAAO,OAAS,CAEnC2sC,WAGI9zC,KAAKwiB,QAAU9d,EA7CX,ygCA8CJ1E,KAAKg8E,cAAgBh8E,KAAKwiB,QAAQjW,KAAK,sBAEvC,uBAA6CvM,KAAKg8E,cAAe,CAC7D3hC,4BAA4B,EAC5BpB,oBAAoB,IAEnB1kC,GAAG,6BAA6B,SAAS8C,EAAO8jC,EAAY2kB,GACzD,IAAK3kB,EAAWr7C,SACZ,OAAO,EAGX,wCAAyCsJ,QAAQ+xC,EAAWr7C,SAChE,IAEJE,KAAKi8E,gBAAkBj8E,KAAKwiB,QAAQjW,KAAK,oBAEzC3J,MAAMkxC,UACV,CAEAz0C,gBAAgBiE,GACZ,MAAM44E,QAAuB/7C,GAAA,iBAA6B,yBAE1DngC,KAAKi8E,gBAAgBt5D,QAErB,IAAK,MAAMw5D,KAAiBD,EACxBl8E,KAAKi8E,gBAAgBt3E,OACjBD,EAAE,gCACGC,OAAOD,EAAE,SAASmf,SAAS,GAAGs4D,EAAcl9D,6BAC5Cta,OAAOD,EAAE,SAAS6gB,KAAK42D,EAAc7xE,QACrCyI,KAAK,QAAS,UAAUopE,EAAc7xE,SACtCiK,GAAG,SAAS,IAAMvU,KAAKgI,eAAe,YAAa,CAACzI,OAAQ48E,EAAc58E,YAIvFS,KAAKg8E,cACAl3E,QAAQ,SACRA,QAAQ,SACjB,GDxCA,a3CwCW,cAAqCkjE,GAChD7gE,iBAAmB,MAAO,cAAgB,CAE1C2sC,WACI9zC,KAAKwiB,QAAU9d,EA7DX,giFA8DJ1E,KAAKojE,QAAUpjE,KAAKwiB,QAAQjW,KAAK,qCAEjCvM,KAAKkW,YAAclW,KAAKqjE,aAExB,iCAA6C,cAAerjE,KAAKwiB,QAASxiB,MAE1EA,KAAKioE,mBAAkB,GAEvBrlE,MAAMkxC,UACV,CAEAz0C,yBACU,oBAA6B,eAEnC,MAAM+8E,SACK,mBACFxwE,QAAOk8D,GAAMA,EAAGtjD,UAChB7Y,KAAIm8D,IAAM,CACHuU,SAAUvU,EAAG3nE,KAAK82B,cAAc9gB,QAAQ,UAAU,KAClDgK,MAAO2nD,EAAGx9D,UAM1BtK,KAAKwiB,QAAQ2kB,OAEbnnC,KAAKs8E,SAAW,IAAIC,eAAejY,cAAe,CAK9CkY,0BAA2B,IAM3BC,iBAAkB,EAGlBC,aAAc,MAGlB18E,KAAKs8E,SAAS/nE,GAAG,eAAe,KAC5B,MAAMooE,EAAe38E,KAAKs8E,SAASM,MAE9B,CAAC,UAAW,sBAAsBzzE,SAASwzE,KAIhD1nE,QAAQY,IAAI,uBAAuB8mE,KAEnC38E,KAAKs8E,SAASO,QAAQ3sE,SAAQ4sE,GAAa7nE,QAAQY,IAAIinE,KAElC,uBAAjBH,IACA/7C,EAAA,OAAmB,yHAEnB5gC,KAAKs8E,SAAS1zC,OAAOm0C,mBAAmB,mBAC5C,IAGJ/8E,KAAKs8E,SAASU,YAAW39E,MAAO49E,EAAe3a,KAC3C,MAAM15B,QAAe07B,cAAch4C,OAAO2wD,EAAe3a,GASzD,OAPA15B,EAAO27B,MAAM9yD,SAAS8C,GAAG,eAAe,IAAMvU,KAAKs9D,aAAaxwD,mBAE5DlI,KAAKqS,MAKF2xB,CAAM,UAGX5oC,KAAKs8E,SAAShwD,OAAOtsB,KAAKojE,QAAQ,GAAI,CACxCX,YAAa,YACbC,QAAS,GACTwa,UAAW,CACPC,UAAWf,GAEfgB,KAAM,CACFC,OAAQ,QACRC,WAAY,OACZvoB,SAAU11D,eAAkB,oBAA6B,YACzDk+E,iBAAiB,EACjBC,eAAe,IAG3B,CAEAn+E,gBAAgBiE,GACZ,MAAM+F,QAAa/F,EAAKgG,gBAElBtJ,KAAKs9D,aAAa9wD,0BAAyB,IAC7CxM,KAAKs8E,SAAS1zC,OAAOqrB,QAAQ5qD,EAAK7F,SAAW,KACrD,CAEAqxD,UACI,MAAMrxD,EAAUxD,KAAKs8E,SAAS1zC,OAAOisB,UAIrC,MAAO,CACHrxD,QAASvC,EAAA,oBAAkBuC,GAAW,GAAKA,EAEnD,CAEA40B,QACIp4B,KAAKojE,QAAQt+D,QAAQ,QACzB,CAEA24E,cACIz9E,KAAKs8E,UAAU1zC,OAAO27B,MAAMI,QAAOC,IAC/BA,EAAOsB,aAAatB,EAAOqB,iBAAiBjmE,KAAKs8E,UAAU1zC,OAAO27B,MAAM9yD,SAASozD,UAAW,OAAO,IAGvG7kE,KAAKs8E,UAAU1zC,OAAOC,QAAQC,KAAK1Q,OACvC,CAEA+O,OAAQ,CAERu2C,YACI,OAAO19E,KAAKs8E,UAAU1zC,MAC1B,CAEA4L,UACQx0C,KAAKs8E,UAAU1zC,QACf5oC,KAAKs9D,aAAa9wD,0BAAyB,KACvCxM,KAAKs8E,SAAS1zC,OAAOqrB,QAAQ,GAAG,GAG5C,CAEA0pB,8BACI,MAAMvvD,EAAO,IAAIvX,KACX+mE,EAAa38E,EAAA,uBAAqBmtB,GAExCpuB,KAAK69E,gBAAgBD,EACzB,CAEAv+E,sBAAsBy+E,EAAUnmD,SACtB33B,KAAKkW,YAEXlW,KAAKs8E,SAAS1zC,OAAO27B,MAAMI,QAAOC,IAC9B,MAAMmZ,EAAiB/9E,KAAKs8E,SAAS1zC,OAAO27B,MAAM9yD,SAASwzD,UAAUC,mBACrEN,EAAOrnB,WAAW5lB,EAAW,CAACmmD,SAAUA,GAAWC,EAAe,GAE1E,CAEA1+E,sBAAsBkmB,SACZvlB,KAAKkW,YAEXlW,KAAKs8E,SAAS1zC,OAAO27B,MAAMI,QAAOC,IAC9B,MAAMmZ,EAAiB/9E,KAAKs8E,SAAS1zC,OAAO27B,MAAM9yD,SAASwzD,UAAU+Y,kBACrEpZ,EAAOrnB,WAAWh4B,EAAMw4D,EAAe,GAE/C,CAEAE,4BAA2B,KAAC14D,IACnBvlB,KAAK+I,YAIV/I,KAAK69E,gBAAgBt4D,EACzB,CAEAlmB,cAAcS,EAAU63B,SACd33B,KAAKkW,YAEPyhB,EACI33B,KAAKk+E,eACLl+E,KAAKs8E,SAAS1zC,OAAOu1C,QAAQ,OAAQ,IAAIr+E,WAEnCE,KAAKo+E,gBAAgB,IAAIt+E,IAAY63B,GAI/C33B,KAAKs8E,SAAS1zC,OAAOu1C,QAAQ,gBAAiB,CAAE9xE,KAAM,IAAMvM,IAGhEE,KAAKs8E,SAAS1zC,OAAOC,QAAQC,KAAK1Q,OACtC,CAGA8lD,eAII,OAHcl+E,KAAKs8E,SAAS1zC,OAAO27B,MACX9yD,SAASwzD,UAEfoZ,WACtB,CAEAh/E,kCAAiC,SAAC0K,EAAQ,QAAEG,EAAO,MAAEzK,IAC5CO,KAAKy0C,cAAch1C,WAIlBO,KAAKkW,YAEPnM,GACAA,EAAS/J,KAAKs8E,SAAS1zC,QAG3B1+B,EAAQlK,KAAKs8E,SAAS1zC,QAC1B,CAEA01C,uBACI,MAAMC,EAAev+E,KAAKw+E,kBAE1Bx+E,KAAKgI,eAAe,oBAAqB,CAACy2E,eAAgBz+E,KAAMulB,KAAMg5D,GAC1E,CAEAC,kBACI,MAAM5V,EAAQ5oE,KAAKs8E,SAAS1zC,OAAO27B,MAAM9yD,SAASwzD,UAAUyZ,gBAC5D,IAAIn5D,EAAO,GAEX,IAAK,MAAMxB,KAAQ6kD,EAAM+V,WACjB56D,EAAK7R,OACLqT,GAAQxB,EAAK7R,MAIrB,OAAOqT,CACX,CAEAlmB,2CACUW,KAAKkW,YAEX,MAAM+uD,EAAYjlE,KAAKs8E,SAAS1zC,OAAO27B,MAAM9yD,SAASwzD,UAChD2Z,EAAkB3Z,EAAU4Z,qBAElC,GAA8B,cAA1BD,GAAiBtrE,KAAsB,CAEvC,MAAMxT,EAAW8+E,EAAgB9+D,aAAa,YAE9C,GAAIhgB,EAEA,kBADM,wCAAyCsJ,QAAQtJ,EAG/D,CAEA,IAAKmlE,EAAU1oD,aAAa,YACxB,OAGJ,MAAMuiE,EAAkB7Z,EAAUnlD,aAAa,YACzChgB,EAAW,uBAAwBg/E,GAErCh/E,QACM,wCAAyCsJ,QAAQtJ,GAEvD2B,OAAOyE,KAAK44E,EAAiB,SAErC,CAEAC,8BACI/+E,KAAKgI,eAAe,wBAAyB,CAACy2E,eAAgBz+E,MAClE,CAEAg/E,eAAez/E,EAAQ0/E,GACnBj/E,KAAKs8E,SAAS1zC,OAAO27B,MAAMI,QAAQC,IAG/B5kE,KAAKs8E,SAAS1zC,OAAO27B,MAAM2a,cAActa,EAAO7tB,cAAc,cAAe,CACzEx3C,OAAQA,EACR0/E,QAASA,IACV,GAEX,CAEA5/E,eAAeE,GACX,MAAM+D,QAAazD,EAAA,gBAAcN,GAEjCS,KAAKs8E,SAAS1zC,OAAO27B,MAAMI,QAAQC,IAC/B,MAAM54C,EAAeC,mBAAmB3oB,EAAKgH,OACvC4sC,EAAM,cAAc5zC,EAAK/D,UAAUysB,IAEzChsB,KAAKs8E,SAAS1zC,OAAOu1C,QAAS,cAAe,CAAEnjC,OAAQ9D,GAAO,GAEtE,CAEA73C,iCAAiCiL,GAC7B,MAAMhE,QAAa,6BAA2CtG,KAAKF,SAAU,CACzEN,UAAU,EACV8K,MAAOA,IAGX,GAAKhE,EAIL,OAAOA,EAAKhD,KAAKqb,uBACrB,CAEAtf,gCAA+B,OAACE,IAC5BS,KAAKyhC,oBAAoBzhC,KAAKojE,QAAS7jE,EAC3C,G2CpVA,aEqBW,cAAqCyoE,GAChD7gE,iBAAmB,MAAO,cAAgB,CAE1C2sC,WACI9zC,KAAKwiB,QAAU9d,EAvEX,whGAyEJ1E,KAAK6sB,SAAW7sB,KAAKwiB,QAAQjW,KAAK,sCAElCvM,KAAKioE,mBAAkB,GAEvBrlE,MAAMkxC,UACV,CAEAU,UACIx0C,KAAK6sB,SAASlH,KAAK,GACvB,CAEAtmB,gBAAgBiE,SAIN,oBAA6B,eAEnC,MAAM+F,QAAa/F,EAAKgG,UAExBtJ,KAAK6sB,SAASlH,KAAKtc,EAAK7F,SAExBxD,KAAK6sB,SAAStgB,KAAK,oBAAoBonB,MAAKt0B,MAAO4gD,EAAG7qC,KAClDpV,KAAK83B,uBAAuBpzB,EAAE0Q,GAAI,IAGtCpV,KAAK6sB,SAAStgB,KAAK,WAAWonB,MAAKt0B,MAAO4gD,EAAG7qC,KACzC,MAAM7V,EAASmF,EAAE0Q,GAAIrC,KAAK,gBAE1B/S,KAAK0oE,iBAAiBnpE,EAAQmF,EAAE0Q,GAAI,IAGpCpV,KAAK6sB,SAAStgB,KAAK,iBAAiB9J,OAAS,UACvC,oBAA6B,YAEnCgpB,oBAAoBzrB,KAAK6sB,SAAS,GAAI,CAACnB,OAAO,IAEtD,CAEArsB,gCAA+B,OAACE,IAC5BS,KAAKyhC,oBAAoBzhC,KAAK6sB,SAAUttB,EAC5C,CAEAF,sCAAqC,QAAC6K,EAAO,MAAEzK,IACtCO,KAAKy0C,cAAch1C,WAIlBO,KAAKkW,YAEXhM,EAAQlK,KAAK6sB,UACjB,GF5EA,aG5BW,cAAqC06C,GAChDpgE,iBAAmB,MAAO,cAAgB,CAE1C2sC,WACI9zC,KAAKwiB,QAAU9d,EArBX,mUAsBJ1E,KAAKojE,QAAUpjE,KAAKwiB,QAAQjW,KAAK,4BAEjC,iCAA6C,cAAevM,KAAKwiB,QAASxiB,MAE1E4C,MAAMkxC,WAEN9zC,KAAKkW,YAAclW,KAAKqjE,YAC5B,CAEAhkE,yBACU,oBAA6B,kBAEnC8/E,WAAWC,OAAO/8D,QAAQ,aAAe,aACzC88D,WAAWC,OAAO/8D,QAAa,IAAI,oBAG5B88D,WAAWC,OAAO/8D,QAAQ,mBAC1B88D,WAAWC,OAAO/8D,QAAQ,aAEjC88D,WAAWE,QAAU,GAAG59E,OAAOmD,KAAKuvB,+CAEpCn0B,KAAKs/E,WAAaH,WAAWn/E,KAAKojE,QAAQ,GAAI,CAC1ChwD,MAAO,GACPmsE,eAAgBxxB,IAChByxB,WAAY,EACZC,eAAe,EACfL,OAAQ5+E,EAAA,KAAW,oBAAsB,MAAO,UAChDk/E,UAAW,CAACC,UAAU,GACtBC,0BAA2B,CAACC,WAAW,EAAOC,mBAAmB,GACjEC,MAAM,EACNC,QAAS,CAAC,2BACVC,aAAa,EACbC,SAAU,IAGVC,aAAc3/E,EAAA,KAAW,uBACzB4zD,UAAU,EACVqO,YAAa,oBAGjBziE,KAAKs/E,WAAW/qE,GAAG,UAAU,IAAMvU,KAAKs9D,aAAaxwD,kBACzD,CAEAzN,gBAAgBiE,GACZ,MAAM+F,QAAarJ,KAAKsD,KAAKgG,gBAEvBtJ,KAAKs9D,aAAa9wD,0BAAyB,KAG7CxM,KAAKs/E,WAAWc,SAAS/2E,EAAK7F,SAAW,IACzCxD,KAAKs/E,WAAWe,eAEhB,IAAIrxD,EAAOmwD,WAAWmB,eAAeh9E,EAAKnD,MACrC6uB,IAGDA,EAAOmwD,WAAWmB,eAAe,eAGrCtgF,KAAKs/E,WAAWiB,UAAU,OAAQvxD,EAAK7uB,MACvCg/E,WAAWqB,aAAaxgF,KAAKs/E,WAAYtwD,EAAK2kC,KAAK,IAGvD3zD,KAAKmnC,MACT,CAEAA,OACInnC,KAAKwiB,QAAQ2kB,OAETnnC,KAAKs/E,YACLt/E,KAAKs/E,WAAWxqC,SAExB,CAEA+f,UACI,MAAO,CACHrxD,QAASxD,KAAKs/E,WAAWmB,WAEjC,CAEAroD,QACIp4B,KAAKojE,QAAQhrC,QACbp4B,KAAKs/E,WAAWlnD,OACpB,CAEAqlD,cACIz9E,KAAKs/E,WAAWoB,UAAU1gF,KAAKs/E,WAAWqB,YAAa,GACvD3gF,KAAKs/E,WAAWlnD,OACpB,CAEAoc,UACQx0C,KAAKs/E,YACLt/E,KAAKs9D,aAAa9wD,0BAAyB,KACvCxM,KAAKs/E,WAAWc,SAAS,GAAG,GAGxC,CAEA/gF,kCAAiC,QAAC6K,EAAO,MAAEzK,IAClCO,KAAKy0C,cAAch1C,WAIlBO,KAAKkW,YAEXhM,EAAQlK,KAAKs/E,YACjB,GHlFA,aIjCW,cAAqC/X,GAChDpgE,iBAAmB,MAAO,cAAgB,CAE1C2sC,WACI9zC,KAAKwiB,QAAU9d,EApBX,mVAqBJ1E,KAAK6sB,SAAW7sB,KAAKwiB,QAAQjW,KAAK,sCAElC3J,MAAMkxC,UACV,CAEAz0C,gBAAgBiE,GACZ,IAAI,QAACE,SAAiBxD,KAAKsD,KAAKgG,UAEd,SAAdhG,EAAKG,MAA6D,WAA1CzD,KAAKd,aAAaC,WAAW4B,WACrDyC,EAAUxD,KAAKuuB,OAAO/qB,IAG1BxD,KAAK6sB,SAAStH,KAAK/hB,EACvB,CAEAnE,sCAAqC,QAAC6K,EAAO,MAAEzK,IACtCO,KAAKy0C,cAAch1C,WAIlBO,KAAKkW,YAEXhM,EAAQlK,KAAK6sB,UACjB,CAEA0B,OAAO5I,GACH,IAAIi7D,EAAS,KAETpxE,EAAI,EACJqxE,EAAM,GA8BV,IA5BAl7D,EAAOA,EACFxP,QAAQ,IAAIkzB,OAAO,mCAAmC,SAAU3lB,GAE7D,OADAm9D,EAAIv0E,KAAK,CAACs0E,OAAQ,GAAIE,IAAKp9D,IACpB,aAAelU,IAAM,SAChC,IACC2G,QAAQ,IAAIkzB,OAAO,gBAAiB,MAAM,SAAU3lB,GACjD,IAAI/M,EACAmqE,EAAM,iBAAiBtpD,KAAK9T,GAAG,GAC/B0M,EAAI,IAAIiZ,OAAO,2BAAwB7R,KAAK9T,GAiBhD,OAfI0M,IACAywD,EAAIzwD,EAAE,IAAIwwD,OAASA,GAGnB,CAAC,OAAQ,OAAQ,KAAM,MAAO,UAAW,QAAS,KAAM,MAAO,QAAS,SAAU,OAAQ,WAAY,OAAQ,QAAS,SAAU,QAAS,OAAO7qD,QAAQ+qD,IAAQ,EACjKnqE,EAAMiqE,EAASl9D,EAEXA,EAAEqS,QAAQ,MAAQ,GACkBpf,EAAL,MAA3B+M,EAAE5E,OAAO4E,EAAEjhB,OAAS,GAAkBm+E,EAASl9D,EAAEsS,OAAO,EAAGtS,EAAEjhB,OAAS,GAAKm+E,EAtBnF,KAsBkGl9D,EAAEsS,OAAOtS,EAAEjhB,OAAS,EAAGihB,EAAEjhB,QAAoBm+E,EAASl9D,GACnJ0M,IAAMwwD,GAvBX,QAyBIA,EAASA,EAAO5qD,OAAO,EAAG4qD,EAAOn+E,OAAS,GACNkU,EAAL,MAA3B+M,EAAE5E,OAAO4E,EAAEjhB,OAAS,GAAkBm+E,EAASl9D,EAAEsS,OAAO,EAAGtS,EAAEjhB,OAAS,GAAKm+E,EAASl9D,EAAEsS,OAAOtS,EAAEjhB,OAAS,EAAGihB,EAAEjhB,QAAoBm+E,EAASl9D,GAG/I/M,CACX,IAECnH,EAAIqxE,EAAIp+E,OAAQ+M,KACjBmW,EAAOA,EAAKxP,QAAQ,aAAe3G,EAAI,UAAQqxE,EAAIrxE,GAAGsxE,IAAI3qE,QAAQ,QAAS,WAAWA,QAAQ,SAAU0qE,EAAIrxE,GAAGoxE,OAAS,WAG5H,MAA0B,OAAnBj7D,EAAK7G,OAAO,GAAc6G,EAAKqQ,OAAO,EAAGrQ,EAAKljB,OAAS,GAAKkjB,CACvE,GJnCA,KKfW,cAA6B4hD,GACxCpgE,iBAAmB,MAAO,MAAQ,CAElC2sC,WACI9zC,KAAKwiB,QAAU9d,EAtCX,g2BAuCJ1E,KAAK+gF,gBAAkB/gF,KAAKwiB,QAAQjW,KAAK,yBACzCvM,KAAKghF,qBAAuBhhF,KAAKwiB,QAAQjW,KAAK,+BAC9CvM,KAAK8sB,YAAc9sB,KAAKwiB,QAAQjW,KAAK,gBACrCvM,KAAKgtB,cAAgBhtB,KAAKwiB,QAAQjW,KAAK,kBACvCvM,KAAK+sB,cAAgB/sB,KAAKwiB,QAAQjW,KAAK,kBAEvC3J,MAAMkxC,UACV,CAEAz0C,gBAAgBiE,GACZtD,KAAKwiB,QAAQ2kB,OAEb,MAAM99B,QAAarJ,KAAKsD,KAAKgG,UAE7BtJ,KAAK+gF,gBAAgBp+D,QAAQD,OAC7B1iB,KAAK8sB,YAAY/Z,KAAK,MAAO,IAAI4P,QAAQD,OACzC1iB,KAAKghF,qBAAqBt+D,OAC1B1iB,KAAKgtB,cAActK,OACnB1iB,KAAK+sB,cAAcrK,OAEfrZ,EAAK7F,SACLxD,KAAK+gF,gBAAgB55C,OAAO08B,UAAU,GACtC7jE,KAAK+gF,gBAAgBx7D,KAAKlc,EAAK7F,UAEZ,oBAAdF,EAAKnD,KACVH,KAAK8sB,YAAYqa,OAAOp0B,KAAK,MAAO,uBAA8B,aAAa/S,KAAKT,gBAE/E+D,EAAKnD,KAAK+H,WAAW,UAC1BlI,KAAKgtB,cACAma,OACAp0B,KAAK,MAAO,uBAA8B,aAAa/S,KAAKT,wBAC5DwT,KAAK,OAAQ/S,KAAKsD,KAAKnD,MACvBwjB,IAAI,QAAS3jB,KAAKwiB,QAAQ29B,SAE1B78C,EAAKnD,KAAK+H,WAAW,UAC1BlI,KAAK+sB,cACAoa,OACAp0B,KAAK,MAAO,uBAA8B,aAAa/S,KAAKT,wBAC5DwT,KAAK,OAAQ/S,KAAKsD,KAAKnD,MACvBwjB,IAAI,QAAS3jB,KAAKwiB,QAAQ29B,SAG/BngD,KAAKghF,qBAAqB75C,MAElC,CAEA9nC,6BAA4B,YAACoK,IACrBA,EAAYC,eAAe1J,KAAKT,SAChCS,KAAK80C,SAEb,GLvCA,MMbJ,cAA8ByyB,GAC1BpgE,iBAAmB,MAAO,OAAS,CAEnC2sC,WACI9zC,KAAKwiB,QAAU9d,EAtCX,gyBAuCJ1E,KAAK2oE,cAAgB3oE,KAAKwiB,QAAQjW,KAAK,8BACvCvM,KAAKihF,WAAajhF,KAAKwiB,QAAQjW,KAAK,2BAC/BwG,KAAK,KAAM,cAAc9R,EAAA,qBAAmB,OAEjD,oBAA6B,iBAA0B+J,MAAK,KACxDqhB,MAAMC,OAAO,IAAItsB,KAAKihF,WAAWluE,KAAK,QAAS,CAC3CwZ,SAAU,GACVC,MAAO,IACPC,aAAa,GACf,IAGFxrB,EAAA,sBAEAjB,KAAKihF,WAAW1sE,GAAG,eAAe7L,IAC9BA,EAAE+tB,iBAEF,SAAiB,CACb/S,EAAGhb,EAAEic,MACLnB,EAAG9a,EAAEkc,MACL/B,MAAO,CACH,CACIvY,MAAO,WACPua,QAAS,gCACTZ,OAAQ,eAEZ,CAAC3Z,MAAO,WAAYua,QAAS,uBAAwBZ,OAAQ,gBAEjEM,sBAAuB,EAAEM,cACrB,GAAgB,kCAAZA,EACA,GAA2C7kB,KAAK2oE,mBAC7C,IAAgB,yBAAZ9jD,EAKP,MAAM,IAAIrX,MAAM,WAAWqX,MALgB,CAC3C,MAAM7f,EAAc/D,EAAA,uBAAqB,oBAAoBgE,wBAC7DhE,EAAA,uBAAqB,YACrB+D,EAAYk8E,YAAYx4E,EAAEic,MAAOjc,EAAEkc,MACvC,CAEA,IAEN,IAIVhiB,MAAMkxC,UACV,CAEAz0C,gBAAgBiE,GACZtD,KAAKihF,WAAWtsE,KAAK,MAAO1T,EAAA,0BAAwBqC,GACxD,CAEA69E,oCAAmC,MAAC1hF,IAC3BO,KAAKy0C,cAAch1C,IAIxB,GAA2CO,KAAK2oE,cACpD,CAEAtpE,6BAA4B,YAACoK,IACrBA,EAAYC,eAAe1J,KAAKT,SAChCS,KAAK80C,SAEb,GNrDA,OOlDW,cAA6ByyB,GACxCpgE,iBAAmB,MAAO,MAAQ,CAElC2sC,WACI9zC,KAAKwiB,QAAU9d,EANX,8DAQJ9B,MAAMkxC,UACV,GP4CA,OQnCW,cAA+ByzB,GAC1CpgE,iBAAmB,MAAO,QAAU,CAEpC2sC,WACI9zC,KAAKwiB,QAAU9d,EArBX,2rBAsBJ1E,KAAKohF,sBAAwBphF,KAAKwiB,QAAQjW,KAAK,4BAC/CvM,KAAKqhF,yBAA2BrhF,KAAKwiB,QAAQjW,KAAK,+BAElD3J,MAAMkxC,UACV,CAEAz0C,gBAAgBiE,GACZtD,KAAKwiB,QAAQ2kB,OACbnnC,KAAKohF,sBAAsB1+D,aAEIpO,GAAA,EAAAA,OAAqBhR,EAAMtD,KAAKqhF,2BAG3DrhF,KAAKohF,sBAAsBj6C,MAEnC,CAEAqN,UACIx0C,KAAKqhF,yBAAyB1+D,OAClC,CAEA2+D,wBACQthF,KAAKd,YAAY6J,YACjB/I,KAAK80C,SAEb,CAEAz1C,sCAAqC,QAAC6K,EAAO,MAAEzK,IACtCO,KAAKy0C,cAAch1C,WAIlBO,KAAKkW,YAEXhM,EAAQlK,KAAKqhF,0BACjB,GRJA,YzCmBW,cAAoC9Z,GAC/CpgE,iBAAmB,MAAO,aAAe,CAEzC2sC,WACI9zC,KAAKwiB,QAAU9d,EAbX,iLAcJ1E,KAAKuhF,sBAAwBvhF,KAAKwiB,QAAQjW,KAAK,2BAE/CvM,KAAKwhF,QAAU,KACfxhF,KAAKyhF,gBAAkB,KAEvBzhF,KAAK+gB,UAAY,KACjB/gB,KAAK0hF,WAAa,KAElB1hF,KAAK2hF,oBAAsB3hF,KAAKwiB,QAAQjW,KAAK,yBAC7CvM,KAAK2hF,oBAAoBptE,GAAG,SAAS8C,IACjC,GAAIrX,KAAKwqB,UAAW,CAChB,IAAI,EAAC9G,EAAC,EAAEF,GAAKxjB,KAAK4hF,iBAAiBvqE,GAGnCqM,GAAK,GACLF,GAAK,GAELxjB,KAAK6hF,cAAc7hF,KAAKwqB,UAAUjrB,OAAQS,KAAKwqB,UAAUlgB,MAAOoZ,EAAGF,GAEnExjB,KAAKwhF,QAAQ3oE,MAAMvM,KAAK,CAAE/M,OAAQS,KAAKwqB,UAAUjrB,OAAQmkB,IAAGF,MAE5DxjB,KAAK8hF,WAEL9hF,KAAKwqB,UAAY,IACrB,CAEA,OAAO,CAAI,IAGfxqB,KAAKuhF,sBAAsBxuE,KAAK,KAAM,0BAA6Bw2D,MACnEvpE,KAAKuhF,sBAAsBhtE,GAAG,cAAe,aAAa7L,IACtD,SAAiB,CACbgb,EAAGhb,EAAEic,MACLnB,EAAG9a,EAAEkc,MACL/B,MAAO,CACH,CAACvY,MAAO,WAAYua,QAAS,eAAgBZ,OAAQ,eACrD,CAAC3Z,MAAO,OAAQua,QAAS,SAAUZ,OAAQ,eAC3C,CAAC3Z,MAAO,OAAQua,QAAS,YAAaZ,OAAQ,iBAElDM,sBAAuB,EAAEM,aAAa7kB,KAAK+hF,mBAAmBl9D,EAASnc,EAAEiK,WAGtE,KAGX3S,KAAKwqB,UAAY,KAEjBxqB,KAAKwiB,QAAQjO,GAAG,QAAQkqD,GAAMz+D,KAAKgiF,+BAA+BvjB,KAClEz+D,KAAKwiB,QAAQjO,GAAG,YAAYkqD,GAAMA,EAAGhoC,mBAErCz2B,KAAKkW,YAAc,IAAIjM,SAAQ5K,gBACrB,oBAA6B,mBAEnC4iF,QAAQC,MAAM73E,EAAI,IAGtBzH,MAAMkxC,UACV,CAEAz0C,yBAAyBwlB,EAASs9D,GAC9B,MAAMC,EAAW19E,EAAEy9E,GAAgBztE,QAAQ,aACrC4gC,EAAS8sC,EAAS71E,KAAK,YACvBhN,EAASS,KAAKqiF,WAAWD,EAASztE,KAAK,OAE7C,GAAgB,iBAAZkQ,EACA,iDAAkDtlB,QAEjD,GAAgB,WAAZslB,EAAsB,CAC3B,MAAMiO,QAAe8N,EAAA,+BAA2C0U,EAAO/vB,QAEvE,IAAKuN,EAAO5D,UACR,OAKJ,GAFAlvB,KAAKyhF,gBAAgBznD,OAAOh6B,KAAKsiF,WAAW/iF,IAExCuzB,EAAOyvD,oBAAqB,CAC5B,MAAM97D,EAASxlB,EAAA,qBAAmB,UAE5BsC,EAAA,SAAc,SAAShE,YAAiBknB,cAClD,CAEAzmB,KAAKwhF,QAAQ3oE,MAAQ7Y,KAAKwhF,QAAQ3oE,MAAMjN,QAAOtI,GAAQA,EAAK/D,SAAWA,IAEvES,KAAK+gB,UAAY/gB,KAAK+gB,UAAUnV,QAAOoR,GAAYA,EAAS2xD,eAAiBpvE,GAAUyd,EAAS5O,eAAiB7O,IAEjHS,KAAK8hF,UACT,MACK,GAAgB,cAAZj9D,EAAyB,CAC9B,MAAMva,QAAcs2B,EAAA,SAAqB,CACrCt2B,MAAO,QACPoC,QAAS,YACT0qE,aAAc9hC,EAAO/vB,SAGzB,IAAKjb,EACD,aAGE/G,EAAA,MAAW,SAAShE,UAAgB,CAAE+K,UAE5CgrC,EAAO/vB,KAAKjb,EAChB,CACJ,CAEAjL,oBACIW,KAAKwhF,QAAU,CACX3oE,MAAO,GAKP4vC,UAAW,CACP/kC,EAAG,EACHF,EAAG,EACHg/D,MAAO,IAIf,MAAMn5E,QAAarJ,KAAKsD,KAAKgG,UAE7B,GAAID,EAAK7F,QACL,IACIxD,KAAKwhF,QAAU11E,KAAK0P,MAAMnS,EAAK7F,QACnC,CAAE,MAAOkF,GACLuM,QAAQY,IAAI,4BAA6BnN,EAC7C,CAER,CAEA45E,WAAW/iF,GACP,MAAO,gBAAgBA,GAC3B,CAEA8iF,WAAW/7D,GACP,OAAOA,EAAG0P,OAAO,GACrB,CAEA32B,gBAAgBiE,SACNtD,KAAKyiF,cAEXziF,KAAK0iF,sBAEL1iF,KAAK2iF,cAEL3iF,KAAK+sE,uBACT,CAEA6V,WAGI5iF,KAAKyhF,gBAAgBoB,sBAGrB7iF,KAAKuhF,sBAAsB5+D,OAC/B,CAEAtjB,8BACI,MAAM8S,EAAUnS,KAAKwhF,QAAQ3oE,MAAMlN,KAAIrI,GAAQA,EAAK/D,SAC9C2S,QAAa3O,EAAA,OAAY,eAAgB,CAAC4O,UAAS2wE,kBAAmB9iF,KAAKT,SAEjFS,KAAK+gB,UAAY,GAEjB,IAAK,MAAM/D,KAAY9K,EAAK6O,UAAW,CACnC,MAAMmV,EAAQl2B,KAAK+gB,UAAUxU,MAAK0U,GAC9BA,EAAI3N,OAASpB,EAAK6wE,iBAAiB/lE,EAAS1J,QACvC2N,EAAI0tD,eAAiB3xD,EAAS2xD,cAAgB1tD,EAAI7S,eAAiB4O,EAAS5O,cAC7E6S,EAAI0tD,eAAiB3xD,EAAS5O,cAAgB6S,EAAI7S,eAAiB4O,EAAS2xD,gBAEhFz4C,GACAA,EAAMzyB,KAAOuZ,EAASvZ,KAAOuZ,EAAS1J,OAASpB,EAAK6wE,iBAAiB/lE,EAAS1J,MAAQ,gBAAkB,UACxG0J,EAAS1I,QAAS,IAElB0I,EAASvZ,KAAO,iBAChBuZ,EAAS1I,QAAS,GAGtBtU,KAAK+gB,UAAUzU,KAAK0Q,EACxB,CAEAhd,KAAKwhF,QAAQ3oE,MAAQ7Y,KAAKwhF,QAAQ3oE,MAAMjN,QAAOtI,GAAQA,EAAK/D,UAAU2S,EAAK8wE,aAE3EhjF,KAAKyhF,gBAAgBwB,OAAM5jF,UACvBW,KAAK4iF,WAEL,IAAK,MAAMt/E,KAAQtD,KAAKwhF,QAAQ3oE,MAAO,CACnC,MAAMvO,EAAQ4H,EAAK8wE,WAAW1/E,EAAK/D,cAE7BS,KAAK6hF,cAAcv+E,EAAK/D,OAAQ+K,EAAOhH,EAAKogB,EAAGpgB,EAAKkgB,EAC9D,CAEA,IAAK,MAAMxG,KAAYhd,KAAK+gB,UAAW,CACnC,IAAK/D,EAAS1I,OACV,SAGJ,MAAM4uE,EAAaljF,KAAKyhF,gBAAgB0B,QAAQ,CAC5CnoC,OAAQh7C,KAAKsiF,WAAWtlE,EAAS2xD,cACjCh8D,OAAQ3S,KAAKsiF,WAAWtlE,EAAS5O,cACjC3K,KAAMuZ,EAASvZ,OAGnBy/E,EAAW58D,GAAKtJ,EAAS7J,YAEH,YAAlB6J,EAASvZ,MACTy/E,EAAWE,WAAW,gBAAgBrkC,SAAS/hC,EAAS1J,MACxD4vE,EAAWE,WAAW,gBAAgBrkC,SAAS7sC,EAAK6wE,iBAAiB/lE,EAAS1J,QAG9E4vE,EAAWE,WAAW,SAASrkC,SAAS/hC,EAAS1J,MAGrD4vE,EAAWG,OAAOpsC,aAAa,qBAAsBisC,EAAW58D,GACpE,IAER,CAEAq8D,cACQ3iF,KAAK0hF,aAIT1hF,KAAK0hF,WAAa4B,QAAQtjF,KAAKuhF,sBAAsB,GAAI,CACrDtV,QAAS,EACTsX,QAAS,GACTC,cAAc,EACdC,UAAW,SAAS/6E,EAAGg7E,EAAIC,EAAIC,GAG3B,OAAOl7E,EAAE0qD,MACb,IAGJpzD,KAAK0hF,WAAWntE,GAAG,aAAa,KAC5BvU,KAAKyhF,gBAAgBoC,QAAQ7jF,KAAK8jF,WAElC9jF,KAAK+jF,sBAAsB,IAG3B/jF,KAAKwhF,QAAQ/4B,WACbzoD,KAAK0hF,WAAWsC,OAAO,EAAG,EAAGhkF,KAAKwhF,QAAQ/4B,UAAU+5B,OAEpDxiF,KAAK0hF,WAAWuC,OAAOjkF,KAAKwhF,QAAQ/4B,UAAU/kC,EAAG1jB,KAAKwhF,QAAQ/4B,UAAUjlC,IAIxExjB,KAAK0hF,WAAWuC,OAAO,EAAG,GAElC,CAEAF,uBACI,MAAMG,EAAelkF,KAAK0hF,WAAWyC,eAEjCr4E,KAAKC,UAAUm4E,KAAkBp4E,KAAKC,UAAU/L,KAAKwhF,QAAQ/4B,aAE7DzoD,KAAKwhF,QAAQ/4B,UAAY38C,KAAK0P,MAAM1P,KAAKC,UAAUm4E,IAEnDlkF,KAAK8hF,WAEb,CAEAttC,UACQx0C,KAAKyhF,iBACLzhF,KAAK4iF,WAGL5iF,KAAK0hF,aACL1hF,KAAK0hF,WAAW0C,UAChBpkF,KAAK0hF,WAAa,KAE1B,CAEAgB,sBACQ1iF,KAAKyhF,gBACLzhF,KAAKw0C,WAKTx0C,KAAKyhF,gBAAkBQ,QAAQoC,YAAY,CACvCC,SAAU,CAAC,MAAO,CAACC,OAAQ,IAC3BC,UAAW,eACXC,mBAAoBvb,GACpBwb,gBAAiB,CAAEC,OAAQ,OAAQC,YAAa,GAChDpnC,UAAWx9C,KAAKuhF,sBAAsBxuE,KAAK,QAG/C/S,KAAKyhF,gBAAgBoD,uBAAuB,iBAAkB,CAAEC,OAAO,aAAcC,UAAU,eAAgBC,SAAU9b,KAEzHlpE,KAAKyhF,gBAAgBoD,uBAAuB,gBAAiB,CAAEC,OAAO,aAAcC,UAAU,eAAgBC,SAAU5b,KAExHppE,KAAKyhF,gBAAgBoD,uBAAuB,UAAW,CAAEC,OAAO,aAAcC,UAAU,eAAgBC,SAAU3b,KAElHrpE,KAAKyhF,gBAAgBoD,uBAAuB,OAAQ,CAAEC,OAAO,aAAcC,UAAU,eAAgBC,SAAU1b,KAE/GtpE,KAAKyhF,gBAAgBj8C,KAAK,cAAc,CAACxW,EAAM0vC,IAAkB1+D,KAAKilF,yBAAyBj2D,EAAM0vC,KACzG,CAEAr/D,+BAA+B2vB,EAAM0vC,GACjC,MAAMwkB,EAAal0D,EAAKk0D,WAoCxB,GAlCAA,EAAW19C,KAAK,eAAe,CAAClwB,EAAK+B,KAC7B6rE,EAAW1b,UAAUr+D,SAAS,QAG9BkO,EAAMof,kBAGNpf,EAAMof,iBACNpf,EAAM+M,kBAEN,SAAiB,CACbV,EAAGrM,EAAMsN,MACTnB,EAAGnM,EAAMuN,MACT/B,MAAO,CAAE,CAACvY,MAAO,OAAQua,QAAS,SAAUZ,OAAQ,gBACpDM,sBAAuBllB,OAAQwlB,cAC3B,GAAgB,WAAZA,EAAsB,CACtB,UAAW+b,EAAA,UAAsB,eAC7B,OAGJ,MAAM5jB,EAAWhd,KAAK+gB,UAAUxU,MAAK0U,GAAOA,EAAI9N,cAAgB+vE,EAAW58D,WAErE/iB,EAAA,SAAc,SAASyZ,EAAS2xD,0BAA0B3xD,EAAS1J,WAAW0J,EAAS5O,gBAE7FpO,KAAKyhF,gBAAgByD,iBAAiBhC,GAEtCljF,KAAK+gB,UAAY/gB,KAAK+gB,UAAUnV,QAAOoR,GAAYA,EAAS7J,cAAgB+vE,EAAW58D,IAC3F,KAGZ,KAICo4C,EACD,OAGJ,IAAIprD,QAAastB,EAAA,SAAqB,CAClCl0B,QAAS,gCACTy4E,MAAO,EAAGC,cACNA,EAAQ7wE,GAAG,SAAS,KAEhB,MAAMusD,EAAW7/D,EAAA,4BAA0BmkF,EAAQhgE,OAEnDggE,EAAQhgE,IAAI07C,EAAS,IAGzB,EAA2D,CACvDlsD,IAAKwwE,EACLvnB,cAAe,WACf33D,MAAM,GACR,IAIV,IAAKoN,IAASA,EAAK0G,OAGf,YAFAha,KAAKyhF,gBAAgByD,iBAAiBhC,GAK1C5vE,EAAOrS,EAAA,4BAA0BqS,GAEjC,MAAMlF,EAAepO,KAAKqiF,WAAWa,EAAWvwE,OAAO2T,IACjDqoD,EAAe3uE,KAAKqiF,WAAWa,EAAWloC,OAAO10B,IAOvD,GALuBtmB,KAAK+gB,UAAUxC,MAAK0C,GACvCA,EAAI7S,eAAiBA,GAClB6S,EAAI0tD,eAAiBA,GACrB1tD,EAAI3N,OAASA,IAOhB,aAJMstB,EAAA,OAAmB,eAAettB,+CAExCtT,KAAKyhF,gBAAgByD,iBAAiBhC,SAKpC3/E,EAAA,MAAW,SAASorE,eAA0Br7D,QAAWlF,KAE/DpO,KAAK+sE,uBACT,CAEA+U,WACI9hF,KAAKs9D,aAAaxwD,gBACtB,CAEAzN,oBAAoBE,EAAQ+K,EAAOoZ,EAAGF,GAClC,MAAMU,QAAc,eAAuB3kB,EAAQ,CAAC+K,UACpD4Z,EAAMq/B,WAAU76C,GAAK,aAAqBA,KAE1C,MAAMpF,QAAazD,EAAA,gBAAcN,GAE3B6iF,EAAW19E,EAAE,SACdmf,SAAS,YACTA,SAASvgB,EAAKse,eACdjN,KAAK,KAAM3U,KAAKsiF,WAAW/iF,IAC3BoF,OAAOD,EAAE,UAAUmf,SAAS,SAASlf,OAAOuf,IAC5Cvf,OAAOD,EAAE,SAASmf,SAAS,YAAY9Q,KAAK,QAAS,qBACrD4Q,IAAI,OAAQ,GAAGD,OACfC,IAAI,MAAO,GAAGH,OAEnBxjB,KAAKyhF,gBAAgB14B,eAAenR,YAAYwqC,EAAS,IAEzDpiF,KAAKyhF,gBAAgB4D,UAAUjD,EAAS,GAAI,CACxCpwC,MAAOnpB,MACPy8D,KAAMz8D,MACN47C,KAAM57C,IACF,MAAMtpB,EAASS,KAAKqiF,WAAWx5D,EAAOzT,GAAGkR,IAEnChjB,EAAOtD,KAAKwhF,QAAQ3oE,MAAMtM,MAAKjJ,GAAQA,EAAK/D,SAAWA,IAExD+D,IAKJA,EAAKogB,EAAGpgB,EAAKkgB,GAAKqF,EAAO08D,SAE1BvlF,KAAK8hF,YANDl5E,SAAS,MAAMrJ,SAMJ,IAIvBS,KAAKyhF,gBAAgB+D,WAAWpD,EAAS,GAAI,CACzCx2E,OAAQ,YACRk5E,OAAQ,aACRW,eAAgB,CAAEd,OAAQ,OAAQC,YAAa,GAC/Cc,eAAgB,QAChBC,QAAQ,CACJ,OAAU,gBAIlB3lF,KAAKyhF,gBAAgBmE,WAAWxD,EAAS,GAAI,CACzCyD,YAAa,CAAEC,WAAY,aAC3BhB,OAAQ,aACRiB,eAAe,GAEvB,CAEAjC,UACI,MAEMr7B,EAAYzoD,KAAKuhF,sBAAsB59D,IAAI,aAEjD,GAAkB,SAAd8kC,EACA,OAAO,EAGX,MAAMu9B,EAAUv9B,EAAUvyB,MARN,kFAUpB,IAAK8vD,EACD,MAAM,IAAIx4E,MAAM,2BAA2Bi7C,KAG/C,OAAOu9B,EAAQ,EACnB,CAEA3mF,qCAAqCo/D,GACjCA,EAAGhoC,iBAEH,MAAM5d,EAAQ/M,KAAK0P,MAAMijD,EAAGC,cAAc1K,aAAaa,QAAQ,SAE/D,IAAI,EAACnxC,EAAC,EAAEF,GAAKxjB,KAAK4hF,iBAAiBnjB,GAEnC,IAAK,MAAMn7D,KAAQuV,EACA7Y,KAAKwhF,QAAQ3oE,MAAM0F,MAAKihC,GAAKA,EAAEjgD,SAAW+D,EAAK/D,SAG1D,oBAAuB,OAAO+D,EAAKgH,kBAKvCtK,KAAKwhF,QAAQ3oE,MAAMvM,KAAK,CAAC/M,OAAQ+D,EAAK/D,OAAQmkB,IAAGF,MAE7CE,EAAI,KACJF,GAAK,IACLE,EAAI,GAGJA,GAAK,KAIb1jB,KAAK8hF,WAEL9hF,KAAK+sE,uBACT,CAEA6U,iBAAiBtrD,GACb,MAAMytC,EAAO/jE,KAAKuhF,sBAAsB,GAAGv4B,wBAErC90C,EAAOlU,KAAK8jF,UAElB,MAAO,CACHpgE,GAAI4S,EAAI2vD,QAAUliB,EAAKxgD,MAAQrP,EAC/BsP,GAAI8S,EAAI4vD,QAAUniB,EAAKzgD,KAAOpP,EAEtC,CAEA2gD,UACI,MAAO,CACHrxD,QAASsI,KAAKC,UAAU/L,KAAKwhF,SAErC,CAEAniF,uCAAsC,MAACI,IACnC,IAAKO,KAAKy0C,cAAch1C,GACpB,OAGJ,MAAM6K,QAAcs2B,EAAA,SAAqB,CAAEl0B,QAAS,WAAa0qE,aAAc,SAE/E,IAAK9sE,EAAM0P,OACP,OAGJ,MAAM,KAAC1W,SAAcC,EAAA,OAAY,SAASvD,KAAKT,8BAA+B,CAC1E+K,QACA9G,QAAS,GACTC,KAAM,SAGV,sBAAyB,gBAEzBzD,KAAKwqB,UAAY,CAAEjrB,OAAQ+D,EAAK/D,OAAQ+K,QAC5C,CAEA67E,8BAA6B,MAAC1mF,IACrBO,KAAKy0C,cAAch1C,KAKxBO,KAAK0hF,WAAWsC,OAAO,EAAG,EAAG,EAAIhkF,KAAK8jF,WACtC9jF,KAAK0hF,WAAWuC,OAAO,EAAG,GAC9B,CAEAmC,6BAA4B,MAAC3mF,IACpBO,KAAKy0C,cAAch1C,IAIxBO,KAAK0hF,WAAWsC,OAAO,EAAG,EAAG,IACjC,CAEAqC,8BAA6B,MAAC5mF,IACrBO,KAAKy0C,cAAch1C,IAIxBO,KAAK0hF,WAAWsC,OAAO,EAAG,EAAG,GACjC,GyCnkBA,OvC0CW,cAAmCzc,GAC9C5kE,cACIC,QAGA5C,KAAKsmF,uBAAyB,EAC9BtmF,KAAKumF,qBAAuB,EAG5BvmF,KAAKwmF,8BAAgC,IAErC/kF,OAAOglF,sBAAwB,GAAGhlF,OAAOqE,SAAS4gF,mDAGlD1mF,KAAK4/B,cAAgB,GACrB5/B,KAAK2mF,oBAAsB3mF,KAAKsmF,sBAGhCtmF,KAAK4mF,cACL5mF,KAAK6mF,QACL7mF,KAAKwiB,QACLxiB,KAAK8mF,cAGL9mF,KAAK+mF,yBAA2B/mF,KAAK+mF,yBAAyBvhD,KAAKxlC,MACnEA,KAAKgnF,gBAAkBhnF,KAAKgnF,gBAAgBxhD,KAAKxlC,MACjDA,KAAKinF,kBAAoBjnF,KAAKinF,kBAAkBzhD,KAAKxlC,MAErDA,KAAKknF,gBAAiB,CAC1B,CAEA//E,iBACI,MAAO,QACX,CAEA2sC,WACI9zC,KAAKwiB,QAAU9d,EA/HX,ujDAgIJ1E,KAAKwiB,QAAQgjB,KAAK,6BAA6BnuB,IAC3C,GAAIA,EAAMC,QAGN,OAFAD,EAAMof,iBACNpf,EAAM+M,mBACC,CACX,IAGJpkB,KAAKwiB,QAAQyxB,YAAY,eAAe,GACxCj0C,KAAK6mF,QAAU7mF,KAAKwiB,QAAQjW,KAAK,kBACjC,MAAM+9D,EAAgB7oE,OAAO6rB,iBAAiB7b,SAASuR,iBAcvD,OAbAhjB,KAAKuqE,WAAaD,EAAc/8C,iBAAiB,kBAAkBvT,OAEnE,oBACoB,iBACfhP,MAAK,KACF,MAAMm8E,EAAQ1lF,OAAO0lF,MACfC,EAAW3lF,OAAO2lF,SAClBC,EAAgBrnF,KAAK6mF,QAAQp9D,IAAI,GAEvC29D,EAASE,uBAAuBD,GAChCD,EAAS9yE,OAAO6yE,EAAMpwC,cAAc/2C,KAAK+mF,0BAA2BM,EAAc,IAGnFrnF,KAAKwiB,OAChB,CAOAnjB,gBAAgBiE,GAEQtD,KAAK4/B,gBAAkBt8B,EAAK/D,SAG5CS,KAAK2mF,oBAAsB3mF,KAAKsmF,uBAEpCtmF,KAAK4/B,cAAgBt8B,EAAK/D,OAG1B,MAAM8J,QAAa/F,EAAKgG,UAGxB,MAAQtJ,KAAK4mF,eAAej8E,SACxBsK,QAAQY,IAAI,sDACNk3B,GAAM,KAShB,GAAK1jC,EAAK7F,SAASwW,QAWd,GAAI3Q,EAAK7F,QAAS,CAEnB,IAAIA,EAEJ,IACIA,EAAU6F,EAAKkmB,gBACnB,CAAE,MAAM8L,GACJpmB,QAAQxO,MAAM,gFAAiFnD,EAAM+F,EAAMgyB,GAE3G73B,EAAU,CACN+jF,SAAU,GACVr1D,MAAO,GACPs1D,SAAU,CAAC,EAEnB,CAEA,MAAM,SAACD,EAAQ,MAAEr1D,EAAK,SAAEs1D,EAAW,CAAC,GAAKhkF,EAEzCgkF,EAAS55D,MAAQ5tB,KAAKuqE,WAEtB,MAAMkd,EAAqBznF,KAAK0nF,qBAAqB/8E,QAAQq+C,wBAC7Dw+B,EAASrnC,MAAQsnC,EAAmBtnC,MACpCqnC,EAAS9mC,OAAS+mC,EAAmB/mC,OACrC8mC,EAAS92B,WAAa+2B,EAAmBlkE,KACzCikE,EAAS/2B,UAAYg3B,EAAmBnkE,IAExC,MAAMqkE,EAAY,CACdJ,WACAC,WACAI,cAAe,IAMbC,EAAY,GAClB,IAAK,MAAMC,KAAU51D,EAAO,CACxB,MAAMC,EAAOD,EAAM41D,GAKnBD,EAAUv7E,KAAK6lB,EACnB,CAEAnyB,KAAK4mF,cAAcj8E,QAAQo9E,YAAYJ,GACvC3nF,KAAK4mF,cAAcj8E,QAAQq9E,SAASH,GACpC7nF,KAAK4mF,cAAcj8E,QAAQrF,QAAQ2kE,OACvC,MA3D2B,CACvB,MAAM0d,EAAY,CACdJ,SAAU,GACVC,SAAU,CACN55D,MAAO5tB,KAAKuqE,YAEhBqd,cAAe,IAGnB5nF,KAAK4mF,cAAcj8E,QAAQo9E,YAAYJ,EAC3C,CAmDA19E,QAAQwM,WACGnT,EAAK2kF,qBAAqB,sBAC5Bt8E,KAAInB,GAAcA,EAAWlB,aACpC0B,MAAKk9E,IACH,GAAI5kF,EAAK/D,SAAWS,KAAK4/B,cAErB,OAGJ,MAAMuoD,EAAeD,EAAMv8E,KAAItC,GAAQA,EAAKmmB,yBAAwB5jB,QAAOmY,KAAUA,IACrF/jB,KAAK4mF,cAAcj8E,QAAQy9E,cAAc,CAACD,eAAcE,OAAO,GAAO,IAItEroF,KAAK2mF,sBAAwB3mF,KAAKsmF,wBAClCtmF,KAAK2mF,oBAAsB3mF,KAAKsoF,kBAExC,CAMAjpF,gBACI,MAAMkoF,EAAWvnF,KAAK4mF,cAAcj8E,QAAQ49E,mBACtCf,EAAWxnF,KAAK4mF,cAAcj8E,QAAQ69E,cAMtCt2D,EAAQlyB,KAAK4mF,cAAcj8E,QAAQ89E,WAUnCC,SAPYjnF,OAAOknF,cAAcC,YAAY,CAC/CrB,WACAC,WACAqB,cAAe,EACfC,SAAU,iBACV52D,WAEkBvH,UAEhBo+D,EAAc,CAAC,EACrBxB,EAASr3E,SAASm3C,IACVA,EAAQygC,SACRiB,EAAY1hC,EAAQygC,QAAU51D,EAAMm1B,EAAQygC,QAChD,IAGJ,MAAMtkF,EAAU,CACZC,KAAM,aACNulF,QAAS,EACTzB,WACAr1D,MAAO62D,EACPvB,SAAU,CACNyB,QAASzB,EAASyB,QAClBC,QAAS1B,EAAS0B,QAClBh1E,KAAMszE,EAAStzE,OAIjByE,EAAc,CAChB,CAAEJ,KAAM,QAASjO,MAAO,oBAAqBnK,KAAM,gBAAiBqD,QAASklF,EAAWx5E,SAAU,IAGtG,GAAIlP,KAAKknF,eAAgB,CAIrB,MAAMiB,QAAqBnoF,KAAK4mF,cAAcj8E,QAAQy9E,cAAc,CAACC,OAAO,IAE5E,IAAIn5E,EAAW,GAEf,IAAK,MAAMi6E,KAAehB,EACtBxvE,EAAYrM,KAAK,CACbiM,KAAM,oBACNjO,MAAO6+E,EAAY7iE,GACnBnmB,KAAM,mBACNqD,QAASsI,KAAKC,UAAUo9E,GACxBj6E,SAAUA,IAGdA,GAAY,EAEpB,CAEA,MAAO,CACH1L,QAASsI,KAAKC,UAAUvI,GACxBmV,cAER,CAMAmpE,WACI9hF,KAAKs9D,aAAaxwD,gBACtB,CAEAs8E,YACIppF,KAAKknF,gBAAiB,CAC1B,CAEAF,kBAGI,MAAMC,EAAoBjnF,KAAKinF,oBAOzBoC,EAAoBrpF,KAAK2mF,sBAAwB3mF,KAAKsmF,sBAEzCW,GAAqBoC,IAGpCrpF,KAAKspF,qBACLtpF,KAAK8hF,WAEb,CAEAiF,2BACI,MAAMI,EAAQ1lF,OAAO0lF,OACf,WAAEoC,GAAe9nF,OAAOknF,cAExB/B,EAAgBO,EAAMqC,OAAO,MACnCxpF,KAAK4mF,cAAgBA,EACrB,MAAMc,EAAuBP,EAAMqC,OAAO,MAC1CxpF,KAAK0nF,qBAAuBA,EAC5B,MAAO+B,EAAYhf,GAAiB0c,EAAMuC,SAAS,CAC/CvpC,WAAOx4C,EACP+4C,YAAQ/4C,IAGZw/E,EAAMwC,WAAU,KACZ,MAAMF,EAAa,CACftpC,MAAOunC,EAAqB/8E,QAAQq+C,wBAAwB7I,MAC5DO,OAAQgnC,EAAqB/8E,QAAQq+C,wBAAwBtI,QAEjE+pB,EAAcgf,GAEd,MAAMG,EAAW,KACb,GAAwB,WAApB5pF,KAAKsD,MAAMG,KACX,OAGJ,MAAMgmF,EAAa,CACftpC,MAAOunC,EAAqB/8E,QAAQq+C,wBAAwB7I,MAC5DO,OAAQgnC,EAAqB/8E,QAAQq+C,wBAAwBtI,QAEjE+pB,EAAcgf,EAAW,EAK7B,OAFAhoF,OAAO2V,iBAAiB,SAAUwyE,GAE3B,IAAMnoF,OAAOmiD,oBAAoB,SAAUgmC,EAAS,GAC5D,CAAClC,IAEJ,MAAMmC,EAAa1C,EAAM2C,aAAY,CAACziC,EAAShwC,KAC3C,IAAI0iC,EAAOsN,EAAQtN,KAEfA,EAAK7xC,WAAW,WAChB6xC,EAAO,IAAMA,GAGjB,MAAM,YAAEgwC,GAAgB1yE,EAAM2yE,OAI9B,OAFA3yE,EAAMof,iBAEC,gBAAwBszD,EAAahwC,EAAM,KAAK,GACtD,IAEL,OAAOotC,EAAMpwC,cACTowC,EAAM8C,SACN,KACA9C,EAAMpwC,cACF,MACA,CACI78B,UAAW,qBACXgwE,IAAKxC,GAETP,EAAMpwC,cAAcwyC,EAAY,CAE5B37D,MAAO5tB,KAAKuqE,WACZ2f,IAAKtD,EACLuD,SAAU,QACVhqC,MAAOspC,EAAWtpC,MAClBO,OAAQ+oC,EAAW/oC,OACnB0pC,QAAS,CAACl4E,EAAMmF,KACZpC,QAAQY,IAAI,qEAAsE3D,EAAMmF,EAAM,EAElGgzE,gBAAiB,KACbrqF,KAAKknF,gBAAiB,EAEtBlnF,KAAK8hF,UAAU,EAEnBwI,SAAU,GAAStqF,KAAKgnF,gBAAiBhnF,KAAKwmF,+BAC9C+D,iBAAiB,EACjBC,gBAAgB,EAChBC,iBAAiB,EACjBC,iBAAiB,EACjBC,cAAc,EACdC,wBAAwB,EACxBC,WAAW,EACXhB,aACAiB,UAAW,CACPC,kBAAkB,EAClBC,aAAa,MAKjC,CASC/D,oBACG,MAAMgE,EAAejrF,KAAKsoF,kBAE1B,OAAOtoF,KAAK2mF,sBAAwB3mF,KAAKsmF,uBAClCtmF,KAAK2mF,sBAAwBsE,CACxC,CAEA3C,kBACI,GAAItoF,KAAK4mF,cAAe,CACpB,MAAMW,EAAWvnF,KAAK4mF,cAAcj8E,QAAQ49E,mBAC5C,OAAO9mF,OAAOknF,cAAcL,gBAAgBf,EAChD,CACI,OAAOvnF,KAAKumF,mBAEpB,CAEA+C,qBACItpF,KAAK2mF,oBAAsB3mF,KAAKsoF,iBACpC,GuCtbA,iBSpCW,cAAyC/gB,GACpDpgE,iBAAmB,MAAO,kBAAoB,CAE9C2sC,WACI9zC,KAAKwiB,QAAU9d,EAvBX,6mBAwBJ1E,KAAKkrF,cAAgBlrF,KAAKwiB,QAAQjW,KAAK,oCACvCvM,KAAKmrF,eAAiBnrF,KAAKwiB,QAAQjW,KAAK,+BAExCvM,KAAKkrF,cAAc32E,GAAG,UAAU,KAC5B,MAAM4pB,EAAWn+B,KAAKmrF,eAAe/lE,MAKrC,OAJAplB,KAAKmrF,eAAe/lE,IAAI,IAExB,0BAA8C+Y,IAEvC,CAAK,IAGhBv7B,MAAMkxC,UACV,GTmBA,KUxCW,cAA6ByzB,GACxCpgE,iBAAmB,MAAO,MAAQ,CAElC2sC,WACI9zC,KAAKwiB,QAAU9d,EArBX,6hBAsBJ1E,KAAKorF,gBAAkBprF,KAAKwiB,QAAQjW,KAAK,gCAEzC3J,MAAMkxC,UACV,CAEAz0C,gBAAgBiE,GACZtD,KAAKorF,gBAAgBj+D,QAAQntB,KAAKsD,KAAKwG,cAC3C,GV6BA,QWvDW,cAAgCy9D,GAC3CpgE,iBAAmB,MAAO,SAAW,CAErCxE,cACIC,QAEA5C,KAAKqrF,cAAgB,IAAIjhB,GAAc,QACvCpqE,KAAKmO,MAAMnO,KAAKqrF,cACpB,CAEAv3C,WACI9zC,KAAKwiB,QAAU9d,EAbX,kEAcJ1E,KAAKwiB,QAAQ7d,OAAO3E,KAAKqrF,cAAc/2E,UAEvC1R,MAAMkxC,UACV,CAEAz0C,gBAAgBiE,SACNtD,KAAKqrF,cAAcv2C,SAC7B,GXqCA,QYzCW,cAAgCyyB,GAC3CpgE,iBAAmB,MAAO,SAAW,CAErC2sC,WACI9zC,KAAKwiB,QAAU9d,EArBX,4iBAsBJ1E,KAAKsrF,uBAAyBtrF,KAAKwiB,QAAQjW,KAAK,8BAChDvM,KAAKurF,0BAA4BvrF,KAAKwiB,QAAQjW,KAAK,iCAEnD9K,OAAO2V,iBAAiB,UAAU,IAAMpX,KAAKyqE,kBAAiB,GAE9D7nE,MAAMkxC,UACV,CAEAz0C,gBAAgBiE,GACZtD,KAAKwiB,QAAQ2kB,OACbnnC,KAAKsrF,uBAAuB5oE,OAC5B1iB,KAAKurF,0BAA0B7oE,OAE/B,MAAM8oE,EAAaxrF,KAAKsD,KAAKic,cAAc,cAEvCisE,EACAxrF,KAAKurF,0BACApkD,OACAp0B,KAAK,MAAOy4E,IAGjBxrF,KAAKurF,0BAA0B7oE,OAC/B1iB,KAAKsrF,uBAAuBnkD,QAGhCnnC,KAAKyqE,gBAEL9hE,YAAW,IAAM3I,KAAKyqE,iBAAiB,IAC3C,CAEAj2B,UACIx0C,KAAKurF,0BAA0Bv/B,gBAAgB,MACnD,CAEAye,gBACI,MAAM3mD,EAAU9jB,KAAKwiB,QAErBxiB,KAAKurF,0BACA7qC,OAAO58B,EAAQ48B,UACfP,MAAMr8B,EAAQq8B,QACvB,CAEAoP,uBAAsB,YAAC9lD,IACfA,EAAY4J,mBAAmB9G,MAAKwG,GAAsB,eAAdA,EAAKO,MAAyB,cAA6BP,EAAM/S,KAAKd,YAAYoE,SAC9HtD,KAAK80C,SAEb,GZTA,Ia3CW,cAA4ByyB,GACvCpgE,iBAAmB,MAAO,KAAO,CAEjC2sC,WACI9zC,KAAKwiB,QAAU9d,EArBX,gdAsBJ1E,KAAK6sB,SAAW7sB,KAAKwiB,QAAQjW,KAAK,4BAElC3J,MAAMkxC,UACV,CAEAz0C,gBAAgBiE,GACZ,MAAMmoF,EAAUnoF,EAAKic,cAAc,WAE/BksE,EACAzrF,KAAK6sB,SAASyP,KAAK,GAAG76B,OAAOmD,KAAK8mF,qBAAqBD,UAEvDzrF,KAAK6sB,SAASlK,OAEtB,Gb0BA,c/BqCW,cAAsC4kD,GACjDpgE,iBAAmB,MAAO,eAAiB,CAE3C2sC,WACI9zC,KAAKwiB,QAAU9d,EArEX,mcAsEJ1E,KAAK6sB,SAAW7sB,KAAKwiB,QAAQjW,KAAK,uCAElC3J,MAAMkxC,UACV,CAEAz0C,gBAAgBiE,GACZtD,KAAK6sB,SAASlK,QACd3iB,KAAKoL,SAAW,GAEhB,MAAMugF,EAAiBhb,GAAgBrtE,EAAK/D,QAE5C,GAAIosF,EACA,IAAK,MAAMt9B,KAASs9B,EAAgB,CAChC,MAAMpiE,EAAS,IAAI8kC,QAEb9kC,EAAO1U,YAAY,iBAAkB,CAAE3V,YAAac,KAAKd,cAC/Dc,KAAKmO,MAAMob,GAEXvpB,KAAK6sB,SAASloB,OAAO4kB,EAAOjV,gBACtBiV,EAAOurB,SACjB,MAEA90C,KAAK6sB,SAASloB,OAAO,uBAAuBrB,EAAK/D,UAEzD,G+BjEA,iBchCW,cAAyCgoE,GACpDpgE,iBACI,MAAO,kBACX,CAEA2sC,WACI9zC,KAAKwiB,QAAU9d,EAhCX,mmBAiCJ1E,KAAKyoE,SAAWzoE,KAAKwiB,QAAQjW,KAAK,uBAClCvM,KAAK4rF,cAAgB5rF,KAAKwiB,QAAQjW,KAAK,kBAEvC3J,MAAMkxC,UACV,CAEAz0C,gBAAgBiE,GACZtD,KAAKyoE,SAAS9lD,QACd3iB,KAAKoL,SAAW,GAEhB,MAAMygF,EAAcnnF,EAAE,uJACtBzD,EAAA,wBAAsB4qF,GAEtB7rF,KAAK4rF,cAAcjpE,QAAQhe,OACvB,eACM,eAAuB3E,KAAKT,QAClC,kBACM,eAAuBS,KAAKT,OAAQ,CACtC+K,MAAO,SACPnL,UAAW,CACP4B,SAAU,iBAGlB8qF,GAGJ,MAAMrhF,QAAmB3K,EAAA,sBAAoBG,KAAKuK,cAAc,GAEhE,IAAKC,EAGD,YAFAxK,KAAKyoE,SAAS9iD,KAAK,6BAKvB,MAAMmmE,EAAyB,IAAIrQ,GAAuBjxE,GAAY,GACtExK,KAAKmO,MAAM29E,GAEX9rF,KAAKyoE,SAAS9jE,OAAOmnF,EAAuBx3E,SAChD,CAEAjV,6BAA4B,YAACoK,IACzB,MAAM8nB,EAAgB9nB,EAAYkmC,oBAAoBpjC,MAAKqQ,GAAOA,EAAIrS,eAAiBvK,KAAKuK,eAExFgnB,GAAe3nB,WACf5J,KAAK80C,SAEb,CAEIvqC,mBACA,OAAOvK,KAAKd,YAAYC,UAAUoL,YACtC,GdxBA,eetCW,cAAuCg9D,GAClDpgE,iBACI,MAAO,gBACX,CAEA2sC,WACI9zC,KAAKwiB,QAAU9d,EA5BX,qhBA6BJ1E,KAAKk0D,MAAQl0D,KAAKwiB,QAAQjW,KAAK,4BAC/BvM,KAAK4rF,cAAgB5rF,KAAKwiB,QAAQjW,KAAK,kBAEvC3J,MAAMkxC,UACV,CAEAz0C,gBAAgBiE,GACZ,MAAMuoF,EAAcnnF,EAAE,uJACtBzD,EAAA,wBAAsB4qF,GAEtB,MAAME,QAAiB,eAAuB/rF,KAAKT,QAEnDS,KAAK4rF,cAAcjpE,QAAQhe,OACvBD,EAAE,SAASC,OACP,SACAonF,GAEJrnF,EAAE,SAASC,OACPD,EAAE,+BACG6gB,KAAK,QACLhR,GAAG,SAAS,IAAMvU,KAAKgI,eAAe,8BAA+B,CAACzI,OAAQS,KAAKT,WACxFssF,IAIR7rF,KAAKk0D,MAAMvxC,QACX3iB,KAAKoL,SAAW,GAChBpL,KAAKgsF,sBAAwB,IAAIlyE,IAEjC,MAAMnB,QAAoBrV,EAAKqZ,iBAE/B,GAA2B,IAAvBhE,EAAYlW,OAMhB,IAAK,MAAM+H,KAAcmO,EAAa,CAClC,MAAMmzE,EAAyB,IAAIrQ,GAAuBjxE,GAAY,GAEtExK,KAAKmO,MAAM29E,GAEX9rF,KAAKgsF,sBAAsB5xE,IAAI5P,EAAWD,cAE1CvK,KAAKk0D,MAAMvvD,OAAOmnF,EAAuBx3E,SAC7C,MAbItU,KAAKk0D,MAAMvuC,KAAK,+CAcxB,CAEAtmB,6BAA4B,YAACoK,IAEAA,EAAYkmC,oBAChCpxB,MAAK3B,IAAQ5c,KAAKgsF,sBAAsB7xE,IAAIyC,EAAIrS,iBAGjDvK,KAAK80C,SAEb,IftBW,MAAMm3C,WAAyB,IAC1CtpF,cACIC,QAEA5C,KAAKksF,YAAc,CAAC,EAEpBlsF,KAAKs9D,aAAe,IAAI,KAAaj+D,UACjC,MAAM,KAACiE,GAAQtD,KAAKd,aACd,OAACK,GAAU+D,EAEX4O,QAAalS,KAAKmsF,gBAAgBt3B,eAG3BltD,IAATuK,IAIJ,qCAAwD5O,SAElDC,EAAA,MAAW,SAAShE,SAAe2S,EAAMlS,KAAK8V,aAEpD9V,KAAKmsF,gBAAgB/C,cAAa,IAGtC,kCAAmCppF,KACvC,CAEA+zC,YACI,OAAO,CACX,CAEAD,WACI9zC,KAAKwiB,QAAU9d,EArEX,iQAsEJ1E,KAAKwzC,cACT,CAEAn0C,gBAII,GAHAW,KAAKyD,WAAazD,KAAKynE,gBACvBznE,KAAKG,KAAOH,KAAKsD,MAAMnD,OAEjBH,KAAKyD,QAAQzD,KAAKksF,aAAc,CAClC,MAAM79B,EAAQ0tB,GAAkB/7E,KAAKyD,MAErC,IAAK4qD,EACD,MAAM,IAAI7gD,MAAM,qCAAqCxN,KAAKyD,SAG9D,MAAM2oF,EAAapsF,KAAKksF,YAAYlsF,KAAKyD,MAAQ,IAAI4qD,EACrD+9B,EAAW9uB,aAAet9D,KAAKs9D,aAC/B8uB,EAAWh2E,UAAUpW,MAErB,MAAMqU,EAAkB+3E,EAAW93E,SACnC,mCAAgDD,GAEhDrU,KAAKwiB,QAAQ7d,OAAO0P,SAEd+3E,EAAWv3E,YAAY,iBAAkB,CAAC3V,YAAac,KAAKd,oBAG5DktF,EAAWv3E,YAAY,eAAgB,CACzC3V,YAAac,KAAKd,YAClBY,SAAUE,KAAKd,YAAYY,WAG/BE,KAAKmO,MAAMi+E,EACf,CAEApsF,KAAKqsF,iBACT,CAKAA,kBAEIrsF,KAAKwiB,QAAQyxB,YAAY,eAEhBj0C,KAAKd,YAAY2K,eACf,CAAC,SAAU,UAAW,WAAWV,SAASnJ,KAAKyD,OACjC,iCAAdzD,KAAKG,MAE+B,gBAAxCH,KAAKd,YAAYC,UAAU4B,SAEtC,CAEAorF,gBACI,IAAKnsF,KAAKksF,YAAYlsF,KAAKyD,MACvB,MAAM,IAAI+J,MAAM,uCAAuCxN,KAAKyD,SAGhE,OAAOzD,KAAKksF,YAAYlsF,KAAKyD,KACjC,CAEApE,sBACI,MAAMiE,EAAOtD,KAAKsD,KAElB,IAAKA,EACD,MAAO,QAGX,IAAIG,EAAOH,EAAKG,KAChB,MAAMtE,EAAYa,KAAKd,YAAYC,UAsBnC,MApB2B,WAAvBA,EAAU4B,SACV0C,EAAO,eACuB,gBAAvBtE,EAAU4B,SACjB0C,EAAOtE,EAAUoL,aAAe,mBAAqB,iBACrC,SAAT9G,SAAyBzD,KAAKd,YAAYu+D,aACjDh6D,EAAO,eACU,SAATA,GAA4B,YAATA,UAA6BzD,KAAKd,YAAYu+D,aAEzD,SAATh6D,EACPA,EAAO,eACS,SAATA,GAA4B,YAATA,EAC1BA,EAAO,eACS,aAATA,IACPA,EAAO,OANPA,EAAO,eASPH,EAAKI,cAAgB,oCACrBD,EAAO,oBAGJA,CACX,CAEApE,0BAAyB,MAACI,IACtB,GAAIO,KAAKd,YAAYO,QAAUA,EAC3B,aAGEO,KAAK80C,UACX,MAAMvrB,EAASvpB,KAAKmsF,sBACd5iE,EAAOrT,YACbqT,EAAO6O,OACX,CAEA/4B,wBAAuB,MAACI,IACpB,GAAIO,KAAKd,YAAYO,QAAUA,EAC3B,aAGEO,KAAK80C,UACX,MAAMvrB,EAASvpB,KAAKmsF,sBACd5iE,EAAOrT,YAETqT,EAAOk0D,aACPl0D,EAAOk0D,aAEf,CAEAp+E,6BAA4B,YAACH,IACrBc,KAAKy0C,cAAcv1C,EAAYO,cACzBO,KAAKs9D,aAAa7sD,sBAEhC,CAEApR,oCAAmC,OAACoP,IAC5BzO,KAAKy0C,cAAchmC,UACbzO,KAAKs9D,aAAa7sD,sBAEhC,CAEApR,2BAA2BwpB,GAMvB,OALI7oB,KAAKy0C,cAAc5rB,EAAOppB,cAEpBO,KAAKs9D,aAAa7sD,6BAGfzQ,KAAKqW,OAAOrO,eAAe,gBAAiB6gB,EAC7D,CAEAxpB,6BACI,IAAKW,KAAKd,YAAY6J,WAClB,aAGE,oBAA6B,iBAEnC,IAAIujF,EAAsB5nF,EAAE,IAExB1E,KAAKsD,KAAK4d,kCAAkCze,OAAS,IACrD6pF,SAA6B,4BAAyCtsF,KAAKsD,OAAO0iB,qBAGtF,MAAM,UAACmO,GAAa1yB,OAAOmD,KAE3B5E,KAAKwiB,QAAQjW,KAAK,kCAAkCggF,UAAU,CAC1DzoD,OAAQp/B,EAAE,SACGC,OAAOD,EAAE,QAAQ6gB,KAAKvlB,KAAKsD,KAAKgH,QAChC3F,OAAO2nF,GACP33E,KAAK,aAElB63E,OAAQ,kBACLr4D,oEACAA,6EACAA,wNAOHs4D,WAAW,EACXC,QAAS,CACL,GAAGv4D,wCACH,GAAGA,4CACH,GAAGA,8CACH,GAAGA,0CACH,GAAGA,0BACH,GAAGA,iCACH,GAAGA,oCAEPjf,OAAO,GAEf,CAEA7D,yBAAwB,MAAC5R,IACjBO,KAAKy0C,cAAch1C,IACnBO,KAAK80C,SAEb,CAEAz1C,6BAA4B,YAACoK,IAKzB,GAAIA,EAAY6lC,sBAAsBtvC,KAAKT,OAAQS,KAAK8V,aAOpD9V,KAAK6U,YAAY,sBAAuB,CAACtV,OAAQS,KAAKT,cAErD,IAAIkK,EAAYC,eAAe1J,KAAKT,OAAQS,KAAK8V,cAC9C9V,KAAKyD,aAAezD,KAAKynE,iBAAmBznE,KAAKG,OAASH,KAAKsD,KAAKnD,KAKvE,CACD,MAAMid,EAAQ3T,EAAY4J,mBAEpB8M,EAAQ/C,EAAM7Q,MAAKwG,GACP,UAAdA,EAAKtP,MACF,CAAC,WAAY,uBAAwB,WAAY,mBAAoB,iBAAiB0F,SAAS4J,EAAKO,OACpG,cAA6BP,EAAM/S,KAAKsD,QAEzC0Z,EAAWI,EAAM7Q,MAAKwG,GACV,aAAdA,EAAKtP,MACF,CAAC,WAAY,UAAW,cAAc0F,SAAS4J,EAAKO,OACpD,cAA6BP,EAAM/S,KAAKsD,SAE3C6c,GAASnD,IAGThd,KAAKsH,aAAa,sBAAuB,CAAC/H,OAAQS,KAAKT,QAE/D,MApBIS,KAAKsH,aAAa,sBAAuB,CAAC/H,OAAQS,KAAKT,QAqB/D,CAEAiR,oBACI,OAAOxQ,KAAKs9D,aAAar3B,4BAC7B,CAEA0mD,kCAAiC,YAACztF,IAC1Bc,KAAKy0C,cAAcv1C,EAAYO,QAC/BO,KAAK80C,SAEb,CAEAz1C,4CAA2C,SAAC0K,IACnC/J,KAAK00C,8BAIJ10C,KAAKkW,YAEXnM,EAAS/J,MACb,CAEAX,2BACI,MAAMiE,EAAO,4CAERA,GAKL,eAA6B,gDAAkD,CAC3EI,YAAaJ,EAAKI,YAClB6O,eAAe,EACfkmB,iBAAkBz4B,KAAKd,YAAYgiC,iBAE3C,CAGA7hC,uCACUW,KAAKs9D,aAAa7sD,sBAC5B,CAEA6wE,wBACQthF,KAAKd,YAAY6J,YACjB/I,KAAK80C,SAEb,CAEAz1C,kCAAiC,QAAC6K,EAAO,MAAEzK,IAClCO,KAAKy0C,cAAch1C,WAIlBO,KAAKkW,kBAELlW,KAAKynE,gBAEXv9D,EAAQlK,KAAKmsF,iBACjB,EgBlRW,MAAMS,WAAwB,IACzCjqF,cACIC,QAEA5C,KAAKwzC,eACLxzC,KAAK6sF,cAAgB,GACrB7sF,KAAK8sF,cAAgB,EACzB,CAEA/4C,YACI,OAAOnxC,MAAMmxC,aACkC,YAAxC/zC,KAAKd,YAAYC,UAAU4B,QACtC,CAEAgsF,OAAOxjE,GAKH,OAJA3mB,MAAMuL,MAAMob,GAEZvpB,KAAK6sF,cAAcvgF,KAAKid,GAEjBvpB,IACX,CAEA8iD,OAAOv5B,GAKH,OAJA3mB,MAAMuL,MAAMob,GAEZvpB,KAAK8sF,cAAcxgF,KAAKid,GAEjBvpB,IACX,CAEA8zC,WACI9zC,KAAKwiB,QAAU9d,EA7IX,+/EA+IJ1E,KAAK+qD,cAAgB/qD,KAAKwiB,QAAQjW,KAAK,yBACvCvM,KAAKgtF,iBAAmBhtF,KAAKwiB,QAAQjW,KAAK,4BAC1CvM,KAAKitF,eAAiBjtF,KAAKwiB,QAAQjW,KAAK,0BAExC,IAAK,MAAM2gF,KAAgBltF,KAAK6sF,cAC5B7sF,KAAKitF,eAAetoF,OAChBD,EAAE,6BACGqO,KAAK,2BAA4Bm6E,EAAap3E,aAC9CnR,OAAOuoF,EAAa54E,WAIjC,IAAK,MAAMkhC,KAAgBx1C,KAAK8sF,cAC5B9sF,KAAKgtF,iBAAiBroF,OAAO6wC,EAAalhC,UAG9CtU,KAAK+qD,cAAcx2C,GAAG,QAAS,qBAAqB7L,IAChD,MAAMykF,EAAezoF,EAAEgE,EAAEiK,QAAQ+B,QAAQ,qBAEzC1U,KAAKotF,gBAAgBD,EAAa,GAE1C,CAEAC,gBAAgBD,EAAcE,GAAmB,GAC7C,MAAM7tF,GAAY2tF,EAAa34E,SAAS,UAKxC,GAHAxU,KAAK+qD,cAAcx+C,KAAK,qBAAqB6/C,YAAY,UACzDpsD,KAAKitF,eAAe1gF,KAAK,gBAAgB6/C,YAAY,UAEjD5sD,EAAU,CACV,MAAM8tF,EAAoBH,EAAap6E,KAAK,4BAEtCw6E,EAAmBvtF,KAAKwtF,wBAA0BF,EAExDttF,KAAKwtF,sBAAwBF,EAE7BttF,KAAK+qD,cAAcx+C,KAAK,+CAA+C+gF,OAAuBzpE,SAAS,UACvG7jB,KAAKitF,eAAe1gF,KAAK,0CAA0C+gF,OAAuBzpE,SAAS,UAEnG,MAAM4pE,EAAcztF,KAAK0tF,wBAEzB,GAAID,IAAgBJ,IAAqBE,GAAmB,CACxD,MAAMI,EAAqBF,EAAY54E,YAAY,eAAgB,CAAC3V,YAAac,KAAKd,YAAaY,SAAUE,KAAKF,WAE9GutF,IACIM,EACAA,EAAmB3iF,MAAK,IAAMyiF,EAAYr1D,YAE1Cq1D,EAAYr1D,UAGxB,CACJ,MACIp4B,KAAKwtF,sBAAwB,IAErC,CAEAnuF,qBACIW,KAAKwtF,sBAAwB,WAEvB5qF,MAAMiyC,cAChB,CAEAx1C,sBAAsBiE,EAAMsqF,GAAuB,GAG/C,IAAIC,EAAsBC,EAF1B9tF,KAAK+tF,aAAezqF,EAAKG,KAIzBzD,KAAK+qD,cAAcpoC,QAEnB,IAAK,MAAMuqE,KAAgBltF,KAAK6sF,cAAe,CAC3C,MAAMl2E,EAAMu2E,EAAa5mB,SAAShjE,GAElC,IAAKqT,EAAIwwB,KACL,SAGJ,MAAMgmD,EAAezoF,EAAE,kCAClBqO,KAAK,2BAA4Bm6E,EAAap3E,aAC9C/C,KAAK,6BAA8Bm6E,EAAa55E,MAChD3O,OAAOD,EAAE,wCACGmf,SAASlN,EAAI4P,MACbxT,KAAK,aAAc4D,EAAIrM,OACvByI,KAAK,sBAAuBm6E,EAAa9mB,gBACrDzhE,OAAO,KACPA,OAAOD,EAAE,yCAAyC6gB,KAAK5O,EAAIrM,QAEhEtK,KAAK+qD,cAAcpmD,OAAOwoF,GAC1BntF,KAAK+qD,cAAcpmD,OAAO,oCAEtBgS,EAAInX,UAAaQ,KAAKwtF,uBAA0BK,GAAyBD,IACzEC,EAAuBV,GAGvBntF,KAAKwtF,wBAA0BN,EAAap3E,cAC5Cg4E,EAAoBX,EAE5B,CAEA,uBAAoCniF,MAAKkoB,IACrClzB,KAAK+qD,cAAcx+C,KAAK,0BAA0Bye,QAAQ,CACtD1gB,MAAO,WACH,MAAM0jF,EAAoBtpF,EAAE1E,MAAM+S,KAAK,uBACjC1R,EAAS6xB,EAAQ3mB,MAAKonE,GAAOA,EAAIxgD,aAAe66D,IAChD1jF,EAAQ5F,EAAE1E,MAAM+S,KAAK,cAE3B,OAAI1R,GAAUA,EAAO+xB,mBAAmB3wB,OAAS,EACtC,GAAG6H,MAAUjJ,EAAO+xB,mBAAmB1hB,KAAK,SAG5CpH,CAEf,GACF,IAGDujF,IACDA,EAAuBC,GAGvBD,EACA7tF,KAAKotF,gBAAgBS,GAAsB,GAG3C7tF,KAAKitF,eAAe1gF,KAAK,gBAAgB6/C,YAAY,SAE7D,CAEA6hC,kBAAkB36E,GAGd,OAFyBtT,KAAKwiB,QAAQjW,KAAK,iDAAiD+G,OAEpEkB,SAAS,SACrC,CAEA05E,6BAA6BzuF,GACrBO,KAAKy0C,cAAch1C,KAAWO,KAAKiuF,kBAAkB,oBACrDjuF,KAAKmuF,wBAAwB,kBAAmB1uF,EAExD,CAEA2uF,kBAAiB,MAAC3uF,IACdO,KAAKkuF,6BAA6BzuF,EACtC,CAEA4uF,qBAAoB,MAAC5uF,IACjBO,KAAKkuF,6BAA6BzuF,EACtC,CAEA0uF,wBAAwB76E,EAAM7T,GAC1B,IAAKO,KAAKy0C,cAAch1C,GACpB,OAAO,EAGX,MAAM6uF,EAAmBtuF,KAAKwiB,QAAQjW,KAAK,iDAAiD+G,OAExFg7E,GACAtuF,KAAKotF,gBAAgBkB,EAE7B,CAEAz5E,YAAYvB,EAAMpB,GAGd,IAAIoB,EAAKpL,WAFM,mBASX,OAAOtF,MAAMiS,YAAYvB,EAAMpB,GAPN,CACzB,IAAIq8E,EAAgBj7E,EAAK0iB,OAAOw4D,IAChCD,EAAgBA,EAAc,GAAGt3D,cAAgBs3D,EAAcv4D,OAAO,GAEtEh2B,KAAKmuF,wBAAwBI,EAAer8E,EAAKzS,MACrD,CAIJ,CAEAJ,4BAA4BiU,EAAMpB,GAC9B,GAAI,CAAC,uBAAwB,kBAAkB/I,SAASmK,SAE9C1Q,MAAM4T,sBAAsB,iBAAkBtE,QAEnD,GAAIlS,KAAK+zC,aAAwB,0BAATzgC,EAAkC,CAC3D,MAAMm7E,EAAqBzuF,KAAK0tF,wBAG5Be,SACMA,EAAmB55E,YAAYvB,EAAMpB,GAG/C,IAAK,MAAMsjC,KAAgBx1C,KAAK8sF,oBACtBt3C,EAAa3gC,YAAYvB,EAAMpB,EAE7C,CACJ,CAEAq9C,uBAAsB,YAAC9lD,IACfA,EAAYC,eAAe1J,KAAKT,SAAWS,KAAK+tF,eAAiB/tF,KAAKsD,KAAKG,MAG3EzD,KAAK+tF,aAAe/tF,KAAKsD,KAAKG,KAE9BzD,KAAK80C,WAEArrC,EAAY4J,iBAAiBrT,KAAK8V,aAAavJ,MAAKwG,GAAQ,cAA6BA,EAAM/S,KAAKsD,SACzGtD,KAAK40C,gBAAgB50C,KAAKsD,MAAM,EAExC,CAEAoqF,wBACI,OAAO1tF,KAAK6sF,cAActgF,MAAKmiF,GAAMA,EAAG54E,cAAgB9V,KAAKwtF,uBACjE,EC9SW,MAAMmB,WAAiC,IAC9Cr7E,WACA,MAAO,oBACX,CAEI8yD,oBACA,MAAO,mCACX,CAEAtyB,WACI9zC,KAAKwiB,QAAU9d,EAtDX,w5BAuDJ1E,KAAKwzC,eACLxzC,KAAK0lB,WAAa1lB,KAAKwiB,QAAQjW,KAAK,iCACxC,CAEA+5D,SAAShjE,GAGL,OAAgC,IAFPA,EAAK4d,kCAETze,OACV,CAAC0kC,MAAM,GAGX,CACHA,MAAM,EACN3nC,SAAUgB,EAAA,KAAW,kCACrB8J,MAAO,OACPic,KAAM,cAEd,CAEAlnB,sBAAsBiE,GAClBtD,KAAK0lB,WAAW/C,QAEhB,MAAMisE,EAAmBtrF,EAAK4d,kCACxB2kD,EAAkBviE,EAAK6Z,qBAM7B,GAFA0oD,EAAgBp2D,MAAK,CAACC,EAAGC,IAAMD,EAAER,SAAWS,EAAET,WAEd,IAA5B0/E,EAAiBnsF,OAEjB,YADAzC,KAAKg0C,WAAU,GAInB,MAAM66C,EAAS,GAEf,IAAK,MAAMC,KAAkBF,EAAkB,CAC3C,MAAMG,EAAYD,EAAex7E,KAAKpL,WAAW,UAAY,QAAU,WACjE8mF,EAAYF,EAAex7E,KAAK0iB,OAAO+4D,EAAUtsF,OAAS,GAEhE,IAAIwsF,EAAappB,EAAgBj6D,QAAOwJ,GAAMA,EAAG9B,OAAS07E,GAAa55E,EAAG3R,OAASsrF,IAEzD,IAAtBE,EAAWxsF,QACXwsF,EAAW3iF,KAAK,CACZ6G,YAAa,GACb1P,KAAMsrF,EACNz7E,KAAM07E,EACN57E,MAAO,KAIqC,WAAhD07E,EAAe51E,gBAAgBikB,eAC/B8xD,EAAaA,EAAWj+E,MAAM,EAAG,IAGrC,IAAK,MAAMk+E,KAAaD,EAAY,CAChC,MAAME,QAAcnvF,KAAKovF,4BAA4BN,EAAgBI,EAAWF,GAEhFH,EAAOviF,KAAK6iF,EAChB,CACJ,CAIAnvF,KAAK0lB,WAAW/C,QAAQhe,UAAUkqF,GAClC7uF,KAAKg0C,WAAU,EACnB,CAEA30C,kCAAkCyvF,EAAgBI,EAAWF,GACzD,MAAM74C,EAAa24C,EAAe51E,gBAE5Bq6D,EAAS7uE,EAAE,WACZiQ,KAAK,WAAY,IAAMm6E,EAAe5/E,UACtC6D,KAAK,oBAAqBm8E,EAAU3vF,SAAWS,KAAKT,OAAS2vF,EAAU/7E,YAAc,IACrFJ,KAAK,sBAAuBm8E,EAAUzrF,MACtCsP,KAAK,sBAAuBm8E,EAAU57E,MACtCqB,KAAK,QAASu6E,EAAU97E,OACxByQ,SAAS,gBACTA,SAAS,4BACTtP,GAAG,UAAU8C,GAASrX,KAAKqvF,yBAAyBh4E,KAEnDi4E,EAAc5qF,EAAE,SAChB6qF,EAAoB7qF,EAAE,QACvBmf,SAAS,gBACT9Q,KAAK,UAAU,GAEd01D,EAAW/jE,EAAE,sEACdC,OAAOD,EAAE,YAAY6gB,KAAK4wB,EAAW7Y,eAAiB0xD,IACtDrqF,OAAOD,EAAE,SAASmf,SAAS,eAAelf,OAAO4uE,IACjD5uE,OAAO2qF,GACP3qF,OAAO4qF,GAEZ,GAAuB,UAAnBL,EAAUzrF,KACV,GAA6B,SAAzB0yC,EAAWjZ,UACXq2C,EAAO5+D,KAAK,OAAQ,QAGhB1T,EAAA,qBAEAsC,EAAA,MAAW,oBAAoB0oB,mBAAmBijE,EAAU57E,SAAStI,MAAKgzD,IACvC,IAA3BA,EAAgBv7D,SAIpBu7D,EAAkBA,EAAgBryD,KAAIqZ,IAAa,CAAE5R,MAAO4R,MAE5DuuD,EAAO3sE,aAAa,CAChB6zC,SAAUhpC,SAASipC,cAAc,QACjCC,MAAM,EACNC,YAAY,EACZC,aAAa,EACbC,UAAW,EACXC,iBAAiB,GAClB,CAAC,CACAE,WAAY,QACZD,OAAQ,SAAUjC,EAAM9tC,GACpB8tC,EAAOA,EAAK9hB,cAIZhsB,EAFiB+yD,EAAgBpyD,QAAOmH,GAAQA,EAAKK,MAAM6jB,cAAc9tB,SAAS4vC,KAGtF,KAGJw6B,EAAOh/D,GAAG,yBAAyB7L,GAAK1I,KAAKqvF,yBAAyB3mF,KAAG,SAIhF,GAA6B,WAAzBytC,EAAWjZ,UAAwB,CACxCq2C,EAAO5+D,KAAK,OAAQ,UAEpB,IAAI66E,EAAO,EAEX,IAAK,IAAIhgF,EAAI,EAAGA,GAAK2mC,EAAW9Y,iBAAmB,IAAM7tB,EAAI,GAAIA,IAC7DggF,GAAQ,GAGZjc,EAAO5+D,KAAK,OAAQ66E,GACpBjc,EACK5vD,IAAI,aAAc,SAClBA,IAAI,QAAS,MACtB,MACK,GAA6B,YAAzBwyB,EAAWjZ,UAChBq2C,EAAO5+D,KAAK,OAAQ,YAGpB4+D,EAAO5vD,IAAI,QAAS,QAEI,SAApBurE,EAAU97E,OACVmgE,EAAO5+D,KAAK,UAAW,gBAG1B,GAA6B,SAAzBwhC,EAAWjZ,UAChBq2C,EAAO5+D,KAAK,OAAQ,aAEnB,GAA6B,aAAzBwhC,EAAWjZ,UAChBq2C,EAAO5+D,KAAK,OAAQ,uBAEnB,GAA6B,QAAzBwhC,EAAWjZ,UAAqB,CACrCq2C,EAAO5+D,KAAK,cAAe,qBAE3B,MAAMuY,EAAcxoB,EAAE,UACjBmf,SAAS,gEACTlP,KAAK,QAAS,sBACdJ,GAAG,SAAS,IAAM9S,OAAOyE,KAAKqtE,EAAOnuD,MAAO,YAEjDmuD,EAAOj5B,MAAM51C,EAAE,SACVmf,SAAS,sBACTlf,OAAOuoB,GAChB,MAEIvpB,EAAA,WAAY,sBAAsBmrF,EAAe5xD,kBAGpD,IAAuB,aAAnBgyD,EAAUzrF,KAqBf,YADAE,EAAA,WAAY,2BAA2BurF,EAAUzrF,SAnB7CyrF,EAAU97E,OACVmgE,EAAOnuD,UAAUrlB,EAAA,eAAyBmvF,EAAU97E,QAGpDnS,EAAA,qBAEA,uBAA6CsyE,EAAQ,CAACt6B,oBAAoB,IAE1Es6B,EAAOh/D,GAAG,6BAA6B,CAAC8C,EAAO8jC,EAAY2kB,KACvD9/D,KAAKqvF,yBAAyBh4E,EAAM,IAGxCk8D,EAAO/5B,oBAAoB01C,EAAU97E,QAGrCmgE,EAAOxgE,KAAK,WAAY,WAMhC,CAEA,GAAgC,UAA5BojC,EAAWhZ,aAA0B,CACrC,MAAMsyD,EAAa/qF,EAAE,UAChBmf,SAAS,sBACTlP,KAAK,QAAS,qBACdJ,GAAG,SAASlV,UACT,MAAMqwF,QAAa1vF,KAAKovF,4BAA4BN,EAAgB,CAChE37E,YAAa,GACb1P,KAAMyrF,EAAUzrF,KAChB6P,KAAM07E,EACN57E,MAAO,IACR47E,GAEHvmB,EAASnuB,MAAMo1C,GAEfA,EAAKnjF,KAAK,SAASzH,QAAQ,QAAQ,IAGrC6qF,EAAgBjrF,EAAE,UACnBmf,SAAS,uBACTlP,KAAK,QAAS,yBACdJ,GAAG,SAASlV,UACT,MAAM8T,EAAcogE,EAAOxgE,KAAK,qBAE5BI,SACM5P,EAAA,SAAc,SAASvD,KAAKT,qBAAqB4T,IAAenT,KAAK8V,aAI/E,MAAM85E,EAAmB,8BAA8BV,EAAUzrF,+BAA+BurF,MAEhG,GAAIhvF,KAAKwiB,QAAQjW,KAAKqjF,GAAkBntF,QAAU,EAAG,CACjD,MAAMitF,QAAa1vF,KAAKovF,4BAA4BN,EAAgB,CAChE37E,YAAa,GACb1P,KAAMyrF,EAAUzrF,KAChB6P,KAAM07E,EACN57E,MAAO,IACR47E,GAEHvmB,EAASnuB,MAAMo1C,EACnB,CAEAjnB,EAASzuC,QAAQ,IAGzBu1D,EACK5qF,OAAO,WACPA,OAAO8qF,GACP9qF,OAAO,WACPA,OAAOgrF,EAChB,CAEA,OAAOlnB,CACX,CAEAppE,+BAA+BgY,GAC3B,MAAM6N,EAAQxgB,EAAE2S,EAAM1E,QAEtB,IAAIS,EAEJ,GAA2B,aAAvB8R,EAAMvQ,KAAK,QACXvB,EAAQ8R,EAAMkU,GAAG,YAAc,OAAS,aAEvC,GAA0C,aAAtClU,EAAMnS,KAAK,uBAAuC,CACvD,MAAM88E,EAAe3qE,EAAMq2B,sBAE3BnoC,EAAQy8E,EAAe9vF,EAAA,mBAA6B8vF,GAAgB,EACxE,MAEIz8E,EAAQ8R,EAAME,MAGlB,MAAM0N,QAAevvB,EAAA,MAAW,SAASvD,KAAKT,mBAAoB,CAC9D4T,YAAa+R,EAAMnS,KAAK,qBACxBtP,KAAMyhB,EAAMnS,KAAK,uBACjBO,KAAM4R,EAAMnS,KAAK,uBACjBK,MAAOA,GACRpT,KAAK8V,aAERoP,EAAMnS,KAAK,oBAAqB+f,EAAO3f,YAC3C,CAEAilB,QACIp4B,KAAKwiB,QAAQjW,KAAK,mCAAmC6rB,OACzD,CAEAm3B,uBAAsB,YAAC9lD,IACfA,EAAY4J,iBAAiBrT,KAAK8V,aAAavJ,MAAKwG,GAAQ,cAA6BA,EAAM/S,KAAKsD,SACpGtD,KAAK80C,SAEb,ECxUW,MAAMg7C,WAAkC,IAC/Cx8E,WACA,MAAO,qBACX,CAEI8yD,oBACA,MAAO,oCACX,CAEAzjE,cACIC,QAGA5C,KAAKmjE,uBAAwB,IAAIhF,IAC5B3qB,eACAp9B,UAAUpW,MAEfA,KAAKmO,MAAMnO,KAAKmjE,sBACpB,CAEAmD,WACI,MAAO,CACHn/B,MAAOnnC,KAAKsD,KAAK8E,oBACjBkC,MAAO,QACPic,KAAM,kBAEd,CAEAutB,WACI9zC,KAAKwiB,QAAU9d,EA/CX,6YAgDJ1E,KAAKwzC,eAELxzC,KAAK0lB,WAAa1lB,KAAKwiB,QAAQjW,KAAK,mCACpCvM,KAAKwiB,QAAQ7d,OAAO3E,KAAKmjE,sBAAsB7uD,SACnD,CAEAjV,sBAAsBiE,GAClBtD,KAAK0lB,WAAW/C,QAEhB,MAAMotE,EAAsB/vF,KAAKgwF,uBAAuB1sF,GAExD,GAAmC,IAA/BysF,EAAoBttF,OAKxB,IAAK,MAAMuiB,KAAa+qE,EAAqB,CACzC,MAAM7qE,SAAe,qBAAkCF,GAAW,IAC7DzQ,GAAG,SAAS7L,IACTC,YAAW,IACP3I,KAAKmjE,sBAAsBa,oBAAoB,CAC3Ch/C,UAAW,CACPzlB,OAAQylB,EAAUzlB,OAClBkE,KAAMuhB,EAAUvhB,KAChB6P,KAAM0R,EAAU1R,KAChBF,MAAO4R,EAAU5R,MACjB0F,cAAekM,EAAUlM,eAE7B8nD,SAAS,EACTl9C,EAAGhb,EAAEic,MACLnB,EAAG9a,EAAEkc,SACL,IAAI,IAGpB5kB,KAAK0lB,WACA/gB,OAAOugB,GACPvgB,OAAO,IAChB,MAzBI3E,KAAK0lB,WAAW/gB,OAAO,WA0B/B,CAEAqrF,uBAAuB1sF,GACnB,MAAM8Z,EAAQ9Z,EAAKga,gBAAgB1R,QAAOmH,GAAQA,EAAKxT,SAAWS,KAAKT,SAWvE,OATA6d,EAAM3N,MAAK,CAACC,EAAGC,IACPD,EAAEnQ,SAAWoQ,EAAEpQ,OACRmQ,EAAER,SAAWS,EAAET,SAGfQ,EAAEnQ,OAASoQ,EAAEpQ,QAAU,EAAI,IAInC6d,CACX,CAEAmyC,uBAAsB,YAAC9lD,IACfA,EAAY4J,iBAAiBrT,KAAK8V,aAAavJ,MAAKwG,GAAQ,cAA6BA,EAAM/S,KAAKsD,SACpGtD,KAAK80C,SAEb,ECoRJ,SAvOA,MAIInyC,YAAYmhB,EAAS7G,EAAY9K,EAASslB,GAAe,GACrDz3B,KAAKiwF,UAAYvrF,EA3Jb,6gHA8JJof,EAAQnB,QAER3iB,KAAKid,WAAaA,EAClB,MAAMizE,EAAkBlwF,KAAKmwF,qBAE7BnwF,KAAKmS,QAAUA,EAAQvG,QAAOrM,IAAW2wF,EAAgB/1E,IAAI5a,IAAsB,YAAXA,IAE5C,IAAxBS,KAAKmS,QAAQ1P,SAIjBqhB,EAAQnf,OAAO3E,KAAKiwF,WAEpBjwF,KAAKowF,KAAO,EACZpwF,KAAKqwF,SAAWlrF,SAAS8X,EAAWsC,cAAc,eAE7Cvf,KAAKqwF,UAAYrwF,KAAKqwF,SAAW,KAClCrwF,KAAKqwF,SAAW,IAGpBrwF,KAAKswF,SAAWrzE,EAAWsC,cAAc,YAEpC,CAAC,OAAQ,QAAQpW,SAASnJ,KAAKswF,YAEhCtwF,KAAKswF,SAA+B,WAApBrzE,EAAWxZ,KAAoB,OAAS,QAG5DzD,KAAKiwF,UAAUpsE,SAAS,GAAG7jB,KAAKswF,iBAEhCtwF,KAAKy3B,aAAeA,EACxB,CAIA04D,qBACI,MAAMI,EAAgBvwF,KAAKid,WACrBjd,KAAKid,WAAW0C,eAAe/T,QAAOqV,GAAoB,cAAbA,EAAI3N,MAAqC,oBAAb2N,EAAI3N,OAC7E,GAEN,OAAO,IAAIwG,IAAIy2E,EAAc5kF,KAAIsV,GAAOA,EAAI7N,QAChD,CAEA/T,mBACI,GAA4B,IAAxBW,KAAKmS,QAAQ1P,OAEb,YADAzC,KAAKiwF,UAAUvtE,OAInB,MAAMiO,EAAoB3wB,KAAKid,WAAW0T,mBAAqB,GAC3DA,EAAkBluB,OAAS,SACrB,oBAA6B,aAEnCzC,KAAKwwF,eAAiB,IAAInnD,OAAO1Y,EAAkBjf,KAAK,KAAM,OAE9D1R,KAAKwwF,eAAiB,KAG1BxwF,KAAKiwF,UAAU9oD,OAEf,MAAMzhB,EAAa1lB,KAAKiwF,UAAU1jF,KAAK,wBAAwBoW,QAEzD8tE,GAAYzwF,KAAKowF,KAAO,GAAKpwF,KAAKqwF,SAClCK,EAASD,EAAWzwF,KAAKqwF,SAEzBM,EAAc3wF,KAAKmS,QAAQnB,MAAMy/E,EAAU54E,KAAK2xC,IAAIknC,EAAQ1wF,KAAKmS,QAAQ1P,SACzEmuF,QAAkB/wF,EAAA,iBAAe8wF,GAEvC,IAAK,MAAMrtF,KAAQstF,EAAW,CAC1B,MAAMC,QAAc7wF,KAAK8wF,WAAWxtF,EAAMtD,KAAKid,WAAW9U,cAAc,aAExEud,EAAW/gB,OAAOksF,EACtB,CAIA,OAFA7wF,KAAK+wF,cAEE/wF,KAAKiwF,SAChB,CAEAc,cACI,MAAMC,EAAShxF,KAAKiwF,UAAU1jF,KAAK,oBAAoBoW,QACjDsuE,EAAYp5E,KAAKq5E,KAAKlxF,KAAKmS,QAAQ1P,OAASzC,KAAKqwF,UAIvD,IAAIc,EAFJH,EAAO7jE,OAAO8jE,EAAY,GAI1B,IAAK,IAAIzhF,EAAI,EAAGA,GAAKyhF,EAAWzhF,IAC5B,GAAIyhF,EAAY,IAAMzhF,GAAK,GAAKyhF,EAAYzhF,GAAK,GAAKqI,KAAK4uC,IAAIzmD,KAAKowF,KAAO5gF,IAAM,EAAG,CAChF2hF,GAAc,EAEd,MAAMnvB,GAAcxyD,EAAI,GAAKxP,KAAKqwF,SAAW,EACvCtuB,EAAWlqD,KAAK2xC,IAAIxpD,KAAKmS,QAAQ1P,OAAQ+M,EAAIxP,KAAKqwF,UAExDW,EAAOrsF,OACH6K,IAAMxP,KAAKowF,KACL1rF,EAAE,UAAU6gB,KAAK/V,GAAGmU,IAAI,kBAAmB,aAAaA,IAAI,cAAe,QAC3Ejf,EAAE,0BACC6gB,KAAK/V,GACLuD,KAAK,QAAS,WAAWivD,OAAgBD,KACzCxtD,GAAG,SAAS,KACTvU,KAAKowF,KAAO5gF,EACZxP,KAAKoxF,YAAY,IAE7B,WAER,MACSD,IACLH,EAAOrsF,OAAO,eAEdwsF,GAAc,GAKtBH,EAAOrsF,OAAO,8CAA8C3E,KAAKmS,QAAQ1P,uBAC7E,CAEApD,iBAAiBiE,EAAMkwD,GAAS,GAC5B,MAAM69B,EAAY3sF,EAAE,4DAEd,oBAACshB,SAA6B,4BAAyC1iB,GACvExD,EAAoC,WAAzBE,KAAKid,WAAWxZ,KAC3BH,EAAK/D,OACL,GAAGS,KAAKid,WAAW1d,UAAU+D,EAAK/D,SAElCsxF,EAAQnsF,EAAE,gCACXqO,KAAK,eAAgBzP,EAAK/D,QAC1BoF,OACGD,EAAE,iCACGC,OAAO0sF,GACP1sF,OAAOD,EAAE,4BAA4Bmf,SAASvgB,EAAK2b,YACnDta,OAAyB,SAAlB3E,KAAKswF,SACP5rF,EAAE,kCAAkC6gB,WAAWxlB,EAAA,eAAyBuD,EAAK/D,OAAQS,KAAKid,WAAW1d,gBAC9F,eAAuBO,EAAU,CAACwrB,aAAa,EAAOmM,aAAcz3B,KAAKy3B,gBAC7E5T,SAAS,oBAEjBlf,OAAOqhB,IAuBpB,MApBsB,SAAlBhmB,KAAKswF,UACLO,EACKhtE,SAAS,cACT9Q,KAAK,YAAa,IAAIjT,KACtByU,GAAG,SAAS7L,GAAK,aAAqBA,KAG/C2oF,EAAU98E,GAAG,SAAS,IAAMvU,KAAKsxF,cAAcT,EAAOvtF,GAAOutF,EAAMr8E,SAAS,eAExExU,KAAKwwF,gBACLK,EAAMtkF,KAAK,oBAAoBglF,WAAWvxF,KAAKwwF,eAAgB,CAC3DnpC,QAAS,OACTntC,UAAW,iBACXs3E,oBAAoB,EACpBC,eAAe,UAIjBzxF,KAAKsxF,cAAcT,EAAOvtF,EAAMkwD,GAE/Bq9B,CACX,CAEAxxF,oBAAoBwxF,EAAOvtF,EAAMkwD,GAC7B,GAAsB,SAAlBxzD,KAAKswF,WAAyB98B,GAAUq9B,EAAMr8E,SAAS,cAAkBg/C,IAAWq9B,EAAMr8E,SAAS,aACnG,OAGJ,MAAM68E,EAAYR,EAAMtkF,KAAK,sCAEzBinD,GAA4B,SAAlBxzD,KAAKswF,UACfO,EAAMhtE,SAAS,YACfwtE,EAAUxtE,SAAS,mBAAmBuoC,YAAY,sBAGlDykC,EAAMzkC,YAAY,YAClBilC,EAAUxtE,SAAS,oBAAoBuoC,YAAY,qBAGlDoH,GAA4B,SAAlBxzD,KAAKswF,UAAoE,IAA5CO,EAAMtkF,KAAK,sBAAsB9J,QACzEouF,EAAMlsF,aAAa3E,KAAK0xF,kBAAkBpuF,GAElD,CAEAjE,wBAAwBiE,GACpB,MAAMupB,EAAWnoB,EAAE,mCAEnB,IACI,MAAM,iBAACwmB,EAAgB,KAAEznB,SAAc,wBAAmCH,EAAM,CAC5E0W,KAAwB,SAAlBha,KAAKswF,WAGXtwF,KAAKwwF,gBACLtlE,EAAiBqmE,WAAWvxF,KAAKwwF,eAAgB,CAC7CnpC,QAAS,OACTntC,UAAW,iBACXs3E,oBAAoB,EACpBC,eAAe,IAIvB5kE,EAASloB,OAAOumB,GAChB2B,EAAShJ,SAAS,QAAQpgB,IAC9B,CAAE,MAAOiF,GACLuM,QAAQY,IAAI,sCAAsCvS,EAAK/D,oBAAoB+D,EAAKG,UAAUiF,EAAEgE,mBAAmBhE,EAAEiE,SAEjHkgB,EAASloB,OAAO,kBACpB,CAEA,GAAsB,SAAlB3E,KAAKswF,SAAqB,CAC1B,MAAMqB,EAAaruF,EAAKqc,aAAa,aAE/ByL,SAAoB9nB,EAAKsuF,iBAC1BhmF,QAAOyf,IAAcsmE,EAAWplF,MAAK0U,GAAOA,EAAI7N,QAAUiY,EAAU9rB,WAEzE,IAAK,MAAM8rB,KAAaD,EACpByB,EAASloB,aAAa3E,KAAK8wF,WAAWzlE,GAE9C,CAEA,OAAOwB,CACX,GC7WW,MAAMglE,WAAuB,IACxC99C,YACI,OAAOnxC,MAAMmxC,aAAe/zC,KAAKd,YAAY2K,aACjD,CAEAiqC,WACI9zC,KAAKwiB,QAAU9d,EAvBX,+RAwBJ1E,KAAKwzC,eACLxzC,KAAK6sB,SAAW7sB,KAAKwiB,QAAQjW,KAAK,6BAElC,MAAMulF,EAAW,IAAIC,sBAAqBC,IACtChyF,KAAKiyF,eAAiBD,EAAQ,GAAGC,eAEjCjyF,KAAKkyF,mBAAmB,GACzB,CACCC,WAAY,OACZC,UAAW,KAKfzpF,YAAW,IAAMmpF,EAASnnC,QAAQ3qD,KAAKwiB,QAAQ,KAAK,GACxD,CAEA0vE,oBAKQlyF,KAAKiyF,gBACFjyF,KAAKqyF,kBAAoBryF,KAAKT,QAC9BS,KAAKsyF,cAAgBtyF,KAAKT,SAE7BS,KAAKsyF,YAActyF,KAAKT,OACxBS,KAAKuyF,eAAevyF,KAAKsD,MAEjC,CAEAjE,qBAAqBiE,GACjB,MAAMkvF,EAAmB,IAAI,GAAiBxyF,KAAK6sB,SAAUvpB,EAAMA,EAAKkZ,yBAClEg2E,EAAiBpB,YAC3B,CAEA/xF,gBACIW,KAAKsyF,YAAc,WAEb1vF,MAAMkyC,SAChB,CAEAz1C,4BAA2B,OAACE,IACpBS,KAAK20C,OAAOp1C,UACNS,KAAKuyF,eAAevyF,KAAKsD,KAEvC,CAOAmvF,0BAAyB,MAAChzF,IACjBO,KAAKy0C,cAAch1C,KAIxBO,KAAKqyF,gBAAkBryF,KAAKT,OAE5BoJ,YAAW,IAAM3I,KAAKkyF,qBAAqB,KAC/C,CAEAQ,oBAAmB,QAACvgF,IACZA,EAAQhJ,SAASnJ,KAAKT,SACtBS,KAAK80C,SAEb,CAEAya,uBAAsB,YAAC9lD,IACfA,EAAY4J,mBAAmB9G,MAAKwG,GAAQA,EAAKxT,SAAWS,KAAKT,QAAU,CAAC,WAAY,WAAY,YAAY4J,SAAS4J,EAAKO,UAC9HtT,KAAKsyF,YAAc,KAEnBtyF,KAAKkyF,oBAEb,mCCjGW,MAAMS,WAA6B,KAC9ChwF,YAAYqiB,EAAW1hB,GACnBV,QAEA5C,KAAKglB,UAAYA,EACjBhlB,KAAKsD,KAAOA,CAChB,CAEA6D,0BAA0B5H,EAAQkE,EAAM6P,EAAMF,EAAQ,UAC5C7P,EAAA,MAAW,SAAShE,kBAAwB,CAAEkE,OAAM6P,OAAMF,gBAE1DzP,EAAA,iCACV,CAEAtE,mBAAmBoE,EAAM6P,EAAMF,EAAQ,UAC7BpT,KAAK2C,YAAYs0C,aAAaj3C,KAAKsD,KAAK/D,OAAQkE,EAAM6P,EAAMF,EACtE,CAEAkB,SACI,IACI,MAAMs+E,EAAY5yF,KAAK8zC,WAQvB,OANA8+C,EAAUrmF,KAAK,sBACVgI,GAAG,SAAS,IAAMvU,KAAK6yF,iBACvB9/E,KAAK,QAAS,YAEnB9R,EAAA,yBAAuB2xF,GAEhBA,CACX,CACA,MAAOlqF,GAEH,OADAE,SAAS,UAAUkD,KAAKC,UAAU/L,KAAKglB,UAAU5L,gBAAgB1Q,EAAEgE,WAAWhE,EAAEiE,SACzE,IACX,CACJ,CAGAmnC,WAAY,CAEZz0C,2BACUW,KAAK8yF,gBAAgB9yF,KAAK2C,YAAYk7D,cAAe79D,KAAK2C,YAAY0vE,kBAEtE1uE,EAAA,wCAEA3D,KAAKgI,eAAe,0BAC9B,CAEA3I,sBAAsBoE,EAAM6P,GACxB,IAAK,MAAMP,KAAQ/S,KAAKsD,KAAK6Z,qBACrBpK,EAAKtP,OAASA,GAAQsP,EAAKO,OAASA,SAC9B/P,EAAA,SAAc,SAASvD,KAAKsD,KAAK/D,qBAAqBwT,EAAKI,cAG7E,ECtDW,MAAM4/E,GACjBpwF,YAAYqiB,EAAWguE,GACnBhzF,KAAKglB,UAAYA,EACjBhlB,KAAKgzF,UAAYA,CACrB,CAEA1+E,SACI,IACI,MAAMs+E,EAAY5yF,KAAK8zC,WAQvB,OANA8+C,EAAUrmF,KAAK,oBACVgI,GAAG,SAAS,IAAMvU,KAAKizF,iBACvBlgF,KAAK,QAAS,YAEnB9R,EAAA,yBAAuB2xF,GAEhBA,CACX,CACA,MAAOlqF,GAEH,OADAE,SAAS,mCAAmCkD,KAAKC,UAAU/L,KAAKglB,UAAU5L,oBAAoB1Q,EAAEgE,WAAWhE,EAAEiE,SACtG,IACX,CACJ,CAGAmnC,WAAY,CAEZz0C,iBAAiB6S,GACb,MAAMghF,EAAenjF,OAAOsJ,OAAO,CAAE/F,KAAMtT,KAAK2C,YAAYwwB,YAAcjhB,SAEpE3O,EAAA,MAAW,SAASvD,KAAKglB,UAAUzlB,mBAAoB,CACzD4T,YAAanT,KAAKglB,UAAU7R,YAC5B1P,KAAM,QACN6P,KAAM,SACNF,MAAOtH,KAAKC,UAAUmnF,WAGpBvvF,EAAA,iCACV,CAEAtE,2BACUkE,EAAA,SAAc,SAASvD,KAAKglB,UAAUzlB,qBAAqBS,KAAKglB,UAAU7R,qBAE1ExP,EAAA,iCAGV,ECfW,MAAMwvF,WAA2BJ,GACjC5/D,wBAAe,MAAO,UAAY,CAClCigE,yBAAgB,MAAO,MAAQ,CAE1Ct/C,WACI,MAAMu/C,EAAU3uF,EApCZ,opCAsCE4uF,EAAoBD,EAAQ9mF,KAAK,uBACvC,uBAA6C+mF,GAC7CA,EAAkBlqF,QAAQpJ,KAAKgzF,UAAUO,oBAEzCD,EAAkB/+E,GAAG,uBAAuB,IAAM+oD,EAAaxwD,mBAE/D,MAAMwwD,EAAe,IAAI,KAAaj+D,gBAC5BW,KAAKwzF,WAAW,CAClBD,mBAAoBD,EAAkB93C,qBACxC,GACH,KAIH,OAFA83C,EAAkB/+E,GAAG,SAAS,IAAM+oD,EAAaxwD,mBAE1CumF,CACX,EChCW,MAAMI,WAA6BV,GACnC5/D,wBAAe,MAAO,YAAc,CACpCigE,yBAAgB,MAAO,MAAQ,CAE1Ct/C,WACI,OAAOpvC,EA5BH,6tBA6BR,ECVW,MAAMgvF,WAAkCX,GACxC5/D,wBAAe,MAAO,iBAAmB,CACzCigE,yBAAgB,MAAO,UAAY,CAE9Ct/C,WACI,OAAOpvC,EAxBH,4iBAyBR,ECPW,MAAMivF,WAA8BZ,GACpC5/D,wBAAe,MAAO,aAAe,CACrCigE,yBAAgB,MAAO,MAAQ,CAE1Ct/C,WACI,MAAMu/C,EAAU3uF,EAtBZ,iXAuBEkvF,EAAaP,EAAQ9mF,KAAK,eAChCqnF,EAAWxuE,IAAIplB,KAAKgzF,UAAU5wB,WAAa,IAE3C,MAAM9E,EAAe,IAAI,KAAaj+D,gBAC5BW,KAAKwzF,WAAW,CAAEpxB,UAAWwxB,EAAWxuE,OAAQ,GACvD,KAIH,OAFAwuE,EAAWr/E,GAAG,SAAS,IAAM+oD,EAAaxwD,mBAEnCumF,CACX,ECdW,MAAMQ,WAAiCd,GACvC5/D,wBAAe,MAAO,gBAAkB,CACxCigE,yBAAgB,MAAO,MAAQ,CAE1Ct/C,WACI,MAAMu/C,EAAU3uF,EAxBZ,0eAyBEovF,EAAgBT,EAAQ9mF,KAAK,kBACnCunF,EAAc1uE,IAAIplB,KAAKgzF,UAAU3wB,cAAgB,IAEjD,MAAM/E,EAAe,IAAI,KAAaj+D,gBAC5BW,KAAKwzF,WAAW,CAAEnxB,aAAcyxB,EAAc1uE,OAAQ,GAC7D,KAIH,OAFA0uE,EAAcv/E,GAAG,SAAS,IAAM+oD,EAAaxwD,mBAEtCumF,CACX,ECTW,MAAMU,WAA8BhB,GACpC5/D,wBAAe,MAAO,aAAe,CACrCigE,yBAAgB,MAAO,OAAS,CAE3Ct/C,WACI,MAAMu/C,EAAU3uF,EA/BZ,u1BAiCEsvF,EAAgBX,EAAQ9mF,KAAK,mBACnCynF,EAAc5uE,IAAIplB,KAAKgzF,UAAUiB,cAAgB,IAEjD,MAAMC,EAAgBb,EAAQ9mF,KAAK,mBACnC2nF,EAAc9uE,IAAIplB,KAAKgzF,UAAUmB,cAAgB,IAEjD,MAAM72B,EAAe,IAAI,KAAaj+D,gBAC5BW,KAAKwzF,WAAW,CAClBS,aAAcD,EAAc5uE,MAC5B+uE,aAAcD,EAAc9uE,OAC9B,GACH,KAKH,OAHA4uE,EAAcz/E,GAAG,SAAS,IAAM+oD,EAAaxwD,mBAC7ConF,EAAc3/E,GAAG,SAAS,IAAM+oD,EAAaxwD,mBAEtCumF,CACX,ECxBW,MAAMe,WAAiCrB,GACvC5/D,wBAAe,MAAO,gBAAkB,CACxCigE,yBAAgB,MAAO,OAAS,CAE3Ct/C,WACI,MAAMu/C,EAAU3uF,EA/BZ,61BAiCE2vF,EAAmBhB,EAAQ9mF,KAAK,sBACtC8nF,EAAiBjvE,IAAIplB,KAAKgzF,UAAUsB,iBAAmB,IAEvD,MAAMC,EAAmBlB,EAAQ9mF,KAAK,sBACtCgoF,EAAiBnvE,IAAIplB,KAAKgzF,UAAUwB,iBAAmB,IAEvD,MAAMl3B,EAAe,IAAI,KAAaj+D,gBAC5BW,KAAKwzF,WAAW,CAClBc,gBAAiBD,EAAiBjvE,MAClCovE,gBAAiBD,EAAiBnvE,OACpC,GACH,KAKH,OAHAivE,EAAiB9/E,GAAG,SAAS,IAAM+oD,EAAaxwD,mBAChDynF,EAAiBhgF,GAAG,SAAS,IAAM+oD,EAAaxwD,mBAEzCumF,CACX,ECnBW,MAAMoB,WAAmC1B,GACzC5/D,wBAAe,MAAO,kBAAoB,CAC1CigE,yBAAgB,MAAO,OAAS,CAE3Ct/C,WACI,MAAMu/C,EAAU3uF,EApCZ,6nCAsCEkvF,EAAaP,EAAQ9mF,KAAK,eAChCqnF,EAAWxuE,IAAIplB,KAAKgzF,UAAU5wB,WAAa,IAE3C,MAAMsyB,EAAcrB,EAAQ9mF,KAAK,gBACjCmoF,EAAYtvE,IAAIplB,KAAKgzF,UAAU2B,YAAc,IAE7C,MAAMr3B,EAAe,IAAI,KAAaj+D,gBAC5BW,KAAKwzF,WAAW,CAClBpxB,UAAWwxB,EAAWxuE,MACtBuvE,WAAYD,EAAYtvE,OAC1B,GACH,KAKH,OAHAwuE,EAAWr/E,GAAG,SAAS,IAAM+oD,EAAaxwD,mBAC1C4nF,EAAYngF,GAAG,SAAS,IAAM+oD,EAAaxwD,mBAEpCumF,CACX,ECjBW,MAAMuB,WAAuC7B,GAC7C5/D,wBAAe,MAAO,sBAAwB,CAC9CigE,yBAAgB,MAAO,QAAU,CAE5Ct/C,WACI,MAAMu/C,EAAU3uF,EA1CZ,w0CA4CEovF,EAAgBT,EAAQ9mF,KAAK,kBACnCunF,EAAc1uE,IAAIplB,KAAKgzF,UAAU3wB,cAAgB,IAEjD,MAAMwyB,EAAcxB,EAAQ9mF,KAAK,gBACjC,uBAA6CsoF,GAC7CA,EAAYzrF,QAAQpJ,KAAKgzF,UAAU5kF,cAEnCymF,EAAYtgF,GAAG,uBAAuB,IAAM+oD,EAAaxwD,mBAEzD,MAAMwwD,EAAe,IAAI,KAAaj+D,gBAC5BW,KAAKwzF,WAAW,CAClBnxB,aAAcyxB,EAAc1uE,MAC5BhX,aAAcymF,EAAYr5C,qBAC5B,GACH,KAKH,OAHAs4C,EAAcv/E,GAAG,SAAS,IAAM+oD,EAAaxwD,mBAC7C+nF,EAAYtgF,GAAG,SAAS,IAAM+oD,EAAaxwD,mBAEpCumF,CACX,ECjCW,MAAMyB,WAAgC/B,GACtC5/D,wBAAe,MAAO,eAAiB,CACvCigE,yBAAgB,MAAO,MAAQ,CAE1Ct/C,WACI,MAAMu/C,EAAU3uF,EArCZ,qgCAsCEqwF,EAAU1B,EAAQ9mF,KAAK,WAC7BwoF,EAAQ3vE,IAAIplB,KAAKgzF,UAAUpqE,QAAU,IAErC,MAAM00C,EAAe,IAAI,KAAaj+D,gBAC5BW,KAAKwzF,WAAW,CAAE5qE,OAAQmsE,EAAQ3vE,OAAQ,GACjD,KAIH,OAFA2vE,EAAQxgF,GAAG,SAAS,IAAM+oD,EAAaxwD,mBAEhCumF,CACX,ECZW,MAAM2B,WAA2BjC,GACjC5/D,wBAAe,MAAO,UAAY,CAClCigE,yBAAgB,MAAO,MAAQ,CAE1Ct/C,WACI,MAAMu/C,EAAU3uF,EAzCZ,2wCA2CEkvF,EAAaP,EAAQ9mF,KAAK,eAChCqnF,EAAWxuE,IAAIplB,KAAKgzF,UAAU5wB,WAAa,IAE3C,MAAMsyB,EAAcrB,EAAQ9mF,KAAK,gBACjCmoF,EAAYtvE,IAAIplB,KAAKgzF,UAAU2B,YAAc,IAE7C,MAAMr3B,EAAe,IAAI,KAAaj+D,gBAC5BW,KAAKwzF,WAAW,CAClBpxB,UAAWwxB,EAAWxuE,MACtBuvE,WAAYD,EAAYtvE,OAC1B,GACH,KAKH,OAHAwuE,EAAWr/E,GAAG,SAAS,IAAM+oD,EAAaxwD,mBAC1C4nF,EAAYngF,GAAG,SAAS,IAAM+oD,EAAaxwD,mBAEpCumF,CACX,EC3BW,MAAM4B,WAA8BlC,GACpC5/D,wBAAe,MAAO,aAAe,CACrCigE,yBAAgB,MAAO,MAAQ,CAE1Ct/C,WACI,MAAMu/C,EAAU3uF,EArCZ,uqCAuCEovF,EAAgBT,EAAQ9mF,KAAK,kBACnCunF,EAAc1uE,IAAIplB,KAAKgzF,UAAU3wB,cAAgB,IAEjD,MAAMwyB,EAAcxB,EAAQ9mF,KAAK,gBACjC,uBAA6CsoF,GAC7CA,EAAYzrF,QAAQpJ,KAAKgzF,UAAU5kF,cAEnCymF,EAAYtgF,GAAG,uBAAuB,IAAM+oD,EAAaxwD,mBAEzD,MAAMwwD,EAAe,IAAI,KAAaj+D,gBAC5BW,KAAKwzF,WAAW,CAClBnxB,aAAcyxB,EAAc1uE,MAC5BhX,aAAcymF,EAAYr5C,qBAC5B,GACH,KAKH,OAHAs4C,EAAcv/E,GAAG,SAAS,IAAM+oD,EAAaxwD,mBAC7C+nF,EAAYtgF,GAAG,SAAS,IAAM+oD,EAAaxwD,mBAEpCumF,CACX,EC5BW,MAAM6B,WAA6BnC,GACnC5/D,wBAAe,MAAO,YAAc,CACpCigE,yBAAgB,MAAO,OAAS,CAE3Ct/C,WACI,MAAMu/C,EAAU3uF,EArCZ,24CAuCEywF,EAAY9B,EAAQ9mF,KAAK,cAC/B4oF,EAAU/vE,IAAIplB,KAAKgzF,UAAUl/D,UAAY,IAEzC,MAAMwpC,EAAe,IAAI,KAAaj+D,gBAC5BW,KAAKwzF,WAAW,CAClB1/D,SAAUqhE,EAAU/vE,OACtB,GACH,KAIH,OAFA+vE,EAAU5gF,GAAG,SAAS,IAAM+oD,EAAaxwD,mBAElCumF,CACX,ECtCJ,MAmBM+B,GAAiB,CACnBF,GACA/B,GACAM,GACAC,GACAC,GACAE,GACAE,GACAK,GACAY,GACAC,GACAR,GACAG,GACAE,IAwCJ,GArCAz1F,eAAyBE,EAAQ4zB,SACvB5vB,EAAA,OAAY,SAAShE,eAAqB,CAC5CkE,KAAM,QACN6P,KAAM,SACNF,MAAOtH,KAAKC,UAAU,CAClBuH,KAAM6f,YAIRxvB,EAAA,iCACV,EA2BA,GAzBA,SAAsBL,GAGlB,OAFqBA,EAAK0b,UAAU,UAEhBrT,KAAI0pF,IACpB,IAAIrC,EAEJ,IACIA,EAAYlnF,KAAK0P,MAAM65E,EAAWjiF,MACtC,CAAE,MAAO1K,GAEL,OADAE,SAAS,0BAA0BysF,EAAWjiF,6BAA6B1K,EAAEgE,WACtE,IACX,CAEA,MAAM4oF,EAAcF,GAAe7oF,MAAKgpF,GAAeA,EAAYpiE,aAAe6/D,EAAU1/E,OAE5F,OAAKgiF,EAKE,IAAIA,EAAYD,EAAYrC,IAJ/BpqF,SAAS,wBAAwBoqF,EAAU1/E,gBACpC,KAGkC,IAE5C1H,QAAOvK,KAAYA,GAC5B,EAEA,GAxEsB,CAClB,CACIiJ,MAAO,KACP4oB,QAAS,CAAC8hE,GAAoBP,GAA4BV,GAAuBJ,KAErF,CACIrpF,MAAO,KACP4oB,QAAS,CAAC+hE,GAAuBL,GAAgCR,GAA0BP,KAE/F,CACIvpF,MAAO,KACP4oB,QAAS,CAACgiE,GAAsB/B,GAAoBM,GAAsBC,KAE9E,CACIppF,MAAO,KACP4oB,QAAS,CAAC4hE,MC+HZU,GAAiB,CC3HR,cAA2B7C,GAC3BtgB,wBAAe,MAAO,cAAe,CACrCxU,2BAAkB,MAAO,OAAQ,CAE5C12D,oBAAoB5H,SACVozF,GAAqB17C,aAAa13C,EAAQ,QAAS,eAC7D,CAEAu0C,WACI,MAAM2hD,EAAU/wF,EAtCZ,yxCAkEJ,OA3BA1E,KAAK01F,cAAgBD,EAAQlpF,KAAK,kBAClCvM,KAAK01F,cAAcnhF,GAAG,SAAS,IAAMvU,KAAKs9D,aAAaxwD,mBAEvD,mBAA+B9M,KAAK01F,cAAe,UAAUr2F,gBAInDW,KAAKs9D,aAAa7sD,uBAExBzQ,KAAKgI,eAAe,iBAAiB,IAGzChI,KAAKs9D,aAAe,IAAI,KAAaj+D,UACjC,MAAMK,EAAeM,KAAK01F,cAActwE,MACxC,2BAA8B1lB,QAExBM,KAAKi3C,aAAa,QAAS,eAAgBv3C,IAE7CM,KAAKsD,KAAKgH,MAAMpC,WAAW,YAAclI,KAAKsD,KAAKgH,MAAMpC,WAAW,eAC9D3E,EAAA,MAAW,SAASvD,KAAKsD,KAAK/D,eAAgB,CAChD+K,MAAO,WAAW5K,EAAa+C,OAAS,GAAK/C,EAAe,GAAGA,EAAas2B,OAAO,EAAG,UAE9F,GACD,KAEHh2B,KAAK01F,cAActwE,IAAIplB,KAAKsD,KAAKic,cAAc,iBAExCk2E,CACX,CAEAE,sBAAqB,MAAClvF,IAClBzG,KAAK01F,cAAc1qE,QAAQ,CACvBlmB,QAAS,SACTwF,MAAO,iBAAiB7D,IACxB+yB,UAAW,WAGfx5B,KAAK01F,cAAc1qE,QAAQ,QAE3BriB,YAAW,IAAM3I,KAAK01F,cAAc1qE,QAAQ,YAAY,IAC5D,CAEA4qE,+BACI51F,KAAK01F,cAActwE,IAAIplB,KAAK01F,cAActwE,MAAMpL,QAAU,4BAA6Boe,QAAQ29B,SAC/F/1D,KAAKs9D,aAAaxwD,gBACtB,GCjDW,cAA2B6lF,GAC3BtgB,wBAAe,MAAO,cAAe,CACrCxU,2BAAkB,MAAO,UAAW,CAE/C12D,oBAAoB5H,SACVozF,GAAqB17C,aAAa13C,EAAQ,WAAY,eAAgB,OAChF,CAEAu0C,WACI,MAAM2hD,EAAU/wF,EA/CZ,qnCAgDEmxF,EAAgBJ,EAAQlpF,KAAK,kBACnC,uBAA6CspF,EAAe,CAAC58C,oBAAoB,IAEjF48C,EAActhF,GAAG,uBAAuBlV,UACpC,MAAMy2F,EAAqBD,EAAcr6C,oBAErCs6C,SACM91F,KAAKi3C,aAAa,WAAY,eAAgB6+C,EACxD,IAGJ,MAAMA,EAAqB91F,KAAKsD,KAAKsd,iBAAiB,gBAMtD,MAJ2B,SAAvBk1E,GACAD,EAAczsF,QAAQ0sF,GAGnBL,CACX,GClBW,cAAuB9C,GACvBtgB,wBAAe,MAAO,UAAW,CACjCxU,2BAAkB,MAAO,UAAW,CAE/C12D,oBAAoB5H,SACVozF,GAAqB17C,aAAa13C,EAAQ,WAAY,WAAY,OAC5E,CAEAu0C,WACI,MAAM2hD,EAAU/wF,EAzDZ,4iEA0DEqxF,EAAYN,EAAQlpF,KAAK,aACzBypF,EAAiBP,EAAQlpF,KAAK,mBACpC,uBAA6CwpF,GAE7CA,EAAUxhF,GAAG,uBAAuBlV,UAChC,MAAMM,EAAiBo2F,EAAUv6C,oBAE7B77C,SACMK,KAAKi3C,aAAa,WAAY,WAAYt3C,EACpD,IAGJq2F,EAAezhF,GAAG,UAAUlV,UACxB,MAAM42F,EAAgBD,EAAe5wE,MAEjC6wE,QACMj2F,KAAKi3C,aAAa,QAAS,gBAAiBg/C,SAG5Cj2F,KAAK8yF,gBAAgB,QAAS,gBACxC,IAGJ,MAAMnzF,EAAiBK,KAAKsD,KAAKsd,iBAAiB,YAE3B,SAAnBjhB,GACAo2F,EAAU3sF,QAAQzJ,GAGtB,MAAMs2F,EAAgBj2F,KAAKsD,KAAKic,cAAc,iBAM9C,OAJI02E,GACAD,EAAe5wE,IAAI6wE,GAGhBR,CACX,CAEAp2F,2BACUW,KAAK8yF,gBAAgB,QAAS,uBAE9BlwF,MAAMiwF,cAChB,GClFW,cAAyBF,GACzBtgB,wBAAe,MAAO,YAAa,CACnCxU,2BAAkB,MAAO,OAAQ,CAE5C12D,oBAAoB5H,SACVozF,GAAqB17C,aAAa13C,EAAO,QAAS,aAC5D,CAEAu0C,WACI,OAAOpvC,EA5BH,slBA6BR,GCjBW,cAAmCiuF,GACnCtgB,wBAAe,MAAO,sBAAuB,CAC7CxU,2BAAkB,MAAO,OAAQ,CAE5C12D,oBAAoB5H,SACVozF,GAAqB17C,aAAa13C,EAAO,QAAS,uBAC5D,CAEAu0C,WACI,OAAOpvC,EArBH,oRAsBR,GCaW,cAAsBiuF,GACtBtgB,wBAAe,MAAO,SAAU,CAChCxU,2BAAkB,MAAO,OAAQ,CAE5C12D,oBAAoB5H,SACVozF,GAAqB17C,aAAa13C,EAAQ,QAAS,UAAW,mBAC9DozF,GAAqB17C,aAAa13C,EAAQ,QAAS,iBAAkB,MAC/E,CAEAu0C,WACI,MAAM2hD,EAAU/wF,EA7CZ,05CA+CEwxF,EAAWT,EAAQlpF,KAAK,wBAC9B2pF,EAAS3hF,GAAG,UAAUlV,UAClB,MAAM82F,EAAUD,EAAS9wE,YAEnBplB,KAAKi3C,aAAa,QAAS,UAAWk/C,EAAQ,IAExDD,EAAS9wE,IAAIplB,KAAKsD,KAAKic,cAAc,YAErC,MAAM62E,EAAkBX,EAAQlpF,KAAK,+BAQrC,OAPA6pF,EAAgB7hF,GAAG,UAAUlV,UACzB,MAAMg3F,EAAiBD,EAAgBhxE,YAEjCplB,KAAKi3C,aAAa,QAAS,iBAAkBo/C,EAAe,IAEtED,EAAgBhxE,IAAIplB,KAAKsD,KAAKic,cAAc,mBAAqB,OAE1Dk2E,CACX,CAEAp2F,2BACUW,KAAK8yF,gBAAgB,QAAS,wBAE9BlwF,MAAMiwF,cAChB,GChDW,cAAoBF,GACpBtgB,wBAAe,MAAO,OAAQ,CAC9BxU,2BAAkB,MAAO,OAAQ,CAE5C12D,oBAAoB5H,SACVozF,GAAqB17C,aAAa13C,EAAQ,QAAS,QAAS,KACtE,CAEAu0C,WACI,MAAM2hD,EAAU/wF,EA/BZ,uqBAsCJ,OALA1E,KAAKs2F,OAASb,EAAQlpF,KAAK,qBAC3BvM,KAAKs2F,OAAO/hF,GAAG,UAAU,IAAMvU,KAAKqY,WACpCrY,KAAKs2F,OAAO/hF,GAAG,SAAS,IAAMvU,KAAKqY,WACnCrY,KAAKs2F,OAAOlxE,IAAIplB,KAAKsD,KAAKic,cAAc,UAEjCk2E,CACX,CAEAp2F,eACI,MAAMk3F,EAAQv2F,KAAKs2F,OAAOlxE,YAEpBplB,KAAKi3C,aAAa,QAAS,QAASs/C,EAC9C,GCxBW,cAAoB5D,GACpBtgB,wBAAe,MAAO,OAAQ,CAC9BxU,2BAAkB,MAAO,OAAQ,CAE5C12D,oBAAoB5H,SACVozF,GAAqB17C,aAAa13C,EAAO,QAAS,QAC5D,CAEAu0C,WACI,OAAOpvC,EA9BH,wpBA+BR,IRwIW,MAAM8xF,WAA+B,IAC5CljF,WACA,MAAO,kBACX,CAEAygC,YACI,OAAO/zC,KAAKsD,MAA2B,WAAnBtD,KAAKsD,KAAKG,IAClC,CAEA6iE,WACI,MAAO,CACHn/B,KAAMnnC,KAAK+zC,YACXv0C,UAAU,EACV8K,MAAO,OACPic,KAAM,eAEd,CAEAutB,WACI9zC,KAAKwiB,QAAU9d,EA1KX,u7KA2KJ1E,KAAKwzC,eACLxzC,KAAKy2F,WAAaz2F,KAAKwiB,QAAQjW,KAAK,6BACpCvM,KAAK02F,YAAc12F,KAAKwiB,QAAQjW,KAAK,gBAErC,IAAK,MAAMoqF,KAAe,GAAiC,CACvD32F,KAAK02F,YAAY/xF,OAAOD,EAAE,gCAAgCC,OAAOgyF,EAAYrsF,QAE7E,IAAK,MAAMjJ,KAAUs1F,EAAYzjE,QAC7BlzB,KAAK02F,YAAY/xF,OACbD,EAAE,sCACGqO,KAAK,kBAAmB1R,EAAO8xB,YAC/B5N,KAAKlkB,EAAO+xF,aAG7B,CAEApzF,KAAKwiB,QAAQjO,GAAG,QAAS,4BAA4BlV,UACjD,MAAMu3F,EAAmBlyF,EAAE2S,EAAM1E,QAAQI,KAAK,0BACxCs7C,EAAQmnC,GAAejpF,MAAKsqF,GAAqBA,EAAkBxkB,aAAeukB,IAEpFvoC,QACMA,EAAM/hC,OAAOtsB,KAAKT,QAGxBqJ,SAAS,yBAAyBguF,KAGtC52F,KAAK80C,SAAS,IAGlB90C,KAAKwiB,QAAQjO,GAAG,QAAS,qBAAqBlV,UAC1CW,KAAKwiB,QAAQjW,KAAK,sBAAsB4xC,SAAS,UAEjD,MAAMhrB,EAAazuB,EAAE2S,EAAM1E,QAAQI,KAAK,yBAElC,GAA4B/S,KAAKT,OAAQ4zB,GAE/CnzB,KAAK80C,SAAS,IAGlB90C,KAAK82F,eAAiB92F,KAAKwiB,QAAQjW,KAAK,mBACxCvM,KAAK+2F,eAAiB/2F,KAAKwiB,QAAQjW,KAAK,mBAExCvM,KAAKg3F,cAAgBh3F,KAAKwiB,QAAQjW,KAAK,kBACvCvM,KAAKg3F,cAAcziF,GAAG,SAAS,IAAMvU,KAAKgI,eAAe,oBAEzDhI,KAAKi3F,wBAA0Bj3F,KAAKwiB,QAAQjW,KAAK,8BACjDvM,KAAKi3F,wBAAwB1iF,GAAG,SAAS,IAAMvU,KAAKk3F,qBAEpDl3F,KAAKm3F,kBAAoBn3F,KAAKwiB,QAAQjW,KAAK,wBAC3CvM,KAAKm3F,kBAAkB5iF,GAAG,SAASlV,UAC/B,MAAM,SAACS,SAAkByD,EAAA,OAAY,iCAAkC,CAAC6zF,aAAcp3F,KAAKT,eAErFoE,EAAA,wCAEA,wCAAyCyF,QAAQtJ,GAEvD,sBAAyB,yCAAyCC,EAAA,mBAA6BD,KAAY,GAEnH,CAEAT,8BACI,IACI,MAAM,MAACoH,SAAe5G,EAAA,uBAAqBG,KAAKT,QAE5CkH,GACAzG,KAAK6U,YAAY,kBAAmB,CAAEpO,SAE9C,CACA,MAAOiC,GACH,oBAAuBA,EAAEgE,QAC7B,CAEA1M,KAAKsH,aAAa,kBAAmB,CAAC7H,MAAOO,KAAKd,YAAYO,OAClE,CAEAJ,6CACUW,KAAK80C,SACf,CAEAz1C,sBAAsBiE,GAClBtD,KAAKy2F,WAAWtvD,OAEhBnnC,KAAKm3F,kBAAkBhqE,OAAO7pB,EAAKgZ,sBAEnCtc,KAAK82F,eAAen0E,QAEpB,IAAK,MAAM00E,KAAe7B,GAAgB,CACtC,MAAM,cAAC33B,EAAa,WAAEwU,GAAcglB,EAE9BtkF,EAAO/S,KAAKsD,KAAKwc,aAAa+9C,EAAewU,GAInD,GAFAryE,KAAKwiB,QAAQjW,KAAK,4BAA4B8lE,MAAellD,QAAQpa,GAEjEA,EAAM,CACN,MAAMukF,EAAe,IAAID,EAAYtkF,EAAM/S,KAAKsD,MAAM8S,UAAUpW,MAChEA,KAAKmO,MAAMmpF,GAEXt3F,KAAK82F,eAAenyF,OAAO2yF,EAAahjF,SAC5C,CACJ,CAEA,MAAM4e,EAAU,GAA+BlzB,KAAKsD,MAEpDtD,KAAK+2F,eACAp0E,QACAhe,UAAUuuB,EAAQvnB,KAAItK,GAAUA,EAAOiT,YAE5CtU,KAAKi3F,wBAAwBtzE,IAAI,aAAcuP,EAAQzwB,OAAS,EAAI,UAAY,UACpF,CAEA8Y,aACI,MAAO,EACX,CAEAlc,+BACUkE,EAAA,OAAY,2BAA2BvD,KAAKT,UAElDS,KAAKgI,eAAe,kBAEpB,sBAAyB,SAAU,IACvC,CAEAunD,uBAAsB,YAAC9lD,IAEfA,EAAY4J,mBAAmB9G,MAAK2yC,GACnB,UAAjBA,EAAQz7C,MAAqC,WAAjBy7C,EAAQ5rC,MAAqB4rC,EAAQt1C,aAEjE5J,KAAK80C,SAEb,ES9SW,MAAMyiD,WAAwB,IACzCxjD,YACI,OAAO/zC,KAAKsD,MACc,iCAAnBtD,KAAKsD,KAAKnD,MACVyC,MAAMmxC,WACjB,CAEAD,WACI9zC,KAAKwiB,QAAU9d,EAvBX,8UAyBJ1E,KAAKw3F,iBAAmBx3F,KAAKwiB,QAAQjW,KAAK,iCAC1CvM,KAAKy3F,aAAez3F,KAAKwiB,QAAQjW,KAAK,qBAC1C,CAEAlN,4BAA2B,MAACI,EAAK,QAAEiH,IAC/B,GAAK1G,KAAKy0C,cAAch1C,GAAxB,CAIAO,KAAKy3F,aAAatqE,OAA0B,IAAnBzmB,EAAQjE,QAAsC,IAAtBiE,EAAQ,GAAGjE,QAC5DzC,KAAKw3F,iBAAiBrqE,OAAOzmB,EAAQjE,OAAS,GAAKiE,EAAQ,GAAGjE,OAAS,GAEvEzC,KAAKw3F,iBAAiB70E,QAEtB,IAAK,MAAMk3B,KAAQnzC,EAAS,CACxB,GAAoB,iBAATmzC,IAAsBrpB,MAAMI,QAAQipB,GAAO,CAElD75C,KAAKw3F,iBAAiB70E,QAAQwkB,OAAOxiC,OACjCD,EAAE,SAAS6gB,KAAKzZ,KAAKC,UAAU8tC,EAAM,KAAM,QAG/C,QACJ,CAEA,IAAKA,EAAKp3C,OACN,SAGJ,MAAMywE,EAASxuE,EAAE,uCACjB1E,KAAKw3F,iBAAiB7yF,OAAOuuE,GAE7B,MAAMpgD,EAAS+mB,EAAK,GACd69C,EAAOhzF,EAAE,QAEf,IAAK,MAAM8sB,KAAOsB,EACd4kE,EAAK/yF,OAAOD,EAAE,QAAQ6gB,KAAKiM,IAG/B0hD,EAAOvuE,OAAO+yF,GAEd,IAAK,MAAM5kE,KAAU+mB,EAAM,CACvB,MAAM69C,EAAOhzF,EAAE,QAEf,IAAK,MAAM8sB,KAAOsB,EACd4kE,EAAK/yF,OAAOD,EAAE,QAAQ6gB,KAAKuN,EAAOtB,KAGtC0hD,EAAOvuE,OAAO+yF,EAClB,CACJ,CA1CA,CA2CJ,ECtCW,MAAMC,WAA8B,IAC/C5jD,YACI,OAAO/zC,KAAKsD,MACc,iCAAnBtD,KAAKsD,KAAKnD,MACVyC,MAAMmxC,WACjB,CAEAD,WACI9zC,KAAKwiB,QAAU9d,EA5CX,ozBA6CJ1E,KAAKwzC,eAELxzC,KAAK43F,wBAA0B53F,KAAKwiB,QAAQjW,KAAK,qBACrD,CAEAlN,sBAAsBiE,GAClB,GAAItD,KAAK63F,kBACL,OAGJ73F,KAAK63F,mBAAoB,EAEzB,MAAMC,QAAoBv0F,EAAA,MAAW,cAErC,IAAK,MAAMw0F,KAASD,EAAa,CAC7B,MAAME,EAAatzF,EAAE,wBAAwB6gB,KAAKwyE,EAAMzkF,MAElD4/D,EAASxuE,EAAE,gCAEjB,IAAK,MAAMuzF,KAAUF,EAAMG,QACvBhlB,EAAOvuE,OACHD,EAAE,QACGC,OAAOD,EAAE,QAAQ6gB,KAAK0yE,EAAO3kF,OAC7B3O,OAAOD,EAAE,QAAQ6gB,KAAK0yE,EAAOx0F,QAI1CzD,KAAK43F,wBAAwBjzF,OAAOqzF,GAAYrzF,OAAO,KAEvDqzF,EAAWhtE,QAAQ,CACfrF,MAAM,EACN6T,UAAW,SACXC,SAAU,SACVnvB,MAAO4oE,EAAO,GAAGvoD,UACjBgP,UAAU,GAElB,CACJ,EC5BW,MAAMw+D,WAA6B,IAC1C7kF,WACA,MAAO,gBACX,CAEI8yD,oBACA,MAAO,+BACX,CAEAryB,YACI,OAAO/zC,KAAKsD,MAA2B,SAAnBtD,KAAKsD,KAAKG,IAClC,CAEA6iE,WACI,MAAO,CACHn/B,KAAMnnC,KAAK+zC,YACXv0C,UAAU,EACV8K,MAAO,KACPic,KAAM,aAEd,CAEAutB,WACI9zC,KAAKwiB,QAAU9d,EAzEX,g8CA0EJ1E,KAAKwzC,eACLxzC,KAAKo4F,YAAcp4F,KAAKwiB,QAAQjW,KAAK,iBACrCvM,KAAKq4F,UAAYr4F,KAAKwiB,QAAQjW,KAAK,kBACnCvM,KAAKs4F,UAAYt4F,KAAKwiB,QAAQjW,KAAK,kBACnCvM,KAAKu4F,UAAYv4F,KAAKwiB,QAAQjW,KAAK,kBACnCvM,KAAKitB,gBAAkBjtB,KAAKwiB,QAAQjW,KAAK,kBACzCvM,KAAKktB,YAAcltB,KAAKwiB,QAAQjW,KAAK,cACrCvM,KAAKw4F,yBAA2Bx4F,KAAKwiB,QAAQjW,KAAK,6BAClDvM,KAAKo7E,wBAA0Bp7E,KAAKwiB,QAAQjW,KAAK,mCAEjDvM,KAAKitB,gBAAgB1Y,GAAG,SAAS,IAAM,sBAA6BvU,KAAKT,UACzES,KAAKktB,YAAY3Y,GAAG,SAAS,IAAM,wBAA+BvU,KAAKT,OAAQS,KAAKsD,KAAKnD,QAEzFH,KAAKw4F,yBAAyBjkF,GAAG,SAAS,KACtCvU,KAAKo7E,wBAAwBt2E,QAAQ,QAAQ,IAGjD9E,KAAKo7E,wBAAwB7mE,GAAG,UAAUlV,UACtC,MAAM4lC,EAAejlC,KAAKo7E,wBAAwB,GAAGlpD,MAAM,GAC3DlyB,KAAKo7E,wBAAwBh2D,IAAI,WAEZ7hB,EAAA,SAAc,SAASvD,KAAKT,cAAe0lC,IAErDo2C,UACP,sBAAyB,aAEzBr7E,KAAK80C,WAGL,oBAAuB,aAC3B,GAER,CAEAz1C,sBAAsBiE,GAClBtD,KAAKwiB,QAAQ2kB,OAEbnnC,KAAKo4F,YAAY7yE,KAAKjiB,EAAK/D,QAC3BS,KAAKq4F,UAAU9yE,KAAKjiB,EAAKic,cAAc,qBAAuB,KAC9Dvf,KAAKs4F,UAAU/yE,KAAKjiB,EAAKnD,MAEzB,MAAMkJ,QAAarJ,KAAKsD,KAAKgG,UAE7BtJ,KAAKu4F,UAAUhzE,KAAKtkB,EAAA,mBAAiBoI,EAAKG,gBAG1CxJ,KAAKktB,YAAYC,QAAQ7pB,EAAKI,aAC9B1D,KAAKitB,gBAAgBE,QAAQ7pB,EAAKI,aAAe,mCACjD1D,KAAKw4F,yBAAyBrrE,QAAQ7pB,EAAKI,aAAe,kCAC9D,EC5FW,MAAM+0F,WAA8B,IAC3CnlF,WACA,MAAO,iBACX,CAEI8yD,oBACA,MAAO,gCACX,CAEAryB,YACI,OAAO/zC,KAAKsD,MAA2B,UAAnBtD,KAAKsD,KAAKG,IAClC,CAEA6iE,WACI,MAAO,CACHn/B,KAAMnnC,KAAK+zC,YACXv0C,UAAU,EACV8K,MAAO,KACPic,KAAM,cAEd,CAEAutB,WACI9zC,KAAKwiB,QAAU9d,EAvDX,0kCAwDJ1E,KAAKwzC,eAELxzC,KAAK04F,gCAAkC14F,KAAKwiB,QAAQjW,KAAK,sCACzDvM,KAAK04F,gCAAgCnkF,GAAG,SAAS,IAAMvU,KAAKsH,aAAa,gCAAiC,CAAC7H,MAAOO,KAAKd,YAAYO,UAEnIO,KAAKw4F,yBAA2Bx4F,KAAKwiB,QAAQjW,KAAK,8BAClDvM,KAAKo7E,wBAA0Bp7E,KAAKwiB,QAAQjW,KAAK,oCAEjDvM,KAAKq4F,UAAYr4F,KAAKwiB,QAAQjW,KAAK,mBACnCvM,KAAKs4F,UAAYt4F,KAAKwiB,QAAQjW,KAAK,mBACnCvM,KAAKu4F,UAAYv4F,KAAKwiB,QAAQjW,KAAK,mBAEnCvM,KAAKktB,YAAcltB,KAAKwiB,QAAQjW,KAAK,eACrCvM,KAAKktB,YAAY3Y,GAAG,SAAS,IAAM,wBAA+BvU,KAAKT,OAAQS,KAAKsD,KAAKnD,QAEzFH,KAAK24F,qBAAuB34F,KAAKwiB,QAAQjW,KAAK,mBAC9CvM,KAAK24F,qBAAqBpkF,GAAG,SAAS,IAAM,sBAA6BvU,KAAKT,UAE9ES,KAAKw4F,yBAAyBjkF,GAAG,SAAS,KACtCvU,KAAKo7E,wBAAwBt2E,QAAQ,QAAQ,IAGjD9E,KAAKo7E,wBAAwB7mE,GAAG,UAAUlV,UACtC,MAAM4lC,EAAejlC,KAAKo7E,wBAAwB,GAAGlpD,MAAM,GAC3DlyB,KAAKo7E,wBAAwBh2D,IAAI,IAEjC,MAAM0N,QAAevvB,EAAA,SAAc,UAAUvD,KAAKT,SAAU0lC,GAExDnS,EAAOuoD,UACP,sBAAyB,oBAEnBp6E,EAAA,4BAENjB,KAAK80C,WAGL,oBAAuB,0CAA0ChiB,EAAOpmB,UAC5E,GAER,CAEArN,sBAAsBiE,GAClBtD,KAAKwiB,QAAQ2kB,OAEb,MAAM99B,QAAarJ,KAAKsD,KAAKgG,UAE7BtJ,KAAKq4F,UAAU9yE,KAAKjiB,EAAKic,cAAc,qBAAuB,KAC9Dvf,KAAKu4F,UAAUhzE,KAAKtkB,EAAA,mBAAiBoI,EAAKG,gBAC1CxJ,KAAKs4F,UAAU/yE,KAAKjiB,EAAKnD,KAC7B,EC5FW,MAAMy4F,WAA6B,IAC9C7kD,YACI,OAAO/zC,KAAKsD,QAAUtD,KAAKsD,KAAKic,cAAc,UAClD,CAEA+mD,WACI,MAAO,CACHn/B,KAAMnnC,KAAK+zC,YACXv0C,UAAU,EACV8K,MAAO,KACPic,KAAM,oBAEd,CAEAutB,WACI9zC,KAAKwiB,QAAU9d,EAhCX,qVAiCJ1E,KAAKwzC,eAELxzC,KAAK64F,SAAW74F,KAAKwiB,QAAQjW,KAAK,YACtC,CAEAlN,sBAAsBiE,GAClB,MAAMw1F,EAAUx1F,EAAKic,cAAc,WAEnCvf,KAAK64F,SACA9lF,KAAK,OAAQ+lF,GACb/lF,KAAK,QAAS+lF,GACdvzE,KAAKuzE,EACd,ECiCW,MAAMC,WAAuB,IACxCjlD,WACI9zC,KAAKwiB,QAAU9d,EA9EX,wmEA+EJ1E,KAAKgkB,MAAQhkB,KAAKwiB,QAAQjW,KAAK,oBAC/BvM,KAAKg5F,UAAYh5F,KAAKwiB,QAAQjW,KAAK,cACnCvM,KAAKg5F,UAAUzkF,GAAG,QAAS,QAAQlV,UAC/B,MAAMgvD,EAAQ3pD,EAAEgE,EAAEiK,QAAQI,KAAK,eAEzB,WAA0B/S,KAAKT,OACjCS,KAAKsD,KAAK2c,cAAc,aAAe,qBAAuB,YAC9DouC,EACH,IAGLruD,KAAKi5F,cAAgBj5F,KAAKwiB,QAAQjW,KAAK,gCACvCvM,KAAKi5F,cAAc1kF,GAAG,UAAU,IAAMvU,KAAKk5F,mBAC3Cl5F,KAAKi5F,cAAc1kF,GAAG,SAAS7L,GAAKA,EAAE0b,oBAEtCpkB,KAAKm5F,YAAcn5F,KAAKwiB,QAAQjW,KAAK,6BACrCvM,KAAKm5F,YAAY5kF,GAAG,SAAS,IAAMvU,KAAKk5F,mBAExCl5F,KAAKo5F,cAAgBp5F,KAAKwiB,QAAQjW,KAAK,mBACvCvM,KAAKwiB,QAAQjO,GAAG,oBAAoBlV,UAChC,MAAM,WAACg6F,UAAqB,qFAA0Bh3E,QAEtDriB,KAAKi5F,cAAct2E,QAEnB,IAAK,MAAM22E,KAAYD,EACnBr5F,KAAKi5F,cAAct0F,OACfD,EAAE,YACG6gB,KAAK+zE,EAAShmF,MACdP,KAAK,QAASumF,EAAShzE,KAIpCtmB,KAAKm5F,YAAY/zE,IAAI,IAErBplB,KAAKk5F,gBAAgB,GAE7B,CAEA75F,sBAAsBiE,GAClBtD,KAAKgkB,MAAMooC,cAAcvoC,SAAS,GAAGvgB,EAAK2b,sBAC9C,CAEA5f,6BAA4B,YAACoK,IACzB,GAAIA,EAAYC,eAAe1J,KAAKT,QAChCS,KAAK80C,eAIT,IAAK,MAAM/hC,KAAQtJ,EAAY4J,mBAC3B,GAAkB,UAAdN,EAAKtP,MACF,CAAC,YAAa,sBAAsB0F,SAAS4J,EAAKO,OAClD,cAA6BP,EAAM/S,KAAKsD,MAAO,CAElDtD,KAAK80C,UACL,KACJ,CAER,CAEAz1C,uBACI,MAAMk6F,QAAoBv5F,KAAKw5F,qBACzB,MAACC,UAAgB,qFAA0Bp3E,QAEjDriB,KAAKg5F,UAAUr2E,QAEX3iB,KAAK05F,gBAAgBj3F,OAAS,GAC9BzC,KAAKg5F,UAAUr0F,OACXD,EAAE,oCACGC,OACGD,EAAE,+CACG6P,GAAG,SAAS,IAAMvU,KAAK05F,gBACnBxpF,SAAQiQ,GAAS,sBAAqCngB,KAAKT,OAAQ4gB,EAAMhN,mBAMlG,MAAMwmF,EAAax0F,SAASnF,KAAKi5F,cAAc1sF,KAAK,mBAAmB6Y,OACjE+a,EAASngC,KAAKm5F,YAAY/zE,MAAMpL,OAAOid,cAEvC2iE,EAAgBH,EAAM7tF,QAAO2a,KAC3BozE,GAAcpzE,EAAKszE,cAAgBF,GAInCx5D,IACK5Z,EAAKjT,KAAKnK,SAASg3B,KAAY5Z,EAAKwyB,MAAMxsC,MAAKV,GAAKA,EAAE1C,SAASg3B,QAQ5Ey5D,EAAcnqF,MAAK,CAACC,EAAGC,KACnB,MAAMmqF,EAASP,EAAY7pF,EAAEwK,YAAc,EAG3C,OAFeq/E,EAAY5pF,EAAEuK,YAAc,GAE3B4/E,CAAM,IAG1B,IAAK,MAAMvzE,KAAQqzE,EACf55F,KAAKg5F,UAAUr0F,OAAO3E,KAAK+5F,WAAWxzE,IAG1CvmB,KAAKm5F,YAAY/gE,OACrB,CAEA/4B,0BAMI,OALKW,KAAKg6F,mBACNh6F,KAAKg6F,iBAAmBz2F,EAAA,MAAW,oBACnCoF,YAAW,IAAM3I,KAAKg6F,iBAAmB,MAAM,aAGrCh6F,KAAKg6F,kBAAkBC,mBACzC,CAEAF,WAAWxzE,GACP,OAAO7hB,EAAE,UACJmf,SAAS,MAAQ0C,EAAKrM,WACtBnH,KAAK,QAASwT,EAAKjT,KAC5B,CAEAomF,gBACI,OAAO15F,KAAKsD,KAAKyb,iBACZnT,QAAOuU,GAAS,CAAC,qBAAsB,aAAahX,SAASgX,EAAM7M,OAC5E,EC9KW,MAAM4mF,WAA2B,IAC5CnmD,YACI,OAAOnxC,MAAMmxC,aACa,WAAnB/zC,KAAKsD,KAAKG,IACrB,CAEAqwC,WACI9zC,KAAKwiB,QAAU9d,EAvCX,gqBAwCJ1E,KAAKwzC,eACLxzC,KAAK6sB,SAAW7sB,KAAKwiB,QAAQjW,KAAK,iCAClCvM,KAAKm6F,WAAan6F,KAAKwiB,QAAQjW,KAAK,sBACpCvM,KAAKo6F,gBAAkBp6F,KAAKwiB,QAAQjW,KAAK,2BAC7C,CAEAlN,sBAAsBiE,GAClBtD,KAAK6sB,SAASlK,QACd3iB,KAAKm6F,WAAWhtE,OAAyC,IAAlC7pB,EAAKkZ,kBAAkB/Z,UAAkBa,EAAKytB,qBACrE/wB,KAAKo6F,gBAAgBjtE,QAAQ7pB,EAAKytB,qBAElC,MAAMyhE,EAAmB,IAAI,GAAiBxyF,KAAK6sB,SAAUvpB,EAAMA,EAAKkZ,mBAAmB,SACrFg2E,EAAiBpB,YAC3B,CAEAiJ,sBAAqB,MAAC56F,IACbO,KAAKy0C,cAAch1C,IAIxBO,KAAK80C,SACT,CAEA49C,oBAAmB,QAACvgF,IACZA,EAAQhJ,SAASnJ,KAAKT,SACtBS,KAAK80C,SAEb,ECpEW,MAAMwlD,WAA2B98C,EAC5C76C,cACIC,QAEA5C,KAAKslB,MAAM,uBACXtlB,KAAK2jB,IAAI,WAAY,QACrB3jB,KAAK2jB,IAAI,kBAAmB,UAC5B3jB,KAAK2jB,IAAI,WAAY,WACzB,CAEAqxB,qBAAoB,YAAC91C,IAEjBc,KAAKd,YAAcA,CACvB,CAEAG,yBAAwB,YAACH,EAAW,SAAEY,IAClCE,KAAKwiB,QAAQqhD,UAAU,EAC3B,CAEAxkE,qCAAoC,YAACH,EAAW,SAAEY,IAC9CE,KAAKd,YAAcA,EAEnBc,KAAKwiB,QAAQqhD,UAAU,EAC3B,CAEAxkE,iCAAgC,YAACH,IAC7Bc,KAAKd,YAAcA,CACvB,CAEAsX,sBAAsBlD,EAAMpB,GACxB,GAAa,gCAAToB,GACOtT,KAAKd,aACLc,KAAKd,YAAYO,QAAUyS,EAAKhT,YAAYO,MAAO,CAE1D,MAAMokE,EAAY7jE,KAAKwiB,QAAQqhD,YAEzB15D,EAAUvH,MAAM4T,sBAAsBlD,EAAMpB,GAKlD,OAFA/H,EAAQa,MAAK,IAAMrC,YAAW,IAAM3I,KAAKwiB,QAAQqhD,UAAUA,IAAY,OAEhE15D,CACX,CAEI,OAAOvH,MAAM4T,sBAAsBlD,EAAMpB,EAEjD,CAEAqoF,0BAAyB,SAACrrF,IACtBlP,KAAKwiB,QAAQqhD,UAAU30D,EAC3B,EClDW,MAAMsrF,WAAsB98C,EACvC/6C,cACIC,MAAM,OAEN5C,KAAKsmB,GAAG,eACRtmB,KAAK2jB,IAAI,SAAU,OACvB,ECLJ,MAAM82E,GAAyB,CAC3B5hF,MAAO,CAAC,EACRF,YAAa,CAAC,GAGlB,SAAS0hB,GAAU52B,GACf,GAAa,UAATA,GAA6B,gBAATA,EACpB,MAAM,IAAI+J,MAAM,sBAAsB/J,yCAE9C,CAoBAE,EAAA,uBAAuBtE,UACE,sBAAjBqN,EAAQjJ,OAIZ42B,GAAU3tB,EAAQigB,YAElB8tE,GAAuB/tF,EAAQigB,YAAYjgB,EAAQkgB,UAAYlgB,EAE/D,uBAAwB,oBAAqB,CACzCigB,WAAYjgB,EAAQigB,WACpBC,SAAUlgB,EAAQkgB,SAClB8tE,eAAgBhuF,EAAQguF,eACxB//D,SAAUjuB,EAAQiuB,WACpB,IAGN,SAnCA,SAAmChO,EAAYC,GAG3C,OAFAyN,GAAU1N,GAEH8tE,GAAuB9tE,GAAYC,EAC9C,EA+BA,GA7BA,SAAkCD,EAAYC,GAC1CyN,GAAU1N,UAEH8tE,GAAuB9tE,GAAYC,EAC9C,EAyBA,GAvBA,SAA4BD,EAAYC,GACpCyN,GAAU1N,UAEH8tE,GAAuB9tE,GAAYC,EAC9C,ECRe,MAAM+tE,WAAsC,IACvD5mD,YACI,MAAM,WAAEpnB,EAAU,SAAEC,GAAa5sB,KAAK46F,YAEtC,OAAOh4F,MAAMmxC,eAAiB,GAAsCpnB,EAAYC,EACpF,CAEAknB,WACI9zC,KAAKwiB,QAAU9d,EA1BX,8kBA4BJ1E,KAAK66F,UAAY76F,KAAKwiB,QAAQjW,KAAK,cACnCvM,KAAK86F,kBAAoB96F,KAAKwiB,QAAQjW,KAAK,uBAC3CvM,KAAK+6F,kBAAoB/6F,KAAKwiB,QAAQjW,KAAK,uBAE3CvM,KAAK+6F,kBAAkBxmF,GAAG,SAASlV,UAC/B,MAAM,WAAEstB,EAAU,SAAEC,GAAa5sB,KAAK46F,kBAEhCr3F,EAAA,OAAY,GAAGopB,KAAcC,yBAAiC,CAChE+N,SAAU36B,KAAK66F,UAAUt1E,SAG7B,GAAqCoH,EAAYC,GACjD5sB,KAAK80C,SAAS,IAGlB90C,KAAKg7F,wBAA0Bh7F,KAAKwiB,QAAQjW,KAAK,8BACjDvM,KAAKg7F,wBAAwBzmF,GAAG,SAAS,KACrC,MAAM,WAAEoY,EAAU,SAAEC,GAAa5sB,KAAK46F,YAEtC,GAA+BjuE,EAAYC,GAC3C5sB,KAAK80C,SAAS,GAEtB,CAEAz1C,sBAAsBiE,GAClB,MAAM,WAAEqpB,EAAU,SAAEC,GAAa5sB,KAAK46F,YAChC52D,EAAS,GAAsCrX,EAAYC,GAEjE5sB,KAAK66F,UAAUt1E,KAAKye,EAAOrJ,UAC3B36B,KAAK86F,kBAAkBv1E,KAAK+I,MAAM2sE,KAAKj3D,EAAO02D,eAAiB,KAAMnsE,OAAO,YAChF,CAEAqsE,YACI,IAAK56F,KAAKd,YACN,MAAO,CAAC,EAGZ,MAAM,UAAEC,GAAca,KAAKd,YAE3B,MAA2B,gBAAvBC,EAAU4B,UAA8B5B,EAAUoL,aAC3C,CACHoiB,WAAY,cACZC,SAAUztB,EAAUoL,cAGjB,CACHoiB,WAAY,QACZC,SAAU5sB,KAAKT,OAG3B,CAEA27F,uBAAuBhpF,GAAO+C,QAAQY,IAAI3D,GACtC,MAAM,WAAEya,EAAU,SAAEC,GAAa5sB,KAAK46F,YAElC1oF,EAAKya,aAAeA,GAAcza,EAAK0a,WAAaA,GACpD5sB,KAAK80C,SAEb,ECpFW,MAAMqmD,WAAqB,IACtCx4F,YAAYy4F,EAAW,EAAGC,EAAe,KACrCz4F,QAEA5C,KAAKo7F,SAAWA,EAChBp7F,KAAKq7F,aAAeA,CACxB,CAEAvnD,WACI9zC,KAAKwiB,QAAU9d,EAXX,8BAYJ1E,KAAKwiB,QAAQmB,IAAI,aAAc3jB,KAAKo7F,UACpCp7F,KAAKwiB,QAAQmB,IAAI,YAAa3jB,KAAKq7F,cACnCr7F,KAAKwiB,QAAQmB,IAAI,cAAe,KAEhC3jB,KAAKwiB,QAAQjO,GAAG,eAAe7L,IAC3B1I,KAAKwiB,QAAQwI,QAAQ,QAErB,SAAiB,CACbtH,EAAGhb,EAAEic,MACLnB,EAAG9a,EAAEkc,MACL/B,MAAO,CACH,CAACvY,MAAO,QAASua,QAAS,uBAAwBZ,OAAQ,kBAE9DM,sBAAuB,EAAEM,cACrB,yBAA0BA,EAAQ,KAInC,IAEf,ECOW,MAAMy2E,WAA0B,IAC3CxnD,WA0CI,OAzCA9zC,KAAKwiB,QAAU9d,EArCX,y7BAuCJ1E,KAAK01F,cAAgB11F,KAAKwiB,QAAQjW,KAAK,kBACvCvM,KAAK4sC,cAAgB5sC,KAAKwiB,QAAQjW,KAAK,kBACvCvM,KAAKu7F,gBAAkBv7F,KAAKwiB,QAAQjW,KAAK,kBACzCvM,KAAKu7F,gBAAgBp9C,WAErBn+C,KAAKwiB,QAAQjW,KAAK,wBAAwBgI,GAAG,qBAAqB,IAAMvU,KAAKmgC,WAE1El/B,EAAA,oBACCjB,KAAK01F,cAAc8F,SAAQ9yF,IACR,KAAZA,EAAE2b,QACGrkB,KAAK4sC,cAAcxT,GAAG,YACtBp5B,KAAKmgC,SAELngC,KAAKu7F,gBAAgBp9C,SAAS,QAElCz1C,EAAE+tB,iBACF/tB,EAAE0b,kBACN,IAIR,mBAA+BpkB,KAAK01F,cAAe,UAAU,KACrD11F,KAAK4sC,cAAcxT,GAAG,YACtBp5B,KAAKmgC,SAELngC,KAAKu7F,gBAAgBp9C,SAAS,QAGlCn+C,KAAK01F,cAAct9D,OAAO,IAG9B,mBAA+Bp4B,KAAK01F,cAAe,QAAQ,KACvD11F,KAAK4sC,cAAcrgC,KAAK,wBAAwB6rB,OAAO,IAG3D,mBAA+Bp4B,KAAK01F,cAAe,OAAO,KACtD11F,KAAKu7F,gBAAgBp9C,SAAS,OAAO,IAGlCn+C,KAAKwiB,OAChB,CAEAnjB,eACI,MAAMK,EAAeM,KAAK01F,cAActwE,MAAMpL,OAE9C,IAAKta,EAED,YADAM,KAAKu7F,gBAAgBp9C,SAAS,QAIlCn+C,KAAK4sC,cAAcjqB,QACnB3iB,KAAK4sC,cAAcjoC,OAAO,iGAE1B,MAAM,oBAAC+rB,EAAmB,MAAEjqB,SAAelD,EAAA,MAAW,gBAAgB0oB,mBAAmBvsB,MAErF+G,IACAzG,KAAK01F,cAAc1qE,QAAQ,CACvBlmB,QAAS,SACTwF,MAAO,iBAAiB7D,IACxB+yB,UAAW,UAGfx5B,KAAK01F,cAAc1qE,QAAQ,QAE3BriB,YAAW,IAAM3I,KAAK01F,cAAc1qE,QAAQ,YAAY,MAG5D,MAAMywE,EAAmB/qE,EAAoB1f,MAAM,EAAG6G,KAAK2xC,IAzEvC,GAyEgE94B,EAAoBjuB,SAExGzC,KAAK4sC,cAAcjqB,QAEa,IAA5B84E,EAAiBh5F,QACjBzC,KAAK4sC,cAAcjoC,OAAO,sDAG9B,IAAK,MAAMrB,WAAczD,EAAA,iBAAe47F,GAAmB,CACvD,MAAMv3E,QAAc,eAAuB5gB,EAAK/D,OAAQ,CAACk4B,cAAc,IACvEvT,EAAML,SAAS,iBACfK,EAAMnR,KAAK,WAAY,KACvBmR,EAAM3P,GAAG,SAAS7L,IACd1I,KAAKu7F,gBAAgBp9C,SAAS,QAEzBz1C,EAAEiK,QAAgC,MAAtBjK,EAAEiK,OAAOszC,UAEtB,wCAAyC78C,QAAQ9F,EAAK/D,OAC1D,IAEJ,mBAA+B2kB,EAAO,UAAU,KAC5ClkB,KAAKu7F,gBAAgBp9C,SAAS,QAE9B,wCAAyC/0C,QAAQ9F,EAAK/D,OAAO,IAGjES,KAAK4sC,cAAcjoC,OAAOuf,EAC9B,CAEIwM,EAAoBjuB,OAtGJ,IAuGhBzC,KAAK4sC,cAAcjoC,OAAO,iDAAiD+rB,EAAoBjuB,OAvG/E,iBA0GpB,MAAMi5F,EAAoBh3F,EAAE,0CACvBC,OAAOD,EAAE,+CAEd1E,KAAK4sC,cAAcjoC,OAAO+2F,GAE1BA,EAAkBnnF,GAAG,SAAS,IAAMvU,KAAK27F,qBAEzC,mBAA+BD,EAAmB,UAAU,IAAM17F,KAAK27F,qBAEvE,mBAA+B37F,KAAK4sC,cAAcrgC,KAAK,wBAAyB,MAAM,IAAMvM,KAAK01F,cAAct9D,UAE/Gp4B,KAAKu7F,gBAAgBp9C,SAAS,SAClC,CAEA9+C,yBACIW,KAAKu7F,gBAAgBp9C,SAAS,cAExB,yBAA0B,cAAe,CAC3Cz+C,aAAcM,KAAK01F,cAActwE,OAEzC,CAEAw2E,mBACI57F,KAAK01F,cAAct9D,OACvB,ECxKW,MAAMyjE,WAA2Bn+C,EAC5C/6C,YAAYm5F,GACRl5F,MAAM,OAEN5C,KAAK87F,cAAgBA,EACrB97F,KAAK+7F,QAAU,CAAC,EAEhB/7F,KAAKslB,MAAM,+BACXtlB,KAAK2jB,IAAI,YAAa,KACtB3jB,KAAKyzC,aACT,CAEAp0C,kCAAiC,YAACH,IAC9B,MAAMqqB,EAASvpB,KAAK87F,gBAEdznF,EAAkBkV,EAAOjV,SAE/BD,EAAgBtB,KAAK,cAAe7T,EAAYO,OAChD4U,EAAgBE,GAAG,SAAS,IAAM,yCAA0CrV,EAAYO,SAExFO,KAAKwiB,QAAQ7d,OAAO0P,GAEpBkV,EAAO1U,YAAY,yBAEnB0U,EAAO4qB,WAAU,GAEjBn0C,KAAK+7F,QAAQ78F,EAAYO,OAAS8pB,QAE5BA,EAAO1U,YAAY,iBAAkB,CAAE3V,gBAE7Cc,KAAKmO,MAAMob,EACf,CAEAlqB,6BAA4B,MAACI,EAAK,SAAEK,EAAQ,cAAEe,EAAa,UAAE1B,IACzD,MAAM6H,EAAY,4CAA6CvH,MAE1DA,IACDmJ,SAAS,gBAETnJ,EAAQuH,GAGZnG,EAAgBA,GAAiB,wCAAyCA,cAE1E,MAAM3B,QAAoB,kCAAmC,KAAM2B,EAAemG,GAG5EyH,EAAS,mCAAmC0B,GAAKA,EAAE1Q,QACpDmM,QAAO0a,GAAMA,IAAOpnB,EAAYO,QAGrCgP,EAAOyzC,OAAOzzC,EAAOsnB,QAAQt2B,GAAS,EAAG,EAAGP,EAAYO,OAExDO,KAAKgI,eAAe,qBAAsB,CAACsH,cAAeb,IAG1DzO,KAAKwiB,QAAQjW,KAAK,iBAAiBrN,EAAYO,WAC1Cu8F,YAAYh8F,KAAKwiB,QAAQjW,KAAK,iBAAiB9M,cAE9C,yCAA0CP,EAAYO,OAExDK,QACMZ,EAAYkK,QAAQtJ,EAAUX,SAG9BD,EAAYkI,UAE1B,CAEA60F,2BAA0B,MAACx8F,IACvB,uCAAwCA,EAC5C,CAEAJ,gCAA+B,MAACI,EAAK,aAAEy8F,IACnC,IAAKz8F,EAED,YADAmJ,SAAS,gBAIb,MAAMwG,EAAW,kCAEXm+C,EAAen+C,EAAST,WAAUwB,GAAKA,EAAE1Q,QAAUA,IACnD08F,EAAYD,EAAe3uC,EAAe,EAAIA,EAEpD,IAAsB,IAAlBA,GAAuB4uC,EAAY,GAAKA,EAAY,GAAK/sF,EAAS3M,OAElE,YADAmG,SAAS,kCAAkC2kD,iBAA4B4uC,uBAA+B/sF,EAAS3M,UAInH,GAAI2M,EAAS+sF,GAAW50F,WAAa6H,EAAS+sF,EAAY,GAAG50F,UAEzD,OAGJ,MAAMkH,EAASW,EAASzD,KAAIwE,GAAKA,EAAE1Q,QAC7B28F,EAAY,IACX3tF,EAAOuC,MAAM,EAAGmrF,GACnB1tF,EAAO0tF,EAAY,GACnB1tF,EAAO0tF,MACJ1tF,EAAOuC,MAAMmrF,EAAY,IAE1BE,GAAyBjtF,EAAS+sF,GAAWn1F,UAEnDhH,KAAKgI,eAAe,qBAAsB,CACtCsH,cAAe8sF,EACfvsF,aAAcwsF,EAAwB5tF,EAAO0tF,GAAa,KAC1DrsF,aAAcusF,EAAwB5tF,EAAO0tF,EAAY,GAAI,OAIjEn8F,KAAKwiB,QAAQjW,KAAK,iBAAiBkC,EAAO0tF,QACrCH,YAAYh8F,KAAKwiB,QAAQjW,KAAK,iBAAiBkC,EAAO0tF,EAAY,eAGjE,yCAA0CD,EAAeztF,EAAO0tF,EAAY,GAAK1tF,EAAO0tF,GAClG,CAEAr1F,4BACI9G,KAAK80C,SACT,CAEAmZ,gCACIjuD,KAAK80C,SACT,CAEAiY,yBAAwB,OAACt+C,IACrBzO,KAAKoL,SAAWpL,KAAKoL,SAASQ,QAAOuE,IAAM1B,EAAOtF,SAASgH,EAAE1Q,SAE7D,IAAK,MAAMA,KAASgP,EAChBzO,KAAKwiB,QAAQjW,KAAK,iBAAiB9M,OAAWu6B,gBAEvCh6B,KAAK+7F,QAAQt8F,EAE5B,CAEA0uD,uBAAsB,MAAC1uD,EAAK,WAAE0R,SACZxJ,IAAVlI,QAAsCkI,IAAfwJ,GAI3BnR,KAAKwiB,QAAQjW,KAAK,iBAAiB9M,OAC9Bu8F,YAAYh8F,KAAKwiB,QAAQjW,KAAK,iBAAiB4E,OACxD,CAEA9R,gBACIW,KAAKm0C,WAAU,EACnB,CAEAH,UAAU7M,GAAO,CAEjBgN,UAAUhN,GACN,MAAMm1D,EAAoB,4CACpBhxF,EAAcgxF,EAAoBA,EAAkB78F,MAAQ,KAElE,IAAK,MAAMA,KAASO,KAAK+7F,QAAS,CAC9B,MAAM78F,EAAc,wCAAyCO,GAE9CO,KAAK+7F,QAAQt8F,GACrB00C,UAAUhN,GAAQ77B,GAAe,CAACpM,EAAYO,MAAOP,EAAY8H,WAAWmC,SAASmC,GAChG,CACJ,CAOAkL,sBAAsBlD,EAAMpB,GACxB,GAAI,CAAC,eAAgB,4BAA4B/I,SAASmK,GAAO,CAE7D,MAAMiW,EAASvpB,KAAK+7F,QAAQ7pF,EAAKhT,YAAYO,OAE7C,OAAK8pB,IAIDA,EAAOgzE,qBACK,6BAATjpF,GACA,8CAAiDpB,EAAKhT,YAAYuJ,mBAErE8gB,EAAOgzE,qBAAsB,EAEtB,CACHhzE,EAAO1U,YAAY,eAAgB3C,GACnClS,KAAKw8F,gBAAgBtqF,KAXlBjI,QAAQC,SAiBvB,CAEA,MAAa,yBAAToJ,EACOtT,KAAKw8F,gBAAgBtqF,GAErBtP,MAAM4T,sBAAsBlD,EAAMpB,EAEjD,CAEAsqF,gBAAgBtqF,GACZ,MAAMwE,EAAW,GAEjB,IAAK,MAAM+lF,KAAcvqF,EAAKhT,YAAYuJ,iBAAiBH,iBAAkB,CACzE,MAAMihB,EAASvpB,KAAK+7F,QAAQU,EAAWh9F,OAElC8pB,EAAOgzE,sBACRhzE,EAAOgzE,qBAAsB,EAE7B7lF,EAASpK,KAAKid,EAAO1U,YAAY,uBAAwB,CAAC3V,YAAau9F,KAE/E,CAIA,OAFAz8F,KAAK80C,UAEE7qC,QAAQwM,IAAIC,EACvB,ECxNJ,IAAIgmF,GACAC,GA0DJ,SAxDA,SAA8BC,GAQ1B,GAPIF,KACAA,GAAa7yC,UACb6yC,GAAe,MAGnBh4F,EAAE,cAAcyoB,OAAOyvE,IAElBA,EAGD,YAFAl4F,EAAE,cAAcif,IAAI,QAAS,QAKjC,IAAIk5E,EAAgBr8F,EAAA,SAAe,mBAC9Bq8F,GAAiBA,EAAgB,KAClCA,EAAgB,GAGhBD,IACAF,GAAeI,MAAM,CAAC,aAAc,cAAe,CAC/CC,MAAO,CAACF,EAAe,IAAMA,GAC7BG,WAAY,EACZC,UAAWF,GAASv8F,EAAA,OAAa,gBAAiBqX,KAAKC,MAAMilF,EAAM,OAG/E,EA8BA,GA5BA,WACQJ,KACAA,GAAc9yC,UACd8yC,GAAgB,MAGpB,MAAMO,EAAmBx4F,EAAE,eAAe00B,GAAG,YAE7C,IAAK8jE,EAGD,YAFAx4F,EAAE,gBAAgBif,IAAI,QAAS,QAKnC,IAAIw5E,EAAiB38F,EAAA,SAAe,oBAC/B28F,GAAkBA,EAAiB,KACpCA,EAAiB,GAGjBD,IACAP,GAAgBG,MAAM,CAAC,eAAgB,eAAgB,CACnDC,MAAO,CAAC,IAAMI,EAAgBA,GAC9BH,WAAY,EACZC,UAAWF,GAASv8F,EAAA,OAAa,iBAAkBqX,KAAKC,MAAMilF,EAAM,OAGhF,ECrDe,MAAMK,WAA6B,IAC9CrpD,YACI,OAAO,CACX,CAEApxC,cACIC,QAEA5C,KAAKq9F,SAAW,CACZC,eAAgB,QAChBhzF,MAAO,KACPic,KAAM,KACNg3E,cAAe,KAEvB,CAEAzpD,WACI9zC,KAAKwiB,QAAU9d,EArBX,2FAuBA1E,KAAKq9F,SAASE,eACdv9F,KAAKwiB,QAAQjO,GAAG,eAAe7L,IAC3B1I,KAAKwiB,QAAQwI,QAAQ,QAErBhrB,KAAKq9F,SAASE,cAAc70F,IAErB,KAIf1I,KAAKwiB,QAAQzP,KAAK,iBAAkB/S,KAAKq9F,SAASC,gBAElDt9F,KAAKwiB,QAAQwI,QAAQ,CACjBrF,MAAM,EACNrb,MAAO,IAAMtK,KAAKsmE,WAClBxhE,QAAS,UAGblC,MAAMkxC,UACV,CAEAwyB,WACI,MAAsC,mBAAxBtmE,KAAKq9F,SAAS/yF,MACtBtK,KAAKq9F,SAAS/yF,QACdtK,KAAKq9F,SAAS/yF,KACxB,CAEAkzF,cACI,IAAK,MAAMtjF,KAAala,KAAKwiB,QAAQ,GAAGmmC,UAChCzuC,EAAUhS,WAAW,QACrBlI,KAAKwiB,QAAQ4pC,YAAYlyC,GAIjC,MAAMqM,EAAqC,mBAAvBvmB,KAAKq9F,SAAS92E,KAC5BvmB,KAAKq9F,SAAS92E,OACdvmB,KAAKq9F,SAAS92E,KAEpBvmB,KAAKwiB,QAAQqB,SAAS0C,EAC1B,CAEAk3E,6BACIz9F,KAAKw9F,aACT,CAGAj3E,KAAKA,GAED,OADAvmB,KAAKq9F,SAAS92E,KAAOA,EACdvmB,IACX,CAGAsK,MAAMA,GAEF,OADAtK,KAAKq9F,SAAS/yF,MAAQA,EACftK,IACX,CAGAs9F,eAAe9jE,GAEX,OADAx5B,KAAKq9F,SAASC,eAAiB9jE,EACxBx5B,IACX,CAEAu9F,cAAcj5E,GAEV,OADAtkB,KAAKq9F,SAASE,cAAgBj5E,EACvBtkB,IACX,ECxFJ,IAAIkzB,GAEJ,uBAAoCloB,MAAK0yF,GAAMxqE,GAAUwqE,IAE1C,MAAMC,WAA4BP,GAC7CtpD,WACIlxC,MAAMkxC,WAEF9zC,KAAKq9F,SAASx4E,QACd7kB,KAAKwiB,QAAQjO,GAAG,SAAS,KACrBvU,KAAKwiB,QAAQwI,QAAQ,QAErBhrB,KAAKgI,eAAehI,KAAK49F,SAAS,IAGtC3oF,QAAQmhB,KAAK,kBAAkBp2B,KAAK8V,sCAAuC9V,KAAKq9F,SAExF,CAEA/2B,WACI,MAAMh8D,EAAQ1H,MAAM0jE,WAEdjlE,EAAS6xB,GAAQ3mB,MAAKonE,GAAOA,EAAIxgD,aAAenzB,KAAK49F,WAE3D,OAAIv8F,GAAUA,EAAO+xB,mBAAmB3wB,OAAS,EACtC,GAAG6H,MAAUjJ,EAAO+xB,mBAAmB1hB,KAAK,SAE5CpH,CAEf,CAEAuzF,QAAQv5E,GAEJ,OADAtkB,KAAKq9F,SAASQ,QAAUv5E,EACjBtkB,IACX,CAMA6kB,QAAQA,GAEJ,OADA7kB,KAAKq9F,SAASx4E,QAAUA,EACjB7kB,IACX,CAEI49F,eACA,MAAwC,mBAA1B59F,KAAKq9F,SAASx4E,QACtB7kB,KAAKq9F,SAASx4E,UACd7kB,KAAKq9F,SAASx4E,OACxB,EChDW,MAAMi5E,WAA6BH,GAC9Ch7F,cACIC,QAEA5C,KAAKslB,MAAM,mBAEXtlB,KAAKq9F,SAAS92E,KAAO,IAAM/lB,EAAA,KAAW,mBAChC,mBACA,oBAENR,KAAKq9F,SAAS/yF,MAAQ,IAAM9J,EAAA,KAAW,mBACjC,OACA,OAENR,KAAKq9F,SAASx4E,QAAU,IAAMrkB,EAAA,KAAW,mBACnC,eACA,cACV,CAEAg9F,cACI56F,MAAM46F,cAEN,GAAkCh9F,EAAA,KAAW,mBACjD,CAEA+uD,uBAAsB,YAAC9lD,IACfA,EAAY+lC,iBAAiB,oBAC7BxvC,KAAKw9F,aAEb,EC/BW,MAAMO,WAA4BX,GAC7CtpD,WACIlxC,MAAMkxC,WAEF9zC,KAAKq9F,SAASQ,QACd79F,KAAKwiB,QAAQjO,GAAG,SAAS7L,IACrBA,EAAE0b,kBACFpkB,KAAKwiB,QAAQwI,QAAQ,QAErBhrB,KAAKq9F,SAASQ,QAAQ79F,KAAM0I,EAAE,IAGlCuM,QAAQmhB,KAAK,kBAAkBp2B,KAAK8V,4CAA6C9V,KAAKq9F,UAGtFr9F,KAAKq9F,SAASW,YACdh+F,KAAKwiB,QAAQjO,GAAG,YAAY7L,IACxB1I,KAAKwiB,QAAQwI,QAAQ,QAErBhrB,KAAKq9F,SAASW,WAAWh+F,KAAM0I,EAAE,GAG7C,CAEAm1F,QAAQv5E,GAEJ,OADAtkB,KAAKq9F,SAASQ,QAAUv5E,EACjBtkB,IACX,CAEAg+F,WAAW15E,GAEP,OADAtkB,KAAKq9F,SAASW,WAAa15E,EACpBtkB,IACX,EChCW,MAAMi+F,WAAyBF,GAC1Cp7F,cACIC,QAEA5C,KAAKumB,KAAK,iBACLjc,MAAM,QACNgzF,eAAe,UACfO,SAAQt0E,GAAUA,EAAOvhB,eAAe,mBAAoB,CAAEvI,MAAO8pB,EAAOgrB,sBAC5EjvB,MAAM,cACf,ECTW,MAAM44E,WAAwBH,GACzChqD,YACI,OAAOnxC,MAAMmxC,aAEN/zC,KAAKd,eAAiBc,KAAKd,YAAY8H,SAClD,CAEA3H,+BAA8B,cAACiQ,IAC3BtP,KAAK80C,SACT,CAEAnyC,cACIC,QAEA5C,KAAKumB,KAAK,QACLjc,MAAM,QACNgzF,eAAe,UACfO,SAAQ,CAACt0E,EAAQ7gB,KAGdA,EAAE0b,kBAEFmF,EAAOvhB,eAAe,qBAAsB,CAAEvI,MAAO8pB,EAAOgrB,mBAAoB,IAEnFjvB,MAAM,cACf,ECtBJ,MAAM64E,GAAa,CACf,CAAE16F,KAAM,OAAQ6G,MAAO,KAAM8zF,YAAY,GACzC,CAAE36F,KAAM,QAAS6G,MAAO,KAAM8zF,YAAY,GAC1C,CAAE36F,KAAM,SAAU6G,MAAO,QAAS8zF,YAAY,GAC9C,CAAE36F,KAAM,UAAWtD,KAAM,GAAImK,MAAO,OAAQ8zF,YAAY,GACxD,CAAE36F,KAAM,WAAYtD,KAAM,GAAImK,MAAO,MAAO8zF,YAAY,GACxD,CAAE36F,KAAM,MAAOtD,KAAM,GAAImK,MAAO,KAAM8zF,YAAY,GAClD,CAAE36F,KAAM,gBAAiBtD,KAAM,GAAImK,MAAO,KAAM8zF,YAAY,GAE5D,CAAE36F,KAAM,OAAQtD,KAAM,YAAamK,MAAO,KAAM8zF,YAAY,GAC5D,CAAE36F,KAAM,cAAetD,KAAM,mBAAoBmK,MAAO,MAAO8zF,YAAY,GAC3E,CAAE36F,KAAM,SAAUtD,KAAM,GAAImK,MAAO,OAAQ8zF,YAAY,GACvD,CAAE36F,KAAM,SAAUtD,KAAM,mBAAoBmK,MAAO,KAAM8zF,YAAY,GACrE,CAAE36F,KAAM,UAAWtD,KAAM,eAAgBmK,MAAO,OAAQ8zF,YAAY,GACpE,CAAE36F,KAAM,OAAQtD,KAAM,GAAImK,MAAO,IAAK8zF,YAAY,GAClD,CAAE36F,KAAM,UAAWtD,KAAM,GAAImK,MAAO,OAAQ8zF,YAAY,GACxD,CAAE36F,KAAM,OAAQtD,KAAM,aAAcmK,MAAO,KAAM8zF,YAAY,IAG3DC,GAA4BF,GAAWvyF,QAAO0yF,IAAOA,EAAGF,aAAYzyF,KAAI2yF,GAAMA,EAAG76F,OAmBxE,MAAM86F,WAAuB,IACxCzqD,WACI9zC,KAAKwiB,QAAU9d,EAnBX,ygBAqBJ1E,KAAKwiB,QAAQjO,GAAG,oBAAoB,IAAMvU,KAAKk5F,mBAE/Cl5F,KAAKw+F,kBAAoBx+F,KAAKwiB,QAAQjW,KAAK,uBAC3CvM,KAAKy+F,gBAAkBz+F,KAAKwiB,QAAQjW,KAAK,qBACzCvM,KAAK0+F,cAAgB1+F,KAAKwiB,QAAQjW,KAAK,mBAEvCvM,KAAKwiB,QAAQjO,GAAG,QAAS,kBACrB,IAAMvU,KAAKwiB,QAAQjW,KAAK,oBAAoB4xC,SAAS,WAC7D,CAEA9+C,sBAAsBiE,GAClBtD,KAAKy+F,gBAAgB9pF,KAAK,YACtB,IAAM0pF,GAA0Bl1F,SAAS7F,EAAKG,QAElDzD,KAAK0+F,cAAcn5E,WAAWvlB,KAAK2+F,cAAcr7F,EAAKG,KAAMH,EAAKnD,OAEjEH,KAAKy+F,gBAAgBtgD,SAAS,OAClC,CAGA9+C,uBACIW,KAAKw+F,kBAAkB77E,QAEvB,IAAK,MAAMwF,KAAYg2E,GAAWvyF,QAAO0yF,GAAMA,EAAGF,aAAa,CAC3D,MAAMQ,EAAYl6F,EAAE,6BACfqO,KAAK,iBAAkBoV,EAAS1kB,MAChCkB,OAAO,uCACPA,OAAOD,EAAE,YAAY6gB,KAAK4C,EAAS7d,QACnCiK,GAAG,SAAS7L,IACT,MAAMjF,EAAOm7F,EAAU7rF,KAAK,kBACtBoV,EAAWg2E,GAAW5xF,MAAK+xF,GAAMA,EAAG76F,OAASA,IAEnDzD,KAAK88B,KAAK3U,EAAS1kB,KAAM0kB,EAAShoB,KAAK,IAG3CH,KAAKsD,KAAKG,OAAS0kB,EAAS1kB,MAC5Bm7F,EAAU/6E,SAAS,YAGvB7jB,KAAKw+F,kBAAkB75F,OAAOi6F,GAER,SAAlBz2E,EAAS1kB,MACTzD,KAAKw+F,kBAAkB75F,OAAO,uCAEtC,CAEA,IAAK,MAAMswE,WAAkB,kBAAiC,CAC1D,IAAKA,EAASzwD,QACV,SAGJ,MAAMq6E,EAAYn6F,EAAE,6BACfqO,KAAK,iBAAkBkiE,EAAS90E,MAChCwE,OAAO,uCACPA,OAAOD,EAAE,UAAU6gB,KAAK0vD,EAAS3qE,QACjCiK,GAAG,SAAS7L,IACT,MAAMwb,EAAQxf,EAAEgE,EAAEiK,QAAQ+B,QAAQ,kBAElC1U,KAAK88B,KAAK,OAAQ5Y,EAAMnR,KAAK,kBAAkB,IAGhC,SAAnB/S,KAAKsD,KAAKG,MAAmBzD,KAAKsD,KAAKnD,OAAS80E,EAAS90E,OACzD0+F,EAAUh7E,SAAS,YAEnB7jB,KAAK0+F,cAAcn5E,KAAK0vD,EAAS3qE,QAGrCtK,KAAKw+F,kBAAkB75F,OAAOk6F,EAClC,CACJ,CAEAx/F,oBAAoBoE,EAAMtD,GACtB,GAAa,SAATsD,EAAiB,CACjB,MACMq7F,SADkB,mBACAvyF,MAAKu7D,GAAMA,EAAG3nE,OAASA,IAE/C,OAAO2+F,EAAQA,EAAMx0F,MAAQnK,CACjC,CACK,CACD,MAAMgoB,EAAWg2E,GAAW5xF,MAAK+xF,GAAMA,EAAG76F,OAASA,IAEnD,OAAO0kB,EAAWA,EAAS7d,MAAQ7G,CACvC,CACJ,CAEApE,WAAWoE,EAAMtD,GACTsD,IAASzD,KAAKsD,KAAKG,MAAQtD,IAASH,KAAKsD,KAAKnD,OAI9CsD,IAASzD,KAAKsD,KAAKG,YAAezD,KAAK++F,iCAIrCx7F,EAAA,MAAW,SAASvD,KAAKT,cAAe,CAAEkE,OAAMtD,QAC1D,CAEAd,+BACI,MAAMgK,QAAarJ,KAAKsD,KAAKgG,UAE7B,OAAKD,EAAK7F,UAAY6F,EAAK7F,QAAQwW,OAAOvX,cAI7Bm+B,EAAA,UAAsB,8BACvC,CAEAvhC,6BAA4B,YAACoK,IACrBA,EAAYC,eAAe1J,KAAKT,SAChCS,KAAK80C,SAEb,EC/DW,MAAMkqD,WAAqB,IACtClrD,WACI9zC,KAAKwiB,QAAU9d,EA/FX,qrEAiGJ1E,KAAKi/F,UAAYj/F,KAAKwiB,QAAQjW,KAAK,cACnCvM,KAAKk/F,cAAgBl/F,KAAKwiB,QAAQjW,KAAK,mBACvCvM,KAAKm/F,gBAAkBn/F,KAAKwiB,QAAQjW,KAAK,qBAEzCvM,KAAKm/F,gBAAgB5qF,GAAG,SAAS,IAAMvU,KAAKmtB,QAAO,KAEnDntB,KAAKo/F,WAAap/F,KAAKwiB,QAAQjW,KAAK,eACpCvM,KAAKq/F,eAAiBr/F,KAAKwiB,QAAQjW,KAAK,oBACxCvM,KAAKs/F,iBAAmBt/F,KAAKwiB,QAAQjW,KAAK,sBAE1CvM,KAAKs/F,iBAAiB/qF,GAAG,SAAS,IAAMvU,KAAKmtB,QAAO,KAEpDntB,KAAK6rF,YAAc7rF,KAAKwiB,QAAQjW,KAAK,sBACzC,CAEA4gB,OAAOyvD,GACCA,EACA58E,KAAKu/F,WAELv/F,KAAKw/F,WAEb,CAEAA,YAAa,CACbD,WAAY,ECxHD,MAAME,WAAkCT,GACnDlrD,WACIlxC,MAAMkxC,WAEN9zC,KAAKk/F,cAAc35E,KAAK,QACxBvlB,KAAKm/F,gBAAgBpsF,KAAK,QAAS,oBAEnC/S,KAAKq/F,eAAe95E,KAAK,UACzBvlB,KAAKs/F,iBAAiBvsF,KAAK,QAAS,oBACxC,CAEAwsF,WACI,gBAAoCv/F,KAAKT,QAAQ,GAAM,EAC3D,CAEAigG,YACI,gBAAoCx/F,KAAKT,QAAQ,GAAO,EAC5D,CAEAF,sBAAsBiE,GAClBtD,KAAKi/F,UAAU9xE,QAAQ7pB,EAAKI,aAC5B1D,KAAKo/F,WAAWjyE,SAAS7pB,EAAKI,YAClC,CAEA6rD,uBAAsB,YAAC9lD,IACfA,EAAYC,eAAe1J,KAAKT,SAChCS,KAAK80C,SAEb,ECSW,MAAM4qD,WAAgC,IACjD5rD,WACI9zC,KAAKwiB,QAAU9d,EAvCX,4tCAyCJ1E,KAAK2/F,uBAAyB3/F,KAAKwiB,QAAQjW,KAAK,4BAEhDvM,KAAKwiB,QAAQjO,GAAG,QAAS,kBACrBlV,UACAW,KAAKwiB,QAAQjW,KAAK,oBAAoB4xC,SAAS,UAE/C,MAAMyhD,EAAcl7F,EAAEgE,EAAEiK,QAAQ+B,QAAQ,sBAAsB3B,KAAK,oBAEnE,IAAK,MAAM8sF,KAAa7/F,KAAKsD,KAAKyb,iBAC1B,CAAC,WAAY,wBAAwB5V,SAAS02F,EAAUvsF,aAClD,sBAAqCtT,KAAKT,OAAQsgG,EAAU1sF,aAItD,SAAhBysF,SACM,WAA0B5/F,KAAKT,OAAQqgG,EACjD,GAER,CAEAvgG,sBAAsBiE,GAClB,IAAIs8F,EAAc,OAEd5/F,KAAKsD,KAAK6E,cAAc,YACxBy3F,EAAc,WAET5/F,KAAKsD,KAAK6E,cAAc,0BAC7By3F,EAAc,wBASlB5/F,KAAKwiB,QAAQjW,KAAK,kBAAkB6/C,YAAY,YAChDpsD,KAAKwiB,QAAQjW,KAAK,oCAAoCqzF,OAAiB/7E,SAAS,YAEhF7jB,KAAK2/F,uBAAuBp6E,KATb,CACX,KAAQ,KACR,SAAY,KACZ,qBAAwB,UAMYq6E,GAC5C,CAEArwC,uBAAsB,YAAC9lD,IACfA,EAAY4J,mBAAmB9G,MAAKwG,GAAQA,EAAKxT,SAAWS,KAAKT,UACjES,KAAK80C,SAEb,ECtFW,MAAMgrD,WAA6Bd,GAC9CjrD,YACI,OAAOnxC,MAAMmxC,cAEL,CAAC,OAAQ,WAAW5qC,SAASnJ,KAAKT,OAC9C,CAEAu0C,WACIlxC,MAAMkxC,WAEN9zC,KAAKk/F,cAAc35E,KAAK,MACxBvlB,KAAKm/F,gBAAgBpsF,KAAK,QAAS,kBAEnC/S,KAAKq/F,eAAe95E,KAAK,MACzBvlB,KAAKs/F,iBAAiBvsF,KAAK,QAAS,OACxC,CAEA1T,aAAau9E,GACT,MAAMt2E,QAAa/C,EAAA,MAAW,SAASvD,KAAKT,0CAA0Cq9E,KAEjFt2E,EAAKC,SACN,oBAAuBD,EAAKoG,QAEpC,CAEArN,sBAAsBiE,GAClB,MAAMy8F,IAAiBz8F,EAAKqY,oBAAoBpP,MAAKoD,GAAwB,iBAAnBA,EAAEtI,eAE5DrH,KAAKi/F,UAAU9xE,QAAQ4yE,GACvB//F,KAAKo/F,WAAWjyE,OAAO4yE,EAC3B,CAEAxwC,uBAAsB,YAAC9lD,IACfA,EAAYmlC,gBAAgBriC,MAAKoD,GAAKA,EAAEpQ,SAAWS,KAAKT,UACxDS,KAAK80C,SAEb,ECpBJ,SAjBAz1C,eAAuB2gG,GAAsB,GACzC,MAAMltE,QAAevvB,EAAA,OAAY,YAE7BuvB,EAAOvsB,QACP,sBAAyB,UAGrBusB,EAAOpmB,QAAQjK,OAAS,MACxBqwB,EAAOpmB,QAAU,GAAGomB,EAAOpmB,QAAQspB,OAAO,EAAG,WAG5CgqE,GAA4C,mBAArBltE,EAAOmtE,WAC/B,oBAAuB,gBAAgBntE,EAAOpmB,WAG1D,ECXe,MAAMwzF,WAA2BlB,GAC5CjrD,YACI,OAAOnxC,MAAMmxC,cACL,CAAC,OAAQ,SAAU,WAAW5qC,SAASnJ,KAAKT,OACxD,CAEAu0C,WACIlxC,MAAMkxC,WAEN9zC,KAAKk/F,cAAc35E,KAAK,MACxBvlB,KAAKm/F,gBAAgBpsF,KAAK,QAAS,QAEnC/S,KAAKq/F,eAAe95E,KAAK,MACzBvlB,KAAKs/F,iBAAiBvsF,KAAK,QAAS,UAEpC/S,KAAK6rF,YAAY94E,KAAK,iBAAkB,WAAWo0B,OACnDnnC,KAAK6rF,YAAYt3E,GAAG,SAAS7L,GAAKzH,EAAA,iBAAeyD,EAAEgE,EAAEiK,UACzD,CAEAtT,uBACU,0BAAoCW,KAAKT,OAAQ,UAEvD4gG,IAAoB,EACxB,CAEA9gG,kBACI,MAAM+gG,EAAcpgG,KAAKsD,KAAKqY,oBAAoBpP,MAAKoD,GAAwB,WAAnBA,EAAEtI,eAE9D,GAAK+4F,EAAL,CAIA,GAA6C,IAAzCpgG,KAAKsD,KAAKqY,oBAAoBlZ,OAAc,CAC5C,MAAM8iB,EAAO,wHAEb,UAAWqb,EAAA,UAAsBrb,GAC7B,MAER,OAEMhiB,EAAA,SAAc,YAAY68F,EAAY/tF,yCAE5C8tF,IAAoB,EAZpB,CAaJ,CAEA9gG,sBAAsBiE,GAClB,MAAMif,EAAWjf,EAAKge,YAAY,UAC5B++E,EAAgB99E,GAAYjf,EAAKqY,oBAAoBpP,MAAKoD,GAAwB,WAAnBA,EAAEtI,eACjEi5F,EAAiB/9E,IAAa89E,EAEpCrgG,KAAKi/F,UAAU9xE,QAAQ5K,GACvBviB,KAAKo/F,WAAWjyE,SAAS5K,GAErB+9E,GACAtgG,KAAKwiB,QAAQzP,KAAK,QAAS,+BAC3B/S,KAAKo/F,WAAWv7E,SAAS,qBAGzB7jB,KAAKwiB,QAAQ8rC,WAAW,SACxBtuD,KAAKo/F,WAAWhzC,YAAY,mBAEpC,CAEAmD,uBAAsB,YAAC9lD,IACfA,EAAYmlC,gBAAgBriC,MAAKoD,GAAKA,EAAEpQ,SAAWS,KAAKT,UACxDS,KAAK80C,SAEb,EC9BW,MAAMyrD,WAA8B,IAC/C59F,cACIC,QAEA5C,KAAKwgG,gBAAiB,IAAIjC,IAAiB/qD,eAC3CxzC,KAAKygG,2BAA4B,IAAIhB,IAA4BjsD,eACjExzC,KAAK0gG,yBAA0B,IAAIhB,IAA0BlsD,eAC7DxzC,KAAK2gG,sBAAuB,IAAIb,IAAuBtsD,eACvDxzC,KAAK4gG,oBAAqB,IAAIV,IAAqB1sD,eAEnDxzC,KAAKmO,MACDnO,KAAKwgG,eACLxgG,KAAKygG,0BACLzgG,KAAK0gG,wBACL1gG,KAAK2gG,qBACL3gG,KAAK4gG,mBAEb,CAEIttF,WACA,MAAO,iBACX,CAEI8yD,oBACA,MAAO,6BACX,CAEAE,WACI,MAAO,CACHn/B,MAAOnnC,KAAKsD,KAAK8E,oBACjBkC,MAAO,OACPic,KAAM,eAEd,CAEAutB,WACI9zC,KAAKwiB,QAAU9d,EAzEX,k6BA0EJ1E,KAAKwzC,eAELxzC,KAAKwiB,QAAQjW,KAAK,wBAAwB5H,OAAO3E,KAAKwgG,eAAelsF,UACrEtU,KAAKwiB,QAAQjW,KAAK,oCAAoC5H,OAAO3E,KAAKygG,0BAA0BnsF,UAC5FtU,KAAKwiB,QAAQjW,KAAK,iCAAiC5H,OAAO3E,KAAK0gG,wBAAwBpsF,UACvFtU,KAAKwiB,QAAQjW,KAAK,8BAA8B5H,OAAO3E,KAAK2gG,qBAAqBrsF,UACjFtU,KAAKwiB,QAAQjW,KAAK,4BAA4B5H,OAAO3E,KAAK4gG,mBAAmBtsF,SACjF,CAEAjV,sBAAsBiE,SACZV,MAAMgyC,gBAAgBtxC,GAE5BtD,KAAKwiB,QAAQjW,KAAK,iCAAiC4gB,OAAOntB,KAAKsD,MAAQ,CAAC,OAAQ,QAAQ6F,SAASnJ,KAAKsD,KAAKG,MAC/G,EC9BW,MAAMo9F,WAAuB,IACpCvtF,WACA,MAAO,UACX,CAEI8yD,oBACA,MAAO,yBACX,CAEAryB,YACI,OAAO/zC,KAAKsD,IAChB,CAEAgjE,WACI,MAAO,CACHn/B,KAAMnnC,KAAK+zC,YACXzpC,MAAO,OACPic,KAAM,oBAEd,CAEAutB,WACI9zC,KAAKwiB,QAAU9d,EAlFX,4qDAmFJ1E,KAAKwzC,eAELxzC,KAAK8gG,QAAU9gG,KAAKwiB,QAAQjW,KAAK,sBACjCvM,KAAK+gG,aAAe/gG,KAAKwiB,QAAQjW,KAAK,2BACtCvM,KAAKghG,cAAgBhhG,KAAKwiB,QAAQjW,KAAK,4BACvCvM,KAAKihG,MAAQjhG,KAAKwiB,QAAQjW,KAAK,mBAC/BvM,KAAKkhG,MAAQlhG,KAAKwiB,QAAQjW,KAAK,mBAE/BvM,KAAKmhG,kBAAoBnhG,KAAKwiB,QAAQjW,KAAK,uBAC3CvM,KAAKohG,UAAYphG,KAAKwiB,QAAQjW,KAAK,cACnCvM,KAAKqhG,aAAerhG,KAAKwiB,QAAQjW,KAAK,iBAEtCvM,KAAKshG,iBAAmBthG,KAAKwiB,QAAQjW,KAAK,qBAC1CvM,KAAKshG,iBAAiB/sF,GAAG,SAASlV,UAC9BW,KAAKmhG,kBAAkBh6D,OACvBnnC,KAAKshG,iBAAiB5+E,OAEtB1iB,KAAKohG,UAAUz+E,QAAQhe,OAAOD,EAAE,+CAChC1E,KAAKqhG,aAAa1+E,QAAQhe,OAAOD,EAAE,+CAEnC,MAAM68F,QAAqBh+F,EAAA,MAAW,mBAAmBvD,KAAKT,UAC9DS,KAAKohG,UAAU77E,KAAKtkB,EAAA,mBAAiBsgG,EAAaC,WAElD,MAAMC,QAAoBl+F,EAAA,MAAW,sBAAsBvD,KAAKT,UAE5DkiG,EAAYC,iBAAmB,EAC/B1hG,KAAKqhG,aAAa97E,KAAK,UAAUtkB,EAAA,mBAAiBwgG,EAAYE,mBAAmBF,EAAYC,yBAG7F1hG,KAAKqhG,aAAa97E,KAAK,GAC3B,GAER,CAEAlmB,sBAAsBiE,GAClB,MAAMwlF,QAAiBvlF,EAAA,MAAW,SAASvD,KAAKT,mBAEhDS,KAAK8gG,QAAQv7E,KAAKjiB,EAAK/D,QACvBS,KAAK+gG,aACAx7E,KAAKujE,EAAS8Y,YAAY5rE,OAAO,EAAG,KACpCjjB,KAAK,QAAS+1E,EAAS8Y,aAE5B5hG,KAAKghG,cACAz7E,KAAKujE,EAAStwE,aAAawd,OAAO,EAAG,KACrCjjB,KAAK,QAAS+1E,EAAStwE,cAE5BxY,KAAKihG,MAAM17E,KAAKjiB,EAAKG,MAEjBH,EAAKnD,KACLH,KAAKkhG,MAAM37E,KAAK,IAAIjiB,EAAKnD,SAEzBH,KAAKkhG,MAAMv+E,QAGf3iB,KAAKshG,iBAAiBn6D,OACtBnnC,KAAKmhG,kBAAkBz+E,MAC3B,CAEA6sC,uBAAsB,YAAC9lD,KACfA,EAAYC,eAAe1J,KAAKT,SAAWkK,EAAY6lC,sBAAsBtvC,KAAKT,UAClFS,KAAK80C,SAEb,EC1GW,MAAM+sD,WAA6B,IAC1CvuF,WACA,MAAO,gBACX,CAEI8yD,oBACA,MAAO,+BACX,CAEAryB,YACI,OAAO/zC,KAAKsD,MAA2B,SAAnBtD,KAAKsD,KAAKG,IAClC,CAEA6iE,WACI,MAAO,CACHn/B,KAAMnnC,KAAK+zC,YACXv0C,UAAU,EACV8K,MAAO,OACPic,KAAM,aAEd,CAEAutB,WACI9zC,KAAKwiB,QAAU9d,EA/DX,u/BAgEJ1E,KAAKwzC,eAELxzC,KAAK8hG,gBAAkB9hG,KAAKwiB,QAAQjW,KAAK,qBACzCvM,KAAK8hG,gBAAgBvtF,GAAG,UAAU,IAAMvU,KAAK+hG,eAAe/hG,KAAK8hG,gBAAgB18E,SAEjFplB,KAAKgiG,sBAAwBhiG,KAAKwiB,QAAQjW,KAAK,2BAC/CvM,KAAKgiG,sBAAsBztF,GAAG,SAASlV,UAC9BW,KAAKsD,KAAK6E,cAAc,mBACnB,WAA0BnI,KAAKT,OAAQ,YAGjDS,KAAKgI,eAAe,kBAAmB,CAACzI,OAAQS,KAAKT,QAAQ,IAGjES,KAAKiiG,mBAAqBjiG,KAAKwiB,QAAQjW,KAAK,wBAC5CvM,KAAKiiG,mBAAmB1tF,GAAG,SAASlV,UAEhC,IAAK,MAAM6iG,KAAgBliG,KAAKsD,KAAKyb,eAAe,kBAC1C,sBAAqC/e,KAAKT,OAAQ2iG,EAAa/uF,aAGzEnT,KAAKgI,eAAe,kBAAmB,CAACzI,OAAQS,KAAKT,QAAQ,GAErE,CAEAF,sBAAsBiE,GAClB,MAAMgtF,EAAWtwF,KAAKsD,KAAKic,cAAc,aAAe,OAExDvf,KAAK8hG,gBAAgB18E,IAAIkrE,GAEzBtwF,KAAKgiG,sBAAsB70E,OAAoB,SAAbmjE,GAClCtwF,KAAKiiG,mBAAmB90E,OAAoB,SAAbmjE,EACnC,CAEAjxF,qBAAqBoE,GACjB,GAAa,SAATA,GAA4B,SAATA,EACnB,MAAM,IAAI+J,MAAM,sBAAsB/J,YAGpC,WAA0BzD,KAAKT,OAAQ,WAAYkE,EAC7D,CAEA8rD,uBAAsB,YAAC9lD,IACfA,EAAY4J,mBAAmB9G,MAAKwG,GAAQA,EAAKxT,SAAWS,KAAKT,QAAwB,aAAdwT,EAAKO,QAChFtT,KAAK80C,SAEb,EChFW,MAAMqtD,WAA4B,IAC7Cx/F,cACIC,QAEA5C,KAAKqrF,cAAgB,IAAIjhB,GAAc,UACvCpqE,KAAKmO,MAAMnO,KAAKqrF,cACpB,CAEI/3E,WACA,MAAO,SACX,CAEI8yD,oBACA,MAAO,wBACX,CAEAE,WACI,MAAO,CACHn/B,KAAMnnC,KAAK+zC,YACXzpC,MAAO,OACPic,KAAM,gBAEd,CAEAutB,WACI9zC,KAAKwiB,QAAU9d,EAvDX,izBAwDJ1E,KAAKwzC,eACLxzC,KAAK0lB,WAAa1lB,KAAKwiB,QAAQjW,KAAK,uBACpCvM,KAAK0lB,WAAW/gB,OAAO3E,KAAKqrF,cAAc/2E,UAE1CtU,KAAKoiG,UAAY,QAEjBpiG,KAAKqiG,gBAAkBriG,KAAKwiB,QAAQjW,KAAK,qBACzCvM,KAAKqiG,gBAAgB9tF,GAAG,SAAS,KAC7BvU,KAAKsiG,gBAELtiG,KAAKqiG,gBAAgB3/E,OACrB1iB,KAAKuiG,gBAAgBp7D,OAErBnnC,KAAKoiG,UAAY,OAEjBpiG,KAAKqrF,cAAc5gB,eAAe,IAGtCzqE,KAAKuiG,gBAAkBviG,KAAKwiB,QAAQjW,KAAK,oBACzCvM,KAAKuiG,gBAAgBhuF,GAAG,SAAS,KAC7BvU,KAAKwiG,eAELxiG,KAAKqiG,gBAAgBl7D,OACrBnnC,KAAKuiG,gBAAgB7/E,OAErB1iB,KAAKoiG,UAAY,QAEjBpiG,KAAKqrF,cAAc5gB,eAAe,IAgBtC,IAAIhgB,gBAbiB,KACZzqD,KAAKqrF,cAAc3gB,QAID,SAAnB1qE,KAAKoiG,UACLpiG,KAAKsiG,gBAEmB,UAAnBtiG,KAAKoiG,WACVpiG,KAAKwiG,eACT,IAG6B73C,QAAQ3qD,KAAKwiB,QAAQ,GAC1D,CAEAggF,eACI,MACMriD,EAAQngD,KAAKwiB,QAAQ29B,QAE3BngD,KAAKwiB,QAAQjW,KAAK,uBACbm0C,OAJqB,KAKrBP,MAAMA,EACf,CAEAmiD,gBACI,MAAM,IAACh/E,GAAOtjB,KAAKwiB,QAAQ,GAAGwmC,wBAExBtI,EAASh8C,EAAEjD,QAAQi/C,SAAWp9B,EAC9B68B,EAAQngD,KAAKwiB,QAAQ29B,QAE3BngD,KAAKwiB,QAAQjW,KAAK,uBACbm0C,OAAOA,GACPP,MAAMA,EACf,ECtFW,MAAMsiD,WAAwB,IACrCnvF,WACA,MAAO,WACX,CAEI8yD,oBACA,MAAO,0BACX,CAEAE,WACI,MAAO,CACHn/B,MAAM,EACN78B,MAAO,OACPic,KAAM,mBAEd,CAEAutB,WACI9zC,KAAKwiB,QAAU9d,EAnDX,orBAoDJ1E,KAAKwzC,eAELxzC,KAAK0iG,eAAiB1iG,KAAKwiB,QAAQjW,KAAK,oBACxCvM,KAAKo5F,cAAgBp5F,KAAKwiB,QAAQjW,KAAK,mBACvCvM,KAAKwiB,QAAQjO,GAAG,oBAAoB,IAAMvU,KAAKk5F,kBACnD,CAEA75F,sBAAsBiE,GAGlB,GAFAtD,KAAKo5F,cAAcz2E,QAEC,SAAhB3iB,KAAKT,OAKL,YAJAS,KAAKo5F,cAAcz2E,QAAQhe,aACjB3E,KAAK2iG,gBAAgB,SAMnC,MAAMC,EAAkB5iG,KAAKsD,KAAK8a,yBAAyBpe,KAAKa,eAC3D+K,QAAO9L,IAAaA,EAAS2e,WAE9BmkF,EAAgBngG,OAAS,EACzBzC,KAAK0iG,eAAen9E,KAAK,kBAGzBvlB,KAAK0iG,eAAen9E,KAAK,mBAG7B,MAAMs9E,EAAgB,GAEtB,IAAK,MAAMC,KAAkBF,EAAiB,CAC1C,MAAM9iG,EAAWgjG,EAAehjG,SAAS4R,KAAK,KAE9CmxF,EAAcv2F,WAAWtM,KAAK2iG,gBAAgB7iG,EAAUgjG,GAC5D,CAEA9iG,KAAKo5F,cAAcz2E,QAAQhe,UAAUk+F,EACzC,CAEAxjG,sBAAsBS,EAAUgjG,EAAiB,MAC7C,MAAMx4F,QAAcvK,EAAA,mBAA6BD,GAE3C83B,QAAkB,eAAuB93B,EAAU,CAACwK,UAE1DstB,EACKrrB,KAAK,KACLsX,SAAS,sBAEd,MAAM41E,EAAQ,GA6Bd,OA3BIz5F,KAAKF,WAAaA,GAClB83B,EAAU/T,SAAS,iBAGlBi/E,GAAkBA,EAAexkF,mBAClCsZ,EAAU/T,SAAS,2BAGnB41E,EAAMntF,KAAK,0EAGXw2F,GAAgBzmF,aAChBub,EAAU/T,SAAS,iBAEnB41E,EAAMntF,KAAK,oDAGXw2F,GAAgBtkF,WAChBoZ,EAAU/T,SAAS,eAEnB41E,EAAMntF,KAAK,kDAGXmtF,EAAMh3F,OAAS,GACfm1B,EAAUjzB,OAAO,IAAI80F,EAAM/nF,KAAK,QAG7BhN,EAAE,QAAQC,OAAOizB,EAC5B,CAEA23B,uBAAsB,YAAC9lD,KACfA,EAAYmlC,gBAAgBriC,MAAK6Z,GAAUA,EAAO7mB,SAAWS,KAAKT,UAC/DkK,EAAYC,eAAe1J,KAAKT,UAEnCS,KAAK80C,SAEb,EC9GW,MAAMiuD,WAA2B,IACxCzvF,WACA,MAAO,cACX,CAEI8yD,oBACA,MAAO,6BACX,CAEAryB,YACI,OAAOnxC,MAAMmxC,aACa,WAAnB/zC,KAAKsD,KAAKG,OACTzD,KAAKsD,KAAK6E,cAAc,6BACpC,CAEAm+D,WACI,MAAO,CACHn/B,KAAMnnC,KAAK+zC,YACXzpC,MAAO,OACPic,KAAM,kBAEd,CAEAutB,WACI9zC,KAAKwiB,QAAU9d,EAnDX,koBAoDJ1E,KAAKwzC,eAELxzC,KAAKgjG,qBAAuBhjG,KAAKwiB,QAAQjW,KAAK,yBAClD,CAEAlN,sBAAsBiE,GAElBtD,KAAKsK,MAAQtK,KAAKsD,KAAKgH,MAEvB,MAAM24F,QAAqB1/F,EAAA,MAAW,iBAAiBvD,KAAKT,UAE5D,GAA4B,IAAxB0jG,EAAaxgG,OAGb,YAFAzC,KAAKgjG,qBAAqBrgF,QAAQhe,OAAO,aAK7C,MAAMwN,EAAU8wF,EAAah3F,SAAQ3I,GAAQA,EAAKxD,iBAE5CD,EAAA,iBAAesS,GAAS,GAE9B,MAAM+hD,EAAQxvD,EAAE,SAEhB,IAAK,MAAMw+F,KAAeD,EAAc,CAGpC,UAFmBpjG,EAAA,gBAAcqjG,EAAY3jG,QAAQ,GAGjD,SAGJ,MAAM4kB,SAAe,eAAuB++E,EAAYpjG,SAAS4R,KAAK,OACjEiS,IAAI,YAAa,IAAM,EAAI,GAAK,EAAKu/E,EAAYC,SAEtDjvC,EAAMvvD,OAAOwf,EACjB,CAEAnkB,KAAKgjG,qBAAqBrgF,QAAQhe,OAAOuvD,EAC7C,CAEA3E,uBAAsB,YAAC9lD,IACfzJ,KAAKsD,MAAQtD,KAAKsK,QAAUtK,KAAKsD,KAAKgH,QACtCtK,KAAKojG,UAAW,EAEhBpjG,KAAK80C,UAEb,ECnGW,MAAMuuD,WAA2B3lD,EAC5C/6C,cACIC,MAAM,UAEN5C,KAAKsmB,GAAG,cACRtmB,KAAK2jB,IAAI,SAAU,QACnB3jB,KAAKyzC,aACT,CAEAM,YACI,OAAOnxC,MAAMmxC,aACN/zC,KAAKoL,SAAS3I,OAAS,KACrBzC,KAAKoL,SAASmB,MAAKmiF,GAAMA,EAAG36C,aAAe26C,EAAGr6C,cAC3D,CAEA79B,sBAAsBlD,EAAMpB,GACxB,MAAM/H,EAAUvH,MAAM4T,sBAAsBlD,EAAMpB,GAclD,MAZI,CAAC,uBAAwB,2BAA4B,gBAAgB/I,SAASmK,KAI1EnJ,EACAA,EAAQa,MAAK,IAAMhL,KAAKsjG,yCAGxBtjG,KAAKsjG,wCAINn5F,CACX,CAEAm5F,uCACI,MAAMC,GAAavjG,KAAKk0C,cAClBsvD,EAAYxjG,KAAK+zC,YAEnBwvD,IAAcC,IACdxjG,KAAKg0C,UAAUwvD,GAEf,KAER,ECxCW,MAAMC,WAAmB1F,GACpChqD,YACI,OAAOnxC,MAAMmxC,aACN/zC,KAAKsD,MACmC,YAAxCtD,KAAKd,YAAYC,UAAU4B,QACtC,CAEA4B,cACIC,QAEA5C,KAAKumB,KAAK,eACLjc,MAAM,QACNgzF,eAAe,UACfO,SAAQt0E,IACLvpB,KAAKd,YAAYC,UAAUC,6BAA8B,EAEzD,uBAAwB,8BAA+B,CAACF,YAAac,KAAKd,cAE1Ec,KAAK80C,SAAS,GAE1B,CAEAz1C,sBAAsBiE,GAClB,GAAIA,EAAKI,cAAgB,kCACrB1D,KAAKg0C,WAAU,OAEd,CAEDh0C,KAAKg0C,WAAU,GAEf,MAAM0vD,EAAa1jG,KAAKwB,YAGxBxB,KAAKg0C,gBAAgBh0C,KAAKd,YAAYu+D,cAIlCz9D,KAAKwB,cAAgBkiG,IACrB1jG,KAAKwiB,QAAQqB,SAAS,iBAEtBlb,YAAW,KACP3I,KAAKwiB,QAAQ4pC,YAAY,gBAAgB,GAC1C,MAEX,OAEMxpD,MAAMgyC,gBAAgBtxC,EAChC,CAEAisD,uBAAsB,YAAC9lD,IACfA,EAAY4J,mBAAmB9G,MAC/BwG,GAAsB,UAAdA,EAAKtP,MACNsP,EAAKO,KAAK2jB,cAAc9tB,SAAS,aACjC,cAA6B4J,EAAM/S,KAAKsD,UAE/CtD,KAAKd,YAAYC,UAAUC,6BAA8B,EAEzDY,KAAK80C,UAEb,CAEAz1C,gCAA+B,OAACE,IACxBS,KAAK20C,OAAOp1C,UACNS,KAAK80C,SAEnB,EC/CW,MAAM6uD,WAA0B,IACvCrwF,WACA,MAAO,aACX,CAEAygC,YACI,OAAOnxC,MAAMmxC,aACN/zC,KAAKsD,KAAK2c,cAAc,WACnC,CAEAqmD,WACI,MAAO,CACHn/B,KAAMnnC,KAAK+zC,YAEXv0C,UAC4D,IAAvDQ,KAAKsD,KAAK4d,kCAAkCze,SAAiBjC,EAAA,KAAW,oCACtEA,EAAA,KAAW,2BAClB8J,MAAO,SACPic,KAAM,sBAEd,CAEAlnB,iBACIW,KAAKwiB,QAAU9d,EAxCX,4VAyCJ1E,KAAKwzC,eACLxzC,KAAKk0D,MAAQl0D,KAAKwiB,QAAQjW,KAAK,sBAC/BvM,KAAK4jG,WAAa5jG,KAAKwiB,QAAQjW,KAAK,yBACxC,CAEAlN,sBAAsBiE,GAClB,IAAIugG,QAAoBtgG,EAAA,MAAW,gBAAgBD,EAAKic,cAAc,eAOtE,GALAskF,EAAcA,EAAYj4F,QAAO4zC,GAAKA,EAAEjgD,SAAW+D,EAAK/D,SAExDS,KAAKk0D,MAAMvxC,QACX3iB,KAAK4jG,WAAWlhF,OAEW,IAAvBmhF,EAAYphG,OAEZ,YADAzC,KAAK4jG,WAAWz8D,OAIpB,MAAMh1B,EAAU0xF,EAAY53F,SAAQuzC,GAAKA,EAAEjgD,eAErCM,EAAA,iBAAesS,GAAS,GAE9B,IAAK,IAAI3C,EAAI,EAAGA,EAAIq0F,EAAYphG,OAAQ+M,IAAK,CACzC,MAAMs0F,EAAaD,EAAYr0F,GACzB2U,EAAQzf,EAAE,mCAEhB,GAAIo/F,EAAWl6F,UAAW,CACtB,MAAMU,EAAQ,GAAGw5F,EAAWx5F,kBAC5B6Z,EAAMxf,OACFD,EAAE,OACG6gB,KAAKjb,GACLyI,KAAK,QAASzI,GAE3B,MAEI6Z,EAAMxf,OAAOm/F,EAAWhkG,eACZ,eAAuBgkG,EAAWhkG,SAAS4R,KAAK,KAAM,CAAC+lB,cAAc,IAC3E/yB,EAAE,UAAU6gB,KAAKu+E,EAAWx5F,QAGlCkF,EAAIq0F,EAAYphG,OAAS,GACzB0hB,EAAMxf,OAAO,MAGjB3E,KAAKk0D,MAAMvvD,OAAOwf,EACtB,CACJ,EC1DJ,IAAI0G,GAAY,EAED,MAAMk5E,WAAsB,IACvChwD,YACI,OAAOnxC,MAAMmxC,aACc,YAApB/zC,KAAKsD,MAAMG,MACXzD,KAAKsD,KAAKwZ,sBAC+B,YAAzC9c,KAAKd,aAAaC,UAAU4B,QACvC,CAEA+yC,WACI9zC,KAAKwiB,QAAU9d,EA1CX,m3BA2CJ1E,KAAKwzC,eACLxzC,KAAKgkG,SAAWhkG,KAAKwiB,QAAQjW,KAAK,mBAClCvM,KAAKikG,gBAAkBjkG,KAAKwiB,QAAQjW,KAAK,kBACzCvM,KAAKkkG,cAAgBlkG,KAAKikG,gBAAgB13F,KAAK,iBACnD,CAEAlN,sBAAsBiE,GAClBtD,KAAKikG,gBAAgBvhF,aAEf,oBAA6B,cAEnC,MACM2K,EADgB5rB,OAAO6rB,iBAAiB7b,SAASuR,iBACpBuK,iBAAiB,mBAEpDC,QAAQC,WAAWC,WAAW,CAC1BC,aAAa,EACbC,MAAOP,EAAarT,OACpB6T,cAAe,aACfs2E,KAAM,CAAEC,aAAa,GACrBC,SAAU,CAAED,aAAa,GACzBE,MAAO,CAAEF,aAAa,GACtB,MAAS,CAAEA,aAAa,GACxBxnB,MAAO,CAAEwnB,aAAa,GACtBG,IAAK,CAAEH,aAAa,GACpBI,QAAS,CAAEJ,aAAa,GACxBK,IAAK,CAAEL,aAAa,KAGxBpkG,KAAKgkG,SAASrhF,QAEd,MAAM+hF,EAAkB,oBAA6B,iBAErD1kG,KAAKikG,gBAAgBvhF,OAErB,IACI,MAAMoL,QAAY9tB,KAAK2kG,YAEvB,GAAI3kG,KAAK4kG,gBAAiB,CACtB,MAAM/nE,EAAU,CACZtkB,KAAM,QACNjO,MAAO,qBACPnK,KAAM,gBACNqD,QAASsqB,EACT5e,SAAU,GAGd3L,EAAA,OAAY,SAASvD,KAAKT,mCAAoCs9B,GAAS7xB,MAAK,KACxEhL,KAAK4kG,iBAAkB,CAAK,GAEpC,CAEA5kG,KAAKgkG,SAASr+E,KAAKmI,SAEb42E,EAEN1kG,KAAKgkG,SAASjxF,KAAK,KAAM,kBAAkB8X,MAE3CwB,MAAMC,OAAO,mBAAmBzB,KAAa,CACzCpnB,KAAM,OACN8oB,SAAU,GACVC,MAAO,IACPC,aAAa,GAErB,CAAE,MAAO/jB,GACL1I,KAAKkkG,cAAc3+E,KAAK7c,EAAEgE,SAC1B1M,KAAKikG,gBAAgB98D,MACzB,CACJ,CAEA9nC,kBACIwrB,KAEA,MACMrnB,SADaxD,KAAKsD,KAAKgG,WACR9F,SAAW,IAE1B,IAACsqB,SAAaN,QAAQC,WAAWnZ,OAAO,iBAAiBuW,KAAarnB,GAC5E,OAAOsqB,CACX,CAEAzuB,6BAA4B,YAACoK,IACrBA,EAAY6lC,sBAAsBtvC,KAAKT,UACvCS,KAAK4kG,iBAAkB,QAEjB5kG,KAAK80C,UAEnB,CAEAz1C,0BAAyB,MAACI,IACtB,IAAKO,KAAKy0C,cAAch1C,GACpB,OAGJ,MAAMquB,QAAY9tB,KAAK2kG,YACvB3kG,KAAKw6B,SAAS,GAAGx6B,KAAKsD,KAAKgH,YAAawjB,EAC5C,CAEA0M,SAASqqE,EAAUt/E,GACf,MAAM8hC,EAAU51C,SAASslC,cAAc,KACvCsQ,EAAQpQ,aAAa,OAAQ,oCAAoChrB,mBAAmB1G,MACpF8hC,EAAQpQ,aAAa,WAAY4tD,GAEjCx9C,EAAQhU,MAAMzvB,QAAU,OACxBnS,SAAS8xB,KAAKqU,YAAYyP,GAE1BA,EAAQgL,QAER5gD,SAAS8xB,KAAKmU,YAAY2P,EAC9B,ECtJW,MAAMy9C,WAA0BpnD,EAC3C/6C,cACIC,MAAM,UAEN5C,KAAK2jB,IAAI,YAAa,KACjB8vB,aACT,CAEAuB,qBAAoB,YAAC91C,IACjBc,KAAKd,YAAcA,EAEnBc,KAAK80C,SACT,CAEAmZ,gCACIjuD,KAAK80C,SACT,CAEAjuC,oBACI7G,KAAK80C,SACT,CAEAhuC,4BACI9G,KAAK80C,SACT,CAEAA,UACI,MAAMV,EAAcp0C,KAAKo0C,cAEzBp0C,KAAKwiB,QAAQ4pC,cAEbpsD,KAAKm0C,WAAWC,GAEhBp0C,KAAKwiB,QAAQqB,SAAS,wBAEtB,MAAMvgB,EAAOtD,KAAKd,aAAaoE,KAC1BA,IAILtD,KAAKwiB,QAAQyxB,YAAY,qBACrB,CAAC,QAAS,UAAW,OAAQ,SAAU,SAAU,WAAW9qC,SAAS7F,EAAKG,SACrEH,GAAM6E,cAAc,qBAG7BnI,KAAKwiB,QAAQqB,SAASvgB,EAAKse,eAE3B5hB,KAAKwiB,QAAQqB,SAAS5iB,EAAA,yBAAuBqC,EAAKG,OAClDzD,KAAKwiB,QAAQqB,SAAS5iB,EAAA,yBAAuBqC,EAAKnD,OAElDH,KAAKwiB,QAAQyxB,YAAY,YAAa3wC,EAAKI,aAC/C,CAEArE,6BAA4B,YAACoK,IAGzB,MAAMlK,EAASS,KAAKd,aAAaK,QAC7BkK,EAAYC,eAAenK,IACxBkK,EAAY4J,mBAAmB9G,MAAKwG,GAAsB,UAAdA,EAAKtP,MAAkC,aAAdsP,EAAKO,MAAuB,cAA6BP,EAAM/S,KAAKd,aAAaoE,UAEzJtD,KAAK80C,SAEb,ECDW,MAAMiwD,WAAwB,IACzCjxD,WACI9zC,KAAKwiB,QAAU9d,EA1DX,ugDA2DJ1E,KAAKglG,OAAShlG,KAAKwiB,QAAQjW,KAAK,oBAChCvM,KAAKilG,OAASjlG,KAAKwiB,QAAQjW,KAAK,oBAChCvM,KAAKklG,QAAUllG,KAAKwiB,QAAQjW,KAAK,qBAEjCvM,KAAKglG,OAAOzwF,GAAG,SAAS,KACpBvU,KAAKilG,OAAO93E,SACZntB,KAAKilG,OAAOthF,IAAI,aAAcjf,EAAEjD,QAAQi/C,SAAW1gD,KAAKilG,OAAO7zC,SAAS9tC,IAAM,IAE1EtjB,KAAKilG,OAAO7rE,GAAG,aACfp5B,KAAKmlG,iBACT,IAGJnlG,KAAKwzC,cACT,CAEAn0C,sBAAsBiE,GAGlB,GAFAtD,KAAKolG,aAEyC,YAA1CplG,KAAKd,aAAaC,WAAW4B,SAE7B,YADAf,KAAKmtB,QAAO,GAKhB,MAAM7mB,QAAa/C,EAAA,MAAW,YAAYvD,KAAKT,yBAE1C+G,GAASA,EAAK2f,OAKnBjmB,KAAKmtB,QAAO,GACZntB,KAAKglG,OAAOz/E,KACR,GAAGjf,EAAK2f,cANRjmB,KAAKmtB,QAAO,EAQpB,CAEAA,OAAOga,GACHnnC,KAAKwiB,QAAQyxB,YAAY,qBAAsB9M,EACnD,CAEAi+D,aACIplG,KAAKilG,OAAOtiF,QAAQD,MACxB,CAEArjB,wBACI,IAAKW,KAAKsD,KACN,OAGJtD,KAAKilG,OAAOtiF,QAEZ,MAAM0iF,QAAkB9hG,EAAA,MAAW,YAAYvD,KAAKT,oBAEpD,GAAK8lG,EAAU5iG,OAAf,OAIM5C,EAAA,iBAAewlG,EAAU15F,KAAI25F,GAAMA,EAAG/lG,UAE5C,IAAK,MAAMgmG,KAAYF,EAAW,CAC9B,MAAMlhF,EAAQzf,EAAE,SAEhByf,EAAMxf,aAAa,eAAuB4gG,EAAShmG,OAAQ,CACvDgsB,cAAc,EACdkM,cAAc,EACdnM,aAAa,KAGbi6E,EAASljC,aACTl+C,EAAMxf,OAAOD,EAAE,OAAO6gB,KAAK,aAAaggF,EAASljC,iBAGjDl+C,EAAMxf,UAAU4gG,EAASC,UAG7BxlG,KAAKilG,OAAOtgG,OAAOwf,EACvB,CArBA,CAsBJ,ECjIW,MAAMshF,WAAyB,IAC1C1xD,YACI,OAAOnxC,MAAMmxC,aAA+B,WAAhB/zC,KAAKT,QAAuBS,KAAKsD,KAAKge,YAAY,SAClF,CAEAwyB,WACI9zC,KAAKwiB,QAAU9d,EApBX,uZAqBJ1E,KAAK0lG,YAAc1lG,KAAKwiB,QAAQjW,KAAK,gBACrCvM,KAAK2lG,YAAc3lG,KAAKwiB,QAAQjW,KAAK,gBACrCvM,KAAKwzC,cACT,CAEAn0C,sBAAsBiE,GAClB,MAAM21E,EAAiBz4E,EAAA,MAAY,kBACnC,IAAIu5C,EAEJ,MAAM6rD,EAAU5lG,KAAK6lG,WAAWviG,GAEhC,GAAI21E,EACAl/B,EAAO,GAAGk/B,WAAwB2sB,IAClC5lG,KAAK2lG,YAAYpgF,KAAK,mBAErB,CACD,IAAIvf,EAAOF,SAASE,KAChBA,EAAKI,SAAS,OAGdJ,EAAOA,EAAKgwB,OAAO,EAAGhwB,EAAKvD,OAAS,IAGxCs3C,EAAO,GAAGj0C,SAASC,aAAaC,IAAOF,SAASG,iBAAiB2/F,IACjE5lG,KAAK2lG,YAAYpgF,KAAK,cAC1B,CAEAvlB,KAAK0lG,YAAY3yF,KAAK,OAAQgnC,GAAMx0B,KAAKw0B,EAC7C,CAEA8rD,WAAWviG,GACP,OAAIA,EAAK2c,cAAc,aACZ,GAGJ3c,EAAKod,mBAAmB,eAAiBpd,EAAK/D,MACzD,CAEAgwD,uBAAsB,YAAC9lD,KACfA,EAAY4J,mBAAmB9G,MAAKwG,GAAQA,EAAKO,KAAKpL,WAAW,WAAa,cAA6B6K,EAAM/S,KAAKsD,SAGjHmG,EAAYmlC,gBAAgBriC,MAAK6Z,GAAUA,EAAO7mB,SAAWS,KAAKT,WAFvES,KAAK80C,SAKb,ECtEW,MAAMgxD,GACjBnjG,YAAY0T,GAERrW,KAAKqW,OAASA,CAClB,CAEAhX,sBACI,OAAOW,KAAKqW,OAAOnX,YAAYgiC,eACnC,CAEA7hC,kBAAkB0mG,EAAYC,EAAWC,GAGrC,MAAMxtE,QAAmBz4B,KAAKkhC,gBACxBqjC,EAAQ9rC,EAAW8rC,MACzB,IAAI2hC,EAAa,KACbC,EAAa,EACbC,GAAgB,EAGpB,MAAMC,EAAwB5tE,EAAW6tE,QAAQ78E,IAAI,yBAGrD,GAFA48E,EAAsBzpB,MAAM3S,MAAM1F,GAClC8hC,EAAsB5hC,OACH,KAAfshC,EAAmB,CAQnB,MAAMvlG,EAAU,CAAE,UAAcwlG,EAAW,WAAeC,GAC1DC,EAAaztE,EAAW0lD,QAAQ,OAAQ4nB,EAAYvlG,GACpD2lG,EAAaD,EAAWx/F,QAAQjE,OAEhC,MAAM8jG,EAAYhiC,EAAM9yD,SAASwzD,UAAU+Y,kBAC3C,IAAK,IAAIxuE,EAAI,EAAGA,EAAI02F,EAAWx/F,QAAQjE,SAAU+M,EAG7C,GAAuC,WAFxB02F,EAAWx/F,QAAQ+iB,IAAIja,GAAGozD,OAClB4jC,WACXC,YAAYF,GAAyB,CAC7CH,EAAe52F,EACf,KACJ,CAER,CAMA,GAJAxP,KAAKkmG,WAAaA,EAIdC,EAAa,EAAG,CAChBC,EAAevuF,KAAKssB,IAAI,EAAGiiE,GAG3B,IAAK,IAAI52F,EAAI,EAAIA,EAAI42F,IAAgB52F,EACjCipB,EAAW0lD,QAAQ,WAAY4nB,EAEvC,CAEA,MAAO,CACHI,aACAC,aAAcvuF,KAAK2xC,IAAI48C,EAAe,EAAGD,GAEjD,CAEA9mG,eAAes+C,EAAWyoD,EAAcM,GACpC,MAAMjuE,QAAmBz4B,KAAKkhC,gBAM1Byc,EAAY,EACZllB,EAAW0lD,QAAQ,YAEnB1lD,EAAW0lD,QAAQ,eAE3B,CAEA9+E,oBAAoB8mG,EAAYC,GAC5B,MAAM3tE,QAAmBz4B,KAAKkhC,gBAE9B,GAAIilE,EAAa,EAAG,CAGhB,MAAM5hC,EAAQ9rC,EAAW8rC,MACnBqE,EAAQ5oE,KAAKkmG,WAAWx/F,QAAQ+iB,IAAI28E,GAAcxjC,OAAO+jC,WAK/D,IAAIN,EAAwB5tE,EAAW6tE,QAAQ78E,IAAI,yBACnD48E,EAAsBzpB,MAAM3S,MAAM1F,GAClC8hC,EAAsB5hC,OACtBF,EAAMI,QAAOC,IACTA,EAAOsB,aAAa0C,EAAO,EAAE,IAEjCnwC,EAAWoQ,QAAQC,KAAK89D,sBAC5B,CAEA5mG,KAAKkmG,WAAa,KAElBztE,EAAWL,OACf,EClGJ,MAAMyuE,GAAqC,0BACrCC,GAA4B,iBAEnB,MAAMC,GACjBpkG,YAAY0T,GAERrW,KAAKqW,OAASA,CAClB,CAEAhX,sBACI,OAAOW,KAAKqW,OAAOnX,YAAYkiC,eACnC,CAEA/hC,kBAAkB0mG,EAAYC,EAAWC,GACrC,IAAIC,EAAa,KACbC,EAAa,EACbC,GAAgB,EAGpB,MAAM9mB,QAAmBt/E,KAAKohC,gBACxB4lE,EAAM1nB,EAAW0nB,IACjBzhF,EAAOyhF,EAAIvmB,WAYjB,GATuB,MAAnBzgF,KAAKkmG,YACL5mB,EAAW2nB,WAAU,KACjB,IAAK,IAAIz3F,EAAI,EAAGA,EAAIxP,KAAKkmG,WAAWzjG,SAAU+M,EAC3BxP,KAAKkmG,WAAW12F,GACxBy6D,OACX,IAIW,KAAf87B,EAAmB,CACnBA,EAAa9kG,EAAA,qBAAmB8kG,GAQhC,MAAMmB,EAAgBjB,EAAY,MAAQ,GACpCkB,EAAK,IAAI99D,OAAO69D,EAAgBnB,EAAamB,EAC/C,KAAOlB,EAAY,GAAK,MAC5B,IAAIoB,EAAU,EACVC,EAAU,EACVC,EAAW,KACfpB,EAAa,GAKb5mB,EAAW2nB,WAAU,KACjB,IAAK,IAAIz3F,EAAI,EAAGA,EAAI+V,EAAK9iB,WAEJ,MAAZ6kG,GAAsBA,EAASx2E,MAAQthB,KACxC83F,EAAWH,EAAG3vE,KAAKjS,GACH,MAAZ+hF,MAJuB93F,EAAG,CAWlC,GAAIA,IAAM83F,EAASx2E,MAAO,CACtB,IAAIy2E,EAAU,CAAE,KAASH,EAAS,GAAOC,GAErCG,EAAQ,CAAE,KAASJ,EAAS,GAAOC,EAAUC,EAAS,GAAG7kG,QAEzDmgE,EAASokC,EAAIS,SAAUF,EAASC,EAAO,CAAE,UAAcV,KAI3D,GAHAZ,EAAW55F,KAAKs2D,IAGM,IAAlBwjC,EAAqB,CACrB,MAAMG,EAAYjnB,EAAWooB,aACxBH,EAAQ3jE,KAAO2iE,EAAU3iE,MACxB2jE,EAAQ3jE,OAAS2iE,EAAU3iE,MACxB2jE,EAAQ7Y,IAAM6X,EAAU7X,MAC7B0X,EAAeD,EAEvB,CAEAA,GACJ,CAEgB,OAAZ5gF,EAAK/V,IACL43F,IACAC,EAAU,GAEVA,GAER,IAER,CAKA,GAHArnG,KAAKkmG,WAAaA,EAGdC,EAAa,EAAG,CAChBC,EAAevuF,KAAKssB,IAAI,EAAGiiE,GAC3B,IAAIxjC,EAASsjC,EAAWE,GACpBphC,EAAMpC,EAAOr2D,OACjB+yE,EAAWvnB,eAAeiN,EAAI2iC,IAC9B/kC,EAAOqH,QACPi8B,EAAWE,GAAgBY,EAAIS,SAAUziC,EAAIv0C,KAAMu0C,EAAI2iC,GACnD,CAAE,UAAcd,IAExB,CAEA,MAAO,CACHV,aACAC,aAAcvuF,KAAK2xC,IAAI48C,EAAe,EAAGD,GAEjD,CAEA9mG,eAAes+C,EAAWyoD,EAAcM,GACpC,MAAMpnB,QAAmBt/E,KAAKohC,gBACxB4lE,EAAM1nB,EAAW0nB,IAMvB,IAAIpkC,EAAS5iE,KAAKkmG,WAAWE,GACzBphC,EAAMpC,EAAOr2D,OACjBq2D,EAAOqH,QACPrH,EAASokC,EAAIS,SACTziC,EAAIv0C,KAAMu0C,EAAI2iC,GACd,CAAE,UAAcb,KAEpB9mG,KAAKkmG,WAAWE,GAAgBxjC,EAEhCA,EAAS5iE,KAAKkmG,WAAWQ,GACzB1hC,EAAMpC,EAAOr2D,OACbq2D,EAAOqH,QACPrH,EAASokC,EAAIS,SACTziC,EAAIv0C,KAAMu0C,EAAI2iC,GACd,CAAE,UAAcd,KAEpB7mG,KAAKkmG,WAAWQ,GAAa9jC,EAE7B0c,EAAWvnB,eAAeiN,EAAIv0C,KAClC,CAEApxB,oBAAoB8mG,EAAYC,GAC5B,MAAM9mB,QAAmBt/E,KAAKohC,gBAE9B,GAAI+kE,EAAa,EAAG,CAChB,MAAMa,EAAM1nB,EAAW0nB,IACjBhiC,EAAMhlE,KAAKkmG,WAAWE,GAAc75F,OAI1Cy6F,EAAI9gC,aAAalB,EAAIv0C,KAAMu0C,EAAI2iC,IAE/BroB,EAAW2nB,WAAU,KACjB,IAAK,IAAIz3F,EAAI,EAAGA,EAAIxP,KAAKkmG,WAAWzjG,SAAU+M,EAC7BxP,KAAKkmG,WAAW12F,GACtBy6D,OACX,GAER,CACAjqE,KAAKkmG,WAAa,KAElB5mB,EAAWlnD,OACf,ECpKJ,MAAM,GAAqC,0BACrC,GAA4B,iBAEnB,MAAMwvE,GACjBjlG,YAAY0T,GAERrW,KAAKqW,OAASA,EACdrW,KAAKutD,aAAe,EACpBvtD,KAAK6nG,SAAW,IACpB,CAEAxoG,kBAAkB0mG,EAAYC,EAAWC,SAC/B,oBAA6B,aAEnC,MAAMp5E,QAAiB7sB,KAAKqW,OAAOnX,YAAY4oG,oBAEzCZ,EAAgBjB,EAAY,MAAQ,GACpC8B,EAAS,IAAI1+D,OAAO69D,EAAgBjmG,EAAA,qBAAmB8kG,GAAcmB,EAAelB,EAAY,IAAM,MAE5G,OAAO,IAAI/7F,SAAQI,IACfwiB,EAASm7E,OAAO,CACZrxD,KAAM,KACF9pB,EAAS0kE,WAAWwW,EAAQ,CACxB1gD,QAAS,OACTntC,UAAW,GACXs3E,oBAAoB,EACpBC,cAAeuU,EACfrvD,KAAMt3C,UACFW,KAAK6nG,SAAWh7E,EAAStgB,KAAK,IAAI,MAClCvM,KAAKutD,aAAe,QACdvtD,KAAKioG,SAEX59F,EAAI,CACA87F,WAAYnmG,KAAK6nG,SAASplG,OAC1B2jG,aAAcvuF,KAAK2xC,IAAI,EAAGxpD,KAAK6nG,SAASplG,SAC1C,GAER,GAER,GAEV,CAEApD,eAAes+C,EAAWyoD,EAAcM,GAChC1mG,KAAK6nG,SAASplG,SACdzC,KAAKutD,cAAgB5P,EAEjB39C,KAAKutD,aAAe,IACpBvtD,KAAKutD,aAAevtD,KAAK6nG,SAASplG,OAAS,GAG3CzC,KAAKutD,aAAevtD,KAAK6nG,SAASplG,OAAS,IAC3CzC,KAAKutD,aAAe,SAGlBvtD,KAAKioG,SAEnB,CAEA5oG,oBAAoB8mG,EAAYC,UACLpmG,KAAKqW,OAAOnX,YAAY4oG,qBACtCE,QACb,CAEA3oG,eACI,GAAIW,KAAK6nG,SAASplG,OAAQ,CACtB,MAAMguD,EAAY,IACZy3C,EAAWloG,KAAK6nG,SAASM,GAAGnoG,KAAKutD,cAGvC,GAFAvtD,KAAK6nG,SAASz7C,YAAY,IAEtB87C,EAASzlG,OAAQ,CACjBylG,EAASrkF,SAAS,IAClB,MAAM3U,EAAWg5F,EAASh5F,WAAWoU,IAAMmtC,EAErC5jC,QAAiB7sB,KAAKqW,OAAOnX,YAAY4oG,oBACzB,2BAA4Bj7E,GAEpC7kB,eAAe,oBAAqB,CAACkH,YACvD,CACJ,CACJ,ECNW,MAAMk5F,WAAmB,IACpCzlG,cACIC,QAEA5C,KAAK+lG,WAAa,KAElB/lG,KAAKqoG,YAAc,IAAIvC,GAAW9lG,MAClCA,KAAKsoG,YAAc,IAAIvB,GAAW/mG,MAClCA,KAAKuoG,YAAc,IAAIX,GAAW5nG,KACtC,CAEAX,2BACUuD,MAAMiyC,qBAEN70C,KAAKwoG,aACf,CAEA10D,WAsCI,OArCA9zC,KAAKwiB,QAAU9d,EAnFX,kkEAoFJ1E,KAAKyoG,SAAWzoG,KAAKwiB,QAAQjW,KAAK,oBAClCvM,KAAKyoG,SAAS/lF,OACd1iB,KAAKuzE,OAASvzE,KAAKwiB,QAAQjW,KAAK,kCAChCvM,KAAK0oG,cAAgB1oG,KAAKwiB,QAAQjW,KAAK,8BACvCvM,KAAK2oG,YAAc3oG,KAAKwiB,QAAQjW,KAAK,4BACrCvM,KAAK4oG,uBAAyB5oG,KAAKwiB,QAAQjW,KAAK,wCAChDvM,KAAK4oG,uBAAuBjkC,QAAO,IAAM3kE,KAAK6oG,gBAC9C7oG,KAAK8oG,oBAAsB9oG,KAAKwiB,QAAQjW,KAAK,qCAC7CvM,KAAK8oG,oBAAoBnkC,QAAO,IAAM3kE,KAAK6oG,gBAC3C7oG,KAAK+oG,gBAAkB/oG,KAAKwiB,QAAQjW,KAAK,gCACzCvM,KAAK+oG,gBAAgBx0F,GAAG,SAAS,IAAMvU,KAAKgpG,UAAU,KACtDhpG,KAAKipG,YAAcjpG,KAAKwiB,QAAQjW,KAAK,4BACrCvM,KAAKipG,YAAY10F,GAAG,SAAS,IAAMvU,KAAKgpG,SAAS,KACjDhpG,KAAKkpG,aAAelpG,KAAKwiB,QAAQjW,KAAK,6BACtCvM,KAAKkpG,aAAa30F,GAAG,SAAS,IAAMvU,KAAKwoG,gBAEzCxoG,KAAKuzE,OAAOioB,SAAQn8F,UAChB,IAAKqJ,EAAEgiC,UAAWhiC,EAAE4O,SAAuB,MAAV5O,EAAE8oB,KAAyB,MAAV9oB,EAAE8oB,KAI7C,GAAc,UAAV9oB,EAAE8oB,KAA6B,OAAV9oB,EAAE8oB,IAG9B,aAFMxxB,KAAKgpG,SAAStgG,GAAGgqD,UAAY,EAAI,GACvChqD,EAAE+tB,kBACK,OAJPz2B,KAAKuzE,OAAOxd,QAKhB,IAGJ/1D,KAAKyoG,SAASjN,SAAQn8F,UACJ,WAAVqJ,EAAE8oB,WACIxxB,KAAKwoG,aACf,IAGJxoG,KAAKuzE,OAAOh/D,GAAG,SAAS,IAAMvU,KAAKmpG,gBAE5BnpG,KAAKwiB,OAChB,CAEAnjB,wBACI,IAAKW,KAAK00C,sBACN,OAGJ,IAAK,CAAC,OAAQ,OAAQ,UAAUvrC,SAASnJ,KAAKsD,KAAKG,MAC/C,OAGJzD,KAAKskB,cAAgBtkB,KAAKopG,aAE1B,MAAM7qB,EAAe98E,OAAO4qC,eAAerzB,YAAc,GAEzDhZ,KAAKyoG,SAASthE,OACdnnC,KAAKuzE,OAAOn7C,QAEap4B,KAAKyoG,SAASrvE,GAAG,aAGlCmlD,GACAv+E,KAAKuzE,OAAOnuD,IAAIm5D,GAGhBv+E,KAAKuzE,OAAOnuD,aACNplB,KAAK6oG,cAGf7oG,KAAKuzE,OAAOxd,WAEZ/1D,KAAK2oG,YAAYpjF,KAAK,GACtBvlB,KAAK0oG,cAAcnjF,KAAK,GACxBvlB,KAAKuzE,OAAOnuD,IAAIm5D,GAEZA,IACAv+E,KAAKuzE,OAAOxd,eACN/1D,KAAK6oG,eAGvB,CAEAxpG,mBACI,MAAuB,WAAnBW,KAAKsD,KAAKG,YAISzD,KAAKd,YAAYu+D,aAH7Bz9D,KAAKuoG,YAQc,SAAnBvoG,KAAKsD,KAAKG,KACXzD,KAAKsoG,YACLtoG,KAAKqoG,WAEnB,CAEAc,cAOQ5xD,aAAav3C,KAAKqpG,WAMlBrpG,KAAKqpG,UAAY1gG,YAAWtJ,UACxBW,KAAKqpG,UAAY,WACXrpG,KAAK6oG,aAAa,GAxMV,IA2M1B,CAMAxpG,eAAes+C,GACQ39C,KAAKuzE,OAAOnuD,MAI/B,MAAM+gF,EAAahhG,SAASnF,KAAK2oG,YAAYpjF,QACvC6gF,EAAejhG,SAASnF,KAAK0oG,cAAcnjF,QAAU,EAE3D,GAAI4gF,EAAa,EAAG,CAChB,IAAIO,EAAYN,EAAezoD,EAE3B+oD,EAAYP,EAAa,EACzBO,EAAY,EACLA,EAAY,IACnBA,EAAYP,EAAa,GAG7BnmG,KAAK0oG,cAAcnjF,KAAKmhF,EAAY,SAE9B1mG,KAAKskB,QAAQ0kF,SAASrrD,EAAWyoD,EAAcM,EACzD,CACJ,CAGArnG,oBACI,MAAM0mG,EAAa/lG,KAAKuzE,OAAOnuD,MACzB4gF,EAAYhmG,KAAK4oG,uBAAuBj0F,KAAK,WAC7CsxF,EAAYjmG,KAAK8oG,oBAAoBn0F,KAAK,YAE1C,WAACwxF,EAAU,aAAEC,SAAsBpmG,KAAKskB,QAAQukF,YAAY9C,EAAYC,EAAWC,GAEzFjmG,KAAK2oG,YAAYpjF,KAAK4gF,GACtBnmG,KAAK0oG,cAAcnjF,KAAK6gF,GAExBpmG,KAAK+lG,WAAaA,CACtB,CAEA1mG,oBACI,GAAIW,KAAKyoG,SAASrvE,GAAG,YAAa,CAC9Bp5B,KAAKyoG,SAAS/lF,OAId,MAAMyjF,EAAahhG,SAASnF,KAAK2oG,YAAYpjF,QACvC6gF,EAAejhG,SAASnF,KAAK0oG,cAAcnjF,QAAU,EAE3DvlB,KAAK+lG,WAAa,WAEZ/lG,KAAKskB,QAAQglF,cAAcnD,EAAYC,EACjD,CACJ,CAEAryD,YACI,OAAOnxC,MAAMmxC,aAAe,CAAC,OAAQ,OAAQ,UAAU5qC,SAASnJ,KAAKsD,KAAKG,KAC9E,mCC1NW,MAAM8lG,WAAkB,KAC/Bt0D,kBACA,MAAO,IACX,CAEIC,oBACA,MAAO,EACH,IAAI6oD,IACCx3E,KAAK,aACLjc,MAAM,WACNgzF,eAAe,QACfO,SAAQ,IAAM,yCAA0C,oBAAqB,CAACr+F,UAAU,MACxF8lB,MAAM,gBACX,IAAIy4E,IACCx3E,KAAK,QACL+2E,eAAe,QACfO,SAAQt0E,GAAUA,EAAOvhB,eAAe,cACxCsd,MAAM,eAEnB,CAEAyuB,YACI,OAAOnxC,MAAMmxC,aACa,SAAnB/zC,KAAKsD,KAAKG,OACTzD,KAAKd,YAAYC,UAAUqqG,sBACY,YAAxCxpG,KAAKd,YAAYC,UAAU4B,QACtC,CAEA1B,qBACIW,KAAKq1C,MAAM1yB,QAAQhe,OAAOD,EA9DtB,2qBA+DJ1E,KAAKypG,KAAOzpG,KAAKq1C,MAAM9oC,KAAK,OAChC,CAEAlN,sBAAsBiE,GAKlBtD,KAAKg0C,YAAYh0C,KAAKd,YAAYC,UAAUuqG,oBAE5C,MAAMC,EAAWrmG,EAAK8c,SAAS,OAE/B,GAAwB,SAApBupF,GAAUv2F,MAGV,OAFApT,KAAKg0C,WAAU,QACfh0C,KAAKgI,eAAe,iCAIxB,IAAIyhG,EAAO,GAAIG,EAAe,EAE9B,GAAuB,SAAnB5pG,KAAKsD,KAAKG,KAAiB,CAC3B,MAAM,QAAED,SAAkBF,EAAKgG,YAC7BmgG,OAAMG,sBAAsB5pG,KAAK6pG,OAAOrmG,GAC9C,CAEAxD,KAAKypG,KAAK9jF,KAAK8jF,GACX,CAAC,GAAI,QAAQtgG,SAASwgG,GAAUv2F,QAAUw2F,GAAgBppG,EAAA,SAAe,mBACzER,KAAKg0C,WAAU,GACfh0C,KAAKd,YAAYC,UAAUuqG,oBAAmB,IAE9C1pG,KAAKg0C,WAAU,GACfh0C,KAAKd,YAAYC,UAAUuqG,oBAAmB,GAGlD1pG,KAAKgI,eAAe,gCACxB,CAUA6hG,OAAOlkF,GAGH,MAAMmkF,EAAmB,8BAKzB,IAAIL,EAAO/kG,EAAE,QAETqlG,EAAW,EACf,MAAMC,EAAO,CAACP,GACd,IAAIG,EACJ,IAAK,IAAI3zD,EAAI,KAAMg0D,EAAe,EAA0C,QAArCh0D,EAAI6zD,EAAiBtyE,KAAK7R,IAAkBskF,IAAgB,CAI/F,MAAMC,EAAWj0D,EAAE,GACbk0D,EAAaD,EAAWH,EAC9B,GAAII,EAAa,EAEb,IAAK,IAAI36F,EAAI,EAAGA,EAAI26F,EAAY36F,IAAK,CACjC,MAAM46F,EAAM1lG,EAAE,QACdslG,EAAKA,EAAKvnG,OAAS,GAAGkC,OAAOylG,GAC7BJ,EAAK19F,KAAK89F,EACd,MACG,GAAID,EAAa,EAGpB,IAAK,IAAI36F,EAAI,EAAGA,GAAK26F,GAAcH,EAAKvnG,OAAS,IAAK+M,EAClDw6F,EAAKl5F,MAGbi5F,EAAWG,EAMX,MAAMG,EAAc3lG,EAAE,SAASihB,KAAKswB,EAAE,IAAI1wB,OACpC+kF,EAAM5lG,EAAE,QAAQ6gB,KAAK8kF,GAC3BC,EAAI/1F,GAAG,SAAS,IAAMvU,KAAKuqG,cAAcN,KACzCD,EAAKA,EAAKvnG,OAAS,GAAGkC,OAAO2lG,GAC7BV,EAAeK,CACnB,CAIA,OAFAR,EAAOzpG,KAAKwqG,SAASf,GAEd,CACHA,OACAG,eAER,CAKAY,SAASf,GACL,KAG6B,IAFPA,EAAKr+F,WAET3I,QAHL,CAOT,MAAMgoG,EAAShB,EAAKr+F,SAAS,UAE7B,GAA0B,OAAtBq/F,EAAO,GAAG1yE,QACV,MAGJ0xE,EAAOgB,CACX,CACA,OAAOhB,CACX,CAEApqG,oBAAoB4qG,GAQhB,IAAIvkF,EACJ,SAHyB1lB,KAAKd,YAAYu+D,aAItC/3C,QAAmB1lB,KAAKd,YAAY4oG,wBACjC,CACH,MAAMrvE,QAAmBz4B,KAAKd,YAAYgiC,gBAC1Cxb,EAAahhB,EAAE+zB,EAAWiyE,cAC9B,CAEA,MAAMC,EAAiBjlF,GAAYnZ,KAAK,+CAA+C09F,GACvFU,GAAgB5yC,eAAe,CAAE6yC,SAAU,UAC/C,CAEAvrG,wBACIW,KAAKd,YAAYC,UAAUqqG,sBAAuB,QAC5CxpG,KAAK80C,UACX90C,KAAKgI,eAAe,gCACxB,CAEA3I,6BAA4B,YAACoK,KACrBA,EAAY6lC,sBAAsBtvC,KAAKT,SAEhCkK,EAAY4J,mBAAmB9G,MAAKwG,GAAsB,UAAdA,EAAKtP,OACpDsP,EAAKO,KAAK2jB,cAAc9tB,SAAS,aAA6B,QAAd4J,EAAKO,OACtD,cAA6BP,EAAM/S,KAAKsD,gBAHrCtD,KAAK80C,SAOnB,ECtMW,MAAM+1D,WAA6B,KAC1C51D,kBACA,MAAO,MACX,CAEIC,oBACA,MAAO,EACH,IAAI6oD,IACCx3E,KAAK,aACLjc,MAAM,MACNgzF,eAAe,QACfO,SAAQ,IAAM,yCAA0C,oBAAqB,CAACr+F,UAAU,MACxF8lB,MAAM,gBACX,IAAIy4E,IACCx3E,KAAK,QACL+2E,eAAe,QACfO,SAAQt0E,GAAUA,EAAOvhB,eAAe,cACxCsd,MAAM,eAEnB,CAEAyuB,YACI,OAAOnxC,MAAMmxC,aACa,SAAnB/zC,KAAKsD,KAAKG,OACTzD,KAAKd,YAAYC,UAAU2rG,iCACY,YAAxC9qG,KAAKd,YAAYC,UAAU4B,QACtC,CAEA1B,qBACIW,KAAKq1C,MAAM1yB,QAAQhe,OAAOD,EA3DtB,2sBA4DJ1E,KAAK+qG,gBAAkB/qG,KAAKq1C,MAAM9oC,KAAK,mBAC3C,CAEAlN,sBAAsBiE,GAMdtD,KAAKd,YAAYC,UAAU6rG,8BAC3BhrG,KAAKg0C,WAAU,GAEfh0C,KAAKg0C,WAAU,GAGnB,MAAMi3D,EAAwBn/F,KAAK0P,MAAMhb,EAAA,MAAY,mBAErD,GAAI8C,EAAK6E,cAAc,yBAA2B8iG,EAAsBxoG,OAGpE,OAFAzC,KAAKg0C,WAAU,QACfh0C,KAAKgI,eAAe,iCAIxB,IAAI+iG,EAAkB,GAAIG,GAAa,EAEvC,GAAuB,SAAnBlrG,KAAKsD,KAAKG,KAAiB,CAC3B,MAAM,QAACD,SAAiBF,EAAK6nG,sBAC3BJ,kBAAiBG,aAAalrG,KAAKorG,iBAAiB5nG,EAASynG,GACnE,CACAjrG,KAAK+qG,gBAAgBpoF,QAAQhe,OAAOomG,GAChCG,EAAY,GACZlrG,KAAKg0C,WAAU,GACfh0C,KAAKd,YAAYC,UAAU6rG,+BAAgC,IAE3DhrG,KAAKg0C,WAAU,GACfh0C,KAAKd,YAAYC,UAAU6rG,+BAAgC,GAG/DhrG,KAAKgI,eAAe,gCACxB,CAEAojG,iBAAiB5nG,EAASynG,GAatB,IAAII,EAAa,GAAIC,EAAmB,GACpCL,EAAsB9hG,SAAS,aAC/BkiG,GAAc,6FACdC,GAAoB,IAdT,wEAcoBtwD,UAE/BiwD,EAAsB9hG,SAAS,WAC/BkiG,GAAc,uEACdC,GAAoB,IAhBT,iEAgBoBtwD,UAE/BiwD,EAAsB9hG,SAAS,YAC/BkiG,GAAc,iCACdC,GAAoB,IAlBT,qBAkBoBtwD,UAE/BiwD,EAAsB9hG,SAAS,UAC/BkiG,GAAc,2CACdC,GAAoB,IApBT,+BAoBoBtwD,UAE/BiwD,EAAsB9hG,SAAS,eAC/BkiG,GAAc,iCACdC,GAAoB,IAtBT,oBAsBoBtwD,UAGnCqwD,EAAaA,EAAWzsD,UAAU,GAClC0sD,EAAmB,IAAMA,EAAiB1sD,UAAU,GAAK,IACzD,MAAM2sD,EAAgB,IAAIliE,OAAOiiE,EAAkB,MAC7CP,EAAkBrmG,EAAE,QAC1B,IAAI8mG,GAAgB,EAAGN,EAAY,EACnC,IAAK,IAAIh1E,EAAQ,KAAMu1E,EAAW,EAA8C,QAAzCv1E,EAAQq1E,EAAc/zE,KAAKh0B,IAAqBioG,IAAY,CAC/F,MAAMC,EAAUx1E,EAAM,GAChB8rC,EAAa9rC,EAAMpF,MACnBixC,EAAWwpC,EAAcI,UAC/B,IAAsB,IAAlBH,GAAuBxpC,IAAewpC,EAEtCT,EAAgB3/F,WAAW0+D,OAAOnlE,OAAO+mG,OACtC,CAMH,IAFgBhnG,EAAEgnG,GAASnmF,OAAOvL,OAY9B,SATA+wF,EAAgBpmG,OACZD,EAAE,QACGihB,KAAK+lF,GACLn3F,GAAG,SAAS,IAAMvU,KAAK4rG,qBAAqBP,EAAYI,MAGjEP,GAKR,CACAM,EAAezpC,CACnB,CACA,MAAO,CACHgpC,kBACAG,YAER,CAEA7rG,2BAA2BgsG,EAAYQ,GAEnC,IAAIC,EACJ,SAFyB9rG,KAAKd,YAAYu+D,aAItCquC,SADyB9rG,KAAKd,YAAY4oG,qBACfv7F,KAAK8+F,GAAYz/F,QAAO,WAC/C,GAAIy/F,EAAWt1E,QAAQ,UAAY,GAAKs1E,EAAWt1E,QAAQ,oBAAsB,EAAG,CAChF,IAAIhc,EAAQ/Z,KAAKqzC,MAAMt5B,MACvB,QAAqC,SAA5BrV,EAAE1E,MAAM2U,KAAK,YAAmC,KAAVoF,EACnD,CACI,OAAO,CAEf,IAAGnO,QAAO,WACN,OAA6C,IAAtClH,EAAE1E,MAAMqW,OAAOg1F,GAAY5oG,QACoB,IAA/CiC,EAAE1E,MAAMqW,SAASA,OAAOg1F,GAAY5oG,QACoB,IAAxDiC,EAAE1E,MAAMqW,SAASA,SAASA,OAAOg1F,GAAY5oG,QACoB,IAAjEiC,EAAE1E,MAAMqW,SAASA,SAASA,SAASA,OAAOg1F,GAAY5oG,MACjE,QACG,CACH,MAAMg2B,QAAmBz4B,KAAKd,YAAYgiC,gBAC1C4qE,EAAgBpnG,EAAE+zB,EAAWoQ,QAAQC,KAAKijE,SAAS3wF,SAAS4wF,OAAO54F,OAAO7G,KAAK8+F,GAAYz/F,QAAO,WAG9F,GAAIy/F,EAAWt1E,QAAQ,UAAY,GAAKs1E,EAAWt1E,QAAQ,oBAAsB,EAAG,CAChF,IAAIhc,EAAQ/Z,KAAKqzC,MAAMt5B,MACvB,QAAqC,SAA5BrV,EAAE1E,MAAM2U,KAAK,YAAmC,KAAVoF,EACnD,CACI,OAAO,CAEf,IAAGnO,QAAO,WAEN,OAA6C,IAAtClH,EAAE1E,MAAMqW,OAAOg1F,GAAY5oG,QACoB,IAA/CiC,EAAE1E,MAAMqW,SAASA,OAAOg1F,GAAY5oG,QACoB,IAAxDiC,EAAE1E,MAAMqW,SAASA,SAASA,OAAOg1F,GAAY5oG,QACoB,IAAjEiC,EAAE1E,MAAMqW,SAASA,SAASA,SAASA,OAAOg1F,GAAY5oG,MACjE,GACJ,CACAqpG,EAAcD,GAAW9zC,eAAe,CACpC6yC,SAAU,SAAUh3D,MAAO,UAEnC,CAEAv0C,wBACIW,KAAKd,YAAYC,UAAU2rG,iCAAkC,QACvD9qG,KAAK80C,UACX90C,KAAKgI,eAAe,gCACxB,CAEA3I,6BAA4B,YAACoK,KACrBA,EAAY6lC,sBAAsBtvC,KAAKT,SAEhCkK,EAAY4J,mBAAmB9G,MAAKwG,GAAsB,UAAdA,EAAKtP,OACpDsP,EAAKO,KAAK2jB,cAAc9tB,SAAS,aAA6B,wBAAd4J,EAAKO,OACtD,cAA6BP,EAAM/S,KAAKsD,gBAHrCtD,KAAK80C,SAMnB,EC9KW,MAAMm3D,WAA0B,IAC3Cn4D,WACI9zC,KAAKwiB,QAAU9d,EAjEX,2nEAmEJ1E,KAAKksG,oBAAsBlsG,KAAKwiB,QAAQjW,KAAK,wBAC7CvM,KAAKksG,oBAAoB33F,GAAG,UAAU,IAAMvU,KAAK80C,YAEjD90C,KAAKmsG,mBAAqBnsG,KAAKwiB,QAAQjW,KAAK,wBAE5CvM,KAAKosG,qBAAuBpsG,KAAKwiB,QAAQjW,KAAK,+BAC9CvM,KAAKqsG,oBAAsBrsG,KAAKwiB,QAAQjW,KAAK,8BAE7CvM,KAAKwiB,QAAQjO,GAAG,QAAS,qBAAqBlV,UAC1C,MAAM8zB,EAAazuB,EAAE2S,EAAM1E,QAAQI,KAAK,yBAElC,GAA4B,cAAeogB,SAE3CnzB,KAAK80C,SAAS,IAGxB90C,KAAKssG,eAAiBtsG,KAAKwiB,QAAQjW,KAAK,yBACxCvM,KAAKssG,eAAe/3F,GAAG,SAASlV,gBACtBkE,EAAA,OAAY,sBAAuB,CACrC4O,QAASnS,KAAK+R,wBACdw6F,mBAAoBvsG,KAAKksG,oBAAoB9yE,GAAG,cAGpD,sBAAyB,aAAc,KAEvCn4B,EAAA,2BAAyB,GAEjC,CAEA5B,gBACIW,KAAKwsG,yBAEL,MAAM,kBAACC,SAA2BlpG,EAAA,OAAY,6BAA8B,CACxE4O,QAASnS,KAAK+R,wBACdw6F,mBAAoBvsG,KAAKksG,oBAAoB9yE,GAAG,cAGpDp5B,KAAKmsG,mBAAmB5mF,KAAKknF,GAE7B,MAAMC,QAAuB7sG,EAAA,gBAAc,eAErCqzB,EAAU,GAA+Bw5E,GAE/C1sG,KAAKqsG,oBAAoB1pF,QAErBuQ,EAAQzwB,OAAS,EACjBzC,KAAKqsG,oBAAoB1nG,UAAUuuB,EAAQvnB,KAAItK,GAAUA,EAAOiT,YAEhEtU,KAAKqsG,oBAAoB1nG,OAAOD,EAAE,8BAE1C,CAEA8nG,yBACIxsG,KAAKosG,qBAAqBzpF,QAE1B,IAAK,MAAMg0E,KAAe,GAAiC,CACvD,MAAMgW,EAAmBjoG,EAAE,QACrBkoG,EAAeloG,EAAE,QAClBC,OAAOD,EAAE,QAAQ6gB,KAAK,GAAGoxE,EAAYrsF,YACrC3F,OAAOgoG,GAEZ,IAAK,MAAMtrG,KAAUs1F,EAAYzjE,QAC7By5E,EAAiBhoG,OACbD,EAAE,+BACGqO,KAAK,kBAAmB1R,EAAO8xB,YAC/B5N,KAAKlkB,EAAO+xF,cAIzBpzF,KAAKosG,qBAAqBznG,OAAOioG,EACrC,CACJ,CAEAr9C,uBAAsB,YAAC9lD,IAEfA,EAAY4J,mBAAmB9G,MAAK6L,GACvB,UAAbA,EAAI3U,MACY,WAAb2U,EAAI9E,MACW,gBAAf8E,EAAI7Y,QACJ6Y,EAAIxO,aAGH5J,KAAK+R,yBAA2B/R,KAAKwiB,QAAQ4W,GAAG,aAChDp5B,KAAK80C,SAGjB,CAEAz1C,kCAAiC,wBAAC0S,IAC9B/R,KAAK+R,wBAA0BA,EAC/B/R,KAAKksG,oBAAoBv3F,KAAK,WAAW,SAEnC3U,KAAK80C,UAEX7zC,EAAA,mBAAiBjB,KAAKwiB,QAC1B,EC/GW,MAAMqqF,WAAoB,IACrC/4D,WACI9zC,KAAKwiB,QAAU9d,EAxDX,ojEAyDJ1E,KAAK8sG,YAAc9sG,KAAKwiB,QAAQjW,KAAK,gBACrCvM,KAAK+sG,WAAa/sG,KAAKwiB,QAAQjW,KAAK,eACpCvM,KAAKgtG,aAAehtG,KAAKwiB,QAAQjW,KAAK,iBACtCvM,KAAKitG,WAAajtG,KAAKwiB,QAAQjW,KAAK,eACpCvM,KAAKktG,eAAiBltG,KAAKwiB,QAAQjW,KAAK,mBACxCvM,KAAKmtG,eAAiBntG,KAAKwiB,QAAQjW,KAAK,kBAC5C,CAEAlN,gBACI,MAAM+tG,QAAgB7pG,EAAA,MAAW,YAEjCvD,KAAK8sG,YAAYvnF,KAAK6nF,EAAQC,YAC9BrtG,KAAK+sG,WAAWxnF,KAAK6nF,EAAQE,WAC7BttG,KAAKgtG,aAAaznF,KAAK6nF,EAAQG,aAC/BvtG,KAAKitG,WAAW1nF,KAAK6nF,EAAQI,WAC7BxtG,KAAKktG,eAAe3nF,KAAK6nF,EAAQK,eACjCztG,KAAKktG,eAAen6F,KAAK,OAAQ,2CAA2Cq6F,EAAQK,iBACpFztG,KAAKmtG,eAAe5nF,KAAK6nF,EAAQM,cACrC,CAEAruG,mCACUW,KAAK80C,UAEX7zC,EAAA,mBAAiBjB,KAAKwiB,QAC1B,ECqEW,MAAMmrF,WAAmB,IACpC75D,WACI9zC,KAAKwiB,QAAU9d,EAzJX,qmRA0JR,CAEAkpG,gBACI3sG,EAAA,mBAAiBjB,KAAKwiB,QAC1B,ECjIW,MAAMqrF,WAA4B,IAC7C/5D,WACI9zC,KAAKwiB,QAAU9d,EAvBX,u2BAwBJ1E,KAAK6sB,SAAW7sB,KAAKwiB,QAAQjW,KAAK,2BAClCvM,KAAK8tG,sBAAwB9tG,KAAKwiB,QAAQjW,KAAK,mCAC/CvM,KAAK8tG,sBAAsBv5F,GAAG,SAAS,KACnChR,EAAA,OAAY,iCAAiCyH,MAAK,KAC9ChL,KAAK80C,UAEL,sBAAyB,aAAa,GACxC,GAEV,CAEAz1C,8BAA6B,eAACM,IAC1BK,KAAKL,eAAiBA,QAEhBK,KAAK80C,UAEX7zC,EAAA,mBAAiBjB,KAAKwiB,QAC1B,CAEAnjB,gBACSW,KAAKL,iBACNK,KAAKL,eAAiB,wBAG1B,MAAMouG,QAA0BxqG,EAAA,MAAW,kBAAkBvD,KAAKL,wBAG5DE,EAAA,iBAAekuG,EAAkBpiG,KAAIksC,GAAKA,EAAEt4C,UAAS,GAE3DS,KAAK6sB,SAASlK,QAEmB,IAA7BorF,EAAkBtrG,QAClBzC,KAAK6sB,SAASloB,OAAO,aAGzB,MAAMqpG,EAAgBhuG,KAAKiuG,YAAYF,GAEvC,IAAK,MAAOG,EAASC,KAAeH,EAAe,CAC/C,MAAMI,EAAe1pG,EAAE,QAEjB2pG,EAAQ3pG,EAAE,SAASC,OAAOD,EAAE,OAAO6gB,KAAK2oF,IAAUvpG,OAAOypG,GAE/D,IAAK,MAAMzpC,KAAUwpC,EAAY,CAC7B,MAAMG,EAAgB3pC,EAAOv2C,KAAK4H,OAAO,GAAI,GAE7C,IAAI4B,EAEJ,GAAI+sC,EAAO4pC,mBAGP,GAFA32E,EAAYlzB,EAAE,UAAU6gB,KAAKo/C,EAAO6pC,eAEhC7pC,EAAO8pC,eAAgB,CACvB,MAAMC,EAAgBhqG,EAAE,0BACnB6gB,KAAK,QACLhR,GAAG,SAASlV,gBAGCuhC,EAAA,UAFG,+BAGHr9B,EAAA,MAAW,SAASohE,EAAOplE,mBAEjCS,KAAKwiB,QAAQgmB,MAAM,cAEb7kC,EAAA,kCAEN,wCAAyCyF,QAAQu7D,EAAOplE,QAC5D,IAGRq4B,EACKjzB,OAAO,MACPA,OAAO+pG,GACP/pG,OAAO,IAChB,MACG,CACH,MAAMrB,QAAazD,EAAA,gBAAc8kE,EAAOplE,QAClCO,EAAWwD,EAAKqb,wBAGlBiZ,EADA93B,QACkB,eAAuBA,EAAU,CAC/CwK,MAAOq6D,EAAOr6D,MACdmtB,cAAc,IAGN/yB,EAAE,UAAU6gB,KAAKjiB,EAAKgH,MAE1C,CAEA8jG,EAAazpG,OAAOD,EAAE,QACjBC,OACGD,EAAE,UACG6gB,KAAK+oF,GACLv7F,KAAK,QAAS4xD,EAAOv2C,OAE7BzpB,OAAO,OACPA,OAAOizB,GAChB,CAEA53B,KAAK6sB,SAASloB,OAAO0pG,EACzB,CACJ,CAEAJ,YAAYp0D,GACR,MAAMm0D,EAAgB,IAAIW,IAE1B,IAAK,MAAMv2F,KAAOyhC,EAAM,CACpB,MAAMq0D,EAAU91F,EAAIgW,KAAK4H,OAAO,EAAG,IAE9Bg4E,EAAc7zF,IAAI+zF,IACnBF,EAAcpxE,IAAIsxE,EAAS,IAG/BF,EAAcvkF,IAAIykF,GAAS5hG,KAAK8L,EACpC,CAEA,OAAO41F,CACX,EC7IJ,IAAI37F,GAoCW,MAAMu8F,WAA2B,IAC5C96D,WACI9zC,KAAKwiB,QAAU9d,EApCX,28CAqCJ1E,KAAK44E,MAAQ54E,KAAKwiB,QAAQjW,KAAK,uBAC/BvM,KAAK6uG,iBAAmB7uG,KAAKwiB,QAAQjW,KAAK,wBAC1CvM,KAAKu9D,WAAav9D,KAAKwiB,QAAQjW,KAAK,6BAEpCvM,KAAK44E,MAAMrkE,GAAG,UAAU,KACpBvU,KAAK8uG,cAEE,KAGX9uG,KAAKwiB,QAAQjO,GAAG,kBAAkB,IAAMvU,KAAK6uG,iBAAiB/pG,QAAQ,UAC1E,CAEAzF,cAAcS,GACV,MAAM,OAACP,EAAM,aAAE8H,GAAgBtH,EAAA,8BAAwCD,GAEvE,IAAKP,IAAW8H,EACZ,OAGJgL,SAAiBxS,EAAA,oBAAkBwH,EAAc9H,GACjD,MAAM6mB,EAASvmB,EAAA,kBAAgBwS,IAE/B,IAAK+T,GAA4B,SAAlBA,EAAO7mB,OAClB,OAKJ,GAAwB,kBAFCM,EAAA,gBAAcumB,EAAO/e,eAE/B5D,KACX,OAGJzD,KAAK6uG,iBAAiBzpF,IAAIgB,EAAO7M,QAEjC,MAAM2/B,QAAkBn5C,EAAA,eAAyBR,GAEjDS,KAAKu9D,WAAWh4C,KAAK,MAAM2zB,IAC/B,CAEA75C,8BACI,MAAMS,EAAW,sDAEXE,KAAK80C,QAAQh1C,GAEnBmB,EAAA,mBAAiBjB,KAAKwiB,QAC1B,CAEAnjB,mBACI,MAAMka,EAASvZ,KAAK6uG,iBAAiBzpF,YAE/B7hB,EAAA,MAAW,YAAY8O,gBAAuB,CAACkH,OAAQA,IAE7DvZ,KAAKwiB,QAAQgmB,MAAM,QAEnB,sBAAyB,WAC7B,ECPW,MAAMumE,WAA6B,IAC9Cj7D,WACI9zC,KAAKwiB,QAAU9d,EA9FX,2oHA+FJ1E,KAAK44E,MAAQ54E,KAAKwiB,QAAQjW,KAAK,0BAE/BvM,KAAK44E,MAAMrkE,GAAG,UAAUlV,UACpB,MAAM2vG,EAAShvG,KAAK44E,MAAMrsE,KAAK,iCAAiC6Y,MAC1D6pF,EAAgBjvG,KAAK44E,MAAMrsE,KAAK,wCAAwC6Y,MACxE8pF,EAAelvG,KAAK44E,MAAMrsE,KAAK,oCAAoC6sB,GAAG,YACtE+1E,EAAcnvG,KAAK44E,MAAMrsE,KAAK,8BAA8B6sB,GAAG,YAC/Dg2E,EAAapvG,KAAK44E,MAAMrsE,KAAK,6BAA6B6Y,YAE1D7hB,EAAA,MAAW,SAASvD,KAAKqH,6BAA8B,CAAC2nG,SAAQC,gBAAeC,eAAcC,cAAaC,eAEhHnuG,EAAA,2BAAyB,GAEjC,CAEA5B,2BAA0B,KAAC4S,IACvBjS,KAAKqH,aAAe4K,EAAKC,KAAK3S,OAE9B0B,EAAA,mBAAiBjB,KAAKwiB,SAEtBxiB,KAAK44E,MAAMrsE,KAAK,eAAe6rB,OACnC,EChGW,MAAMi3E,WAA8B,IAC/Cv7D,WACI9zC,KAAKwiB,QAAU9d,EAvBX,yvBAwBJ1E,KAAKsvG,2BAA6BtvG,KAAKwiB,QAAQjW,KAAK,iCACpDvM,KAAKsvG,2BAA2B/6F,GAAG,SAAS,KACxCvU,KAAKgI,eAAe,cAAe,CAAEpH,QAAS,oBAAqB,GAE3E,CAEA2uG,0BACItuG,EAAA,mBAAiBjB,KAAKwiB,QAC1B,ECmBW,MAAMgtF,WAA0B,IAC3C17D,WACI9zC,KAAKwiB,QAAU9d,EAlDX,omEAmDJ1E,KAAK44E,MAAQ54E,KAAKwiB,QAAQjW,KAAK,sBAC/BvM,KAAKg8E,cAAgBh8E,KAAKwiB,QAAQjW,KAAK,8BACvCvM,KAAK44E,MAAMrkE,GAAG,UAAU,KACpB,MAAMzU,EAAWE,KAAKg8E,cAAczgC,sBAWpC,OATIz7C,GACAE,KAAKwiB,QAAQgmB,MAAM,QAEnBxoC,KAAKyvG,YAAY3vG,IAGjB8I,SAAS,kBAGN,CAAK,GAEpB,CAEAvJ,kCAAiC,eAACo/E,IAC9Bz+E,KAAKy+E,eAAiBA,QAEhBz+E,KAAK80C,UAEX7zC,EAAA,mBAAiBjB,KAAKwiB,QAC1B,CAEAnjB,cAAckqB,GACVvpB,KAAKg8E,cAAc52D,IAAI,IAEvB,uBAA6CplB,KAAKg8E,cAAe,CAC7D3hC,4BAA4B,EAC5BpB,oBAAoB,IAExB,kBAAwCj5C,KAAKg8E,cACjD,CAEA38E,kBAAkBS,GACd,MAAMP,EAASQ,EAAA,mBAA6BD,GACtCwD,QAAazD,EAAA,gBAAcN,GAE3B0/E,EAAUv6E,EAAE,+CAA+C0gB,MAE7D,CAAC,QAAS,SAAU,WAAWjc,SAAS7F,EAAKG,MAG7CzD,KAAKy+E,eAAeixB,SAASnwG,GAG7BS,KAAKy+E,eAAeO,eAAez/E,EAAQ0/E,EAEnD,mCChEW,MAAM0wB,WAA8B,IAC/ChtG,YAAY0sB,GACRzsB,MAAMysB,GAENrvB,KAAKkK,QAAU,KACflK,KAAK4vG,iBAAmB,KACxB5vG,KAAK6vG,gBAAkB,IAC3B,CAEA/7D,WACI9zC,KAAKwiB,QAAU9d,EAlDX,q7CAmDJ1E,KAAKw+F,kBAAoBx+F,KAAKwiB,QAAQjW,KAAK,uBAC3CvM,KAAK8vG,yBAA2B9vG,KAAKwiB,QAAQjW,KAAK,+BAClDvM,KAAK8vG,yBAAyB3xD,WAE9Bn+C,KAAKwiB,QAAQjO,GAAG,mBAAmB,KAC3BvU,KAAKkK,SACLlK,KAAKkK,QAAQ,CAAC3D,SAAS,IAGvBvG,KAAK4vG,mBACL5vG,KAAK4vG,iBAAiB9qG,QAAQ,SAC9B9E,KAAK4vG,iBAAmB,MAG5BhrG,KAAK2jC,aAAevoC,KAAK6vG,eAAe,IAG5C7vG,KAAKw+F,kBAAkBjqF,GAAG,QAAS,kBAAkB7L,GAAK1I,KAAK+vG,UAAUrnG,KAEzE1I,KAAKw+F,kBAAkBjqF,GAAG,QAAS,kBAAkB7L,IACjD1I,KAAKw+F,kBAAkBjyF,KAAK,kBAAkBonB,MAAK,CAACnkB,EAAG4F,KACnD1Q,EAAE0Q,GAAI6+B,YAAY,SAAU7+B,IAAO1M,EAAEiK,OAAO,GAC9C,IAGN3S,KAAKw+F,kBAAkBjqF,GAAG,UAAW,kBAAkB7L,IACnD,GAAc,UAAVA,EAAE8oB,IAGF,OAFAxxB,KAAK+vG,UAAUrnG,GACfA,EAAE+tB,kBACK,CACX,IAGJz2B,KAAKw+F,kBAAkBnoF,SAAS9B,GAAG,oBAAoB7L,IAE/CA,EAAEsnG,YACFtnG,EAAE+tB,gBACN,GAER,CAEAp3B,2BAA0B,SAAC0K,IACvB/J,KAAK4vG,iBAAmBlrG,EAAE,UAE1B,MAAMurG,QAAkB,wBAExBjwG,KAAKw+F,kBAAkB77E,QAEvB,IAAK,MAAMwF,KAAY8nF,EACI,SAAnB9nF,EAAS7d,MACTtK,KAAKw+F,kBAAkB75F,OAAOD,EAAE,gCAAgCC,OAAO,eAGvE3E,KAAKw+F,kBAAkB75F,OACnBD,EAAE,0CACGqO,KAAK,iBAAkBoV,EAAS1kB,MAChCsP,KAAK,wBAAyBoV,EAASwQ,gBACvCh0B,OAAOD,EAAE,UAAUmf,SAASsE,EAASlE,SACrCtf,OAAO,IAAIwjB,EAAS7d,UAKrCtK,KAAK8vG,yBAAyB3xD,SAAS,QAEvCn+C,KAAK6vG,gBAAkBjrG,KAAK2jC,aAC5B3jC,KAAK2jC,aAAevoC,KAAKwiB,QACzBxiB,KAAKwiB,QAAQgmB,QAEbxoC,KAAKw+F,kBAAkBjyF,KAAK,wBAAwB6rB,QAEpDp4B,KAAKkK,QAAUH,CACnB,CAEAgmG,UAAUrnG,GACN,MAAMyb,EAAQzf,EAAEgE,EAAEiK,QAAQ+B,QAAQ,kBAC5ByT,EAAWhE,EAAMpR,KAAK,kBACtB4lB,EAAiBxU,EAAMpR,KAAK,yBAElC/S,KAAKkK,QAAQ,CACT3D,SAAS,EACT4hB,WACAwQ,mBAEJ34B,KAAKkK,QAAU,KAEflK,KAAKwiB,QAAQgmB,MAAM,OACvB,EC/GW,MAAM0nE,WAAyB,IAC1CvtG,cACIC,QAEA5C,KAAKmwG,aAAe,CACxB,CAEAr8D,WACI9zC,KAAKwiB,QAAU9d,EAhCX,+5BAiCJ1E,KAAKg8E,cAAgBh8E,KAAKwiB,QAAQjW,KAAK,8BACvCvM,KAAK6nG,SAAW7nG,KAAKwiB,QAAQjW,KAAK,yBAClCvM,KAAKowG,sBAAwBpwG,KAAKwiB,QAAQjW,KAAK,6BAC/CvM,KAAKowG,sBAAsB77F,GAAG,SAAS7L,GAAK1I,KAAKqwG,eAAe3nG,KAEhE,mBAA+B1I,KAAKwiB,QAAS,eAAe9Z,GAAK1I,KAAKqwG,eAAe3nG,IACzF,CAEArJ,wBACI4B,EAAA,mBAAiBjB,KAAKwiB,SAGtBxiB,KAAK80C,UAEL90C,KAAKmwG,aAAet5F,KAAKC,KAC7B,CAEAzX,gBACI,uBAA6CW,KAAKg8E,cAAe,CAC7D/iC,oBAAoB,EACpBoB,4BAA4B,EAC5B9gB,UAAWv5B,KAAK6nG,WAGftiE,IAAI,6BACJhxB,GAAG,6BAA6B,SAAU8C,EAAO8jC,EAAY2kB,GAC1D,IAAK3kB,EAAWr7C,SACZ,OAAO,EAGX,wCAAyCsJ,QAAQ+xC,EAAWr7C,SAChE,IAMA+W,KAAKC,MAAQ9W,KAAKmwG,aAAeG,KACjC,kBAAwCtwG,KAAKg8E,eAE7Ch8E,KAAKg8E,cAGAp1E,aAAa,MAAO5G,KAAKg8E,cAAcgwB,OAAOzmF,QAC9CzgB,QAAQ,SACRA,QAAQ,SAErB,CAEAurG,eAAe3nG,GAEXA,EAAE+tB,iBACF/tB,EAAE0b,kBAEF,MAAM1kB,EAAeM,KAAKg8E,cAAc52D,MAExCplB,KAAKgI,eAAe,cAAe,CAACtI,iBAEpCM,KAAKwiB,QAAQgmB,MAAM,OACvB,ECtCW,MAAM+nE,WAAsB,IACvCz8D,WACI9zC,KAAKwiB,QAAU9d,EAzDX,s+EA0DJ1E,KAAK44E,MAAQ54E,KAAKwiB,QAAQjW,KAAK,kBAC/BvM,KAAKg8E,cAAgBh8E,KAAKwiB,QAAQjW,KAAK,+BACvCvM,KAAKwwG,WAAaxwG,KAAKwiB,QAAQjW,KAAK,eACpCvM,KAAKywG,sBAAwBzwG,KAAKwiB,QAAQjW,KAAK,4BAC/CvM,KAAK0wG,oBAAsB1wG,KAAKwiB,QAAQjW,KAAK,0BAC7CvM,KAAK2wG,uBAAyB3wG,KAAKwiB,QAAQjW,KAAK,8BAGhDvM,KAAKy+E,eAAiB,KAEtBz+E,KAAK44E,MAAMrkE,GAAG,UAAU,KACpB,GAAIvU,KAAKg8E,cAAczgC,sBAAuB,CAC1Cv7C,KAAKwiB,QAAQgmB,MAAM,QAEnB,MAAM7Q,EAAmC,mBAAvB33B,KAAK4wG,cAAqC,KAAO5wG,KAAKwwG,WAAWprF,MAEnFplB,KAAKy+E,eAAeoyB,QAAQ7wG,KAAKg8E,cAAczgC,sBAAuB5jB,EAC1E,MACS33B,KAAKg8E,cAAcvgC,2BACxBz7C,KAAKwiB,QAAQgmB,MAAM,QAEnBxoC,KAAKy+E,eAAeoyB,QAAQ7wG,KAAKg8E,cAAcvgC,0BAA2Bz7C,KAAKwwG,WAAWprF,QAG1Fxc,SAAS,mBAGb,OAAO,CAAK,GAEpB,CAEAvJ,8BAA6B,eAACo/E,EAAc,KAAEl5D,EAAO,KACjDvlB,KAAKy+E,eAAiBA,EAEtBz+E,KAAKywG,sBAAsBtjF,QAAQntB,KAAKy+E,eAAeP,gBAEvDl+E,KAAKywG,sBAAsBlkG,KAAK,qBAAqBgI,GAAG,UAAU7L,GAAK1I,KAAK8wG,8BAA8BpoG,KAGtG1I,KAAKy+E,eAAeP,eACpBl+E,KAAKywG,sBAAsBlkG,KAAK,6BAA6BoI,KAAK,WAAW,GAG7E3U,KAAKywG,sBAAsBlkG,KAAK,iCAAiCoI,KAAK,WAAW,GAGrF3U,KAAK8wG,gCAEL7vG,EAAA,mBAAiBjB,KAAKwiB,SAEtBxiB,KAAKg8E,cAAc52D,IAAI,IACvBplB,KAAKwwG,WAAWprF,IAAI,IAEpB,MAAM2rF,EAAsB1xG,UACxB,MAAM65C,QAAkBn5C,EAAA,eAAyBR,GAEjDS,KAAKwwG,WAAWprF,IAAI8zB,EAAU,EAGlC,uBAA6Cl5C,KAAKg8E,cAAe,CAC7D3iC,oBAAoB,EACpBJ,oBAAoB,IAGxBj5C,KAAKg8E,cAAcznE,GAAG,6BAA6B,CAAC8C,EAAO8jC,EAAY2kB,KACnE,IAAK3kB,EAAWr7C,SACZ,OAAO,EAGXE,KAAK8wG,gCAEL,MAAMvxG,EAASQ,EAAA,mBAA6Bo7C,EAAWr7C,UAEnDP,GACAwxG,EAAoBxxG,EACxB,IAGJS,KAAKg8E,cAAcznE,GAAG,qCAAqC,CAAC8C,EAAO8jC,EAAY2kB,KAC3E,IAAK3kB,EAAW7B,aACZ,OAAO,EAGXt5C,KAAK8wG,gCAEL9wG,KAAKwwG,WAAWprF,IAAI+1B,EAAW7B,aAAa,IAGhDt5C,KAAKg8E,cAAcznE,GAAG,8BAA+B,CAAC8C,EAAO8jC,EAAY2kB,KACrE,GAAI3kB,EAAW7B,aACXt5C,KAAKwwG,WAAWprF,IAAI+1B,EAAW7B,kBAE9B,CACD,MAAM/5C,EAASQ,EAAA,mBAA6Bo7C,EAAWr7C,UAEnDP,GACAwxG,EAAoBxxG,EAE5B,KAGAgmB,GAAQA,EAAKvL,OACb,UAAgCha,KAAKg8E,cAAez2D,GAGpD,kBAAwCvlB,KAAKg8E,eAGjDh8E,KAAKg8E,cACAl3E,QAAQ,SACRA,QAAQ,SACjB,CAEA8rG,cACI,OAAI5wG,KAAKg8E,cAAcvgC,0BACZ,gBAGJz7C,KAAKywG,sBAAsBlkG,KAAK,6BAA6B6Y,KACxE,CAEA0rF,gCACI,MAAME,EAAWhxG,KAAK4wG,cAEtB5wG,KAAK2wG,uBAAuBxjF,OAAoB,mBAAb6jF,GACnChxG,KAAK0wG,oBAAoBvjF,OAAoB,kBAAb6jF,EACpC,ECzIW,MAAMC,WAAsB,IACvCtuG,cACIC,QAEA5C,KAAKkxG,cAAgB,IACzB,CAEAp9D,WACI9zC,KAAKwiB,QAAU9d,EAnDX,wzDAoDJ1E,KAAK44E,MAAQ54E,KAAKwiB,QAAQjW,KAAK,kBAC/BvM,KAAKmxG,kBAAoBnxG,KAAKwiB,QAAQjW,KAAK,+BAC3CvM,KAAKoxG,aAAepxG,KAAKwiB,QAAQjW,KAAK,iBACtCvM,KAAKiwF,UAAYjwF,KAAKwiB,QAAQjW,KAAK,uBAEnCvM,KAAK44E,MAAMrkE,GAAG,UAAU,KACpB,MAAMzU,EAAWE,KAAKmxG,kBAAkB51D,sBAWxC,OATIz7C,GACAE,KAAKwiB,QAAQgmB,MAAM,QAEnBxoC,KAAKqxG,aAAavxG,IAGlB8I,SAAS,eAGN,CAAK,GAEpB,CAEAvJ,2BAA0B,QAAC8S,IAClBA,GAA8B,IAAnBA,EAAQ1P,SACpB0P,EAAU,CAAE,gDAGhBnS,KAAKkxG,cAAgB,GAErB,IAAK,MAAM3xG,KAAU4S,EACZnS,KAAKkxG,cAAc/nG,SAAS5J,IAC7BS,KAAKkxG,cAAc5kG,KAAK/M,GAIhC0B,EAAA,mBAAiBjB,KAAKwiB,SAEtBxiB,KAAKmxG,kBAAkB/rF,IAAI,IAAItgB,QAAQ,SAEvC9E,KAAKiwF,UAAUttE,QAEf,IAAK,MAAMpjB,KAAUS,KAAKkxG,cAAe,CACrC,MAAM5tG,QAAazD,EAAA,gBAAcN,GAEjCS,KAAKiwF,UAAUtrF,OAAOD,EAAE,QAAQ6gB,KAAKjiB,EAAKgH,OAC9C,CAEA,uBAA6CtK,KAAKmxG,mBAClD,kBAAwCnxG,KAAKmxG,kBACjD,CAEA9xG,mBAAmBS,GACf,MAAM,OAACP,EAAM,aAAE8H,GAAgBtH,EAAA,8BAAwCD,GACjE8S,QAAuB/S,EAAA,oBAAkBwH,EAAc9H,GAE7D,IAAK,MAAM+xG,KAAetxG,KAAKkxG,cAAe,OACpC,sBAAgCI,EAAa1+F,EAAgB5S,KAAKoxG,aAAahsF,OAErF,MAAMmsF,QAAmB1xG,EAAA,gBAAcyxG,GACjC/gF,QAAmB1wB,EAAA,kBAAgB+S,GAAgBgG,UAEzD,sBAAyB,OAAO24F,EAAWjnG,gBAAgBimB,EAAWjmB,QAC1E,CACJ,ECjFW,MAAMknG,WAAqB,IACtC7uG,cACIC,QAEA5C,KAAKyxG,eAAiB,IAC1B,CAEA39D,WACI9zC,KAAKwiB,QAAU9d,EA1CX,84CA2CJ1E,KAAK44E,MAAQ54E,KAAKwiB,QAAQjW,KAAK,iBAC/BvM,KAAKmxG,kBAAoBnxG,KAAKwiB,QAAQjW,KAAK,8BAC3CvM,KAAKiwF,UAAYjwF,KAAKwiB,QAAQjW,KAAK,sBAEnCvM,KAAK44E,MAAMrkE,GAAG,UAAU,KACpB,MAAMzU,EAAWE,KAAKmxG,kBAAkB51D,sBAExC,GAAIz7C,EAAU,CACVE,KAAKwiB,QAAQgmB,MAAM,QAEnB,MAAM,OAACjpC,EAAM,aAAE8H,GAAgBtH,EAAA,8BAAwCD,GACvED,EAAA,oBAAkBwH,EAAc9H,GAAQyL,MAAKqH,GAAYrS,KAAK0xG,YAAYr/F,IAC9E,MAEIzJ,SAAS,cAGb,OAAO,CAAK,GAEpB,CAEAvJ,4BAA2B,UAACiT,IACxBtS,KAAKyxG,eAAiBn/F,EAEtBrR,EAAA,mBAAiBjB,KAAKwiB,SAEtBxiB,KAAKmxG,kBAAkB/rF,IAAI,IAAItgB,QAAQ,SAEvC9E,KAAKiwF,UAAUttE,QAEf,IAAK,MAAMtQ,KAAYrS,KAAKyxG,eAAgB,CACxC,MAAMrrF,EAASvmB,EAAA,kBAAgBwS,GACzB/O,QAAazD,EAAA,gBAAcumB,EAAO7mB,QAExCS,KAAKiwF,UAAUtrF,OAAOD,EAAE,QAAQ6gB,KAAKjiB,EAAKgH,OAC9C,CAEA,uBAA6CtK,KAAKmxG,mBAClD,kBAAwCnxG,KAAKmxG,kBACjD,CAEA9xG,kBAAkBopB,SACR,qBAA+BzoB,KAAKyxG,eAAgBhpF,GAE1D,MAAMkpF,EAAe9xG,EAAA,kBAAgB4oB,GAC/BxL,QAAmB00F,EAAa/4F,UAEtC,sBAAyB,eAAeqE,EAAW3S,QACvD,mCCnBW,MAAMsnG,WAAqB,IACtCjvG,cACIC,QAEA5C,KAAKqH,aAAe,IACxB,CAEAysC,WACI9zC,KAAKwiB,QAAU9d,EAlFX,6lHAmFJ1E,KAAK44E,MAAQ54E,KAAKwiB,QAAQjW,KAAK,gBAC/BvM,KAAKu9D,WAAav9D,KAAKwiB,QAAQjW,KAAK,sBACpCvM,KAAK6xG,iBAAmB7xG,KAAKwiB,QAAQjW,KAAK,6BAC1CvM,KAAK8xG,cAAgB9xG,KAAKwiB,QAAQjW,KAAK,kBACvCvM,KAAK+xG,oBAAsB/xG,KAAKwiB,QAAQjW,KAAK,yBAC7CvM,KAAKgyG,sBAAwBhyG,KAAKwiB,QAAQjW,KAAK,2BAC/CvM,KAAKiyG,4BAA8BjyG,KAAKwiB,QAAQjW,KAAK,mCACrDvM,KAAKkyG,4BAA8BlyG,KAAKwiB,QAAQjW,KAAK,mCACrDvM,KAAKmyG,yBAA2BnyG,KAAKwiB,QAAQjW,KAAK,8BAClDvM,KAAKoyG,sCAAwCpyG,KAAKwiB,QAAQjW,KAAK,6CAE/DvM,KAAK44E,MAAMrkE,GAAG,UAAU,KAEpBvU,KAAK8xG,cAAc/+F,KAAK,WAAY,YAEpC/S,KAAKqyG,eAAeryG,KAAKqH,eAElB,KAGXrH,KAAK6xG,iBAAiBt9F,GAAG,UAAU,KAC3BvU,KAAK6xG,iBAAiBzsF,MACtBplB,KAAK8xG,cAAcxjD,WAAW,YAG9BtuD,KAAK8xG,cAAc/+F,KAAK,WAAY,WACxC,IAGJ/S,KAAKwiB,QAAQjW,KAAK,2BAA2Bye,QAAQ,CACjDrF,MAAM,GAEd,CAEAtmB,6BAA4B,OAACE,IACzBS,KAAKqH,aAAe9H,EAEpBS,KAAK6xG,iBAAiBzsF,IAAI,IAAItgB,QAAQ,UAEtC9E,KAAK+xG,oBAAoBp9F,KAAK,WAAW,GACzC3U,KAAKgyG,sBAAsBr9F,KAAK,UAAWnU,EAAA,KAAW,mBACtDR,KAAKiyG,4BAA4Bt9F,KAAK,WAAW,GACjD3U,KAAKkyG,4BAA4Bv9F,KAAK,WAAW,GACjD3U,KAAKmyG,yBAAyBx9F,KAAK,WAAW,GAC9C3U,KAAKoyG,sCAAsCz9F,KAAK,WAAW,GAE3D3U,KAAKu9D,WAAWh4C,WAAWxlB,EAAA,eAAyBC,KAAKqH,eAEzDpG,EAAA,mBAAiBjB,KAAKwiB,QAC1B,CAEAnjB,qBAAqBgI,GACjB,MAAM6qB,EAAQ1B,MAAMC,KAAKzwB,KAAK6xG,iBAAiB,GAAG3/E,OAE5CogF,EAAe19F,GAAOA,EAAIwkB,GAAG,YAAc,OAAS,QAEpD54B,EAAU,CACZ8zD,WAAYg+C,EAAatyG,KAAK+xG,qBAC9Bx9C,aAAc+9C,EAAatyG,KAAKgyG,uBAChCx9C,mBAAoB89C,EAAatyG,KAAKiyG,6BACtCx9C,mBAAoB69C,EAAatyG,KAAKkyG,6BACtCx9C,gBAAiB49C,EAAatyG,KAAKmyG,0BACnCx9C,6BAA8B29C,EAAatyG,KAAKoyG,wCAGpDpyG,KAAKwiB,QAAQgmB,MAAM,cAEb,uBAA0B,QAASnhC,EAAc6qB,EAAO1xB,EAClE,ECvCW,MAAM+xG,WAAqB,IACtC5vG,cACIC,QAEA5C,KAAKymB,OAAS,GACdzmB,KAAKqS,SAAW,IACpB,CAEAyhC,WACI9zC,KAAKwiB,QAAU9d,EAvHX,stJAwHJ1E,KAAK44E,MAAQ54E,KAAKwiB,QAAQjW,KAAK,gBAC/BvM,KAAKu9D,WAAav9D,KAAKwiB,QAAQjW,KAAK,sBACpCvM,KAAKwyG,gBAAkBxyG,KAAKwiB,QAAQjW,KAAK,2BACzCvM,KAAKyyG,eAAiBzyG,KAAKwiB,QAAQjW,KAAK,0BACxCvM,KAAK0yG,aAAe1yG,KAAKwiB,QAAQjW,KAAK,wBACtCvM,KAAK2yG,YAAc3yG,KAAKwiB,QAAQjW,KAAK,uBACrCvM,KAAK4yG,cAAgB5yG,KAAKwiB,QAAQjW,KAAK,kBACvCvM,KAAK6yG,cAAgB7yG,KAAKwiB,QAAQjW,KAAK,kBAEvCvM,KAAK44E,MAAMrkE,GAAG,UAAU,KACpBvU,KAAKwiB,QAAQgmB,MAAM,QAEnB,MAAMsqE,EAAa9yG,KAAKwiB,QAAQjW,KAAK,qCAAqC6Y,MAE1E,IAAK0tF,EAGD,YADA,oBAAuB,YAI3B,MAAMC,EAA8B,YAAfD,EACf9yG,KAAKwiB,QAAQjW,KAAK,6CAA6C6Y,MAC/DplB,KAAKwiB,QAAQjW,KAAK,4CAA4C6Y,MAE9D4tF,EAAiC,SAAjBD,EAChB/yG,KAAKwiB,QAAQjW,KAAK,sCAAsC6Y,MACxD,MAIN,OAFAplB,KAAKizG,aAAajzG,KAAKqS,SAAUygG,EAAYC,EAAcC,IAEpD,CAAK,IAGhBhzG,KAAKwiB,QAAQjW,KAAK,2BAA2BgI,GAAG,UAAU7L,IACxB,YAA1BA,EAAEuoD,cAAc79C,OAC8D,IAA1EpT,KAAKwiB,QAAQjW,KAAK,6CAA6C9J,QAC/DzC,KAAKwiB,QAAQjW,KAAK,2CAA2CoI,KAAK,WAAW,GAGjF3U,KAAKwyG,gBAAgBpuC,YACrBpkE,KAAKyyG,eAAeS,YAGyD,IAAzElzG,KAAKwiB,QAAQjW,KAAK,4CAA4C9J,QAC9DzC,KAAKwiB,QAAQjW,KAAK,0CAA0CoI,KAAK,WAAW,GAGhF3U,KAAKwyG,gBAAgBU,UACrBlzG,KAAKyyG,eAAeruC,YACxB,IAGJpkE,KAAKwiB,QAAQjW,KAAK,qCAAqCgI,GAAG,UAAU7L,IAClC,SAA1BA,EAAEuoD,cAAc79C,MAChBpT,KAAK6yG,cAAczuC,YAGnBpkE,KAAK6yG,cAAcK,SACvB,GAER,CAEA7zG,6BAA4B,SAACS,EAAQ,YAAEw8D,IAKnC,GAHAt8D,KAAKymB,OAAS,GACdzmB,KAAK4yG,cAActkD,WAAW,YAEV,YAAhBgO,EACAt8D,KAAK0yG,aAAa/9F,KAAK,WAAW,GAAM7P,QAAQ,UAGhD9E,KAAKwiB,QAAQjW,KAAK,6CAA6CzH,QAAQ,cAEtE,IAAoB,WAAhBw3D,EAIL,MAAM,IAAI9uD,MAAM,sBAAsB8uD,MAHtCt8D,KAAK2yG,YAAYh+F,KAAK,WAAW,GAAM7P,QAAQ,SAInD,CAEA9E,KAAKwiB,QAAQjW,KAAK,YAAYoI,KAAK,WAAW,GAE9C1T,EAAA,mBAAiBjB,KAAKwiB,SAEtB,MAAM,OAACjjB,EAAM,aAAE8H,GAAgBtH,EAAA,8BAAwCD,GAEvEE,KAAKqS,eAAiBxS,EAAA,oBAAkBwH,EAAc9H,GACtDS,KAAKu9D,WAAWh4C,WAAWxlB,EAAA,eAAyBR,GACxD,CAEA0zG,aAAa5gG,EAAU5O,EAAM8qB,EAAQy6D,GACjChpF,KAAKymB,OAASxlB,EAAA,qBAAmB,IAEjC,MAAM4E,EAAM,uBAA8B,gBAAgBwM,YAAmB5O,KAAQ8qB,KAAUy6D,KAAWhpF,KAAKymB,UAE/G,cAAqB5gB,EACzB,EAGJlC,EAAA,uBAAuBtE,UACnB,MAAMgnB,EAAY,CAACC,EAAI5Z,KAAY,CAC/B4Z,GAAIA,EACJhc,MAAO,OACPoC,QAASA,EACT6Z,KAAM,0BAGV,GAAyB,WAArB7Z,EAAQ8Z,SAIZ,GAAqB,cAAjB9Z,EAAQjJ,KACR,0BAA6BiJ,EAAQ+Z,QACrC,oBAAuB/Z,EAAQA,cAE9B,GAAqB,sBAAjBA,EAAQjJ,KACb,yBAA4B4iB,EAAU3Z,EAAQ+Z,OAAQ,uBAAuB/Z,EAAQga,uBAEpF,GAAqB,kBAAjBha,EAAQjJ,KAA0B,CACvC,MAAM+C,EAAQ6f,EAAU3Z,EAAQ+Z,OAAQ,iCACxCjgB,EAAMmgB,WAAa,IAEnB,yBAA4BngB,EAChC,KC9NW,MAAM2sG,WAA6B,IAC9CxwG,cACIC,QAEA5C,KAAKmwG,aAAe,CACxB,CAEAr8D,WACI9zC,KAAKwiB,QAAU9d,EA9BX,04BA+BJ1E,KAAKozG,gBAAkBpzG,KAAKwiB,QAAQjW,KAAK,6BACzCvM,KAAK8xG,cAAgB9xG,KAAKwiB,QAAQjW,KAAK,2BAEvCvM,KAAK8xG,cAAcv9F,GAAG,SAAS,IAAMvU,KAAKqzG,aAE1CrzG,KAAKwiB,QAAQjO,GAAG,kBAAkB,IAAMvU,KAAKozG,gBAAgBtuG,QAAQ,WAErE,mBAA+B9E,KAAKwiB,QAAS,eAAe,IAAMxiB,KAAKqzG,YAC3E,CAEAh0G,4BAA4Bi0G,GACxB,MAAM,YAACC,SAAqBhwG,EAAA,OAAY,wBAAyB,CAAE+vG,oBAE7D76E,QAAmB,wCAAyCyI,gBAE5DsyE,EAAe/6E,EAAWvmB,KAAKuhG,UAAUC,OAAOH,GAChDI,EAAgBl7E,EAAWvmB,KAAK0hG,QAAQJ,GAE9C/6E,EAAW8rC,MAAM2a,cAAcy0B,EAAel7E,EAAW8rC,MAAM9yD,SAASwzD,WAExE,sBAAyB,qBAC7B,CAEA5lE,yCACUW,KAAK6zG,2BACf,CAEAx0G,kCACI,GAAyD,SAArD,gDAIJ,GAAI4B,EAAA,qBAAoB,CACpB,MAAM,UAACupB,GAAavpB,EAAA,uBAAqB,YACnCskB,EAAOiF,EAAUspF,WAEvB9zG,KAAK+zG,sBAAsBxuF,EAC/B,MAEItkB,EAAA,mBAAiBjB,KAAKwiB,QAE9B,CAEAnjB,iBACI,MAAMkmB,EAAOvlB,KAAKozG,gBAAgBhuF,MAElCplB,KAAKwiB,QAAQgmB,MAAM,cAEbxoC,KAAK+zG,sBAAsBxuF,GAEjCvlB,KAAKozG,gBAAgBhuF,IAAI,GAC7B,ECvDW,MAAM4uF,WAAuC,IACxDlgE,WACI9zC,KAAKwiB,QAAU9d,EAhCX,syCAiCJ1E,KAAKkrF,cAAgBlrF,KAAKwiB,QAAQjW,KAAK,oCACvCvM,KAAKmrF,eAAiBnrF,KAAKwiB,QAAQjW,KAAK,+BACxCvM,KAAKkrF,cAAc32E,GAAG,UAAU,KAC5B,MAAM4pB,EAAWn+B,KAAKmrF,eAAe/lE,MAKrC,OAJAplB,KAAKmrF,eAAe/lE,IAAI,IAExB,0BAA8C+Y,IAEvC,CAAK,GAEpB,CAEA81E,0CACIhzG,EAAA,mBAAiBjB,KAAKwiB,SAEtBxiB,KAAKmrF,eAAermF,QAAQ,QAChC,CAEAovG,2CACIl0G,KAAKwiB,QAAQgmB,MAAM,OACvB,ECiBW,MAAM2rE,WAAwB,IACzCxxG,cACIC,QAEA5C,KAAKo0G,cAAgB,GACrBp0G,KAAKsD,KAAO,KACZtD,KAAKg8B,WAAa,IACtB,CAEA8X,WACI9zC,KAAKwiB,QAAU9d,EA1EX,s2EA2EJ1E,KAAKk0D,MAAQl0D,KAAKwiB,QAAQjW,KAAK,kBAC/BvM,KAAKq0G,cAAgBr0G,KAAKwiB,QAAQjW,KAAK,2BACvCvM,KAAK6sB,SAAW7sB,KAAKwiB,QAAQjW,KAAK,qBAClCvM,KAAKs1C,OAASt1C,KAAKwiB,QAAQjW,KAAK,mBAChCvM,KAAKs0G,cAAgBt0G,KAAKwiB,QAAQjW,KAAK,2BACvCvM,KAAKu0G,yBAA2Bv0G,KAAKwiB,QAAQjW,KAAK,yCAElDvM,KAAKq0G,cAAcl2D,WAEnBn+C,KAAKq0G,cAAch+F,SAAS9B,GAAG,oBAAoB7L,IAE3CA,EAAEsnG,YACFtnG,EAAE+tB,gBACN,IAGJz2B,KAAKwiB,QAAQjO,GAAG,kBAAkB,KAC9BvU,KAAKk0D,MAAM3nD,KAAK,sBAAsBvM,KAAKg8B,gBACtCl3B,QAAQ,QAAQ,IAGzB9E,KAAKu0G,yBAAyBhgG,GAAG,SAASlV,gBAG5BuhC,EAAA,UAFG,yDAGHr9B,EAAA,SAAc,SAASvD,KAAKsD,KAAK/D,oBAEvCS,KAAKwiB,QAAQgmB,MAAM,QAEnB,sBAAyB,aAC7B,IAGJxoC,KAAKk0D,MAAM3/C,GAAG,QAAS,kBAAkB7L,IACrCA,EAAE+tB,kBACK,KAGXz2B,KAAKk0D,MAAM3/C,GAAG,QAAS,kBAAkB7L,IACrC1I,KAAKk0D,MAAM3nD,KAAK,kBAAkBonB,MAAK,CAACnkB,EAAG4F,KACvC1Q,EAAE0Q,GAAI6+B,YAAY,SAAU7+B,IAAO1M,EAAEiK,OAAO,IAGhD3S,KAAKw0G,gBAAgB,GAE7B,CAEAn1G,0BAAyB,OAACE,EAAS,gDAC/B0B,EAAA,mBAAiBjB,KAAKwiB,eAEhBxiB,KAAKy0G,cAAcl1G,EAC7B,CAEAF,oBAAoBE,GAChBS,KAAKk0D,MAAMvxC,QACX3iB,KAAK6sB,SAASlK,QACd3iB,KAAKs0G,cAAc3xF,QAEnB3iB,KAAKsD,KAAO,4CACZtD,KAAKo0G,oBAAsB7wG,EAAA,MAAW,SAAShE,eAE/C,IAAK,MAAMwkB,KAAQ/jB,KAAKo0G,cACpBp0G,KAAKk0D,MAAMvvD,OACPD,EAAE,0CACG6gB,KAAK,GAAGxB,EAAK2wF,eAAe1+E,OAAO,EAAG,QAAQ/0B,EAAA,mBAAiB8iB,EAAKva,mBACpEuJ,KAAK,mBAAoBgR,EAAKiY,YAC9BjpB,KAAK,QAAS,eAAegR,EAAK2wF,mBAI/C10G,KAAKq0G,cAAcl2D,SAAS,QAExBn+C,KAAKo0G,cAAc3xG,OAAS,EACvBzC,KAAKg8B,aACNh8B,KAAKg8B,WAAah8B,KAAKo0G,cAAc,GAAGp4E,aAG5Ch8B,KAAKs1C,OAAO/vB,KAAK,iBACjBvlB,KAAKg8B,WAAa,MAGtBh8B,KAAKu0G,yBAAyBpnF,OAAOntB,KAAKo0G,cAAc3xG,OAAS,EACrE,CAEApD,uBACI,MAAM28B,EAAah8B,KAAKk0D,MAAM3nD,KAAK,WAAWwG,KAAK,oBAE7C4hG,EAAe30G,KAAKo0G,cAAc7nG,MAAKsrC,GAAKA,EAAE7b,aAAeA,IAEnEh8B,KAAKs1C,OAAO3vB,KAAKgvF,EAAarqG,OAE9BtK,KAAK40G,qBAAqBD,SAEpB30G,KAAK60G,cAAcF,EAC7B,CAEAC,qBAAqBD,GACjB30G,KAAKs0G,cAAc3xF,QAEnB,MAAMmyF,EAAyBpwG,EAAE,6DAEjCowG,EAAuBvgG,GAAG,SAASlV,gBAGrBuhC,EAAA,UAFG,0CAGHr9B,EAAA,OAAY,aAAaoxG,EAAa34E,sBAE5Ch8B,KAAKwiB,QAAQgmB,MAAM,QAEnB,sBAAyB,aAC7B,IAGJ,MAAMusE,EAAuBrwG,EAAE,6DAE/BqwG,EAAqBxgG,GAAG,SAASlV,gBAGnBuhC,EAAA,UAFG,kDAGHr9B,EAAA,SAAc,aAAaoxG,EAAa34E,cAE9Ch8B,KAAKy0G,cAAcE,EAAap1G,QAEhC,sBAAyB,aAC7B,IAGCo1G,EAAajxG,cAAe,mCAC7B1D,KAAKs0G,cACA3vG,OAAOmwG,GACPnwG,OAAO,YAGhB3E,KAAKs0G,cACA3vG,OAAOowG,GACPpwG,OAAO,YAEZ,MAAMsoB,EAAkBvoB,EAAE,oEAE1BuoB,EAAgB1Y,GAAG,SAAS,IAAM,sBAA6BogG,EAAap1G,OAAQo1G,EAAa34E,cAE5F24E,EAAajxG,cAAe,mCAC7B1D,KAAKs0G,cAAc3vG,OAAOsoB,EAElC,CAEA5tB,oBAAoBs1G,GAChB30G,KAAK6sB,SAASlK,QAEd,MAAMqyF,QAAqBzxG,EAAA,MAAW,aAAaoxG,EAAa34E,cAEhE,GAA0B,SAAtB24E,EAAalxG,KACbzD,KAAK6sB,SAASlH,KAAKqvF,EAAaxxG,SAE5BxD,KAAK6sB,SAAStgB,KAAK,iBAAiB9J,OAAS,UACvC,oBAA6B,YAEnCgpB,oBAAoBzrB,KAAK6sB,SAAS,GAAI,CAACnB,OAAO,UAE/C,GAA0B,SAAtBipF,EAAalxG,KACpBzD,KAAK6sB,SAASlH,KAAKjhB,EAAE,SAAS6gB,KAAKyvF,EAAaxxG,eAC7C,GAA0B,UAAtBmxG,EAAalxG,KACpBzD,KAAK6sB,SAASlH,KAAKjhB,EAAE,SAGhBqO,KAAK,MAAO,QAAQiiG,EAAa70G,eAAe60G,EAAaxxG,WAC7DmgB,IAAI,YAAa,QACjBA,IAAI,aAAc,cACpB,GAA0B,SAAtBgxF,EAAalxG,KAAiB,CACrC,MAAMyvE,EAASxuE,EAAE,4BACZC,OAAOD,EAAE,QAAQC,OACdD,EAAE,QAAQ6gB,KAAK,UACf7gB,EAAE,QAAQ6gB,KAAKovF,EAAax0G,QAE/BwE,OAAOD,EAAE,QAAQC,OACdD,EAAE,QAAQ6gB,KAAK,SACf7gB,EAAE,QAAQ6gB,KAAKtkB,EAAA,mBAAiB0zG,EAAanrG,kBAGjDwrG,EAAaxxG,SACb0vE,EAAOvuE,OAAOD,EAAE,QAAQC,OACpBD,EAAE,oBAAoBC,OAClBD,EAAE,oCAAoC6gB,KAAK,OAC3C7gB,EAAE,4CACG6gB,KAAKyvF,EAAaxxG,YAKnCxD,KAAK6sB,SAASlH,KAAKutD,EACvB,MAAO,GAA0B,WAAtByhC,EAAalxG,KAAmB,CACvC,MAAMuoB,EAAeC,mBAAmB0oF,EAAarqG,OAErDtK,KAAK6sB,SAASlH,KAAKjhB,EAAE,SAChBqO,KAAK,MAAO,iBAAiB4hG,EAAa34E,oBAAoBhQ,KAAgBnU,KAAKqU,YACnFvI,IAAI,YAAa,QAC1B,MAAO,GAA0B,YAAtBgxF,EAAalxG,KAAoB,CACxC,MAAMuoB,EAAeC,mBAAmB0oF,EAAarqG,OAErDtK,KAAK6sB,SAASlH,KAAKjhB,EAAE,SAChBqO,KAAK,MAAO,iBAAiB4hG,EAAa34E,oBAAoBhQ,KAAgBnU,KAAKqU,YACnFvI,IAAI,YAAa,SAEtB3jB,KAAK6sB,SAASloB,OAAOD,EAAE,SAAS6gB,KAAKyvF,EAAaxxG,SACtD,MACIxD,KAAK6sB,SAAStH,KAAK,eAE3B,ECrOW,MAAM0vF,WAA0B,IAC3CtyG,cACIC,QAEA5C,KAAKsS,UAAY,KACjBtS,KAAKkK,QAAU,IACnB,CAEA4pC,WACI9zC,KAAKwiB,QAAU9d,EAlEX,42EAmEJ1E,KAAK6sB,SAAW7sB,KAAKwiB,QAAQjW,KAAK,2BAClCvM,KAAKk1G,UAAYl1G,KAAKwiB,QAAQjW,KAAK,kCACnCvM,KAAKm1G,cAAgBn1G,KAAKwiB,QAAQjW,KAAK,sCACvCvM,KAAKo1G,iBAAmBp1G,KAAKwiB,QAAQjW,KAAK,sBAC1CvM,KAAKq1G,qBAAuBr1G,KAAKwiB,QAAQjW,KAAK,0BAC9CvM,KAAKs1G,mBAAqBt1G,KAAKwiB,QAAQjW,KAAK,wBAC5CvM,KAAKu1G,uBAAyBv1G,KAAKwiB,QAAQjW,KAAK,8BAChDvM,KAAKw1G,wBAA0Bx1G,KAAKwiB,QAAQjW,KAAK,8BACjDvM,KAAKy1G,4BAA8Bz1G,KAAKwiB,QAAQjW,KAAK,6BACrDvM,KAAK01G,sBAAwB11G,KAAKwiB,QAAQjW,KAAK,0BAC/CvM,KAAK21G,iBAAmB31G,KAAKwiB,QAAQjW,KAAK,sBAC1CvM,KAAK41G,YAAc51G,KAAKwiB,QAAQjW,KAAK,gBAErCvM,KAAKwiB,QAAQjO,GAAG,kBAAkB,IAAMvU,KAAKk1G,UAAUpwG,QAAQ,WAE/D9E,KAAKm1G,cAAc5gG,GAAG,SAAS,KAC3BtT,EAAA,4BAEAjB,KAAKkK,QAAQ,CAAC0d,SAAS,GAAO,IAGlC5nB,KAAKk1G,UAAU3gG,GAAG,SAAS,KACvBtT,EAAA,4BAEAjB,KAAKkK,QAAQ,CACT0d,SAAS,EACTC,gBAAiB7nB,KAAK2nB,sBAAwB3nB,KAAK61G,2BACnD/tF,WAAY9nB,KAAK81G,uBACnB,IAGN91G,KAAK21G,iBAAiBphG,GAAG,SAAS,IAAMvU,KAAK+1G,uBACjD,CAEA12G,4BACI,MAAMklC,QAAiBhhC,EAAA,OAAY,uBAAwB,CACvDmkB,kBAAmB1nB,KAAKsS,UACxBuV,gBAAiB7nB,KAAK2nB,sBAAwB3nB,KAAK61G,6BAGvD71G,KAAKo1G,iBAAiBzyF,QACtB3iB,KAAKq1G,qBAAqB1yF,QAE1B3iB,KAAKw1G,wBAAwBroF,OAAOoX,EAASyxE,mBAAmBvzG,OAAS,GACzEzC,KAAKu1G,uBAAuBpoF,OAA8C,IAAvCoX,EAASyxE,mBAAmBvzG,QAE/D,IAAK,MAAMa,WAAczD,EAAA,iBAAe0kC,EAASyxE,oBAC7Ch2G,KAAKo1G,iBAAiBzwG,OAClBD,EAAE,QAAQC,aACA,eAAuBrB,EAAK/D,OAAQ,CAACk4B,cAAc,MAKrEz3B,KAAKs1G,mBAAmB/vF,KAAKgf,EAASyxE,mBAAmBvzG,QAEzDzC,KAAKy1G,4BAA4BtoF,OAAOoX,EAAS0xE,gBAAgBxzG,OAAS,GAC1EzC,KAAK01G,sBAAsBnwF,KAAKgf,EAAS0xE,gBAAgBxzG,cAEnD5C,EAAA,iBAAe0kC,EAAS0xE,gBAAgBtqG,KAAIuqG,GAAMA,EAAG32G,UAE3D,IAAK,MAAMwT,KAAQwxB,EAAS0xE,gBACxBj2G,KAAKq1G,qBAAqB1wG,OACtBD,EAAE,QACGC,OAAO,OACPA,aAAa,eAAuBoO,EAAKK,QACzCzO,OAAO,yBAAyBoO,EAAKO,uBACrC3O,aAAa,eAAuBoO,EAAKxT,SAG1D,CAEAF,kCAAiC,kBAACqoB,EAAiB,SAAE3d,EAAQ,qBAAE4d,IAC3D3nB,KAAKsS,UAAYoV,EACjB1nB,KAAK2nB,qBAAuBA,QAEtB3nB,KAAK+1G,sBAEX90G,EAAA,mBAAiBjB,KAAKwiB,SAEtBxiB,KAAK21G,iBACAhhG,KAAK,YAAagT,GAClBhT,KAAK,aAAcgT,GAExB3nB,KAAK41G,YAAYjhG,KAAK,WAAW,GAEjC3U,KAAKkK,QAAUH,CACnB,CAEA8rG,2BACI,OAAO71G,KAAK21G,iBAAiBv8E,GAAG,WACpC,CAEA08E,sBACI,OAAO91G,KAAK41G,YAAYx8E,GAAG,WAC/B,EChJW,MAAM+8E,WAAmB,IACpCxzG,cACIC,QAEA5C,KAAKkK,QAAU,KACflK,KAAKo2G,mBAAqB,IAC9B,CAEAtiE,WACI9zC,KAAKwiB,QAAU9d,EA9BX,ixBA+BJ1E,KAAKq2G,aAAer2G,KAAKwiB,QAAQjW,KAAK,wBACtCvM,KAAKk1G,UAAYl1G,KAAKwiB,QAAQjW,KAAK,0BAEnCvM,KAAKwiB,QAAQjO,GAAG,kBAAkB,IAAMvU,KAAKk1G,UAAUpwG,QAAQ,WAE/D9E,KAAKwiB,QAAQjO,GAAG,mBAAmB,KAC3BvU,KAAKkK,SACLlK,KAAKkK,UAGLlK,KAAKo2G,qBACLp2G,KAAKo2G,mBAAmBtxG,QAAQ,SAChC9E,KAAKo2G,mBAAqB,KAC9B,IAGJp2G,KAAKk1G,UAAU3gG,GAAG,SAAS,IAAMvU,KAAKwiB,QAAQgmB,MAAM,SACxD,CAEA8tE,qBAAoB,QAAC5pG,EAAO,SAAE3C,IAC1B/J,KAAKo2G,mBAAqB1xG,EAAE,UAE5B1E,KAAKq2G,aAAa9wF,KAAK7Y,GAEvBzL,EAAA,mBAAiBjB,KAAKwiB,SAEtBxiB,KAAKkK,QAAUH,CACnB,EC3DJ,MAAMwsG,GAA2B,6BA6BlB,MAAMC,WAAsB,IACvC7zG,cACIC,QAEA5C,KAAKkK,QAAU,KACflK,KAAKo2G,mBAAqB,IAC9B,CAEAtiE,WACI9zC,KAAKwiB,QAAU9d,EApCX,89BAqCJ1E,KAAKy2G,gBAAkBz2G,KAAKwiB,QAAQjW,KAAK,2BACzCvM,KAAKk1G,UAAYl1G,KAAKwiB,QAAQjW,KAAK,6BACnCvM,KAAKm1G,cAAgBn1G,KAAKwiB,QAAQjW,KAAK,iCACvCvM,KAAK02G,QAAU12G,KAAKwiB,QAAQjW,KAAK,0BAEjCvM,KAAKwiB,QAAQjO,GAAG,kBAAkB,IAAMvU,KAAKk1G,UAAUpwG,QAAQ,WAE/D9E,KAAKwiB,QAAQjO,GAAG,mBAAmB,KAC3BvU,KAAKkK,SACLlK,KAAKkK,SAAQ,GAGblK,KAAKo2G,qBACLp2G,KAAKo2G,mBAAmBtxG,QAAQ,SAChC9E,KAAKo2G,mBAAqB,KAC9B,IAGJp2G,KAAKm1G,cAAc5gG,GAAG,SAAS,IAAMvU,KAAK+vG,WAAU,KACpD/vG,KAAKk1G,UAAU3gG,GAAG,SAAS,IAAMvU,KAAK+vG,WAAU,IACpD,CAEA4G,wBAAuB,QAACjqG,EAAO,SAAE3C,IAC7B/J,KAAKo2G,mBAAqB1xG,EAAE,UAE5B1E,KAAK02G,QAAQh0F,OAEb9d,KAAK2jC,aAAevoC,KAAKwiB,QAEF,iBAAZ9V,IACPA,EAAUhI,EAAE,SAAS6gB,KAAK7Y,IAG9B1M,KAAKy2G,gBAAgB9zF,QAAQhe,OAAO+H,GAEpC1M,KAAKwiB,QAAQgmB,QAEbxoC,KAAKkK,QAAUH,CACnB,CAEA6sG,6CAA4C,MAACtsG,EAAK,SAAEP,IAChDnF,KAAK2jC,aAAevoC,KAAKwiB,QAEzBxiB,KAAKy2G,gBAAgBlxF,KAAK,6CAA6Cjb,yBAEvEtK,KAAK02G,QAAQ/zF,QACRhe,OAAO,SACPA,OAAOD,EAAE,SACLmf,SAAS,cACTlf,OACGD,EAAE,WACGmf,SAAS,oBACT9Q,KAAK,QAAS,4DACdA,KAAK,QAAS,0BACdpO,OACGD,EAAE,WACGqO,KAAK,OAAQ,YACb8Q,SAAS,oBAAoB0yF,OAErC5xG,OAAO,0BAGxB3E,KAAK02G,QAAQvvE,OAEbnnC,KAAKwiB,QAAQgmB,QAEbxoC,KAAKkK,QAAUH,CACnB,CAEAgmG,UAAUp5F,GACN3W,KAAKkK,QAAQ,CACTglB,UAAWvY,EACX4rE,oBAAqBviF,KAAKwiB,QAAQjW,KAAK,IAAIgqG,cAAoC9zG,OAAS,IAG5FzC,KAAKkK,QAAU,KAEflK,KAAKwiB,QAAQgmB,MAAM,OACvB,EC9FW,MAAMquE,WAAqB,IACtCl0G,cACIC,QAEA5C,KAAKkK,QAAU,KACflK,KAAK82G,QAAU,IACnB,CAEAhjE,WACI9zC,KAAKwiB,QAAU9d,EA/BX,62BAgCJ1E,KAAK+2G,YAAc/2G,KAAKwiB,QAAQjW,KAAK,eACrCvM,KAAK44E,MAAQ54E,KAAKwiB,QAAQjW,KAAK,uBAC/BvM,KAAKg3G,UAAY,KACjBh3G,KAAKolF,QAAU,KAEfplF,KAAKwiB,QAAQjO,GAAG,kBAAkB,KAC1BvU,KAAK82G,SACL92G,KAAK82G,QAAQ,CACThrE,QAAS9rC,KAAKwiB,QACdw0F,UAAWh3G,KAAKg3G,UAChB5xB,QAASplF,KAAKolF,QACdxM,MAAO54E,KAAK44E,QAIpB54E,KAAKolF,QAAQtgF,QAAQ,SAASixD,QAAQ,IAG1C/1D,KAAKwiB,QAAQjO,GAAG,mBAAmB,KAC3BvU,KAAKkK,SACLlK,KAAKkK,QAAQ,KACjB,IAGJlK,KAAK44E,MAAMrkE,GAAG,UAAU7L,IACpBA,EAAE+tB,iBACFz2B,KAAKkK,QAAQlK,KAAKolF,QAAQhgE,OAE1BplB,KAAKwiB,QAAQgmB,MAAM,OAAO,GAElC,CAEAyuE,uBAAsB,MAAE3sG,EAAK,QAAEoC,EAAO,aAAE0qE,EAAY,MAAE+N,EAAK,SAAEp7E,IACzD/J,KAAK82G,QAAU3xB,EACfnlF,KAAKkK,QAAUH,EAEf/J,KAAKwiB,QAAQjW,KAAK,iBAAiBgZ,KAAKjb,GAAS,UAEjDtK,KAAKg3G,UAAYtyG,EAAE,WACdiQ,KAAK,MAAO,wBACZ4Q,KAAK7Y,GAEV1M,KAAKolF,QAAU1gF,EAAE,WACZiQ,KAAK,OAAQ,QACbA,KAAK,KAAM,wBACXkP,SAAS,gBACTuB,IAAIgyD,GAAgB,IAEzBp3E,KAAK+2G,YAAYp0F,QAAQhe,OACrBD,EAAE,SACGmf,SAAS,cACTlf,OAAO3E,KAAKg3G,WACZryG,OAAO3E,KAAKolF,UAErBnkF,EAAA,mBAAiBjB,KAAKwiB,SAAS,EACnC,ECtCW,MAAM00F,WAAwB,IACzCpjE,WACI9zC,KAAKwiB,QAAU9d,EApDX,i+CAqDJ1E,KAAKm3G,UAAYn3G,KAAKwiB,QAAQjW,KAAK,8BAEnC,IAAK,MAAMgd,KAAUvpB,KAAKoL,SACtBpL,KAAKm3G,UAAUxyG,OAAO4kB,EAAOjV,SAErC,CAEAjV,sBAAsBiE,GAClBtD,KAAKmtB,QAAO,EAChB,CAEAA,OAAOga,GACHnnC,KAAKwiB,QAAQyxB,YAAY,sBAAuB9M,EACpD,CAEAiwE,6BACIp3G,KAAKmtB,QAAO,EAChB,EC1CW,MAAMkqF,WAA2B,IAC5CtjE,YACI,OAAOnxC,MAAMmxC,aAAmC,gBAApB/zC,KAAKsD,MAAMG,IAC3C,CAEAqwC,WACIlxC,MAAMkxC,WAEN9zC,KAAKwiB,QAAU9d,EApCX,+0BAqCJ1E,KAAKs3G,iBAAmBt3G,KAAKwiB,QAAQjW,KAAK,mCAC1CvM,KAAKu3G,cAAgBv3G,KAAKwiB,QAAQjW,KAAK,yBACvCvM,KAAKw3G,eAAiBx3G,KAAKwiB,QAAQjW,KAAK,0BACxCvM,KAAKy3G,oBAAsBz3G,KAAKwiB,QAAQjW,KAAK,gCAE7CvM,KAAKs3G,iBAAiB/iG,GAAG,SAAS,IAAMvU,KAAKsH,aAAa,6BAA8B,CAAC7H,MAAOO,KAAKP,UACrGO,KAAKy3G,oBAAoBljG,GAAG,SAAS,IAAMvU,KAAKsH,aAAa,0BAA2B,CAAC7H,MAAOO,KAAKP,UAErGO,KAAKu3G,cAAchjG,GAAG,SAAS,IAAMvU,KAAKsH,aAAa,yBAA0B,CAAC7H,MAAOO,KAAKP,UAC9FO,KAAKw3G,eAAejjG,GAAG,SAAS,IAAMvU,KAAKsH,aAAa,0BAA2B,CAAC7H,MAAOO,KAAKP,UAChGO,KAAKwzC,cACT,ECxCW,MAAMkkE,WAA4B,IAC7C3jE,YACI,OAAOnxC,MAAMmxC,aACc,YAApB/zC,KAAKsD,MAAMG,MACXzD,KAAKsD,KAAKwZ,sBAC+B,YAAzC9c,KAAKd,aAAaC,UAAU4B,QACvC,CAEA+yC,WACIlxC,MAAMkxC,WAEN9zC,KAAKwiB,QAAU9d,EAnBX,yJAoBJ1E,KAAKwiB,QAAQjO,GAAG,SAAS,IAAMvU,KAAKsH,aAAa,gBAAiB,CAAC7H,MAAOO,KAAKP,UAC/EO,KAAKwzC,cACT,kCCNW,MAAMmkE,WAAkC,IACnDh1G,YAAY2H,EAAOstG,EAAWC,GAC1Bj1G,QAEA5C,KAAK43G,UAAYA,EACjB53G,KAAKsK,MAAQA,EACbtK,KAAK63G,YAAcA,CACvB,CAEA/jE,WACI9zC,KAAKwiB,QAAU9d,EA1BX,0aA2BJ1E,KAAK4sC,cAAgB5sC,KAAKwiB,QAAQjW,KAAK,kBAEvC,MAAM2hB,EAAUluB,KAAKwiB,QAAQjW,KAAK,0BAC7BsX,SAAS7jB,KAAK43G,WACd7kG,KAAK,QAAS/S,KAAKsK,OACnB0gB,QAAQ,CAAElmB,QAAS,UACnByP,GAAG,SAAS,IAAM2Z,EAAQlD,QAAQ,UAEvChrB,KAAKwiB,QAAQjO,GAAG,oBAAoBlV,gBAC1BW,KAAK83G,gBAEX,MAAM/zC,EAAO/jE,KAAK4sC,cAAc,GAAGoc,wBAC7B+uD,EAAiBrzG,EAAEjD,QAAQi/C,SAAWqjB,EAAK7R,OAE7C6lD,EAAiB,GACjB/3G,KAAK4sC,cAAcjpB,IAAI,MAAOo0F,EAClC,IAGJ/3G,KAAKg4G,iBAAmBtzG,EAAE1E,KAAK63G,aAC/B73G,KAAKwiB,QAAQjW,KAAK,kBAAkB5H,OAAO3E,KAAKg4G,iBACpD,CAGA34G,qBAAsB,CAEtB44G,eACIj4G,KAAKwiB,QAAQ27B,SAAS,QACtBn+C,KAAK4sC,cAAcwf,YAAY,OACnC,EC5BW,MAAM8rD,WAAuBP,GACxCh1G,YAAY2H,EAAOic,GACf3jB,MAAM0H,EAAOic,EAxBA,spBAyBjB,CAEAutB,WACIlxC,MAAMkxC,WAEN9zC,KAAKm4G,OAASn4G,KAAKg4G,iBAAiBzrG,KAAK,gCACzCvM,KAAKo4G,MAAQp4G,KAAKg4G,iBAAiBzrG,KAAK,iCACxCvM,KAAKq4G,UAAYr4G,KAAKg4G,iBAAiBzrG,KAAK,qCAC5CvM,KAAKs4G,OAASt4G,KAAKg4G,iBAAiBzrG,KAAK,iCAEzCvM,KAAKo4G,MAAM7jG,GAAG,SAAS,KACnBvU,KAAKouB,KAAKmqF,SAASv4G,KAAKouB,KAAK4Z,WAAa,GAC1ChoC,KAAKw4G,aAAa,IAGtBx4G,KAAKq4G,UAAU9jG,GAAG,SAAS7L,IACvB1I,KAAKouB,KAAKmqF,SAASv4G,KAAKouB,KAAK4Z,WAAa,GAC1ChoC,KAAKw4G,aAAa,IAGtBx4G,KAAKg4G,iBAAiBzrG,KAAK,oBAAoBgI,GAAG,SAAS7L,GAAKA,EAAE0b,oBAElEpkB,KAAKg4G,iBAAiBzjG,GAAG,QAAS,kBAAkBlV,UAChD,MAAM+uB,EAAO1pB,EAAE+5D,EAAG9rD,QAAQ+B,QAAQ,kBAAkB3B,KAAK,sBAEnDzP,QAAa,gBAA2B8qB,GAE1C9qB,GACA,wCAAyC8F,QAAQ9F,EAAK/D,QACtDS,KAAKi4G,gBAGL,oBAAuB,uBAC3B,GAER,CAEA54G,4BACU,oBAA6B,sBAEnC,MAAMyO,EAAa,4CAEnB9N,KAAKs7C,KAAKxtC,GAAY4S,mBAAmB,YAC7C,CAEA46B,KAAKm9D,GAEDz4G,KAAKy4G,WAAaA,EAAa,IAAI5hG,KAAK,GAAG4hG,cAAyB,KACpEz4G,KAAK04G,WAAa,IAAI7hG,KACtB7W,KAAKouB,KAAO,IAAIvX,MAAM7W,KAAKy4G,YAAcz4G,KAAK04G,YAAY78B,WAC1D77E,KAAKouB,KAAKuqF,QAAQ,GAElB34G,KAAKw4G,aACT,CAEAI,UAAUC,EAAmB/wE,EAAKgxE,GAC9B,MAAMC,EAAUr0G,EAAE,OACbmf,SAAS,iBACT9Q,KAAK,qBAAsB9R,EAAA,sBAAoBjB,KAAKouB,OACnD4qF,EAAQt0G,EAAE,UAAUihB,KAAKmiB,GAGnB,IAARA,IACY,IAARgxE,EACAC,EAAQp1F,IAAI,aAAe,EAAI,MAAS,KAExCo1F,EAAQp1F,IAAI,aAA6B,OAAXm1F,EAAM,GAAV,MAIlC,MAAMG,EAAaJ,EAAkB53G,EAAA,sBAAoBjB,KAAKouB,OAgB9D,OAdI6qF,IACAF,EAAQl1F,SAAS,wBACjBk1F,EAAQhmG,KAAK,OAAQ,SAASkmG,MAG9Bj5G,KAAKk5G,QAAQl5G,KAAKouB,KAAMpuB,KAAKy4G,aAC7BM,EAAQl1F,SAAS,wBAGjB7jB,KAAKk5G,QAAQl5G,KAAKouB,KAAMpuB,KAAK04G,aAC7BK,EAAQl1F,SAAS,uBAGrBk1F,EAAQp0G,OAAOq0G,GACRD,CACX,CAEAG,QAAQxpG,EAAGC,GACP,SAAKD,GAAKC,GAAKD,IAAMC,IAIdD,EAAEq4B,gBAAkBp4B,EAAEo4B,eACtBr4B,EAAEs4B,aAAer4B,EAAEq4B,YACnBt4B,EAAEu4B,YAAct4B,EAAEs4B,SAC7B,CAEA5oC,oBACI,MAAMsvB,EAAQ1tB,EAAA,sBAAoBjB,KAAKouB,MAAM4H,OAAO,EAAG,GACjD6iF,QAA0Bt1G,EAAA,MAAW,iCAAiCorB,KAE5E3uB,KAAKm4G,OAAOx1F,QAEZ,MAAMw2F,EAAen5G,KAAKouB,KAAK4Z,WAC/B,KAAOhoC,KAAKouB,KAAK4Z,aAAemxE,GAAc,CAC1C,MAAMC,EAAOp5G,KAAK44G,UACdC,EACA74G,KAAKouB,KAAK6Z,UACVjoC,KAAKouB,KAAKirF,SACVr5G,KAAKouB,KAAK2Z,eAGd/nC,KAAKm4G,OAAOxzG,OAAOy0G,GAEnBp5G,KAAKouB,KAAKuqF,QAAQ34G,KAAKouB,KAAK6Z,UAAY,EAC5C,CAEAjoC,KAAKouB,KAAKuqF,QAAQ,GAClB34G,KAAKouB,KAAKmqF,SAASv4G,KAAKouB,KAAK4Z,WAAa,GAE1ChoC,KAAKs4G,OAAO3yF,KAAK,GAAG3lB,KAAKs5G,eAAet5G,KAAKouB,KAAK4Z,eAAehoC,KAAKouB,KAAK2Z,gBAC/E,CAEAuxE,eAAeC,GACX,MAAO,CACH,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,MACA,OACFA,EACN,ECxKW,MAAMC,WAA6Bzb,GAC9Cp7F,YAAY82G,GACR72G,QAEA5C,KAAKy5G,WAAaA,EAElBz5G,KAAKsK,OAAM,IAAMtK,KAAKy5G,WAAWnvG,QAC5Bic,MAAK,IAAMvmB,KAAKy5G,WAAWx6F,YAC3B4+E,SAAQ,CAACt0E,EAAQ+M,IAAQt2B,KAAK05G,OAAOpjF,KACrC0nE,YAAW,CAACz0E,EAAQ+M,IAAQt2B,KAAK05G,OAAOpjF,KACxCinE,eAAcjnE,GAAO,qBAAuCt2B,KAAKy5G,WAAWl6G,OAAQ+2B,IAC7F,CAEAj3B,aAAai3B,GACT,GAAkB,IAAdA,EAAIjS,MACJ,OAEJ,MAAM/M,EAAUrW,EAAA,kBAAgBq1B,GAEb,IAAdA,EAAIjS,OAAe/M,GAA0B,IAAdgf,EAAIjS,YAC9B,kCAAmCrkB,KAAKy5G,WAAWl6G,cAEnD,mCAAoCS,KAAKy5G,WAAWl6G,OAElE,CAEAk+F,6BAEA,ECWW,MAAMkc,WAA6BhC,GAC9Ch1G,YAAYW,GACRV,MAAMU,EAAKgH,MAAOhH,EAAK2b,UA3CV,8iCA6Cbjf,KAAKsD,KAAOA,CAChB,CAEAwwC,WACIlxC,MAAMkxC,WAEN9zC,KAAK45G,YAAc55G,KAAKg4G,iBAAiBzrG,KAAK,gBAC9CvM,KAAK65G,eAAiB75G,KAAKg4G,iBAAiBzrG,KAAK,kBACrD,CAEAlN,sBACIW,KAAK45G,YAAYj3F,QACjB3iB,KAAK65G,eAAel3F,QAEpB,MAAMm3F,EAAc,CAChBxuF,aAAa,EACbC,cAAc,GAGlBvrB,KAAK45G,YAAYj1G,cACN,eAAuB3E,KAAKsD,KAAK/D,OAAQu6G,IAC3Cj2F,SAAS,cAGlB,IAAK,MAAMwH,WAAmBrrB,KAAKsD,KAAKsuF,gBACpC5xF,KAAK65G,eAAel1G,OAChBD,EAAE,QACGC,cACU,eAAuB0mB,EAAU9rB,OAAQu6G,IAC3Cj2F,SAAS,cAIlC,CAEA25E,cAAe,EC9EJ,MAAMuc,WAAwBr8D,EACzC/6C,cACIC,MAAM,UAEN5C,KAAKwzC,cACT,CAEAn0C,gBACIW,KAAKwiB,QAAQG,QACb3iB,KAAKoL,SAAW,GAChBpL,KAAKmS,QAAU,GAEf,MAAM6nG,QAA2Bn6G,EAAA,gBAAc,gBAE/C,IAAK,MAAMyD,WAAc02G,EAAmBpoB,gBAAiB,CACzD5xF,KAAKmS,QAAQ7F,KAAKhJ,EAAK/D,QAEvB,MAAMi2C,EAAelyC,EAAK6E,cAAc,kBAClC,IAAIwxG,GAAqBr2G,GACzB,IAAIk2G,GAAqBl2G,GACtBgiB,MAAM,mBAEftlB,KAAKmO,MAAMqnC,GAEXx1C,KAAKwiB,QAAQ7d,OAAO6wC,EAAalhC,UAEjCkhC,EAAagoD,aACjB,CACJ,CAEAC,6BACIz9F,KAAK80C,SACT,CAEAya,uBAAsB,YAAC9lD,IACfA,EAAYmlC,gBAAgBriC,MAAK6Z,GAAkC,iBAAxBA,EAAO/e,gBAClDrH,KAAK80C,UAGLrrC,EAAY4J,mBAAmB9G,MAAKwG,GAAsB,UAAdA,EAAKtP,MAC9C,CAAC,YAAa,qBAAsB,kBAAkB0F,SAAS4J,EAAKO,OACpEtT,KAAKmS,QAAQhJ,SAAS4J,EAAKxT,WAE9BS,KAAK80C,SAEb,EC/CW,MAAMmlE,WAAqCtc,GACtDh7F,cACIC,QAEA5C,KAAKslB,MAAM,mBAEXtlB,KAAKq9F,SAAS92E,KAAO,IAAM,kCACrB,kBACA,oBAENvmB,KAAKq9F,SAAS/yF,MAAQ,IAAM,kCACtB,yBACA,aAENtK,KAAKq9F,SAASx4E,QAAU,IAAM,kCACxB,wBACA,uBACV,CAEAq1F,+BACIl6G,KAAKw9F,aACT,ECoDW,MAAM2c,WAAyB,IAC1Cx3G,cACIC,QAEA5C,KAAKo6G,UAAY,UACjBp6G,KAAKq6G,kBAAmB,CAC5B,CAEAvmE,WACI9zC,KAAKwiB,QAAU9d,EAhFX,80EAiFJ1E,KAAKwiB,QAAQE,OAEb1iB,KAAKwiB,QAAQjW,KAAK,2BAA2Bye,QAAQ,CACjDrF,MAAM,IAGV3lB,KAAKwiB,QAAQjW,KAAK,mDACbgI,GAAG,SAAS,IAAM4rF,OAEvBx8F,EAAA,uBAAuB+I,GAAW1M,KAAKs6G,eAAe5tG,IAC1D,CAEA6tG,SAASrgG,GACA1Z,EAAA,MAAY,mBAKjBR,KAAKwiB,QAAQ2kB,OACbnnC,KAAKwiB,QAAQjW,KAAK,qBAAqBmW,OACvC1iB,KAAKwiB,QAAQjW,KAAK,gBAAgB2N,KAAaitB,QAN3CnnC,KAAKg0C,WAAU,EAOvB,CAEAsmE,eAAe5tG,GACU,0BAAjBA,EAAQjJ,MAIc,0BAAjBiJ,EAAQjJ,MAHbzD,KAAKo6G,UAAY,cACjBp6G,KAAKw6G,eAAiB9tG,EAAQ8tG,gBAMR,kBAAjB9tG,EAAQjJ,MACbzD,KAAKo6G,UAAY,YACjBp6G,KAAKw6G,eAAiB9tG,EAAQ8tG,gBAER,gBAAjB9tG,EAAQjJ,MACbzD,KAAKo6G,UAAY,eACjBp6G,KAAKw6G,eAAiB9tG,EAAQ8tG,gBAER,oBAAjB9tG,EAAQjJ,OACbzD,KAAKw6G,eAAiB9tG,EAAQwF,KAAKsoG,gBAGvCx6G,KAAKq6G,iBAAmBr6G,KAAKw6G,iBAAmB72G,EAAA,kCAE5C,CAAC,UAAW,eAAewF,SAASnJ,KAAKo6G,WACzCp6G,KAAKu6G,SAASv6G,KAAKo6G,WAEnBp6G,KAAKu6G,SAAS,GAAGv6G,KAAKo6G,aAAap6G,KAAKq6G,iBAAmB,aAAe,iBAElF,ECrIW,MAAMI,WAAyB1c,GAC1Cp7F,YAAY+3G,GACR93G,QAEA5C,KAAKslB,MAAM,mBAGXtlB,KAAK06G,aAAeA,EAEpB,IAAK,MAAMv6F,KAASu6F,EAAa37F,eAAe,oBAC5C/e,KAAKgT,wBAAwBmN,EAErC,CAEAu5F,SACI,MAAM,IAAIlsG,MAAM,0BACpB,CAEAwF,wBAAwBC,GACpB,MAAMC,EAAYD,EAAWE,YAEzBF,EAAWrJ,UACX,yBAAqCsJ,GAErC,uBAAmCD,EAAWG,OAAO,IAAMpT,KAAK05G,UAAUxmG,EAElF,CAEAq8C,uBAAsB,YAAC9lD,IACnB,IAAK,MAAMsJ,KAAQtJ,EAAY4J,mBACvBN,EAAKxT,SAAWS,KAAK06G,aAAan7G,QAAwB,UAAdwT,EAAKtP,MAAkC,qBAAdsP,EAAKO,KAC1EtT,KAAKgT,wBAAwBD,GACR,UAAdA,EAAKtP,MAAkC,cAAdsP,EAAKO,MAAwBkH,EAAA,YAA8BzH,EAAM/S,KAAK06G,eACtG16G,KAAKw9F,aAGjB,EC3BW,MAAMmd,WAAqBF,GACtC93G,YAAY+3G,GACR93G,MAAM83G,GAEN16G,KAAKsK,OAAM,IAAMtK,KAAK06G,aAAapwG,QAC9Bic,MAAK,IAAMvmB,KAAK06G,aAAaz7F,YAC7B4+E,SAAQ,CAACt0E,EAAQ+M,IAAQt2B,KAAK05G,OAAOpjF,KACrC0nE,YAAW,CAACz0E,EAAQ+M,IAAQt2B,KAAK05G,OAAOpjF,KACxCinE,eAAcjnE,IACX,MAAMloB,EAAepO,KAAK46G,kBAC1B,IAAKxsG,EACD,OAGJ,MAAMvN,EAAgBb,KAAK0xB,mBAE3B,qBAAuCtjB,EAAckoB,EAAK,CAAC,EAAGz1B,EAAc,GAExF,CAEAxB,aAAai3B,GAET,MAAMloB,QAAqBpO,KAAK46G,kBAChC,IAAKxsG,GAA8B,IAAdkoB,EAAIjS,MACrB,OAGJ,MAAMxjB,QAAsBb,KAAK0xB,mBAEjC,GAAK4E,EAGE,CACH,MAAMhf,EAAUrW,EAAA,kBAAgBq1B,GAEb,IAAdA,EAAIjS,OAAe/M,GAA0B,IAAdgf,EAAIjS,YAC9B,kCAAmCjW,EAAcvN,SAEjD,mCAAoCuN,EAAcvN,EAEhE,YATU,mCAAoCuN,EAAcvN,EAUhE,CAEA+5G,kBACI,MAAMxsG,EAAepO,KAAK06G,aAAa95F,iBAAiB,UAExD,GAAKxS,EAKL,OAAOA,EAJHwyB,EAAA,OAAmB,4CAK3B,CAEAlP,mBACI,OAAO1xB,KAAK06G,aAAa95F,iBAAiB,gBACnC,wCAAyC/f,aACpD,CAEAylE,WACI,MAAMzyC,EAAY7zB,KAAK06G,aAAa17F,UAAU,oBACzCrT,KAAIkW,GAAKA,EAAEzO,QACXxH,QAAOqE,KAAOA,IACdyB,KAAK,MAEV,IAAIpH,EAAQ1H,MAAM0jE,WAKlB,OAJIzyC,IACAvpB,GAAS,KAAKupB,MAGXvpB,CACX,EClFW,MAAMuwG,WAAuBJ,GACxC93G,YAAY+3G,GACR93G,MAAM83G,GAEN16G,KAAKsK,OAAM,IAAMtK,KAAK06G,aAAapwG,QAC9Bic,MAAK,IAAMvmB,KAAK06G,aAAaz7F,YAC7B4+E,SAAQ,IAAM79F,KAAK05G,UAC5B,CAEAr6G,eACI,GAAIW,KAAK06G,aAAavyG,cAAc,iCAC1BnI,KAAK06G,aAAaI,oBACrB,CACH,MAAMlyF,QAAe5oB,KAAK06G,aAAaK,kBAAkB,gBAEnDnyF,EAAOkyF,eACjB,CACJ,ECfW,MAAME,WAAsBL,GACvCt7G,wBAGI,aAFwB,qBAEPE,MACrB,CAEAmyB,mBACI,OAAO,wCAAyC7wB,aACpD,ECTW,MAAMo6G,WAA6Btd,GAC9Ch7F,cACIC,QAEA5C,KAAKq9F,SAAS6d,qBAAuB,IACzC,CAEAA,qBAAqBC,GAEjB,OADAn7G,KAAKq9F,SAAS6d,qBAAuBC,EAC9Bn7G,IACX,CAEA8zC,WACIlxC,MAAMkxC,WAEN9zC,KAAKo7G,YACT,CAEAA,aACI,MAAMC,EAAer7G,KAAKq9F,SAAS6d,uBAE9BG,EAKLx7G,EAAA,gBAAcw7G,GAAcrwG,MAAK1H,IAC7BtD,KAAKq9F,SAAS92E,KAAOjjB,EAAK2b,UAE1Bjf,KAAKw9F,aAAa,IAPlBvoF,QAAQxO,MAAM,qBAAqBzG,KAAK8V,+BAShD,CAEAy5C,uBAAsB,YAAC9lD,IACnB,MAAM6xG,EAAaz7G,EAAA,yBAAuBG,KAAKk7G,wBAE1CI,GAID7xG,EAAY4J,iBAAiBrT,KAAK8V,aAAavJ,MAAKwG,GACtC,UAAdA,EAAKtP,MACY,cAAdsP,EAAKO,MACL,cAA6BP,EAAMuoG,MAEtCt7G,KAAKo7G,YAEb,EC9CW,MAAMG,WAAgCN,GACjDt4G,YAAY+3G,EAAc71F,GACtBjiB,QAEA5C,KAAKsK,OAAM,IAAMowG,EAAapwG,QACzBic,MAAK,IAAMm0F,EAAaz7F,YACxB4F,SAAQ,IAAMA,IACdy4E,eAAe,SACf4d,sBAAqB,IAAMR,EAAan7G,SACxCg+F,eAAc70F,GAAK1I,KAAKw7G,gBAAgB9yG,KACxC4c,MAAM,kBACf,CAEAyuB,YACI,OAAOnxC,MAAMmxC,aAAe9yC,EAAA,oBAChC,CAEA6yC,WACIlxC,MAAMkxC,WAED7yC,EAAA,uBAILjB,KAAKgF,YAAc/D,EAAA,uBAAqB,oBAAoBgE,wBAG5DjF,KAAKgF,YAAYq7E,eAEjBrgF,KAAK80C,UACT,CAEAz1C,sBAAsBqJ,GAClBA,EAAE+tB,gBA4CN,CAEAqe,UACS7zC,EAAA,oBAST,CAEAw6G,yBACIz7G,KAAK80C,SACT,ECrFW,MAAM4mE,WAAuB,IACxC/4G,cACIC,QAEA5C,KAAK27G,YAAc,IACvB,CAEA5nE,YACI,OAAO/zC,KAAK27G,YAAY5nE,WAC5B,CAEAD,WACI9zC,KAAKwiB,QAAUxiB,KAAK27G,YAAYrnG,QACpC,CAEAjV,mBAAmBiE,GACf,GAAkB,aAAdA,EAAKG,KACL,MAAM,IAAI+J,MAAM,SAASlK,EAAK/D,YAAY+D,EAAKgH,qEAGnD,IAAKrJ,EAAA,qBAAqBqC,EAAK6E,cAAc,eACzC,OAAO,EAGX,MAAMi1D,EAAe95D,EAAKic,cAAc,gBAExC,GAAI3a,KAAKg3G,mBAAsC,iBAAjBx+C,EAC1B,OAAO,EAGX,GAAqB,YAAjBA,EACAp9D,KAAK27G,YAAc37G,KAAK67G,0BAA0Bv4G,GAC7CgiB,MAAM,wBACR,GAAqB,SAAjB83C,EACPp9D,KAAK27G,YAAc,IAAIhB,GAAar3G,GAC/BgiB,MAAM,wBACR,GAAqB,WAAjB83C,EACPp9D,KAAK27G,YAAc,IAAId,GAAev3G,GACjCgiB,MAAM,wBACR,GAAqB,iBAAjB83C,EACPp9D,KAAK27G,kBAAoB37G,KAAK87G,iBAAiBx4G,OAC5C,IAAqB,kBAAjB85D,EAGP,MAAM,IAAI5vD,MAAM,+BAA+B4vD,oBAA+B95D,EAAK/D,kBAAkB+D,EAAKgH,UAF1GtK,KAAK27G,YAAc37G,KAAK+7G,kBAAkBz4G,EAG9C,CAEA,IAAKtD,KAAK27G,YACN,MAAM,IAAInuG,MAAM,0CAA0ClK,EAAK/D,mBAAmB+D,EAAKgH,UAK3F,OAFAtK,KAAKmO,MAAMnO,KAAK27G,cAET,CACX,CAEAE,0BAA0Bv4G,GACtB,OAAO,IAAIq6F,IACNrzF,OAAM,IAAMhH,EAAKgH,QACjBic,MAAK,IAAMjjB,EAAK2b,YAChB4F,SAAQ,IAAMvhB,EAAKic,cAAc,YAC1C,CAEAlgB,uBAAuBiE,GACnB,MAAMimB,QAAejmB,EAAKy3G,kBAAkB,UAE5C,GAAIxxF,EACA,aAAaA,EAAOuxF,gBAEpB,MAAM,IAAIttG,MAAM,8BAA8BlK,EAAK/D,YAAY+D,EAAKgH,yBAE5E,CAEAyxG,kBAAkBz4G,GACd,MAAM04G,EAAgB14G,EAAKic,cAAc,iBAEzC,GAAsB,aAAlBy8F,EACA,OAAO,IAAI9D,GAAe50G,EAAKgH,MAAOhH,EAAK2b,WACxC,GAAsB,WAAlB+8F,EAA4B,CAEnC,MAAM5gB,EAAWj2F,SAAS7B,EAAKic,cAAc,aAAe,MACtD87E,EAAel2F,SAAS7B,EAAKic,cAAc,iBAAmB,OAEpE,OAAO,IAAI47E,GAAaC,EAAUC,EACtC,CAAO,GAAsB,cAAlB2gB,EACP,OAAO,IAAIjC,GACR,GAAsB,qBAAlBiC,EACP,OAAO,IAAI/B,GACR,GAAsB,eAAlB+B,EACP,OAAO,IAAI7B,GACR,GAAsB,wBAAlB6B,EACP,OAAO,IAAIT,GAAwBj4G,EAAM,qBACtC,GAAsB,2BAAlB04G,EACP,OAAO,IAAIT,GAAwBj4G,EAAM,wBACtC,GAAsB,mBAAlB04G,EACP,OAAO,IAAIhB,GAAc13G,GAEzB,MAAM,IAAIkK,MAAM,+BAA+BwuG,kBAA8B14G,EAAK/D,WAAW+D,EAAKgH,SAE1G,EC3GW,MAAM2xG,WAA0Bv+D,EAC3C/6C,cACIC,MAAM,UAEN5C,KAAKsmB,GAAG,sBACRtmB,KAAK2jB,IAAI,SAAU,QACnB3jB,KAAK0zC,UAEL1zC,KAAKs8B,MACT,CAEAj9B,mBACUQ,EAAA,2BAEN,MAAMq8G,QAA6Br8G,EAAA,gBAAc,uBAAuB,GAExE,IAAKq8G,EAGD,YAFAjnG,QAAQY,IAAI,8CAKhB,MAAMsmG,EAAc,GAEpB,IAAK,MAAMzB,WAAsBwB,EAAqBtqB,gBAClD,IACI,MAAMwqB,EAAiB,IAAIV,SACLU,EAAeC,aAAa3B,IAG9CyB,EAAY7vG,KAAK8vG,EAEzB,CACA,MAAO1zG,GACHuM,QAAQxO,MAAMiC,EAClB,CAGJ1I,KAAKoL,SAAW,GAChBpL,KAAKmO,SAASguG,GAEdn8G,KAAKwiB,QAAQG,QACb3iB,KAAKy9C,uBAECz9C,KAAKwW,sBAAsB,yBAEjC,MAAM7I,EAAgB,wCAElBA,UACM3N,KAAK6U,YAAY,iBAAkB,CACrC3V,YAAayO,IAGbA,EAAc7N,gBACRE,KAAK6U,YAAY,eAAgB,CACnC3V,YAAayO,EACb7N,SAAU6N,EAAc7N,WAIxC,CAEAyvD,uBAAsB,YAAC9lD,IACfA,EAAYmlC,gBAAgBriC,MAAK6Z,GAAUvmB,EAAA,yBAAuBumB,EAAO/e,eAAee,uBAGxFpI,KAAKs8B,MAEb,ECvEW,MAAMggF,WAAwB3e,GACzCh7F,cACIC,QAEA5C,KAAKumB,KAAK,cACLjc,MAAM,UACNua,QAAQ,iBACRy4E,eAAe,UACfh4E,MAAM,cACf,CAEAyuB,YACI,OAAOnxC,MAAMmxC,cAAgB,CAAC,WAAY,OAAO5qC,SAASnJ,KAAKsD,MAAMG,KACzE,ECeW,MAAM84G,WAA0B,IAC3CxoE,YACI,OAAOnxC,MAAMmxC,aACN/zC,KAAKsD,OACJtD,KAAKsD,KAAKnD,KAAK+H,WAAW,2BAAiD,iCAAnBlI,KAAKsD,KAAKnD,KAC9E,CAEA2zC,WACI9zC,KAAKwiB,QAAU9d,EA9BX,6mBA+BJ1E,KAAKw8G,0BAA4Bx8G,KAAKwiB,QAAQjW,KAAK,4BACnDvM,KAAKw8G,0BAA0BjoG,GAAG,SAAS,KACvC,sBAAyB,cAErBvU,KAAKsD,KAAKnD,KAAKiG,SAAS,YACxB3E,OAAOyE,KAAK,sEAAuE,UAGnFzE,OAAOyE,KAAK,oEAAqE,SACrF,IAGJlG,KAAKssG,eAAiBtsG,KAAKwiB,QAAQjW,KAAK,mBACxCvM,KAAKm3F,kBAAoBn3F,KAAKwiB,QAAQjW,KAAK,wBAC3CvM,KAAKm3F,kBAAkB5iF,GAAG,SAASlV,UAC/B,MAAM,SAACS,SAAkByD,EAAA,OAAY,iCAAkC,CAACk5G,iBAAkBz8G,KAAKT,eAEzFoE,EAAA,wCAEA,wCAAyCyF,QAAQtJ,GAEvD,sBAAyB,8CAA8CC,EAAA,mBAA6BD,KAAY,IAGpH,mCAA+CE,KAAKwiB,SAEpDxiB,KAAKwzC,eAEL5wC,MAAMkxC,UACV,CAEAz0C,sBAAsBiE,GAClBtD,KAAKssG,eAAen/E,OAChB7pB,EAAKnD,KAAK+H,WAAW,2BACJ,iCAAd5E,EAAKnD,MAGZH,KAAKm3F,kBAAkBhqE,OACL,iCAAd7pB,EAAKnD,MACFmD,EAAKgZ,sBAGZtc,KAAKw8G,0BAA0BrvF,OAAO7pB,EAAKnD,KAAK+H,WAAW,+BAC/D,CAEA7I,gCAA+B,OAACE,IACxBS,KAAK20C,OAAOp1C,UACNS,KAAK80C,SAEnB,ECjDW,MAAM4nE,WAAqB,IACtC3oE,YACI,OAAO/zC,KAAKsD,MACLtD,KAAKsD,KAAKnD,KAAK+H,WAAW,gCAC1BtF,MAAMmxC,WACjB,CAEAD,WACI9zC,KAAKwiB,QAAU9d,EA7CX,y0BA8CJ1E,KAAKmtB,QAAO,GAEZntB,KAAK28G,cAAgB38G,KAAKwiB,QAAQjW,KAAK,sBACvCvM,KAAKkpG,aAAelpG,KAAKwiB,QAAQjW,KAAK,yBACtCvM,KAAKkpG,aAAa30F,GAAG,SAAS,IAAMvU,KAAKmtB,QAAO,IACpD,CAEA9tB,sBAAsBiE,GAClBtD,KAAK28G,cAAch6F,OACvB,CAEAi6F,qBAAoB,SAAC56E,EAAQ,OAAEziC,IAC3B,GAAKS,KAAK20C,OAAOp1C,GAAjB,CAIAS,KAAKmtB,QAAO,GAEZ,IAAK,MAAMzgB,KAAWs1B,EAClBhiC,KAAK28G,cAAch4G,OAAO+H,GAAS/H,OAAOD,EAAE,QALhD,CAOJ,CAEAyoB,OAAOga,GACHnnC,KAAKwiB,QAAQyxB,YAAY,kBAAmB9M,EAChD,ECxCW,MAAM01E,WAAkC,IACnD/oE,WACIlxC,MAAMkxC,WAEN9zC,KAAKwiB,QAAU9d,EAnCX,k4BAoCJ1E,KAAKwiB,QAAQjO,GAAG,SAAS,IAAMvU,KAAKgI,eAAe,yBACnDhI,KAAKwzC,cACT,ECjBW,MAAMspE,WAA6B,IAC9C/oE,YACI,OAAOnxC,MAAMmxC,aACN/zC,KAAKsD,OACJtD,KAAKsD,KAAKnD,KAAK+H,WAAW,2BAA6BlI,KAAK+8G,qBAC5D/8G,KAAKsD,KAAK4c,SAAS,uBAAyBlgB,KAAKsD,KAAK4c,SAAS,iBAC3E,CAEA68F,kBACI,MAA0B,iCAAnB/8G,KAAKsD,KAAKnD,IACrB,CAEAmmE,WACI,MAAO,CACHn/B,KAAMnnC,KAAK+zC,YACXv0C,UAAU,EACV8K,MAAOtK,KAAK+8G,kBAAoB,QAAU,SAC1Cx2F,KAAM,YAEd,CAEAutB,WACI9zC,KAAKwiB,QAAU9d,EA1CX,kfA2CJ1E,KAAKwzC,eAELxzC,KAAKssG,eAAiBtsG,KAAKwiB,QAAQjW,KAAK,mBACxCvM,KAAKg9G,oBAAsBh9G,KAAKwiB,QAAQjW,KAAK,uBACjD,CAEAlN,sBAAsBiE,GAClB,MAAM25G,EAAe35G,EAAKic,cAAc,mBAChCvf,KAAK+8G,kBAAoB,gBAAkB,kBAEnD/8G,KAAKssG,eAAe/mF,KAAK03F,GACzBj9G,KAAKssG,eAAev5F,KAAK,QAASkqG,GAClC,mCAA+Cj9G,KAAKwiB,SAEpD,MAAM06F,EAAqB55G,EAAKic,cAAc,sBAE1C29F,EACAl9G,KAAKg9G,oBAAoB71E,OAAOxhB,KAAKu3F,GAErCl9G,KAAKg9G,oBAAoBr6F,QAAQD,MAEzC,EChEW,MAAMy6F,WAAuBpf,GACxCp7F,YAAYu5F,GACRt5F,QAEA5C,KAAKk8F,aAAeA,EAEpBl8F,KAAKumB,KAAK21E,EAAe,kBAAoB,oBACxC5xF,MAAM4xF,EAAe,OAAS,QAC9BoB,eAAe,UACfO,SAAQx+F,MAAOkqB,EAAQ7gB,KACpBA,EAAE0b,kBACFmF,EAAOvhB,eAAe,oBAAqB,CAACvI,MAAO8pB,EAAOgrB,kBAAmB2nD,aAAcl8F,KAAKk8F,cAAc,IAEjH52E,MAAM,cACf,CAEAyuB,YACI,IAAKnxC,MAAMmxC,YACP,OAAO,EAGX,GAAI/zC,KAAKk8F,aAEL,QAASl8F,KAAKd,aAAa8H,UACxB,CACH,MAAMumD,EAAe,6CAA6Cp9C,GAAKA,EAAE1Q,QAAUO,KAAKP,QAClF29G,EAAc,kCAAmC7vD,EAAe,GAEtE,QAAS6vD,GAAap2G,SAC1B,CACJ,CAEA3H,gCACIW,KAAK80C,SACT,CAEAz1C,mCACIW,KAAK80C,SACT,CAEAz1C,gCACIW,KAAK80C,SACT,CAEAz1C,8BACIW,KAAK80C,SACT,ECLW,MAAMuoE,WAAgC,IACjD16G,cACIC,QAEA5C,KAAKqH,aAAe,IACxB,CAEAysC,WACI9zC,KAAKwiB,QAAU9d,EA9CX,srDA+CJ1E,KAAK44E,MAAQ54E,KAAKwiB,QAAQjW,KAAK,2BAC/BvM,KAAKu9D,WAAav9D,KAAKwiB,QAAQjW,KAAK,iCACpCvM,KAAK6xG,iBAAmB7xG,KAAKwiB,QAAQjW,KAAK,wCAC1CvM,KAAKs9G,cAAgBt9G,KAAKwiB,QAAQjW,KAAK,6BACvCvM,KAAKgyG,sBAAwBhyG,KAAKwiB,QAAQjW,KAAK,2BAE/CvM,KAAK44E,MAAMrkE,GAAG,UAAU,KAEpBvU,KAAKs9G,cAAcvqG,KAAK,WAAY,YAEpC/S,KAAKu9G,kBAAkBv9G,KAAKqH,eAErB,KAGXrH,KAAK6xG,iBAAiBt9F,GAAG,UAAU,KAC3BvU,KAAK6xG,iBAAiBzsF,MACtBplB,KAAKs9G,cAAchvD,WAAW,YAG9BtuD,KAAKs9G,cAAcvqG,KAAK,WAAY,WACxC,IAGJ/S,KAAKwiB,QAAQjW,KAAK,2BAA2Bye,QAAQ,CACjDrF,MAAM,GAEd,CAEAtmB,wCAAuC,OAACE,IACpCS,KAAKqH,aAAe9H,EAEpBS,KAAK6xG,iBAAiBzsF,IAAI,IAAItgB,QAAQ,UACtC9E,KAAKgyG,sBAAsBr9F,KAAK,UAAWnU,EAAA,KAAW,mBAEtDR,KAAKu9D,WAAWh4C,WAAWxlB,EAAA,eAAyBC,KAAKqH,eAEzDpG,EAAA,mBAAiBjB,KAAKwiB,QAC1B,CAEAnjB,wBAAwBgI,GACpB,MAAM6qB,EAAQ1B,MAAMC,KAAKzwB,KAAK6xG,iBAAiB,GAAG3/E,OAI5C1xB,EAAU,CACZ+zD,cAHiB3/C,EAGU5U,KAAKgyG,sBAHRp9F,EAAIwkB,GAAG,YAAc,OAAS,UAArCxkB,MAMrB5U,KAAKwiB,QAAQgmB,MAAM,cAEb,uBAA0B,cAAenhC,EAAc6qB,EAAO1xB,EACxE,EC5FW,MAAMg9G,WAAiC,IAClDzpE,YACI,OAAOnxC,MAAMmxC,aACN,CAAC,UAAW,UAAU5qC,SAASnJ,KAAKsD,MAAMG,OAC1CzD,KAAKsD,KAAKwZ,sBAC+B,YAAzC9c,KAAKd,aAAaC,UAAU4B,QACvC,CAEA+yC,WACIlxC,MAAMkxC,WAEN9zC,KAAKwiB,QAAU9d,EApBX,gOAqBJ1E,KAAKy9G,iBAAmBz9G,KAAKwiB,QAAQjW,KAAK,sBAE1CvM,KAAKwiB,QAAQjO,GAAG,SAAS,KACrBvU,KAAKy9G,iBAAiB96F,QAAQhe,OAC1BD,EAAE,SACGqO,KAAK,MAAO9R,EAAA,0BAAwBjB,KAAKsD,QAGlD,GAA2CtD,KAAKy9G,kBAEhDz9G,KAAKy9G,iBAAiB96F,OAAO,IAEjC3iB,KAAKwzC,cACT,EClCW,MAAMkqE,WAA4B,IAC7C3pE,YACI,OAAOnxC,MAAMmxC,aAAe,CAAC,OAAQ,QAAQ5qC,SAASnJ,KAAKsD,MAAMG,KACrE,CAEAqwC,WACI9zC,KAAKwiB,QAAU9d,EARX,6CASJ1E,KAAKwzC,eAELxzC,KAAKwiB,QAAQjO,GAAG,SAAS,IACrBvU,KAAKgI,eAAe,cAAe,CAACvI,MAAOO,KAAKP,SACxD,CAEAg+F,6BACIz9F,KAAK29G,oBAAsB39G,KAAKwiB,QAAQ9N,QAAQ,wBAEhD,IAAI+1C,gBAAe,IAAMzqD,KAAK49G,kBAAiBjzD,QAAQ3qD,KAAK29G,oBAAoB,IAEhF39G,KAAK49G,eACT,CAEAA,gBACI,MAAMC,EAAkB79G,KAAK29G,oBAAoBj9D,SAEjD1gD,KAAKwiB,QAAQmB,IAAI,SAAU9L,KAAKC,MAAM+lG,EAAkB,GAC5D,ECsDW,MAAMC,GACjBn7G,YAAYo7G,GACR/9G,KAAK+9G,cAAgBA,CACzB,CAEA3pG,cAAcoB,GAGV,OAFAA,EAAWwoG,eAAiB,IAAIruD,GAEzB,IAAI6qC,IACNpkF,UAAUZ,GACVrH,MAAM,IAAIuvC,EAAc,UACpBp3B,GAAG,iBACH3C,IAAI,QAAS,QACbxV,MAAM,IAAI6vC,GACV7vC,MAAM,IAAI8tG,IACV9tG,MAAM,IAAI2vF,KAEd3vF,OAAM,IAAImhD,GACNnhD,MAAM,IAAImtF,IACVntF,MAAMqH,EAAWwoG,gBACjB7vG,SAASnO,KAAK+9G,cAAct0F,IAAI,eAEpCtb,MAAM,IAAIuvC,EAAc,UACpBp3B,GAAG,aACH3C,IAAI,YAAa,KACjBxV,MAAM,IAAIuvC,EAAc,OACpBvvC,MAAM,IAAI47C,GACV57C,MAAM,IAAIqgD,GACV7qC,IAAI,SAAU,SAElBxV,MAAM,IAAIuvC,EAAc,OACpBhK,UACAD,cACAtlC,MAAM,IAAIuvC,EAAc,UACpBhK,UACAD,cACAntB,GAAG,eACHnY,MAAM,IAAI0tF,IAAmB,KACtB,IAAIiJ,IACC32F,MAAM,IAAIuvC,EAAc,OAAOp4B,MAAM,aACjC3B,IAAI,SAAU,QACdA,IAAI,aAAc,QAClBA,IAAI,cAAe,UACnBgwB,SAAS,mCACTxlC,MAAM,IAAI4qF,IACV5qF,MAAM,IAAIkvD,GACVlvD,MAAM,IAAIgtF,GAAa,EAAG,IAC1BhtF,MAAM,IAAIgvG,IAAe,IACzBhvG,MAAM,IAAIgvG,IAAe,IACzBhvG,MAAM,IAAI+vF,IACV/vF,MAAM,IAAI8vF,KAEd9vF,OACG,IAAIy+E,IAICG,OAAO,IAAI4B,IACX5B,OAAO,IAAI+vB,IACX/vB,OAAO,IAAIyJ,IACXzJ,OAAO,IAAI4W,IACX5W,OAAO,IAAI8U,IACX9U,OAAO,IAAI6L,IACX7L,OAAO,IAAIoL,IACXpL,OAAO,IAAI0L,IACX1L,OAAO,IAAIwT,IACXxT,OAAO,IAAI5mB,IACX4mB,OAAO,IAAI+C,IACX/C,OAAO,IAAI0V,IACX1V,OAAO,IAAIoV,IACXpV,OAAO,IAAIgW,IACXhW,OAAO,IAAI8T,IACX/9C,OAAO,IAAIw5D,IACXx5D,OAAO,IAAI2jB,KAEnBt4D,MAAM,IAAIs3F,IACVt3F,MAAM,IAAIwsF,IACVxsF,OAAM,IAAI+oG,IACN/oG,MAAM,IAAIs1F,IACVt1F,MAAM,IAAIouG,IACVpuG,MAAM,IAAIkpG,IACVlpG,MAAM,IAAIqvG,IACVrvG,MAAM,IAAIupG,IACVvpG,MAAM,IAAI42F,IACV52F,MAAM,IAAI0uG,KAEd1uG,MAAM,IAAI41F,IACV51F,OACG,IAAImsF,IACC5mD,UACAvlC,MAAM,IAAIwpF,IACVxpF,MAAM,IAAI89E,IACV99E,MAAM,IAAI0jF,IACV1jF,MAAM,IAAI+rF,IACV/rF,MAAM,IAAIopF,IACVppF,MAAM,IAAIuvG,KAElBvvG,MAAM,IAAIuuG,IACVvuG,MAAM,IAAIi6F,IACVj6F,SACMnO,KAAK+9G,cAAct0F,IAAI,uBACvBzpB,KAAK+9G,cAAct0F,IAAI,wBAIzCtb,SAASnO,KAAK+9G,cAAct0F,IAAI,iBAEpCtb,OAAM,IAAIk1F,IACNl1F,MAAM,IAAIo7F,IACVp7F,MAAM,IAAI08F,IACV18F,SAASnO,KAAK+9G,cAAct0F,IAAI,kBAI5Ctb,MAAM,IAAI89F,IACV99F,MAAM,IAAI0+F,IACV1+F,MAAM,IAAIw/F,IACVx/F,MAAM,IAAI0/F,IACV1/F,MAAM,IAAIygG,IACVzgG,MAAM,IAAI4gG,IACV5gG,MAAM,IAAIkhG,IACVlhG,MAAM,IAAIqhG,IACVrhG,MAAM,IAAIwhG,IACVxhG,MAAM,IAAI+hG,IACV/hG,MAAM,IAAIoiG,IACVpiG,MAAM,IAAI8iG,IACV9iG,MAAM,IAAIqjG,IACVrjG,MAAM,IAAIyjG,IACVzjG,MAAM,IAAIokG,IACVpkG,MAAM,IAAIkvG,IACVlvG,MAAM,IAAIglG,IACVhlG,MAAM,IAAI6lG,IACV7lG,MAAM,IAAIgmG,IACVhmG,MAAM,IAAI8mG,IACV9mG,MAAM,IAAIgoG,IACVhoG,MAAM,IAAIqoG,IACVroG,MAAM,IAAI0oG,GACnB,EC7IJ,SAvEA,WACIp1G,OAAOmD,KAAK0mC,UAAYrqC,EAAA,kBACxBQ,OAAOmD,KAAKukB,SAAWloB,EAAA,iBAEvBQ,OAAOmD,KAAKuQ,iBAAmBC,GAAM,2BAA4BA,GACjE3T,OAAOmD,KAAK+9B,WAAap/B,EAAA,aACzB9B,OAAOmD,KAAKwyB,sBAAwB/qB,GAAQ,0BAAkCA,GAC9E5K,OAAOmD,KAAKqzB,0BAA4B5rB,GAAQ,8BAAsCA,GAGtF5K,OAAOmD,KAAKgJ,qBAAuB,IAAM,4CACzCnM,OAAOmD,KAAK4vB,eAAiB,oBAC7B/yB,OAAOmD,KAAKmwB,OAAS,YACrBtzB,OAAOmD,KAAK4Q,WAAa,UACzB/T,OAAOmD,KAAK/E,MAAQA,EAAA,QACpB4B,OAAOmD,KAAKq5G,UAAYp+G,EAAA,QAGxB4B,OAAOmD,KAAKs5G,qBAAuB7+G,SAAY,yBAA0B,wBAEzEoC,OAAOmD,KAAKu5G,iBAAmB,4vBAe/B18G,OAAO41C,QAAU,SAAU+mE,EAAKv4G,EAAKw4G,EAAQC,EAAU73G,GAGnD,IAAIiG,EAAU,WAiBd,OAnBe0xG,EAAInnF,cAIR9tB,SAAS,gBAChBuD,GAAW,SAEXA,GAAW,CACP,OAAO0xG,IACP,QAAQv4G,IACR,OAAOw4G,IACP,OAAOC,IACP,SAASxyG,KAAKC,UAAUtF,KACxB,OAAOA,GAASA,EAAMkG,SACxB+E,KAAK,MAGX/N,EAAA,WAAY+I,IAEL,CACX,EAEA,IAAK,MAAM6xG,KAAgB35G,KAAK45G,eAAiB,GAC7C,gBAAyB,sBAAsBD,KAAgB,GAGnEt9G,EAAA,wBAAsByD,EAAEjD,SAExBiD,EAAE,QAAQ6P,GAAG,QAAS,cAAc,WAGhC,OAFA9S,OAAOyE,KAAKxB,EAAE1E,MAAM+S,KAAK,QAAS,WAE3B,CACX,GACJ,ECnEA1M,EAAA,mCAAyC2E,MAAKyzG,IAC1C,oBAAqB,IAAIX,GAAcW,IACvC,iBAAkB,IAGtB,KAEIx9G,EAAA,sBACAA,EAAA,uBAAqB,YAAY0E,YAAY4O,GAAG,kBAC5ClV,MAAOgY,EAAO8b,IAAe,yBAA0BA,KAG/D,IAEA,yBAEA,SAEIlyB,EAAA,sBACA","sources":["webpack://trilium/./src/public/app/components/root_command_executor.js","webpack://trilium/./src/public/app/components/entrypoints.js","webpack://trilium/./src/public/app/components/note_context.js","webpack://trilium/./src/public/app/utils/mutex.js","webpack://trilium/./src/public/app/components/tab_manager.js","webpack://trilium/./src/public/app/components/mobile_screen_switcher.js","webpack://trilium/./src/public/app/components/main_tree_executors.js","webpack://trilium/./src/public/app/components/shortcut_component.js","webpack://trilium/./src/public/app/components/app_context.js","webpack://trilium/./src/public/app/components/component.js","webpack://trilium/./src/public/app/components/zoom.js","webpack://trilium/./src/public/app/entities/fattachment.js","webpack://trilium/./src/public/app/entities/fattribute.js","webpack://trilium/./src/public/app/entities/fbranch.js","webpack://trilium/./src/public/app/services/css_class_manager.js","webpack://trilium/./src/public/app/entities/fnote.js","webpack://trilium/./src/public/app/menus/context_menu.js","webpack://trilium/./src/public/app/menus/link_context_menu.js","webpack://trilium/./src/public/app/services/attribute_renderer.js","webpack://trilium/./src/public/app/services/branches.js","webpack://trilium/./src/public/app/services/bundle.js","webpack://trilium/./src/public/app/services/clipboard.js","webpack://trilium/./src/public/app/services/content_renderer.js","webpack://trilium/./src/public/app/services/date_notes.js","webpack://trilium/./src/public/app/services/dialog.js","webpack://trilium/./src/public/app/entities/fblob.js","webpack://trilium/./src/public/app/services/froca.js","webpack://trilium/./src/public/app/services/hoisted_note.js","webpack://trilium/./src/public/app/services/import.js","webpack://trilium/./src/public/app/services/keyboard_actions.js","webpack://trilium/./src/public/app/services/library_loader.js","webpack://trilium/./src/public/app/services/link.js","webpack://trilium/./src/public/app/services/note_attribute_cache.js","webpack://trilium/./src/public/app/services/note_create.js","webpack://trilium/./src/public/app/services/note_tooltip.js","webpack://trilium/./src/public/app/services/note_types.js","webpack://trilium/./src/public/app/services/open.js","webpack://trilium/./src/public/app/services/options.js","webpack://trilium/./src/public/app/services/promoted_attribute_definition_parser.js","webpack://trilium/./src/public/app/services/protected_session.js","webpack://trilium/./src/public/app/services/protected_session_holder.js","webpack://trilium/./src/public/app/services/render.js","webpack://trilium/./src/public/app/services/frontend_script_api.js","webpack://trilium/./src/public/app/services/script_context.js","webpack://trilium/./src/public/app/services/search.js","webpack://trilium/./src/public/app/services/validation_error.js","webpack://trilium/./src/public/app/services/server.js","webpack://trilium/./src/public/app/services/shortcuts.js","webpack://trilium/./src/public/app/services/spaced_update.js","webpack://trilium/./src/public/app/services/toast.js","webpack://trilium/./src/public/app/services/tree.js","webpack://trilium/./src/public/app/services/utils.js","webpack://trilium/./src/public/app/services/load_results.js","webpack://trilium/./src/public/app/services/froca_updater.js","webpack://trilium/./src/public/app/services/ws.js","webpack://trilium/./src/public/app/services/ sync","webpack://trilium/./src/public/app/widgets/basic_widget.js","webpack://trilium/./src/public/app/widgets/note_context_aware_widget.js","webpack://trilium/./src/public/app/widgets/right_panel_widget.js","webpack://trilium/external node-commonjs \"electron\"","webpack://trilium/webpack/bootstrap","webpack://trilium/webpack/runtime/load script","webpack://trilium/webpack/runtime/define property getters","webpack://trilium/webpack/runtime/ensure chunk","webpack://trilium/webpack/runtime/get javascript chunk filename","webpack://trilium/webpack/runtime/hasOwnProperty shorthand","webpack://trilium/webpack/runtime/make namespace object","webpack://trilium/webpack/runtime/publicPath","webpack://trilium/webpack/runtime/jsonp chunk loading","webpack://trilium/./src/public/app/services/note_autocomplete.js","webpack://trilium/./src/public/app/services/mac_init.js","webpack://trilium/./src/public/app/menus/electron_context_menu.js","webpack://trilium/./src/public/app/widgets/containers/container.js","webpack://trilium/./src/public/app/widgets/containers/flex_container.js","webpack://trilium/./src/public/app/widgets/buttons/update_available.js","webpack://trilium/./src/public/app/widgets/buttons/global_menu.js","webpack://trilium/./src/public/app/services/attributes.js","webpack://trilium/./src/public/app/widgets/tab_row.js","webpack://trilium/./src/public/app/widgets/title_bar_buttons.js","webpack://trilium/./src/public/app/widgets/containers/left_pane_container.js","webpack://trilium/./src/public/app/widgets/note_tree.js","webpack://trilium/./src/public/app/widgets/note_title.js","webpack://trilium/./src/public/app/services/attribute_autocomplete.js","webpack://trilium/./src/public/app/widgets/attribute_widgets/attribute_detail.js","webpack://trilium/./src/public/app/services/attribute_parser.js","webpack://trilium/./src/public/app/widgets/attribute_widgets/attribute_editor.js","webpack://trilium/./src/public/app/widgets/ribbon_widgets/owned_attribute_list.js","webpack://trilium/./src/public/app/widgets/buttons/note_actions.js","webpack://trilium/./src/public/app/widgets/type_widgets/type_widget.js","webpack://trilium/./src/public/app/services/mime_types.js","webpack://trilium/./src/public/app/widgets/type_widgets/abstract_text_type_widget.js","webpack://trilium/./src/public/app/widgets/type_widgets/editable_text.js","webpack://trilium/./src/public/app/services/image.js","webpack://trilium/./src/public/app/widgets/type_widgets/relation_map.js","webpack://trilium/./src/public/app/services/debounce.js","webpack://trilium/./src/public/app/widgets/type_widgets/canvas.js","webpack://trilium/./src/public/app/widgets/note_map.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/options_widget.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/appearance/fonts.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/shortcuts.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/code_notes/code_mime_types.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/other/search_engine.js","webpack://trilium/./src/public/app/widgets/type_widgets/content/backend_log.js","webpack://trilium/./src/public/app/widgets/type_widgets/content_widget.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/appearance/theme.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/appearance/zoom_factor.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/appearance/native_title_bar.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/appearance/max_content_width.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/appearance/ribbon.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/text_notes/heading_style.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/text_notes/table_of_contents.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/text_notes/highlights_list.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/text_notes/text_auto_read_only_size.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/code_notes/vim_key_bindings.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/code_notes/wrap_lines.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/code_notes/code_auto_read_only_size.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/images/images.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/spellcheck.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/password.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/etapi.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/backup.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/sync.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/other/tray.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/other/note_erasure_timeout.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/other/attachment_erasure_timeout.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/other/revisions_snapshot_interval.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/other/network_connections.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/advanced/database_integrity_check.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/advanced/consistency_checks.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/advanced/database_anonymization.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/advanced/sync.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/advanced/vacuum_database.js","webpack://trilium/./src/public/app/widgets/buttons/attachments_actions.js","webpack://trilium/./src/public/app/widgets/attachment_detail.js","webpack://trilium/./src/public/app/widgets/note_detail.js","webpack://trilium/./src/public/app/widgets/type_widgets/empty.js","webpack://trilium/./src/public/app/widgets/type_widgets/read_only_text.js","webpack://trilium/./src/public/app/widgets/type_widgets/editable_code.js","webpack://trilium/./src/public/app/widgets/type_widgets/read_only_code.js","webpack://trilium/./src/public/app/widgets/type_widgets/file.js","webpack://trilium/./src/public/app/widgets/type_widgets/image.js","webpack://trilium/./src/public/app/widgets/type_widgets/none.js","webpack://trilium/./src/public/app/widgets/type_widgets/render.js","webpack://trilium/./src/public/app/widgets/type_widgets/protected_session.js","webpack://trilium/./src/public/app/widgets/type_widgets/book.js","webpack://trilium/./src/public/app/widgets/type_widgets/note_map.js","webpack://trilium/./src/public/app/widgets/type_widgets/web_view.js","webpack://trilium/./src/public/app/widgets/type_widgets/doc.js","webpack://trilium/./src/public/app/widgets/type_widgets/attachment_detail.js","webpack://trilium/./src/public/app/widgets/type_widgets/attachment_list.js","webpack://trilium/./src/public/app/widgets/containers/ribbon_container.js","webpack://trilium/./src/public/app/widgets/ribbon_widgets/promoted_attributes.js","webpack://trilium/./src/public/app/widgets/ribbon_widgets/inherited_attribute_list.js","webpack://trilium/./src/public/app/services/note_list_renderer.js","webpack://trilium/./src/public/app/widgets/note_list.js","webpack://trilium/./src/public/app/widgets/search_options/abstract_search_option.js","webpack://trilium/./src/public/app/widgets/bulk_actions/abstract_bulk_action.js","webpack://trilium/./src/public/app/widgets/bulk_actions/note/move_note.js","webpack://trilium/./src/public/app/widgets/bulk_actions/note/delete_note.js","webpack://trilium/./src/public/app/widgets/bulk_actions/note/delete_revisions.js","webpack://trilium/./src/public/app/widgets/bulk_actions/label/delete_label.js","webpack://trilium/./src/public/app/widgets/bulk_actions/relation/delete_relation.js","webpack://trilium/./src/public/app/widgets/bulk_actions/label/rename_label.js","webpack://trilium/./src/public/app/widgets/bulk_actions/relation/rename_relation.js","webpack://trilium/./src/public/app/widgets/bulk_actions/label/update_label_value.js","webpack://trilium/./src/public/app/widgets/bulk_actions/relation/update_relation_target.js","webpack://trilium/./src/public/app/widgets/bulk_actions/execute_script.js","webpack://trilium/./src/public/app/widgets/bulk_actions/label/add_label.js","webpack://trilium/./src/public/app/widgets/bulk_actions/relation/add_relation.js","webpack://trilium/./src/public/app/widgets/bulk_actions/note/rename_note.js","webpack://trilium/./src/public/app/services/bulk_action.js","webpack://trilium/./src/public/app/widgets/ribbon_widgets/search_definition.js","webpack://trilium/./src/public/app/widgets/search_options/search_string.js","webpack://trilium/./src/public/app/widgets/search_options/search_script.js","webpack://trilium/./src/public/app/widgets/search_options/ancestor.js","webpack://trilium/./src/public/app/widgets/search_options/fast_search.js","webpack://trilium/./src/public/app/widgets/search_options/include_archived_notes.js","webpack://trilium/./src/public/app/widgets/search_options/order_by.js","webpack://trilium/./src/public/app/widgets/search_options/limit.js","webpack://trilium/./src/public/app/widgets/search_options/debug.js","webpack://trilium/./src/public/app/widgets/sql_result.js","webpack://trilium/./src/public/app/widgets/sql_table_schemas.js","webpack://trilium/./src/public/app/widgets/ribbon_widgets/file_properties.js","webpack://trilium/./src/public/app/widgets/ribbon_widgets/image_properties.js","webpack://trilium/./src/public/app/widgets/ribbon_widgets/note_properties.js","webpack://trilium/./src/public/app/widgets/note_icon.js","webpack://trilium/./src/public/app/widgets/search_result.js","webpack://trilium/./src/public/app/widgets/containers/scrolling_container.js","webpack://trilium/./src/public/app/widgets/containers/root_container.js","webpack://trilium/./src/public/app/services/file_watcher.js","webpack://trilium/./src/public/app/widgets/watched_file_update_status.js","webpack://trilium/./src/public/app/widgets/spacer.js","webpack://trilium/./src/public/app/widgets/quick_search.js","webpack://trilium/./src/public/app/widgets/containers/split_note_container.js","webpack://trilium/./src/public/app/services/resizer.js","webpack://trilium/./src/public/app/widgets/buttons/abstract_button.js","webpack://trilium/./src/public/app/widgets/buttons/command_button.js","webpack://trilium/./src/public/app/widgets/buttons/left_pane_toggle.js","webpack://trilium/./src/public/app/widgets/buttons/onclick_button.js","webpack://trilium/./src/public/app/widgets/buttons/create_pane_button.js","webpack://trilium/./src/public/app/widgets/buttons/close_pane_button.js","webpack://trilium/./src/public/app/widgets/note_type.js","webpack://trilium/./src/public/app/widgets/switch.js","webpack://trilium/./src/public/app/widgets/protected_note_switch.js","webpack://trilium/./src/public/app/widgets/editability_select.js","webpack://trilium/./src/public/app/widgets/bookmark_switch.js","webpack://trilium/./src/public/app/services/sync.js","webpack://trilium/./src/public/app/widgets/shared_switch.js","webpack://trilium/./src/public/app/widgets/ribbon_widgets/basic_properties.js","webpack://trilium/./src/public/app/widgets/ribbon_widgets/note_info_widget.js","webpack://trilium/./src/public/app/widgets/ribbon_widgets/book_properties.js","webpack://trilium/./src/public/app/widgets/ribbon_widgets/note_map.js","webpack://trilium/./src/public/app/widgets/ribbon_widgets/note_paths.js","webpack://trilium/./src/public/app/widgets/ribbon_widgets/similar_notes.js","webpack://trilium/./src/public/app/widgets/containers/right_pane_container.js","webpack://trilium/./src/public/app/widgets/buttons/edit_button.js","webpack://trilium/./src/public/app/widgets/ribbon_widgets/edited_notes.js","webpack://trilium/./src/public/app/widgets/mermaid.js","webpack://trilium/./src/public/app/widgets/note_wrapper.js","webpack://trilium/./src/public/app/widgets/floating_buttons/zpetne_odkazy.js","webpack://trilium/./src/public/app/widgets/shared_info.js","webpack://trilium/./src/public/app/widgets/find_in_text.js","webpack://trilium/./src/public/app/widgets/find_in_code.js","webpack://trilium/./src/public/app/widgets/find_in_html.js","webpack://trilium/./src/public/app/widgets/find.js","webpack://trilium/./src/public/app/widgets/toc.js","webpack://trilium/./src/public/app/widgets/highlights_list.js","webpack://trilium/./src/public/app/widgets/dialogs/bulk_actions.js","webpack://trilium/./src/public/app/widgets/dialogs/about.js","webpack://trilium/./src/public/app/widgets/dialogs/help.js","webpack://trilium/./src/public/app/widgets/dialogs/recent_changes.js","webpack://trilium/./src/public/app/widgets/dialogs/branch_prefix.js","webpack://trilium/./src/public/app/widgets/dialogs/sort_child_notes.js","webpack://trilium/./src/public/app/widgets/dialogs/password_not_set.js","webpack://trilium/./src/public/app/widgets/dialogs/include_note.js","webpack://trilium/./src/public/app/widgets/dialogs/note_type_chooser.js","webpack://trilium/./src/public/app/widgets/dialogs/jump_to_note.js","webpack://trilium/./src/public/app/widgets/dialogs/add_link.js","webpack://trilium/./src/public/app/widgets/dialogs/clone_to.js","webpack://trilium/./src/public/app/widgets/dialogs/move_to.js","webpack://trilium/./src/public/app/widgets/dialogs/import.js","webpack://trilium/./src/public/app/widgets/dialogs/export.js","webpack://trilium/./src/public/app/widgets/dialogs/markdown_import.js","webpack://trilium/./src/public/app/widgets/dialogs/protected_session_password.js","webpack://trilium/./src/public/app/widgets/dialogs/revisions.js","webpack://trilium/./src/public/app/widgets/dialogs/delete_notes.js","webpack://trilium/./src/public/app/widgets/dialogs/info.js","webpack://trilium/./src/public/app/widgets/dialogs/confirm.js","webpack://trilium/./src/public/app/widgets/dialogs/prompt.js","webpack://trilium/./src/public/app/widgets/floating_buttons/floating_buttons.js","webpack://trilium/./src/public/app/widgets/floating_buttons/relation_map_buttons.js","webpack://trilium/./src/public/app/widgets/floating_buttons/mermaid_export_button.js","webpack://trilium/./src/public/app/widgets/buttons/right_dropdown_button.js","webpack://trilium/./src/public/app/widgets/buttons/calendar.js","webpack://trilium/./src/public/app/widgets/buttons/open_note_button_widget.js","webpack://trilium/./src/public/app/widgets/buttons/bookmark_folder.js","webpack://trilium/./src/public/app/widgets/bookmark_buttons.js","webpack://trilium/./src/public/app/widgets/buttons/protected_session_status.js","webpack://trilium/./src/public/app/widgets/sync_status.js","webpack://trilium/./src/public/app/widgets/buttons/launcher/abstract_launcher.js","webpack://trilium/./src/public/app/widgets/buttons/launcher/note_launcher.js","webpack://trilium/./src/public/app/widgets/buttons/launcher/script_launcher.js","webpack://trilium/./src/public/app/widgets/buttons/launcher/today_launcher.js","webpack://trilium/./src/public/app/widgets/buttons/button_from_note.js","webpack://trilium/./src/public/app/widgets/buttons/history_navigation.js","webpack://trilium/./src/public/app/widgets/containers/launcher.js","webpack://trilium/./src/public/app/widgets/containers/launcher_container.js","webpack://trilium/./src/public/app/widgets/buttons/revisions_button.js","webpack://trilium/./src/public/app/widgets/floating_buttons/code_buttons.js","webpack://trilium/./src/public/app/widgets/api_log.js","webpack://trilium/./src/public/app/widgets/floating_buttons/hide_floating_buttons_button.js","webpack://trilium/./src/public/app/widgets/ribbon_widgets/script_executor.js","webpack://trilium/./src/public/app/widgets/buttons/move_pane_button.js","webpack://trilium/./src/public/app/widgets/dialogs/upload_attachments.js","webpack://trilium/./src/public/app/widgets/floating_buttons/copy_image_reference_button.js","webpack://trilium/./src/public/app/widgets/scroll_padding.js","webpack://trilium/./src/public/app/layouts/desktop_layout.js","webpack://trilium/./src/public/app/services/glob.js","webpack://trilium/./src/public/app/desktop.js"],"sourcesContent":["import Component from \"./component.js\";\nimport appContext from \"./app_context.js\";\nimport dateNoteService from \"../services/date_notes.js\";\nimport treeService from \"../services/tree.js\";\nimport openService from \"../services/open.js\";\nimport protectedSessionService from \"../services/protected_session.js\";\nimport options from \"../services/options.js\";\nimport froca from \"../services/froca.js\";\nimport utils from \"../services/utils.js\";\n\nexport default class RootCommandExecutor extends Component {\n    editReadOnlyNoteCommand() {\n        const noteContext = appContext.tabManager.getActiveContext();\n        noteContext.viewScope.readOnlyTemporarilyDisabled = true;\n\n        appContext.triggerEvent(\"readOnlyTemporarilyDisabled\", { noteContext });\n    }\n\n    async showSQLConsoleCommand() {\n        const sqlConsoleNote = await dateNoteService.createSqlConsole();\n\n        const noteContext = await appContext.tabManager.openTabWithNoteWithHoisting(sqlConsoleNote.noteId, { activate: true });\n\n        appContext.triggerEvent('focusOnDetail', {ntxId: noteContext.ntxId});\n    }\n\n    async searchNotesCommand({searchString, ancestorNoteId}) {\n        const searchNote = await dateNoteService.createSearchNote({searchString, ancestorNoteId});\n\n        // force immediate search\n        await froca.loadSearchNote(searchNote.noteId);\n\n        const noteContext = await appContext.tabManager.openTabWithNoteWithHoisting(searchNote.noteId, {\n            activate: true\n        });\n\n        appContext.triggerCommand('focusOnSearchDefinition', {ntxId: noteContext.ntxId});\n    }\n\n    async searchInSubtreeCommand({notePath}) {\n        const noteId = treeService.getNoteIdFromUrl(notePath);\n\n        this.searchNotesCommand({ancestorNoteId: noteId});\n    }\n\n    openNoteExternallyCommand() {\n        const noteId = appContext.tabManager.getActiveContextNoteId();\n        const mime = appContext.tabManager.getActiveContextNoteMime();\n        if (noteId) {\n            openService.openNoteExternally(noteId, mime);\n        }\n    }\n\n    openNoteCustomCommand() {\n        const noteId = appContext.tabManager.getActiveContextNoteId();\n        const mime = appContext.tabManager.getActiveContextNoteMime();\n        if (noteId) {\n            openService.openNoteCustom(noteId, mime);\n        }\n    }\n\n    enterProtectedSessionCommand() {\n        protectedSessionService.enterProtectedSession();\n    }\n\n    leaveProtectedSessionCommand() {\n        protectedSessionService.leaveProtectedSession();\n    }\n\n    hideLeftPaneCommand() {\n        options.save(`leftPaneVisible`, \"false\");\n    }\n\n    showLeftPaneCommand() {\n        options.save(`leftPaneVisible`, \"true\");\n    }\n\n    toggleLeftPaneCommand() {\n        options.toggle('leftPaneVisible');\n    }\n\n    async showBackendLogCommand() {\n        await appContext.tabManager.openTabWithNoteWithHoisting('_backendLog', { activate: true });\n    }\n\n    async showLaunchBarSubtreeCommand() {\n        await this.showAndHoistSubtree('_lbRoot');\n    }\n\n    async showShareSubtreeCommand() {\n        await this.showAndHoistSubtree('_share');\n    }\n\n    async showHiddenSubtreeCommand() {\n        await this.showAndHoistSubtree('_hidden');\n    }\n\n    async showOptionsCommand({section}) {\n        await appContext.tabManager.openContextWithNote(section || '_options', {\n            activate: true,\n            hoistedNoteId: '_options'\n        });\n    }\n\n    async showSQLConsoleHistoryCommand() {\n        await this.showAndHoistSubtree('_sqlConsole');\n    }\n\n    async showSearchHistoryCommand() {\n        await this.showAndHoistSubtree('_search');\n    }\n\n    async showAndHoistSubtree(subtreeNoteId) {\n        await appContext.tabManager.openContextWithNote(subtreeNoteId, {\n            activate: true,\n            hoistedNoteId: subtreeNoteId\n        });\n    }\n\n    async showNoteSourceCommand() {\n        const notePath = appContext.tabManager.getActiveContextNotePath();\n\n        if (notePath) {\n            await appContext.tabManager.openTabWithNoteWithHoisting(notePath, {\n                activate: true,\n                viewScope: {\n                    viewMode: 'source'\n                }\n            });\n        }\n    }\n\n    async showAttachmentsCommand() {\n        const notePath = appContext.tabManager.getActiveContextNotePath();\n\n        if (notePath) {\n            await appContext.tabManager.openTabWithNoteWithHoisting(notePath, {\n                activate: true,\n                viewScope: {\n                    viewMode: 'attachments'\n                }\n            });\n        }\n    }\n\n    async showAttachmentDetailCommand() {\n        const notePath = appContext.tabManager.getActiveContextNotePath();\n\n        if (notePath) {\n            await appContext.tabManager.openTabWithNoteWithHoisting(notePath, {\n                activate: true,\n                viewScope: {\n                    viewMode: 'attachments'\n                }\n            });\n        }\n    }\n\n    toggleTrayCommand() {\n        if (!utils.isElectron()) return;\n        const {BrowserWindow} = utils.dynamicRequire('@electron/remote');\n        const windows = BrowserWindow.getAllWindows();\n        const isVisible = windows.every(w => w.isVisible());\n        const action = isVisible ? \"hide\" : \"show\"\n        for (const window of windows) window[action]();\n    }\n\n    firstTabCommand()   { this.#goToTab(1); }\n    secondTabCommand()  { this.#goToTab(2); }\n    thirdTabCommand()   { this.#goToTab(3); }\n    fourthTabCommand()  { this.#goToTab(4); }\n    fifthTabCommand()   { this.#goToTab(5); }\n    sixthTabCommand()   { this.#goToTab(6); }\n    seventhTabCommand() { this.#goToTab(7); }\n    eigthTabCommand()   { this.#goToTab(8); }\n    ninthTabCommand()   { this.#goToTab(9); }\n    lastTabCommand()    { this.#goToTab(Number.POSITIVE_INFINITY); }\n\n    #goToTab(tabNumber) {\n        const mainNoteContexts = appContext.tabManager.getMainNoteContexts();\n\n        const index = tabNumber === Number.POSITIVE_INFINITY ? mainNoteContexts.length - 1 : tabNumber - 1;\n        const tab = mainNoteContexts[index];\n\n        if (tab) {\n            appContext.tabManager.activateNoteContext(tab.ntxId);\n        }\n    }\n}\n","import utils from \"../services/utils.js\";\nimport dateNoteService from \"../services/date_notes.js\";\nimport protectedSessionHolder from '../services/protected_session_holder.js';\nimport server from \"../services/server.js\";\nimport appContext from \"./app_context.js\";\nimport Component from \"./component.js\";\nimport toastService from \"../services/toast.js\";\nimport ws from \"../services/ws.js\";\nimport bundleService from \"../services/bundle.js\";\nimport froca from \"../services/froca.js\";\nimport linkService from \"../services/link.js\";\n\nexport default class Entrypoints extends Component {\n    constructor() {\n        super();\n\n        if (jQuery.hotkeys) {\n            // hot keys are active also inside inputs and content editables\n            jQuery.hotkeys.options.filterInputAcceptingElements = false;\n            jQuery.hotkeys.options.filterContentEditable = false;\n            jQuery.hotkeys.options.filterTextInputs = false;\n        }\n    }\n\n    openDevToolsCommand() {\n        if (utils.isElectron()) {\n            utils.dynamicRequire('@electron/remote').getCurrentWindow().toggleDevTools();\n        }\n    }\n\n    async createNoteIntoInboxCommand() {\n        const inboxNote = await dateNoteService.getInboxNote();\n\n        const {note} = await server.post(`notes/${inboxNote.noteId}/children?target=into`, {\n            content: '',\n            type: 'text',\n            isProtected: inboxNote.isProtected && protectedSessionHolder.isProtectedSessionAvailable()\n        });\n\n        await ws.waitForMaxKnownEntityChangeId();\n\n        await appContext.tabManager.openTabWithNoteWithHoisting(note.noteId, {activate: true});\n\n        appContext.triggerEvent('focusAndSelectTitle', {isNewNote: true});\n    }\n\n    async toggleNoteHoistingCommand({noteId = appContext.tabManager.getActiveContextNoteId()}) {\n        const noteToHoist = await froca.getNote(noteId);\n        const activeNoteContext = appContext.tabManager.getActiveContext();\n\n        if (noteToHoist.noteId === activeNoteContext.hoistedNoteId) {\n            await activeNoteContext.unhoist();\n        }\n        else if (noteToHoist.type !== 'search') {\n            await activeNoteContext.setHoistedNoteId(noteId);\n        }\n    }\n\n    async hoistNoteCommand({noteId}) {\n        const noteContext = appContext.tabManager.getActiveContext();\n\n        if (noteContext.hoistedNoteId !== noteId) {\n            await noteContext.setHoistedNoteId(noteId);\n        }\n    }\n\n    async unhoistCommand() {\n        const activeNoteContext = appContext.tabManager.getActiveContext();\n\n        if (activeNoteContext) {\n            activeNoteContext.unhoist();\n        }\n    }\n\n    copyWithoutFormattingCommand() {\n        utils.copySelectionToClipboard();\n    }\n\n    toggleFullscreenCommand() {\n        if (utils.isElectron()) {\n            const win = utils.dynamicRequire('@electron/remote').getCurrentWindow();\n\n            if (win.isFullScreenable()) {\n                win.setFullScreen(!win.isFullScreen());\n            }\n        } // outside of electron this is handled by the browser\n    }\n\n    reloadFrontendAppCommand() {\n        utils.reloadFrontendApp();\n    }\n\n    logoutCommand() {\n        const $logoutForm = $('<form action=\"logout\" method=\"POST\">')\n            .append($(`<input type='_hidden' name=\"_csrf\" value=\"${glob.csrfToken}\"/>`));\n\n        $(\"body\").append($logoutForm);\n        $logoutForm.trigger('submit');\n    }\n\n    backInNoteHistoryCommand() {\n        if (utils.isElectron()) {\n            // standard JS version does not work completely correctly in electron\n            const webContents = utils.dynamicRequire('@electron/remote').getCurrentWebContents();\n            const activeIndex = parseInt(webContents.getActiveIndex());\n\n            webContents.goToIndex(activeIndex - 1);\n        }\n        else {\n            window.history.back();\n        }\n    }\n\n    forwardInNoteHistoryCommand() {\n        if (utils.isElectron()) {\n            // standard JS version does not work completely correctly in electron\n            const webContents = utils.dynamicRequire('@electron/remote').getCurrentWebContents();\n            const activeIndex = parseInt(webContents.getActiveIndex());\n\n            webContents.goToIndex(activeIndex + 1);\n        }\n        else {\n            window.history.forward();\n        }\n    }\n\n    async switchToDesktopVersionCommand() {\n        utils.setCookie('trilium-device', 'desktop');\n\n        utils.reloadFrontendApp(\"正在切换到桌面版\");\n    }\n\n    async switchToMobileVersionCommand() {\n        utils.setCookie('trilium-device', 'mobile');\n\n        utils.reloadFrontendApp(\"正在切换到移动版\");\n    }\n\n    async openInWindowCommand({notePath, hoistedNoteId, viewScope}) {\n        const extraWindowHash = linkService.calculateHash({notePath, hoistedNoteId, viewScope});\n\n        if (utils.isElectron()) {\n            const {ipcRenderer} = utils.dynamicRequire('electron');\n\n            ipcRenderer.send('create-extra-window', { extraWindowHash });\n        }\n        else {\n            const url = `${window.location.protocol}//${window.location.host}${window.location.pathname}?extraWindow=1${extraWindowHash}`;\n\n            window.open(url, '', 'width=1000,height=800');\n        }\n    }\n\n    async openNewWindowCommand() {\n        this.openInWindowCommand({notePath: '', hoistedNoteId: 'root'});\n    }\n\n    async runActiveNoteCommand() {\n        const {ntxId, note} = appContext.tabManager.getActiveContext();\n\n        // ctrl+enter is also used elsewhere, so make sure we're running only when appropriate\n        if (!note || note.type !== 'code') {\n            return;\n        }\n\n        // TODO: use note.executeScript()\n        if (note.mime.endsWith(\"env=frontend\")) {\n            await bundleService.getAndExecuteBundle(note.noteId);\n        } else if (note.mime.endsWith(\"env=backend\")) {\n            await server.post(`script/run/${note.noteId}`);\n        } else if (note.mime === 'text/x-sqlite;schema=trilium') {\n            const resp = await server.post(`sql/execute/${note.noteId}`);\n\n            if (!resp.success) {\n                toastService.showError(`Error occurred while executing SQL query: ${resp.error}`);\n            }\n\n            await appContext.triggerEvent('sqlQueryResults', {ntxId: ntxId, results: resp.results});\n        }\n\n        toastService.showMessage(\"笔记已执行\");\n    }\n\n    hideAllPopups() {\n        if (utils.isDesktop()) {\n            $(\".aa-input\").autocomplete(\"close\");\n        }\n    }\n\n    noteSwitchedEvent() {\n        this.hideAllPopups();\n    }\n\n    activeContextChangedEvent() {\n        this.hideAllPopups();\n    }\n\n    async forceSaveRevisionCommand() {\n        const noteId = appContext.tabManager.getActiveContextNoteId();\n\n        await server.post(`notes/${noteId}/revision`);\n\n        toastService.showMessage(\"笔记历史已创建\");\n    }\n}\n","import protectedSessionHolder from \"../services/protected_session_holder.js\";\nimport server from \"../services/server.js\";\nimport utils from \"../services/utils.js\";\nimport appContext from \"./app_context.js\";\nimport treeService from \"../services/tree.js\";\nimport Component from \"./component.js\";\nimport froca from \"../services/froca.js\";\nimport hoistedNoteService from \"../services/hoisted_note.js\";\nimport options from \"../services/options.js\";\n\nclass NoteContext extends Component {\n    constructor(ntxId = null, hoistedNoteId = 'root', mainNtxId = null) {\n        super();\n\n        this.ntxId = ntxId || this.constructor.generateNtxId();\n        this.hoistedNoteId = hoistedNoteId;\n        this.mainNtxId = mainNtxId;\n\n        this.resetViewScope();\n    }\n\n    static generateNtxId() {\n        return utils.randomString(6);\n    }\n\n    setEmpty() {\n        this.notePath = null;\n        this.noteId = null;\n        this.parentNoteId = null;\n        // hoisted note is kept intentionally\n\n        this.triggerEvent('noteSwitched', {\n            noteContext: this,\n            notePath: this.notePath\n        });\n\n        this.resetViewScope();\n    }\n\n    isEmpty() {\n        return !this.noteId;\n    }\n\n    async setNote(inputNotePath, opts = {}) {\n        opts.triggerSwitchEvent = opts.triggerSwitchEvent !== undefined ? opts.triggerSwitchEvent : true;\n        opts.viewScope = opts.viewScope || {};\n        opts.viewScope.viewMode = opts.viewScope.viewMode || \"default\";\n\n        const resolvedNotePath = await this.getResolvedNotePath(inputNotePath);\n\n        if (!resolvedNotePath) {\n            return;\n        }\n\n        if (this.notePath === resolvedNotePath && utils.areObjectsEqual(this.viewScope, opts.viewScope)) {\n            return;\n        }\n\n        await this.triggerEvent('beforeNoteSwitch', {noteContext: this});\n\n        utils.closeActiveDialog();\n\n        this.notePath = resolvedNotePath;\n        this.viewScope = opts.viewScope;\n        ({noteId: this.noteId, parentNoteId: this.parentNoteId} = treeService.getNoteIdAndParentIdFromUrl(resolvedNotePath));\n\n        this.saveToRecentNotes(resolvedNotePath);\n\n        protectedSessionHolder.touchProtectedSessionIfNecessary(this.note);\n\n        if (opts.triggerSwitchEvent) {\n            await this.triggerEvent('noteSwitched', {\n                noteContext: this,\n                notePath: this.notePath\n            });\n        }\n\n        await this.setHoistedNoteIfNeeded();\n\n        if (utils.isMobile()) {\n            this.triggerCommand('setActiveScreen', {screen: 'detail'});\n        }\n    }\n\n    async setHoistedNoteIfNeeded() {\n        if (this.hoistedNoteId === 'root'\n            && this.notePath.startsWith(\"root/_hidden\")\n            && !this.note.isLabelTruthy(\"keepCurrentHoisting\")\n        ) {\n            // hidden subtree displays only when hoisted, so it doesn't make sense to keep root as hoisted note\n\n            let hoistedNoteId = '_hidden';\n\n            if (this.note.isLaunchBarConfig()) {\n                hoistedNoteId = '_lbRoot';\n            } else if (this.note.isOptions()) {\n                hoistedNoteId = '_options';\n            }\n\n            await this.setHoistedNoteId(hoistedNoteId);\n        }\n    }\n\n    getSubContexts() {\n        return appContext.tabManager.noteContexts.filter(nc => nc.ntxId === this.ntxId || nc.mainNtxId === this.ntxId);\n    }\n\n    /**\n     * A main context represents a tab and also the first split. Further splits are the children contexts of the main context.\n     * Imagine you have a tab with 3 splits, each showing notes A, B, C (in this order).\n     * In such a scenario, A context is the main context (also representing the tab as a whole), and B, C are the children\n     * of context A.\n     *\n     * @returns {boolean} true if the context is main (= tab)\n     */\n    isMainContext() {\n        // if null, then this is a main context\n        return !this.mainNtxId;\n    }\n\n    /**\n     * See docs for isMainContext() for better explanation.\n     *\n     * @returns {NoteContext}\n     */\n    getMainContext() {\n        if (this.mainNtxId) {\n            try {\n                return appContext.tabManager.getNoteContextById(this.mainNtxId);\n            }\n            catch (e) {\n                this.mainNtxId = null;\n                return this;\n            }\n        }\n        else {\n            return this;\n        }\n    }\n\n    saveToRecentNotes(resolvedNotePath) {\n        setTimeout(async () => {\n            // we include the note in the recent list only if the user stayed on the note at least 5 seconds\n            if (resolvedNotePath && resolvedNotePath === this.notePath) {\n                await server.post('recent-notes', {\n                    noteId: this.note.noteId,\n                    notePath: this.notePath\n                });\n            }\n        }, 5000);\n    }\n\n    async getResolvedNotePath(inputNotePath) {\n        const resolvedNotePath = await treeService.resolveNotePath(inputNotePath, this.hoistedNoteId);\n\n        if (!resolvedNotePath) {\n            logError(`Cannot resolve note path ${inputNotePath}`);\n            return;\n        }\n\n        if (await hoistedNoteService.checkNoteAccess(resolvedNotePath, this) === false) {\n            return; // note is outside of hoisted subtree and user chose not to unhoist\n        }\n\n        return resolvedNotePath;\n    }\n\n    /** @returns {FNote} */\n    get note() {\n        if (!this.noteId || !(this.noteId in froca.notes)) {\n            return null;\n        }\n\n        return froca.notes[this.noteId];\n    }\n\n    /** @returns {string[]} */\n    get notePathArray() {\n        return this.notePath ? this.notePath.split('/') : [];\n    }\n\n    isActive() {\n        return appContext.tabManager.activeNtxId === this.ntxId;\n    }\n\n    getPojoState() {\n        if (this.hoistedNoteId !== 'root') {\n            // keeping empty hoisted tab is esp. important for mobile (e.g. opened launcher config)\n\n            if (!this.notePath && this.getSubContexts().length === 0) {\n                return null;\n            }\n        }\n\n        return {\n            ntxId: this.ntxId,\n            mainNtxId: this.mainNtxId,\n            notePath: this.notePath,\n            hoistedNoteId: this.hoistedNoteId,\n            active: this.isActive(),\n            viewScope: this.viewScope\n        }\n    }\n\n    async unhoist() {\n        await this.setHoistedNoteId('root');\n    }\n\n    async setHoistedNoteId(noteIdToHoist) {\n        if (this.hoistedNoteId === noteIdToHoist) {\n            return;\n        }\n\n        this.hoistedNoteId = noteIdToHoist;\n\n        if (!this.notePathArray?.includes(noteIdToHoist) && !utils.isMobile()) {\n            await this.setNote(noteIdToHoist);\n        }\n\n        await this.triggerEvent('hoistedNoteChanged', {\n            noteId: noteIdToHoist,\n            ntxId: this.ntxId\n        });\n    }\n\n    /** @returns {Promise<boolean>} */\n    async isReadOnly() {\n        if (this.viewScope.readOnlyTemporarilyDisabled) {\n            return false;\n        }\n\n        // \"readOnly\" is a state valid only for text/code notes\n        if (!this.note || (this.note.type !== 'text' && this.note.type !== 'code')) {\n            return false;\n        }\n\n        if (this.note.isLabelTruthy('readOnly')) {\n            return true;\n        }\n\n        if (this.viewScope.viewMode === 'source') {\n            return true;\n        }\n\n        const blob = await this.note.getBlob();\n\n        const sizeLimit = this.note.type === 'text'\n            ? options.getInt('autoReadonlySizeText')\n            : options.getInt('autoReadonlySizeCode');\n\n        return blob.contentLength > sizeLimit\n            && !this.note.isLabelTruthy('autoReadOnlyDisabled');\n    }\n\n    async entitiesReloadedEvent({loadResults}) {\n        if (loadResults.isNoteReloaded(this.noteId)) {\n            const noteRow = loadResults.getEntityRow('notes', this.noteId);\n\n            if (noteRow.isDeleted) {\n                this.noteId = null;\n                this.notePath = null;\n\n                this.triggerEvent('noteSwitched', {\n                    noteContext: this,\n                    notePath: this.notePath\n                });\n            }\n        }\n    }\n\n    hasNoteList() {\n        return this.note\n            && this.viewScope.viewMode === 'default'\n            && this.note.hasChildren()\n            && ['book', 'text', 'code'].includes(this.note.type)\n            && this.note.mime !== 'text/x-sqlite;schema=trilium'\n            && !this.note.isLabelTruthy('hideChildrenOverview');\n    }\n\n    async getTextEditor(callback) {\n        return this.timeout(new Promise(resolve => appContext.triggerCommand('executeWithTextEditor', {\n            callback,\n            resolve,\n            ntxId: this.ntxId\n        })));\n    }\n\n    async getCodeEditor() {\n        return this.timeout(new Promise(resolve => appContext.triggerCommand('executeWithCodeEditor', {\n            resolve,\n            ntxId: this.ntxId\n        })));\n    }\n\n    async getContentElement() {\n        return this.timeout(new Promise(resolve => appContext.triggerCommand('executeWithContentElement', {\n            resolve,\n            ntxId: this.ntxId\n        })));\n    }\n\n    async getTypeWidget() {\n        return this.timeout(new Promise(resolve => appContext.triggerCommand('executeWithTypeWidget', {\n            resolve,\n            ntxId: this.ntxId\n        })));\n    }\n\n    timeout(promise) {\n        return Promise.race([\n            promise,\n            new Promise(res => setTimeout(() => res(null), 200))\n        ]);\n    }\n\n    resetViewScope() {\n        // view scope contains data specific to one note context and one \"view\".\n        // it is used to e.g., make read-only note temporarily editable or to hide TOC\n        // this is reset after navigating to a different note\n        this.viewScope = {};\n    }\n\n    async getNavigationTitle() {\n        if (!this.note) {\n            return null;\n        }\n\n        const { note, viewScope } = this;\n\n        let title = viewScope.viewMode === 'default'\n            ? note.title\n            : `${note.title}: ${viewScope.viewMode}`;\n\n        if (viewScope.attachmentId) {\n            // assuming the attachment has been already loaded\n            const attachment = await note.getAttachmentById(viewScope.attachmentId);\n\n            if (attachment) {\n                title += `: ${attachment.title}`;\n            }\n        }\n\n        return title;\n    }\n}\n\nexport default NoteContext;\n","export default class Mutex {\n    constructor() {\n        this.current = Promise.resolve();\n    }\n\n    /** @returns {Promise} */\n    lock() {\n        let resolveFun;\n        const subPromise = new Promise(resolve => resolveFun = () => resolve());\n        // Caller gets a promise that resolves when the current outstanding lock resolves\n        const newPromise = this.current.then(() => resolveFun);\n        // Don't allow the next request until the new promise is done\n        this.current = subPromise;\n        // Return the new promise\n        return newPromise;\n    };\n\n    async runExclusively(cb) {\n        const unlock = await this.lock();\n\n        try {\n            return await cb();\n        }\n        finally {\n            unlock();\n        }\n    }\n}\n","import Component from \"./component.js\";\nimport SpacedUpdate from \"../services/spaced_update.js\";\nimport server from \"../services/server.js\";\nimport options from \"../services/options.js\";\nimport froca from \"../services/froca.js\";\nimport treeService from \"../services/tree.js\";\nimport utils from \"../services/utils.js\";\nimport NoteContext from \"./note_context.js\";\nimport appContext from \"./app_context.js\";\nimport Mutex from \"../utils/mutex.js\";\nimport linkService from \"../services/link.js\";\n\nexport default class TabManager extends Component {\n    constructor() {\n        super();\n\n        /** @property {NoteContext[]} */\n        this.children = [];\n        this.mutex = new Mutex();\n\n        this.activeNtxId = null;\n\n        // elements are arrays of {contexts, position}, storing note contexts for each tab (one main context + subcontexts [splits]), and the original position of the tab\n        this.recentlyClosedTabs = [];\n\n        this.tabsUpdate = new SpacedUpdate(async () => {\n            if (!appContext.isMainWindow) {\n                return;\n            }\n\n            const openNoteContexts = this.noteContexts\n                .map(nc => nc.getPojoState())\n                .filter(t => !!t);\n\n            await server.put('options', {\n                openNoteContexts: JSON.stringify(openNoteContexts)\n            });\n        });\n\n        appContext.addBeforeUnloadListener(this);\n    }\n\n    /** @returns {NoteContext[]} */\n    get noteContexts() {\n        return this.children;\n    }\n\n    /** @type {NoteContext[]} */\n    get mainNoteContexts() {\n        return this.noteContexts.filter(nc => !nc.mainNtxId)\n    }\n\n    async loadTabs() {\n        try {\n            const noteContextsToOpen = (appContext.isMainWindow && options.getJson('openNoteContexts')) || [];\n\n            // preload all notes at once\n            await froca.getNotes([\n                    ...noteContextsToOpen.flatMap(tab =>\n                        [ treeService.getNoteIdFromUrl(tab.notePath), tab.hoistedNoteId]\n                    ),\n            ], true);\n\n            const filteredNoteContexts = noteContextsToOpen.filter(openTab => {\n                if (utils.isMobile()) { // mobile frontend doesn't have tabs so show only the active tab\n                    return !!openTab.active;\n                }\n\n                const noteId = treeService.getNoteIdFromUrl(openTab.notePath);\n                if (!(noteId in froca.notes)) {\n                    // note doesn't exist so don't try to open tab for it\n                    return false;\n                }\n\n                if (!(openTab.hoistedNoteId in froca.notes)) {\n                    openTab.hoistedNoteId = 'root';\n                }\n\n                return true;\n            });\n\n            // resolve before opened tabs can change this\n            const parsedFromUrl = linkService.parseNavigationStateFromUrl(window.location.href);\n\n            if (filteredNoteContexts.length === 0) {\n                parsedFromUrl.ntxId = parsedFromUrl.ntxId || NoteContext.generateNtxId(); // generate already here, so that we later know which one to activate\n\n                filteredNoteContexts.push({\n                    notePath: parsedFromUrl.notePath || 'root',\n                    ntxId: parsedFromUrl.ntxId,\n                    active: true,\n                    hoistedNoteId: parsedFromUrl.hoistedNoteId || 'root',\n                    viewScope: parsedFromUrl.viewScope || {}\n                });\n            } else if (!filteredNoteContexts.find(tab => tab.active)) {\n                filteredNoteContexts[0].active = true;\n            }\n\n            await this.tabsUpdate.allowUpdateWithoutChange(async () => {\n                for (const tab of filteredNoteContexts) {\n                    await this.openContextWithNote(tab.notePath, {\n                        activate: tab.active,\n                        ntxId: tab.ntxId,\n                        mainNtxId: tab.mainNtxId,\n                        hoistedNoteId: tab.hoistedNoteId,\n                        viewScope: tab.viewScope\n                    });\n                }\n            });\n\n            // if there's a notePath in the URL, make sure it's open and active\n            // (useful, for e.g., opening clipped notes from clipper or opening link in an extra window)\n            if (parsedFromUrl.notePath) {\n                await appContext.tabManager.switchToNoteContext(\n                    parsedFromUrl.ntxId,\n                    parsedFromUrl.notePath,\n                    parsedFromUrl.viewScope,\n                    parsedFromUrl.hoistedNoteId\n                );\n            } else if (parsedFromUrl.searchString) {\n                await appContext.triggerCommand('searchNotes', {\n                    searchString: parsedFromUrl.searchString\n                });\n            }\n        }\n        catch (e) {\n            logError(`Loading note contexts '${options.get('openNoteContexts')}' failed: ${e.message} ${e.stack}`);\n\n            // try to recover\n            await this.openEmptyTab();\n        }\n    }\n\n    noteSwitchedEvent({noteContext}) {\n        if (noteContext.isActive()) {\n            this.setCurrentNavigationStateToHash();\n        }\n\n        this.tabsUpdate.scheduleUpdate();\n    }\n\n    setCurrentNavigationStateToHash() {\n        const calculatedHash = this.calculateHash();\n\n        // update if it's the first history entry or there has been a change\n        if (window.history.length === 0 || calculatedHash !== window.location?.hash) {\n            // using pushState instead of directly modifying document.location because it does not trigger hashchange\n            window.history.pushState(null, \"\", calculatedHash);\n        }\n\n        const activeNoteContext = this.getActiveContext();\n        this.updateDocumentTitle(activeNoteContext);\n\n        this.triggerEvent('activeNoteChanged'); // trigger this even in on popstate event\n    }\n\n    calculateHash() {\n        const activeNoteContext = this.getActiveContext();\n        if (!activeNoteContext) {\n            return \"\";\n        }\n\n        return linkService.calculateHash({\n            notePath: activeNoteContext.notePath,\n            ntxId: activeNoteContext.ntxId,\n            hoistedNoteId: activeNoteContext.hoistedNoteId,\n            viewScope: activeNoteContext.viewScope\n        });\n    }\n\n    /** @returns {NoteContext[]} */\n    getNoteContexts() {\n        return this.noteContexts;\n    }\n\n    /**\n     * Main context is essentially a tab (children are splits), so this returns tabs.\n     * @returns {NoteContext[]}\n     */\n    getMainNoteContexts() {\n        return this.noteContexts.filter(nc => nc.isMainContext());\n    }\n\n    /** @returns {NoteContext} */\n    getNoteContextById(ntxId) {\n        const noteContext = this.noteContexts.find(nc => nc.ntxId === ntxId);\n\n        if (!noteContext) {\n            throw new Error(`找不到 noteContext id='${ntxId}'`);\n        }\n\n        return noteContext;\n    }\n\n    /**\n     * Get active context which represents the visible split with focus. Active context can, but doesn't have to be \"main\".\n     *\n     * @returns {NoteContext}\n     */\n    getActiveContext() {\n        return this.activeNtxId\n            ? this.getNoteContextById(this.activeNtxId)\n            : null;\n    }\n\n    /**\n     * Get active main context which corresponds to the active tab.\n     *\n     * @returns {NoteContext}\n     */\n    getActiveMainContext() {\n        return this.activeNtxId\n            ? this.getNoteContextById(this.activeNtxId).getMainContext()\n            : null;\n    }\n\n    /** @returns {string|null} */\n    getActiveContextNotePath() {\n        const activeContext = this.getActiveContext();\n        return activeContext ? activeContext.notePath : null;\n    }\n\n    /** @returns {FNote} */\n    getActiveContextNote() {\n        const activeContext = this.getActiveContext();\n        return activeContext ? activeContext.note : null;\n    }\n\n    /** @returns {string|null} */\n    getActiveContextNoteId() {\n        const activeNote = this.getActiveContextNote();\n\n        return activeNote ? activeNote.noteId : null;\n    }\n\n    /** @returns {string|null} */\n    getActiveContextNoteType() {\n        const activeNote = this.getActiveContextNote();\n\n        return activeNote ? activeNote.type : null;\n    }\n    /** @returns {string|null} */\n    getActiveContextNoteMime() {\n        const activeNote = this.getActiveContextNote();\n\n        return activeNote ? activeNote.mime : null;\n    }\n\n    async switchToNoteContext(ntxId, notePath, viewScope = {}, hoistedNoteId = null) {\n        const noteContext = this.noteContexts.find(nc => nc.ntxId === ntxId)\n            || await this.openEmptyTab();\n\n        await this.activateNoteContext(noteContext.ntxId);\n\n        if (hoistedNoteId) {\n            await noteContext.setHoistedNoteId(hoistedNoteId);\n        }\n\n        if (notePath) {\n            await noteContext.setNote(notePath, { viewScope });\n        }\n    }\n\n    async openAndActivateEmptyTab() {\n        const noteContext = await this.openEmptyTab();\n\n        await this.activateNoteContext(noteContext.ntxId);\n\n        await noteContext.setEmpty();\n    }\n\n    async openEmptyTab(ntxId = null, hoistedNoteId = 'root', mainNtxId = null) {\n        const noteContext = new NoteContext(ntxId, hoistedNoteId, mainNtxId);\n\n        let existingNoteContext;\n\n        if (utils.isMobile()) {\n            // kind of hacky way to enforce a single tab on mobile interface - all requests to create a new one\n            // are forced to reuse the existing ab instead\n            existingNoteContext = this.getActiveContext();\n        } else {\n            existingNoteContext = this.children.find(nc => nc.ntxId === noteContext.ntxId);\n        }\n\n        if (existingNoteContext) {\n            await existingNoteContext.setHoistedNoteId(hoistedNoteId);\n\n            return existingNoteContext;\n        }\n\n        this.child(noteContext);\n\n        await this.triggerEvent('newNoteContextCreated', {noteContext});\n\n        return noteContext;\n    }\n\n    async openInNewTab(targetNoteId, hoistedNoteId = null) {\n        const noteContext = await this.openEmptyTab(null, hoistedNoteId || this.getActiveContext().hoistedNoteId);\n\n        await noteContext.setNote(targetNoteId);\n    }\n\n    async openInSameTab(targetNoteId, hoistedNoteId = null) {\n        const activeContext = this.getActiveContext();\n        await activeContext.setHoistedNoteId(hoistedNoteId || activeContext.hoistedNoteId);\n        await activeContext.setNote(targetNoteId);\n    }\n\n    /**\n     * If the requested notePath is within current note hoisting scope then keep the note hoisting also for the new tab.\n     */\n    async openTabWithNoteWithHoisting(notePath, opts = {}) {\n        const noteContext = this.getActiveContext();\n        let hoistedNoteId = 'root';\n\n        if (noteContext) {\n            const resolvedNotePath = await treeService.resolveNotePath(notePath, noteContext.hoistedNoteId);\n\n            if (resolvedNotePath.includes(noteContext.hoistedNoteId) || resolvedNotePath.includes('_hidden')) {\n                hoistedNoteId = noteContext.hoistedNoteId;\n            }\n        }\n\n        opts.hoistedNoteId = hoistedNoteId;\n\n        return this.openContextWithNote(notePath, opts);\n    }\n\n    async openContextWithNote(notePath, opts = {}) {\n        const activate = !!opts.activate;\n        const ntxId = opts.ntxId || null;\n        const mainNtxId = opts.mainNtxId || null;\n        const hoistedNoteId = opts.hoistedNoteId || 'root';\n        const viewScope = opts.viewScope || { viewMode: \"default\" };\n\n        const noteContext = await this.openEmptyTab(ntxId, hoistedNoteId, mainNtxId);\n\n        if (notePath) {\n            await noteContext.setNote(notePath, {\n                // if activate is false, then send normal noteSwitched event\n                triggerSwitchEvent: !activate,\n                viewScope: viewScope\n            });\n        }\n\n        if (activate) {\n            this.activateNoteContext(noteContext.ntxId, false);\n\n            await this.triggerEvent('noteSwitchedAndActivated', {\n                noteContext,\n                notePath: noteContext.notePath // resolved note path\n            });\n        }\n\n        return noteContext;\n    }\n\n    async activateOrOpenNote(noteId) {\n        for (const noteContext of this.getNoteContexts()) {\n            if (noteContext.note && noteContext.note.noteId === noteId) {\n                this.activateNoteContext(noteContext.ntxId);\n\n                return;\n            }\n        }\n\n        // if no tab with this note has been found we'll create new tab\n\n        await this.openContextWithNote(noteId, { activate: true });\n    }\n\n    async activateNoteContext(ntxId, triggerEvent = true) {\n        if (ntxId === this.activeNtxId) {\n            return;\n        }\n\n        this.activeNtxId = ntxId;\n\n        if (triggerEvent) {\n            await this.triggerEvent('activeContextChanged', {\n                noteContext: this.getNoteContextById(ntxId)\n            });\n        }\n\n        this.tabsUpdate.scheduleUpdate();\n\n        this.setCurrentNavigationStateToHash();\n    }\n\n    /**\n     * @param ntxId\n     * @returns {Promise<boolean>} true if note context has been removed, false otherwise\n     */\n    async removeNoteContext(ntxId) {\n        // removing note context is an async process which can take some time, if users presses CTRL-W quickly, two\n        // close events could interleave which would then lead to attempting to activate already removed context.\n        return await this.mutex.runExclusively(async () => {\n            let noteContextToRemove;\n\n            try {\n                noteContextToRemove = this.getNoteContextById(ntxId);\n            }\n            catch {\n                // note context not found\n                return false;\n            }\n\n            if (noteContextToRemove.isMainContext()) {\n                const mainNoteContexts = this.getNoteContexts().filter(nc => nc.isMainContext());\n\n                if (mainNoteContexts.length === 1) {\n                    if (noteContextToRemove.isEmpty()) {\n                        // this is already the empty note context, no point in closing it and replacing with another\n                        // empty tab\n                        return false;\n                    }\n\n                    await this.openEmptyTab();\n                }\n            }\n\n            // close dangling autocompletes after closing the tab\n            $(\".aa-input\").autocomplete(\"close\");\n\n            const noteContextsToRemove = noteContextToRemove.getSubContexts();\n            const ntxIdsToRemove = noteContextsToRemove.map(nc => nc.ntxId);\n\n            await this.triggerEvent('beforeNoteContextRemove', { ntxIds: ntxIdsToRemove });\n\n            if (!noteContextToRemove.isMainContext()) {\n                const siblings = noteContextToRemove.getMainContext().getSubContexts();\n                const idx = siblings.findIndex(nc => nc.ntxId === noteContextToRemove.ntxId);\n                const contextToActivateIdx = idx === siblings.length - 1 ? idx - 1 : idx + 1;\n                const contextToActivate = siblings[contextToActivateIdx];\n\n                await this.activateNoteContext(contextToActivate.ntxId);\n            }\n            else if (this.mainNoteContexts.length <= 1) {\n                await this.openAndActivateEmptyTab();\n            }\n            else if (ntxIdsToRemove.includes(this.activeNtxId)) {\n                const idx = this.mainNoteContexts.findIndex(nc => nc.ntxId === noteContextToRemove.ntxId);\n\n                if (idx === this.mainNoteContexts.length - 1) {\n                    await this.activatePreviousTabCommand();\n                }\n                else {\n                    await this.activateNextTabCommand();\n                }\n            }\n\n            this.removeNoteContexts(noteContextsToRemove);\n\n            return true;\n        });\n    }\n\n    removeNoteContexts(noteContextsToRemove) {\n        const ntxIdsToRemove = noteContextsToRemove.map(nc => nc.ntxId);\n\n        const position = this.noteContexts.findIndex(nc => ntxIdsToRemove.includes(nc.ntxId));\n\n        this.children = this.children.filter(nc => !ntxIdsToRemove.includes(nc.ntxId));\n\n        this.addToRecentlyClosedTabs(noteContextsToRemove, position);\n\n        this.triggerEvent('noteContextRemoved', {ntxIds: ntxIdsToRemove});\n\n        this.tabsUpdate.scheduleUpdate();\n    }\n\n    addToRecentlyClosedTabs(noteContexts, position) {\n        if (noteContexts.length === 1 && noteContexts[0].isEmpty()) {\n            return;\n        }\n\n        this.recentlyClosedTabs.push({contexts: noteContexts, position: position});\n    }\n\n    tabReorderEvent({ntxIdsInOrder}) {\n        const order = {};\n\n        let i = 0;\n\n        for (const ntxId of ntxIdsInOrder) {\n            for (const noteContext of this.getNoteContextById(ntxId).getSubContexts()) {\n                order[noteContext.ntxId] = i++;\n            }\n        }\n\n        this.children.sort((a, b) => order[a.ntxId] < order[b.ntxId] ? -1 : 1);\n\n        this.tabsUpdate.scheduleUpdate();\n    }\n\n    noteContextReorderEvent({ntxIdsInOrder, oldMainNtxId, newMainNtxId}) {\n        const order = Object.fromEntries(ntxIdsInOrder.map((v, i) => [v, i]));\n\n        this.children.sort((a, b) => order[a.ntxId] < order[b.ntxId] ? -1 : 1);\n\n        if (oldMainNtxId && newMainNtxId) {\n            this.children.forEach(c => {\n                if (c.ntxId === newMainNtxId) {\n                    // new main context has null mainNtxId\n                    c.mainNtxId = null;\n                } else if (c.ntxId === oldMainNtxId || c.mainNtxId === oldMainNtxId) {\n                    // old main context or subcontexts all have the new mainNtxId\n                    c.mainNtxId = newMainNtxId;\n                }\n            });\n        }\n\n        this.tabsUpdate.scheduleUpdate();\n    }\n\n    async activateNextTabCommand() {\n        const activeMainNtxId = this.getActiveMainContext().ntxId;\n\n        const oldIdx = this.mainNoteContexts.findIndex(nc => nc.ntxId === activeMainNtxId);\n        const newActiveNtxId = this.mainNoteContexts[oldIdx === this.mainNoteContexts.length - 1 ? 0 : oldIdx + 1].ntxId;\n\n        await this.activateNoteContext(newActiveNtxId);\n    }\n\n    async activatePreviousTabCommand() {\n        const activeMainNtxId = this.getActiveMainContext().ntxId;\n\n        const oldIdx = this.mainNoteContexts.findIndex(nc => nc.ntxId === activeMainNtxId);\n        const newActiveNtxId = this.mainNoteContexts[oldIdx === 0 ? this.mainNoteContexts.length - 1 : oldIdx - 1].ntxId;\n\n        await this.activateNoteContext(newActiveNtxId);\n    }\n\n    async closeActiveTabCommand() {\n        await this.removeNoteContext(this.activeNtxId);\n    }\n\n    beforeUnloadEvent() {\n        this.tabsUpdate.updateNowIfNecessary();\n\n        return true; // don't block closing the tab, this metadata is not that important\n    }\n\n    openNewTabCommand() {\n        this.openAndActivateEmptyTab();\n    }\n\n    async closeAllTabsCommand() {\n        for (const ntxIdToRemove of this.mainNoteContexts.map(nc => nc.ntxId)) {\n            await this.removeNoteContext(ntxIdToRemove);\n        }\n    }\n\n    async closeOtherTabsCommand({ntxId}) {\n        for (const ntxIdToRemove of this.mainNoteContexts.map(nc => nc.ntxId)) {\n            if (ntxIdToRemove !== ntxId) {\n                await this.removeNoteContext(ntxIdToRemove);\n            }\n        }\n    }\n\n    async closeTabCommand({ntxId}) {\n        await this.removeNoteContext(ntxId);\n    }\n\n    async moveTabToNewWindowCommand({ntxId}) {\n        const {notePath, hoistedNoteId} = this.getNoteContextById(ntxId);\n\n        const removed = await this.removeNoteContext(ntxId);\n\n        if (removed) {\n            this.triggerCommand('openInWindow', {notePath, hoistedNoteId});\n        }\n    }\n\n    async reopenLastTabCommand() {\n        let closeLastEmptyTab = null;\n\n        await this.mutex.runExclusively(async () => {\n            if (this.recentlyClosedTabs.length === 0) {\n                return;\n            }\n\n            if (this.noteContexts.length === 1 && this.noteContexts[0].isEmpty()) {\n                // new empty tab is created after closing the last tab, this reverses the empty tab creation\n                closeLastEmptyTab = this.noteContexts[0];\n            }\n\n            const lastClosedTab = this.recentlyClosedTabs.pop();\n            const noteContexts = lastClosedTab.contexts;\n\n            for (const noteContext of noteContexts) {\n                this.child(noteContext);\n\n                await this.triggerEvent('newNoteContextCreated', {noteContext});\n            }\n\n            //  restore last position of contexts stored in tab manager\n            const ntxsInOrder = [\n                ...this.noteContexts.slice(0, lastClosedTab.position),\n                ...this.noteContexts.slice(-noteContexts.length),\n                ...this.noteContexts.slice(lastClosedTab.position, -noteContexts.length),\n            ]\n            await this.noteContextReorderEvent({ntxIdsInOrder: ntxsInOrder.map(nc => nc.ntxId)});\n\n            let mainNtx = noteContexts.find(nc => nc.isMainContext());\n            if (mainNtx) {\n                // reopened a tab, need to reorder new tab widget in tab row\n                await this.triggerEvent('contextsReopened', {\n                    mainNtxId: mainNtx.ntxId,\n                    tabPosition: ntxsInOrder.filter(nc => nc.isMainContext()).findIndex(nc => nc.ntxId === mainNtx.ntxId)\n                });\n            } else {\n                // reopened a single split, need to reorder the pane widget in split note container\n                await this.triggerEvent('contextsReopened', {\n                    ntxId: ntxsInOrder[lastClosedTab.position].ntxId,\n                    // this is safe since lastClosedTab.position can never be 0 in this case\n                    afterNtxId: ntxsInOrder[lastClosedTab.position - 1].ntxId\n                });\n            }\n\n            const noteContextToActivate = noteContexts.length === 1\n                ? noteContexts[0]\n                : noteContexts.find(nc => nc.isMainContext());\n\n            await this.activateNoteContext(noteContextToActivate.ntxId);\n\n            await this.triggerEvent('noteSwitched', {\n                noteContext: noteContextToActivate,\n                notePath: noteContextToActivate.notePath\n            });\n        });\n\n        if (closeLastEmptyTab) {\n            await this.removeNoteContext(closeLastEmptyTab.ntxId);\n        }\n    }\n\n    hoistedNoteChangedEvent() {\n        this.tabsUpdate.scheduleUpdate();\n    }\n\n    async updateDocumentTitle(activeNoteContext) {\n        const titleFragments = [\n            // it helps to navigate in history if note title is included in the title\n            await activeNoteContext.getNavigationTitle(),\n            \"Trilium Notes\"\n        ].filter(Boolean);\n\n        document.title = titleFragments.join(\" - \");\n    }\n\n    async entitiesReloadedEvent({loadResults}) {\n        const activeContext = this.getActiveContext();\n\n        if (activeContext && loadResults.isNoteReloaded(activeContext.noteId)) {\n            await this.updateDocumentTitle(activeContext);\n        }\n    }\n\n    async frocaReloadedEvent() {\n        const activeContext = this.getActiveContext();\n\n        if (activeContext) {\n            await this.updateDocumentTitle(activeContext);\n        }\n    }\n}\n","import Component from \"./component.js\";\nimport appContext from \"./app_context.js\";\n\nexport default class MobileScreenSwitcherExecutor extends Component {\n    setActiveScreenCommand({screen}) {\n        if (screen !== this.activeScreen) {\n            this.activeScreen = screen;\n\n            if (screen === 'tree') {\n                const activeNoteContext = appContext.tabManager.getActiveContext();\n\n                activeNoteContext.setEmpty();\n            }\n\n            this.triggerEvent('activeScreenChanged', {activeScreen: screen});\n        }\n    }\n}\n","import appContext from \"./app_context.js\";\nimport noteCreateService from \"../services/note_create.js\";\nimport treeService from \"../services/tree.js\";\nimport hoistedNoteService from \"../services/hoisted_note.js\";\nimport Component from \"./component.js\";\n\n/**\n * This class contains command executors which logically belong to the NoteTree widget, but for better user experience,\n * the keyboard shortcuts must be active on the whole screen and not just on the widget itself, so the executors\n * must be at the root of the component tree.\n */\nexport default class MainTreeExecutors extends Component {\n    get tree() {\n        return appContext.noteTreeWidget;\n    }\n\n    async cloneNotesToCommand() {\n        const selectedOrActiveNoteIds = this.tree.getSelectedOrActiveNodes().map(node => node.data.noteId);\n\n        this.triggerCommand('cloneNoteIdsTo', {noteIds: selectedOrActiveNoteIds});\n    }\n\n    async moveNotesToCommand() {\n        const selectedOrActiveBranchIds = this.tree.getSelectedOrActiveNodes().map(node => node.data.branchId);\n\n        this.triggerCommand('moveBranchIdsTo', {branchIds: selectedOrActiveBranchIds});\n    }\n\n    async createNoteIntoCommand() {\n        const activeNoteContext = appContext.tabManager.getActiveContext();\n\n        if (!activeNoteContext) {\n            return;\n        }\n\n        await noteCreateService.createNote(activeNoteContext.notePath, {\n            isProtected: activeNoteContext.note.isProtected,\n            saveSelection: false\n        });\n    }\n\n    async createNoteAfterCommand() {\n        const node = this.tree.getActiveNode();\n\n        if (!node) {\n            return;\n        }\n\n        const parentNotePath = treeService.getNotePath(node.getParent());\n        const isProtected = treeService.getParentProtectedStatus(node);\n\n        if (node.data.noteId === 'root' || node.data.noteId === hoistedNoteService.getHoistedNoteId()) {\n            return;\n        }\n\n        await noteCreateService.createNote(parentNotePath, {\n            target: 'after',\n            targetBranchId: node.data.branchId,\n            isProtected: isProtected,\n            saveSelection: false\n        });\n    }\n}\n","import appContext from \"./app_context.js\";\nimport shortcutService from \"../services/shortcuts.js\";\nimport server from \"../services/server.js\";\nimport Component from \"./component.js\";\nimport froca from \"../services/froca.js\";\n\nexport default class ShortcutComponent extends Component {\n    constructor() {\n        super();\n\n        server.get('keyboard-shortcuts-for-notes').then(shortcutAttributes => {\n            for (const attr of shortcutAttributes) {\n                this.bindNoteShortcutHandler(attr);\n            }\n        });\n    }\n\n    bindNoteShortcutHandler(labelOrRow) {\n        const handler = () => appContext.tabManager.getActiveContext().setNote(labelOrRow.noteId);\n        const namespace = labelOrRow.attributeId;\n\n        if (labelOrRow.isDeleted) { // only applicable if row\n            shortcutService.removeGlobalShortcut(namespace);\n        } else {\n            shortcutService.bindGlobalShortcut(labelOrRow.value, handler, namespace);\n        }\n    }\n\n    async entitiesReloadedEvent({loadResults}) {\n        for (const attr of loadResults.getAttributeRows()) {\n            if (attr.type === 'label' && attr.name === 'keyboardShortcut') {\n                const note = await froca.getNote(attr.noteId);\n                // launcher shortcuts are handled specifically\n                if (note && note.type !== 'launcher') {\n                    this.bindNoteShortcutHandler(attr);\n                }\n            }\n        }\n    }\n}\n","import froca from \"../services/froca.js\";\nimport bundleService from \"../services/bundle.js\";\nimport RootCommandExecutor from \"./root_command_executor.js\";\nimport Entrypoints from \"./entrypoints.js\";\nimport options from \"../services/options.js\";\nimport utils from \"../services/utils.js\";\nimport zoomComponent from \"./zoom.js\";\nimport TabManager from \"./tab_manager.js\";\nimport Component from \"./component.js\";\nimport keyboardActionsService from \"../services/keyboard_actions.js\";\nimport linkService from \"../services/link.js\";\nimport MobileScreenSwitcherExecutor from \"./mobile_screen_switcher.js\";\nimport MainTreeExecutors from \"./main_tree_executors.js\";\nimport toast from \"../services/toast.js\";\nimport ShortcutComponent from \"./shortcut_component.js\";\n\nclass AppContext extends Component {\n    constructor(isMainWindow) {\n        super();\n\n        this.isMainWindow = isMainWindow;\n        // non-widget/layout components needed for the application\n        this.components = [];\n        this.beforeUnloadListeners = [];\n    }\n\n    setLayout(layout) {\n        this.layout = layout;\n    }\n\n    async start() {\n        this.initComponents();\n\n        // options are often needed for isEnabled()\n        await options.initializedPromise;\n\n        this.renderWidgets();\n\n        await froca.initializedPromise;\n\n        this.tabManager.loadTabs();\n\n        setTimeout(() => bundleService.executeStartupBundles(), 2000);\n    }\n\n    initComponents() {\n        this.tabManager = new TabManager();\n\n        this.components = [\n            this.tabManager,\n            new RootCommandExecutor(),\n            new Entrypoints(),\n            new MainTreeExecutors(),\n            new ShortcutComponent()\n        ];\n\n        if (utils.isMobile()) {\n            this.components.push(new MobileScreenSwitcherExecutor());\n        }\n\n        for (const component of this.components) {\n            this.child(component);\n        }\n\n        if (utils.isElectron()) {\n            this.child(zoomComponent);\n        }\n    }\n\n    renderWidgets() {\n        const rootWidget = this.layout.getRootWidget(this);\n        const $renderedWidget = rootWidget.render();\n\n        keyboardActionsService.updateDisplayedShortcuts($renderedWidget);\n\n        $(\"body\").append($renderedWidget);\n\n        $renderedWidget.on('click', \"[data-trigger-command]\", function() {\n            if ($(this).hasClass(\"disabled\")) {\n                return;\n            }\n\n            const commandName = $(this).attr('data-trigger-command');\n            const $component = $(this).closest(\".component\");\n            const component = $component.prop(\"component\");\n\n            component.triggerCommand(commandName, {$el: $(this)});\n        });\n\n        this.child(rootWidget);\n\n        this.triggerEvent('initialRenderComplete');\n    }\n\n    /** @returns {Promise<void>} */\n    triggerEvent(name, data = {}) {\n        return this.handleEvent(name, data);\n    }\n\n    /** @returns {Promise<*>} */\n    triggerCommand(name, data = {}) {\n        for (const executor of this.components) {\n            const fun = executor[`${name}Command`];\n\n            if (fun) {\n                return executor.callMethod(fun, data);\n            }\n        }\n\n        // this might hint at error, but sometimes this is used by components which are at different places\n        // in the component tree to communicate with each other\n        console.debug(`Unhandled command ${name}, converting to event.`);\n\n        return this.triggerEvent(name, data);\n    }\n\n    getComponentByEl(el) {\n        return $(el).closest(\".component\").prop('component');\n    }\n\n    addBeforeUnloadListener(obj) {\n        if (typeof WeakRef !== \"function\") {\n            // older browsers don't support WeakRef\n            return;\n        }\n\n        this.beforeUnloadListeners.push(new WeakRef(obj));\n    }\n}\n\nconst appContext = new AppContext(window.glob.isMainWindow);\n\n// we should save all outstanding changes before the page/app is closed\n$(window).on('beforeunload', () => {\n    let allSaved = true;\n\n    appContext.beforeUnloadListeners = appContext.beforeUnloadListeners.filter(wr => !!wr.deref());\n\n    for (const weakRef of appContext.beforeUnloadListeners) {\n        const component = weakRef.deref();\n\n        if (!component) {\n            continue;\n        }\n\n        if (!component.beforeUnloadEvent()) {\n            console.log(`Component ${component.componentId} is not finished saving its state.`);\n\n            toast.showMessage(\"请等待几秒钟以完成保存, 然后可以重试.\", 10000);\n\n            allSaved = false;\n        }\n    }\n\n    if (!allSaved) {\n        return \"some string\";\n    }\n});\n\n$(window).on('hashchange', function() {\n    const {notePath, ntxId, viewScope} = linkService.parseNavigationStateFromUrl(window.location.href);\n\n    if (notePath || ntxId) {\n        appContext.tabManager.switchToNoteContext(ntxId, notePath, viewScope);\n    }\n});\n\nexport default appContext;\n","import utils from '../services/utils.js';\n\n/**\n * Abstract class for all components in the Trilium's frontend.\n *\n * Contains also event implementation with following properties:\n * - event / command distribution is synchronous which among others mean that events are well-ordered - event\n *   which was sent out first will also be processed first by the component\n * - execution of the event / command is asynchronous - each component executes the event on its own without regard for\n *   other components.\n * - although the execution is async, we are collecting all the promises, and therefore it is possible to wait until the\n *   event / command is executed in all components - by simply awaiting the `triggerEvent()`.\n */\nexport default class Component {\n    constructor() {\n        this.componentId = `${this.sanitizedClassName}-${utils.randomString(8)}`;\n        /** @type Component[] */\n        this.children = [];\n        this.initialized = null;\n    }\n\n    get sanitizedClassName() {\n        // webpack mangles names and sometimes uses unsafe characters\n        return this.constructor.name.replace(/[^A-Z0-9]/ig, \"_\");\n    }\n\n    setParent(parent) {\n        /** @type Component */\n        this.parent = parent;\n        return this;\n    }\n\n    child(...components) {\n        for (const component of components) {\n            component.setParent(this);\n\n            this.children.push(component);\n        }\n\n        return this;\n    }\n\n    /** @returns {Promise<void>} */\n    handleEvent(name, data) {\n        try {\n            const callMethodPromise = this.initialized\n                ? this.initialized.then(() => this.callMethod(this[`${name}Event`], data))\n                : this.callMethod(this[`${name}Event`], data);\n\n            const childrenPromise = this.handleEventInChildren(name, data);\n\n            // don't create promises if not needed (optimization)\n            return callMethodPromise && childrenPromise\n                ? Promise.all([callMethodPromise, childrenPromise])\n                : (callMethodPromise || childrenPromise);\n        }\n        catch (e) {\n            console.error(`Handling of event '${name}' failed in ${this.constructor.name} with error ${e.message} ${e.stack}`);\n\n            return null;\n        }\n    }\n\n    /** @returns {Promise<void>} */\n    triggerEvent(name, data = {}) {\n        return this.parent.triggerEvent(name, data);\n    }\n\n    /** @returns {Promise<void>} */\n    handleEventInChildren(name, data = {}) {\n        const promises = [];\n\n        for (const child of this.children) {\n            const ret = child.handleEvent(name, data);\n\n            if (ret) {\n                promises.push(ret);\n            }\n        }\n\n        // don't create promises if not needed (optimization)\n        return promises.length > 0 ? Promise.all(promises) : null;\n    }\n\n    /** @returns {Promise<*>} */\n    triggerCommand(name, data = {}) {\n        const fun = this[`${name}Command`];\n\n        if (fun) {\n            return this.callMethod(fun, data);\n        }\n        else {\n            return this.parent.triggerCommand(name, data);\n        }\n    }\n\n    callMethod(fun, data) {\n        if (typeof fun !== 'function') {\n            return;\n        }\n\n        const startTime = Date.now();\n\n        const promise = fun.call(this, data);\n\n        const took = Date.now() - startTime;\n\n        if (glob.isDev && took > 20) { // measuring only sync handlers\n            console.log(`Call to ${fun.name} in ${this.componentId} took ${took}ms`);\n        }\n\n        if (glob.isDev && promise) {\n            return utils.timeLimit(promise, 20000, `Time limit failed on ${this.constructor.name} with ${fun.name}`);\n        }\n\n        return promise;\n    }\n}\n","import options from \"../services/options.js\";\nimport Component from \"./component.js\";\nimport utils from \"../services/utils.js\";\n\nconst MIN_ZOOM = 0.5;\nconst MAX_ZOOM = 2.0;\n\nclass ZoomComponent extends Component {\n    constructor() {\n        super();\n\n        if (utils.isElectron()) {\n            options.initializedPromise.then(() => {\n                this.setZoomFactor(options.getFloat('zoomFactor'));\n            });\n\n            window.addEventListener(\"wheel\", event => {\n                if (event.ctrlKey) {\n                    this.setZoomFactorAndSave(this.getCurrentZoom() + event.deltaY * 0.001);\n                }\n            });\n        }\n    }\n\n    setZoomFactor(zoomFactor) {\n        zoomFactor = parseFloat(zoomFactor);\n\n        const webFrame = utils.dynamicRequire('electron').webFrame;\n        webFrame.setZoomFactor(zoomFactor);\n    }\n\n    async setZoomFactorAndSave(zoomFactor) {\n        if (zoomFactor >= MIN_ZOOM && zoomFactor <= MAX_ZOOM) {\n            zoomFactor = Math.round(zoomFactor * 10) / 10;\n\n            this.setZoomFactor(zoomFactor);\n\n            await options.save('zoomFactor', zoomFactor);\n        }\n        else {\n            console.log(`Zoom factor ${zoomFactor} outside of the range, ignored.`);\n        }\n    }\n\n    getCurrentZoom() {\n        return utils.dynamicRequire('electron').webFrame.getZoomFactor();\n    }\n\n    zoomOutEvent() {\n        this.setZoomFactorAndSave(this.getCurrentZoom() - 0.1);\n    }\n\n    zoomInEvent() {\n        this.setZoomFactorAndSave(this.getCurrentZoom() + 0.1);\n    }\n    zoomResetEvent() {\n        this.setZoomFactorAndSave(1);\n    }\n    \n    setZoomFactorAndSaveEvent({zoomFactor}) {\n        this.setZoomFactorAndSave(zoomFactor);\n    }\n}\n\nconst zoomService = new ZoomComponent();\n\nexport default zoomService;\n","/**\n * Attachment is a file directly tied into a note without\n * being a hidden child.\n */\nclass FAttachment {\n    constructor(froca, row) {\n        /** @type {Froca} */\n        this.froca = froca;\n\n        this.update(row);\n    }\n\n    update(row) {\n        /** @type {string} */\n        this.attachmentId = row.attachmentId;\n        /** @type {string} */\n        this.ownerId = row.ownerId;\n        /** @type {string} */\n        this.role = row.role;\n        /** @type {string} */\n        this.mime = row.mime;\n        /** @type {string} */\n        this.title = row.title;\n        /** @type {string} */\n        this.dateModified = row.dateModified;\n        /** @type {string} */\n        this.utcDateModified = row.utcDateModified;\n        /** @type {string} */\n        this.utcDateScheduledForErasureSince = row.utcDateScheduledForErasureSince;\n\n        /**\n         * optionally added to the entity \n         * @type {int}\n         */\n        this.contentLength = row.contentLength;\n\n        this.froca.attachments[this.attachmentId] = this;\n    }\n\n    /** @returns {FNote} */\n    getNote() {\n        return this.froca.notes[this.ownerId];\n    }\n\n    /** @return {FBlob} */\n    async getBlob() {\n        return await this.froca.getBlob('attachments', this.attachmentId);\n    }\n}\n\nexport default FAttachment;\n","import promotedAttributeDefinitionParser from '../services/promoted_attribute_definition_parser.js';\n\n/**\n * There are currently only two types of attributes, labels or relations.\n * @typedef {\"label\" | \"relation\"} AttributeType\n */\n\n/**\n * Attribute is an abstract concept which has two real uses - label (key - value pair)\n * and relation (representing named relationship between source and target note)\n */\nclass FAttribute {\n    constructor(froca, row) {\n        /** @type {Froca} */\n        this.froca = froca;\n\n        this.update(row);\n    }\n\n    update(row) {\n        /** @type {string} */\n        this.attributeId = row.attributeId;\n        /** @type {string} */\n        this.noteId = row.noteId;\n        /** @type {AttributeType} */\n        this.type = row.type;\n        /** @type {string} */\n        this.name = row.name;\n        /** @type {string} */\n        this.value = row.value;\n        /** @type {int} */\n        this.position = row.position;\n        /** @type {boolean} */\n        this.isInheritable = !!row.isInheritable;\n    }\n\n    /** @returns {FNote} */\n    getNote() {\n        return this.froca.notes[this.noteId];\n    }\n\n    /** @returns {Promise<FNote>} */\n    async getTargetNote() {\n        const targetNoteId = this.targetNoteId;\n\n        return await this.froca.getNote(targetNoteId, true);\n    }\n\n    get targetNoteId() { // alias\n        if (this.type !== 'relation') {\n            throw new Error(`Attribute ${this.attributeId} is not a relation`);\n        }\n\n        return this.value;\n    }\n\n    get isAutoLink() {\n        return this.type === 'relation' && ['internalLink', 'imageLink', 'relationMapLink', 'includeNoteLink'].includes(this.name);\n    }\n\n    get toString() {\n        return `FAttribute(attributeId=${this.attributeId}, type=${this.type}, name=${this.name}, value=${this.value})`;\n    }\n\n    isDefinition() {\n        return this.type === 'label' && (this.name.startsWith('label:') || this.name.startsWith('relation:'));\n    }\n\n    getDefinition() {\n        return promotedAttributeDefinitionParser.parse(this.value);\n    }\n\n    isDefinitionFor(attr) {\n        return this.type === 'label' && this.name === `${attr.type}:${attr.name}`;\n    }\n\n    get dto() {\n        const dto = Object.assign({}, this);\n        delete dto.froca;\n\n        return dto;\n    }\n}\n\nexport default FAttribute;\n","/**\n * Branch represents a relationship between a child note and its parent note. Trilium allows a note to have multiple\n * parents.\n */\nclass FBranch {\n    constructor(froca, row) {\n        /** @type {Froca} */\n        this.froca = froca;\n\n        this.update(row);\n    }\n\n    update(row) {\n        /**\n         * primary key\n         * @type {string}\n         */\n        this.branchId = row.branchId;\n        /** @type {string} */\n        this.noteId = row.noteId;\n        /** @type {string} */\n        this.parentNoteId = row.parentNoteId;\n        /** @type {int} */\n        this.notePosition = row.notePosition;\n        /** @type {string} */\n        this.prefix = row.prefix;\n        /** @type {boolean} */\n        this.isExpanded = !!row.isExpanded;\n        /** @type {boolean} */\n        this.fromSearchNote = !!row.fromSearchNote;\n    }\n\n    /** @returns {FNote} */\n    async getNote() {\n        return this.froca.getNote(this.noteId);\n    }\n\n    /** @returns {FNote} */\n    getNoteFromCache() {\n        return this.froca.getNoteFromCache(this.noteId);\n    }\n\n    /** @returns {FNote} */\n    async getParentNote() {\n        return this.froca.getNote(this.parentNoteId);\n    }\n\n    /** @returns {boolean} true if it's top level, meaning its parent is the root note */\n    isTopLevel() {\n        return this.parentNoteId === 'root';\n    }\n\n    get toString() {\n        return `FBranch(branchId=${this.branchId})`;\n    }\n\n    get pojo() {\n        const pojo = {...this};\n        delete pojo.froca;\n        return pojo;\n    }\n}\n\nexport default FBranch;\n","const registeredClasses = new Set();\n\nfunction createClassForColor(color) {\n    if (!color?.trim()) {\n        return \"\";\n    }\n\n    const normalizedColorName = color.replace(/[^a-z0-9]/gi, \"\");\n\n    if (!normalizedColorName.trim()) {\n        return \"\";\n    }\n\n    const className = `color-${normalizedColorName}`;\n\n    if (!registeredClasses.has(className)) {\n        // make the active fancytree selector more specific than the normal color setting\n        $(\"head\").append(`<style>.${className}, span.fancytree-active.${className} { color: ${color} !important; }</style>`);\n\n        registeredClasses.add(className);\n    }\n\n    return className;\n}\n\nexport default {\n    createClassForColor\n};\n","import server from '../services/server.js';\nimport noteAttributeCache from \"../services/note_attribute_cache.js\";\nimport ws from \"../services/ws.js\";\nimport froca from \"../services/froca.js\";\nimport protectedSessionHolder from \"../services/protected_session_holder.js\";\nimport cssClassManager from \"../services/css_class_manager.js\";\n\nconst LABEL = 'label';\nconst RELATION = 'relation';\n\nconst NOTE_TYPE_ICONS = {\n    \"file\": \"bx bx-file\",\n    \"image\": \"bx bx-image\",\n    \"code\": \"bx bx-code\",\n    \"render\": \"bx bx-extension\",\n    \"search\": \"bx bx-file-find\",\n    \"relationMap\": \"bx bx-map-alt\",\n    \"book\": \"bx bx-book\",\n    \"noteMap\": \"bx bx-map-alt\",\n    \"mermaid\": \"bx bx-selection\",\n    \"canvas\": \"bx bx-pen\",\n    \"webView\": \"bx bx-globe-alt\",\n    \"launcher\": \"bx bx-link\",\n    \"doc\": \"bx bxs-file-doc\",\n    \"contentWidget\": \"bx bxs-widget\"\n};\n\n/**\n * There are many different Note types, some of which are entirely opaque to the\n * end user. Those types should be used only for checking against, they are\n * not for direct use.\n * @typedef {\"file\" | \"image\" | \"search\" | \"noteMap\" | \"launcher\" | \"doc\" | \"contentWidget\" | \"text\" | \"relationMap\" | \"render\" | \"canvas\" | \"mermaid\" | \"book\" | \"webView\" | \"code\"} NoteType\n */\n\n/**\n * @typedef {Object} NotePathRecord\n * @property {boolean} isArchived\n * @property {boolean} isInHoistedSubTree\n * @property {boolean} isSearch\n * @property {Array<string>} notePath\n * @property {boolean} isHidden\n */\n\n/**\n * Note is the main node and concept in Trilium.\n */\nclass FNote {\n    /**\n     * @param {Froca} froca\n     * @param {Object.<string, Object>} row\n     */\n    constructor(froca, row) {\n        /** @type {Froca} */\n        this.froca = froca;\n\n        /** @type {string[]} */\n        this.attributes = [];\n\n        /** @type {string[]} */\n        this.targetRelations = [];\n\n        /** @type {string[]} */\n        this.parents = [];\n        /** @type {string[]} */\n        this.children = [];\n\n        /** @type {Object.<string, string>} */\n        this.parentToBranch = {};\n\n        /** @type {Object.<string, string>} */\n        this.childToBranch = {};\n\n        /** @type {FAttachment[]|null} */\n        this.attachments = null; // lazy loaded\n\n        this.update(row);\n    }\n\n    update(row) {\n        /** @type {string} */\n        this.noteId = row.noteId;\n        /** @type {string} */\n        this.title = row.title;\n        /** @type {boolean} */\n        this.isProtected = !!row.isProtected;\n        /**\n         * See {@see NoteType} for info on values.\n         * @type {NoteType}\n         */\n        this.type = row.type;\n        /**\n         * content-type, e.g. \"application/json\"\n         * @type {string}\n         */\n        this.mime = row.mime;\n\n        // the main use case to keep this is to detect content change which should trigger refresh\n        this.blobId = row.blobId;\n    }\n\n    addParent(parentNoteId, branchId, sort = true) {\n        if (parentNoteId === 'none') {\n            return;\n        }\n\n        if (!this.parents.includes(parentNoteId)) {\n            this.parents.push(parentNoteId);\n        }\n\n        this.parentToBranch[parentNoteId] = branchId;\n\n        if (sort) {\n            this.sortParents();\n        }\n    }\n\n    addChild(childNoteId, branchId, sort = true) {\n        if (!(childNoteId in this.childToBranch)) {\n            this.children.push(childNoteId);\n        }\n\n        this.childToBranch[childNoteId] = branchId;\n\n        if (sort) {\n            this.sortChildren();\n        }\n    }\n\n    sortChildren() {\n        const branchIdPos = {};\n\n        for (const branchId of Object.values(this.childToBranch)) {\n            branchIdPos[branchId] = this.froca.getBranch(branchId).notePosition;\n        }\n\n        this.children.sort((a, b) => branchIdPos[this.childToBranch[a]] - branchIdPos[this.childToBranch[b]]);\n    }\n\n    /** @returns {boolean} */\n    isJson() {\n        return this.mime === \"application/json\";\n    }\n\n    async getContent() {\n        const blob = await this.getBlob();\n\n        return blob?.content;\n    }\n\n    async getJsonContent() {\n        const content = await this.getContent();\n\n        try {\n            return JSON.parse(content);\n        }\n        catch (e) {\n            console.log(`Cannot parse content of note '${this.noteId}': `, e.message);\n\n            return null;\n        }\n    }\n\n    /**\n     * @returns {string[]}\n     */\n    getParentBranchIds() {\n        return Object.values(this.parentToBranch);\n    }\n\n    /**\n     * @returns {string[]}\n     * @deprecated use getParentBranchIds() instead\n     */\n    getBranchIds() {\n        return this.getParentBranchIds();\n    }\n\n    /**\n     * @returns {FBranch[]}\n     */\n    getParentBranches() {\n        const branchIds = Object.values(this.parentToBranch);\n\n        return this.froca.getBranches(branchIds);\n    }\n\n    /**\n     * @returns {FBranch[]}\n     * @deprecated use getParentBranches() instead\n     */\n    getBranches() {\n        return this.getParentBranches();\n    }\n\n    /** @returns {boolean} */\n    hasChildren() {\n        return this.children.length > 0;\n    }\n\n    /** @returns {FBranch[]} */\n    getChildBranches() {\n        // don't use Object.values() to guarantee order\n        const branchIds = this.children.map(childNoteId => this.childToBranch[childNoteId]);\n\n        return this.froca.getBranches(branchIds);\n    }\n\n    /** @returns {string[]} */\n    getParentNoteIds() {\n        return this.parents;\n    }\n\n    /** @returns {FNote[]} */\n    getParentNotes() {\n        return this.froca.getNotesFromCache(this.parents);\n    }\n\n    // will sort the parents so that non-search & non-archived are first and archived at the end\n    // this is done so that non-search & non-archived paths are always explored as first when looking for a note path\n    sortParents() {\n        this.parents.sort((aNoteId, bNoteId) => {\n            const aBranchId = this.parentToBranch[aNoteId];\n\n            if (aBranchId && aBranchId.startsWith('virt-')) {\n                return 1;\n            }\n\n            const aNote = this.froca.getNoteFromCache(aNoteId);\n\n            if (aNote.isArchived || aNote.isHiddenCompletely()) {\n                return 1;\n            }\n\n            return aNoteId < bNoteId ? -1 : 1;\n        });\n    }\n\n    get isArchived() {\n        return this.hasAttribute('label', 'archived');\n    }\n\n    /** @returns {string[]} */\n    getChildNoteIds() {\n        return this.children;\n    }\n\n    /** @returns {Promise<FNote[]>} */\n    async getChildNotes() {\n        return await this.froca.getNotes(this.children);\n    }\n\n    /** @returns {Promise<FAttachment[]>} */\n    async getAttachments() {\n        if (!this.attachments) {\n            this.attachments = await this.froca.getAttachmentsForNote(this.noteId);\n        }\n\n        return this.attachments;\n    }\n\n    /** @returns {Promise<FAttachment[]>} */\n    async getAttachmentsByRole(role) {\n        return (await this.getAttachments())\n            .filter(attachment => attachment.role === role);\n    }\n\n    /** @returns {Promise<FAttachment>} */\n    async getAttachmentById(attachmentId) {\n        const attachments = await this.getAttachments();\n\n        return attachments.find(att => att.attachmentId === attachmentId);\n    }\n\n    isEligibleForConversionToAttachment() {\n        if (this.type !== 'image' || !this.isContentAvailable() || this.hasChildren() || this.getParentBranches().length !== 1) {\n            return false;\n        }\n\n        const targetRelations = this.getTargetRelations().filter(relation => relation.name === 'imageLink');\n\n        if (targetRelations.length > 1) {\n            return false;\n        }\n\n        const parentNote = this.getParentNotes()[0]; // at this point note can have only one parent\n        const referencingNote = targetRelations[0]?.getNote();\n\n        if (referencingNote && referencingNote !== parentNote) {\n            return false;\n        } else if (parentNote.type !== 'text' || !parentNote.isContentAvailable()) {\n            return false;\n        }\n\n        return true;\n    }\n\n    /**\n     * @param {string} [type] - (optional) attribute type to filter\n     * @param {string} [name] - (optional) attribute name to filter\n     * @returns {FAttribute[]} all note's attributes, including inherited ones\n     */\n    getOwnedAttributes(type, name) {\n        const attrs = this.attributes\n            .map(attributeId => this.froca.attributes[attributeId])\n            .filter(Boolean); // filter out nulls;\n\n        return this.__filterAttrs(attrs, type, name);\n    }\n\n    /**\n     * @param {string} [type] - (optional) attribute type to filter\n     * @param {string} [name] - (optional) attribute name to filter\n     * @returns {FAttribute[]} all note's attributes, including inherited ones\n     */\n    getAttributes(type, name) {\n        return this.__filterAttrs(this.__getCachedAttributes([]), type, name);\n    }\n\n    /**\n     * @param {string[]} path\n     * @return {FAttribute[]}\n     * @private\n     */\n    __getCachedAttributes(path) {\n        // notes/clones cannot form tree cycles, it is possible to create attribute inheritance cycle via templates\n        // when template instance is a parent of template itself\n        if (path.includes(this.noteId)) {\n            return [];\n        }\n\n        if (!(this.noteId in noteAttributeCache.attributes)) {\n            const newPath = [...path, this.noteId];\n            const attrArrs = [ this.getOwnedAttributes() ];\n\n            // inheritable attrs on root are typically not intended to be applied to hidden subtree #3537\n            if (this.noteId !== 'root' && this.noteId !== '_hidden') {\n                for (const parentNote of this.getParentNotes()) {\n                    // these virtual parent-child relationships are also loaded into froca\n                    if (parentNote.type !== 'search') {\n                        attrArrs.push(parentNote.__getInheritableAttributes(newPath));\n                    }\n                }\n            }\n\n            for (const templateAttr of attrArrs.flat().filter(attr => attr.type === 'relation' && ['template', 'inherit'].includes(attr.name))) {\n                const templateNote = this.froca.notes[templateAttr.value];\n\n                if (templateNote && templateNote.noteId !== this.noteId) {\n                    attrArrs.push(\n                        templateNote.__getCachedAttributes(newPath)\n                            // template attr is used as a marker for templates, but it's not meant to be inherited\n                            .filter(attr => !(attr.type === 'label' && (attr.name === 'template' || attr.name === 'workspacetemplate')))\n                    );\n                }\n            }\n\n            noteAttributeCache.attributes[this.noteId] = [];\n            const addedAttributeIds = new Set();\n\n            for (const attr of attrArrs.flat()) {\n                if (!addedAttributeIds.has(attr.attributeId)) {\n                    addedAttributeIds.add(attr.attributeId);\n\n                    noteAttributeCache.attributes[this.noteId].push(attr);\n                }\n            }\n        }\n\n        return noteAttributeCache.attributes[this.noteId];\n    }\n\n    isRoot() {\n        return this.noteId === 'root';\n    }\n\n    /**\n     * Gives all possible note paths leading to this note. Paths containing search note are ignored (could form cycles)\n     *\n     * @returns {string[][]} - array of notePaths (each represented by array of noteIds constituting the particular note path)\n     */\n    getAllNotePaths() {\n        if (this.noteId === 'root') {\n            return [['root']];\n        }\n\n        const parentNotes = this.getParentNotes().filter(note => note.type !== 'search');\n\n        const notePaths = parentNotes.length === 1\n            ? parentNotes[0].getAllNotePaths() // optimization for the most common case\n            : parentNotes.flatMap(parentNote => parentNote.getAllNotePaths());\n\n        for (const notePath of notePaths) {\n            notePath.push(this.noteId);\n        }\n\n        return notePaths;\n    }\n\n    /**\n     * @param {string} [hoistedNoteId='root']\n     * @return {Array<NotePathRecord>}\n     */\n    getSortedNotePathRecords(hoistedNoteId = 'root') {\n        const isHoistedRoot = hoistedNoteId === 'root';\n\n        const notePaths = this.getAllNotePaths().map(path => ({\n            notePath: path,\n            isInHoistedSubTree: isHoistedRoot || path.includes(hoistedNoteId),\n            isArchived: path.some(noteId => froca.notes[noteId].isArchived),\n            isSearch: path.find(noteId => froca.notes[noteId].type === 'search'),\n            isHidden: path.includes('_hidden')\n        }));\n\n        notePaths.sort((a, b) => {\n            if (a.isInHoistedSubTree !== b.isInHoistedSubTree) {\n                return a.isInHoistedSubTree ? -1 : 1;\n            } else if (a.isArchived !== b.isArchived) {\n                return a.isArchived ? 1 : -1;\n            } else if (a.isHidden !== b.isHidden) {\n                return a.isHidden ? 1 : -1;\n            } else if (a.isSearch !== b.isSearch) {\n                return a.isSearch ? 1 : -1;\n            } else {\n                return a.notePath.length - b.notePath.length;\n            }\n        });\n\n        return notePaths;\n    }\n\n    /**\n     * Returns the note path considered to be the \"best\"\n     *\n     * @param {string} [hoistedNoteId='root']\n     * @return {string[]} array of noteIds constituting the particular note path\n     */\n    getBestNotePath(hoistedNoteId = 'root') {\n        return this.getSortedNotePathRecords(hoistedNoteId)[0]?.notePath;\n    }\n\n    /**\n     * Returns the note path considered to be the \"best\"\n     *\n     * @param {string} [hoistedNoteId='root']\n     * @return {string} serialized note path (e.g. 'root/a1h315/js725h')\n     */\n    getBestNotePathString(hoistedNoteId = 'root') {\n        const notePath = this.getBestNotePath(hoistedNoteId);\n\n        return notePath?.join(\"/\");\n    }\n\n    /**\n     * @return boolean - true if there's no non-hidden path, note is not cloned to the visible tree\n     */\n    isHiddenCompletely() {\n        if (this.noteId === '_hidden') {\n            return true;\n        } else if (this.noteId === 'root') {\n            return false;\n        }\n\n        for (const parentNote of this.getParentNotes()) {\n            if (parentNote.noteId === 'root') {\n                return false;\n            } else if (parentNote.noteId === '_hidden' || parentNote.type === 'search') {\n                continue;\n            }\n\n            if (!parentNote.isHiddenCompletely()) {\n                return false;\n            }\n        }\n\n        return true;\n    }\n\n    /**\n     * @param {FAttribute[]} attributes\n     * @param {AttributeType} type\n     * @param {string} name\n     * @return {FAttribute[]}\n     * @private\n     */\n    __filterAttrs(attributes, type, name) {\n        this.__validateTypeName(type, name);\n\n        if (!type && !name) {\n            return attributes;\n        } else if (type && name) {\n            return attributes.filter(attr => attr.name === name && attr.type === type);\n        } else if (type) {\n            return attributes.filter(attr => attr.type === type);\n        } else if (name) {\n            return attributes.filter(attr => attr.name === name);\n        }\n    }\n\n    __getInheritableAttributes(path) {\n        const attrs = this.__getCachedAttributes(path);\n\n        return attrs.filter(attr => attr.isInheritable);\n    }\n\n    __validateTypeName(type, name) {\n        if (type && type !== 'label' && type !== 'relation') {\n            throw new Error(`Unrecognized attribute type '${type}'. Only 'label' and 'relation' are possible values.`);\n        }\n\n        if (name) {\n            const firstLetter = name.charAt(0);\n            if (firstLetter === '#' || firstLetter === '~') {\n                throw new Error(`Detect '#' or '~' in the attribute's name. In the API, attribute names should be set without these characters.`);\n            }\n        }\n    }\n\n    /**\n     * @param {string} [name] - label name to filter\n     * @returns {FAttribute[]} all note's labels (attributes with type label), including inherited ones\n     */\n    getOwnedLabels(name) {\n        return this.getOwnedAttributes(LABEL, name);\n    }\n\n    /**\n     * @param {string} [name] - label name to filter\n     * @returns {FAttribute[]} all note's labels (attributes with type label), including inherited ones\n     */\n    getLabels(name) {\n        return this.getAttributes(LABEL, name);\n    }\n\n    getIcon() {\n        const iconClassLabels = this.getLabels('iconClass');\n        const workspaceIconClass = this.getWorkspaceIconClass();\n\n        if (iconClassLabels.length > 0) {\n            return iconClassLabels[0].value;\n        }\n        else if (workspaceIconClass) {\n            return workspaceIconClass;\n        }\n        else if (this.noteId === 'root') {\n            return \"bx bx-chevrons-right\";\n        }\n        if (this.noteId === '_share') {\n            return \"bx bx-share-alt\";\n        }\n        else if (this.type === 'text') {\n            if (this.isFolder()) {\n                return \"bx bx-folder\";\n            }\n            else {\n                return \"bx bx-note\";\n            }\n        }\n        else if (this.type === 'code' && this.mime.startsWith('text/x-sql')) {\n            return \"bx bx-data\";\n        }\n        else {\n            return NOTE_TYPE_ICONS[this.type];\n        }\n    }\n\n    getColorClass() {\n        const color = this.getLabelValue(\"color\");\n        return cssClassManager.createClassForColor(color);\n    }\n\n    isFolder() {\n        return this.type === 'search'\n            || this.getFilteredChildBranches().length > 0;\n    }\n\n    getFilteredChildBranches() {\n        let childBranches = this.getChildBranches();\n\n        if (!childBranches) {\n            ws.logError(`No children for '${this.noteId}'. This shouldn't happen.`);\n            return;\n        }\n\n        // we're not checking hideArchivedNotes since that would mean we need to lazy load the child notes\n        // which would seriously slow down everything.\n        // we check this flag only once user chooses to expand the parent. This has the negative consequence that\n        // note may appear as a folder but not contain any children when all of them are archived\n\n        return childBranches;\n    }\n\n    /**\n     * @param {string} [name] - relation name to filter\n     * @returns {FAttribute[]} all note's relations (attributes with type relation), including inherited ones\n     */\n    getOwnedRelations(name) {\n        return this.getOwnedAttributes(RELATION, name);\n    }\n\n    /**\n     * @param {string} [name] - relation name to filter\n     * @returns {FAttribute[]} all note's relations (attributes with type relation), including inherited ones\n     */\n    getRelations(name) {\n        return this.getAttributes(RELATION, name);\n    }\n\n    /**\n     * @param {AttributeType} type - attribute type (label, relation, etc.)\n     * @param {string} name - attribute name\n     * @returns {boolean} true if note has an attribute with given type and name (including inherited)\n     */\n    hasAttribute(type, name) {\n        const attributes = this.getAttributes();\n\n        return attributes.some(attr => attr.name === name && attr.type === type);\n    }\n\n    /**\n     * @param {AttributeType} type - attribute type (label, relation, etc.)\n     * @param {string} name - attribute name\n     * @returns {boolean} true if note has an attribute with given type and name (including inherited)\n     */\n    hasOwnedAttribute(type, name) {\n        return !!this.getOwnedAttribute(type, name);\n    }\n\n    /**\n     * @param {AttributeType} type - attribute type (label, relation, etc.)\n     * @param {string} name - attribute name\n     * @returns {FAttribute} attribute of the given type and name. If there are more such attributes, first is returned. Returns null if there's no such attribute belonging to this note.\n     */\n    getOwnedAttribute(type, name) {\n        const attributes = this.getOwnedAttributes();\n\n        return attributes.find(attr => attr.name === name && attr.type === type);\n    }\n\n    /**\n     * @param {AttributeType} type - attribute type (label, relation, etc.)\n     * @param {string} name - attribute name\n     * @returns {FAttribute} attribute of the given type and name. If there are more such attributes, first is returned. Returns null if there's no such attribute belonging to this note.\n     */\n    getAttribute(type, name) {\n        const attributes = this.getAttributes();\n\n        return attributes.find(attr => attr.name === name && attr.type === type);\n    }\n\n    /**\n     * @param {AttributeType} type - attribute type (label, relation, etc.)\n     * @param {string} name - attribute name\n     * @returns {string} attribute value of the given type and name or null if no such attribute exists.\n     */\n    getOwnedAttributeValue(type, name) {\n        const attr = this.getOwnedAttribute(type, name);\n\n        return attr ? attr.value : null;\n    }\n\n    /**\n     * @param {AttributeType} type - attribute type (label, relation, etc.)\n     * @param {string} name - attribute name\n     * @returns {string} attribute value of the given type and name or null if no such attribute exists.\n     */\n    getAttributeValue(type, name) {\n        const attr = this.getAttribute(type, name);\n\n        return attr ? attr.value : null;\n    }\n\n    /**\n     * @param {string} name - label name\n     * @returns {boolean} true if label exists (excluding inherited)\n     */\n    hasOwnedLabel(name) { return this.hasOwnedAttribute(LABEL, name); }\n\n    /**\n     * @param {string} name - label name\n     * @returns {boolean} true if label exists (including inherited)\n     */\n    hasLabel(name) { return this.hasAttribute(LABEL, name); }\n\n    /**\n     * @param {string} name - label name\n     * @returns {boolean} true if label exists (including inherited) and does not have \"false\" value.\n     */\n    isLabelTruthy(name) {\n        const label = this.getLabel(name);\n\n        if (!label) {\n            return false;\n        }\n\n        return label && label.value !== 'false';\n    }\n\n    /**\n     * @param {string} name - relation name\n     * @returns {boolean} true if relation exists (excluding inherited)\n     */\n    hasOwnedRelation(name) { return this.hasOwnedAttribute(RELATION, name); }\n\n    /**\n     * @param {string} name - relation name\n     * @returns {boolean} true if relation exists (including inherited)\n     */\n    hasRelation(name) { return this.hasAttribute(RELATION, name); }\n\n    /**\n     * @param {string} name - label name\n     * @returns {FAttribute} label if it exists, null otherwise\n     */\n    getOwnedLabel(name) { return this.getOwnedAttribute(LABEL, name); }\n\n    /**\n     * @param {string} name - label name\n     * @returns {FAttribute} label if it exists, null otherwise\n     */\n    getLabel(name) { return this.getAttribute(LABEL, name); }\n\n    /**\n     * @param {string} name - relation name\n     * @returns {FAttribute} relation if it exists, null otherwise\n     */\n    getOwnedRelation(name) { return this.getOwnedAttribute(RELATION, name); }\n\n    /**\n     * @param {string} name - relation name\n     * @returns {FAttribute} relation if it exists, null otherwise\n     */\n    getRelation(name) { return this.getAttribute(RELATION, name); }\n\n    /**\n     * @param {string} name - label name\n     * @returns {string} label value if label exists, null otherwise\n     */\n    getOwnedLabelValue(name) { return this.getOwnedAttributeValue(LABEL, name); }\n\n    /**\n     * @param {string} name - label name\n     * @returns {string} label value if label exists, null otherwise\n     */\n    getLabelValue(name) { return this.getAttributeValue(LABEL, name); }\n\n    /**\n     * @param {string} name - relation name\n     * @returns {string} relation value if relation exists, null otherwise\n     */\n    getOwnedRelationValue(name) { return this.getOwnedAttributeValue(RELATION, name); }\n\n    /**\n     * @param {string} name - relation name\n     * @returns {string} relation value if relation exists, null otherwise\n     */\n    getRelationValue(name) { return this.getAttributeValue(RELATION, name); }\n\n    /**\n     * @param {string} name\n     * @returns {Promise<FNote>|null} target note of the relation or null (if target is empty or note was not found)\n     */\n    async getRelationTarget(name) {\n        const targets = await this.getRelationTargets(name);\n\n        return targets.length > 0 ? targets[0] : null;\n    }\n\n    /**\n     * @param {string} [name] - relation name to filter\n     * @returns {Promise<FNote[]>}\n     */\n    async getRelationTargets(name) {\n        const relations = this.getRelations(name);\n        const targets = [];\n\n        for (const relation of relations) {\n            targets.push(await this.froca.getNote(relation.value));\n        }\n\n        return targets;\n    }\n\n    /**\n     * @returns {FNote[]}\n     */\n    getNotesToInheritAttributesFrom() {\n        const relations = [\n            ...this.getRelations('template'),\n            ...this.getRelations('inherit')\n        ];\n\n        return relations.map(rel => this.froca.notes[rel.value]);\n    }\n\n    getPromotedDefinitionAttributes() {\n        if (this.isLabelTruthy('hidePromotedAttributes')) {\n            return [];\n        }\n\n        const promotedAttrs = this.getAttributes()\n            .filter(attr => attr.isDefinition())\n            .filter(attr => {\n                const def = attr.getDefinition();\n\n                return def && def.isPromoted;\n            });\n\n        // attrs are not resorted if position changes after the initial load\n        promotedAttrs.sort((a, b) => {\n            if (a.noteId === b.noteId) {\n                return a.position < b.position ? -1 : 1;\n            } else {\n                // inherited promoted attributes should stay grouped: https://github.com/zadam/trilium/issues/3761\n                return a.noteId < b.noteId ? -1 : 1;\n            }\n        });\n\n        return promotedAttrs;\n    }\n\n    hasAncestor(ancestorNoteId, followTemplates = false, visitedNoteIds = null) {\n        if (this.noteId === ancestorNoteId) {\n            return true;\n        }\n\n        if (!visitedNoteIds) {\n            visitedNoteIds = new Set();\n        } else if (visitedNoteIds.has(this.noteId)) {\n            // to avoid infinite cycle when template is descendent of the instance\n            return false;\n        }\n\n        visitedNoteIds.add(this.noteId);\n\n        if (followTemplates) {\n            for (const templateNote of this.getNotesToInheritAttributesFrom()) {\n                if (templateNote.hasAncestor(ancestorNoteId, followTemplates, visitedNoteIds)) {\n                    return true;\n                }\n            }\n        }\n\n        for (const parentNote of this.getParentNotes()) {\n            if (parentNote.hasAncestor(ancestorNoteId, followTemplates, visitedNoteIds)) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    isInHiddenSubtree() {\n        return this.noteId === '_hidden' || this.hasAncestor('_hidden');\n    }\n\n    /**\n     * @deprecated NOOP\n     */\n    invalidateAttributeCache() {}\n\n    /**\n     * Get relations which target this note\n     *\n     * @returns {FAttribute[]}\n     */\n    getTargetRelations() {\n        return this.targetRelations\n            .map(attributeId => this.froca.attributes[attributeId]);\n    }\n\n    /**\n     * Get relations which target this note\n     *\n     * @returns {Promise<FNote[]>}\n     */\n    async getTargetRelationSourceNotes() {\n        const targetRelations = this.getTargetRelations();\n\n        return await this.froca.getNotes(targetRelations.map(tr => tr.noteId));\n    }\n\n    /**\n     * @deprecated use getBlob() instead\n     * @return {Promise<FBlob>}\n     */\n    async getNoteComplement() {\n        return this.getBlob();\n    }\n\n    /** @return {Promise<FBlob>} */\n    async getBlob() {\n        return await this.froca.getBlob('notes', this.noteId);\n    }\n\n    toString() {\n        return `Note(noteId=${this.noteId}, title=${this.title})`;\n    }\n\n    get dto() {\n        const dto = Object.assign({}, this);\n        delete dto.froca;\n\n        return dto;\n    }\n\n    getCssClass() {\n        const labels = this.getLabels('cssClass');\n        return labels.map(l => l.value).join(' ');\n    }\n\n    getWorkspaceIconClass() {\n        const labels = this.getLabels('workspaceIconClass');\n        return labels.length > 0 ? labels[0].value : \"\";\n    }\n\n    getWorkspaceTabBackgroundColor() {\n        const labels = this.getLabels('workspaceTabBackgroundColor');\n        return labels.length > 0 ? labels[0].value : \"\";\n    }\n\n    /** @returns {boolean} true if this note is JavaScript (code or file) */\n    isJavaScript() {\n        return (this.type === \"code\" || this.type === \"file\" || this.type === 'launcher')\n            && (this.mime.startsWith(\"application/javascript\")\n                || this.mime === \"application/x-javascript\"\n                || this.mime === \"text/javascript\");\n    }\n\n    /** @returns {boolean} true if this note is HTML */\n    isHtml() {\n        return (this.type === \"code\" || this.type === \"file\" || this.type === \"render\") && this.mime === \"text/html\";\n    }\n\n    /** @returns {string|null} JS script environment - either \"frontend\" or \"backend\" */\n    getScriptEnv() {\n        if (this.isHtml() || (this.isJavaScript() && this.mime.endsWith('env=frontend'))) {\n            return \"frontend\";\n        }\n\n        if (this.type === 'render') {\n            return \"frontend\";\n        }\n\n        if (this.isJavaScript() && this.mime.endsWith('env=backend')) {\n            return \"backend\";\n        }\n\n        return null;\n    }\n\n    async executeScript() {\n        if (!this.isJavaScript()) {\n            throw new Error(`Note ${this.noteId} is of type ${this.type} and mime ${this.mime} and thus cannot be executed`);\n        }\n\n        const env = this.getScriptEnv();\n\n        if (env === \"frontend\") {\n            const bundleService = (await import(\"../services/bundle.js\")).default;\n            return await bundleService.getAndExecuteBundle(this.noteId);\n        }\n        else if (env === \"backend\") {\n            const resp = await server.post(`script/run/${this.noteId}`);\n        }\n        else {\n            throw new Error(`Unrecognized env type ${env} for note ${this.noteId}`);\n        }\n    }\n\n    isShared() {\n        for (const parentNoteId of this.parents) {\n            if (parentNoteId === 'root' || parentNoteId === 'none') {\n                continue;\n            }\n\n            const parentNote = froca.notes[parentNoteId];\n\n            if (!parentNote || parentNote.type === 'search') {\n                continue;\n            }\n\n            if (parentNote.noteId === '_share' || parentNote.isShared()) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    isContentAvailable() {\n        return !this.isProtected || protectedSessionHolder.isProtectedSessionAvailable()\n    }\n\n    isLaunchBarConfig() {\n        return this.type === 'launcher' || ['_lbRoot', '_lbAvailableLaunchers', '_lbVisibleLaunchers'].includes(this.noteId);\n    }\n\n    isOptions() {\n        return this.noteId.startsWith(\"_options\");\n    }\n\n    /**\n     * Provides note's date metadata.\n     *\n     * @returns {Promise<{dateCreated: string, utcDateCreated: string, dateModified: string, utcDateModified: string}>}\n     */\n    async getMetadata() {\n        return await server.get(`notes/${this.noteId}/metadata`);\n    }\n}\n\nexport default FNote;\n","import keyboardActionService from '../services/keyboard_actions.js';\n\nclass ContextMenu {\n    constructor() {\n        this.$widget = $(\"#context-menu-container\");\n        this.dateContextMenuOpenedMs = 0;\n\n        $(document).on('click', () => this.hide());\n    }\n\n    async show(options) {\n        this.options = options;\n\n        this.$widget.empty();\n\n        this.addItems(this.$widget, options.items);\n\n        keyboardActionService.updateDisplayedShortcuts(this.$widget);\n\n        this.positionMenu();\n\n        this.dateContextMenuOpenedMs = Date.now();\n    }\n\n    positionMenu() {\n        // the code below tries to detect when dropdown would overflow from page\n        // in such case we'll position it above click coordinates, so it will fit into the client\n\n        const CONTEXT_MENU_PADDING = 5; // How many pixels to pad the context menu from edge of screen\n        const CONTEXT_MENU_OFFSET = 0; // How many pixels to offset the context menu by relative to cursor, see #3157\n\n        const clientHeight = document.documentElement.clientHeight;\n        const clientWidth = document.documentElement.clientWidth;\n        const contextMenuHeight = this.$widget.outerHeight();\n        const contextMenuWidth = this.$widget.outerWidth();\n        let top, left;\n\n        if (this.options.y + contextMenuHeight - CONTEXT_MENU_OFFSET > clientHeight - CONTEXT_MENU_PADDING) {\n            // Overflow: bottom\n            top = clientHeight - contextMenuHeight - CONTEXT_MENU_PADDING;\n        } else if (this.options.y - CONTEXT_MENU_OFFSET < CONTEXT_MENU_PADDING) {\n            // Overflow: top\n            top = CONTEXT_MENU_PADDING;\n        } else {\n            top = this.options.y - CONTEXT_MENU_OFFSET;\n        }\n\n        if (this.options.orientation === 'left') {\n            if (this.options.x + CONTEXT_MENU_OFFSET > clientWidth - CONTEXT_MENU_PADDING) {\n                // Overflow: right\n                left = clientWidth - contextMenuWidth - CONTEXT_MENU_OFFSET;\n            } else if (this.options.x - contextMenuWidth + CONTEXT_MENU_OFFSET < CONTEXT_MENU_PADDING) {\n                // Overflow: left\n                left = CONTEXT_MENU_PADDING;\n            } else {\n                left = this.options.x - contextMenuWidth + CONTEXT_MENU_OFFSET;\n            }\n        } else {\n            if (this.options.x + contextMenuWidth - CONTEXT_MENU_OFFSET > clientWidth - CONTEXT_MENU_PADDING) {\n                // Overflow: right\n                left = clientWidth - contextMenuWidth - CONTEXT_MENU_PADDING;\n            } else if (this.options.x - CONTEXT_MENU_OFFSET < CONTEXT_MENU_PADDING) {\n                // Overflow: left\n                left = CONTEXT_MENU_PADDING;\n            } else {\n                left = this.options.x - CONTEXT_MENU_OFFSET;\n            }\n        }\n\n        this.$widget.css({\n            display: \"block\",\n            top: top,\n            left: left\n        }).addClass(\"show\");\n    }\n\n    addItems($parent, items) {\n        for (const item of items) {\n            if (!item) {\n                continue;\n            }\n\n            if (item.title === '----') {\n                $parent.append($(\"<div>\").addClass(\"dropdown-divider\"));\n            } else {\n                const $icon = $(\"<span>\");\n\n                if (item.uiIcon) {\n                    $icon.addClass(item.uiIcon);\n                } else {\n                    $icon.append(\"&nbsp;\");\n                }\n\n                const $link = $(\"<span>\")\n                    .append($icon)\n                    .append(\" &nbsp; \") // some space between icon and text\n                    .append(item.title);\n\n                const $item = $(\"<li>\")\n                    .addClass(\"dropdown-item\")\n                    .append($link)\n                    .on('contextmenu', e => false)\n                    // important to use mousedown instead of click since the former does not change focus\n                    // (especially important for focused text for spell check)\n                    .on('mousedown', e => {\n                        e.stopPropagation();\n\n                        if (e.which !== 1) { // only left click triggers menu items\n                            return false;\n                        }\n\n                        this.hide();\n\n                        if (item.handler) {\n                            item.handler(item, e);\n                        }\n\n                        this.options.selectMenuItemHandler(item, e);\n\n                        // it's important to stop the propagation especially for sub-menus, otherwise the event\n                        // might be handled again by top-level menu\n                        return false;\n                    });\n\n                if (item.enabled !== undefined && !item.enabled) {\n                    $item.addClass(\"disabled\");\n                }\n\n                if (item.items) {\n                    $item.addClass(\"dropdown-submenu\");\n                    $link.addClass(\"dropdown-toggle\");\n\n                    const $subMenu = $(\"<ul>\").addClass(\"dropdown-menu\");\n\n                    this.addItems($subMenu, item.items);\n\n                    $item.append($subMenu);\n                }\n\n                $parent.append($item);\n            }\n        }\n    }\n\n    hide() {\n        // this date checking comes from change in FF66 - https://github.com/zadam/trilium/issues/468\n        // \"contextmenu\" event also triggers \"click\" event which depending on the timing can close the just opened context menu\n        // we might filter out right clicks, but then it's better if even right clicks close the context menu\n        if (Date.now() - this.dateContextMenuOpenedMs > 300) {\n            // seems like if we hide the menu immediately, some clicks can get propagated to the underlying component\n            // see https://github.com/zadam/trilium/pull/3805 for details\n            setTimeout(() => this.$widget.hide(), 100);\n        }\n    }\n}\n\nconst contextMenu = new ContextMenu();\n\nexport default contextMenu;\n","import contextMenu from \"./context_menu.js\";\nimport appContext from \"../components/app_context.js\";\n\nfunction openContextMenu(notePath, e, viewScope = {}, hoistedNoteId = null) {\n    contextMenu.show({\n        x: e.pageX,\n        y: e.pageY,\n        items: [\n            {title: \"在新标签页中打开笔记\", command: \"openNoteInNewTab\", uiIcon: \"bx bx-empty\"},\n            {title: \"在新的拆分中打开笔记\", command: \"openNoteInNewSplit\", uiIcon: \"bx bx-dock-right\"},\n            {title: \"在新窗口中打开笔记\", command: \"openNoteInNewWindow\", uiIcon: \"bx bx-window-open\"}\n        ],\n        selectMenuItemHandler: ({command}) => {\n            if (!hoistedNoteId) {\n                hoistedNoteId = appContext.tabManager.getActiveContext().hoistedNoteId;\n            }\n\n            if (command === 'openNoteInNewTab') {\n                appContext.tabManager.openContextWithNote(notePath, { hoistedNoteId, viewScope });\n            }\n            else if (command === 'openNoteInNewSplit') {\n                const subContexts = appContext.tabManager.getActiveContext().getSubContexts();\n                const {ntxId} = subContexts[subContexts.length - 1];\n\n                appContext.triggerCommand(\"openNewNoteSplit\", {ntxId, notePath, hoistedNoteId, viewScope});\n            }\n            else if (command === 'openNoteInNewWindow') {\n                appContext.triggerCommand('openInWindow', {notePath, hoistedNoteId, viewScope});\n            }\n        }\n    });\n}\n\nexport default {\n    openContextMenu\n}\n","import ws from \"./ws.js\";\nimport froca from \"./froca.js\";\n\nasync function renderAttribute(attribute, renderIsInheritable) {\n    const isInheritable = renderIsInheritable && attribute.isInheritable ? `(可继承的)` : '';\n    const $attr = $(\"<span>\");\n\n    if (attribute.type === 'label') {\n        $attr.append(document.createTextNode(`#${attribute.name}${isInheritable}`));\n\n        if (attribute.value) {\n            $attr.append('=');\n            $attr.append(document.createTextNode(formatValue(attribute.value)));\n        }\n    } else if (attribute.type === 'relation') {\n        if (attribute.isAutoLink) {\n            return $attr;\n        }\n\n        // when the relation has just been created, then it might not have a value\n        if (attribute.value) {\n            $attr.append(document.createTextNode(`~${attribute.name}${isInheritable}=`));\n            $attr.append(await createLink(attribute.value));\n        }\n    } else {\n        ws.logError(`Unknown attr type: ${attribute.type}`);\n    }\n\n    return $attr;\n}\n\nfunction formatValue(val) {\n    if (/^[\\p{L}\\p{N}\\-_,.]+$/u.test(val)) {\n        return val;\n    }\n    else if (!val.includes('\"')) {\n        return `\"${val}\"`;\n    }\n    else if (!val.includes(\"'\")) {\n        return `'${val}'`;\n    }\n    else if (!val.includes(\"`\")) {\n        return `\\`${val}\\``;\n    }\n    else {\n        return `\"${val.replace(/\"/g, '\\\\\"')}\"`;\n    }\n}\n\nasync function createLink(noteId) {\n    const note = await froca.getNote(noteId);\n\n    if (!note) {\n        return;\n    }\n\n    return $(\"<a>\", {\n        href: `#root/${noteId}`,\n        class: 'reference-link'\n    })\n        .text(note.title);\n}\n\nasync function renderAttributes(attributes, renderIsInheritable) {\n    const $container = $('<span class=\"rendered-note-attributes\">');\n\n    for (let i = 0; i < attributes.length; i++) {\n        const attribute = attributes[i];\n\n        const $attr = await renderAttribute(attribute, renderIsInheritable);\n        $container.append($attr.html()); // .html() to get only inner HTML, we don't want any spans\n\n        if (i < attributes.length - 1) {\n            $container.append(\" \");\n        }\n    }\n\n    return $container;\n}\n\nconst HIDDEN_ATTRIBUTES = [\n    'originalFileName',\n    'fileSize',\n    'template',\n    'inherit',\n    'cssClass',\n    'iconClass',\n    'pageSize',\n    'viewType'\n];\n\nasync function renderNormalAttributes(note) {\n    const promotedDefinitionAttributes = note.getPromotedDefinitionAttributes();\n    let attrs = note.getAttributes();\n\n    if (promotedDefinitionAttributes.length > 0) {\n        attrs = attrs.filter(attr => !!promotedDefinitionAttributes.find(promAttr => promAttr.isDefinitionFor(attr)));\n    }\n    else {\n        attrs = attrs.filter(\n            attr => !attr.isDefinition()\n                 && !attr.isAutoLink\n                 && !HIDDEN_ATTRIBUTES.includes(attr.name)\n                 && attr.noteId === note.noteId\n        );\n    }\n\n    const $renderedAttributes = await renderAttributes(attrs, false);\n\n    return {\n        count: attrs.length,\n        $renderedAttributes\n    }\n}\n\nexport default {\n    renderAttribute,\n    renderAttributes,\n    renderNormalAttributes\n}\n","import utils from './utils.js';\nimport server from './server.js';\nimport toastService from \"./toast.js\";\nimport froca from \"./froca.js\";\nimport hoistedNoteService from \"./hoisted_note.js\";\nimport ws from \"./ws.js\";\nimport appContext from \"../components/app_context.js\";\n\nasync function moveBeforeBranch(branchIdsToMove, beforeBranchId) {\n    branchIdsToMove = filterRootNote(branchIdsToMove);\n    branchIdsToMove = filterSearchBranches(branchIdsToMove);\n\n    const beforeBranch = froca.getBranch(beforeBranchId);\n\n    if (['root', '_lbRoot', '_lbAvailableLaunchers', '_lbVisibleLaunchers'].includes(beforeBranch.noteId)) {\n        toastService.showError('无法在此移动笔记。');\n        return;\n    }\n\n    for (const branchIdToMove of branchIdsToMove) {\n        const resp = await server.put(`branches/${branchIdToMove}/move-before/${beforeBranchId}`);\n\n        if (!resp.success) {\n            toastService.showError(resp.message);\n            return;\n        }\n    }\n}\n\nasync function moveAfterBranch(branchIdsToMove, afterBranchId) {\n    branchIdsToMove = filterRootNote(branchIdsToMove);\n    branchIdsToMove = filterSearchBranches(branchIdsToMove);\n\n    const afterNote = froca.getBranch(afterBranchId).getNote();\n\n    const forbiddenNoteIds = [\n        'root',\n        hoistedNoteService.getHoistedNoteId(),\n        '_lbRoot',\n        '_lbAvailableLaunchers',\n        '_lbVisibleLaunchers'\n    ];\n\n    if (forbiddenNoteIds.includes(afterNote.noteId)) {\n        toastService.showError('无法在此移动笔记。');\n        return;\n    }\n\n    branchIdsToMove.reverse(); // need to reverse to keep the note order\n\n    for (const branchIdToMove of branchIdsToMove) {\n        const resp = await server.put(`branches/${branchIdToMove}/move-after/${afterBranchId}`);\n\n        if (!resp.success) {\n            toastService.showError(resp.message);\n            return;\n        }\n    }\n}\n\nasync function moveToParentNote(branchIdsToMove, newParentBranchId) {\n    const newParentBranch = froca.getBranch(newParentBranchId);\n\n    if (newParentBranch.noteId === '_lbRoot') {\n        toastService.showError('无法在此移动笔记。');\n        return;\n    }\n\n    branchIdsToMove = filterRootNote(branchIdsToMove);\n\n    for (const branchIdToMove of branchIdsToMove) {\n        const branchToMove = froca.getBranch(branchIdToMove);\n\n        if (branchToMove.noteId === hoistedNoteService.getHoistedNoteId()\n            || (await branchToMove.getParentNote()).type === 'search') {\n            continue;\n        }\n\n        const resp = await server.put(`branches/${branchIdToMove}/move-to/${newParentBranchId}`);\n\n        if (!resp.success) {\n            toastService.showError(resp.message);\n            return;\n        }\n    }\n}\n\nasync function deleteNotes(branchIdsToDelete, forceDeleteAllClones = false) {\n    branchIdsToDelete = filterRootNote(branchIdsToDelete);\n\n    if (branchIdsToDelete.length === 0) {\n        return false;\n    }\n\n    let proceed, deleteAllClones, eraseNotes;\n\n    if (utils.isMobile()) {\n        proceed = true;\n        deleteAllClones = false;\n    }\n    else {\n        ({proceed, deleteAllClones, eraseNotes} = await new Promise(res =>\n            appContext.triggerCommand('showDeleteNotesDialog', {branchIdsToDelete, callback: res, forceDeleteAllClones})));\n    }\n\n    if (!proceed) {\n        return false;\n    }\n\n    const taskId = utils.randomString(10);\n\n    let counter = 0;\n\n    for (const branchIdToDelete of branchIdsToDelete) {\n        counter++;\n\n        const last = counter === branchIdsToDelete.length;\n        const query = `?taskId=${taskId}&eraseNotes=${eraseNotes ? 'true' : 'false'}&last=${last ? 'true' : 'false'}`;\n\n        const branch = froca.getBranch(branchIdToDelete);\n\n        if (deleteAllClones) {\n            await server.remove(`notes/${branch.noteId}${query}`);\n        }\n        else {\n            await server.remove(`branches/${branchIdToDelete}${query}`);\n        }\n    }\n\n    if (eraseNotes) {\n        utils.reloadFrontendApp(\"erasing notes requires reload\");\n    }\n\n    return true;\n}\n\nasync function moveNodeUpInHierarchy(node) {\n    if (hoistedNoteService.isHoistedNode(node)\n        || hoistedNoteService.isTopLevelNode(node)\n        || node.getParent().data.noteType === 'search') {\n        return;\n    }\n\n    const targetBranchId = node.getParent().data.branchId;\n    const branchIdToMove = node.data.branchId;\n\n    const resp = await server.put(`branches/${branchIdToMove}/move-after/${targetBranchId}`);\n\n    if (!resp.success) {\n        toastService.showError(resp.message);\n        return;\n    }\n\n    if (!hoistedNoteService.isTopLevelNode(node) && node.getParent().getChildren().length <= 1) {\n        node.getParent().folder = false;\n        node.getParent().renderTitle();\n    }\n}\n\nfunction filterSearchBranches(branchIds) {\n    return branchIds.filter(branchId => !branchId.startsWith('virt-'));\n}\n\nfunction filterRootNote(branchIds) {\n    const hoistedNoteId = hoistedNoteService.getHoistedNoteId();\n\n    return branchIds.filter(branchId => {\n        const branch = froca.getBranch(branchId);\n\n        return branch.noteId !== 'root'\n            && branch.noteId !== hoistedNoteId;\n    });\n}\n\nfunction makeToast(id, message) {\n    return {\n        id: id,\n        title: \"删除状态\",\n        message: message,\n        icon: \"trash\"\n    };\n}\n\nws.subscribeToMessages(async message => {\n    if (message.taskType !== 'deleteNotes') {\n        return;\n    }\n\n    if (message.type === 'taskError') {\n        toastService.closePersistent(message.taskId);\n        toastService.showError(message.message);\n    } else if (message.type === 'taskProgressCount') {\n        toastService.showPersistent(makeToast(message.taskId, `Delete notes in progress: ${message.progressCount}`));\n    } else if (message.type === 'taskSucceeded') {\n        const toast = makeToast(message.taskId, \"删除成功.\");\n        toast.closeAfter = 5000;\n\n        toastService.showPersistent(toast);\n    }\n});\n\nws.subscribeToMessages(async message => {\n    if (message.taskType !== 'undeleteNotes') {\n        return;\n    }\n\n    if (message.type === 'taskError') {\n        toastService.closePersistent(message.taskId);\n        toastService.showError(message.message);\n    } else if (message.type === 'taskProgressCount') {\n        toastService.showPersistent(makeToast(message.taskId, `Undeleting notes in progress: ${message.progressCount}`));\n    } else if (message.type === 'taskSucceeded') {\n        const toast = makeToast(message.taskId, \"撤销删除成功\");\n        toast.closeAfter = 5000;\n\n        toastService.showPersistent(toast);\n    }\n});\n\nasync function cloneNoteToBranch(childNoteId, parentBranchId, prefix) {\n    const resp = await server.put(`notes/${childNoteId}/clone-to-branch/${parentBranchId}`, {\n        prefix: prefix\n    });\n\n    if (!resp.success) {\n        toastService.showError(resp.message);\n    }\n}\n\nasync function cloneNoteToParentNote(childNoteId, parentNoteId, prefix) {\n    const resp = await server.put(`notes/${childNoteId}/clone-to-note/${parentNoteId}`, {\n        prefix: prefix\n    });\n\n    if (!resp.success) {\n        toastService.showError(resp.message);\n    }\n}\n\n// beware that the first arg is noteId and the second is branchId!\nasync function cloneNoteAfter(noteId, afterBranchId) {\n    const resp = await server.put(`notes/${noteId}/clone-after/${afterBranchId}`);\n\n    if (!resp.success) {\n        toastService.showError(resp.message);\n    }\n}\n\nexport default {\n    moveBeforeBranch,\n    moveAfterBranch,\n    moveToParentNote,\n    deleteNotes,\n    moveNodeUpInHierarchy,\n    cloneNoteAfter,\n    cloneNoteToBranch,\n    cloneNoteToParentNote,\n};\n","import ScriptContext from \"./script_context.js\";\nimport server from \"./server.js\";\nimport toastService from \"./toast.js\";\nimport froca from \"./froca.js\";\nimport utils from \"./utils.js\";\n\nasync function getAndExecuteBundle(noteId, originEntity = null, script = null, params = null) {\n    const bundle = await server.post(`script/bundle/${noteId}`, {\n        script,\n        params\n    });\n\n    return await executeBundle(bundle, originEntity);\n}\n\nasync function executeBundle(bundle, originEntity, $container) {\n    const apiContext = await ScriptContext(bundle.noteId, bundle.allNoteIds, originEntity, $container);\n\n    try {\n        return await (function () {\n            return eval(`const apiContext = this; (async function() { ${bundle.script}\\r\\n})()`);\n        }.call(apiContext));\n    }\n    catch (e) {\n        const note = await froca.getNote(bundle.noteId);\n\n        toastService.showAndLogError(`执行 ID 为 ${bundle.noteId} 的JS笔记\"${note.title}\"失败, 错误: ${e.message}`);\n    }\n}\n\nasync function executeStartupBundles() {\n    const isMobile = utils.isMobile();\n    const scriptBundles = await server.get(\"script/startup\" + (isMobile ? \"?mobile=true\" : \"\"));\n\n    for (const bundle of scriptBundles) {\n        await executeBundle(bundle);\n    }\n}\n\nclass WidgetsByParent {\n    constructor() {\n        this.byParent = {};\n    }\n\n    add(widget) {\n        if (!widget.parentWidget) {\n            console.log(`Custom widget does not have mandatory 'parentWidget' property defined`);\n            return;\n        }\n\n        this.byParent[widget.parentWidget] = this.byParent[widget.parentWidget] || [];\n        this.byParent[widget.parentWidget].push(widget);\n    }\n\n    get(parentName) {\n        if (!this.byParent[parentName]) {\n            return [];\n        }\n\n        return this.byParent[parentName]\n            // previously, custom widgets were provided as a single instance, but that has the disadvantage\n            // for splits where we actually need multiple instaces and thus having a class to instantiate is better\n            // https://github.com/zadam/trilium/issues/4274\n            .map(w => w.prototype ? new w() : w);\n    }\n}\n\nasync function getWidgetBundlesByParent() {\n    const scriptBundles = await server.get(\"script/widgets\");\n\n    const widgetsByParent = new WidgetsByParent();\n\n    for (const bundle of scriptBundles) {\n        let widget;\n\n        try {\n            widget = await executeBundle(bundle);\n            widgetsByParent.add(widget);\n        }\n        catch (e) {\n            logError(\"小部件初始化失败: \", e);\n            continue;\n        }\n    }\n\n    return widgetsByParent;\n}\n\nexport default {\n    executeBundle,\n    getAndExecuteBundle,\n    executeStartupBundles,\n    getWidgetBundlesByParent\n}\n","import branchService from \"./branches.js\";\nimport toastService from \"./toast.js\";\nimport froca from \"./froca.js\";\nimport linkService from \"./link.js\";\nimport utils from \"./utils.js\";\n\nlet clipboardBranchIds = [];\nlet clipboardMode = null;\n\nasync function pasteAfter(afterBranchId) {\n    if (isClipboardEmpty()) {\n        return;\n    }\n\n    if (clipboardMode === 'cut') {\n        await branchService.moveAfterBranch(clipboardBranchIds, afterBranchId);\n\n        clipboardBranchIds = [];\n        clipboardMode = null;\n    }\n    else if (clipboardMode === 'copy') {\n        const clipboardBranches = clipboardBranchIds.map(branchId => froca.getBranch(branchId));\n\n        for (const clipboardBranch of clipboardBranches) {\n            const clipboardNote = await clipboardBranch.getNote();\n\n            await branchService.cloneNoteAfter(clipboardNote.noteId, afterBranchId);\n        }\n\n        // copy will keep clipboardBranchIds and clipboardMode, so it's possible to paste into multiple places\n    }\n    else {\n        toastService.throwError(`Unrecognized clipboard mode=${clipboardMode}`);\n    }\n}\n\nasync function pasteInto(parentBranchId) {\n    if (isClipboardEmpty()) {\n        return;\n    }\n\n    if (clipboardMode === 'cut') {\n        await branchService.moveToParentNote(clipboardBranchIds, parentBranchId);\n\n        clipboardBranchIds = [];\n        clipboardMode = null;\n    }\n    else if (clipboardMode === 'copy') {\n        const clipboardBranches = clipboardBranchIds.map(branchId => froca.getBranch(branchId));\n\n        for (const clipboardBranch of clipboardBranches) {\n            const clipboardNote = await clipboardBranch.getNote();\n\n            await branchService.cloneNoteToBranch(clipboardNote.noteId, parentBranchId);\n        }\n\n        // copy will keep clipboardBranchIds and clipboardMode, so it's possible to paste into multiple places\n    }\n    else {\n        toastService.throwError(`Unrecognized clipboard mode=${clipboardMode}`);\n    }\n}\n\nasync function copy(branchIds) {\n    clipboardBranchIds = branchIds;\n    clipboardMode = 'copy';\n\n    if (utils.isElectron()) {\n        // https://github.com/zadam/trilium/issues/2401\n        const {clipboard} = require('electron');\n        const links = [];\n\n        for (const branch of froca.getBranches(clipboardBranchIds)) {\n            const $link = await linkService.createLink(`${branch.parentNoteId}/${branch.noteId}`, { referenceLink: true });\n            links.push($link[0].outerHTML);\n        }\n\n        clipboard.writeHTML(links.join(', '));\n    }\n\n    toastService.showMessage(\"笔记已复制到剪贴板.\");\n}\n\nfunction cut(branchIds) {\n    clipboardBranchIds = branchIds;\n\n    if (clipboardBranchIds.length > 0) {\n        clipboardMode = 'cut';\n\n        toastService.showMessage(\"笔记已被剪切到剪贴板.\");\n    }\n}\n\nfunction isClipboardEmpty() {\n    clipboardBranchIds = clipboardBranchIds.filter(branchId => !!froca.getBranch(branchId));\n\n    return clipboardBranchIds.length === 0;\n}\n\nexport default {\n    pasteAfter,\n    pasteInto,\n    cut,\n    copy,\n    isClipboardEmpty\n}\n","import renderService from \"./render.js\";\nimport protectedSessionService from \"./protected_session.js\";\nimport protectedSessionHolder from \"./protected_session_holder.js\";\nimport libraryLoader from \"./library_loader.js\";\nimport openService from \"./open.js\";\nimport froca from \"./froca.js\";\nimport utils from \"./utils.js\";\nimport linkService from \"./link.js\";\nimport treeService from \"./tree.js\";\nimport FNote from \"../entities/fnote.js\";\nimport FAttachment from \"../entities/fattachment.js\";\n\nlet idCounter = 1;\n\n/**\n * @param {FNote|FAttachment} entity\n * @param {object} options\n * @return {Promise<{type: string, $renderedContent: jQuery}>}\n */\nasync function getRenderedContent(entity, options = {}) {\n    options = Object.assign({\n        tooltip: false\n    }, options);\n\n    const type = getRenderingType(entity);\n    // attachment supports only image and file/pdf/audio/video\n\n    const $renderedContent = $('<div class=\"rendered-content\">');\n\n    if (type === 'text') {\n        await renderText(entity, $renderedContent);\n    }\n    else if (type === 'code') {\n        await renderCode(entity, $renderedContent);\n    }\n    else if (type === 'image' || type === 'canvas') {\n        renderImage(entity, $renderedContent, options);\n    }\n    else if (!options.tooltip && ['file', 'pdf', 'audio', 'video'].includes(type)) {\n        renderFile(entity, type, $renderedContent);\n    }\n    else if (type === 'mermaid') {\n        await renderMermaid(entity, $renderedContent);\n    }\n    else if (type === 'render') {\n        const $content = $('<div>');\n\n        await renderService.render(entity, $content, this.ctx);\n\n        $renderedContent.append($content);\n    }\n    else if (!options.tooltip && type === 'protectedSession') {\n        const $button = $(`<button class=\"btn btn-sm\"><span class=\"bx bx-log-in\"></span>进入受保护的会话</button>`)\n            .on('click', protectedSessionService.enterProtectedSession);\n\n        $renderedContent.append(\n            $(\"<div>\")\n                .append(\"<div>此笔记受保护, 您需要输入密码来访问它.</div>\")\n                .append(\"<br/>\")\n                .append($button)\n        );\n    }\n    else if (entity instanceof FNote) {\n        $renderedContent.append(\n            $(\"<div>\")\n                .css(\"display\", \"flex\")\n                .css(\"justify-content\", \"space-around\")\n                .css(\"align-items\", \"center\")\n                .css(\"height\", \"100%\")\n                .css(\"font-size\", \"500%\")\n                .append($(\"<span>\").addClass(entity.getIcon()))\n        );\n    }\n\n    if (entity instanceof FNote) {\n        $renderedContent.addClass(entity.getCssClass());\n    }\n\n    return {\n        $renderedContent,\n        type\n    };\n}\n\n/** @param {FNote} note */\nasync function renderText(note, $renderedContent) {\n    // entity must be FNote\n    const blob = await note.getBlob();\n\n    if (!utils.isHtmlEmpty(blob.content)) {\n        $renderedContent.append($('<div class=\"ck-content\">').html(blob.content));\n\n        if ($renderedContent.find('span.math-tex').length > 0) {\n            await libraryLoader.requireLibrary(libraryLoader.KATEX);\n\n            renderMathInElement($renderedContent[0], {trust: true});\n        }\n\n        const getNoteIdFromLink = el => treeService.getNoteIdFromUrl($(el).attr('href'));\n        const referenceLinks = $renderedContent.find(\"a.reference-link\");\n        const noteIdsToPrefetch = referenceLinks.map(el => getNoteIdFromLink(el));\n        await froca.getNotes(noteIdsToPrefetch);\n\n        for (const el of referenceLinks) {\n            await linkService.loadReferenceLinkTitle($(el));\n        }\n    } else {\n        await renderChildrenList($renderedContent, note);\n    }\n}\n\n/** @param {FNote} note */\nasync function renderCode(note, $renderedContent) {\n    const blob = await note.getBlob();\n\n    $renderedContent.append($(\"<pre>\").text(blob.content));\n}\n\nfunction renderImage(entity, $renderedContent, options = {}) {\n    const encodedTitle = encodeURIComponent(entity.title);\n\n    let url;\n\n    if (entity instanceof FNote) {\n        url = `api/images/${entity.noteId}/${encodedTitle}?${Math.random()}`;\n    } else if (entity instanceof FAttachment) {\n        url = `api/attachments/${entity.attachmentId}/image/${encodedTitle}?${entity.utcDateModified}\">`;\n    }\n\n    $renderedContent // styles needed for the zoom to work well\n        .css('display', 'flex')\n        .css('align-items', 'center')\n        .css('justify-content', 'center');\n\n    const $img = $(\"<img>\")\n        .attr(\"src\", url)\n        .attr(\"id\", \"attachment-image-\" + idCounter++)\n        .css(\"max-width\", \"100%\");\n\n    $renderedContent.append($img);\n\n    if (options.imageHasZoom) {\n        libraryLoader.requireLibrary(libraryLoader.WHEEL_ZOOM).then(() => {\n            WZoom.create(`#${$img.attr(\"id\")}`, {\n                maxScale: 50,\n                speed: 1.3,\n                zoomOnClick: false\n            });\n        });\n    }\n}\n\nfunction renderFile(entity, type, $renderedContent) {\n    let entityType, entityId;\n\n    if (entity instanceof FNote) {\n        entityType = 'notes';\n        entityId = entity.noteId;\n    } else if (entity instanceof FAttachment) {\n        entityType = 'attachments';\n        entityId = entity.attachmentId;\n    } else {\n        throw new Error(`Can't recognize entity type of '${entity}'`);\n    }\n\n    const $content = $('<div style=\"display: flex; flex-direction: column; height: 100%;\">');\n\n    if (type === 'pdf') {\n        const $pdfPreview = $('<iframe class=\"pdf-preview\" style=\"width: 100%; flex-grow: 100;\"></iframe>');\n        $pdfPreview.attr(\"src\", openService.getUrlForDownload(`api/${entityType}/${entityId}/open`));\n\n        $content.append($pdfPreview);\n    } else if (type === 'audio') {\n        const $audioPreview = $('<audio controls></audio>')\n            .attr(\"src\", openService.getUrlForDownload(`api/${entityType}/${entityId}/open-partial`))\n            .attr(\"type\", entity.mime)\n            .css(\"width\", \"100%\");\n\n        $content.append($audioPreview);\n    } else if (type === 'video') {\n        const $videoPreview = $('<video controls></video>')\n            .attr(\"src\", openService.getUrlForDownload(`api/${entityType}/${entityId}/open-partial`))\n            .attr(\"type\", entity.mime)\n            .css(\"width\", \"100%\");\n\n        $content.append($videoPreview);\n    }\n\n    if (entityType === 'notes') {\n        // TODO: we should make this available also for attachments, but there's a problem with \"Open externally\" support\n        //       in attachment list\n        const $downloadButton = $('<button class=\"file-download btn btn-primary\" type=\"button\">下载</button>');\n        const $openButton = $('<button class=\"file-open btn btn-primary\" type=\"button\">打开</button>');\n\n        $downloadButton.on('click', () => openService.downloadFileNote(entity.noteId));\n        $openButton.on('click', () => openService.openNoteExternally(entity.noteId, entity.mime));\n        // open doesn't work for protected notes since it works through a browser which isn't in protected session\n        $openButton.toggle(!entity.isProtected);\n\n        $content.append(\n            $('<div style=\"display: flex; justify-content: space-evenly; margin-top: 5px;\">')\n                .append($downloadButton)\n                .append($openButton)\n        );\n    }\n\n    $renderedContent.append($content);\n}\n\nasync function renderMermaid(note, $renderedContent) {\n    await libraryLoader.requireLibrary(libraryLoader.MERMAID);\n\n    const blob = await note.getBlob();\n    const content = blob.content || \"\";\n\n    $renderedContent\n        .css(\"display\", \"flex\")\n        .css(\"justify-content\", \"space-around\");\n\n    const documentStyle = window.getComputedStyle(document.documentElement);\n    const mermaidTheme = documentStyle.getPropertyValue('--mermaid-theme');\n\n    mermaid.mermaidAPI.initialize({startOnLoad: false, theme: mermaidTheme.trim(), securityLevel: 'antiscript'});\n\n    try {\n        const {svg} = await mermaid.mermaidAPI.render(\"in-mermaid-graph-\" + idCounter++, content);\n\n        $renderedContent.append($(svg));\n    } catch (e) {\n        const $error = $(\"<p>图表无法显示.</p>\");\n\n        $renderedContent.append($error);\n    }\n}\n\n/**\n * @param {jQuery} $renderedContent\n * @param {FNote} note\n * @returns {Promise<void>}\n */\nasync function renderChildrenList($renderedContent, note) {\n    $renderedContent.css(\"padding\", \"10px\");\n    $renderedContent.addClass(\"text-with-ellipsis\");\n\n    let childNoteIds = note.getChildNoteIds();\n\n    if (childNoteIds.length > 10) {\n        childNoteIds = childNoteIds.slice(0, 10);\n    }\n\n    // just load the first 10 child notes\n    const childNotes = await froca.getNotes(childNoteIds);\n\n    for (const childNote of childNotes) {\n        $renderedContent.append(await linkService.createLink(`${note.noteId}/${childNote.noteId}`, {\n            showTooltip: false,\n            showNoteIcon: true\n        }));\n\n        $renderedContent.append(\"<br>\");\n    }\n}\n\nfunction getRenderingType(entity) {\n    let type = entity.type || entity.role;\n    const mime = entity.mime;\n\n    if (type === 'file' && mime === 'application/pdf') {\n        type = 'pdf';\n    } else if (type === 'file' && mime.startsWith('audio/')) {\n        type = 'audio';\n    } else if (type === 'file' && mime.startsWith('video/')) {\n        type = 'video';\n    }\n\n    if (entity.isProtected) {\n        if (protectedSessionHolder.isProtectedSessionAvailable()) {\n            protectedSessionHolder.touchProtectedSession();\n        }\n        else {\n            type = 'protectedSession';\n        }\n    }\n\n    return type;\n}\n\nexport default {\n    getRenderedContent\n};\n","import froca from \"./froca.js\";\nimport server from \"./server.js\";\nimport ws from \"./ws.js\";\n\n/** @returns {FNote} */\nasync function getInboxNote() {\n    const note = await server.get(`special-notes/inbox/${dayjs().format(\"YYYY-MM-DD\")}`, \"date-note\");\n\n    return await froca.getNote(note.noteId);\n}\n\n/** @returns {FNote} */\nasync function getTodayNote() {\n    return await getDayNote(dayjs().format(\"YYYY-MM-DD\"));\n}\n\n/** @returns {FNote} */\nasync function getDayNote(date) {\n    const note = await server.get(`special-notes/days/${date}`, \"date-note\");\n\n    await ws.waitForMaxKnownEntityChangeId();\n\n    return await froca.getNote(note.noteId);\n}\n\n/** @returns {FNote} */\nasync function getWeekNote(date) {\n    const note = await server.get(`special-notes/weeks/${date}`, \"date-note\");\n\n    await ws.waitForMaxKnownEntityChangeId();\n\n    return await froca.getNote(note.noteId);\n}\n\n/** @returns {FNote} */\nasync function getMonthNote(month) {\n    const note = await server.get(`special-notes/months/${month}`, \"date-note\");\n\n    await ws.waitForMaxKnownEntityChangeId();\n\n    return await froca.getNote(note.noteId);\n}\n\n/** @returns {FNote} */\nasync function getYearNote(year) {\n    const note = await server.get(`special-notes/years/${year}`, \"date-note\");\n\n    await ws.waitForMaxKnownEntityChangeId();\n\n    return await froca.getNote(note.noteId);\n}\n\n/** @returns {FNote} */\nasync function createSqlConsole() {\n    const note = await server.post('special-notes/sql-console');\n\n    await ws.waitForMaxKnownEntityChangeId();\n\n    return await froca.getNote(note.noteId);\n}\n\n/** @returns {FNote} */\nasync function createSearchNote(opts = {}) {\n    const note = await server.post('special-notes/search-note', opts);\n\n    await ws.waitForMaxKnownEntityChangeId();\n\n    return await froca.getNote(note.noteId);\n}\n\nexport default {\n    getInboxNote,\n    getTodayNote,\n    getDayNote,\n    getWeekNote,\n    getMonthNote,\n    getYearNote,\n    createSqlConsole,\n    createSearchNote\n}\n","import appContext from \"../components/app_context.js\";\n\nasync function info(message) {\n    return new Promise(res =>\n        appContext.triggerCommand(\"showInfoDialog\", {message, callback: res}));\n}\n\nasync function confirm(message) {\n    return new Promise(res =>\n        appContext.triggerCommand(\"showConfirmDialog\", {\n            message,\n            callback: x => res(x.confirmed)\n        }));\n}\n\nasync function confirmDeleteNoteBoxWithNote(title) {\n    return new Promise(res =>\n        appContext.triggerCommand(\"showConfirmDeleteNoteBoxWithNoteDialog\", {title, callback: res}));\n}\n\nasync function prompt(props) {\n    return new Promise(res =>\n        appContext.triggerCommand(\"showPromptDialog\", {...props, callback: res}));\n}\n\nexport default {\n    info,\n    confirm,\n    confirmDeleteNoteBoxWithNote,\n    prompt\n};\n","export default class FBlob {\n    constructor(row) {\n        /** @type {string} */\n        this.blobId = row.blobId;\n\n        /**\n         * can either contain the whole content (in e.g. string notes), only part (large text notes) or nothing at all (binary notes, images)\n         * @type {string}\n         */\n        this.content = row.content;\n        this.contentLength = row.contentLength;\n\n        /** @type {string} */\n        this.dateModified = row.dateModified;\n        /** @type {string} */\n        this.utcDateModified = row.utcDateModified;\n    }\n\n    /**\n     * @returns {*}\n     * @throws Error in case of invalid JSON */\n    getJsonContent() {\n        if (!this.content || !this.content.trim()) {\n            return null;\n        }\n\n        return JSON.parse(this.content);\n    }\n\n    /** @returns {*|null} valid object or null if the content cannot be parsed as JSON */\n    getJsonContentSafely() {\n        try {\n            return this.getJsonContent();\n        }\n        catch (e) {\n            return null;\n        }\n    }\n}\n","import FBranch from \"../entities/fbranch.js\";\nimport FNote from \"../entities/fnote.js\";\nimport FAttribute from \"../entities/fattribute.js\";\nimport server from \"./server.js\";\nimport appContext from \"../components/app_context.js\";\nimport FBlob from \"../entities/fblob.js\";\nimport FAttachment from \"../entities/fattachment.js\";\n\n/**\n * Froca (FROntend CAche) keeps a read only cache of note tree structure in frontend's memory.\n * - notes are loaded lazily when unknown noteId is requested\n * - when note is loaded, all its parent and child branches are loaded as well. For a branch to be used, it's not must be loaded before\n * - deleted notes are present in the cache as well, but they don't have any branches. As a result check for deleted branch is done by presence check - if the branch is not there even though the corresponding note has been loaded, we can infer it is deleted.\n *\n * Note and branch deletions are corner cases and usually not needed.\n *\n * Backend has a similar cache called Becca\n */\nclass Froca {\n    constructor() {\n        this.initializedPromise = this.loadInitialTree();\n    }\n\n    async loadInitialTree() {\n        const resp = await server.get('tree');\n\n        // clear the cache only directly before adding new content which is important for e.g., switching to protected session\n\n        /** @type {Object.<string, FNote>} */\n        this.notes = {};\n\n        /** @type {Object.<string, FBranch>} */\n        this.branches = {};\n\n        /** @type {Object.<string, FAttribute>} */\n        this.attributes = {};\n\n        /** @type {Object.<string, FAttachment>} */\n        this.attachments = {};\n\n        /** @type {Object.<string, Promise<FBlob>>} */\n        this.blobPromises = {};\n\n        this.addResp(resp);\n    }\n\n    async loadSubTree(subTreeNoteId) {\n        const resp = await server.get(`tree?subTreeNoteId=${subTreeNoteId}`);\n\n        this.addResp(resp);\n\n        return this.notes[subTreeNoteId];\n    }\n\n    addResp(resp) {\n        const noteRows = resp.notes;\n        const branchRows = resp.branches;\n        const attributeRows = resp.attributes;\n\n        const noteIdsToSort = new Set();\n\n        for (const noteRow of noteRows) {\n            const {noteId} = noteRow;\n\n            let note = this.notes[noteId];\n\n            if (note) {\n                note.update(noteRow);\n\n                // search note doesn't have child branches in the database and all the children are virtual branches\n                if (note.type !== 'search') {\n                    for (const childNoteId of note.children) {\n                        const childNote = this.notes[childNoteId];\n\n                        if (childNote) {\n                            childNote.parents = childNote.parents.filter(p => p !== noteId);\n\n                            delete this.branches[childNote.parentToBranch[noteId]];\n                            delete childNote.parentToBranch[noteId];\n                        }\n                    }\n\n                    note.children = [];\n                    note.childToBranch = {};\n                }\n\n                // we want to remove all \"real\" branches (represented in the database) since those will be created\n                // from branches argument but want to preserve all virtual ones from saved search\n                note.parents = note.parents.filter(parentNoteId => {\n                    const parentNote = this.notes[parentNoteId];\n                    const branch = this.branches[parentNote.childToBranch[noteId]];\n\n                    if (!parentNote || !branch) {\n                        return false;\n                    }\n\n                    if (branch.fromSearchNote) {\n                        return true;\n                    }\n\n                    parentNote.children = parentNote.children.filter(p => p !== noteId);\n\n                    delete this.branches[parentNote.childToBranch[noteId]];\n                    delete parentNote.childToBranch[noteId];\n\n                    return false;\n                });\n            }\n            else {\n                this.notes[noteId] = new FNote(this, noteRow);\n            }\n        }\n\n        for (const branchRow of branchRows) {\n            const branch = new FBranch(this, branchRow);\n\n            this.branches[branch.branchId] = branch;\n\n            const childNote = this.notes[branch.noteId];\n\n            if (childNote) {\n                childNote.addParent(branch.parentNoteId, branch.branchId, false);\n            }\n\n            const parentNote = this.notes[branch.parentNoteId];\n\n            if (parentNote) {\n                parentNote.addChild(branch.noteId, branch.branchId, false);\n\n                noteIdsToSort.add(parentNote.noteId);\n            }\n        }\n\n        for (const attributeRow of attributeRows) {\n            const {attributeId} = attributeRow;\n\n            this.attributes[attributeId] = new FAttribute(this, attributeRow);\n\n            const note = this.notes[attributeRow.noteId];\n\n            if (note && !note.attributes.includes(attributeId)) {\n                note.attributes.push(attributeId);\n            }\n\n            if (attributeRow.type === 'relation') {\n                const targetNote = this.notes[attributeRow.value];\n\n                if (targetNote) {\n                    if (!targetNote.targetRelations.includes(attributeId)) {\n                        targetNote.targetRelations.push(attributeId);\n                    }\n                }\n            }\n        }\n\n        // sort all of them at once, this avoids repeated sorts (#1480)\n        for (const noteId of noteIdsToSort) {\n            this.notes[noteId].sortChildren();\n            this.notes[noteId].sortParents();\n        }\n    }\n\n    async reloadNotes(noteIds) {\n        if (noteIds.length === 0) {\n            return;\n        }\n\n        noteIds = Array.from(new Set(noteIds)); // make noteIds unique\n\n        const resp = await server.post('tree/load', { noteIds });\n\n        this.addResp(resp);\n\n        appContext.triggerEvent('notesReloaded', {noteIds});\n    }\n\n    async loadSearchNote(noteId) {\n        const note = await this.getNote(noteId);\n\n        if (!note || note.type !== 'search') {\n            return;\n        }\n\n        const {searchResultNoteIds, highlightedTokens, error} = await server.get(`search-note/${note.noteId}`);\n\n        if (!Array.isArray(searchResultNoteIds)) {\n            throw new Error(`Search note '${note.noteId}' failed: ${searchResultNoteIds}`);\n        }\n\n        // reset all the virtual branches from old search results\n        if (note.noteId in froca.notes) {\n            froca.notes[note.noteId].children = [];\n            froca.notes[note.noteId].childToBranch = {};\n        }\n\n        const branches = [...note.getParentBranches(), ...note.getChildBranches()];\n\n        searchResultNoteIds.forEach((resultNoteId, index) => branches.push({\n            // branchId should be repeatable since sometimes we reload some notes without rerendering the tree\n            branchId: `virt-${note.noteId}-${resultNoteId}`,\n            noteId: resultNoteId,\n            parentNoteId: note.noteId,\n            notePosition: (index + 1) * 10,\n            fromSearchNote: true\n        }));\n\n        // update this note with standard (parent) branches + virtual (children) branches\n        this.addResp({\n            notes: [note],\n            branches,\n            attributes: []\n        });\n\n        froca.notes[note.noteId].searchResultsLoaded = true;\n        froca.notes[note.noteId].highlightedTokens = highlightedTokens;\n\n        return {error};\n    }\n\n    /** @returns {FNote[]} */\n    getNotesFromCache(noteIds, silentNotFoundError = false) {\n        return noteIds.map(noteId => {\n            if (!this.notes[noteId] && !silentNotFoundError) {\n                console.trace(`Can't find note '${noteId}'`);\n\n                return null;\n            }\n            else {\n                return this.notes[noteId];\n            }\n        }).filter(note => !!note);\n    }\n\n    /** @returns {Promise<FNote[]>} */\n    async getNotes(noteIds, silentNotFoundError = false) {\n        noteIds = Array.from(new Set(noteIds)); // make unique\n        const missingNoteIds = noteIds.filter(noteId => !this.notes[noteId]);\n\n        await this.reloadNotes(missingNoteIds);\n\n        return noteIds.map(noteId => {\n            if (!this.notes[noteId] && !silentNotFoundError) {\n                console.trace(`Can't find note '${noteId}'`);\n\n                return null;\n            } else {\n                return this.notes[noteId];\n            }\n        }).filter(note => !!note);\n    }\n\n    /** @returns {Promise<boolean>} */\n    async noteExists(noteId) {\n        const notes = await this.getNotes([noteId], true);\n\n        return notes.length === 1;\n    }\n\n    /** @returns {Promise<FNote>} */\n    async getNote(noteId, silentNotFoundError = false) {\n        if (noteId === 'none') {\n            console.trace(`No 'none' note.`);\n            return null;\n        }\n        else if (!noteId) {\n            console.trace(`Falsy noteId '${noteId}', returning null.`);\n            return null;\n        }\n\n        return (await this.getNotes([noteId], silentNotFoundError))[0];\n    }\n\n    /** @returns {FNote|null} */\n    getNoteFromCache(noteId) {\n        if (!noteId) {\n            throw new Error(\"空 noteId\");\n        }\n\n        return this.notes[noteId];\n    }\n\n    /** @returns {FBranch[]} */\n    getBranches(branchIds, silentNotFoundError = false) {\n        return branchIds\n            .map(branchId => this.getBranch(branchId, silentNotFoundError))\n            .filter(b => !!b);\n    }\n\n    /** @returns {FBranch} */\n    getBranch(branchId, silentNotFoundError = false) {\n        if (!(branchId in this.branches)) {\n            if (!silentNotFoundError) {\n                logError(`Not existing branch '${branchId}'`);\n            }\n        }\n        else {\n            return this.branches[branchId];\n        }\n    }\n\n    async getBranchId(parentNoteId, childNoteId) {\n        if (childNoteId === 'root') {\n            return 'none_root';\n        }\n\n        const child = await this.getNote(childNoteId);\n\n        if (!child) {\n            logError(`Could not find branchId for parent '${parentNoteId}', child '${childNoteId}' since child does not exist`);\n\n            return null;\n        }\n\n        return child.parentToBranch[parentNoteId];\n    }\n\n    /** @returns {Promise<FAttachment>} */\n    async getAttachment(attachmentId, silentNotFoundError = false) {\n        const attachment = this.attachments[attachmentId];\n        if (attachment) {\n            return attachment;\n        }\n\n        // load all attachments for the given note even if one is requested, don't load one by one\n        let attachmentRows;\n        try {\n            attachmentRows = await server.getWithSilentNotFound(`attachments/${attachmentId}/all`);\n        }\n        catch (e) {\n            if (silentNotFoundError) {\n                logInfo(`Attachment '${attachmentId}' not found, but silentNotFoundError is enabled: ` + e.message);\n                return null;\n            } else {\n                throw e;\n            }\n        }\n\n        const attachments = this.processAttachmentRows(attachmentRows);\n\n        if (attachments.length) {\n            attachments[0].getNote().attachments = attachments;\n        }\n\n        return this.attachments[attachmentId];\n    }\n\n    /** @returns {Promise<FAttachment[]>} */\n    async getAttachmentsForNote(noteId) {\n        const attachmentRows = await server.get(`notes/${noteId}/attachments`);\n        return this.processAttachmentRows(attachmentRows);\n    }\n\n    /** @returns {FAttachment[]} */\n    processAttachmentRows(attachmentRows) {\n        return attachmentRows.map(attachmentRow => {\n            let attachment;\n\n            if (attachmentRow.attachmentId in this.attachments) {\n                attachment = this.attachments[attachmentRow.attachmentId];\n                attachment.update(attachmentRow);\n            } else {\n                attachment = new FAttachment(this, attachmentRow);\n                this.attachments[attachment.attachmentId] = attachment;\n            }\n\n            return attachment;\n        });\n    }\n\n    /** @returns {Promise<FBlob>} */\n    async getBlob(entityType, entityId) {\n        // I'm not sure why we're not using blobIds directly, it would save us this composite key ...\n        // perhaps one benefit is that we're always requesting the latest blob, not relying on perhaps faulty/slow\n        // websocket update?\n        const key = `${entityType}-${entityId}`;\n\n        if (!this.blobPromises[key]) {\n            this.blobPromises[key] = server.get(`${entityType}/${entityId}/blob`)\n                .then(row => new FBlob(row))\n                .catch(e => console.error(`Cannot get blob for ${entityType} '${entityId}'`, e));\n\n            // we don't want to keep large payloads forever in memory, so we clean that up quite quickly\n            // this cache is more meant to share the data between different components within one business transaction (e.g. loading of the note into the tab context and all the components)\n            // if the blob is updated within the cache lifetime, it should be invalidated by froca_updater\n            this.blobPromises[key].then(\n                () => setTimeout(() => this.blobPromises[key] = null, 1000)\n            );\n        }\n\n        return await this.blobPromises[key];\n    }\n}\n\nconst froca = new Froca();\n\nexport default froca;\n","import appContext from \"../components/app_context.js\";\nimport treeService from \"./tree.js\";\nimport dialogService from \"./dialog.js\";\nimport froca from \"./froca.js\";\n\nfunction getHoistedNoteId() {\n    const activeNoteContext = appContext.tabManager.getActiveContext();\n\n    return activeNoteContext ? activeNoteContext.hoistedNoteId : 'root';\n}\n\nasync function unhoist() {\n    const activeNoteContext = appContext.tabManager.getActiveContext();\n\n    if (activeNoteContext) {\n        await activeNoteContext.unhoist();\n    }\n}\n\nfunction isTopLevelNode(node) {\n    return isHoistedNode(node.getParent());\n}\n\nfunction isHoistedNode(node) {\n    // even though check for 'root' should not be necessary, we keep it just in case\n    return node.data.noteId === \"root\"\n        || node.data.noteId === getHoistedNoteId();\n}\n\nasync function isHoistedInHiddenSubtree() {\n    const hoistedNoteId = getHoistedNoteId();\n\n    if (hoistedNoteId === 'root') {\n        return false;\n    }\n\n    const hoistedNote = await froca.getNote(hoistedNoteId);\n    return hoistedNote.isHiddenCompletely();\n}\n\nasync function checkNoteAccess(notePath, noteContext) {\n    const resolvedNotePath = await treeService.resolveNotePath(notePath, noteContext.hoistedNoteId);\n\n    if (!resolvedNotePath) {\n        console.log(`Cannot activate '${notePath}'`);\n        return false;\n    }\n\n    const hoistedNoteId = noteContext.hoistedNoteId;\n\n    if (!resolvedNotePath.includes(hoistedNoteId) && !resolvedNotePath.includes('_hidden')) {\n        const requestedNote = await froca.getNote(treeService.getNoteIdFromUrl(resolvedNotePath));\n        const hoistedNote = await froca.getNote(hoistedNoteId);\n\n        if (!hoistedNote.hasAncestor('_hidden')\n            && !await dialogService.confirm(`Requested note '${requestedNote.title}' is outside of hoisted note '${hoistedNote.title}' subtree and you must unhoist to access the note. Do you want to proceed with unhoisting?`)) {\n            return false;\n        }\n\n        // unhoist so we can activate the note\n        await unhoist();\n    }\n\n    return true;\n}\n\nexport default {\n    getHoistedNoteId,\n    unhoist,\n    isTopLevelNode,\n    isHoistedNode,\n    checkNoteAccess,\n    isHoistedInHiddenSubtree\n}\n","import toastService from \"./toast.js\";\nimport server from \"./server.js\";\nimport ws from \"./ws.js\";\nimport utils from \"./utils.js\";\nimport appContext from \"../components/app_context.js\";\n\nexport async function uploadFiles(entityType, parentNoteId, files, options) {\n    if (!['notes', 'attachments'].includes(entityType)) {\n        throw new Error(`Unrecognized import entity type '${entityType}'.`);\n    }\n\n    if (files.length === 0) {\n        return;\n    }\n\n    const taskId = utils.randomString(10);\n    let counter = 0;\n\n    for (const file of files) {\n        counter++;\n\n        const formData = new FormData();\n        formData.append('upload', file);\n        formData.append('taskId', taskId);\n        formData.append('last', counter === files.length ? \"true\" : \"false\");\n\n        for (const key in options) {\n            formData.append(key, options[key]);\n        }\n\n        await $.ajax({\n            url: `${window.glob.baseApiUrl}notes/${parentNoteId}/${entityType}-import`,\n            headers: await server.getHeaders(),\n            data: formData,\n            dataType: 'json',\n            type: 'POST',\n            timeout: 60 * 60 * 1000,\n            error: function (xhr) {\n                toastService.showError(`Import failed: ${xhr.responseText}`);\n            },\n            contentType: false, // NEEDED, DON'T REMOVE THIS\n            processData: false, // NEEDED, DON'T REMOVE THIS\n        });\n    }\n}\n\nfunction makeToast(id, message) {\n    return {\n        id: id,\n        title: \"导入状态\",\n        message: message,\n        icon: \"plus\"\n    };\n}\n\nws.subscribeToMessages(async message => {\n    if (message.taskType !== 'importNotes') {\n        return;\n    }\n\n    if (message.type === 'taskError') {\n        toastService.closePersistent(message.taskId);\n        toastService.showError(message.message);\n    } else if (message.type === 'taskProgressCount') {\n        toastService.showPersistent(makeToast(message.taskId, `Import in progress: ${message.progressCount}`));\n    } else if (message.type === 'taskSucceeded') {\n        const toast = makeToast(message.taskId, \"导入成功.\");\n        toast.closeAfter = 5000;\n\n        toastService.showPersistent(toast);\n\n        if (message.result.importedNoteId) {\n            await appContext.tabManager.getActiveContext().setNote(message.result.importedNoteId);\n        }\n    }\n});\n\nws.subscribeToMessages(async message => {\n    if (message.taskType !== 'importAttachments') {\n        return;\n    }\n\n    if (message.type === 'taskError') {\n        toastService.closePersistent(message.taskId);\n        toastService.showError(message.message);\n    } else if (message.type === 'taskProgressCount') {\n        toastService.showPersistent(makeToast(message.taskId, `Import in progress: ${message.progressCount}`));\n    } else if (message.type === 'taskSucceeded') {\n        const toast = makeToast(message.taskId, \"导入成功.\");\n        toast.closeAfter = 5000;\n\n        toastService.showPersistent(toast);\n\n        if (message.result.parentNoteId) {\n            await appContext.tabManager.getActiveContext().setNote(message.result.importedNoteId, {\n                viewScope: {\n                    viewMode: 'attachments'\n                }\n            });\n        }\n    }\n});\n\nexport default {\n    uploadFiles\n};\n","import server from \"./server.js\";\nimport appContext from \"../components/app_context.js\";\nimport shortcutService from \"./shortcuts.js\";\n\nconst keyboardActionRepo = {};\n\nconst keyboardActionsLoaded = server.get('keyboard-actions').then(actions => {\n\tactions = actions.filter(a => !!a.actionName); // filter out separators\n\n\tfor (const action of actions) {\n\t\taction.effectiveShortcuts = action.effectiveShortcuts.filter(shortcut => !shortcut.startsWith(\"global:\"));\n\n\t\tkeyboardActionRepo[action.actionName] = action;\n\t}\n\n\treturn actions;\n});\n\nasync function getActions() {\n\treturn await keyboardActionsLoaded;\n}\n\nasync function getActionsForScope(scope) {\n\tconst actions = await keyboardActionsLoaded;\n\n\treturn actions.filter(action => action.scope === scope);\n}\n\nasync function setupActionsForElement(scope, $el, component) {\n\tconst actions = await getActionsForScope(scope);\n\n\tfor (const action of actions) {\n\t\tfor (const shortcut of action.effectiveShortcuts) {\n\t\t\tshortcutService.bindElShortcut($el, shortcut, () => component.triggerCommand(action.actionName, {ntxId: appContext.tabManager.activeNtxId}));\n\t\t}\n\t}\n}\n\ngetActionsForScope(\"window\").then(actions => {\n\tfor (const action of actions) {\n\t\tfor (const shortcut of action.effectiveShortcuts) {\n\t\t\tshortcutService.bindGlobalShortcut(shortcut, () => appContext.triggerCommand(action.actionName, {ntxId: appContext.tabManager.activeNtxId}));\n\t\t}\n\t}\n});\n\nasync function getAction(actionName, silent = false) {\n\tawait keyboardActionsLoaded;\n\n\tconst action = keyboardActionRepo[actionName];\n\n\tif (!action) {\n\t\tif (silent) {\n\t\t\tconsole.debug(`Cannot find action '${actionName}'`);\n\t\t}\n\t\telse {\n\t\t\tthrow new Error(`Cannot find action '${actionName}'`);\n\t\t}\n\t}\n\n\treturn action;\n}\n\nfunction updateDisplayedShortcuts($container) {\n\t$container.find('kbd[data-command]').each(async (i, el) => {\n\t\tconst actionName = $(el).attr('data-command');\n\t\tconst action = await getAction(actionName, true);\n\n\t\tif (action) {\n\t\t\tconst keyboardActions = action.effectiveShortcuts.join(', ');\n\n\t\t\tif (keyboardActions || $(el).text() !== \"not set\") {\n\t\t\t\t$(el).text(keyboardActions);\n\t\t\t}\n\t\t}\n\t});\n\n\t$container.find('[data-trigger-command]').each(async (i, el) => {\n\t\tconst actionName = $(el).attr('data-trigger-command');\n\t\tconst action = await getAction(actionName, true);\n\n\t\tif (action) {\n\t\t\tconst title = $(el).attr('title');\n\t\t\tconst shortcuts = action.effectiveShortcuts.join(', ');\n\n\t\t\tif (title?.includes(shortcuts)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst newTitle = !title?.trim() ? shortcuts : `${title} (${shortcuts})`;\n\n\t\t\t$(el).attr('title', newTitle);\n\t\t}\n\t});\n}\n\nexport default {\n\tupdateDisplayedShortcuts,\n\tsetupActionsForElement,\n\tgetActions,\n\tgetActionsForScope\n};\n","const CKEDITOR = {\"js\": [\"libraries/ckeditor/ckeditor.js\"]};\n\nconst CODE_MIRROR = {\n    js: [\n        \"libraries/codemirror/codemirror.js\",\n        \"libraries/codemirror/addon/display/placeholder.js\",\n        \"libraries/codemirror/addon/edit/matchbrackets.js\",\n        \"libraries/codemirror/addon/edit/matchtags.js\",\n        \"libraries/codemirror/addon/fold/xml-fold.js\",\n        \"libraries/codemirror/addon/lint/lint.js\",\n        \"libraries/codemirror/addon/lint/eslint.js\",\n        \"libraries/codemirror/addon/mode/loadmode.js\",\n        \"libraries/codemirror/addon/mode/multiplex.js\",\n        \"libraries/codemirror/addon/mode/overlay.js\",\n        \"libraries/codemirror/addon/mode/simple.js\",\n        \"libraries/codemirror/addon/search/match-highlighter.js\",\n        \"libraries/codemirror/mode/meta.js\",\n        \"libraries/codemirror/keymap/vim.js\"\n    ],\n    css: [\n        \"libraries/codemirror/codemirror.css\",\n        \"libraries/codemirror/addon/lint/lint.css\"\n    ]\n};\n\nconst ESLINT = {js: [\"libraries/eslint.js\"]};\n\nconst RELATION_MAP = {\n    js: [\n        \"libraries/jsplumb.js\",\n        \"libraries/panzoom.js\"\n    ],\n    css: [\n        \"stylesheets/relation_map.css\"\n    ]\n};\n\nconst PRINT_THIS = {js: [\"libraries/printThis.js\"]};\n\nconst CALENDAR_WIDGET = {css: [\"stylesheets/calendar.css\"]};\n\nconst KATEX = {\n    js: [ \"node_modules/katex/dist/katex.min.js\",\n        \"node_modules/katex/dist/contrib/mhchem.min.js\",\n        \"node_modules/katex/dist/contrib/auto-render.min.js\" ],\n    css: [ \"node_modules/katex/dist/katex.min.css\" ]\n};\n\nconst WHEEL_ZOOM = {\n    js: [ \"libraries/wheel-zoom.min.js\"]\n};\n\nconst FORCE_GRAPH = {\n    js: [ \"libraries/force-graph.min.js\"]\n};\n\nconst MERMAID = {\n    js: [ \"libraries/mermaid.min.js\" ]\n}\n\nconst EXCALIDRAW = {\n    js: [\n        \"node_modules/react/umd/react.production.min.js\",\n        \"node_modules/react-dom/umd/react-dom.production.min.js\",\n        \"node_modules/@excalidraw/excalidraw/dist/excalidraw.production.min.js\",\n    ]\n};\n\nconst MARKJS = {\n    js: [\n        \"libraries/jquery.mark.es6.min.js\"\n    ]\n};\n\nasync function requireLibrary(library) {\n    if (library.css) {\n        library.css.map(cssUrl => requireCss(cssUrl));\n    }\n\n    if (library.js) {\n        for (const scriptUrl of library.js) {\n            await requireScript(scriptUrl);\n        }\n    }\n}\n\n// we save the promises in case of the same script being required concurrently multiple times\nconst loadedScriptPromises = {};\n\nasync function requireScript(url) {\n    url = `${window.glob.assetPath}/${url}`;\n\n    if (!loadedScriptPromises[url]) {\n        loadedScriptPromises[url] = $.ajax({\n            url: url,\n            dataType: \"script\",\n            cache: true\n        });\n    }\n\n    await loadedScriptPromises[url];\n}\n\nasync function requireCss(url, prependAssetPath = true) {\n    const cssLinks = Array\n        .from(document.querySelectorAll('link'))\n        .map(el => el.href);\n\n    if (!cssLinks.some(l => l.endsWith(url))) {\n        if (prependAssetPath) {\n            url = `${window.glob.assetPath}/${url}`;\n        }\n\n        $('head').append($('<link rel=\"stylesheet\" type=\"text/css\" />').attr('href', url));\n    }\n}\n\nexport default {\n    requireCss,\n    requireLibrary,\n    CKEDITOR,\n    CODE_MIRROR,\n    ESLINT,\n    RELATION_MAP,\n    PRINT_THIS,\n    CALENDAR_WIDGET,\n    KATEX,\n    WHEEL_ZOOM,\n    FORCE_GRAPH,\n    MERMAID,\n    EXCALIDRAW,\n    MARKJS\n}\n","import treeService from './tree.js';\nimport linkContextMenuService from \"../menus/link_context_menu.js\";\nimport appContext from \"../components/app_context.js\";\nimport froca from \"./froca.js\";\nimport utils from \"./utils.js\";\n\nfunction getNotePathFromUrl(url) {\n    const notePathMatch = /#(root[A-Za-z0-9_/]*)$/.exec(url);\n\n    return notePathMatch === null ? null : notePathMatch[1];\n}\n\nasync function getLinkIcon(noteId, viewMode) {\n    let icon;\n\n    if (viewMode === 'default') {\n        const note = await froca.getNote(noteId);\n\n        icon = note.getIcon();\n    } else if (viewMode === 'source') {\n        icon = 'bx bx-code-curly';\n    } else if (viewMode === 'attachments') {\n        icon = 'bx bx-file';\n    }\n    return icon;\n}\n\nasync function createLink(notePath, options = {}) {\n    if (!notePath || !notePath.trim()) {\n        logError(\"缺少笔记路径\");\n\n        return $(\"<span>\").text(\"[missing note]\");\n    }\n\n    if (!notePath.startsWith(\"root\")) {\n        // all note paths should start with \"root/\" (except for \"root\" itself)\n        // used, e.g., to find internal links\n        notePath = `root/${notePath}`;\n    }\n\n    const showTooltip = options.showTooltip === undefined ? true : options.showTooltip;\n    const showNotePath = options.showNotePath === undefined ? false : options.showNotePath;\n    const showNoteIcon = options.showNoteIcon === undefined ? false : options.showNoteIcon;\n    const referenceLink = options.referenceLink === undefined ? false : options.referenceLink;\n    const autoConvertToImage = options.autoConvertToImage === undefined ? false : options.autoConvertToImage;\n\n    const { noteId, parentNoteId } = treeService.getNoteIdAndParentIdFromUrl(notePath);\n    const viewScope = options.viewScope || {};\n    const viewMode = viewScope.viewMode || 'default';\n    let linkTitle = options.title;\n\n    if (!linkTitle) {\n        if (viewMode === 'attachments' && viewScope.attachmentId) {\n            const attachment = await froca.getAttachment(viewScope.attachmentId);\n\n            linkTitle = attachment ? attachment.title : '[missing attachment]';\n        } else {\n            linkTitle = await treeService.getNoteTitle(noteId, parentNoteId);\n        }\n    }\n\n    const note = await froca.getNote(noteId);\n\n    if (autoConvertToImage && ['image', 'canvas', 'mermaid'].includes(note.type) && viewMode === 'default') {\n        const encodedTitle = encodeURIComponent(linkTitle);\n\n        return $(\"<img>\")\n            .attr(\"src\", `api/images/${noteId}/${encodedTitle}?${Math.random()}`)\n            .attr(\"alt\", linkTitle);\n    }\n\n    const $container = $(\"<span>\");\n\n    if (showNoteIcon) {\n        let icon = await getLinkIcon(noteId, viewMode);\n\n        if (icon) {\n            $container\n                .append($(\"<span>\").addClass(`bx ${icon}`))\n                .append(\" \");\n        }\n    }\n\n    const hash = calculateHash({\n        notePath,\n        viewScope: viewScope\n    });\n\n    const $noteLink = $(\"<a>\", {\n        href: hash,\n        text: linkTitle\n    });\n\n    if (!showTooltip) {\n        $noteLink.addClass(\"no-tooltip-preview\");\n    }\n\n    if (referenceLink) {\n        $noteLink.addClass(\"reference-link\");\n    }\n\n    $container.append($noteLink);\n\n    if (showNotePath) {\n        const resolvedNotePathSegments = await treeService.resolveNotePathToSegments(notePath);\n\n        if (resolvedNotePathSegments) {\n            resolvedNotePathSegments.pop(); // remove last element\n\n            const parentNotePath = resolvedNotePathSegments.join(\"/\").trim();\n\n            if (parentNotePath) {\n                $container.append($(\"<small>\").text(` (${await treeService.getNotePathTitle(parentNotePath)})`));\n            }\n        }\n    }\n\n    return $container;\n}\n\nfunction calculateHash({notePath, ntxId, hoistedNoteId, viewScope = {}}) {\n    notePath = notePath || \"\";\n    const params = [\n        ntxId ? { ntxId: ntxId } : null,\n        (hoistedNoteId && hoistedNoteId !== 'root') ? { hoistedNoteId: hoistedNoteId } : null,\n        viewScope.viewMode && viewScope.viewMode !== 'default' ? { viewMode: viewScope.viewMode } : null,\n        viewScope.attachmentId ? { attachmentId: viewScope.attachmentId } : null\n    ].filter(p => !!p);\n\n    const paramStr = params.map(pair => {\n        const name = Object.keys(pair)[0];\n        const value = pair[name];\n\n        return `${encodeURIComponent(name)}=${encodeURIComponent(value)}`;\n    }).join(\"&\");\n\n    if (!notePath && !paramStr) {\n        return \"\";\n    }\n\n    let hash = `#${notePath}`;\n\n    if (paramStr) {\n        hash += `?${paramStr}`;\n    }\n\n    return hash;\n}\n\nfunction parseNavigationStateFromUrl(url) {\n    if (!url) {\n        return {};\n    }\n\n    const hashIdx = url.indexOf('#');\n    if (hashIdx === -1) {\n        return {};\n    }\n\n    const hash = url.substr(hashIdx + 1); // strip also the initial '#'\n    const [notePath, paramString] = hash.split(\"?\");\n\n    if (!notePath.match(/^[_a-z0-9]{4,}(\\/[_a-z0-9]{4,})*$/i)) {\n        return {};\n    }\n\n    const viewScope = {\n        viewMode: 'default'\n    };\n    let ntxId = null;\n    let hoistedNoteId = null;\n    let searchString = null;\n\n    if (paramString) {\n        for (const pair of paramString.split(\"&\")) {\n            let [name, value] = pair.split(\"=\");\n            name = decodeURIComponent(name);\n            value = decodeURIComponent(value);\n\n            if (name === 'ntxId') {\n                ntxId = value;\n            } else if (name === 'hoistedNoteId') {\n                hoistedNoteId = value;\n            } else if (name === 'searchString') {\n                searchString = value; // supports triggering search from URL, e.g. #?searchString=blabla\n            } else if (['viewMode', 'attachmentId'].includes(name)) {\n                viewScope[name] = value;\n            } else {\n                console.warn(`Unrecognized hash parameter '${name}'.`);\n            }\n        }\n    }\n\n    return {\n        notePath,\n        noteId: treeService.getNoteIdFromUrl(notePath),\n        ntxId,\n        hoistedNoteId,\n        viewScope,\n        searchString\n    };\n}\n\nfunction goToLink(evt) {\n    const $link = $(evt.target).closest(\"a,.block-link\");\n    const hrefLink = $link.attr('href') || $link.attr('data-href');\n\n    return goToLinkExt(evt, hrefLink, $link);\n}\n\nfunction goToLinkExt(evt, hrefLink, $link) {\n    if (hrefLink?.startsWith(\"data:\")) {\n        return true;\n    }\n\n    evt.preventDefault();\n    evt.stopPropagation();\n\n    const {notePath, viewScope} = parseNavigationStateFromUrl(hrefLink);\n\n    const ctrlKey = utils.isCtrlKey(evt);\n    const isLeftClick = evt.which === 1;\n    const isMiddleClick = evt.which === 2;\n    const openInNewTab = (isLeftClick && ctrlKey) || isMiddleClick;\n\n    const leftClick = evt.which === 1;\n    const middleClick = evt.which === 2;\n\n    if (notePath) {\n        if (openInNewTab) {\n            appContext.tabManager.openTabWithNoteWithHoisting(notePath, {viewScope});\n        } else if (isLeftClick) {\n            const ntxId = $(evt.target).closest(\"[data-ntx-id]\").attr(\"data-ntx-id\");\n\n            const noteContext = ntxId\n                ? appContext.tabManager.getNoteContextById(ntxId)\n                : appContext.tabManager.getActiveContext();\n\n            noteContext.setNote(notePath, {viewScope}).then(() => {\n                if (noteContext !== appContext.tabManager.getActiveContext()) {\n                    appContext.tabManager.activateNoteContext(noteContext.ntxId);\n                }\n            });\n        }\n    } else if (hrefLink) {\n        const withinEditLink = $link?.hasClass(\"ck-link-actions__preview\");\n        const outsideOfCKEditor = !$link || $link.closest(\"[contenteditable]\").length === 0;\n\n        if (openInNewTab\n            || (withinEditLink && (leftClick || middleClick))\n            || (outsideOfCKEditor && (leftClick || middleClick))\n        ) {\n            if (hrefLink.toLowerCase().startsWith('http') || hrefLink.startsWith(\"api/\")) {\n                window.open(hrefLink, '_blank');\n            } else if (hrefLink.toLowerCase().startsWith('file:') && utils.isElectron()) {\n                const electron = utils.dynamicRequire('electron');\n\n                electron.shell.openPath(hrefLink);\n            }\n        }\n    }\n\n    return true;\n}\n\nfunction linkContextMenu(e) {\n    const $link = $(e.target).closest(\"a\");\n    const url = $link.attr(\"href\") || $link.attr(\"data-href\");\n\n    const { notePath, viewScope } = parseNavigationStateFromUrl(url);\n\n    if (!notePath) {\n        return;\n    }\n\n    e.preventDefault();\n\n    linkContextMenuService.openContextMenu(notePath, e, viewScope, null);\n}\n\nasync function loadReferenceLinkTitle($el, href = null) {\n    const $link = $el[0].tagName === 'A' ? $el : $el.find(\"a\");\n\n    href = href || $link.attr(\"href\");\n    if (!href) {\n        console.warn(\"Empty URL for parsing: \" + $el[0].outerHTML);\n        return;\n    }\n\n    const {noteId, viewScope} = parseNavigationStateFromUrl(href);\n    const note = await froca.getNote(noteId, true);\n\n    if (note) {\n        $el.addClass(note.getColorClass());\n    }\n\n    const title = await getReferenceLinkTitle(href);\n    $el.text(title);\n\n    if (note) {\n        const icon = await getLinkIcon(noteId, viewScope.viewMode);\n\n        $el.prepend($(\"<span>\").addClass(icon));\n    }\n}\n\nasync function getReferenceLinkTitle(href) {\n    const {noteId, viewScope} = parseNavigationStateFromUrl(href);\n    if (!noteId) {\n        return \"[missing note]\";\n    }\n\n    const note = await froca.getNote(noteId);\n    if (!note) {\n        return \"[missing note]\";\n    }\n\n    if (viewScope?.viewMode === 'attachments' && viewScope?.attachmentId) {\n        const attachment = await note.getAttachmentById(viewScope.attachmentId);\n\n        return attachment ? attachment.title : \"[missing attachment]\";\n    } else {\n        return note.title;\n    }\n}\n\nfunction getReferenceLinkTitleSync(href) {\n    const {noteId, viewScope} = parseNavigationStateFromUrl(href);\n    if (!noteId) {\n        return \"[missing note]\";\n    }\n\n    const note = froca.getNoteFromCache(noteId);\n    if (!note) {\n        return \"[missing note]\";\n    }\n\n    if (viewScope?.viewMode === 'attachments' && viewScope?.attachmentId) {\n        if (!note.attachments) {\n            return \"[loading title...]\";\n        }\n\n        const attachment = note.attachments.find(att => att.attachmentId === viewScope.attachmentId);\n\n        return attachment ? attachment.title : \"[missing attachment]\";\n    } else {\n        return note.title;\n    }\n}\n\n$(document).on('click', \"a\", goToLink);\n$(document).on('auxclick', \"a\", goToLink); // to handle the middle button\n$(document).on('contextmenu', 'a', linkContextMenu);\n$(document).on('dblclick', \"a\", e => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const $link = $(e.target).closest(\"a\");\n\n    const address = $link.attr('href');\n\n    if (address && address.startsWith('http')) {\n        window.open(address, '_blank');\n    }\n});\n\n$(document).on('mousedown', 'a', e => {\n    if (e.which === 2) {\n        // prevent paste on middle click\n        // https://github.com/zadam/trilium/issues/2995\n        // https://developer.mozilla.org/en-US/docs/Web/API/Element/auxclick_event#preventing_default_actions\n        e.preventDefault();\n        return false;\n    }\n});\n\nexport default {\n    getNotePathFromUrl,\n    createLink,\n    goToLink,\n    goToLinkExt,\n    loadReferenceLinkTitle,\n    getReferenceLinkTitle,\n    getReferenceLinkTitleSync,\n    calculateHash,\n    parseNavigationStateFromUrl\n};\n","/**\n * The purpose of this class is to cache the list of attributes for notes.\n *\n * Cache invalidation granularity is global - whenever a write operation is detected to notes, branches or attributes,\n * we invalidate the whole cache. That's OK, since the purpose for this is to speed up batch read-only operations, such\n * as loading the tree which uses attributes heavily.\n */\nclass NoteAttributeCache {\n    constructor() {\n        /** @property {Object.<string, BAttribute[]>} */\n        this.attributes = {};\n    }\n\n    invalidate() {\n        this.attributes = {};\n    }\n}\n\nconst noteAttributeCache = new NoteAttributeCache();\n\nexport default noteAttributeCache;\n","import appContext from \"../components/app_context.js\";\nimport protectedSessionHolder from \"./protected_session_holder.js\";\nimport server from \"./server.js\";\nimport ws from \"./ws.js\";\nimport froca from \"./froca.js\";\nimport treeService from \"./tree.js\";\nimport toastService from \"./toast.js\";\n\nasync function createNote(parentNotePath, options = {}) {\n    options = Object.assign({\n        activate: true,\n        focus: 'title',\n        target: 'into'\n    }, options);\n\n    // if isProtected isn't available (user didn't enter password yet), then note is created as unencrypted,\n    // but this is quite weird since the user doesn't see WHERE the note is being created, so it shouldn't occur often\n    if (!options.isProtected || !protectedSessionHolder.isProtectedSessionAvailable()) {\n        options.isProtected = false;\n    }\n\n    if (appContext.tabManager.getActiveContextNoteType() !== 'text') {\n        options.saveSelection = false;\n    }\n\n    if (options.saveSelection) {\n        [options.title, options.content] = parseSelectedHtml(options.textEditor.getSelectedHtml());\n    }\n\n    const parentNoteId = treeService.getNoteIdFromUrl(parentNotePath);\n\n    if (options.type === 'mermaid' && !options.content) {\n        options.content = `graph TD;\n    A-->B;\n    A-->C;\n    B-->D;\n    C-->D;`\n    }\n\n    const {note, branch} = await server.post(`notes/${parentNoteId}/children?target=${options.target}&targetBranchId=${options.targetBranchId || \"\"}`, {\n        title: options.title,\n        content: options.content || \"\",\n        isProtected: options.isProtected,\n        type: options.type,\n        mime: options.mime,\n        templateNoteId: options.templateNoteId\n    });\n\n    if (options.saveSelection) {\n        // we remove the selection only after it was saved to server to make sure we don't lose anything\n        options.textEditor.removeSelection();\n    }\n\n    await ws.waitForMaxKnownEntityChangeId();\n\n    if (options.activate) {\n        const activeNoteContext = appContext.tabManager.getActiveContext();\n        await activeNoteContext.setNote(`${parentNotePath}/${note.noteId}`);\n\n        if (options.focus === 'title') {\n            appContext.triggerEvent('focusAndSelectTitle', {isNewNote: true});\n        }\n        else if (options.focus === 'content') {\n            appContext.triggerEvent('focusOnDetail', {ntxId: activeNoteContext.ntxId});\n        }\n    }\n\n    const noteEntity = await froca.getNote(note.noteId);\n    const branchEntity = froca.getBranch(branch.branchId);\n\n    return {\n        note: noteEntity,\n        branch: branchEntity\n    };\n}\n\nasync function chooseNoteType() {\n    return new Promise(res => {\n        appContext.triggerCommand(\"chooseNoteType\", {callback: res});\n    });\n}\n\nasync function createNoteWithTypePrompt(parentNotePath, options = {}) {\n    const {success, noteType, templateNoteId} = await chooseNoteType();\n\n    if (!success) {\n        return;\n    }\n\n    options.type = noteType;\n    options.templateNoteId = templateNoteId;\n\n    return await createNote(parentNotePath, options);\n}\n\n/* If the first element is heading, parse it out and use it as a new heading. */\nfunction parseSelectedHtml(selectedHtml) {\n    const dom = $.parseHTML(selectedHtml);\n\n    if (dom.length > 0 && dom[0].tagName && dom[0].tagName.match(/h[1-6]/i)) {\n        const title = $(dom[0]).text();\n        // remove the title from content (only first occurrence)\n        const content = selectedHtml.replace(dom[0].outerHTML, \"\");\n\n        return [title, content];\n    }\n    else {\n        return [null, selectedHtml];\n    }\n}\n\nasync function duplicateSubtree(noteId, parentNotePath) {\n    const parentNoteId = treeService.getNoteIdFromUrl(parentNotePath);\n    const {note} = await server.post(`notes/${noteId}/duplicate/${parentNoteId}`);\n\n    await ws.waitForMaxKnownEntityChangeId();\n\n    const activeNoteContext = appContext.tabManager.getActiveContext();\n    activeNoteContext.setNote(`${parentNotePath}/${note.noteId}`);\n\n    const origNote = await froca.getNote(noteId);\n    toastService.showMessage(`笔记 \"${origNote.title}\" 已被复制`);\n}\n\nexport default {\n    createNote,\n    createNoteWithTypePrompt,\n    duplicateSubtree,\n    chooseNoteType\n};\n","import treeService from \"./tree.js\";\nimport linkService from \"./link.js\";\nimport froca from \"./froca.js\";\nimport utils from \"./utils.js\";\nimport attributeRenderer from \"./attribute_renderer.js\";\nimport contentRenderer from \"./content_renderer.js\";\nimport appContext from \"../components/app_context.js\";\n\nfunction setupGlobalTooltip() {\n    $(document).on(\"mouseenter\", \"a\", mouseEnterHandler);\n\n    // close any note tooltip after click, this fixes the problem that sometimes tooltips remained on the screen\n    $(document).on(\"click\", e => {\n        if ($(e.target).closest(\".note-tooltip\").length) {\n            // click within the tooltip shouldn't close it\n            return;\n        }\n\n        $('.note-tooltip').remove();\n    });\n}\n\nfunction setupElementTooltip($el) {\n    $el.on('mouseenter', mouseEnterHandler);\n}\n\nasync function mouseEnterHandler() {\n    const $link = $(this);\n\n    if ($link.hasClass(\"no-tooltip-preview\") || $link.hasClass(\"disabled\")) {\n        return;\n    } else if ($link.closest(\".ck-link-actions\").length) {\n        // this is to avoid showing tooltip from inside the CKEditor link editor dialog\n        return;\n    } else if ($link.closest(\".note-tooltip\").length) {\n        // don't show tooltip for links within tooltip\n        return;\n    }\n\n    const url = $link.attr(\"href\") || $link.attr(\"data-href\");\n    const { notePath, noteId, viewScope } = linkService.parseNavigationStateFromUrl(url);\n\n    if (!notePath || viewScope.viewMode !== 'default') {\n        return;\n    }\n\n    const linkId = $link.attr(\"data-link-id\") || `link-${Math.floor(Math.random() * 1000000)}`;\n    $link.attr(\"data-link-id\", linkId);\n\n    if ($(`.${linkId}`).is(\":visible\")) {\n        // tooltip is already open for this link\n        return;\n    }\n\n    const note = await froca.getNote(noteId);\n\n    const [content] = await Promise.all([\n        renderTooltip(note),\n        // to reduce flicker due to accidental mouseover, cursor must stay for a bit over the link for tooltip to appear\n        new Promise(res => setTimeout(res, 500))\n    ]);\n\n    if (utils.isHtmlEmpty(content)) {\n        return;\n    }\n\n    const html = `<div class=\"note-tooltip-content\">${content}</div>`;\n    const tooltipClass = 'tooltip-' + Math.floor(Math.random() * 999_999_999);\n\n    // we need to check if we're still hovering over the element\n    // since the operation to get tooltip content was async, it is possible that\n    // we now create tooltip which won't close because it won't receive mouseleave event\n    if ($(this).filter(\":hover\").length > 0) {\n        $(this).tooltip({\n            container: 'body',\n            // https://github.com/zadam/trilium/issues/2794 https://github.com/zadam/trilium/issues/2988\n            // with bottom this flickering happens a bit less\n            placement: 'bottom',\n            trigger: 'manual',\n            boundary: 'window',\n            title: html,\n            html: true,\n            template: `<div class=\"tooltip note-tooltip ${tooltipClass}\" role=\"tooltip\"><div class=\"arrow\"></div><div class=\"tooltip-inner\"></div></div>`,\n            sanitize: false,\n            customClass: linkId\n        });\n\n        $(this).tooltip('show');\n\n        // the purpose of the code below is to:\n        // - allow user to go from hovering the link to hovering the tooltip to be able to scroll,\n        //   click on links within tooltip etc. without tooltip disappearing\n        // - once the user moves the cursor away from both link and the tooltip, hide the tooltip\n        const checkTooltip = () => {\n            if (!$(`.${tooltipClass}`).is(':visible')) {\n                console.log(\"Not visible anymore\");\n\n                return;\n            }\n\n            if (!$(this).filter(\":hover\").length && !$(`.${linkId}:hover`).length) {\n                // cursor is neither over the link nor over the tooltip, user likely is not interested\n                $(this).tooltip('dispose');\n            } else {\n                setTimeout(checkTooltip, 1000);\n            }\n        }\n\n        setTimeout(checkTooltip, 1000);\n    }\n}\n\nasync function renderTooltip(note) {\n    if (!note) {\n        return '<div>笔记已被删除.</div>';\n    }\n\n    const hoistedNoteId = appContext.tabManager.getActiveContext()?.hoistedNoteId;\n    const bestNotePath = note.getBestNotePathString(hoistedNoteId);\n\n    if (!bestNotePath) {\n        return;\n    }\n\n    let content = `<h5 class=\"note-tooltip-title\">${(await treeService.getNoteTitleWithPathAsSuffix(bestNotePath)).prop('outerHTML')}</h5>`;\n\n    const {$renderedAttributes} = await attributeRenderer.renderNormalAttributes(note);\n\n    const {$renderedContent} = await contentRenderer.getRenderedContent(note, {\n        tooltip: true,\n        trim: true\n    });\n\n    content = `${content}<div class=\"note-tooltip-attributes\">${$renderedAttributes[0].outerHTML}</div>${$renderedContent[0].outerHTML}`;\n\n    return content;\n}\n\nexport default {\n    setupGlobalTooltip,\n    setupElementTooltip\n}\n","import server from \"./server.js\";\nimport froca from \"./froca.js\";\n\nasync function getNoteTypeItems(command) {\n    const items = [\n        { title: \"文本\", command: command, type: \"text\", uiIcon: \"bx bx-note\" },\n        { title: \"代码\", command: command, type: \"code\", uiIcon: \"bx bx-code\" },\n        { title: \"保存的搜索\", command: command, type: \"search\", uiIcon: \"bx bx-file-find\" },\n        { title: \"关系图\", command: command, type: \"relationMap\", uiIcon: \"bx bx-map-alt\" },\n        { title: \"笔记地图\", command: command, type: \"noteMap\", uiIcon: \"bx bx-map-alt\" },\n        { title: \"渲染笔记\", command: command, type: \"render\", uiIcon: \"bx bx-extension\" },\n        { title: \"书\", command: command, type: \"book\", uiIcon: \"bx bx-book\" },\n        { title: \"美人鱼图\", command: command, type: \"mermaid\", uiIcon: \"bx bx-selection\" },\n        { title: \"画布\", command: command, type: \"canvas\", uiIcon: \"bx bx-pen\" },\n        { title: \"网页视图\", command: command, type: \"webView\", uiIcon: \"bx bx-globe-alt\" },\n    ];\n\n    const templateNoteIds = await server.get(\"search-templates\");\n    const templateNotes = await froca.getNotes(templateNoteIds);\n\n    if (templateNotes.length > 0) {\n        items.push({ title: \"----\" });\n\n        for (const templateNote of templateNotes) {\n            items.push({\n                title: templateNote.title,\n                uiIcon: templateNote.getIcon(),\n                command: command,\n                type: templateNote.type,\n                templateNoteId: templateNote.noteId\n            });\n        }\n    }\n\n    return items;\n}\n\nexport default {\n    getNoteTypeItems\n}\n","import utils from \"./utils.js\";\nimport server from \"./server.js\";\n\nfunction checkType(type) {\n    if (type !== 'notes' && type !== 'attachments') {\n        throw new Error(`Unrecognized type '${type}', should be 'notes' or 'attachments'`);\n    }\n}\n\nfunction getFileUrl(type, noteId) {\n    checkType(type);\n\n    return getUrlForDownload(`api/${type}/${noteId}/download`);\n}\n\nfunction getOpenFileUrl(type, noteId) {\n    checkType(type);\n\n    return getUrlForDownload(`api/${type}/${noteId}/open`);\n}\n\nfunction download(url) {\n    if (utils.isElectron()) {\n        const remote = utils.dynamicRequire('@electron/remote');\n\n        remote.getCurrentWebContents().downloadURL(url);\n    } else {\n        window.location.href = url;\n    }\n}\n\nfunction downloadFileNote(noteId) {\n    const url = `${getFileUrl('notes', noteId)}?${Date.now()}`; // don't use cache\n\n    download(url);\n}\n\nfunction downloadAttachment(attachmentId) {\n    const url = `${getFileUrl('attachments', attachmentId)}?${Date.now()}`; // don't use cache\n\n    download(url);\n}\n\nasync function openCustom(type, entityId, mime) {\n    checkType(type);\n    if (!utils.isElectron() || utils.isMac()) {\n        return;\n    }\n\n    const resp = await server.post(`${type}/${entityId}/save-to-tmp-dir`);\n    let filePath = resp.tmpFilePath;\n    const {exec} = utils.dynamicRequire('child_process');\n    const platform = process.platform;\n\n    if (platform === 'linux') {\n        // we don't know which terminal is available, try in succession\n        const terminals = ['x-terminal-emulator', 'gnome-terminal', 'konsole', 'xterm', 'xfce4-terminal', 'mate-terminal', 'rxvt', 'terminator', 'terminology'];\n        const openFileWithTerminal = (terminal) => {\n            const command = `${terminal} -e 'mimeopen -d \"${filePath}\"'`;\n            console.log(`Open Note custom: ${command} `);\n            exec(command, (error, stdout, stderr) => {\n                if (error) {\n                    console.error(`Open Note custom: Failed to open file with ${terminal}: ${error}`);\n                    searchTerminal(terminals.indexOf(terminal) + 1);\n                } else {\n                    console.log(`Open Note custom: File opened with ${terminal}: ${stdout}`);\n                }\n            });\n        };\n\n        const searchTerminal = (index) => {\n            const terminal = terminals[index];\n            if (!terminal) {\n                console.error('Open Note custom: No terminal found!');\n                open(getFileUrl(entityId), {url: true});\n                return;\n            }\n            exec(`which ${terminal}`, (error, stdout, stderr) => {\n                if (stdout.trim()) {\n                    openFileWithTerminal(terminal);\n                } else {\n                    searchTerminal(index + 1);\n                }\n            });\n        };\n        searchTerminal(0);\n    } else if (platform === 'win32') {\n        if (filePath.indexOf(\"/\") !== -1) {\n            // Note that the path separator must be \\ instead of /\n            filePath = filePath.replace(/\\//g, \"\\\\\");\n        }\n        const command = `rundll32.exe shell32.dll,OpenAs_RunDLL ` + filePath;\n        exec(command, (err, stdout, stderr) => {\n            if (err) {\n                console.error(\"Open Note custom: \", err);\n                open(getFileUrl(entityId), {url: true});\n                return;\n            }\n        });\n    } else {\n        console.log('Currently \"Open Note custom\" only supports linux and windows systems');\n        open(getFileUrl(entityId), {url: true});\n    }\n}\n\nconst openNoteCustom = async (noteId, mime) => await openCustom('notes', noteId, mime);\nconst openAttachmentCustom = async (attachmentId, mime) => await openCustom('attachments', attachmentId, mime);\n\n\nfunction downloadRevision(noteId, revisionId) {\n    const url = getUrlForDownload(`api/revisions/${revisionId}/download`);\n\n    download(url);\n}\n\n/**\n * @param url - should be without initial slash!!!\n */\nfunction getUrlForDownload(url) {\n    if (utils.isElectron()) {\n        // electron needs absolute URL, so we extract current host, port, protocol\n        return `${getHost()}/${url}`;\n    }\n    else {\n        // web server can be deployed on subdomain, so we need to use a relative path\n        return url;\n    }\n}\n\nfunction canOpenInBrowser(mime) {\n    return mime === \"application/pdf\"\n        || mime.startsWith(\"image\")\n        || mime.startsWith(\"audio\")\n        || mime.startsWith(\"video\");\n}\n\nasync function openExternally(type, entityId, mime) {\n    checkType(type);\n\n    if (utils.isElectron()) {\n        const resp = await server.post(`${type}/${entityId}/save-to-tmp-dir`);\n\n        const electron = utils.dynamicRequire('electron');\n        const res = await electron.shell.openPath(resp.tmpFilePath);\n\n        if (res) {\n            // fallback in case there's no default application for this file\n            window.open(getFileUrl(type, entityId));\n        }\n    }\n    else {\n        // allow browser to handle opening common file\n        if (canOpenInBrowser(mime)) {\n            window.open(getOpenFileUrl(type, entityId));\n        } else {\n            window.location.href = getFileUrl(type, entityId);\n        }\n    }\n}\n\nconst openNoteExternally = async (noteId, mime) => await openExternally('notes', noteId, mime);\nconst openAttachmentExternally = async (attachmentId, mime) => await openExternally('attachments', attachmentId, mime);\n\nfunction getHost() {\n    const url = new URL(window.location.href);\n    return `${url.protocol}//${url.hostname}:${url.port}`;\n}\n\nexport default {\n    download,\n    downloadFileNote,\n    downloadRevision,\n    downloadAttachment,\n    getUrlForDownload,\n    openNoteExternally,\n    openAttachmentExternally,\n    openNoteCustom,\n    openAttachmentCustom,\n}\n","import server from \"./server.js\";\n\nclass Options {\n    constructor() {\n        this.initializedPromise = server.get('options').then(data => this.load(data));\n    }\n\n    load(arr) {\n        this.arr = arr;\n    }\n\n    get(key) {\n        return this.arr[key];\n    }\n\n    getNames() {\n        return Object.keys(this.arr);\n    }\n\n    getJson(key) {\n        try {\n            return JSON.parse(this.arr[key]);\n        }\n        catch (e) {\n            return null;\n        }\n    }\n\n    getInt(key) {\n        return parseInt(this.arr[key]);\n    }\n\n    getFloat(key) {\n        return parseFloat(this.arr[key]);\n    }\n\n    is(key) {\n        return this.arr[key] === 'true';\n    }\n\n    set(key, value) {\n        this.arr[key] = value;\n    }\n\n    async save(key, value) {\n        this.set(key, value);\n\n        const payload = {};\n        payload[key] = value;\n\n        await server.put(`options`, payload);\n    }\n\n    async toggle(key) {\n        await this.save(key, (!this.is(key)).toString());\n    }\n}\n\nconst options = new Options();\n\nexport default options;\n","function parse(value) {\n    const tokens = value.split(',').map(t => t.trim());\n    const defObj = {};\n\n    for (const token of tokens) {\n        if (token === 'promoted') {\n            defObj.isPromoted = true;\n        }\n        else if (['text', 'number', 'boolean', 'date', 'datetime', 'url'].includes(token)) {\n            defObj.labelType = token;\n        }\n        else if (['single', 'multi'].includes(token)) {\n            defObj.multiplicity = token;\n        }\n        else if (token.startsWith('precision')) {\n            const chunks = token.split('=');\n\n            defObj.numberPrecision = parseInt(chunks[1]);\n        }\n        else if (token.startsWith('alias')) {\n            const chunks = token.split('=');\n\n            defObj.promotedAlias = chunks[1];\n        }\n        else if (token.startsWith('inverse')) {\n            const chunks = token.split('=');\n\n            defObj.inverseRelation = chunks[1];\n        }\n        else {\n            console.log(\"Unrecognized attribute definition token:\", token);\n        }\n    }\n\n    return defObj;\n}\n\nexport default {\n    parse\n};\n","import server from './server.js';\nimport protectedSessionHolder from './protected_session_holder.js';\nimport toastService from \"./toast.js\";\nimport ws from \"./ws.js\";\nimport appContext from \"../components/app_context.js\";\nimport froca from \"./froca.js\";\nimport utils from \"./utils.js\";\nimport options from \"./options.js\";\n\nlet protectedSessionDeferred = null;\n\nasync function leaveProtectedSession() {\n    if (protectedSessionHolder.isProtectedSessionAvailable()) {\n        await protectedSessionHolder.resetProtectedSession();\n    }\n}\n\n/** returned promise resolves with true if new protected session was established, false if no action was necessary */\nfunction enterProtectedSession() {\n    const dfd = $.Deferred();\n\n    if (!options.is(\"isPasswordSet\")) {\n        appContext.triggerCommand(\"showPasswordNotSet\");\n        return dfd;\n    }\n\n    if (protectedSessionHolder.isProtectedSessionAvailable()) {\n        dfd.resolve(false);\n    }\n    else {\n        // using deferred instead of promise because it allows resolving from the outside\n        protectedSessionDeferred = dfd;\n\n        appContext.triggerCommand(\"showProtectedSessionPasswordDialog\");\n    }\n\n    return dfd.promise();\n}\n\nasync function reloadData() {\n    const allNoteIds = Object.keys(froca.notes);\n\n    await froca.loadInitialTree();\n\n    // make sure that all notes used in the application are loaded, including the ones not shown in the tree\n    await froca.reloadNotes(allNoteIds, true);\n}\n\nasync function setupProtectedSession(password) {\n    const response = await server.post('login/protected', { password: password });\n\n    if (!response.success) {\n        toastService.showError(\"密码错误.\", 3000);\n        return;\n    }\n\n    protectedSessionHolder.enableProtectedSession();\n}\n\nws.subscribeToMessages(async message => {\n    if (message.type === 'protectedSessionLogin') {\n        await reloadData();\n\n        await appContext.triggerEvent('frocaReloaded');\n\n        appContext.triggerEvent('protectedSessionStarted');\n\n        appContext.triggerCommand(\"closeProtectedSessionPasswordDialog\");\n\n        if (protectedSessionDeferred !== null) {\n            protectedSessionDeferred.resolve(true);\n            protectedSessionDeferred = null;\n        }\n\n        toastService.showMessage(\"受保护的会话已启动.\");\n    }\n    else if (message.type === 'protectedSessionLogout') {\n        utils.reloadFrontendApp(`Protected session logout`);\n    }\n});\n\nasync function protectNote(noteId, protect, includingSubtree) {\n    await enterProtectedSession();\n\n    await server.put(`notes/${noteId}/protect/${protect ? 1 : 0}?subtree=${includingSubtree ? 1 : 0}`);\n}\n\nfunction makeToast(message, protectingLabel, text) {\n    return {\n        id: message.taskId,\n        title: `${protectingLabel} status`,\n        message: text,\n        icon: message.data.protect ? \"check-shield\" : \"shield\"\n    };\n}\n\nws.subscribeToMessages(async message => {\n    if (message.taskType !== 'protectNotes') {\n        return;\n    }\n\n    const protectingLabel = message.data.protect ? \"保护\" : \"取消保护\";\n\n    if (message.type === 'taskError') {\n        toastService.closePersistent(message.taskId);\n        toastService.showError(message.message);\n    } else if (message.type === 'taskProgressCount') {\n        toastService.showPersistent(makeToast(message, protectingLabel,`${protectingLabel} in progress: ${message.progressCount}`));\n    } else if (message.type === 'taskSucceeded') {\n        const toast = makeToast(message, protectingLabel, `${protectingLabel} finished successfully.`);\n        toast.closeAfter = 3000;\n\n        toastService.showPersistent(toast);\n    }\n});\n\nexport default {\n    protectNote,\n    enterProtectedSession,\n    leaveProtectedSession,\n    setupProtectedSession\n};\n","import server from \"./server.js\";\n\nfunction enableProtectedSession() {\n    glob.isProtectedSessionAvailable = true;\n\n    touchProtectedSession();\n}\n\nasync function resetProtectedSession() {\n    await server.post(\"logout/protected\");\n}\n\nfunction isProtectedSessionAvailable() {\n    return glob.isProtectedSessionAvailable;\n}\n\nasync function touchProtectedSession() {\n    if (isProtectedSessionAvailable()) {\n        await server.post(\"login/protected/touch\");\n    }\n}\n\nfunction touchProtectedSessionIfNecessary(note) {\n    if (note && note.isProtected && isProtectedSessionAvailable()) {\n        touchProtectedSession();\n    }\n}\n\nexport default {\n    enableProtectedSession,\n    resetProtectedSession,\n    isProtectedSessionAvailable,\n    touchProtectedSession,\n    touchProtectedSessionIfNecessary\n};\n","import server from \"./server.js\";\nimport bundleService from \"./bundle.js\";\n\nasync function render(note, $el) {\n    const relations = note.getRelations('renderNote');\n    const renderNoteIds = relations\n        .map(rel => rel.value)\n        .filter(noteId => noteId);\n\n    $el.empty().toggle(renderNoteIds.length > 0);\n\n    for (const renderNoteId of renderNoteIds) {\n        const bundle = await server.post(`script/bundle/${renderNoteId}`);\n\n        const $scriptContainer = $('<div>');\n        $el.append($scriptContainer);\n\n        $scriptContainer.append(bundle.html);\n\n        // async so that scripts cannot block trilium execution\n        bundleService.executeBundle(bundle, note, $scriptContainer);\n    }\n\n    return renderNoteIds.length > 0;\n}\n\nexport default {\n    render\n}\n","import server from './server.js';\nimport utils from './utils.js';\nimport toastService from './toast.js';\nimport linkService from './link.js';\nimport froca from './froca.js';\nimport noteTooltipService from './note_tooltip.js';\nimport protectedSessionService from './protected_session.js';\nimport dateNotesService from './date_notes.js';\nimport searchService from './search.js';\nimport RightPanelWidget from '../widgets/right_panel_widget.js';\nimport ws from \"./ws.js\";\nimport appContext from \"../components/app_context.js\";\nimport NoteContextAwareWidget from \"../widgets/note_context_aware_widget.js\";\nimport BasicWidget from \"../widgets/basic_widget.js\";\nimport SpacedUpdate from \"./spaced_update.js\";\nimport shortcutService from \"./shortcuts.js\";\nimport dialogService from \"./dialog.js\";\n\n\n/**\n * A whole number\n * @typedef {number} int\n */\n\n/**\n * An instance of the frontend api available globally.\n * @global\n * @var {FrontendScriptApi} api\n */\n\n/**\n * <p>This is the main frontend API interface for scripts. All the properties and methods are published in the \"api\" object\n * available in the JS frontend notes. You can use e.g. <code>api.showMessage(api.startNote.title);</code></p>\n *\n * @constructor\n */\nfunction FrontendScriptApi(startNote, currentNote, originEntity = null, $container = null) {\n    /**\n     * Container of all the rendered script content\n     * @type {jQuery}\n     * */\n    this.$container = $container;\n\n    /**\n     * Note where the script started executing, i.e., the (event) entrypoint of the current script execution.\n     * @type {FNote}\n     */\n    this.startNote = startNote;\n\n    /**\n     * Note where the script is currently executing, i.e. the note where the currently executing source code is written.\n     * @type {FNote}\n     */\n    this.currentNote = currentNote;\n\n    /**\n     * Entity whose event triggered this execution.\n     * @type {object|null}\n     */\n    this.originEntity = originEntity;\n\n    /**\n     * day.js library for date manipulation.\n     * See {@link https://day.js.org} for documentation\n     * @see https://day.js.org\n     * @type {dayjs}\n     */\n    this.dayjs = dayjs;\n\n    /** @type {RightPanelWidget} */\n    this.RightPanelWidget = RightPanelWidget;\n\n    /** @type {NoteContextAwareWidget} */\n    this.NoteContextAwareWidget = NoteContextAwareWidget;\n\n    /** @type {BasicWidget} */\n    this.BasicWidget = BasicWidget;\n\n    /**\n     * Activates note in the tree and in the note detail.\n     *\n     * @method\n     * @param {string} notePath (or noteId)\n     * @returns {Promise<void>}\n     */\n    this.activateNote = async notePath => {\n        await appContext.tabManager.getActiveContext().setNote(notePath);\n    };\n\n    /**\n     * Activates newly created note. Compared to this.activateNote() also makes sure that frontend has been fully synced.\n     *\n     * @param {string} notePath (or noteId)\n     * @returns {Promise<void>}\n     */\n    this.activateNewNote = async notePath => {\n        await ws.waitForMaxKnownEntityChangeId();\n\n        await appContext.tabManager.getActiveContext().setNote(notePath);\n        await appContext.triggerEvent('focusAndSelectTitle');\n    };\n\n    /**\n     * Open a note in a new tab.\n     *\n     * @method\n     * @param {string} notePath (or noteId)\n     * @param {boolean} activate - set to true to activate the new tab, false to stay on the current tab\n     * @returns {Promise<void>}\n     */\n    this.openTabWithNote = async (notePath, activate) => {\n        await ws.waitForMaxKnownEntityChangeId();\n\n        await appContext.tabManager.openTabWithNoteWithHoisting(notePath, { activate });\n\n        if (activate) {\n            await appContext.triggerEvent('focusAndSelectTitle');\n        }\n    };\n\n    /**\n     * Open a note in a new split.\n     *\n     * @method\n     * @param {string} notePath (or noteId)\n     * @param {boolean} activate - set to true to activate the new split, false to stay on the current split\n     * @returns {Promise<void>}\n     */\n    this.openSplitWithNote = async (notePath, activate) => {\n        await ws.waitForMaxKnownEntityChangeId();\n\n        const subContexts = appContext.tabManager.getActiveContext().getSubContexts();\n        const {ntxId} = subContexts[subContexts.length - 1];\n\n        await appContext.triggerCommand(\"openNewNoteSplit\", {ntxId, notePath});\n\n        if (activate) {\n            await appContext.triggerEvent('focusAndSelectTitle');\n        }\n    };\n\n    /**\n     * Adds a new launcher to the launchbar. If the launcher (id) already exists, it will be updated.\n     *\n     * @method\n     * @deprecated you can now create/modify launchers in the top-left Menu -> Configure Launchbar\n     *             for special needs there's also backend API's createOrUpdateLauncher()\n     * @param {object} opts\n     * @param {string} opts.title\n     * @param {function} opts.action - callback handling the click on the button\n     * @param {string} [opts.id] - id of the button, used to identify the old instances of this button to be replaced\n     *                          ID is optional because of BC, but not specifying it is deprecated. ID can be alphanumeric only.\n     * @param {string} [opts.icon] - name of the boxicon to be used (e.g. \"time\" for \"bx-time\" icon)\n     * @param {string} [opts.shortcut] - keyboard shortcut for the button, e.g. \"alt+t\"\n     */\n    this.addButtonToToolbar = async opts => {\n        console.warn(\"api.addButtonToToolbar() has been deprecated since v0.58 and may be removed in the future. Use  Menu -> Configure Launchbar to create/update launchers instead.\");\n\n        const {action, ...reqBody} = opts;\n        reqBody.action = action.toString();\n\n        await server.put('special-notes/api-script-launcher', reqBody);\n    };\n\n    function prepareParams(params) {\n        if (!params) {\n            return params;\n        }\n\n        return params.map(p => {\n            if (typeof p === \"function\") {\n                return `!@#Function: ${p.toString()}`;\n            }\n            else {\n                return p;\n            }\n        });\n    }\n\n    /**\n     * @private\n     */\n    this.__runOnBackendInner = async (func, params, transactional) => {\n        if (typeof func === \"function\") {\n            func = func.toString();\n        }\n\n        const ret = await server.post('script/exec', {\n            script: func,\n            params: prepareParams(params),\n            startNoteId: startNote.noteId,\n            currentNoteId: currentNote.noteId,\n            originEntityName: \"notes\", // currently there's no other entity on the frontend which can trigger event\n            originEntityId: originEntity ? originEntity.noteId : null,\n            transactional\n        }, \"script\");\n\n        if (ret.success) {\n            await ws.waitForMaxKnownEntityChangeId();\n\n            return ret.executionResult;\n        } else {\n            throw new Error(`server error: ${ret.error}`);\n        }\n    }\n\n    /**\n     * Executes given anonymous function on the backend.\n     * Internally this serializes the anonymous function into string and sends it to backend via AJAX.\n     * Please make sure that the supplied function is synchronous. Only sync functions will work correctly\n     * with transaction management. If you really know what you're doing, you can call api.runAsyncOnBackendWithManualTransactionHandling()\n     *\n     * @method\n     * @param {function|string} func - (synchronous) function to be executed on the backend\n     * @param {Array.<?>} params - list of parameters to the anonymous function to be sent to backend\n     * @returns {Promise<*>} return value of the executed function on the backend\n     */\n    this.runOnBackend = async (func, params = []) => {\n        if (func?.constructor.name === \"AsyncFunction\" || func?.startsWith?.(\"async \")) {\n            toastService.showError(\"You're passing an async function to api.runOnBackend() which will likely not work as you intended. \"\n                + \"Either make the function synchronous (by removing 'async' keyword), or use api.runAsyncOnBackendWithManualTransactionHandling()\");\n        }\n\n        return await this.__runOnBackendInner(func, params, true);\n    };\n\n    /**\n     * Executes given anonymous function on the backend.\n     * Internally this serializes the anonymous function into string and sends it to backend via AJAX.\n     * This function is meant for advanced needs where an async function is necessary.\n     * In this case, the automatic request-scoped transaction management is not applied,\n     * and you need to manually define transaction via api.transactional().\n     *\n     * If you have a synchronous function, please use api.runOnBackend().\n     *\n     * @method\n     * @param {function|string} func - (synchronous) function to be executed on the backend\n     * @param {Array.<?>} params - list of parameters to the anonymous function to be sent to backend\n     * @returns {Promise<*>} return value of the executed function on the backend\n     */\n    this.runAsyncOnBackendWithManualTransactionHandling = async (func, params = []) => {\n        if (func?.constructor.name === \"Function\" || func?.startsWith?.(\"function\")) {\n            toastService.showError(\"You're passing a synchronous function to api.runAsyncOnBackendWithManualTransactionHandling(), \" +\n                \"while you should likely use api.runOnBackend() instead.\");\n        }\n\n        return await this.__runOnBackendInner(func, params, false);\n    };\n\n    /**\n     * This is a powerful search method - you can search by attributes and their values, e.g.:\n     * \"#dateModified =* MONTH AND #log\". See full documentation for all options at: https://github.com/zadam/trilium/wiki/Search\n     *\n     * @method\n     * @param {string} searchString\n     * @returns {Promise<FNote[]>}\n     */\n    this.searchForNotes = async searchString => {\n        return await searchService.searchForNotes(searchString);\n    };\n\n    /**\n     * This is a powerful search method - you can search by attributes and their values, e.g.:\n     * \"#dateModified =* MONTH AND #log\". See full documentation for all options at: https://github.com/zadam/trilium/wiki/Search\n     *\n     * @method\n     * @param {string} searchString\n     * @returns {Promise<FNote|null>}\n     */\n    this.searchForNote = async searchString => {\n        const notes = await this.searchForNotes(searchString);\n\n        return notes.length > 0 ? notes[0] : null;\n    };\n\n    /**\n     * Returns note by given noteId. If note is missing from the cache, it's loaded.\n     **\n     * @method\n     * @param {string} noteId\n     * @returns {Promise<FNote>}\n     */\n    this.getNote = async noteId => await froca.getNote(noteId);\n\n    /**\n     * Returns list of notes. If note is missing from the cache, it's loaded.\n     *\n     * This is often used to bulk-fill the cache with notes which would have to be picked one by one\n     * otherwise (by e.g. createLink())\n     *\n     * @method\n     * @param {string[]} noteIds\n     * @param {boolean} [silentNotFoundError] - don't report error if the note is not found\n     * @returns {Promise<FNote[]>}\n     */\n    this.getNotes = async (noteIds, silentNotFoundError = false) => await froca.getNotes(noteIds, silentNotFoundError);\n\n    /**\n     * Update frontend tree (note) cache from the backend.\n     *\n     * @method\n     * @param {string[]} noteIds\n     */\n    this.reloadNotes = async noteIds => await froca.reloadNotes(noteIds);\n\n    /**\n     * Instance name identifies particular Trilium instance. It can be useful for scripts\n     * if some action needs to happen on only one specific instance.\n     *\n     * @method\n     * @returns {string}\n     */\n    this.getInstanceName = () => window.glob.instanceName;\n\n    /**\n     * @method\n     * @param {Date} date\n     * @returns {string} date in YYYY-MM-DD format\n     */\n    this.formatDateISO = utils.formatDateISO;\n\n    /**\n     * @method\n     * @param {string} str\n     * @returns {Date} parsed object\n     */\n    this.parseDate = utils.parseDate;\n\n    /**\n     * Show an info toast message to the user.\n     *\n     * @method\n     * @param {string} message\n     */\n    this.showMessage = toastService.showMessage;\n\n    /**\n     * Show an error toast message to the user.\n     *\n     * @method\n     * @param {string} message\n     */\n    this.showError = toastService.showError;\n\n    /**\n     * Show an info dialog to the user.\n     *\n     * @method\n     * @param {string} message\n     * @returns {Promise}\n     */\n    this.showInfoDialog = dialogService.info;\n\n    /**\n     * Show confirm dialog to the user.\n     *\n     * @method\n     * @param {string} message\n     * @returns {Promise<boolean>} promise resolving to true if the user confirmed\n     */\n    this.showConfirmDialog = dialogService.confirm;\n\n    /**\n     * Show prompt dialog to the user.\n     *\n     * @method\n     * @param {object} props\n     * @param {string} props.title\n     * @param {string} props.message\n     * @param {string} props.defaultValue\n     * @returns {Promise<string>} promise resolving to the answer provided by the user\n     */\n    this.showPromptDialog = dialogService.prompt;\n\n    /**\n     * Trigger command. This is a very low-level API which should be avoided if possible.\n     *\n     * @method\n     * @param {string} name\n     * @param {object} data\n     */\n    this.triggerCommand = (name, data) => appContext.triggerCommand(name, data);\n\n    /**\n     * Trigger event. This is a very low-level API which should be avoided if possible.\n     *\n     * @method\n     * @param {string} name\n     * @param {object} data\n     */\n    this.triggerEvent = (name, data) => appContext.triggerEvent(name, data);\n\n    /**\n     * Create a note link (jQuery object) for given note.\n     *\n     * @method\n     * @param {string} notePath (or noteId)\n     * @param {object} [params]\n     * @param {boolean} [params.showTooltip=true] - enable/disable tooltip on the link\n     * @param {boolean} [params.showNotePath=false] - show also whole note's path as part of the link\n     * @param {boolean} [params.showNoteIcon=false] - show also note icon before the title\n     * @param {string} [params.title] - custom link tile with note's title as default\n     * @param {string} [params.title=] - custom link tile with note's title as default\n     * @returns {jQuery} - jQuery element with the link (wrapped in <span>)\n     */\n    this.createLink = linkService.createLink;\n\n    /** @deprecated - use api.createLink() instead */\n    this.createNoteLink = linkService.createLink;\n\n    /**\n     * Adds given text to the editor cursor\n     *\n     * @method\n     * @param {string} text - this must be clear text, HTML is not supported.\n     */\n    this.addTextToActiveContextEditor = text => appContext.triggerCommand('addTextToActiveEditor', {text});\n\n    /**\n     * @method\n     * @returns {FNote} active note (loaded into center pane)\n     */\n    this.getActiveContextNote = () => appContext.tabManager.getActiveContextNote();\n\n    /**\n     * @method\n     * @returns {NoteContext} - returns active context (split)\n     */\n    this.getActiveContext = () => appContext.tabManager.getActiveContext();\n\n    /**\n     * @method\n     * @returns {NoteContext} - returns active main context (first split in a tab, represents the tab as a whole)\n     */\n    this.getActiveMainContext = () => appContext.tabManager.getActiveMainContext();\n\n    /**\n     * @method\n     * @returns {NoteContext[]} - returns all note contexts (splits) in all tabs\n     */\n    this.getNoteContexts = () => appContext.tabManager.getNoteContexts();\n\n    /**\n     * @method\n     * @returns {NoteContext[]} - returns all main contexts representing tabs\n     */\n    this.getMainNoteContexts = () => appContext.tabManager.getMainNoteContexts();\n\n    /**\n     * See https://ckeditor.com/docs/ckeditor5/latest/api/module_core_editor_editor-Editor.html for documentation on the returned instance.\n     *\n     * @method\n     * @returns {Promise<BalloonEditor>} instance of CKEditor\n     */\n    this.getActiveContextTextEditor = () => appContext.tabManager.getActiveContext()?.getTextEditor();\n\n    /**\n     * See https://codemirror.net/doc/manual.html#api\n     *\n     * @method\n     * @returns {Promise<CodeMirror>} instance of CodeMirror\n     */\n    this.getActiveContextCodeEditor = () => appContext.tabManager.getActiveContext()?.getCodeEditor();\n\n    /**\n     * Get access to the widget handling note detail. Methods like `getWidgetType()` and `getTypeWidget()` to get to the\n     * implementation of actual widget type.\n     *\n     * @method\n     * @returns {Promise<NoteDetailWidget>}\n     */\n    this.getActiveNoteDetailWidget = () => new Promise(resolve => appContext.triggerCommand('executeInActiveNoteDetailWidget', {callback: resolve}));\n\n    /**\n     * @method\n     * @returns {Promise<string|null>} returns a note path of active note or null if there isn't active note\n     */\n    this.getActiveContextNotePath = () => appContext.tabManager.getActiveContextNotePath();\n\n    /**\n     * Returns component which owns the given DOM element (the nearest parent component in DOM tree)\n     *\n     * @method\n     * @param {Element} el - DOM element\n     * @returns {Component}\n     */\n    this.getComponentByEl = el => appContext.getComponentByEl(el);\n\n    /**\n     * @method\n     * @param {object} $el - jquery object on which to set up the tooltip\n     * @returns {Promise<void>}\n     */\n    this.setupElementTooltip = noteTooltipService.setupElementTooltip;\n\n    /**\n     * @method\n     * @param {string} noteId\n     * @param {boolean} protect - true to protect note, false to unprotect\n     * @returns {Promise<void>}\n     */\n    this.protectNote = async (noteId, protect) => {\n        await protectedSessionService.protectNote(noteId, protect, false);\n    };\n\n    /**\n     * @method\n     * @param {string} noteId\n     * @param {boolean} protect - true to protect subtree, false to unprotect\n     * @returns {Promise<void>}\n     */\n    this.protectSubTree = async (noteId, protect) => {\n        await protectedSessionService.protectNote(noteId, protect, true);\n    };\n\n    /**\n     * Returns date-note for today. If it doesn't exist, it is automatically created.\n     *\n     * @method\n     * @returns {Promise<FNote>}\n     */\n    this.getTodayNote = dateNotesService.getTodayNote;\n\n    /**\n     * Returns day note for a given date. If it doesn't exist, it is automatically created.\n     *\n     * @method\n     * @param {string} date - e.g. \"2019-04-29\"\n     * @returns {Promise<FNote>}\n     */\n    this.getDayNote = dateNotesService.getDayNote;\n\n    /**\n     * Returns day note for the first date of the week of the given date. If it doesn't exist, it is automatically created.\n     *\n     * @method\n     * @param {string} date - e.g. \"2019-04-29\"\n     * @returns {Promise<FNote>}\n     */\n    this.getWeekNote = dateNotesService.getWeekNote;\n\n    /**\n     * Returns month-note. If it doesn't exist, it is automatically created.\n     *\n     * @method\n     * @param {string} month - e.g. \"2019-04\"\n     * @returns {Promise<FNote>}\n     */\n    this.getMonthNote = dateNotesService.getMonthNote;\n\n    /**\n     * Returns year-note. If it doesn't exist, it is automatically created.\n     *\n     * @method\n     * @param {string} year - e.g. \"2019\"\n     * @returns {Promise<FNote>}\n     */\n    this.getYearNote = dateNotesService.getYearNote;\n\n    /**\n     * Hoist note in the current tab. See https://github.com/zadam/trilium/wiki/Note-hoisting\n     *\n     * @method\n     * @param {string} noteId - set hoisted note. 'root' will effectively unhoist\n     * @returns {Promise<void>}\n     */\n    this.setHoistedNoteId = (noteId) => {\n        const activeNoteContext = appContext.tabManager.getActiveContext();\n\n        if (activeNoteContext) {\n            activeNoteContext.setHoistedNoteId(noteId);\n        }\n    };\n\n    /**\n     * @method\n     * @param {string} keyboardShortcut - e.g. \"ctrl+shift+a\"\n     * @param {function} handler\n     * @param {string} [namespace] - specify namespace of the handler for the cases where call for bind may be repeated.\n     *                               If a handler with this ID exists, it's replaced by the new handler.\n     * @returns {Promise<void>}\n     */\n    this.bindGlobalShortcut = shortcutService.bindGlobalShortcut;\n\n    /**\n     * Trilium runs in a backend and frontend process, when something is changed on the backend from a script,\n     * frontend will get asynchronously synchronized.\n     *\n     * This method returns a promise which resolves once all the backend -> frontend synchronization is finished.\n     * Typical use case is when a new note has been created, we should wait until it is synced into frontend and only then activate it.\n     *\n     * @method\n     * @returns {Promise<void>}\n     */\n    this.waitUntilSynced = ws.waitForMaxKnownEntityChangeId;\n\n    /**\n     * This will refresh all currently opened notes which have included note specified in the parameter\n     *\n     * @param includedNoteId - noteId of the included note\n     * @returns {Promise<void>}\n     */\n    this.refreshIncludedNote = includedNoteId => appContext.triggerEvent('refreshIncludedNote', {noteId: includedNoteId});\n\n    /**\n     * Return randomly generated string of given length. This random string generation is NOT cryptographically secure.\n     *\n     * @method\n     * @param {int} length of the string\n     * @returns {string} random string\n     */\n    this.randomString = utils.randomString;\n\n    /**\n     * @method\n     * @param {int} size in bytes\n     * @return {string} formatted string\n     */\n    this.formatSize = utils.formatSize;\n\n    /**\n     * @method\n     * @param {int} size in bytes\n     * @return {string} formatted string\n     * @deprecated - use api.formatSize()\n     */\n    this.formatNoteSize = utils.formatSize;\n\n    this.logMessages = {};\n    this.logSpacedUpdates = {};\n\n    /**\n     * Log given message to the log pane in UI\n     *\n     * @param message\n     * @returns {void}\n     */\n    this.log = message => {\n        const {noteId} = this.startNote;\n\n        message = `${utils.now()}: ${message}`;\n\n        console.log(`Script ${noteId}: ${message}`);\n\n        this.logMessages[noteId] = this.logMessages[noteId] || [];\n        this.logSpacedUpdates[noteId] = this.logSpacedUpdates[noteId] || new SpacedUpdate(() => {\n            const messages = this.logMessages[noteId];\n            this.logMessages[noteId] = [];\n\n            appContext.triggerEvent(\"apiLogMessages\", {noteId, messages});\n        }, 100);\n\n        this.logMessages[noteId].push(message);\n        this.logSpacedUpdates[noteId].scheduleUpdate();\n    };\n}\n\nexport default FrontendScriptApi;\n","import FrontendScriptApi from './frontend_script_api.js';\nimport utils from './utils.js';\nimport froca from './froca.js';\n\nasync function ScriptContext(startNoteId, allNoteIds, originEntity = null, $container = null) {\n    const modules = {};\n\n    await froca.initializedPromise;\n\n    const startNote = await froca.getNote(startNoteId);\n    const allNotes = await froca.getNotes(allNoteIds);\n\n    return {\n        modules: modules,\n        notes: utils.toObject(allNotes, note => [note.noteId, note]),\n        apis: utils.toObject(allNotes, note => [note.noteId, new FrontendScriptApi(startNote, note, originEntity, $container)]),\n        require: moduleNoteIds => {\n            return moduleName => {\n                const candidates = allNotes.filter(note => moduleNoteIds.includes(note.noteId));\n                const note = candidates.find(c => c.title === moduleName);\n\n                if (!note) {\n                    throw new Error(`Could not find module note ${moduleName}`);\n                }\n\n                return modules[note.noteId].exports;\n            }\n        }\n    };\n}\n\nexport default ScriptContext;","import server from \"./server.js\";\nimport froca from \"./froca.js\";\n\nasync function searchForNoteIds(searchString) {\n    return await server.get(`search/${encodeURIComponent(searchString)}`);\n}\n\nasync function searchForNotes(searchString) {\n    const noteIds = await searchForNoteIds(searchString);\n\n    return await froca.getNotes(noteIds);\n}\n\nexport default {\n    searchForNoteIds,\n    searchForNotes\n}\n","export default class ValidationError {\n    constructor(resp) {\n        for (const key in resp) {\n            this[key] = resp[key];\n        }\n    }\n}","import utils from './utils.js';\nimport ValidationError from \"./validation_error.js\";\n\nasync function getHeaders(headers) {\n    const appContext = (await import('../components/app_context.js')).default;\n    const activeNoteContext = appContext.tabManager ? appContext.tabManager.getActiveContext() : null;\n\n    // headers need to be lowercase because node.js automatically converts them to lower case\n    // also avoiding using underscores instead of dashes since nginx filters them out by default\n    const allHeaders = {\n        'trilium-component-id': glob.componentId,\n        'trilium-local-now-datetime': utils.localNowDateTime(),\n        'trilium-hoisted-note-id': activeNoteContext ? activeNoteContext.hoistedNoteId : null,\n        'x-csrf-token': glob.csrfToken\n    };\n\n    for (const headerName in headers) {\n        if (headers[headerName]) {\n            allHeaders[headerName] = headers[headerName];\n        }\n    }\n\n    if (utils.isElectron()) {\n        // passing it explicitly here because of the electron HTTP bypass\n        allHeaders.cookie = document.cookie;\n    }\n\n    return allHeaders;\n}\n\nasync function getWithSilentNotFound(url, componentId) {\n    return await call('GET', url, componentId, { silentNotFound: true });\n}\n\nasync function get(url, componentId) {\n    return await call('GET', url, componentId);\n}\n\nasync function post(url, data, componentId) {\n    return await call('POST', url, componentId, { data });\n}\n\nasync function put(url, data, componentId) {\n    return await call('PUT', url, componentId, { data });\n}\n\nasync function patch(url, data, componentId) {\n    return await call('PATCH', url, componentId, { data });\n}\n\nasync function remove(url, componentId) {\n    return await call('DELETE', url, componentId);\n}\n\nasync function upload(url, fileToUpload) {\n    const formData = new FormData();\n    formData.append('upload', fileToUpload);\n\n    return await $.ajax({\n        url: window.glob.baseApiUrl + url,\n        headers: await getHeaders(),\n        data: formData,\n        type: 'PUT',\n        timeout: 60 * 60 * 1000,\n        contentType: false, // NEEDED, DON'T REMOVE THIS\n        processData: false, // NEEDED, DON'T REMOVE THIS\n    });\n}\n\nlet idCounter = 1;\nconst idToRequestMap = {};\n\nlet maxKnownEntityChangeId = 0;\n\nasync function call(method, url, componentId, options = {}) {\n    let resp;\n\n    const headers = await getHeaders({\n        'trilium-component-id': componentId\n    });\n    const {data} = options;\n\n    if (utils.isElectron()) {\n        const ipc = utils.dynamicRequire('electron').ipcRenderer;\n        const requestId = idCounter++;\n\n        resp = await new Promise((resolve, reject) => {\n            idToRequestMap[requestId] = {\n                resolve,\n                reject,\n                silentNotFound: !!options.silentNotFound\n            };\n\n            ipc.send('server-request', {\n                requestId: requestId,\n                headers: headers,\n                method: method,\n                url: `/${window.glob.baseApiUrl}${url}`,\n                data: data\n            });\n        });\n    }\n    else {\n        resp = await ajax(url, method, data, headers, !!options.silentNotFound);\n    }\n\n    const maxEntityChangeIdStr = resp.headers['trilium-max-entity-change-id'];\n\n    if (maxEntityChangeIdStr && maxEntityChangeIdStr.trim()) {\n        maxKnownEntityChangeId = Math.max(maxKnownEntityChangeId, parseInt(maxEntityChangeIdStr));\n    }\n\n    return resp.body;\n}\n\nfunction ajax(url, method, data, headers, silentNotFound) {\n    return new Promise((res, rej) => {\n        const options = {\n            url: window.glob.baseApiUrl + url,\n            type: method,\n            headers: headers,\n            timeout: 60000,\n            success: (body, textStatus, jqXhr) => {\n                const respHeaders = {};\n\n                jqXhr.getAllResponseHeaders().trim().split(/[\\r\\n]+/).forEach(line => {\n                    const parts = line.split(': ');\n                    const header = parts.shift();\n                    respHeaders[header] = parts.join(': ');\n                });\n\n                res({\n                    body,\n                    headers: respHeaders\n                });\n            },\n            error: async jqXhr => {\n                if (silentNotFound && jqXhr.status === 404) {\n                    // report nothing\n                } else {\n                    await reportError(method, url, jqXhr.status, jqXhr.responseText);\n                }\n\n                rej(jqXhr.responseText);\n            }\n        };\n\n        if (data) {\n            try {\n                options.data = JSON.stringify(data);\n            } catch (e) {\n                console.log(\"Can't stringify data: \", data, \" because of error: \", e)\n            }\n            options.contentType = \"application/json\";\n        }\n\n        $.ajax(options);\n    });\n}\n\nif (utils.isElectron()) {\n    const ipc = utils.dynamicRequire('electron').ipcRenderer;\n\n    ipc.on('server-response', async (event, arg) => {\n        if (arg.statusCode >= 200 && arg.statusCode < 300) {\n            handleSuccessfulResponse(arg);\n        }\n        else {\n            if (arg.statusCode === 404 && idToRequestMap[arg.requestId]?.silentNotFound) {\n                // report nothing\n            } else {\n                await reportError(arg.method, arg.url, arg.statusCode, arg.body);\n            }\n\n            idToRequestMap[arg.requestId].reject(new Error(`Server responded with ${arg.statusCode}`));\n        }\n\n        delete idToRequestMap[arg.requestId];\n    });\n\n    function handleSuccessfulResponse(arg) {\n        if (arg.headers['Content-Type'] === 'application/json') {\n            arg.body = JSON.parse(arg.body);\n        }\n\n        if (!(arg.requestId in idToRequestMap)) {\n            // this can happen when reload happens between firing up the request and receiving the response\n            throw new Error(`Unknown requestId '${arg.requestId}'`);\n        }\n\n        idToRequestMap[arg.requestId].resolve({\n            body: arg.body,\n            headers: arg.headers\n        });\n    }\n}\n\nasync function reportError(method, url, statusCode, response) {\n    let message = response;\n\n    if (typeof response === 'string') {\n        try {\n            response = JSON.parse(response);\n            message = response.message;\n        }\n        catch (e) {}\n    }\n\n    const toastService = (await import(\"./toast.js\")).default;\n\n    if ([400, 404].includes(statusCode) && response && typeof response === 'object') {\n        toastService.showError(message);\n        throw new ValidationError({\n            requestUrl: url,\n            method,\n            statusCode,\n            ...response\n        });\n    } else {\n        const title = `${statusCode} ${method} ${url}`;\n        toastService.showErrorTitleAndMessage(title, message);\n        toastService.throwError(`${title} - ${message}`);\n    }\n}\n\nexport default {\n    get,\n    getWithSilentNotFound,\n    post,\n    put,\n    patch,\n    remove,\n    upload,\n    // don't remove, used from CKEditor image upload!\n    getHeaders,\n    getMaxKnownEntityChangeId: () => maxKnownEntityChangeId\n};\n","import utils from \"./utils.js\";\n\nfunction removeGlobalShortcut(namespace) {\n    bindGlobalShortcut('', null, namespace);\n}\n\nfunction bindGlobalShortcut(keyboardShortcut, handler, namespace = null) {\n    bindElShortcut($(document), keyboardShortcut, handler, namespace);\n}\n\nfunction bindElShortcut($el, keyboardShortcut, handler, namespace = null) {\n    if (utils.isDesktop()) {\n        keyboardShortcut = normalizeShortcut(keyboardShortcut);\n\n        let eventName = 'keydown';\n\n        if (namespace) {\n            eventName += `.${namespace}`;\n\n            // if there's a namespace, then we replace the existing event handler with the new one\n            $el.off(eventName);\n        }\n\n        // method can be called to remove the shortcut (e.g. when keyboardShortcut label is deleted)\n        if (keyboardShortcut) {\n            $el.bind(eventName, keyboardShortcut, e => {\n                handler(e);\n\n                e.preventDefault();\n                e.stopPropagation();\n            });\n        }\n    }\n}\n\n/**\n * Normalize to the form expected by the jquery.hotkeys.js\n */\nfunction normalizeShortcut(shortcut) {\n    if (!shortcut) {\n        return shortcut;\n    }\n\n    return shortcut\n        .toLowerCase()\n        .replace(\"enter\", \"return\")\n        .replace(\"delete\", \"del\")\n        .replace(\"ctrl+alt\", \"alt+ctrl\")\n        .replace(\"meta+alt\", \"alt+meta\"); // alt needs to be first;\n}\n\nexport default {\n    bindGlobalShortcut,\n    bindElShortcut,\n    removeGlobalShortcut,\n    normalizeShortcut\n}\n","export default class SpacedUpdate {\n    constructor(updater, updateInterval = 1000) {\n        this.updater = updater;\n        this.lastUpdated = Date.now();\n        this.changed = false;\n        this.updateInterval = updateInterval;\n    }\n\n    scheduleUpdate() {\n        if (!this.changeForbidden) {\n            this.changed = true;\n            setTimeout(() => this.triggerUpdate());\n        }\n    }\n\n    async updateNowIfNecessary() {\n        if (this.changed) {\n            this.changed = false; // optimistic...\n\n            try {\n                await this.updater();\n            }\n            catch (e) {\n                this.changed = true;\n\n                throw e;\n            }\n        }\n    }\n\n    isAllSavedAndTriggerUpdate() {\n        const allSaved = !this.changed;\n\n        this.updateNowIfNecessary();\n\n        return allSaved;\n    }\n\n    triggerUpdate() {\n        if (!this.changed) {\n            return;\n        }\n\n        if (Date.now() - this.lastUpdated > this.updateInterval) {\n            this.updater();\n            this.lastUpdated = Date.now();\n            this.changed = false;\n        }\n        else {\n            // update isn't triggered but changes are still pending, so we need to schedule another check\n            this.scheduleUpdate();\n        }\n    }\n\n    async allowUpdateWithoutChange(callback) {\n        this.changeForbidden = true;\n\n        try {\n            await callback();\n        }\n        finally {\n            this.changeForbidden = false;\n        }\n    }\n}\n","import ws from \"./ws.js\";\nimport utils from \"./utils.js\";\n\nfunction toast(options) {\n    const $toast = $(`<div class=\"toast\" role=\"alert\" aria-live=\"assertive\" aria-atomic=\"true\">\n    <div class=\"toast-header\">\n        <strong class=\"mr-auto\"><span class=\"bx bx-${options.icon}\"></span> <span class=\"toast-title\"></span></strong>\n        <button type=\"button\" class=\"ml-2 mb-1 close\" data-dismiss=\"toast\" aria-label=\"Close\">\n            <span aria-hidden=\"true\">&times;</span>\n        </button>\n    </div>\n    <div class=\"toast-body\"></div>\n</div>`);\n\n    $toast.find('.toast-title').text(options.title);\n    $toast.find('.toast-body').text(options.message);\n\n    if (options.id) {\n        $toast.attr(\"id\", `toast-${options.id}`);\n    }\n\n    $(\"#toast-container\").append($toast);\n\n    $toast.toast({\n        delay: options.delay || 3000,\n        autohide: !!options.autohide\n    });\n\n    $toast.on('hidden.bs.toast', e => e.target.remove());\n\n    $toast.toast(\"show\");\n\n    return $toast;\n}\n\nfunction showPersistent(options) {\n    let $toast = $(`#toast-${options.id}`);\n\n    if ($toast.length > 0) {\n        $toast.find('.toast-body').html(options.message);\n    }\n    else {\n        options.autohide = false;\n\n        $toast = toast(options);\n    }\n\n    if (options.closeAfter) {\n        setTimeout(() => $toast.remove(), options.closeAfter);\n    }\n}\n\nfunction closePersistent(id) {\n    $(`#toast-${id}`).remove();\n}\n\nfunction showMessage(message, delay = 2000) {\n    console.debug(utils.now(), \"message:\", message);\n\n    toast({\n        title: \"信息\",\n        icon: \"check\",\n        message: message,\n        autohide: true,\n        delay\n    });\n}\n\nfunction showAndLogError(message, delay = 10000) {\n    showError(message, delay);\n\n    ws.logError(message);\n}\n\nfunction showError(message, delay = 10000) {\n    console.log(utils.now(), \"error: \", message);\n\n    toast({\n        title: \"错误\",\n        icon: 'alert',\n        message: message,\n        autohide: true,\n        delay\n    });\n}\n\nfunction showErrorTitleAndMessage(title, message, delay = 10000) {\n    console.log(utils.now(), \"error: \", message);\n\n    toast({\n        title: title,\n        icon: 'alert',\n        message: message,\n        autohide: true,\n        delay\n    });\n}\n\nfunction throwError(message) {\n    ws.logError(message);\n\n    throw new Error(message);\n}\n\nexport default {\n    showMessage,\n    showError,\n    showErrorTitleAndMessage,\n    showAndLogError,\n    throwError,\n    showPersistent,\n    closePersistent\n}\n","import ws from './ws.js';\nimport utils from './utils.js';\nimport froca from './froca.js';\nimport hoistedNoteService from '../services/hoisted_note.js';\nimport appContext from \"../components/app_context.js\";\n\n/**\n * @returns {string|null}\n */\nasync function resolveNotePath(notePath, hoistedNoteId = 'root') {\n    const runPath = await resolveNotePathToSegments(notePath, hoistedNoteId);\n\n    return runPath ? runPath.join(\"/\") : null;\n}\n\n/**\n * Accepts notePath which might or might not be valid and returns an existing path as close to the original\n * notePath as possible. Part of the path might not be valid because of note moving (which causes\n * path change) or other corruption, in that case, this will try to get some other valid path to the correct note.\n *\n * @returns {Promise<string[]>}\n */\nasync function resolveNotePathToSegments(notePath, hoistedNoteId = 'root', logErrors = true) {\n    utils.assertArguments(notePath);\n\n    // we might get notePath with the params suffix, remove it if present\n    notePath = notePath.split(\"?\")[0].trim();\n\n    if (notePath.length === 0) {\n        return null;\n    }\n\n    const path = notePath.split(\"/\").reverse();\n\n    if (!path.includes(\"root\")) {\n        path.push('root');\n    }\n\n    const effectivePathSegments = [];\n    let childNoteId = null;\n    let i = 0;\n\n    while (true) {\n        if (i >= path.length) {\n            break;\n        }\n\n        const parentNoteId = path[i++];\n\n        if (childNoteId !== null) {\n            const child = await froca.getNote(childNoteId, !logErrors);\n\n            if (!child) {\n                if (logErrors) {\n                    ws.logError(`Can't find note ${childNoteId}`);\n                }\n\n                return null;\n            }\n\n            child.sortParents();\n\n            const parents = child.getParentNotes();\n\n            if (!parents.length) {\n                if (logErrors) {\n                    ws.logError(`No parents found for note ${childNoteId} (${child.title}) for path ${notePath}`);\n                }\n\n                return null;\n            }\n\n            if (!parents.some(p => p.noteId === parentNoteId)) {\n                if (logErrors) {\n                    const parent = froca.getNoteFromCache(parentNoteId);\n\n                    console.debug(utils.now(), `Did not find parent ${parentNoteId} (${parent ? parent.title : 'n/a'}) \n                        for child ${childNoteId} (${child.title}), available parents: ${parents.map(p => `${p.noteId} (${p.title})`)}. \n                        You can ignore this message as it is mostly harmless.`);\n                }\n\n                const bestNotePath = child.getBestNotePath(hoistedNoteId);\n\n                if (bestNotePath) {\n                    const pathToRoot = bestNotePath.reverse().slice(1);\n\n                    for (const noteId of pathToRoot) {\n                        effectivePathSegments.push(noteId);\n                    }\n                }\n\n                break;\n            }\n        }\n\n        effectivePathSegments.push(parentNoteId);\n        childNoteId = parentNoteId;\n    }\n\n    effectivePathSegments.reverse();\n\n    if (effectivePathSegments.includes(hoistedNoteId)) {\n        return effectivePathSegments;\n    }\n    else {\n        const note = await froca.getNote(getNoteIdFromUrl(notePath));\n\n        const bestNotePath = note.getBestNotePath(hoistedNoteId);\n\n        if (!bestNotePath) {\n            throw new Error(`Did not find any path segments for '${note.toString()}', hoisted note '${hoistedNoteId}'`);\n        }\n\n        // if there isn't actually any note path with hoisted note, then return the original resolved note path\n        return bestNotePath.includes(hoistedNoteId) ? bestNotePath : effectivePathSegments;\n    }\n}\n\nws.subscribeToMessages(message => {\n   if (message.type === 'openNote') {\n       appContext.tabManager.activateOrOpenNote(message.noteId);\n\n       if (utils.isElectron()) {\n           const currentWindow = utils.dynamicRequire('@electron/remote').getCurrentWindow();\n\n           currentWindow.show();\n       }\n   }\n});\n\nfunction getParentProtectedStatus(node) {\n    return hoistedNoteService.isHoistedNode(node) ? false : node.getParent().data.isProtected;\n}\n\nfunction getNoteIdFromUrl(urlOrNotePath) {\n    if (!urlOrNotePath) {\n        return null;\n    }\n\n    const [notePath] = urlOrNotePath.split(\"?\");\n    const segments = notePath.split(\"/\");\n\n    return segments[segments.length - 1];\n}\n\nasync function getBranchIdFromUrl(urlOrNotePath) {\n    const {noteId, parentNoteId} = getNoteIdAndParentIdFromUrl(urlOrNotePath);\n\n    return await froca.getBranchId(parentNoteId, noteId);\n}\n\nfunction getNoteIdAndParentIdFromUrl(urlOrNotePath) {\n    if (!urlOrNotePath) {\n        return {};\n    }\n\n    const [notePath] = urlOrNotePath.split(\"?\");\n\n    if (notePath === 'root') {\n        return {\n            noteId: 'root',\n            parentNoteId: 'none'\n        };\n    }\n\n    let parentNoteId = 'root';\n    let noteId = '';\n\n    if (notePath) {\n        const segments = notePath.split(\"/\");\n\n        noteId = segments[segments.length - 1];\n\n        if (segments.length > 1) {\n            parentNoteId = segments[segments.length - 2];\n        }\n    }\n\n    return {\n        parentNoteId,\n        noteId\n    };\n}\n\nfunction getNotePath(node) {\n    if (!node) {\n        logError(\"节点为空\");\n        return \"\";\n    }\n\n    const path = [];\n\n    while (node) {\n        if (node.data.noteId) {\n            path.push(node.data.noteId);\n        }\n\n        node = node.getParent();\n    }\n\n    return path.reverse().join(\"/\");\n}\n\nasync function getNoteTitle(noteId, parentNoteId = null) {\n    utils.assertArguments(noteId);\n\n    const note = await froca.getNote(noteId);\n    if (!note) {\n        return \"[not found]\";\n    }\n\n    let {title} = note;\n\n    if (parentNoteId !== null) {\n        const branchId = note.parentToBranch[parentNoteId];\n\n        if (branchId) {\n            const branch = froca.getBranch(branchId);\n\n            if (branch?.prefix) {\n                title = `${branch.prefix} - ${title}`;\n            }\n        }\n    }\n\n    return title;\n}\n\nasync function getNotePathTitleComponents(notePath) {\n    const titleComponents = [];\n\n    if (notePath.startsWith('root/')) {\n        notePath = notePath.substr(5);\n    }\n\n    // special case when we want just root's title\n    if (notePath === 'root') {\n        titleComponents.push(await getNoteTitle(notePath));\n    } else {\n        let parentNoteId = 'root';\n\n        for (const noteId of notePath.split('/')) {\n            titleComponents.push(await getNoteTitle(noteId, parentNoteId));\n\n            parentNoteId = noteId;\n        }\n    }\n\n    return titleComponents;\n}\n\nasync function getNotePathTitle(notePath) {\n    utils.assertArguments(notePath);\n\n    const titlePath = await getNotePathTitleComponents(notePath);\n\n    return titlePath.join(' / ');\n}\n\nasync function getNoteTitleWithPathAsSuffix(notePath) {\n    utils.assertArguments(notePath);\n\n    const titleComponents = await getNotePathTitleComponents(notePath);\n\n    if (!titleComponents || titleComponents.length === 0) {\n        return \"\";\n    }\n\n    const title = titleComponents[titleComponents.length - 1];\n    const path = titleComponents.slice(0, titleComponents.length - 1);\n\n    const $titleWithPath = $('<span class=\"note-title-with-path\">')\n        .append($('<span class=\"note-title\">').text(title));\n\n    if (path.length > 0) {\n        $titleWithPath\n            .append($('<span class=\"note-path\">').text(` (${path.join(' / ')})`));\n    }\n\n    return $titleWithPath;\n}\n\nfunction isNotePathInHiddenSubtree(notePath) {\n    return notePath?.includes(\"root/_hidden\");\n}\n\nexport default {\n    resolveNotePath,\n    resolveNotePathToSegments,\n    getParentProtectedStatus,\n    getNotePath,\n    getNoteIdFromUrl,\n    getNoteIdAndParentIdFromUrl,\n    getBranchIdFromUrl,\n    getNoteTitle,\n    getNotePathTitle,\n    getNoteTitleWithPathAsSuffix,\n    isNotePathInHiddenSubtree\n};\n","function reloadFrontendApp(reason) {\n    if (reason) {\n        logInfo(`Frontend app reload: ${reason}`);\n    }\n\n    window.location.reload();\n}\n\nfunction parseDate(str) {\n    try {\n        return new Date(Date.parse(str));\n    }\n    catch (e) {\n        throw new Error(`Can't parse date from '${str}': ${e.message} ${e.stack}`);\n    }\n}\n\nfunction padNum(num) {\n    return `${num <= 9 ? \"0\" : \"\"}${num}`;\n}\n\nfunction formatTime(date) {\n    return `${padNum(date.getHours())}:${padNum(date.getMinutes())}`;\n}\n\nfunction formatTimeWithSeconds(date) {\n    return `${padNum(date.getHours())}:${padNum(date.getMinutes())}:${padNum(date.getSeconds())}`;\n}\n\nfunction formatTimeInterval(ms) {\n    const seconds = Math.round(ms / 1000);\n    const minutes = Math.floor(seconds / 60);\n    const hours = Math.floor(minutes / 60);\n    const days = Math.floor(hours / 24);\n    const plural = (count, name) => `${count} ${name}`;\n    const segments = [];\n\n    if (days > 0) {\n        segments.push(plural(days, '天'));\n    }\n\n    if (days < 2) {\n        if (hours % 24 > 0) {\n            segments.push(plural(hours % 24, '小时'));\n        }\n\n        if (hours < 4) {\n            if (minutes % 60 > 0) {\n                segments.push(plural(minutes % 60, '分钟'));\n            }\n\n            if (minutes < 5) {\n                if (seconds % 60 > 0) {\n                    segments.push(plural(seconds % 60, '秒'));\n                }\n            }\n        }\n    }\n\n    return segments.join(\", \");\n}\n\n// this is producing local time!\nfunction formatDate(date) {\n    //    return padNum(date.getDate()) + \". \" + padNum(date.getMonth() + 1) + \". \" + date.getFullYear();\n    // instead of european format we'll just use ISO as that's pretty unambiguous\n\n    return formatDateISO(date);\n}\n\n// this is producing local time!\nfunction formatDateISO(date) {\n    return `${date.getFullYear()}-${padNum(date.getMonth() + 1)}-${padNum(date.getDate())}`;\n}\n\nfunction formatDateTime(date) {\n    return `${formatDate(date)} ${formatTime(date)}`;\n}\n\nfunction localNowDateTime() {\n    return dayjs().format('YYYY-MM-DD HH:mm:ss.SSSZZ');\n}\n\nfunction now() {\n    return formatTimeWithSeconds(new Date());\n}\n\nfunction isElectron() {\n    return !!(window && window.process && window.process.type);\n}\n\nfunction isMac() {\n    return navigator.platform.indexOf('Mac') > -1;\n}\n\nfunction isCtrlKey(evt) {\n    return (!isMac() && evt.ctrlKey)\n        || (isMac() && evt.metaKey);\n}\n\nfunction assertArguments() {\n    for (const i in arguments) {\n        if (!arguments[i]) {\n            console.trace(`Argument idx#${i} should not be falsy: ${arguments[i]}`);\n        }\n    }\n}\n\nconst entityMap = {\n    '&': '&amp;',\n    '<': '&lt;',\n    '>': '&gt;',\n    '\"': '&quot;',\n    \"'\": '&#39;',\n    '/': '&#x2F;',\n    '`': '&#x60;',\n    '=': '&#x3D;'\n};\n\nfunction escapeHtml(str) {\n    return str.replace(/[&<>\"'`=\\/]/g, s => entityMap[s]);\n}\n\nfunction formatSize(size) {\n    size = Math.max(Math.round(size / 1024), 1);\n\n    if (size < 1024) {\n        return `${size} KiB`;\n    }\n    else {\n        return `${Math.round(size / 102.4) / 10} MiB`;\n    }\n}\n\nfunction toObject(array, fn) {\n    const obj = {};\n\n    for (const item of array) {\n        const [key, value] = fn(item);\n\n        obj[key] = value;\n    }\n\n    return obj;\n}\n\nfunction randomString(len) {\n    let text = \"\";\n    const possible = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n\n    for (let i = 0; i < len; i++) {\n        text += possible.charAt(Math.floor(Math.random() * possible.length));\n    }\n\n    return text;\n}\n\nfunction isMobile() {\n    return window.glob?.device === \"mobile\"\n        // window.glob.device is not available in setup\n        || (!window.glob?.device && /Mobi/.test(navigator.userAgent));\n}\n\nfunction isDesktop() {\n    return window.glob?.device === \"desktop\"\n        // window.glob.device is not available in setup\n        || (!window.glob?.device && !/Mobi/.test(navigator.userAgent));\n}\n\n// the cookie code below works for simple use cases only - ASCII only\n// not setting a path so that cookies do not leak into other websites if multiplexed with reverse proxy\n\nfunction setCookie(name, value) {\n    const date = new Date(Date.now() + 10 * 365 * 24 * 60 * 60 * 1000);\n    const expires = `; expires=${date.toUTCString()}`;\n\n    document.cookie = `${name}=${value || \"\"}${expires};`;\n}\n\nfunction getNoteTypeClass(type) {\n    return `type-${type}`;\n}\n\nfunction getMimeTypeClass(mime) {\n    if (!mime) {\n        return \"\";\n    }\n\n    const semicolonIdx = mime.indexOf(';');\n\n    if (semicolonIdx !== -1) {\n        // stripping everything following the semicolon\n        mime = mime.substr(0, semicolonIdx);\n    }\n\n    return `mime-${mime.toLowerCase().replace(/[\\W_]+/g, \"-\")}`;\n}\n\nfunction closeActiveDialog() {\n    if (glob.activeDialog) {\n        glob.activeDialog.modal('hide');\n        glob.activeDialog = null;\n    }\n}\n\nlet $lastFocusedElement = null;\n\n// perhaps there should be saved focused element per tab?\nfunction saveFocusedElement() {\n    $lastFocusedElement = $(\":focus\");\n}\n\nfunction focusSavedElement() {\n    if (!$lastFocusedElement) {\n        return;\n    }\n\n    if ($lastFocusedElement.hasClass(\"ck\")) {\n        // must handle CKEditor separately because of this bug: https://github.com/ckeditor/ckeditor5/issues/607\n        // the bug manifests itself in resetting the cursor position to the first character - jumping above\n\n        const editor = $lastFocusedElement\n            .closest('.ck-editor__editable')\n            .prop('ckeditorInstance');\n\n        if (editor) {\n            editor.editing.view.focus();\n        } else {\n            console.log(\"Could not find CKEditor instance to focus last element\");\n        }\n    } else {\n        $lastFocusedElement.focus();\n    }\n\n    $lastFocusedElement = null;\n}\n\nasync function openDialog($dialog, closeActDialog = true) {\n    if (closeActDialog) {\n        closeActiveDialog();\n        glob.activeDialog = $dialog;\n    }\n\n    saveFocusedElement();\n\n    $dialog.modal();\n\n    $dialog.on('hidden.bs.modal', () => {\n        $(\".aa-input\").autocomplete(\"close\");\n\n        if (!glob.activeDialog || glob.activeDialog === $dialog) {\n            focusSavedElement();\n        }\n    });\n\n    const keyboardActionsService = (await import(\"./keyboard_actions.js\")).default;\n    keyboardActionsService.updateDisplayedShortcuts($dialog);\n}\n\nfunction isHtmlEmpty(html) {\n    if (!html) {\n        return true;\n    } else if (typeof html !== 'string') {\n        logError(`Got object of type '${typeof html}' where string was expected.`);\n        return false;\n    }\n\n    html = html.toLowerCase();\n\n    return !html.includes('<img')\n        && !html.includes('<section')\n        // the line below will actually attempt to load images so better to check for images first\n        && $(\"<div>\").html(html).text().trim().length === 0;\n}\n\nasync function clearBrowserCache() {\n    if (isElectron()) {\n        const win = dynamicRequire('@electron/remote').getCurrentWindow();\n        await win.webContents.session.clearCache();\n    }\n}\n\nfunction copySelectionToClipboard() {\n    const text = window.getSelection().toString();\n    if (navigator.clipboard) {\n        navigator.clipboard.writeText(text);\n    }\n}\n\nfunction dynamicRequire(moduleName) {\n    if (typeof __non_webpack_require__ !== 'undefined') {\n        return __non_webpack_require__(moduleName);\n    }\n    else {\n        return require(moduleName);\n    }\n}\n\nfunction timeLimit(promise, limitMs, errorMessage) {\n    if (!promise || !promise.then) { // it's not actually a promise\n        return promise;\n    }\n\n    // better stack trace if created outside of promise\n    const error = new Error(errorMessage || `Process exceeded time limit ${limitMs}`);\n\n    return new Promise((res, rej) => {\n        let resolved = false;\n\n        promise.then(result => {\n            resolved = true;\n\n            res(result);\n        });\n\n        setTimeout(() => {\n            if (!resolved) {\n                rej(error);\n            }\n        }, limitMs);\n    });\n}\n\nfunction initHelpDropdown($el) {\n    // stop inside clicks from closing the menu\n    const $dropdownMenu = $el.find('.help-dropdown .dropdown-menu');\n    $dropdownMenu.on('click', e => e.stopPropagation());\n\n    // previous propagation stop will also block help buttons from being opened, so we need to re-init for this element\n    initHelpButtons($dropdownMenu);\n}\n\nconst wikiBaseUrl = \"https://github.com/zadam/trilium/wiki/\";\n\nfunction openHelp($button) {\n    const helpPage = $button.attr(\"data-help-page\");\n\n    if (helpPage) {\n        const url = wikiBaseUrl + helpPage;\n\n        window.open(url, '_blank');\n    }\n}\n\nfunction initHelpButtons($el) {\n    // for some reason, the .on(event, listener, handler) does not work here (e.g. Options -> Sync -> Help button)\n    // so we do it manually\n    $el.on(\"click\", e => {\n        const $helpButton = $(e.target).closest(\"[data-help-page]\");\n        openHelp($helpButton);\n    });\n}\n\nfunction filterAttributeName(name) {\n    return name.replace(/[^\\p{L}\\p{N}_:]/ug, \"\");\n}\n\nconst ATTR_NAME_MATCHER = new RegExp(\"^[\\\\p{L}\\\\p{N}_:]+$\", \"u\");\n\nfunction isValidAttributeName(name) {\n    return ATTR_NAME_MATCHER.test(name);\n}\n\nfunction sleep(time_ms) {\n    return new Promise((resolve) => {\n        setTimeout(resolve, time_ms);\n    });\n}\n\nfunction escapeRegExp(str) {\n    return str.replace(/([.*+?^=!:${}()|\\[\\]\\/\\\\])/g, \"\\\\$1\");\n}\n\nfunction areObjectsEqual () {\n    let i, l, leftChain, rightChain;\n\n    function compare2Objects (x, y) {\n        let p;\n\n        // remember that NaN === NaN returns false\n        // and isNaN(undefined) returns true\n        if (isNaN(x) && isNaN(y) && typeof x === 'number' && typeof y === 'number') {\n            return true;\n        }\n\n        // Compare primitives and functions.\n        // Check if both arguments link to the same object.\n        // Especially useful on the step where we compare prototypes\n        if (x === y) {\n            return true;\n        }\n\n        // Works in case when functions are created in constructor.\n        // Comparing dates is a common scenario. Another built-ins?\n        // We can even handle functions passed across iframes\n        if ((typeof x === 'function' && typeof y === 'function') ||\n            (x instanceof Date && y instanceof Date) ||\n            (x instanceof RegExp && y instanceof RegExp) ||\n            (x instanceof String && y instanceof String) ||\n            (x instanceof Number && y instanceof Number)) {\n            return x.toString() === y.toString();\n        }\n\n        // At last, checking prototypes as good as we can\n        if (!(x instanceof Object && y instanceof Object)) {\n            return false;\n        }\n\n        if (x.isPrototypeOf(y) || y.isPrototypeOf(x)) {\n            return false;\n        }\n\n        if (x.constructor !== y.constructor) {\n            return false;\n        }\n\n        if (x.prototype !== y.prototype) {\n            return false;\n        }\n\n        // Check for infinitive linking loops\n        if (leftChain.indexOf(x) > -1 || rightChain.indexOf(y) > -1) {\n            return false;\n        }\n\n        // Quick checking of one object being a subset of another.\n        // todo: cache the structure of arguments[0] for performance\n        for (p in y) {\n            if (y.hasOwnProperty(p) !== x.hasOwnProperty(p)) {\n                return false;\n            }\n            else if (typeof y[p] !== typeof x[p]) {\n                return false;\n            }\n        }\n\n        for (p in x) {\n            if (y.hasOwnProperty(p) !== x.hasOwnProperty(p)) {\n                return false;\n            }\n            else if (typeof y[p] !== typeof x[p]) {\n                return false;\n            }\n\n            switch (typeof (x[p])) {\n                case 'object':\n                case 'function':\n\n                    leftChain.push(x);\n                    rightChain.push(y);\n\n                    if (!compare2Objects (x[p], y[p])) {\n                        return false;\n                    }\n\n                    leftChain.pop();\n                    rightChain.pop();\n                    break;\n\n                default:\n                    if (x[p] !== y[p]) {\n                        return false;\n                    }\n                    break;\n            }\n        }\n\n        return true;\n    }\n\n    if (arguments.length < 1) {\n        return true; //Die silently? Don't know how to handle such case, please help...\n        // throw \"Need two or more arguments to compare\";\n    }\n\n    for (i = 1, l = arguments.length; i < l; i++) {\n\n        leftChain = []; //Todo: this can be cached\n        rightChain = [];\n\n        if (!compare2Objects(arguments[0], arguments[i])) {\n            return false;\n        }\n    }\n\n    return true;\n}\n\nfunction copyHtmlToClipboard(content) {\n    const clipboardItem = new ClipboardItem({\n        'text/html': new Blob([content], {type: 'text/html'}),\n        'text/plain': new Blob([content], {type: 'text/plain'})\n    });\n\n    navigator.clipboard.write([clipboardItem]);\n}\n\n/**\n * @param {FNote} note\n * @return {string}\n */\nfunction createImageSrcUrl(note) {\n    return `api/images/${note.noteId}/${encodeURIComponent(note.title)}?timestamp=${Date.now()}`;\n}\n\nexport default {\n    reloadFrontendApp,\n    parseDate,\n    formatDateISO,\n    formatDateTime,\n    formatTimeInterval,\n    formatSize,\n    localNowDateTime,\n    now,\n    isElectron,\n    isMac,\n    isCtrlKey,\n    assertArguments,\n    escapeHtml,\n    toObject,\n    randomString,\n    isMobile,\n    isDesktop,\n    setCookie,\n    getNoteTypeClass,\n    getMimeTypeClass,\n    closeActiveDialog,\n    openDialog,\n    saveFocusedElement,\n    focusSavedElement,\n    isHtmlEmpty,\n    clearBrowserCache,\n    copySelectionToClipboard,\n    dynamicRequire,\n    timeLimit,\n    initHelpDropdown,\n    initHelpButtons,\n    openHelp,\n    filterAttributeName,\n    isValidAttributeName,\n    sleep,\n    escapeRegExp,\n    areObjectsEqual,\n    copyHtmlToClipboard,\n    createImageSrcUrl\n};\n","export default class LoadResults {\n    constructor(entityChanges) {\n        this.entities = {};\n\n        for (const {entityId, entityName, entity} of entityChanges) {\n            if (entity) {\n                this.entities[entityName] = this.entities[entityName] || [];\n                this.entities[entityName][entityId] = entity;\n            }\n        }\n\n        this.noteIdToComponentId = {};\n        this.componentIdToNoteIds = {};\n\n        this.branchRows = [];\n\n        this.attributeRows = [];\n\n        this.noteReorderings = [];\n\n        this.revisionRows = [];\n\n        this.contentNoteIdToComponentId = [];\n\n        this.optionNames = [];\n\n        this.attachmentRows = [];\n    }\n\n    getEntityRow(entityName, entityId) {\n        return this.entities[entityName]?.[entityId];\n    }\n\n    addNote(noteId, componentId) {\n        this.noteIdToComponentId[noteId] = this.noteIdToComponentId[noteId] || [];\n\n        if (!this.noteIdToComponentId[noteId].includes(componentId)) {\n            this.noteIdToComponentId[noteId].push(componentId);\n        }\n\n        this.componentIdToNoteIds[componentId] = this.componentIdToNoteIds[componentId] || [];\n\n        if (!this.componentIdToNoteIds[componentId]) {\n            this.componentIdToNoteIds[componentId].push(noteId);\n        }\n    }\n\n    addBranch(branchId, componentId) {\n        this.branchRows.push({branchId, componentId});\n    }\n\n    getBranchRows() {\n        return this.branchRows\n            .map(row => this.getEntityRow(\"branches\", row.branchId))\n            .filter(branch => !!branch);\n    }\n\n    addNoteReordering(parentNoteId, componentId) {\n        this.noteReorderings.push(parentNoteId);\n    }\n\n    getNoteReorderings() {\n        return this.noteReorderings;\n    }\n\n    addAttribute(attributeId, componentId) {\n        this.attributeRows.push({attributeId, componentId});\n    }\n\n    getAttributeRows(componentId = 'none') {\n        return this.attributeRows\n            .filter(row => row.componentId !== componentId)\n            .map(row => this.getEntityRow(\"attributes\", row.attributeId))\n            .filter(attr => !!attr);\n    }\n\n    addRevision(revisionId, noteId, componentId) {\n        this.revisionRows.push({revisionId, noteId, componentId});\n    }\n\n    hasRevisionForNote(noteId) {\n        return !!this.revisionRows.find(row => row.noteId === noteId);\n    }\n\n    getNoteIds() {\n        return Object.keys(this.noteIdToComponentId);\n    }\n\n    isNoteReloaded(noteId, componentId = null) {\n        if (!noteId) {\n            return false;\n        }\n\n        const componentIds = this.noteIdToComponentId[noteId];\n        return componentIds && componentIds.find(sId => sId !== componentId) !== undefined;\n    }\n\n    addNoteContent(noteId, componentId) {\n        this.contentNoteIdToComponentId.push({noteId, componentId});\n    }\n\n    isNoteContentReloaded(noteId, componentId) {\n        if (!noteId) {\n            return false;\n        }\n\n        return this.contentNoteIdToComponentId.find(l => l.noteId === noteId && l.componentId !== componentId);\n    }\n\n    addOption(name) {\n        this.optionNames.push(name);\n    }\n\n    isOptionReloaded(name) {\n        return this.optionNames.includes(name);\n    }\n\n    getOptionNames() {\n        return this.optionNames;\n    }\n\n    addAttachmentRow(attachment) {\n        this.attachmentRows.push(attachment);\n    }\n\n    getAttachmentRows() {\n        return this.attachmentRows;\n    }\n\n    /**\n     * @returns {boolean} true if there are changes which could affect the attributes (including inherited ones)\n     *          notably changes in note itself should not have any effect on attributes\n     */\n    hasAttributeRelatedChanges() {\n        return this.branchRows.length > 0\n            || this.attributeRows.length > 0;\n    }\n\n    isEmpty() {\n        return Object.keys(this.noteIdToComponentId).length === 0\n            && this.branchRows.length === 0\n            && this.attributeRows.length === 0\n            && this.noteReorderings.length === 0\n            && this.revisionRows.length === 0\n            && this.contentNoteIdToComponentId.length === 0\n            && this.optionNames.length === 0\n            && this.attachmentRows.length === 0;\n    }\n\n    isEmptyForTree() {\n        return Object.keys(this.noteIdToComponentId).length === 0\n            && this.branchRows.length === 0\n            && this.attributeRows.length === 0\n            && this.noteReorderings.length === 0;\n    }\n}\n","import LoadResults from \"./load_results.js\";\nimport froca from \"./froca.js\";\nimport utils from \"./utils.js\";\nimport options from \"./options.js\";\nimport noteAttributeCache from \"./note_attribute_cache.js\";\nimport FBranch from \"../entities/fbranch.js\";\nimport FAttribute from \"../entities/fattribute.js\";\nimport FAttachment from \"../entities/fattachment.js\";\n\nasync function processEntityChanges(entityChanges) {\n    const loadResults = new LoadResults(entityChanges);\n\n    for (const ec of entityChanges) {\n        try {\n            if (ec.entityName === 'notes') {\n                processNoteChange(loadResults, ec);\n            } else if (ec.entityName === 'branches') {\n                await processBranchChange(loadResults, ec);\n            } else if (ec.entityName === 'attributes') {\n                processAttributeChange(loadResults, ec);\n            } else if (ec.entityName === 'note_reordering') {\n                processNoteReordering(loadResults, ec);\n            } else if (ec.entityName === 'revisions') {\n                loadResults.addRevision(ec.entityId, ec.noteId, ec.componentId);\n            } else if (ec.entityName === 'options') {\n                if (ec.entity.name === 'openNoteContexts') {\n                    continue; // only noise\n                }\n\n                options.set(ec.entity.name, ec.entity.value);\n\n                loadResults.addOption(ec.entity.name);\n            } else if (ec.entityName === 'attachments') {\n                processAttachment(loadResults, ec);\n            } else if (ec.entityName === 'blobs' || ec.entityName === 'etapi_tokens') {\n                // NOOP\n            }\n            else {\n                throw new Error(`Unknown entityName '${ec.entityName}'`);\n            }\n        }\n        catch (e) {\n            throw new Error(`Can't process entity ${JSON.stringify(ec)} with error ${e.message} ${e.stack}`);\n        }\n    }\n\n    // froca is supposed to contain all notes currently being visible to the users in the tree / otherwise being processed\n    // and their complete \"ancestor relationship\", so it's always possible to go up in the hierarchy towards the root.\n    // To this we count: standard parent-child relationships and template/inherit relations (attribute inheritance follows them).\n    // Here we watch for changes which might violate this principle - e.g., an introduction of a new \"inherit\" relation might\n    // mean we need to load the target of the relation (and then perhaps transitively the whole note path of this target).\n    const missingNoteIds = [];\n\n    for (const {entityName, entity} of entityChanges) {\n        if (!entity) { // if erased\n            continue;\n        }\n\n        if (entityName === 'branches' && !(entity.parentNoteId in froca.notes)) {\n            missingNoteIds.push(entity.parentNoteId);\n        }\n        else if (entityName === 'attributes'\n            && entity.type === 'relation'\n            && (entity.name === 'template' || entity.name === 'inherit')\n            && !(entity.value in froca.notes)) {\n\n            missingNoteIds.push(entity.value);\n        }\n    }\n\n    if (missingNoteIds.length > 0) {\n        await froca.reloadNotes(missingNoteIds);\n    }\n\n    if (!loadResults.isEmpty()) {\n        if (loadResults.hasAttributeRelatedChanges()) {\n            noteAttributeCache.invalidate();\n        }\n\n        const appContext = (await import(\"../components/app_context.js\")).default;\n        await appContext.triggerEvent('entitiesReloaded', {loadResults});\n    }\n}\n\nfunction processNoteChange(loadResults, ec) {\n    const note = froca.notes[ec.entityId];\n\n    if (!note) {\n        // if this note has not been requested before then it's not part of froca's cached subset, and\n        // we're not interested in it\n        return;\n    }\n\n    loadResults.addNote(ec.entityId, ec.componentId);\n\n    if (ec.isErased && ec.entityId in froca.notes) {\n        utils.reloadFrontendApp(`${ec.entityName} '${ec.entityId}' is erased, need to do complete reload.`);\n        return;\n    }\n\n    if (ec.isErased || ec.entity?.isDeleted) {\n        delete froca.notes[ec.entityId];\n    }\n    else {\n        if (note.blobId !== ec.entity.blobId) {\n            for (const key of Object.keys(froca.blobPromises)) {\n                if (key.includes(note.noteId)) {\n                    delete froca.blobPromises[key];\n                }\n            }\n\n            loadResults.addNoteContent(note.noteId, ec.componentId);\n        }\n\n        note.update(ec.entity);\n    }\n}\n\nasync function processBranchChange(loadResults, ec) {\n    if (ec.isErased && ec.entityId in froca.branches) {\n        utils.reloadFrontendApp(`${ec.entityName} '${ec.entityId}' is erased, need to do complete reload.`);\n        return;\n    }\n\n    let branch = froca.branches[ec.entityId];\n\n    if (ec.isErased || ec.entity?.isDeleted) {\n        if (branch) {\n            const childNote = froca.notes[branch.noteId];\n            const parentNote = froca.notes[branch.parentNoteId];\n\n            if (childNote) {\n                childNote.parents = childNote.parents.filter(parentNoteId => parentNoteId !== branch.parentNoteId);\n                delete childNote.parentToBranch[branch.parentNoteId];\n            }\n\n            if (parentNote) {\n                parentNote.children = parentNote.children.filter(childNoteId => childNoteId !== branch.noteId);\n                delete parentNote.childToBranch[branch.noteId];\n            }\n\n            loadResults.addBranch(ec.entityId, ec.componentId);\n\n            delete froca.branches[ec.entityId];\n        }\n\n        return;\n    }\n\n    loadResults.addBranch(ec.entityId, ec.componentId);\n\n    const childNote = froca.notes[ec.entity.noteId];\n    let parentNote = froca.notes[ec.entity.parentNoteId];\n\n    if (childNote && !childNote.isRoot() && !parentNote) {\n        // a branch cannot exist without the parent\n        // a note loaded into froca has to also contain all its ancestors,\n        // this problem happened, e.g., in sharing where _share was hidden and thus not loaded\n        // sharing meant cloning into _share, which crashed because _share was not loaded\n        parentNote = await froca.getNote(ec.entity.parentNoteId);\n    }\n\n    if (branch) {\n        branch.update(ec.entity);\n    }\n    else if (childNote || parentNote) {\n        froca.branches[ec.entityId] = branch = new FBranch(froca, ec.entity);\n    }\n\n    if (childNote) {\n        childNote.addParent(branch.parentNoteId, branch.branchId);\n    }\n\n    if (parentNote) {\n        parentNote.addChild(branch.noteId, branch.branchId);\n    }\n}\n\nfunction processNoteReordering(loadResults, ec) {\n    const parentNoteIdsToSort = new Set();\n\n    for (const branchId in ec.positions) {\n        const branch = froca.branches[branchId];\n\n        if (branch) {\n            branch.notePosition = ec.positions[branchId];\n\n            parentNoteIdsToSort.add(branch.parentNoteId);\n        }\n    }\n\n    for (const parentNoteId of parentNoteIdsToSort) {\n        const parentNote = froca.notes[parentNoteId];\n\n        if (parentNote) {\n            parentNote.sortChildren();\n        }\n    }\n\n    loadResults.addNoteReordering(ec.entityId, ec.componentId);\n}\n\nfunction processAttributeChange(loadResults, ec) {\n    let attribute = froca.attributes[ec.entityId];\n\n    if (ec.isErased && ec.entityId in froca.attributes) {\n        utils.reloadFrontendApp(`${ec.entityName} '${ec.entityId}' is erased, need to do complete reload.`);\n        return;\n    }\n\n    if (ec.isErased || ec.entity?.isDeleted) {\n        if (attribute) {\n            const sourceNote = froca.notes[attribute.noteId];\n            const targetNote = attribute.type === 'relation' && froca.notes[attribute.value];\n\n            if (sourceNote) {\n                sourceNote.attributes = sourceNote.attributes.filter(attributeId => attributeId !== attribute.attributeId);\n            }\n\n            if (targetNote) {\n                targetNote.targetRelations = targetNote.targetRelations.filter(attributeId => attributeId !== attribute.attributeId);\n            }\n\n            loadResults.addAttribute(ec.entityId, ec.componentId);\n\n            delete froca.attributes[ec.entityId];\n        }\n\n        return;\n    }\n\n    loadResults.addAttribute(ec.entityId, ec.componentId);\n\n    const sourceNote = froca.notes[ec.entity.noteId];\n    const targetNote = ec.entity.type === 'relation' && froca.notes[ec.entity.value];\n\n    if (attribute) {\n        attribute.update(ec.entity);\n    } else if (sourceNote || targetNote) {\n        attribute = new FAttribute(froca, ec.entity);\n\n        froca.attributes[attribute.attributeId] = attribute;\n\n        if (sourceNote && !sourceNote.attributes.includes(attribute.attributeId)) {\n            sourceNote.attributes.push(attribute.attributeId);\n        }\n\n        if (targetNote && !targetNote.targetRelations.includes(attribute.attributeId)) {\n            targetNote.targetRelations.push(attribute.attributeId);\n        }\n    }\n}\n\nfunction processAttachment(loadResults, ec) {\n    if (ec.isErased && ec.entityId in froca.attachments) {\n        utils.reloadFrontendApp(`${ec.entityName} '${ec.entityId}' is erased, need to do complete reload.`);\n        return;\n    }\n\n    const attachment = froca.attachments[ec.entityId];\n\n    if (ec.isErased || ec.entity?.isDeleted) {\n        if (attachment) {\n            const note = attachment.getNote();\n\n            if (note && note.attachments) {\n                note.attachments = note.attachments.filter(att => att.attachmentId !== attachment.attachmentId);\n            }\n\n            loadResults.addAttachmentRow(ec.entity);\n\n            delete froca.attachments[ec.entityId];\n        }\n\n        return;\n    }\n\n    if (attachment) {\n        attachment.update(ec.entity);\n    } else {\n        const note = froca.notes[ec.entity.ownerId];\n\n        if (note?.attachments) {\n            note.attachments.push(new FAttachment(froca, ec.entity));\n        }\n    }\n\n    loadResults.addAttachmentRow(ec.entity);\n}\n\nexport default {\n    processEntityChanges\n}\n","import utils from './utils.js';\nimport toastService from \"./toast.js\";\nimport server from \"./server.js\";\nimport options from \"./options.js\";\nimport frocaUpdater from \"./froca_updater.js\";\nimport appContext from \"../components/app_context.js\";\n\nconst messageHandlers = [];\n\nlet ws;\nlet lastAcceptedEntityChangeId = window.glob.maxEntityChangeIdAtLoad;\nlet lastAcceptedEntityChangeSyncId = window.glob.maxEntityChangeSyncIdAtLoad;\nlet lastProcessedEntityChangeId = window.glob.maxEntityChangeIdAtLoad;\nlet lastPingTs;\nlet frontendUpdateDataQueue = [];\n\nfunction logError(message) {\n    console.error(utils.now(), message); // needs to be separate from .trace()\n\n    if (ws && ws.readyState === 1) {\n        ws.send(JSON.stringify({\n            type: 'log-error',\n            error: message,\n            stack: new Error().stack\n        }));\n    }\n}\n\nfunction logInfo(message) {\n    console.log(utils.now(), message);\n\n    if (ws && ws.readyState === 1) {\n        ws.send(JSON.stringify({\n            type: 'log-info',\n            info: message\n        }));\n    }\n}\n\nwindow.logError = logError;\nwindow.logInfo = logInfo;\n\nfunction subscribeToMessages(messageHandler) {\n    messageHandlers.push(messageHandler);\n}\n\n// used to serialize frontend update operations\nlet consumeQueuePromise = null;\n\n// to make sure each change event is processed only once. Not clear if this is still necessary\nconst processedEntityChangeIds = new Set();\n\nfunction logRows(entityChanges) {\n    const filteredRows = entityChanges.filter(row =>\n        !processedEntityChangeIds.has(row.id)\n        && (row.entityName !== 'options' || row.entityId !== 'openNoteContexts'));\n\n    if (filteredRows.length > 0) {\n        console.debug(utils.now(), \"Frontend update data: \", filteredRows);\n    }\n}\n\nasync function executeFrontendUpdate(entityChanges) {\n    lastPingTs = Date.now();\n\n    if (entityChanges.length > 0) {\n        logRows(entityChanges);\n\n        frontendUpdateDataQueue.push(...entityChanges);\n\n        // we set lastAcceptedEntityChangeId even before frontend update processing and send ping so that backend can start sending more updates\n\n        for (const entityChange of entityChanges) {\n            lastAcceptedEntityChangeId = Math.max(lastAcceptedEntityChangeId, entityChange.id);\n\n            if (entityChange.isSynced) {\n                lastAcceptedEntityChangeSyncId = Math.max(lastAcceptedEntityChangeSyncId, entityChange.id);\n            }\n        }\n\n        sendPing();\n\n        // first wait for all the preceding consumers to finish\n        while (consumeQueuePromise) {\n            await consumeQueuePromise;\n        }\n\n        try {\n            // it's my turn, so start it up\n            consumeQueuePromise = consumeFrontendUpdateData();\n\n            await consumeQueuePromise;\n        } finally {\n            // finish and set to null to signal somebody else can pick it up\n            consumeQueuePromise = null;\n        }\n    }\n}\n\nasync function handleMessage(event) {\n    const message = JSON.parse(event.data);\n\n    for (const messageHandler of messageHandlers) {\n        messageHandler(message);\n    }\n\n    if (message.type === 'ping') {\n        lastPingTs = Date.now();\n    }\n    else if (message.type === 'reload-frontend') {\n        utils.reloadFrontendApp(\"received request from backend to reload frontend\");\n    }\n    else if (message.type === 'frontend-update') {\n        await executeFrontendUpdate(message.data.entityChanges);\n    }\n    else if (message.type === 'sync-hash-check-failed') {\n        toastService.showError(\"同步检查失败!\", 60000);\n    }\n    else if (message.type === 'consistency-checks-failed') {\n        toastService.showError(\"一致性检查失败! 详情请看日志.\", 50 * 60000);\n    }\n    else if (message.type === 'api-log-messages') {\n        appContext.triggerEvent(\"apiLogMessages\", {noteId: message.noteId, messages: message.messages});\n    }\n    else if (message.type === 'toast') {\n        toastService.showMessage(message.message);\n    }\n    else if (message.type === 'execute-script') {\n        const bundleService = (await import(\"../services/bundle.js\")).default;\n        const froca = (await import(\"../services/froca.js\")).default;\n        const originEntity = message.originEntityId ? await froca.getNote(message.originEntityId) : null;\n\n        bundleService.getAndExecuteBundle(message.currentNoteId, originEntity, message.script, message.params);\n    }\n}\n\nlet entityChangeIdReachedListeners = [];\n\nfunction waitForEntityChangeId(desiredEntityChangeId) {\n    if (desiredEntityChangeId <= lastProcessedEntityChangeId) {\n        return Promise.resolve();\n    }\n\n    console.debug(`Waiting for ${desiredEntityChangeId}, last processed is ${lastProcessedEntityChangeId}, last accepted ${lastAcceptedEntityChangeId}`);\n\n    return new Promise((res, rej) => {\n        entityChangeIdReachedListeners.push({\n            desiredEntityChangeId: desiredEntityChangeId,\n            resolvePromise: res,\n            start: Date.now()\n        })\n    });\n}\n\nfunction waitForMaxKnownEntityChangeId() {\n    return waitForEntityChangeId(server.getMaxKnownEntityChangeId());\n}\n\nfunction checkEntityChangeIdListeners() {\n    entityChangeIdReachedListeners\n        .filter(l => l.desiredEntityChangeId <= lastProcessedEntityChangeId)\n        .forEach(l => l.resolvePromise());\n\n    entityChangeIdReachedListeners = entityChangeIdReachedListeners\n        .filter(l => l.desiredEntityChangeId > lastProcessedEntityChangeId);\n\n    entityChangeIdReachedListeners.filter(l => Date.now() > l.start - 60000)\n        .forEach(l => console.log(`Waiting for entityChangeId ${l.desiredEntityChangeId} while last processed is ${lastProcessedEntityChangeId} (last accepted ${lastAcceptedEntityChangeId}) for ${Math.floor((Date.now() - l.start) / 1000)}s`));\n}\n\nasync function consumeFrontendUpdateData() {\n    if (frontendUpdateDataQueue.length > 0) {\n        const allEntityChanges = frontendUpdateDataQueue;\n        frontendUpdateDataQueue = [];\n\n        const nonProcessedEntityChanges = allEntityChanges.filter(ec => !processedEntityChangeIds.has(ec.id));\n\n        try {\n            await utils.timeLimit(frocaUpdater.processEntityChanges(nonProcessedEntityChanges), 30000);\n        }\n        catch (e) {\n            logError(`发生错误 ${e.message}: ${e.stack}, 重新加载界面.`);\n\n            if (!glob.isDev && !options.is('debugModeEnabled')) {\n                // if there's an error in updating the frontend, then the easy option to recover is to reload the frontend completely\n\n                utils.reloadFrontendApp();\n            }\n            else {\n                console.log(\"nonProcessedEntityChanges causing the timeout\", nonProcessedEntityChanges);\n\n                toastService.showError(`Encountered error \"${e.message}\", check out the console.`);\n            }\n        }\n\n        for (const entityChange of nonProcessedEntityChanges) {\n            processedEntityChangeIds.add(entityChange.id);\n\n            lastProcessedEntityChangeId = Math.max(lastProcessedEntityChangeId, entityChange.id);\n        }\n    }\n\n    checkEntityChangeIdListeners();\n}\n\nfunction connectWebSocket() {\n    const loc = window.location;\n    const webSocketUri = `${loc.protocol === \"https:\" ? \"wss:\" : \"ws:\"}//${loc.host}${loc.pathname}`;\n\n    // use wss for secure messaging\n    const ws = new WebSocket(webSocketUri);\n    ws.onopen = () => console.debug(utils.now(), `Connected to server ${webSocketUri} with WebSocket`);\n    ws.onmessage = handleMessage;\n    // we're not handling ws.onclose here because reconnection is done in sendPing()\n\n    return ws;\n}\n\nasync function sendPing() {\n    if (Date.now() - lastPingTs > 30000) {\n        console.log(utils.now(), \"Lost websocket connection to the backend. If you keep having this issue repeatedly, you might want to check your reverse proxy (nginx, apache) configuration and allow/unblock WebSocket.\");\n    }\n\n    if (ws.readyState === ws.OPEN) {\n        ws.send(JSON.stringify({\n            type: 'ping',\n            lastEntityChangeId: lastAcceptedEntityChangeId\n        }));\n    }\n    else if (ws.readyState === ws.CLOSED || ws.readyState === ws.CLOSING) {\n        console.log(utils.now(), \"WS closed or closing, trying to reconnect\");\n\n        ws = connectWebSocket();\n    }\n}\n\nsetTimeout(() => {\n    ws = connectWebSocket();\n\n    lastPingTs = Date.now();\n\n    setInterval(sendPing, 1000);\n}, 0);\n\nexport default {\n    logError,\n    subscribeToMessages,\n    waitForMaxKnownEntityChangeId,\n    getMaxKnownEntityChangeSyncId: () => lastAcceptedEntityChangeSyncId\n};\n","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = () => ([]);\nwebpackEmptyContext.resolve = webpackEmptyContext;\nwebpackEmptyContext.id = 3676;\nmodule.exports = webpackEmptyContext;","import Component from \"../components/component.js\";\n\n\n/**\n * This is the base widget for all other widgets.\n *\n * For information on using widgets, see the tutorial {@tutorial widget_basics}.\n */\nclass BasicWidget extends Component {\n    constructor() {\n        super();\n\n        this.attrs = {\n            style: ''\n        };\n        this.classes = [];\n\n        this.children = [];\n        this.childPositionCounter = 10;\n    }\n\n    child(...components) {\n        if (!components) {\n            return this;\n        }\n\n        super.child(...components);\n\n        for (const component of components) {\n            if (component.position === undefined) {\n                component.position = this.childPositionCounter;\n                this.childPositionCounter += 10;\n            }\n        }\n\n        this.children.sort((a, b) => a.position - b.position);\n\n        return this;\n    }\n\n    id(id) {\n        this.attrs.id = id;\n        return this;\n    }\n\n    class(className) {\n        this.classes.push(className);\n        return this;\n    }\n\n    css(name, value) {\n        this.attrs.style += `${name}: ${value};`;\n        return this;\n    }\n\n    contentSized() {\n        this.css(\"contain\", \"none\");\n\n        return this;\n    }\n\n    collapsible() {\n        this.css('min-height', '0');\n        this.css('min-width', '0');\n        return this;\n    }\n\n    filling() {\n        this.css('flex-grow', '1');\n        return this;\n    }\n\n    /**\n     * Accepts a string of CSS to add with the widget.\n     * @param {string} block\n     * @returns {this} for chaining\n     */\n    cssBlock(block) {\n        this.cssEl = block;\n        return this;\n    }\n\n    render() {\n        this.doRender();\n\n        this.$widget.attr('data-component-id', this.componentId);\n        this.$widget\n            .addClass('component')\n            .prop('component', this);\n\n        if (!this.isEnabled()) {\n            this.toggleInt(false);\n        }\n\n        if (this.cssEl) {\n            const css = this.cssEl.trim().startsWith('<style>') ? this.cssEl : `<style>${this.cssEl}</style>`;\n\n            this.$widget.append(css);\n        }\n\n        for (const key in this.attrs) {\n            if (key === 'style') {\n                if (this.attrs[key]) {\n                    let style = this.$widget.attr('style');\n                    style = style ? `${style}; ${this.attrs[key]}` : this.attrs[key];\n\n                    this.$widget.attr(key, style);\n                }\n            }\n            else {\n                this.$widget.attr(key, this.attrs[key]);\n            }\n        }\n\n        for (const className of this.classes) {\n            this.$widget.addClass(className);\n        }\n\n        return this.$widget;\n    }\n\n    isEnabled() {\n        return true;\n    }\n\n    /**\n     * Method used for rendering the widget.\n     *\n     * Your class should override this method.\n     * The method is expected to create a this.$widget containing jQuery object\n     */\n    doRender() {}\n\n    toggleInt(show) {\n        this.$widget.toggleClass('hidden-int', !show);\n    }\n\n    isHiddenInt() {\n        return this.$widget.hasClass('hidden-int');\n    }\n\n    toggleExt(show) {\n        this.$widget.toggleClass('hidden-ext', !show);\n    }\n\n    isHiddenExt() {\n        return this.$widget.hasClass('hidden-ext');\n    }\n\n    canBeShown() {\n        return !this.isHiddenInt() && !this.isHiddenExt();\n    }\n\n    isVisible() {\n        return this.$widget.is(\":visible\");\n    }\n\n    getPosition() {\n        return this.position;\n    }\n\n    remove() {\n        if (this.$widget) {\n            this.$widget.remove();\n        }\n    }\n\n    getClosestNtxId() {\n        if (this.$widget) {\n            return this.$widget.closest(\"[data-ntx-id]\").attr(\"data-ntx-id\");\n        }\n        else {\n            return null;\n        }\n    }\n\n    cleanup() {}\n}\n\nexport default BasicWidget;\n","import BasicWidget from \"./basic_widget.js\";\nimport appContext from \"../components/app_context.js\";\n\n/**\n * This widget allows for changing and updating depending on the active note.\n * @extends {BasicWidget}\n */\nclass NoteContextAwareWidget extends BasicWidget {\n    isNoteContext(ntxId) {\n        if (Array.isArray(ntxId)) {\n            return this.noteContext && ntxId.includes(this.noteContext.ntxId);\n        }\n        else {\n            return this.noteContext && this.noteContext.ntxId === ntxId;\n        }\n    }\n\n    isActiveNoteContext() {\n        return appContext.tabManager.getActiveContext() === this.noteContext;\n    }\n\n    isNote(noteId) {\n        return this.noteId === noteId;\n    }\n\n    /** @returns {FNote|undefined} */\n    get note() {\n        return this.noteContext?.note;\n    }\n\n    /** @returns {string|undefined} */\n    get noteId() {\n        return this.note?.noteId;\n    }\n\n    /** @returns {string|undefined} */\n    get notePath() {\n        return this.noteContext?.notePath;\n    }\n\n    /** @returns {string} */\n    get hoistedNoteId() {\n        return this.noteContext?.hoistedNoteId;\n    }\n\n    get ntxId() {\n        return this.noteContext?.ntxId;\n    }\n\n    /**\n     * @returns {boolean} true when an active note exists\n     */\n    isEnabled() {\n        return !!this.note;\n    }\n\n    async refresh() {\n        if (this.isEnabled()) {\n            this.toggleInt(true);\n            await this.refreshWithNote(this.note);\n        }\n        else {\n            this.toggleInt(false);\n        }\n    }\n\n    /**\n     * Override this method to be able to refresh your\n     * widget with each note.\n     * @param {FNote} note\n     * @returns {Promise<void>}\n     */\n    async refreshWithNote(note) {}\n\n    async noteSwitchedEvent({noteContext, notePath}) {\n        // if notePath does not match, then the noteContext has been switched to another note in the meantime\n        if (noteContext.notePath === notePath) {\n            await this.noteSwitched();\n        }\n    }\n\n    async noteSwitched() {\n        await this.refresh();\n    }\n\n    async activeContextChangedEvent({noteContext}) {\n        this.noteContext = noteContext;\n\n        await this.activeContextChanged();\n    }\n\n    async activeContextChanged() {\n        await this.refresh();\n    }\n\n    // when note is both switched and activated, this should not produce a double refresh\n    async noteSwitchedAndActivatedEvent({noteContext, notePath}) {\n        this.noteContext = noteContext;\n\n        // if notePath does not match, then the noteContext has been switched to another note in the meantime\n        if (this.notePath === notePath) {\n            await this.refresh();\n        }\n    }\n\n    setNoteContextEvent({noteContext}) {\n        /** @var {NoteContext} */\n        this.noteContext = noteContext;\n    }\n\n    async noteTypeMimeChangedEvent({noteId}) {\n        if (this.isNote(noteId)) {\n            await this.refresh();\n        }\n    }\n\n    async frocaReloadedEvent() {\n        await this.refresh();\n    }\n}\n\nexport default NoteContextAwareWidget;\n","import NoteContextAwareWidget from \"./note_context_aware_widget.js\";\n\nconst WIDGET_TPL = `\n<div class=\"card widget\">\n    <div class=\"card-header\">\n        <div class=\"card-header-title\"></div>\n        <div class=\"card-header-buttons\"></div>\n    </div>\n\n    <div id=\"[to be set]\" class=\"body-wrapper\">\n        <div class=\"card-body\"></div>\n    </div>\n</div>`;\n\n/**\n * This widget manages rendering panels in the right-hand pane.\n * @extends {NoteContextAwareWidget}\n */\nclass RightPanelWidget extends NoteContextAwareWidget {\n    /** Title to show in the panel. */\n    get widgetTitle() { return \"Untitled widget\"; }\n\n    get widgetButtons() { return []; }\n\n    get help() { return {}; }\n\n    constructor() {\n        super();\n\n        this.child(...this.widgetButtons);\n    }\n\n    /**\n     * Do not override this method unless you know what you're doing.\n     * Do not override this method unless you know what you're doing.\n     */\n    doRender() {\n        this.$widget = $(WIDGET_TPL);\n        this.contentSized();\n        this.$widget.find('[data-target]').attr('data-target', `#${this.componentId}`);\n\n        this.$bodyWrapper = this.$widget.find('.body-wrapper');\n        this.$bodyWrapper.attr('id', this.componentId); // for toggle to work we need id\n\n        this.$body = this.$bodyWrapper.find('.card-body');\n\n        this.$title = this.$widget.find('.card-header .card-header-title');\n        this.$title.text(this.widgetTitle);\n\n        this.$buttons = this.$widget.find('.card-header .card-header-buttons');\n        this.$buttons.empty();\n\n        for (const buttonWidget of this.children) {\n            this.$buttons.append(buttonWidget.render());\n        }\n\n        this.initialized = this.doRenderBody();\n    }\n\n    /**\n     * Method used for rendering the body of the widget (via existing this.$body)\n     *\n     * Your class should override this method.\n     * @returns {Promise|undefined} if widget needs async operation to initialize, it can return a Promise\n     */\n    async doRenderBody() {}\n}\n\nexport default RightPanelWidget;\n","module.exports = require(\"electron\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","var inProgress = {};\nvar dataWebpackPrefix = \"trilium:\";\n// loadScript function to load a script via script tag\n__webpack_require__.l = (url, done, key, chunkId) => {\n\tif(inProgress[url]) { inProgress[url].push(done); return; }\n\tvar script, needAttach;\n\tif(key !== undefined) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tfor(var i = 0; i < scripts.length; i++) {\n\t\t\tvar s = scripts[i];\n\t\t\tif(s.getAttribute(\"src\") == url || s.getAttribute(\"data-webpack\") == dataWebpackPrefix + key) { script = s; break; }\n\t\t}\n\t}\n\tif(!script) {\n\t\tneedAttach = true;\n\t\tscript = document.createElement('script');\n\n\t\tscript.charset = 'utf-8';\n\t\tscript.timeout = 120;\n\t\tif (__webpack_require__.nc) {\n\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n\t\t}\n\t\tscript.setAttribute(\"data-webpack\", dataWebpackPrefix + key);\n\t\tscript.src = url;\n\t}\n\tinProgress[url] = [done];\n\tvar onScriptComplete = (prev, event) => {\n\t\t// avoid mem leaks in IE.\n\t\tscript.onerror = script.onload = null;\n\t\tclearTimeout(timeout);\n\t\tvar doneFns = inProgress[url];\n\t\tdelete inProgress[url];\n\t\tscript.parentNode && script.parentNode.removeChild(script);\n\t\tdoneFns && doneFns.forEach((fn) => (fn(event)));\n\t\tif(prev) return prev(event);\n\t}\n\tvar timeout = setTimeout(onScriptComplete.bind(null, undefined, { type: 'timeout', target: script }), 120000);\n\tscript.onerror = onScriptComplete.bind(null, script.onerror);\n\tscript.onload = onScriptComplete.bind(null, script.onload);\n\tneedAttach && document.head.appendChild(script);\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = (chunkId) => {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce((promises, key) => {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks\n__webpack_require__.u = (chunkId) => {\n\t// return url for filenames based on template\n\treturn \"\" + chunkId + \".js\";\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.p = \"assets/v0.62.4/app-dist/\";","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t380: 0,\n\t586: 0,\n\t274: 0\n};\n\n__webpack_require__.f.j = (chunkId, promises) => {\n\t\t// JSONP chunk loading for javascript\n\t\tvar installedChunkData = __webpack_require__.o(installedChunks, chunkId) ? installedChunks[chunkId] : undefined;\n\t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n\t\t\t// a Promise means \"currently loading\".\n\t\t\tif(installedChunkData) {\n\t\t\t\tpromises.push(installedChunkData[2]);\n\t\t\t} else {\n\t\t\t\tif(true) { // all chunks have JS\n\t\t\t\t\t// setup Promise in chunk cache\n\t\t\t\t\tvar promise = new Promise((resolve, reject) => (installedChunkData = installedChunks[chunkId] = [resolve, reject]));\n\t\t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n\t\t\t\t\t// start chunk loading\n\t\t\t\t\tvar url = __webpack_require__.p + __webpack_require__.u(chunkId);\n\t\t\t\t\t// create error before stack unwound to get useful stacktrace later\n\t\t\t\t\tvar error = new Error();\n\t\t\t\t\tvar loadingEnded = (event) => {\n\t\t\t\t\t\tif(__webpack_require__.o(installedChunks, chunkId)) {\n\t\t\t\t\t\t\tinstalledChunkData = installedChunks[chunkId];\n\t\t\t\t\t\t\tif(installedChunkData !== 0) installedChunks[chunkId] = undefined;\n\t\t\t\t\t\t\tif(installedChunkData) {\n\t\t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n\t\t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n\t\t\t\t\t\t\t\terror.message = 'Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')';\n\t\t\t\t\t\t\t\terror.name = 'ChunkLoadError';\n\t\t\t\t\t\t\t\terror.type = errorType;\n\t\t\t\t\t\t\t\terror.request = realSrc;\n\t\t\t\t\t\t\t\tinstalledChunkData[1](error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\t__webpack_require__.l(url, loadingEnded, \"chunk-\" + chunkId, chunkId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n};\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n// no on chunks loaded\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\n}\n\nvar chunkLoadingGlobal = global[\"webpackChunktrilium\"] = global[\"webpackChunktrilium\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","import server from \"./server.js\";\nimport appContext from \"../components/app_context.js\";\nimport utils from './utils.js';\nimport noteCreateService from './note_create.js';\nimport froca from \"./froca.js\";\n\n// this key needs to have this value, so it's hit by the tooltip\nconst SELECTED_NOTE_PATH_KEY = \"data-note-path\";\n\nconst SELECTED_EXTERNAL_LINK_KEY = \"data-external-link\";\n\nasync function autocompleteSourceForCKEditor(queryText) {\n    return await new Promise((res, rej) => {\n        autocompleteSource(queryText, rows => {\n            res(rows.map(row => {\n                return {\n                    action: row.action,\n                    noteTitle: row.noteTitle,\n                    id: `@${row.notePathTitle}`,\n                    name: row.notePathTitle,\n                    link: `#${row.notePath}`,\n                    notePath: row.notePath,\n                    highlightedNotePathTitle: row.highlightedNotePathTitle\n                }\n            }));\n        }, {\n            allowCreatingNotes: true\n        });\n    });\n}\n\nasync function autocompleteSource(term, cb, options = {}) {\n    const activeNoteId = appContext.tabManager.getActiveContextNoteId();\n\n    let results = await server.get(`autocomplete?query=${encodeURIComponent(term)}&activeNoteId=${activeNoteId}`);\n\n    if (term.trim().length >= 1 && options.allowCreatingNotes) {\n        results = [\n            {\n                action: 'create-note',\n                noteTitle: term,\n                parentNoteId: activeNoteId || 'root',\n                highlightedNotePathTitle: `创建并关联子笔记 \"${utils.escapeHtml(term)}\"`\n            }\n        ].concat(results);\n    }\n\n    if (term.match(/^[a-z]+:\\/\\/.+/i) && options.allowExternalLinks) {\n        results = [\n            {\n                action: 'external-link',\n                externalLink: term,\n                highlightedNotePathTitle: `插入外部链接到 \"${utils.escapeHtml(term)}\"`\n            }\n        ].concat(results);\n    }\n\n    cb(results);\n}\n\nfunction clearText($el) {\n    if (utils.isMobile()) {\n        return;\n    }\n\n    $el.setSelectedNotePath(\"\");\n    $el.autocomplete(\"val\", \"\").trigger('change');\n}\n\nfunction setText($el, text) {\n    if (utils.isMobile()) {\n        return;\n    }\n\n    $el.setSelectedNotePath(\"\");\n    $el\n        .autocomplete(\"val\", text.trim())\n        .autocomplete(\"open\");\n}\n\nfunction showRecentNotes($el) {\n    if (utils.isMobile()) {\n        return;\n    }\n\n    $el.setSelectedNotePath(\"\");\n    $el.autocomplete(\"val\", \"\");\n    $el.trigger('focus');\n\n    // simulate pressing down arrow to trigger autocomplete\n    const e = $.Event('keydown');\n    e.which = 40; // arrow down\n    $el.trigger(e);\n}\n\nfunction initNoteAutocomplete($el, options) {\n    if ($el.hasClass(\"note-autocomplete-input\") || utils.isMobile()) {\n        // clear any event listener added in previous invocation of this function\n        $el.off('autocomplete:noteselected');\n\n        return $el;\n    }\n\n    options = options || {};\n\n    $el.addClass(\"note-autocomplete-input\");\n\n    const $clearTextButton = $(\"<a>\")\n            .addClass(\"input-group-text input-clearer-button bx bxs-tag-x\")\n            .prop(\"title\", \"清空文字\");\n\n    const $showRecentNotesButton = $(\"<a>\")\n            .addClass(\"input-group-text show-recent-notes-button bx bx-time\")\n            .prop(\"title\", \"显示最近笔记\");\n\n    const $goToSelectedNoteButton = $(\"<a>\")\n        .addClass(\"input-group-text go-to-selected-note-button bx bx-arrow-to-right\");\n\n    const $sideButtons = $(\"<div>\")\n        .addClass(\"input-group-append\")\n        .append($clearTextButton)\n        .append($showRecentNotesButton);\n\n    if (!options.hideGoToSelectedNoteButton) {\n        $sideButtons.append($goToSelectedNoteButton);\n    }\n\n    $el.after($sideButtons);\n\n    $clearTextButton.on('click', () => clearText($el));\n\n    $showRecentNotesButton.on('click', e => {\n        showRecentNotes($el);\n\n        // this will cause the click not give focus to the \"show recent notes\" button\n        // this is important because otherwise input will lose focus immediately and not show the results\n        return false;\n    });\n\n    let autocompleteOptions = {};\n    if (options.container) {\n        autocompleteOptions.dropdownMenuContainer = options.container;\n        autocompleteOptions.debug = true;   // don't close on blur\n    }\n\n    $el.autocomplete({\n        ...autocompleteOptions,\n        appendTo: document.querySelector('body'),\n        hint: false,\n        autoselect: true,\n        // openOnFocus has to be false, otherwise re-focus (after return from note type chooser dialog) forces\n        // re-querying of the autocomplete source which then changes the currently selected suggestion\n        openOnFocus: false,\n        minLength: 0,\n        tabAutocomplete: false\n    }, [\n        {\n            source: (term, cb) => autocompleteSource(term, cb, options),\n            displayKey: 'notePathTitle',\n            templates: {\n                suggestion: suggestion => suggestion.highlightedNotePathTitle\n            },\n            // we can't cache identical searches because notes can be created / renamed, new recent notes can be added\n            cache: false\n        }\n    ]);\n\n    $el.on('autocomplete:selected', async (event, suggestion) => {\n        if (suggestion.action === 'external-link') {\n            $el.setSelectedNotePath(null);\n            $el.setSelectedExternalLink(suggestion.externalLink);\n\n            $el.autocomplete(\"val\", suggestion.externalLink);\n\n            $el.autocomplete(\"close\");\n\n            $el.trigger('autocomplete:externallinkselected', [suggestion]);\n\n            return;\n        }\n\n        if (suggestion.action === 'create-note') {\n            const {success, noteType, templateNoteId} = await noteCreateService.chooseNoteType();\n\n            if (!success) {\n                return;\n            }\n\n            const {note} = await noteCreateService.createNote(suggestion.parentNoteId, {\n                title: suggestion.noteTitle,\n                activate: false,\n                type: noteType,\n                templateNoteId: templateNoteId\n            });\n\n            const hoistedNoteId = appContext.tabManager.getActiveContext()?.hoistedNoteId;\n            suggestion.notePath = note.getBestNotePathString(hoistedNoteId);\n        }\n\n        $el.setSelectedNotePath(suggestion.notePath);\n        $el.setSelectedExternalLink(null);\n\n        $el.autocomplete(\"val\", suggestion.noteTitle);\n\n        $el.autocomplete(\"close\");\n\n        $el.trigger('autocomplete:noteselected', [suggestion]);\n    });\n\n    $el.on('autocomplete:closed', () => {\n        if (!$el.val().trim()) {\n            clearText($el);\n        }\n    });\n\n    $el.on('autocomplete:opened', () => {\n        if ($el.attr(\"readonly\")) {\n            $el.autocomplete('close');\n        }\n    });\n\n    // clear any event listener added in previous invocation of this function\n    $el.off('autocomplete:noteselected');\n\n    return $el;\n}\n\nfunction init() {\n    $.fn.getSelectedNotePath = function () {\n        if (!$(this).val().trim()) {\n            return \"\";\n        } else {\n            return $(this).attr(SELECTED_NOTE_PATH_KEY);\n        }\n    };\n\n    $.fn.getSelectedNoteId = function () {\n        const notePath = $(this).getSelectedNotePath();\n        if (!notePath) {\n            return null;\n        }\n\n        const chunks = notePath.split('/');\n\n        return chunks.length >= 1 ? chunks[chunks.length - 1] : null;\n    }\n\n    $.fn.setSelectedNotePath = function (notePath) {\n        notePath = notePath || \"\";\n\n        $(this).attr(SELECTED_NOTE_PATH_KEY, notePath);\n\n        $(this)\n            .closest(\".input-group\")\n            .find(\".go-to-selected-note-button\")\n            .toggleClass(\"disabled\", !notePath.trim())\n            .attr(\"href\", `#${notePath}`); // we also set href here so tooltip can be displayed\n    };\n\n    $.fn.getSelectedExternalLink = function () {\n        if (!$(this).val().trim()) {\n            return \"\";\n        } else {\n            return $(this).attr(SELECTED_EXTERNAL_LINK_KEY);\n        }\n    };\n\n    $.fn.setSelectedExternalLink = function (externalLink) {\n        if (externalLink) {\n            $(this)\n                .closest(\".input-group\")\n                .find(\".go-to-selected-note-button\")\n                .toggleClass(\"disabled\", true);\n        }\n    }\n\n    $.fn.setNote = async function (noteId) {\n        const note = noteId ? await froca.getNote(noteId, true) : null;\n\n        $(this)\n            .val(note ? note.title : \"\")\n            .setSelectedNotePath(noteId);\n    }\n}\n\nexport default {\n    autocompleteSourceForCKEditor,\n    initNoteAutocomplete,\n    showRecentNotes,\n    setText,\n    init\n}\n","/**\n * Mac specific initialization\n */\nimport utils from \"./utils.js\";\nimport shortcutService from \"./shortcuts.js\";\n\nfunction init() {\n    if (utils.isElectron() && utils.isMac()) {\n        shortcutService.bindGlobalShortcut('meta+c', () => exec(\"copy\"));\n        shortcutService.bindGlobalShortcut('meta+v', () => exec('paste'));\n        shortcutService.bindGlobalShortcut('meta+x', () => exec('cut'));\n        shortcutService.bindGlobalShortcut('meta+a', () => exec('selectAll'));\n        shortcutService.bindGlobalShortcut('meta+z', () => exec('undo'));\n        shortcutService.bindGlobalShortcut('meta+y', () => exec('redo'));\n    }\n}\n\nfunction exec(cmd) {\n    document.execCommand(cmd);\n\n    return false;\n}\n\nexport default {\n    init\n}\n","import utils from \"../services/utils.js\";\nimport options from \"../services/options.js\";\nimport zoomService from \"../components/zoom.js\";\nimport contextMenu from \"./context_menu.js\";\n\nfunction setupContextMenu() {\n    const electron = utils.dynamicRequire('electron');\n\n    const remote = utils.dynamicRequire('@electron/remote');\n    const {webContents} = remote.getCurrentWindow();\n\n    webContents.on('context-menu', (event, params) => {\n        const {editFlags} = params;\n        const hasText = params.selectionText.trim().length > 0;\n        const isMac = process.platform === \"darwin\";\n        const platformModifier = isMac ? 'Meta' : 'Ctrl';\n\n        const items = [];\n\n        if (params.misspelledWord) {\n            for (const suggestion of params.dictionarySuggestions) {\n                items.push({\n                    title: suggestion,\n                    command: \"replaceMisspelling\",\n                    spellingSuggestion: suggestion,\n                    uiIcon: \"bx bx-empty\"\n                });\n            }\n\n            items.push({\n                title: `将 \"${params.misspelledWord}\" 加入字典`,\n                uiIcon: \"bx bx-plus\",\n                handler: () => webContents.session.addWordToSpellCheckerDictionary(params.misspelledWord)\n            });\n\n            items.push({ title: `----` });\n        }\n\n        if (params.isEditable) {\n            items.push({\n                enabled: editFlags.canCut && hasText,\n                title: `剪切 <kbd>${platformModifier}+X`,\n                uiIcon: \"bx bx-cut\",\n                handler: () => webContents.cut()\n            });\n        }\n\n        if (params.isEditable || hasText) {\n            items.push({\n                enabled: editFlags.canCopy && hasText,\n                title: `复制 <kbd>${platformModifier}+C`,\n                uiIcon: \"bx bx-copy\",\n                handler: () => webContents.copy()\n            });\n        }\n\n        if (![\"\", \"javascript:\", \"about:blank#blocked\"].includes(params.linkURL) && params.mediaType === 'none') {\n            items.push({\n                title: `复制 link`,\n                uiIcon: \"bx bx-copy\",\n                handler: () => {\n                    electron.clipboard.write({\n                        bookmark: params.linkText,\n                        text: params.linkURL\n                    });\n                }\n            });\n        }\n\n        if (params.isEditable) {\n            items.push({\n                enabled: editFlags.canPaste,\n                title: `粘贴 <kbd>${platformModifier}+V`,\n                uiIcon: \"bx bx-paste\",\n                handler: () => webContents.paste()\n            });\n        }\n\n        if (params.isEditable) {\n            items.push({\n                enabled: editFlags.canPaste,\n                title: `粘贴为纯文本 <kbd>${platformModifier}+Shift+V`,\n                uiIcon: \"bx bx-paste\",\n                handler: () => webContents.pasteAndMatchStyle()\n            });\n        }\n\n        if (hasText) {\n            const shortenedSelection = params.selectionText.length > 15\n                ? (`${params.selectionText.substr(0, 13)}…`)\n                : params.selectionText;\n\n            // Read the search engine from the options and fallback to DuckDuckGo if the option is not set.\n            const customSearchEngineName = options.get(\"customSearchEngineName\");\n            const customSearchEngineUrl = options.get(\"customSearchEngineUrl\");\n            let searchEngineName;\n            let searchEngineUrl;\n            if (customSearchEngineName && customSearchEngineUrl) {\n                searchEngineName = customSearchEngineName;\n                searchEngineUrl = customSearchEngineUrl;\n            } else {\n                searchEngineName = \"DuckDuckGo\";\n                searchEngineUrl = \"https://duckduckgo.com/?q={keyword}\";\n            }\n\n            // Replace the placeholder with the real search keyword.\n            let searchUrl = searchEngineUrl.replace(\"{keyword}\", encodeURIComponent(params.selectionText));\n\n            items.push({\n                enabled: editFlags.canPaste,\n                title: `用 ${searchEngineName} 搜索 \"${shortenedSelection}\"`,\n                uiIcon: \"bx bx-search-alt\",\n                handler: () => electron.shell.openExternal(searchUrl)\n            });\n        }\n\n        if (items.length === 0) {\n            return;\n        }\n\n        const zoomLevel = zoomService.getCurrentZoom();\n\n        contextMenu.show({\n            x: params.x / zoomLevel,\n            y: params.y / zoomLevel,\n            items,\n            selectMenuItemHandler: ({command, spellingSuggestion}) => {\n                if (command === 'replaceMisspelling') {\n                    webContents.insertText(spellingSuggestion);\n                }\n            }\n        });\n    });\n}\n\nexport default {\n    setupContextMenu\n};\n","import BasicWidget from \"../basic_widget.js\";\n\nexport default class Container extends BasicWidget {\n    doRender() {\n        this.$widget = $(`<div>`);\n        this.renderChildren();\n    }\n\n    renderChildren() {\n        for (const widget of this.children) {\n            this.$widget.append(widget.render());\n        }\n    }\n}\n","import Container from \"./container.js\";\n\nexport default class FlexContainer extends Container {\n    constructor(direction) {\n        super();\n\n        if (!direction || !['row', 'column'].includes(direction)) {\n            throw new Error(`Direction argument given as '${direction}', use either 'row' or 'column'`);\n        }\n\n        this.attrs.style = `display: flex; flex-direction: ${direction};`;\n    }\n}\n","import BasicWidget from \"../basic_widget.js\";\n\nconst TPL = `\n<div style=\"display: none;\">\n    <style>\n        .global-menu-button-update-available-button {\n            width: 21px !important;\n            height: 21px !important;\n            padding: 0 !important;\n            \n            border-radius: var(--button-border-radius);\n            transform: scale(0.9);\n            border: none;\n            opacity: 0.8;\n            \n            display: flex;\n            align-items: center;\n            justify-content: center;\n        }\n        \n        .global-menu-button-wrapper:hover .global-menu-button-update-available-button {\n            opacity: 1;\n        }\n    </style>\n    \n    <span class=\"bx bx-sync global-menu-button-update-available-button\" title=\"有可用的更新\"></span>\n</div>\n`;\n\nexport default class UpdateAvailableWidget extends BasicWidget {\n    doRender() {\n        this.$widget = $(TPL);\n    }\n\n    updateVersionStatus(latestVersion) {\n        this.$widget.toggle(latestVersion > glob.triliumVersion);\n    }\n}\n","import BasicWidget from \"../basic_widget.js\";\nimport utils from \"../../services/utils.js\";\nimport UpdateAvailableWidget from \"./update_available.js\";\nimport options from \"../../services/options.js\";\n\nconst TPL = `\n<div class=\"dropdown global-menu dropright\">\n    <style>\n    .global-menu {\n        width: 53px;\n        height: 53px;\n    }\n    \n    .global-menu .dropdown-menu {\n        min-width: 20em;\n    }\n    \n    .global-menu-button {\n        background-image: url(\"${window.glob.assetPath}/images/icon-black.svg\");\n        background-repeat: no-repeat;\n        background-position: 40% 50%;\n        background-size: 45px;\n        width: 100%;\n        height: 100%;\n        position: relative;\n    }\n    \n    .global-menu-button:hover {\n        background-image: url(\"${window.glob.assetPath}/images/icon-color.svg\");\n        border: 0;\n    }\n    \n    .global-menu-button-update-available {\n        position: absolute;\n        right: -30px;\n        bottom: -30px;\n        width: 100%;\n        height: 100%;\n        pointer-events: none;\n    }\n\n    .update-to-latest-version-button {\n        display: none;\n    }\n    \n    .global-menu .zoom-container {\n        display: flex; \n        flex-direction: row; \n        justify-content: space-between;\n        align-items: baseline;\n    }\n    \n    .global-menu .zoom-buttons a {\n        display: inline-block;\n        border: 1px solid var(--button-border-color);\n        border-radius: var(--button-border-radius);\n        color: var(--button-text-color);\n        background-color: var(--button-background-color);\n        padding: 3px;\n        margin-left: 3px;\n    }\n    \n    .global-menu .zoom-buttons a:hover {\n        text-decoration: none;\n    }\n    \n    .global-menu .zoom-state {\n        margin-left: 5px;\n        margin-right: 5px;\n    }\n    \n    .global-menu .dropdown-item .bx {\n        position: relative;\n        top: 3px;\n        font-size: 120%;\n        margin-right: 5px;\n    }\n    \n    body.mobile .show-help-button, body.mobile .show-about-dialog-button {\n        /* hidden because these dialogs are not available for mobile */\n        display: none;\n    }\n    \n    body.mobile .global-menu .dropdown-submenu .dropdown-menu {\n        display: block;\n        font-size: 90%;\n        position: relative;\n        left: 0;\n        top: 5px;\n    }\n    </style>\n\n    <button type=\"button\" data-toggle=\"dropdown\" data-placement=\"right\"\n            aria-haspopup=\"true\" aria-expanded=\"false\" \n            class=\"icon-action global-menu-button\" title=\"菜单\">\n        <div class=\"global-menu-button-update-available\"></div>\n    </button>\n\n    <ul class=\"dropdown-menu dropdown-menu-right\">\n        <li class=\"dropdown-item\" data-trigger-command=\"showOptions\">\n            <span class=\"bx bx-slider\"></span>\n            选项\n        </li>\n\n        <li class=\"dropdown-item\" data-trigger-command=\"openNewWindow\">\n            <span class=\"bx bx-window-open\"></span>\n            新窗口\n            <kbd data-command=\"openNewWindow\"></kbd>\n        </li>\n\n        <li class=\"dropdown-item switch-to-mobile-version-button\" data-trigger-command=\"switchToMobileVersion\">\n            <span class=\"bx bx-mobile\"></span>\n            切换到移动版\n        </li>\n        \n        <li class=\"dropdown-item switch-to-desktop-version-button\" data-trigger-command=\"switchToDesktopVersion\">\n            <span class=\"bx bx-desktop\"></span>\n            切换到桌面版\n        </li>\n        \n        <span class=\"zoom-container dropdown-item\">\n            <div>\n                <span class=\"bx bx-empty\"></span>\n                缩放\n            </div>\n            \n            <div class=\"zoom-buttons\">\n                <a data-trigger-command=\"toggleFullscreen\" title=\"切换全屏\" class=\"bx bx-expand-alt\"></a>\n                \n                &nbsp;\n                \n                <a data-trigger-command=\"zoomOut\" title=\"缩小\" class=\"bx bx-minus\"></a>\n                \n                <span data-trigger-command=\"zoomReset\" title=\"Reset Zoom Level\" class=\"zoom-state\"></span>\n                \n                <a data-trigger-command=\"zoomIn\" title=\"放大\" class=\"bx bx-plus\"></a>\n            </div>\n        </span>\n\n        <li class=\"dropdown-item\" data-trigger-command=\"showLaunchBarSubtree\">\n            <span class=\"bx bx-sidebar\"></span>\n            配置启动栏\n        </li>\n        \n        <li class=\"dropdown-item\" data-trigger-command=\"showShareSubtree\">\n            <span class=\"bx bx-share-alt\"></span>\n            显示分享的笔记子树\n        </li>\n        \n        <li class=\"dropdown-item dropdown-submenu\">\n            <span class=\"dropdown-toggle\">\n                <span class=\"bx bx-empty\"></span>\n                高级\n            </span>\n            \n            <ul class=\"dropdown-menu\">\n                <li class=\"dropdown-item open-dev-tools-button\" data-trigger-command=\"openDevTools\">\n                    <span class=\"bx bx-bug-alt\"></span>\n                    开发者工具\n                    <kbd data-command=\"openDevTools\"></kbd>\n                </li>\n        \n                <li class=\"dropdown-item\" data-trigger-command=\"showSQLConsole\">\n                    <span class=\"bx bx-data\"></span>\n                    打开SQL控制台\n                    <kbd data-command=\"showSQLConsole\"></kbd>\n                </li>\n                \n                <li class=\"dropdown-item\" data-trigger-command=\"showSQLConsoleHistory\">\n                    <span class=\"bx bx-empty\"></span>\n                    打开SQL控制台历史记录\n                </li>\n                \n                <li class=\"dropdown-item\" data-trigger-command=\"showSearchHistory\">\n                    <span class=\"bx bx-empty\"></span>\n                    打开搜索历史\n                </li>\n        \n                <li class=\"dropdown-item\" data-trigger-command=\"showBackendLog\">\n                    <span class=\"bx bx-empty\"></span>\n                    显示后台日志\n                    <kbd data-command=\"showBackendLog\"></kbd>\n                </li>\n                \n                <li class=\"dropdown-item\" data-trigger-command=\"reloadFrontendApp\" \n                    title=\"重新加载可以帮助解决一些显示问题, 而无需重新启动整个应用程序.\">\n                    <span class=\"bx bx-empty\"></span>\n                    重新加载界面\n                    <kbd data-command=\"reloadFrontendApp\"></kbd>\n                </li>\n                \n                <li class=\"dropdown-item\" data-trigger-command=\"showHiddenSubtree\">\n                    <span class=\"bx bx-empty\"></span>\n                    显示隐藏的子树\n                </li>\n            </ul>\n        </li>\n\n        <li class=\"dropdown-item show-help-button\" data-trigger-command=\"showHelp\">\n            <span class=\"bx bx-info-circle\"></span>\n            显示帮助\n            <kbd data-command=\"showHelp\"></kbd>\n        </li>\n\n        <li class=\"dropdown-item show-about-dialog-button\">\n            <span class=\"bx bx-empty\"></span>\n            关于 Trilium Notes\n        </li>\n\n        <li class=\"dropdown-item update-to-latest-version-button\" data-trigger-command=\"downloadLatestVersion\">\n            <span class=\"bx bx-sync\"></span>\n\n            <span class=\"version-text\"></span>\n        </li>\n\n        <li class=\"dropdown-item logout-button\" data-trigger-command=\"logout\">\n            <span class=\"bx bx-log-out\"></span>\n            登出\n        </li>\n    </ul>\n</div>\n`;\n\nexport default class GlobalMenuWidget extends BasicWidget {\n    constructor() {\n        super();\n\n        this.updateAvailableWidget = new UpdateAvailableWidget();\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$dropdown = this.$widget.find(\"[data-toggle='dropdown']\");\n        const $button = this.$widget.find(\".global-menu-button\");\n        $button.tooltip({ trigger: \"hover\" });\n        $button.on(\"click\", () => $button.tooltip(\"hide\"));\n\n        this.$widget.find(\".show-about-dialog-button\").on('click', () => this.triggerCommand(\"openAboutDialog\"));\n\n        const isElectron = utils.isElectron();\n\n        this.$widget.find(\".logout-button\").toggle(!isElectron);\n        this.$widget.find(\".open-dev-tools-button\").toggle(isElectron);\n        this.$widget.find(\".switch-to-mobile-version-button\").toggle(!isElectron && utils.isDesktop());\n        this.$widget.find(\".switch-to-desktop-version-button\").toggle(!isElectron && utils.isMobile());\n\n        this.$widget.on('click', '.dropdown-item', e => {\n            if ($(e.target).parent(\".zoom-buttons\")) {\n                return;\n            }\n\n            this.$dropdown.dropdown('toggle');\n        });\n\n        this.$widget.find(\".global-menu-button-update-available\").append(\n            this.updateAvailableWidget.render()\n        );\n\n        this.$updateToLatestVersionButton = this.$widget.find(\".update-to-latest-version-button\");\n\n        if (!utils.isElectron()) {\n            this.$widget.find(\".zoom-container\").hide();\n        }\n\n        this.$zoomState = this.$widget.find(\".zoom-state\");\n        this.$widget.on('show.bs.dropdown', () => this.updateZoomState());\n\n        this.$widget.find(\".zoom-buttons\").on(\"click\",\n            // delay to wait for the actual zoom change\n            () => setTimeout(() => this.updateZoomState(), 300)\n        );\n\n        this.updateVersionStatus();\n\n        setInterval(() => this.updateVersionStatus(), 8 * 60 * 60 * 1000);\n    }\n\n    updateZoomState() {\n        if (!utils.isElectron()) {\n            return;\n        }\n\n        const zoomFactor = utils.dynamicRequire('electron').webFrame.getZoomFactor();\n        const zoomPercent = Math.round(zoomFactor * 100);\n\n        this.$zoomState.text(`${zoomPercent}%`);\n    }\n\n    async updateVersionStatus() {\n        await options.initializedPromise;\n\n        if (options.get(\"checkForUpdates\") !== 'true') {\n            return;\n        }\n\n        const latestVersion = await this.fetchLatestVersion();\n        this.updateAvailableWidget.updateVersionStatus(latestVersion);\n        this.$updateToLatestVersionButton.toggle(latestVersion > glob.triliumVersion);\n        this.$updateToLatestVersionButton.find(\".version-text\").text(`Version ${latestVersion} is available, click to download.`);\n    }\n\n    async fetchLatestVersion() {\n        const RELEASES_API_URL = \"https://api.github.com/repos/zadam/trilium/releases/latest\";\n\n        const resp = await fetch(RELEASES_API_URL);\n        const data = await resp.json();\n\n        return data?.tag_name?.substring(1);\n    }\n\n    downloadLatestVersionCommand() {\n        window.open(\"https://github.com/zadam/trilium/releases/latest\");\n    }\n\n    activeContextChangedEvent() {\n        this.$dropdown.dropdown('hide');\n    }\n\n    noteSwitchedEvent() {\n        this.$dropdown.dropdown('hide');\n    }\n}\n","import server from './server.js';\nimport froca from './froca.js';\n\nasync function addLabel(noteId, name, value = \"\") {\n    await server.put(`notes/${noteId}/attribute`, {\n        type: 'label',\n        name: name,\n        value: value\n    });\n}\n\nasync function setLabel(noteId, name, value = \"\") {\n    await server.put(`notes/${noteId}/set-attribute`, {\n        type: 'label',\n        name: name,\n        value: value\n    });\n}\n\nasync function removeAttributeById(noteId, attributeId) {\n    await server.remove(`notes/${noteId}/attributes/${attributeId}`);\n}\n\n/**\n * @returns {boolean} - returns true if this attribute has the potential to influence the note in the argument.\n *         That can happen in multiple ways:\n *         1. attribute is owned by the note\n *         2. attribute is owned by the template of the note\n *         3. attribute is owned by some note's ancestor and is inheritable\n */\nfunction isAffecting(attrRow, affectedNote) {\n    if (!affectedNote || !attrRow) {\n        return false;\n    }\n\n    const attrNote = froca.notes[attrRow.noteId];\n\n    if (!attrNote) {\n        // the note (owner of the attribute) is not even loaded into the cache, so it should not affect anything else\n        return false;\n    }\n\n    const owningNotes = [affectedNote, ...affectedNote.getNotesToInheritAttributesFrom()];\n\n    for (const owningNote of owningNotes) {\n        if (owningNote.noteId === attrNote.noteId) {\n            return true;\n        }\n    }\n\n    if (this.isInheritable) {\n        for (const owningNote of owningNotes) {\n            if (owningNote.hasAncestor(attrNote.noteId, true)) {\n                return true;\n            }\n        }\n    }\n\n    return false;\n}\n\nexport default {\n    addLabel,\n    setLabel,\n    removeAttributeById,\n    isAffecting\n}\n","import BasicWidget from \"./basic_widget.js\";\nimport contextMenu from \"../menus/context_menu.js\";\nimport utils from \"../services/utils.js\";\nimport keyboardActionService from \"../services/keyboard_actions.js\";\nimport appContext from \"../components/app_context.js\";\nimport froca from \"../services/froca.js\";\nimport attributeService from \"../services/attributes.js\";\n\n/*!\n * Draggabilly v2.3.0\n * Make that shiz draggable\n * https://draggabilly.desandro.com\n * MIT license\n */\n(function(e,i){e.jQueryBridget=i(e,e.jQuery)})(window,function t(e,r){\"use strict\";var s=Array.prototype.slice;var i=e.console;var f=typeof i==\"undefined\"?function(){}:function(t){i.error(t)};function n(h,o,d){d=d||r||e.jQuery;if(!d){return}if(!o.prototype.option){o.prototype.option=function(t){if(!d.isPlainObject(t)){return}this.options=d.extend(true,this.options,t)}}d.fn[h]=function(t){if(typeof t==\"string\"){var e=s.call(arguments,1);return i(this,t,e)}n(this,t);return this};function i(t,r,s){var a;var u=`$().${h}(\"${r}\")`;t.each(function(t, e){var i=d.data(e,h);if(!i){f(`${h} not initialized. Cannot call methods, i.e. ${u}`);return}var n=i[r];if(!n||r.charAt(0)==\"_\"){f(`${u} is not a valid method`);return}var o=n.apply(i,s);a=a===undefined?o:a});return a!==undefined?a:t}function n(t, n){t.each(function(t, e){var i=d.data(e,h);if(i){i.option(n);i._init()}else{i=new o(e,n);d.data(e,h,i)}})}a(d)}function a(t){if(!t||t&&t.bridget){return}t.bridget=n}a(r||e.jQuery);return n});\n(function(t,e){\"use strict\";t.getSize=e()})(window,function t(){\"use strict\";function m(t){var e=parseFloat(t);var i=t.indexOf(\"%\")==-1&&!isNaN(e);return i&&e}function e(){}var i=typeof console==\"undefined\"?e:function(t){console.error(t)};var y=[\"paddingLeft\",\"paddingRight\",\"paddingTop\",\"paddingBottom\",\"marginLeft\",\"marginRight\",\"marginTop\",\"marginBottom\",\"borderLeftWidth\",\"borderRightWidth\",\"borderTopWidth\",\"borderBottomWidth\"];var b=y.length;function E(){var t={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0};for(var e=0;e<b;e++){var i=y[e];t[i]=0}return t}function _(t){var e=getComputedStyle(t);if(!e){i(`Style returned ${e}. Are you running this code in a hidden iframe on Firefox? See http://bit.ly/getsizebug1`)}return e}var n=false;var x;function P(){if(n){return}n=true;var t=document.createElement(\"div\");t.style.width=\"200px\";t.style.padding=\"1px 2px 3px 4px\";t.style.borderStyle=\"solid\";t.style.borderWidth=\"1px 2px 3px 4px\";t.style.boxSizing=\"border-box\";var e=document.body||document.documentElement;e.appendChild(t);var i=_(t);o.isBoxSizeOuter=x=m(i.width)==200;e.removeChild(t)}function o(t){P();if(typeof t==\"string\"){t=document.querySelector(t)}if(!t||typeof t!=\"object\"||!t.nodeType){return}var e=_(t);if(e.display==\"none\"){return E()}var i={};i.width=t.offsetWidth;i.height=t.offsetHeight;var n=i.isBorderBox=e.boxSizing==\"border-box\";for(var o=0; o<b; o++){var r=y[o];var s=e[r];var a=parseFloat(s);i[r]=!isNaN(a)?a:0}var u=i.paddingLeft+i.paddingRight;var h=i.paddingTop+i.paddingBottom;var d=i.marginLeft+i.marginRight;var f=i.marginTop+i.marginBottom;var p=i.borderLeftWidth+i.borderRightWidth;var c=i.borderTopWidth+i.borderBottomWidth;var v=n&&x;var l=m(e.width);if(l!==false){i.width=l+(v?0:u+p)}var g=m(e.height);if(g!==false){i.height=g+(v?0:h+c)}i.innerWidth=i.width-(u+p);i.innerHeight=i.height-(h+c);i.outerWidth=i.width+d;i.outerHeight=i.height+f;return i}return o});(function(t, e){t.EvEmitter=e()})(typeof window!=\"undefined\"?window:this,function(){function t(){}var e=t.prototype;e.on=function(t, e){if(!t||!e){return}var i=this._events=this._events||{};var n=i[t]=i[t]||[];if(n.indexOf(e)==-1){n.push(e)}return this};e.once=function(t, e){if(!t||!e){return}this.on(t,e);var i=this._onceEvents=this._onceEvents||{};var n=i[t]=i[t]||{};n[e]=true;return this};e.off=function(t, e){var i=this._events&&this._events[t];if(!i||!i.length){return}var n=i.indexOf(e);if(n!=-1){i.splice(n,1)}return this};e.emitEvent=function(t, e){var i=this._events&&this._events[t];if(!i||!i.length){return}i=i.slice(0);e=e||[];var n=this._onceEvents&&this._onceEvents[t];for(var o=0; o<i.length; o++){var r=i[o];var s=n&&n[r];if(s){this.off(t,r);delete n[r]}r.apply(this,e)}return this};e.allOff=function(){delete this._events;delete this._onceEvents};return t});\n(function(e,i){e.Unipointer=i(e,e.EvEmitter)})(window,function t(o,e){function i(){}function n(){}var r=n.prototype=Object.create(e.prototype);r.bindStartEvent=function(t){this._bindStartEvent(t,true)};r.unbindStartEvent=function(t){this._bindStartEvent(t,false)};r._bindStartEvent=function(t,e){e=e===undefined?true:e;var i=e?\"addEventListener\":\"removeEventListener\";var n=\"mousedown\";if(o.PointerEvent){n=\"pointerdown\"}else if(\"ontouchstart\"in o){n=\"touchstart\"}t[i](n,this)};r.handleEvent=function(t){var e=`on${t.type}`;if(this[e]){this[e](t)}};r.getTouch=function(t){for(var e=0; e<t.length; e++){var i=t[e];if(i.identifier==this.pointerIdentifier){return i}}};r.onmousedown=function(t){var e=t.button;if(e&&(e!==0&&e!==1)){return}this._pointerDown(t,t)};r.ontouchstart=function(t){this._pointerDown(t,t.changedTouches[0])};r.onpointerdown=function(t){this._pointerDown(t,t)};r._pointerDown=function(t, e){if(t.button||this.isPointerDown){return}this.isPointerDown=true;this.pointerIdentifier=e.pointerId!==undefined?e.pointerId:e.identifier;this.pointerDown(t,e)};r.pointerDown=function(t, e){this._bindPostStartEvents(t);this.emitEvent(\"pointerDown\",[t,e])};var s={mousedown:[\"mousemove\",\"mouseup\"],touchstart:[\"touchmove\",\"touchend\",\"touchcancel\"],pointerdown:[\"pointermove\",\"pointerup\",\"pointercancel\"]};r._bindPostStartEvents=function(t){if(!t){return}var e=s[t.type];e.forEach(function(t){o.addEventListener(t,this)},this);this._boundPointerEvents=e};r._unbindPostStartEvents=function(){if(!this._boundPointerEvents){return}this._boundPointerEvents.forEach(function(t){o.removeEventListener(t,this)},this);delete this._boundPointerEvents};r.onmousemove=function(t){this._pointerMove(t,t)};r.onpointermove=function(t){if(t.pointerId==this.pointerIdentifier){this._pointerMove(t,t)}};r.ontouchmove=function(t){var e=this.getTouch(t.changedTouches);if(e){this._pointerMove(t,e)}};r._pointerMove=function(t, e){this.pointerMove(t,e)};r.pointerMove=function(t, e){this.emitEvent(\"pointerMove\",[t,e])};r.onmouseup=function(t){this._pointerUp(t,t)};r.onpointerup=function(t){if(t.pointerId==this.pointerIdentifier){this._pointerUp(t,t)}};r.ontouchend=function(t){var e=this.getTouch(t.changedTouches);if(e){this._pointerUp(t,e)}};r._pointerUp=function(t, e){this._pointerDone();this.pointerUp(t,e)};r.pointerUp=function(t, e){this.emitEvent(\"pointerUp\",[t,e])};r._pointerDone=function(){this._pointerReset();this._unbindPostStartEvents();this.pointerDone()};r._pointerReset=function(){this.isPointerDown=false;delete this.pointerIdentifier};r.pointerDone=i;r.onpointercancel=function(t){if(t.pointerId==this.pointerIdentifier){this._pointerCancel(t,t)}};r.ontouchcancel=function(t){var e=this.getTouch(t.changedTouches);if(e){this._pointerCancel(t,e)}};r._pointerCancel=function(t, e){this._pointerDone();this.pointerCancel(t,e)};r.pointerCancel=function(t, e){this.emitEvent(\"pointerCancel\",[t,e])};n.getPointerPoint=function(t){return{x:t.pageX,y:t.pageY}};return n});\n(function(e,i){e.Unidragger=i(e,e.Unipointer)})(window,function t(r,e){function i(){}var n=i.prototype=Object.create(e.prototype);n.bindHandles=function(){this._bindHandles(true)};n.unbindHandles=function(){this._bindHandles(false)};n._bindHandles=function(t){t=t===undefined?true:t;var e=t?\"addEventListener\":\"removeEventListener\";var i=t?this._touchActionValue:\"\";for(var n=0;n<this.handles.length;n++){var o=this.handles[n];this._bindStartEvent(o,t);o[e](\"click\",this);if(r.PointerEvent){o.style.touchAction=i}}};n._touchActionValue=\"none\";n.pointerDown=function(t,e){var i=this.okayPointerDown(t);if(!i){return}this.pointerDownPointer=e;t.preventDefault();this.pointerDownBlur();this._bindPostStartEvents(t);this.emitEvent(\"pointerDown\",[t,e])};var o={TEXTAREA:true,INPUT:true,SELECT:true,OPTION:true};var s={radio:true,checkbox:true,button:true,submit:true,image:true,file:true};n.okayPointerDown=function(t){var e=o[t.target.nodeName];var i=s[t.target.type];var n=!e||i;if(!n){this._pointerReset()}return n};n.pointerDownBlur=function(){var t=document.activeElement;var e=t&&t.blur&&t!=document.body;if(e){t.blur()}};n.pointerMove=function(t,e){var i=this._dragPointerMove(t,e);this.emitEvent(\"pointerMove\",[t,e,i]);this._dragMove(t,e,i)};n._dragPointerMove=function(t,e){var i={x:e.pageX-this.pointerDownPointer.pageX,y:e.pageY-this.pointerDownPointer.pageY};if(!this.isDragging&&this.hasDragStarted(i)){this._dragStart(t,e)}return i};n.hasDragStarted=function(t){return Math.abs(t.x)>3||Math.abs(t.y)>3};n.pointerUp=function(t,e){this.emitEvent(\"pointerUp\",[t,e]);this._dragPointerUp(t,e)};n._dragPointerUp=function(t,e){if(this.isDragging){this._dragEnd(t,e)}else{this._staticClick(t,e)}};n._dragStart=function(t,e){this.isDragging=true;this.isPreventingClicks=true;this.dragStart(t,e)};n.dragStart=function(t,e){this.emitEvent(\"dragStart\",[t,e])};n._dragMove=function(t,e,i){if(!this.isDragging){return}this.dragMove(t,e,i)};n.dragMove=function(t,e,i){t.preventDefault();this.emitEvent(\"dragMove\",[t,e,i])};n._dragEnd=function(t,e){this.isDragging=false;setTimeout(function(){delete this.isPreventingClicks}.bind(this));this.dragEnd(t,e)};n.dragEnd=function(t,e){this.emitEvent(\"dragEnd\",[t,e])};n.onclick=function(t){if(this.isPreventingClicks){t.preventDefault()}};n._staticClick=function(t,e){if(this.isIgnoringMouseUp&&t.type==\"mouseup\"){return}this.staticClick(t,e);if(t.type!=\"mouseup\"){this.isIgnoringMouseUp=true;setTimeout(function(){delete this.isIgnoringMouseUp}.bind(this),400)}};n.staticClick=function(t,e){this.emitEvent(\"staticClick\",[t,e])};i.getPointerPoint=e.getPointerPoint;return i});\n(function(i,n){i.Draggabilly=n(i,i.getSize,i.Unidragger)})(window,function t(r,u,e){function i(t,e){for(var i in e){t[i]=e[i]}return t}function n(){}var o=r.jQuery;function s(t,e){this.element=typeof t==\"string\"?document.querySelector(t):t;if(o){this.$element=o(this.element)}this.options=i({},this.constructor.defaults);this.option(e);this._create()}var a=s.prototype=Object.create(e.prototype);s.defaults={};a.option=function(t){i(this.options,t)};var h={relative:true,absolute:true,fixed:true};a._create=function(){this.position={};this._getPosition();this.startPoint={x:0,y:0};this.dragPoint={x:0,y:0};this.startPosition=i({},this.position);var t=getComputedStyle(this.element);if(!h[t.position]){this.element.style.position=\"relative\"}this.on(\"pointerMove\",this.onPointerMove);this.on(\"pointerUp\",this.onPointerUp);this.enable();this.setHandles()};a.setHandles=function(){this.handles=this.options.handle?this.element.querySelectorAll(this.options.handle):[this.element];this.bindHandles()};a.dispatchEvent=function(t,e,i){var n=[e].concat(i);this.emitEvent(t,n);this.dispatchJQueryEvent(t,e,i)};a.dispatchJQueryEvent=function(t,e,i){var n=r.jQuery;if(!n||!this.$element){return}var o=n.Event(e);o.type=t;this.$element.trigger(o,i)};a._getPosition=function(){var t=getComputedStyle(this.element);var e=this._getPositionCoord(t.left,\"width\");var i=this._getPositionCoord(t.top,\"height\");this.position.x=isNaN(e)?0:e;this.position.y=isNaN(i)?0:i;this._addTransformPosition(t)};a._getPositionCoord=function(t,e){if(t.indexOf(\"%\")!=-1){var i=u(this.element.parentNode);return!i?0:parseFloat(t)/100*i[e]}return parseInt(t,10)};a._addTransformPosition=function(t){var e=t.transform;if(e.indexOf(\"matrix\")!==0){return}var i=e.split(\",\");var n=e.indexOf(\"matrix3d\")===0?12:4;var o=parseInt(i[n],10);var r=parseInt(i[n+1],10);this.position.x+=o;this.position.y+=r};a.onPointerDown=function(t,e){this.element.classList.add(\"is-pointer-down\");this.dispatchJQueryEvent(\"pointerDown\",t,[e])};a.pointerDown=function(t,e){var i=this.okayPointerDown(t);if(!i||!this.isEnabled){this._pointerReset();return}this.pointerDownPointer={pageX:e.pageX,pageY:e.pageY};t.preventDefault();this.pointerDownBlur();this._bindPostStartEvents(t);this.element.classList.add(\"is-pointer-down\");this.dispatchEvent(\"pointerDown\",t,[e])};a.dragStart=function(t,e){if(!this.isEnabled){return}this._getPosition();this.measureContainment();this.startPosition.x=this.position.x;this.startPosition.y=this.position.y;this.setLeftTop();this.dragPoint.x=0;this.dragPoint.y=0;this.element.classList.add(\"is-dragging\");this.dispatchEvent(\"dragStart\",t,[e]);this.animate()};a.measureContainment=function(){var t=this.getContainer();if(!t){return}var e=u(this.element);var i=u(t);var n=this.element.getBoundingClientRect();var o=t.getBoundingClientRect();var r=i.borderLeftWidth+i.borderRightWidth;var s=i.borderTopWidth+i.borderBottomWidth;var a=this.relativeStartPosition={x:n.left-(o.left+i.borderLeftWidth),y:n.top-(o.top+i.borderTopWidth)};this.containSize={width:i.width-r-a.x-e.width,height:i.height-s-a.y-e.height}};a.getContainer=function(){var t=this.options.containment;if(!t){return}var e=t instanceof HTMLElement;if(e){return t}if(typeof t==\"string\"){return document.querySelector(t)}return this.element.parentNode};a.onPointerMove=function(t,e,i){this.dispatchJQueryEvent(\"pointerMove\",t,[e,i])};a.dragMove=function(t,e,i){if(!this.isEnabled){return}var n=i.x;var o=i.y;var r=this.options.grid;var s=r&&r[0];var a=r&&r[1];n=d(n,s);o=d(o,a);n=this.containDrag(\"x\",n,s);o=this.containDrag(\"y\",o,a);n=this.options.axis==\"y\"?0:n;o=this.options.axis==\"x\"?0:o;this.position.x=this.startPosition.x+n;this.position.y=this.startPosition.y+o;this.dragPoint.x=n;this.dragPoint.y=o;this.dispatchEvent(\"dragMove\",t,[e,i])};function d(t,e,i){i=i||\"round\";return e?Math[i](t/e)*e:t}a.containDrag=function(t,e,i){if(!this.options.containment){return e}var n=t==\"x\"?\"width\":\"height\";var o=this.relativeStartPosition[t];var r=d(-o,i,\"ceil\");var s=this.containSize[n];s=d(s,i,\"floor\");return Math.max(r,Math.min(s,e))};a.onPointerUp=function(t,e){this.element.classList.remove(\"is-pointer-down\");this.dispatchJQueryEvent(\"pointerUp\",t,[e])};a.dragEnd=function(t,e){if(!this.isEnabled){return}this.element.style.transform=\"\";this.setLeftTop();this.element.classList.remove(\"is-dragging\");this.dispatchEvent(\"dragEnd\",t,[e])};a.animate=function(){if(!this.isDragging){return}this.positionDrag();var e=this;requestAnimationFrame(function t(){e.animate()})};a.setLeftTop=function(){this.element.style.left=`${this.position.x}px`;this.element.style.top=`${this.position.y}px`};a.positionDrag=function(){this.element.style.transform=`translate3d( ${this.dragPoint.x}px, ${this.dragPoint.y}px, 0)`};a.staticClick=function(t, e){this.dispatchEvent(\"staticClick\",t,[e])};a.setPosition=function(t, e){this.position.x=t;this.position.y=e;this.setLeftTop()};a.enable=function(){this.isEnabled=true};a.disable=function(){this.isEnabled=false;if(this.isDragging){this.dragEnd()}};a.destroy=function(){this.disable();this.element.style.transform=\"\";this.element.style.left=\"\";this.element.style.top=\"\";this.element.style.position=\"\";this.unbindHandles();if(this.$element){this.$element.removeData(\"draggabilly\")}};a._init=n;if(o&&o.bridget){o.bridget(\"draggabilly\",s)}return s});\n\nconst Draggabilly = window.Draggabilly;\n\nconst TAB_CONTAINER_MIN_WIDTH = 24;\nconst TAB_CONTAINER_MAX_WIDTH = 240;\nconst TAB_CONTAINER_LEFT_PADDING = 5;\nconst NEW_TAB_WIDTH = 32;\nconst MIN_FILLER_WIDTH = 50;\nconst MARGIN_WIDTH = 5;\n\nconst TAB_SIZE_SMALL = 84;\nconst TAB_SIZE_SMALLER = 60;\nconst TAB_SIZE_MINI = 48;\n\nconst TAB_TPL = `\n<div class=\"note-tab\">\n  <div class=\"note-tab-wrapper\">\n    <div class=\"note-tab-drag-handle\"></div>\n    <div class=\"note-tab-icon\"></div>\n    <div class=\"note-tab-title\"></div>\n    <div class=\"note-tab-close bx bx-x\" title=\"关闭标签\" data-trigger-command=\"closeActiveTab\"></div>\n  </div>\n</div>`;\n\nconst NEW_TAB_BUTTON_TPL = `<div class=\"note-new-tab\" data-trigger-command=\"openNewTab\" title=\"添加新标签\">+</div>`;\nconst FILLER_TPL = `<div class=\"tab-row-filler\"></div>`;\n\nconst TAB_ROW_TPL = `\n<div class=\"tab-row-widget\">\n    <style>\n    .tab-row-widget {\n        box-sizing: border-box;\n        position: relative;\n        width: 100%;\n        background: var(--main-background-color);\n        overflow: hidden;\n    }\n    \n    .tab-row-widget * {\n        box-sizing: inherit;\n        font: inherit;\n    }\n    \n    .tab-row-widget .tab-row-widget-container {\n        box-sizing: border-box;\n        position: relative;\n        width: 100%;\n        height: 100%;\n    }\n    \n    .tab-row-widget .note-tab {\n        position: absolute;\n        left: 0;\n        width: 240px;\n        border: 0;\n        margin: 0;\n        z-index: 1;\n        pointer-events: none;\n    }\n    \n    .note-new-tab {\n        position: absolute;\n        left: 0;\n        width: 36px;\n        height: 36px;\n        padding: 1px;\n        border: 0;\n        margin: 0;\n        z-index: 1;\n        text-align: center;\n        font-size: 24px;\n        cursor: pointer;\n        box-sizing: border-box;\n    }\n    \n    .note-new-tab:hover {\n        background-color: var(--accented-background-color);\n        border-radius: var(--button-border-radius);\n    }\n    \n    .tab-row-filler {\n        box-sizing: border-box;\n        -webkit-app-region: drag;\n        position: absolute;\n        left: 0;\n        height: 100%;\n    }\n        \n    .tab-row-widget .note-tab[active] {\n        z-index: 5;\n    }\n    \n    .tab-row-widget .note-tab,\n    .tab-row-widget .note-tab * {\n        user-select: none;\n        cursor: default;\n    }\n    \n    .tab-row-widget .note-tab.note-tab-was-just-added {\n        top: 10px;\n        animation: note-tab-was-just-added 120ms forwards ease-in-out;\n    }\n    \n    .tab-row-widget .note-tab .note-tab-wrapper {\n        position: absolute;\n        display: flex;\n        align-items: center;\n        top: 0;\n        bottom: 0;\n        left: 0;\n        right: 0;\n        height: 36px;\n        padding: 7px 5px 7px 11px;\n        border-radius: 8px;\n        overflow: hidden;\n        pointer-events: all;\n        color: var(--inactive-tab-text-color);\n        background-color: var(--inactive-tab-background-color);\n    }\n    \n    .tab-row-widget .note-tab[active] .note-tab-wrapper {\n        font-weight: bold;\n        color: var(--active-tab-text-color);\n        background-color : var(--active-tab-background-color);\n    }\n    \n    .tab-row-widget .note-tab[is-mini] .note-tab-wrapper {\n        padding-left: 2px;\n        padding-right: 2px;\n    }\n    \n    .tab-row-widget .note-tab .note-tab-title {\n        flex: 1;\n        vertical-align: top;\n        overflow: hidden;\n        white-space: nowrap;\n    }\n    \n    .tab-row-widget .note-tab .note-tab-icon {\n        position: relative;\n        top: -1px;\n        padding-right: 3px;\n    }\n    \n    .tab-row-widget .note-tab[is-small] .note-tab-title {\n        margin-left: 0;\n    }\n    \n    .tab-row-widget .note-tab .note-tab-drag-handle {\n        position: absolute;\n        top: 0;\n        bottom: 0;\n        right: 0;\n        left: 0;\n    }\n    \n    .tab-row-widget .note-tab .note-tab-close {\n        flex: 0 0 22px;\n        border-radius: 50%;\n        z-index: 100;\n        width: 22px;\n        height: 22px;\n        cursor: pointer;\n        text-align: center;\n    }\n    \n    .tab-row-widget .note-tab:hover .note-tab-wrapper {\n        background-color: var(--inactive-tab-hover-background-color);\n    }\n    \n    .tab-row-widget .note-tab[active]:hover .note-tab-wrapper {\n        background-color: var(--active-tab-hover-background-color);\n    }\n    \n    .tab-row-widget .note-tab .note-tab-close:hover {\n        background-color: var(--hover-item-background-color);\n        color: var(--hover-item-text-color);\n    }\n    \n    .tab-row-widget .note-tab[is-smaller] .note-tab-close {\n        margin-left: auto;\n    }\n    .tab-row-widget .note-tab[is-mini]:not([active]) .note-tab-close {\n        display: none;\n    }\n    .tab-row-widget .note-tab[is-mini][active] .note-tab-close {\n        margin-left: auto;\n        margin-right: auto;\n    }\n    @-moz-keyframes note-tab-was-just-added {\n        to {\n            top: 0;\n        }\n    }\n    @-webkit-keyframes note-tab-was-just-added {\n        to {\n            top: 0;\n        }\n    }\n    @-o-keyframes note-tab-was-just-added {\n        to {\n            top: 0;\n        }\n    }\n    @keyframes note-tab-was-just-added {\n        to {\n            top: 0;\n        }\n    }\n    .tab-row-widget.tab-row-widget-is-sorting .note-tab:not(.note-tab-is-dragging),\n    .tab-row-widget:not(.tab-row-widget-is-sorting) .note-tab.note-tab-was-just-dragged {\n        transition: transform 120ms ease-in-out;\n    }\n    </style>\n\n    <div class=\"tab-row-widget-container\"></div>\n</div>`;\n\nexport default class TabRowWidget extends BasicWidget {\n    doRender() {\n        this.$widget = $(TAB_ROW_TPL);\n\n        this.draggabillies = [];\n\n        this.setupStyle();\n        this.setupEvents();\n        this.setupDraggabilly();\n        this.setupNewButton();\n        this.setupFiller();\n        this.layoutTabs();\n        this.setVisibility();\n\n        this.$widget.on('contextmenu', '.note-tab', e => {\n            e.preventDefault();\n\n            const ntxId = $(e.target).closest(\".note-tab\").attr('data-ntx-id');\n\n            contextMenu.show({\n                x: e.pageX,\n                y: e.pageY,\n                items: [\n                    {title: \"关闭\", command: \"closeTab\", uiIcon: \"bx bx-x\"},\n                    {title: \"关闭其它标签页\", command: \"closeOtherTabs\", uiIcon: \"bx bx-x\"},\n                    {title: \"关闭所有标签页\", command: \"closeAllTabs\", uiIcon: \"bx bx-x\"},\n                    {title: \"把标签页移动到新窗口\", command: \"moveTabToNewWindow\", uiIcon: \"bx bx-window-open\"}\n                ],\n                selectMenuItemHandler: ({command}) => {\n                    this.triggerCommand(command, {ntxId});\n                }\n            });\n        });\n    }\n\n    setupStyle() {\n        this.$style = $(\"<style>\");\n        this.$widget.append(this.$style);\n    }\n\n    setupEvents() {\n        const resizeListener = _ => {\n            this.cleanUpPreviouslyDraggedTabs();\n            this.layoutTabs();\n        };\n\n        new ResizeObserver(resizeListener).observe(this.$widget[0]);\n\n        this.tabEls.forEach((tabEl) => this.setTabCloseEvent(tabEl));\n    }\n\n    setVisibility() {\n        this.$widget.show();\n    }\n\n    get tabEls() {\n        return Array.prototype.slice.call(this.$widget.find('.note-tab'));\n    }\n\n    get $tabContainer() {\n        return this.$widget.find('.tab-row-widget-container');\n    }\n\n    get tabWidths() {\n        const numberOfTabs = this.tabEls.length;\n        const tabsContainerWidth = this.$tabContainer[0].clientWidth - NEW_TAB_WIDTH - MIN_FILLER_WIDTH;\n        const marginWidth = (numberOfTabs - 1) * MARGIN_WIDTH;\n        const targetWidth = (tabsContainerWidth - marginWidth) / numberOfTabs;\n        const clampedTargetWidth = Math.max(TAB_CONTAINER_MIN_WIDTH, Math.min(TAB_CONTAINER_MAX_WIDTH, targetWidth));\n        const flooredClampedTargetWidth = Math.floor(clampedTargetWidth);\n        const totalTabsWidthUsingTarget = flooredClampedTargetWidth * numberOfTabs + marginWidth;\n        const totalExtraWidthDueToFlooring = tabsContainerWidth - totalTabsWidthUsingTarget;\n\n        const widths = [];\n        let extraWidthRemaining = totalExtraWidthDueToFlooring;\n\n        for (let i = 0; i < numberOfTabs; i += 1) {\n            const extraWidth = flooredClampedTargetWidth < TAB_CONTAINER_MAX_WIDTH && extraWidthRemaining > 0 ? 1 : 0;\n\n            widths.push(flooredClampedTargetWidth + extraWidth);\n\n            if (extraWidthRemaining > 0) {\n                extraWidthRemaining -= 1;\n            }\n        }\n\n        if (this.$filler) {\n            this.$filler.css(\"width\", `${extraWidthRemaining + MIN_FILLER_WIDTH}px`);\n        }\n\n        return widths;\n    }\n\n    getTabPositions() {\n        const tabPositions = [];\n\n        let position = TAB_CONTAINER_LEFT_PADDING;\n        this.tabWidths.forEach(width => {\n            tabPositions.push(position);\n            position += width + MARGIN_WIDTH;\n        });\n\n        position -= MARGIN_WIDTH; // the last margin should not be applied\n\n        const newTabPosition = position;\n        const fillerPosition = position + 32;\n\n        return {tabPositions, newTabPosition, fillerPosition};\n    }\n\n    layoutTabs() {\n        const tabContainerWidths = this.tabWidths;\n\n        this.tabEls.forEach((tabEl, i) => {\n            const width = tabContainerWidths[i];\n\n            tabEl.style.width = `${width}px`;\n            tabEl.removeAttribute('is-small');\n            tabEl.removeAttribute('is-smaller');\n            tabEl.removeAttribute('is-mini');\n\n            if (width < TAB_SIZE_SMALL) tabEl.setAttribute('is-small', '');\n            if (width < TAB_SIZE_SMALLER) tabEl.setAttribute('is-smaller', '');\n            if (width < TAB_SIZE_MINI) tabEl.setAttribute('is-mini', '');\n        });\n\n        let styleHTML = '';\n\n        const {tabPositions, newTabPosition, fillerPosition} = this.getTabPositions();\n\n        tabPositions.forEach((position, i) => {\n            styleHTML += `.note-tab:nth-child(${ i + 1 }) { transform: translate3d(${ position }px, 0, 0)} `;\n        });\n\n        styleHTML += `.note-new-tab { transform: translate3d(${ newTabPosition }px, 0, 0) } `;\n        styleHTML += `.tab-row-filler { transform: translate3d(${ fillerPosition }px, 0, 0) } `;\n\n        this.$style.html(styleHTML);\n    }\n\n    addTab(ntxId) {\n        const $tab = $(TAB_TPL).attr('data-ntx-id', ntxId);\n\n        keyboardActionService.updateDisplayedShortcuts($tab);\n\n        $tab.addClass('note-tab-was-just-added');\n\n        setTimeout(() => $tab.removeClass('note-tab-was-just-added'), 500);\n\n        this.$newTab.before($tab);\n        this.setVisibility();\n        this.setTabCloseEvent($tab);\n        this.updateTitle($tab, '新标签页');\n        this.cleanUpPreviouslyDraggedTabs();\n        this.layoutTabs();\n        this.setupDraggabilly();\n    }\n\n    closeActiveTabCommand({$el}) {\n        const ntxId = $el.closest(\".note-tab\").attr('data-ntx-id');\n\n        appContext.tabManager.removeNoteContext(ntxId);\n    }\n\n    setTabCloseEvent($tab) {\n        $tab.on('mousedown', e => {\n            if (e.which === 2) {\n                appContext.tabManager.removeNoteContext($tab.attr('data-ntx-id'));\n\n                return true; // event has been handled\n            }\n        });\n    }\n\n    get activeTabEl() {\n        return this.$widget.find('.note-tab[active]')[0];\n    }\n\n    activeContextChangedEvent() {\n        let activeNoteContext = appContext.tabManager.getActiveContext();\n\n        if (!activeNoteContext) {\n            return;\n        }\n\n        if (activeNoteContext.mainNtxId) {\n            activeNoteContext = appContext.tabManager.getNoteContextById(activeNoteContext.mainNtxId);\n        }\n\n        const tabEl = this.getTabById(activeNoteContext.ntxId)[0];\n        const activeTabEl = this.activeTabEl;\n        if (activeTabEl === tabEl) return;\n        if (activeTabEl) activeTabEl.removeAttribute('active');\n        if (tabEl) tabEl.setAttribute('active', '');\n    }\n\n    newNoteContextCreatedEvent({noteContext}) {\n        if (!noteContext.mainNtxId) {\n            this.addTab(noteContext.ntxId);\n        }\n    }\n\n    removeTab(ntxId) {\n        const tabEl = this.getTabById(ntxId)[0];\n\n        if (tabEl) {\n            tabEl.parentNode.removeChild(tabEl);\n            this.cleanUpPreviouslyDraggedTabs();\n            this.layoutTabs();\n            this.setupDraggabilly();\n            this.setVisibility();\n        }\n    }\n\n    getNtxIdsInOrder() {\n        return this.tabEls.map(el => el.getAttribute('data-ntx-id'));\n    }\n\n    updateTitle($tab, title) {\n        $tab.attr(\"title\", title)\n        $tab.find('.note-tab-title')\n            .text(title);\n    }\n\n    getTabById(ntxId) {\n        return this.$widget.find(`[data-ntx-id='${ntxId}']`);\n    }\n\n    getTabId($tab) {\n        return $tab.attr('data-ntx-id');\n    }\n\n    noteContextRemovedEvent({ntxIds}) {\n        for (const ntxId of ntxIds) {\n            this.removeTab(ntxId);\n        }\n    }\n\n    cleanUpPreviouslyDraggedTabs() {\n        this.tabEls.forEach((tabEl) => tabEl.classList.remove('note-tab-was-just-dragged'));\n    }\n\n    setupDraggabilly() {\n        const tabEls = this.tabEls;\n        const {tabPositions} = this.getTabPositions();\n\n        if (this.isDragging) {\n            this.isDragging = false;\n            this.$widget.removeClass('tab-row-widget-is-sorting');\n            this.draggabillyDragging.element.classList.remove('note-tab-is-dragging');\n            this.draggabillyDragging.element.style.transform = '';\n            this.draggabillyDragging.dragEnd();\n            this.draggabillyDragging.isDragging = false;\n            this.draggabillyDragging.positionDrag = _ => {}; // Prevent Draggabilly from updating tabEl.style.transform in later frames\n            this.draggabillyDragging.destroy();\n            this.draggabillyDragging = null;\n        }\n\n        this.draggabillies.forEach(d => d.destroy());\n\n        tabEls.forEach((tabEl, originalIndex) => {\n            const originalTabPositionX = tabPositions[originalIndex];\n            const draggabilly = new Draggabilly(tabEl, {\n                axis: 'x',\n                handle: '.note-tab-drag-handle',\n                containment: this.$tabContainer[0]\n            });\n\n            this.draggabillies.push(draggabilly);\n\n            draggabilly.on('pointerDown', _ => {\n                appContext.tabManager.activateNoteContext(tabEl.getAttribute('data-ntx-id'));\n            });\n\n            draggabilly.on('dragStart', _ => {\n                this.isDragging = true;\n                this.draggabillyDragging = draggabilly;\n                tabEl.classList.add('note-tab-is-dragging');\n                this.$widget.addClass('tab-row-widget-is-sorting');\n            });\n\n            draggabilly.on('dragEnd', _ => {\n                this.isDragging = false;\n                const finalTranslateX = parseFloat(tabEl.style.left);\n                tabEl.style.transform = `translate3d(0, 0, 0)`;\n\n                // Animate dragged tab back into its place\n                requestAnimationFrame(_ => {\n                    tabEl.style.left = '0';\n                    tabEl.style.transform = `translate3d(${ finalTranslateX }px, 0, 0)`;\n\n                    requestAnimationFrame(_ => {\n                        tabEl.classList.remove('note-tab-is-dragging');\n                        this.$widget.removeClass('tab-row-widget-is-sorting');\n\n                        tabEl.classList.add('note-tab-was-just-dragged');\n\n                        requestAnimationFrame(_ => {\n                            tabEl.style.transform = '';\n\n                            this.layoutTabs();\n                            this.setupDraggabilly();\n                        })\n                    })\n                })\n            });\n\n            draggabilly.on('dragMove', (event, pointer, moveVector) => {\n                // The current index be computed within the event since it can change during the dragMove\n                const tabEls = this.tabEls;\n                const currentIndex = tabEls.indexOf(tabEl);\n\n                const currentTabPositionX = originalTabPositionX + moveVector.x;\n                const destinationIndexTarget = this.closest(currentTabPositionX, tabPositions);\n                const destinationIndex = Math.max(0, Math.min(tabEls.length, destinationIndexTarget));\n\n                if (currentIndex !== destinationIndex) {\n                    this.animateTabMove(tabEl, currentIndex, destinationIndex);\n                }\n\n                if (Math.abs(moveVector.y) > 100) {\n                    this.triggerCommand('moveTabToNewWindow', {ntxId: this.getTabId($(tabEl))});\n                }\n            });\n        });\n    }\n\n    animateTabMove(tabEl, originIndex, destinationIndex) {\n        if (destinationIndex < originIndex) {\n            tabEl.parentNode.insertBefore(tabEl, this.tabEls[destinationIndex]);\n        } else {\n            const beforeEl = this.tabEls[destinationIndex + 1] || this.$newTab[0];\n\n            tabEl.parentNode.insertBefore(tabEl, beforeEl);\n        }\n        this.triggerEvent('tabReorder', {ntxIdsInOrder: this.getNtxIdsInOrder()});\n        this.layoutTabs();\n    }\n\n    setupNewButton() {\n        this.$newTab = $(NEW_TAB_BUTTON_TPL);\n\n        this.$tabContainer.append(this.$newTab);\n    }\n\n    setupFiller() {\n        this.$filler = $(FILLER_TPL);\n\n        this.$tabContainer.append(this.$filler);\n    }\n\n    closest(value, array) {\n        let closest = Infinity;\n        let closestIndex = -1;\n\n        array.forEach((v, i) => {\n            if (Math.abs(value - v) < closest) {\n                closest = Math.abs(value - v);\n                closestIndex = i;\n            }\n        });\n\n        return closestIndex;\n    };\n\n    noteSwitchedAndActivatedEvent({noteContext}) {\n        this.activeContextChangedEvent();\n\n        this.updateTabById(noteContext.mainNtxId || noteContext.ntxId);\n    }\n\n    noteSwitchedEvent({noteContext}) {\n        this.updateTabById(noteContext.mainNtxId || noteContext.ntxId);\n    }\n\n    noteContextReorderEvent({oldMainNtxId, newMainNtxId}) {\n        if (!oldMainNtxId || !newMainNtxId) {\n            // no need to update tab row\n            return;\n        }\n\n        // update tab id for the new main context\n        this.getTabById(oldMainNtxId).attr(\"data-ntx-id\", newMainNtxId);\n        this.updateTabById(newMainNtxId);\n    }\n\n    contextsReopenedEvent({mainNtxId, tabPosition}) {\n        if (mainNtxId === undefined || tabPosition === undefined) {\n            // no tab reopened\n            return;\n        }\n        const tabEl = this.getTabById(mainNtxId)[0];\n        tabEl.parentNode.insertBefore(tabEl, this.tabEls[tabPosition]);\n    }\n\n    updateTabById(ntxId) {\n        const $tab = this.getTabById(ntxId);\n\n        const noteContext = appContext.tabManager.getNoteContextById(ntxId);\n\n        this.updateTab($tab, noteContext);\n    }\n\n    /**\n     * @param {jQuery} $tab\n     * @param {NoteContext} noteContext\n     */\n    async updateTab($tab, noteContext) {\n        if (!$tab.length) {\n            return;\n        }\n\n        for (const clazz of Array.from($tab[0].classList)) { // create copy to safely iterate over while removing classes\n            if (clazz !== 'note-tab') {\n                $tab.removeClass(clazz);\n            }\n        }\n\n        if (noteContext) {\n            const hoistedNote = froca.getNoteFromCache(noteContext.hoistedNoteId);\n\n            if (hoistedNote) {\n                $tab.find('.note-tab-icon')\n                    .removeClass()\n                    .addClass(\"note-tab-icon\")\n                    .addClass(hoistedNote.getWorkspaceIconClass());\n\n                $tab.find('.note-tab-wrapper').css(\"background\", hoistedNote.getWorkspaceTabBackgroundColor());\n            }\n            else {\n                $tab.find('.note-tab-wrapper').removeAttr(\"style\");\n            }\n        }\n\n        const {note} = noteContext;\n\n        if (!note) {\n            this.updateTitle($tab, '新标签页');\n            return;\n        }\n\n        const title = await noteContext.getNavigationTitle();\n        this.updateTitle($tab, title);\n\n        $tab.addClass(note.getCssClass());\n        $tab.addClass(utils.getNoteTypeClass(note.type));\n        $tab.addClass(utils.getMimeTypeClass(note.mime));\n    }\n\n    async entitiesReloadedEvent({loadResults}) {\n        for (const noteContext of appContext.tabManager.noteContexts) {\n            if (!noteContext.noteId) {\n                continue;\n            }\n\n            if (loadResults.isNoteReloaded(noteContext.noteId) ||\n                loadResults.getAttributeRows().find(attr =>\n                    ['workspace', 'workspaceIconClass', 'workspaceTabBackgroundColor'].includes(attr.name)\n                    && attributeService.isAffecting(attr, noteContext.note))\n            ) {\n                const $tab = this.getTabById(noteContext.ntxId);\n\n                this.updateTab($tab, noteContext);\n            }\n        }\n    }\n\n    frocaReloadedEvent() {\n        for (const noteContext of appContext.tabManager.noteContexts) {\n            const $tab = this.getTabById(noteContext.ntxId);\n\n            this.updateTab($tab, noteContext);\n        }\n    }\n\n    hoistedNoteChangedEvent({ntxId}) {\n        const $tab = this.getTabById(ntxId);\n\n        if ($tab) {\n            const noteContext = appContext.tabManager.getNoteContextById(ntxId);\n\n            this.updateTab($tab, noteContext);\n        }\n    }\n}\n","import BasicWidget from \"./basic_widget.js\";\nimport options from \"../services/options.js\";\nimport utils from \"../services/utils.js\";\n\nconst TPL = `\n<div class=\"title-bar-buttons\">\n    <style>\n    .title-bar-buttons {\n        flex-shrink: 0;\n    }\n\n    .title-bar-buttons div button {\n        border: none !important;\n        border-radius: 0;\n        background: none !important;\n        font-size: 150%;\n        height: 40px;\n        width: 40px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n    }\n    \n    .title-bar-buttons div:hover button {\n        background-color: var(--accented-background-color) !important;\n    }\n\n    .title-bar-buttons div {\n        display: inline-block;\n        height: 40px;\n        width: 40px;\n    }\n    .title-bar-buttons .top-btn.active{\n        background-color:var(--accented-background-color);\n    }\n    </style>\n\n    <!-- divs act as a hitbox for the buttons, making them clickable on corners -->\n    <div class=\"top-btn\" title=\"保持此窗口置顶. \"><button class=\"btn bx bx-pin\"></button></div>\n    <div class=\"minimize-btn\"><button class=\"btn bx bx-minus\"></button></div>\n    <div class=\"maximize-btn\"><button class=\"btn bx bx-checkbox\"></button></div>\n    <div class=\"close-btn\"><button class=\"btn bx bx-x\"></button></div>\n</div>`;\n\nexport default class TitleBarButtonsWidget extends BasicWidget {\n    doRender() {\n        if (!utils.isElectron() || options.is('nativeTitleBarVisible')) {\n            return this.$widget = $('<div>');\n        }\n\n        this.$widget = $(TPL);\n        this.contentSized();\n\n        const $topBtn = this.$widget.find(\".top-btn\");\n        const $minimizeBtn = this.$widget.find(\".minimize-btn\");\n        const $maximizeBtn = this.$widget.find(\".maximize-btn\");\n        const $closeBtn = this.$widget.find(\".close-btn\");\n\n        // When the window is restarted, the window will not be reset when it is set to the top,\n        // so get the window status and set the icon background\n        setTimeout(() => {\n            const remote = utils.dynamicRequire('@electron/remote');\n            if (remote.BrowserWindow.getFocusedWindow()?.isAlwaysOnTop()) {\n                $topBtn.addClass('active');\n            }\n        }, 1000);\n\n        $topBtn.on('click', () => {\n            $topBtn.trigger('blur');\n            const remote = utils.dynamicRequire('@electron/remote');\n            const focusedWindow = remote.BrowserWindow.getFocusedWindow();\n            const isAlwaysOnTop = focusedWindow.isAlwaysOnTop()\n            if (isAlwaysOnTop) {\n                focusedWindow.setAlwaysOnTop(false)\n                $topBtn.removeClass('active');\n            } else {\n                focusedWindow.setAlwaysOnTop(true);\n                $topBtn.addClass('active');\n            }\n        });\n\n        $minimizeBtn.on('click', () => {\n            $minimizeBtn.trigger('blur');\n            const remote = utils.dynamicRequire('@electron/remote');\n            remote.BrowserWindow.getFocusedWindow().minimize();\n        });\n\n        $maximizeBtn.on('click', () => {\n            $maximizeBtn.trigger('blur');\n            const remote = utils.dynamicRequire('@electron/remote');\n            const focusedWindow = remote.BrowserWindow.getFocusedWindow();\n\n            if (focusedWindow.isMaximized()) {\n                focusedWindow.unmaximize();\n            } else {\n                focusedWindow.maximize();\n            }\n        });\n\n        $closeBtn.on('click', () => {\n            $closeBtn.trigger('blur');\n            const remote = utils.dynamicRequire('@electron/remote');\n            remote.BrowserWindow.getFocusedWindow().close();\n        });\n    }\n}\n","import options from \"../../services/options.js\";\nimport FlexContainer from \"./flex_container.js\";\nimport appContext from \"../../components/app_context.js\";\n\nexport default class LeftPaneContainer extends FlexContainer {\n    constructor() {\n        super('column');\n\n        this.id('left-pane');\n        this.css('height', '100%');\n        this.collapsible();\n    }\n\n    isEnabled() {\n        return super.isEnabled() && options.is('leftPaneVisible');\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.isOptionReloaded(\"leftPaneVisible\")) {\n            const visible = this.isEnabled();\n            this.toggleInt(visible);\n\n            if (visible) {\n                this.triggerEvent('focusTree');\n            } else {\n                const activeNoteContext = appContext.tabManager.getActiveContext();\n                this.triggerEvent('focusOnDetail', {ntxId: activeNoteContext.ntxId});\n            }\n        }\n    }\n}\n","import hoistedNoteService from \"../services/hoisted_note.js\";\nimport treeService from \"../services/tree.js\";\nimport utils from \"../services/utils.js\";\nimport contextMenu from \"../menus/context_menu.js\";\nimport froca from \"../services/froca.js\";\nimport branchService from \"../services/branches.js\";\nimport ws from \"../services/ws.js\";\nimport NoteContextAwareWidget from \"./note_context_aware_widget.js\";\nimport server from \"../services/server.js\";\nimport noteCreateService from \"../services/note_create.js\";\nimport toastService from \"../services/toast.js\";\nimport appContext from \"../components/app_context.js\";\nimport keyboardActionsService from \"../services/keyboard_actions.js\";\nimport clipboard from \"../services/clipboard.js\";\nimport protectedSessionService from \"../services/protected_session.js\";\nimport linkService from \"../services/link.js\";\nimport options from \"../services/options.js\";\nimport protectedSessionHolder from \"../services/protected_session_holder.js\";\nimport dialogService from \"../services/dialog.js\";\nimport shortcutService from \"../services/shortcuts.js\";\n\nconst TPL = `\n<div class=\"tree-wrapper\">\n    <style>\n    .tree-wrapper {\n        flex-grow: 1;\n        flex-shrink: 1;\n        flex-basis: 60%;\n        font-family: var(--tree-font-family);\n        font-size: var(--tree-font-size);\n        position: relative;\n        min-height: 0;\n    }\n    \n    .tree {\n        height: 100%;\n        overflow: auto;\n        padding-bottom: 35px;\n        padding-top: 5px;\n    }\n    \n    .tree-actions {\n        background-color: var(--launcher-pane-background-color);\n        z-index: 100;\n        position: absolute;\n        bottom: 0;\n        display: flex;\n        align-items: flex-end;\n        justify-content: flex-end;\n        right: 17px;\n        border-radius: 7px;\n        border: 1px solid var(--main-border-color);\n    }\n    \n    button.tree-floating-button {\n        margin: 1px;\n        font-size: 1.5em;\n        padding: 5px;\n        max-height: 34px;\n        color: var(--launcher-pane-text-color);\n        background-color: var(--button-background-color);\n        border-radius: var(--button-border-radius);\n        border: 1px solid transparent;\n    }\n    \n    button.tree-floating-button:hover {\n        border: 1px solid var(--button-border-color);\n    }\n    \n    .collapse-tree-button {\n        right: 100px;\n    }\n    \n    .scroll-to-active-note-button {\n        right: 55px;\n    }\n    \n    .tree-settings-button {\n        right: 10px;\n    }\n    \n    .tree-settings-popup {\n        display: none; \n        position: absolute; \n        background-color: var(--accented-background-color); \n        border: 1px solid var(--main-border-color); \n        padding: 20px; \n        z-index: 1000;\n        width: 340px; \n        border-radius: 10px;\n    }\n    \n    .tree .hidden-node-is-hidden {\n        display: none;\n    }\n    </style>\n    \n    <div class=\"tree\"></div>\n    \n    <div class=\"tree-actions\">\n        <button class=\"tree-floating-button bx bx-layer-minus collapse-tree-button\" \n                title=\"折叠笔记树\" \n                data-trigger-command=\"collapseTree\"></button>\n        \n        <button class=\"tree-floating-button bx bx-crosshair scroll-to-active-note-button\" \n                title=\"滚动到活动笔记\" \n                data-trigger-command=\"scrollToActiveNote\"></button>\n        \n        <button class=\"tree-floating-button bx bx-cog tree-settings-button\" \n                title=\"树设置\"></button>\n    </div>\n    \n    \n    <div class=\"tree-settings-popup\">\n        <div class=\"form-check\">\n            <label class=\"form-check-label\">\n                <input class=\"form-check-input hide-archived-notes\" type=\"checkbox\" value=\"\">\n            \n                隐藏已归档笔记\n            </label>\n        </div>\n        <div class=\"form-check\">\n            <label class=\"form-check-label\">\n                <input class=\"form-check-input auto-collapse-note-tree\" type=\"checkbox\" value=\"\">\n                \n                自动折叠笔记\n                <span class=\"bx bx-info-circle\" \n                      title=\"一段时间不活跃的笔记会被折叠.\"></span>\n            </label>\n        </div>\n    \n        <br/>\n    \n        <button class=\"btn btn-sm btn-primary save-tree-settings-button\" type=\"submit\">保存并应用修改</button>\n    </div>\n</div>\n`;\n\nconst MAX_SEARCH_RESULTS_IN_TREE = 100;\n\n// this has to be hanged on the actual elements to effectively intercept and stop click event\nconst cancelClickPropagation = e => e.stopPropagation();\n\nexport default class NoteTreeWidget extends NoteContextAwareWidget {\n    constructor() {\n        super();\n\n        this.treeName = \"main\"; // legacy value\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$tree = this.$widget.find('.tree');\n        this.$treeActions = this.$widget.find(\".tree-actions\");\n\n        this.$tree.on(\"mousedown\", \".unhoist-button\", () => hoistedNoteService.unhoist());\n        this.$tree.on(\"mousedown\", \".refresh-search-button\", e => this.refreshSearch(e));\n        this.$tree.on(\"mousedown\", \".add-note-button\", e => {\n            const node = $.ui.fancytree.getNode(e);\n            const parentNotePath = treeService.getNotePath(node);\n\n            noteCreateService.createNote(parentNotePath, {\n                isProtected: node.data.isProtected\n            });\n        });\n\n        this.$tree.on(\"mousedown\", \".enter-workspace-button\", e => {\n            const node = $.ui.fancytree.getNode(e);\n\n            this.triggerCommand('hoistNote', {noteId: node.data.noteId});\n        });\n\n        // fancytree doesn't support middle click, so this is a way to support it\n        this.$tree.on('mousedown', '.fancytree-title', e => {\n            if (e.which === 2) {\n                const node = $.ui.fancytree.getNode(e);\n\n                const notePath = treeService.getNotePath(node);\n\n                if (notePath) {\n                    appContext.tabManager.openTabWithNoteWithHoisting(notePath);\n                }\n\n                e.stopPropagation();\n                e.preventDefault();\n            }\n        });\n\n        this.$treeSettingsPopup = this.$widget.find('.tree-settings-popup');\n        this.$hideArchivedNotesCheckbox = this.$treeSettingsPopup.find('.hide-archived-notes');\n        this.$autoCollapseNoteTree = this.$treeSettingsPopup.find('.auto-collapse-note-tree');\n\n        this.$treeSettingsButton = this.$widget.find('.tree-settings-button');\n        this.$treeSettingsButton.on(\"click\", e => {\n            if (this.$treeSettingsPopup.is(\":visible\")) {\n                this.$treeSettingsPopup.hide();\n                return;\n            }\n\n            this.$hideArchivedNotesCheckbox.prop(\"checked\", this.hideArchivedNotes);\n            this.$autoCollapseNoteTree.prop(\"checked\", this.autoCollapseNoteTree);\n\n            const top = this.$treeActions[0].offsetTop - (this.$treeSettingsPopup.outerHeight());\n            const left = Math.max(\n                0,\n                this.$treeActions[0].offsetLeft - this.$treeSettingsPopup.outerWidth() + this.$treeActions.outerWidth()\n            );\n\n            this.$treeSettingsPopup.css({\n                top,\n                left\n            }).show();\n\n            return false;\n        });\n\n        this.$treeSettingsPopup.on(\"click\", e => {e.stopPropagation();});\n\n        $(document).on('click', () => this.$treeSettingsPopup.hide());\n\n        this.$saveTreeSettingsButton = this.$treeSettingsPopup.find('.save-tree-settings-button');\n        this.$saveTreeSettingsButton.on('click', async () => {\n            await this.setHideArchivedNotes(this.$hideArchivedNotesCheckbox.prop(\"checked\"));\n            await this.setAutoCollapseNoteTree(this.$autoCollapseNoteTree.prop(\"checked\"));\n\n            this.$treeSettingsPopup.hide();\n\n            this.reloadTreeFromCache();\n        });\n\n        // note tree starts initializing already during render which is atypical\n        Promise.all([options.initializedPromise, froca.initializedPromise]).then(() => this.initFancyTree());\n\n        this.setupNoteTitleTooltip();\n    }\n\n    setupNoteTitleTooltip() {\n        // the following will dynamically set tree item's tooltip if the whole item's text is not currently visible\n        // if the whole text is visible then no tooltip is show since that's unnecessarily distracting\n        // see https://github.com/zadam/trilium/pull/1120 for discussion\n\n        // code inspired by https://gist.github.com/jtsternberg/c272d7de5b967cec2d3d\n        const isEnclosing = ($container, $sub) => {\n            const conOffset = $container.offset();\n            const conDistanceFromTop = conOffset.top + $container.outerHeight(true);\n            const conDistanceFromLeft = conOffset.left + $container.outerWidth(true);\n\n            const subOffset = $sub.offset();\n            const subDistanceFromTop = subOffset.top + $sub.outerHeight(true);\n            const subDistanceFromLeft = subOffset.left + $sub.outerWidth(true);\n\n            return conDistanceFromTop > subDistanceFromTop\n                && conOffset.top < subOffset.top\n                && conDistanceFromLeft > subDistanceFromLeft\n                && conOffset.left < subOffset.left;\n        };\n\n        this.$tree.on(\"mouseenter\", \"span.fancytree-title\", e => {\n            e.currentTarget.title = isEnclosing(this.$tree, $(e.currentTarget))\n                ? \"\"\n                : e.currentTarget.innerText;\n        });\n    }\n\n    get hideArchivedNotes() {\n        return options.is(`hideArchivedNotes_${this.treeName}`);\n    }\n\n    async setHideArchivedNotes(val) {\n        await options.save(`hideArchivedNotes_${this.treeName}`, val.toString());\n    }\n\n    get autoCollapseNoteTree() {\n        return options.is(\"autoCollapseNoteTree\");\n    }\n\n    async setAutoCollapseNoteTree(val) {\n        await options.save(\"autoCollapseNoteTree\", val.toString());\n    }\n\n    initFancyTree() {\n        const treeData = [this.prepareRootNode()];\n\n        this.$tree.fancytree({\n            titlesTabbable: true,\n            keyboard: true,\n            extensions: [\"dnd5\", \"clones\", \"filter\"],\n            source: treeData,\n            scrollOfs: {\n                top: 100,\n                bottom: 100\n            },\n            scrollParent: this.$tree,\n            minExpandLevel: 2, // root can't be collapsed\n            click: (event, data) => {\n                this.activityDetected();\n\n                const targetType = data.targetType;\n                const node = data.node;\n\n                if (node.isSelected() && targetType === 'icon') {\n                    this.triggerCommand('openBulkActionsDialog', {\n                        selectedOrActiveNoteIds: this.getSelectedOrActiveNoteIds(node)\n                    });\n\n                    return false;\n                }\n                else if (targetType === 'title' || targetType === 'icon') {\n                    if (event.shiftKey) {\n                        const activeNode = this.getActiveNode();\n\n                        if (activeNode.getParent() !== node.getParent()) {\n                            return;\n                        }\n\n                        this.clearSelectedNodes();\n\n                        function selectInBetween(first, second) {\n                            for (let i = 0; first && first !== second && i < 10000; i++) {\n                                first.setSelected(true);\n                                first = first.getNextSibling();\n                            }\n\n                            second.setSelected();\n                        }\n\n                        if (activeNode.getIndex() < node.getIndex()) {\n                            selectInBetween(activeNode, node);\n                        } else {\n                            selectInBetween(node, activeNode);\n                        }\n\n                        node.setFocus(true);\n                    }\n                    else if ((!utils.isMac() && event.ctrlKey) || (utils.isMac() && event.metaKey)) {\n                        const notePath = treeService.getNotePath(node);\n                        appContext.tabManager.openTabWithNoteWithHoisting(notePath);\n                    }\n                    else if (event.altKey) {\n                        node.setSelected(!node.isSelected());\n                        node.setFocus(true);\n                    }\n                    else if (data.node.isActive()) {\n                        // this is important for single column mobile view, otherwise it's not possible to see again previously displayed note\n                        this.tree.reactivate(true);\n                    }\n                    else {\n                        node.setActive();\n                    }\n\n                    return false;\n                }\n            },\n            beforeActivate: (event, {node}) => {\n                // hidden subtree is hidden hackily - we want it to be present in the tree so that we can switch to it\n                // without reloading the whole tree, but we want it to be hidden when hoisted to root. FancyTree allows\n                // filtering the display only by ascendant - i.e. if the root is visible, all the descendants are as well.\n                // We solve it by hiding the hidden subtree via CSS (class \"hidden-node-is-hidden\"),\n                // but then we need to prevent activating it, e.g. by keyboard\n\n                if (hoistedNoteService.getHoistedNoteId() === '_hidden') {\n                    // if we're hoisted in hidden subtree, we want to avoid crossing to \"visible\" tree,\n                    // which could happen via UP key from hidden root\n\n                    return node.data.noteId !== 'root';\n                }\n\n                // we're not hoisted to hidden subtree, the only way to cross is via DOWN key to the hidden root\n                return node.data.noteId !== '_hidden';\n            },\n            activate: async (event, data) => {\n                // click event won't propagate so let's close context menu manually\n                contextMenu.hide();\n\n                this.clearSelectedNodes();\n\n                const notePath = treeService.getNotePath(data.node);\n\n                const activeNoteContext = appContext.tabManager.getActiveContext();\n                await activeNoteContext.setNote(notePath);\n            },\n            expand: (event, data) => this.setExpanded(data.node.data.branchId, true),\n            collapse: (event, data) => this.setExpanded(data.node.data.branchId, false),\n            filter: {\n                counter: false,\n                mode: \"hide\",\n                autoExpand: true\n            },\n            dnd5: {\n                autoExpandMS: 600,\n                preventLazyParents: false,\n                dragStart: (node, data) => {\n                    if (['root', '_hidden', '_lbRoot', '_lbAvailableLaunchers', '_lbVisibleLaunchers'].includes(node.data.noteId)\n                        || node.data.noteId.startsWith(\"_options\")) {\n                        return false;\n                    }\n\n                    const notes = this.getSelectedOrActiveNodes(node).map(node => ({\n                        noteId: node.data.noteId,\n                        branchId: node.data.branchId,\n                        title: node.title\n                    }));\n\n                    if (notes.length === 1) {\n                        linkService.createLink(notes[0].noteId, {referenceLink: true, autoConvertToImage: true})\n                            .then($link => data.dataTransfer.setData(\"text/html\", $link[0].outerHTML));\n                    }\n                    else {\n                        Promise.all(notes.map(note => linkService.createLink(note.noteId, {referenceLink: true, autoConvertToImage: true}))).then(links => {\n                            const $list = $(\"<ul>\").append(...links.map($link => $(\"<li>\").append($link)));\n\n                            data.dataTransfer.setData(\"text/html\", $list[0].outerHTML);\n                        });\n                    }\n\n                    data.dataTransfer.setData(\"text\", JSON.stringify(notes));\n                    return true; // allow dragging to start\n                },\n                dragEnter: (node, data) => {\n                    if (node.data.noteType === 'search') {\n                        return false;\n                    } else if (node.data.noteId === '_lbRoot') {\n                        return false;\n                    } else if (node.data.noteId.startsWith('_options')) {\n                        return false;\n                    } else if (node.data.noteType === 'launcher') {\n                        return ['before', 'after'];\n                    } else if (['_lbAvailableLaunchers', '_lbVisibleLaunchers'].includes(node.data.noteId)) {\n                        return ['over'];\n                    } else {\n                        return true;\n                    }\n                },\n                dragDrop: async (node, data) => {\n                    if ((data.hitMode === 'over' && node.data.noteType === 'search') ||\n                        (['after', 'before'].includes(data.hitMode)\n                            && (node.data.noteId === hoistedNoteService.getHoistedNoteId() || node.getParent().data.noteType === 'search'))) {\n\n                        await dialogService.info(\"笔记不允许移动到这个地方.\");\n\n                        return;\n                    }\n\n                    const dataTransfer = data.dataTransfer;\n\n                    if (dataTransfer && dataTransfer.files && dataTransfer.files.length > 0) {\n                        const files = [...dataTransfer.files]; // chrome has issue that dataTransfer.files empties after async operation\n\n                        const importService = await import('../services/import.js');\n\n                        importService.uploadFiles('notes', node.data.noteId, files, {\n                            safeImport: true,\n                            shrinkImages: true,\n                            textImportedAsText: true,\n                            codeImportedAsCode: true,\n                            explodeArchives: true,\n                            replaceUnderscoresWithSpaces: true\n                        });\n                    }\n                    else {\n                        const jsonStr = dataTransfer.getData(\"text\");\n                        let notes = null;\n\n                        try {\n                            notes = JSON.parse(jsonStr);\n                        }\n                        catch (e) {\n                            logError(`Cannot parse JSON '${jsonStr}' into notes for drop`);\n                            return;\n                        }\n\n                        // This function MUST be defined to enable dropping of items on the tree.\n                        // data.hitMode is 'before', 'after', or 'over'.\n\n                        const selectedBranchIds = notes.map(note => note.branchId);\n\n                        if (data.hitMode === \"before\") {\n                            branchService.moveBeforeBranch(selectedBranchIds, node.data.branchId);\n                        } else if (data.hitMode === \"after\") {\n                            branchService.moveAfterBranch(selectedBranchIds, node.data.branchId);\n                        } else if (data.hitMode === \"over\") {\n                            branchService.moveToParentNote(selectedBranchIds, node.data.branchId);\n                        } else {\n                            throw new Error(`Unknown hitMode '${data.hitMode}'`);\n                        }\n                    }\n                }\n            },\n            lazyLoad: (event, data) => {\n                const {noteId, noteType} = data.node.data;\n\n                if (noteType === 'search') {\n                    const notePath = treeService.getNotePath(data.node.getParent());\n\n                    // this is a search cycle (search note is a descendant of its own search result)\n                    if (notePath.includes(noteId)) {\n                        data.result = [];\n                        return;\n                    }\n\n                    data.result = froca.loadSearchNote(noteId).then(() => {\n                        const note = froca.getNoteFromCache(noteId);\n\n                        let childNoteIds = note.getChildNoteIds();\n\n                        if (note.type === 'search' && childNoteIds.length > MAX_SEARCH_RESULTS_IN_TREE) {\n                            childNoteIds = childNoteIds.slice(0, MAX_SEARCH_RESULTS_IN_TREE);\n                        }\n\n                        return froca.getNotes(childNoteIds);\n                    }).then(() => {\n                        const note = froca.getNoteFromCache(noteId);\n\n                        return this.prepareChildren(note);\n                    });\n                }\n                else {\n                    data.result = froca.loadSubTree(noteId).then(note => this.prepareChildren(note));\n                }\n            },\n            clones: {\n                highlightActiveClones: true\n            },\n            enhanceTitle: async function (event, data) {\n                const node = data.node;\n\n                if (!node.data.noteId) {\n                    // if there's \"non-note\" node, then don't enhance\n                    // this can happen for e.g. \"Load error!\" node\n                    return;\n                }\n\n                const note = await froca.getNote(node.data.noteId, true);\n\n                if (!note) {\n                    return;\n                }\n\n                const activeNoteContext = appContext.tabManager.getActiveContext();\n\n                const $span = $(node.span);\n\n                $span.find('.tree-item-button').remove();\n\n                const isHoistedNote = activeNoteContext && activeNoteContext.hoistedNoteId === note.noteId && note.noteId !== 'root';\n\n                if (note.hasLabel('workspace') && !isHoistedNote) {\n                    const $enterWorkspaceButton = $('<span class=\"tree-item-button enter-workspace-button bx bx-door-open\" title=\"提升这个笔记(工作区)\"></span>')\n                        .on(\"click\", cancelClickPropagation);\n\n                    $span.append($enterWorkspaceButton);\n                }\n\n                if (note.type === 'search') {\n                    const $refreshSearchButton = $('<span class=\"tree-item-button refresh-search-button bx bx-refresh\" title=\"刷新保存的搜索结果\"></span>')\n                        .on(\"click\", cancelClickPropagation);\n\n                    $span.append($refreshSearchButton);\n                }\n\n                if (!['search', 'launcher'].includes(note.type) && !note.isOptions() && !note.isLaunchBarConfig()) {\n                    const $createChildNoteButton = $('<span class=\"tree-item-button add-note-button bx bx-plus\" title=\"创建子笔记\"></span>')\n                        .on(\"click\", cancelClickPropagation);\n\n                    $span.append($createChildNoteButton);\n                }\n\n                if (isHoistedNote) {\n                    const $unhoistButton = $('<span class=\"tree-item-button unhoist-button bx bx-door-open\" title=\"取消提升\"></span>')\n                        .on(\"click\", cancelClickPropagation);\n\n                    $span.append($unhoistButton);\n                }\n            },\n            // this is done to automatically lazy load all expanded notes after tree load\n            loadChildren: (event, data) => {\n                data.node.visit((subNode) => {\n                    // Load all lazy/unloaded child nodes\n                    // (which will trigger `loadChildren` recursively)\n                    if (subNode.isUndefined() && subNode.isExpanded()) {\n                        subNode.load();\n                    }\n                });\n            },\n            select: (event, {node}) => {\n                if (hoistedNoteService.getHoistedNoteId() === 'root'\n                    && node.data.noteId === '_hidden'\n                    && node.isSelected()) {\n\n                    // hidden is hackily hidden from the tree via CSS when root is hoisted\n                    // make sure it's not selected by mistake, it could be e.g. deleted by mistake otherwise\n                    node.setSelected(false);\n\n                    return;\n                }\n\n                $(node.span).find(\".fancytree-custom-icon\").attr(\"title\",\n                    node.isSelected() ? \"对选定的笔记应用批量动作\" : \"\");\n            }\n        });\n\n        if (!utils.isMobile()) {\n            this.getHotKeys().then(hotKeys => {\n                for (const key in hotKeys) {\n                    const handler = hotKeys[key];\n\n                    $(this.tree.$container).on('keydown', null, key, evt => {\n                        const node = this.tree.getActiveNode();\n                        return handler(node, evt);\n                        // return false from the handler will stop default handling.\n                    });\n                }\n            });\n        }\n\n        this.$tree.on('contextmenu', '.fancytree-node', e => {\n            const node = $.ui.fancytree.getNode(e);\n            const note = froca.getNoteFromCache(node.data.noteId);\n\n            if (note.isLaunchBarConfig()) {\n                import(\"../menus/launcher_context_menu.js\").then(({default: LauncherContextMenu}) => {\n                    const launcherContextMenu = new LauncherContextMenu(this, node);\n                    launcherContextMenu.show(e);\n                });\n            } else {\n                import(\"../menus/tree_context_menu.js\").then(({default: TreeContextMenu}) => {\n                    const treeContextMenu = new TreeContextMenu(this, node);\n                    treeContextMenu.show(e);\n                });\n            }\n\n            return false; // blocks default browser right click menu\n        });\n\n        this.tree = $.ui.fancytree.getTree(this.$tree);\n    }\n\n    prepareRootNode() {\n        return this.prepareNode(froca.getBranch('none_root'));\n    }\n\n    /**\n     * @param {FNote} parentNote\n     */\n    prepareChildren(parentNote) {\n        utils.assertArguments(parentNote);\n\n        const noteList = [];\n\n        const hideArchivedNotes = this.hideArchivedNotes;\n\n        let childBranches = parentNote.getFilteredChildBranches();\n\n        if (parentNote.type === 'search' && childBranches.length > MAX_SEARCH_RESULTS_IN_TREE) {\n            childBranches = childBranches.slice(0, MAX_SEARCH_RESULTS_IN_TREE);\n        }\n\n        for (const branch of childBranches) {\n            if (hideArchivedNotes) {\n                const note = branch.getNoteFromCache();\n\n                if (note.hasLabel('archived')) {\n                    continue;\n                }\n            }\n\n            const node = this.prepareNode(branch);\n\n            noteList.push(node);\n        }\n\n        return noteList;\n    }\n\n    async updateNode(node) {\n        const note = froca.getNoteFromCache(node.data.noteId);\n        const branch = froca.getBranch(node.data.branchId);\n\n        if (!note) {\n            console.log(`Node update not possible because note '${node.data.noteId}' was not found.`);\n            return;\n        } else if (!branch) {\n            console.log(`Node update not possible because branch '${node.data.branchId}' was not found.`);\n            return;\n        }\n\n        const title = `${branch.prefix ? (`${branch.prefix} - `) : \"\"}${note.title}`;\n\n        node.data.isProtected = note.isProtected;\n        node.data.noteType = note.type;\n        node.folder = note.isFolder();\n        node.icon = note.getIcon();\n        node.extraClasses = this.getExtraClasses(note);\n        node.title = utils.escapeHtml(title);\n\n        if (node.isExpanded() !== branch.isExpanded) {\n            await node.setExpanded(branch.isExpanded, {noEvents: true, noAnimation: true});\n        }\n\n        node.renderTitle();\n    }\n\n    /**\n     * @param {FBranch} branch\n     * @param {boolean} forceLazy\n     */\n    prepareNode(branch, forceLazy = false) {\n        const note = branch.getNoteFromCache();\n\n        if (!note) {\n            throw new Error(`Branch '${branch.branchId}' has no child note '${branch.noteId}'`);\n        }\n\n        const title = `${branch.prefix ? (`${branch.prefix} - `) : \"\"}${note.title}`;\n\n        const isFolder = note.isFolder();\n\n        const node = {\n            noteId: note.noteId,\n            parentNoteId: branch.parentNoteId,\n            branchId: branch.branchId,\n            isProtected: note.isProtected,\n            noteType: note.type,\n            title: utils.escapeHtml(title),\n            extraClasses: this.getExtraClasses(note),\n            icon: note.getIcon(isFolder),\n            refKey: note.noteId,\n            lazy: true,\n            folder: isFolder,\n            expanded: branch.isExpanded && note.type !== 'search',\n            key: utils.randomString(12) // this should prevent some \"duplicate key\" errors\n        };\n\n        if (isFolder && node.expanded && !forceLazy) {\n            node.children = this.prepareChildren(note);\n        }\n\n        return node;\n    }\n\n    getExtraClasses(note) {\n        utils.assertArguments(note);\n\n        const extraClasses = [];\n\n        if (note.isProtected) {\n            extraClasses.push(\"protected\");\n        }\n\n        if (note.isShared()) {\n            extraClasses.push(\"shared\");\n        }\n\n        if (note.getParentNoteIds().length > 1) {\n            const realClones = note.getParentNoteIds()\n                .map(noteId => froca.notes[noteId])\n                .filter(note => !!note)\n                .filter(note =>\n                    !['_share', '_lbBookmarks'].includes(note.noteId)\n                    && note.type !== 'search');\n\n            if (realClones.length > 1) {\n                extraClasses.push(\"multiple-parents\");\n            }\n        }\n\n        const cssClass = note.getCssClass();\n\n        if (cssClass) {\n            extraClasses.push(cssClass);\n        }\n\n        extraClasses.push(utils.getNoteTypeClass(note.type));\n\n        if (note.mime) { // some notes should not have mime type (e.g. render)\n            extraClasses.push(utils.getMimeTypeClass(note.mime));\n        }\n\n        if (note.hasLabel('archived')) {\n            extraClasses.push(\"archived\");\n        }\n\n        const colorClass = note.getColorClass();\n\n        if (colorClass) {\n            extraClasses.push(colorClass);\n        }\n\n        return extraClasses.join(\" \");\n    }\n\n    /** @returns {FancytreeNode[]} */\n    getSelectedNodes(stopOnParents = false) {\n        return this.tree.getSelectedNodes(stopOnParents);\n    }\n\n    /** @returns {FancytreeNode[]} */\n    getSelectedOrActiveNodes(node = null) {\n        const nodes = this.getSelectedNodes(true);\n\n        // the node you start dragging should be included even if not selected\n        if (node && !nodes.find(n => n.key === node.key)) {\n            nodes.push(node);\n        }\n\n        if (nodes.length === 0) {\n            nodes.push(this.getActiveNode());\n        }\n\n        // hidden subtree is hackily hidden via CSS when hoisted to root\n        // make sure it's never selected for e.g. deletion in such a case\n        return nodes.filter(node => hoistedNoteService.getHoistedNoteId() !== 'root'\n                                               || node.data.noteId !== '_hidden');\n    }\n\n    async setExpandedStatusForSubtree(node, isExpanded) {\n        if (!node) {\n            const hoistedNoteId = hoistedNoteService.getHoistedNoteId();\n\n            node = this.getNodesByNoteId(hoistedNoteId)[0];\n        }\n\n        const {branchIds} = await server.put(`branches/${node.data.branchId}/expanded-subtree/${isExpanded ? 1 : 0}`);\n\n        froca.getBranches(branchIds, true)\n            .forEach(branch => branch.isExpanded = !!isExpanded);\n\n        await this.batchUpdate(async () => {\n            await node.load(true);\n\n            if (node.data.noteId !== hoistedNoteService.getHoistedNoteId()) { // hoisted note should always be expanded\n                await node.setExpanded(isExpanded, {noEvents: true, noAnimation: true});\n            }\n        });\n\n        await this.filterHoistedBranch(true);\n\n        // don't activate the active note, see discussion in https://github.com/zadam/trilium/issues/3664\n    }\n\n    async expandTree(node = null) {\n        await this.setExpandedStatusForSubtree(node, true);\n    }\n\n    async collapseTree(node = null) {\n        await this.setExpandedStatusForSubtree(node, false);\n    }\n\n    collapseTreeEvent() {this.collapseTree();}\n\n    /**\n     * @returns {FancytreeNode|null}\n     */\n    getActiveNode() {\n        return this.tree.getActiveNode();\n    }\n\n    /**\n     * focused & not active node can happen during multiselection where the node is selected\n     * but not activated (its content is not displayed in the detail)\n     * @returns {FancytreeNode|null}\n     */\n    getFocusedNode() {\n        return this.tree.getFocusNode();\n    }\n\n    clearSelectedNodes() {\n        for (const selectedNode of this.getSelectedNodes()) {\n            selectedNode.setSelected(false);\n        }\n    }\n\n    async scrollToActiveNoteEvent() {\n        const activeContext = appContext.tabManager.getActiveContext();\n\n        if (activeContext && activeContext.notePath) {\n            this.tree.$container.focus();\n            this.tree.setFocus(true);\n\n            const node = await this.expandToNote(activeContext.notePath);\n\n            if (node) {\n                await node.makeVisible({scrollIntoView: true});\n                node.setActive(true, {noEvents: true, noFocus: false});\n            }\n        }\n    }\n\n    async focusTreeEvent() {\n        this.tree.$container.focus();\n        this.tree.setFocus(true);\n    }\n\n    /** @returns {FancytreeNode} */\n    async getNodeFromPath(notePath, expand = false, logErrors = true) {\n        utils.assertArguments(notePath);\n        /** @let {FancytreeNode} */\n        let parentNode = this.getNodesByNoteId('root')[0];\n\n        let resolvedNotePathSegments = await treeService.resolveNotePathToSegments(notePath, this.hoistedNoteId, logErrors);\n\n        if (!resolvedNotePathSegments) {\n            if (logErrors) {\n                logError(\"找不到运行路径, 对应notePath为:\", notePath);\n            }\n\n            return;\n        }\n\n        resolvedNotePathSegments = resolvedNotePathSegments.slice(1);\n\n        for (const childNoteId of resolvedNotePathSegments) {\n            // we expand only after hoisted note since before then nodes are not actually present in the tree\n            if (parentNode) {\n                if (!parentNode.isLoaded()) {\n                    await parentNode.load();\n                }\n\n                if (expand) {\n                    if (!parentNode.isExpanded()) {\n                        await parentNode.setExpanded(true, {noAnimation: true});\n                    }\n\n                    // although the previous line should set the expanded status, it seems to happen asynchronously,\n                    // so we need to make sure it is set properly before calling updateNode which uses this flag\n                    const branch = froca.getBranch(parentNode.data.branchId);\n                    branch.isExpanded = true;\n                }\n\n                await this.updateNode(parentNode);\n\n                let foundChildNode = this.findChildNode(parentNode, childNoteId);\n\n                if (!foundChildNode) { // note might be recently created, so we'll force reload and try again\n                    await parentNode.load(true);\n\n                    foundChildNode = this.findChildNode(parentNode, childNoteId);\n\n                    if (!foundChildNode) {\n                        if (logErrors) {\n                            // besides real errors, this can be also caused by hiding of e.g. included images\n                            // these are real notes with real notePath, user can display them in a detail,\n                            // but they don't have a node in the tree\n\n                            const childNote = await froca.getNote(childNoteId);\n\n                            if (!childNote || childNote.type !== 'image') {\n                                ws.logError(`Can't find node for child node of noteId=${childNoteId} for parent of noteId=${parentNode.data.noteId} and hoistedNoteId=${hoistedNoteService.getHoistedNoteId()}, requested path is ${notePath}`);\n                            }\n                        }\n\n                        return;\n                    }\n                }\n\n                parentNode = foundChildNode;\n            }\n        }\n\n        return parentNode;\n    }\n\n    /** @returns {FancytreeNode} */\n    findChildNode(parentNode, childNoteId) {\n        return parentNode.getChildren().find(childNode => childNode.data.noteId === childNoteId);\n    }\n\n    /** @returns {FancytreeNode} */\n    async expandToNote(notePath, logErrors = true) {\n        return this.getNodeFromPath(notePath, true, logErrors);\n    }\n\n    /** @returns {FancytreeNode[]} */\n    getNodesByBranch(branch) {\n        utils.assertArguments(branch);\n\n        return this.getNodesByNoteId(branch.noteId).filter(node => node.data.branchId === branch.branchId);\n    }\n\n    /** @returns {FancytreeNode[]} */\n    getNodesByNoteId(noteId) {\n        utils.assertArguments(noteId);\n\n        const list = this.tree.getNodesByRef(noteId);\n        return list ? list : []; // if no nodes with this refKey are found, fancy tree returns null\n    }\n\n    isEnabled() {\n        return !!this.noteContext;\n    }\n\n    async refresh() {\n        this.toggleInt(this.isEnabled());\n        this.$treeSettingsPopup.hide();\n\n        this.activityDetected();\n\n        const oldActiveNode = this.getActiveNode();\n\n        const newActiveNode = this.noteContext?.notePath\n            && (!treeService.isNotePathInHiddenSubtree(this.noteContext.notePath) || await hoistedNoteService.isHoistedInHiddenSubtree())\n            && await this.getNodeFromPath(this.noteContext.notePath);\n\n        if (newActiveNode !== oldActiveNode) {\n            let oldActiveNodeFocused = false;\n\n            if (oldActiveNode) {\n                oldActiveNodeFocused = oldActiveNode.hasFocus();\n\n                oldActiveNode.setActive(false);\n                oldActiveNode.setFocus(false);\n            }\n\n            if (newActiveNode) {\n                if (!newActiveNode.isVisible()) {\n                    await this.expandToNote(this.noteContext.notePath);\n                }\n\n                newActiveNode.setActive(true, {noEvents: true, noFocus: !oldActiveNodeFocused});\n                newActiveNode.makeVisible({scrollIntoView: true});\n            }\n        }\n\n        this.filterHoistedBranch(false);\n    }\n\n    async refreshSearch(e) {\n        const activeNode = $.ui.fancytree.getNode(e);\n\n        activeNode.load(true);\n        activeNode.setExpanded(true, {noAnimation: true});\n\n        toastService.showMessage(\"保存的搜索结果已刷新.\");\n    }\n\n    async batchUpdate(cb) {\n        try {\n            // disable rendering during update for increased performance\n            this.tree.enableUpdate(false);\n\n            await cb();\n        }\n        finally {\n            this.tree.enableUpdate(true);\n        }\n    }\n\n    activityDetected() {\n        if (this.autoCollapseTimeoutId) {\n            clearTimeout(this.autoCollapseTimeoutId);\n        }\n\n        this.autoCollapseTimeoutId = setTimeout(() => {\n            if (!this.autoCollapseNoteTree) {\n                return;\n            }\n\n            /*\n             * We're collapsing notes after a period of inactivity to \"cleanup\" the tree - users rarely\n             * collapse the notes and the tree becomes unusuably large.\n             * Some context: https://github.com/zadam/trilium/issues/1192\n             */\n\n            const noteIdsToKeepExpanded = new Set(\n                appContext.tabManager.getNoteContexts()\n                    .map(nc => nc.notePathArray)\n                    .flat()\n            );\n\n            let noneCollapsedYet = true;\n\n            this.tree.getRootNode().visit(node => {\n                if (node.isExpanded() && !noteIdsToKeepExpanded.has(node.data.noteId)) {\n                    node.setExpanded(false);\n\n                    if (noneCollapsedYet) {\n                        toastService.showMessage(\"自动折叠一段时间不活跃的笔记...\");\n                        noneCollapsedYet = false;\n                    }\n                }\n            }, false);\n\n            this.filterHoistedBranch(true);\n        }, 600 * 1000);\n    }\n\n    async entitiesReloadedEvent({loadResults}) {\n        this.activityDetected();\n\n        if (loadResults.isEmptyForTree()) {\n            return;\n        }\n\n        const nodeCtx = this.#getActiveNodeCtx();\n\n        const refreshCtx = {\n            noteIdsToUpdate: new Set(),\n            noteIdsToReload: new Set()\n        };\n\n        this.#processAttributeRows(loadResults.getAttributeRows(), refreshCtx);\n\n        const { movedActiveNode, parentsOfAddedNodes } = await this.#processBranchRows(loadResults.getBranchRows(), refreshCtx);\n\n        for (const noteId of loadResults.getNoteIds()) {\n            refreshCtx.noteIdsToUpdate.add(noteId);\n        }\n\n        await this.#executeTreeUpdates(refreshCtx, loadResults);\n\n        await this.#setActiveNode(nodeCtx, movedActiveNode, parentsOfAddedNodes);\n\n        if (refreshCtx.noteIdsToReload.size > 0 || refreshCtx.noteIdsToUpdate.size > 0) {\n            // workaround for https://github.com/mar10/fancytree/issues/1054\n            this.filterHoistedBranch(true);\n        }\n    }\n\n    #processAttributeRows(attributeRows, refreshCtx) {\n        for (const attrRow of attributeRows) {\n            const dirtyingLabels = ['iconClass', 'cssClass', 'workspace', 'workspaceIconClass', 'color'];\n\n            if (attrRow.type === 'label' && dirtyingLabels.includes(attrRow.name)) {\n                if (attrRow.isInheritable) {\n                    refreshCtx.noteIdsToReload.add(attrRow.noteId);\n                } else {\n                    refreshCtx.noteIdsToUpdate.add(attrRow.noteId);\n                }\n            } else if (attrRow.type === 'label' && attrRow.name === 'archived') {\n                const note = froca.getNoteFromCache(attrRow.noteId);\n\n                if (note) {\n                    // change of archived status can mean the note should not be displayed in the tree at all\n                    // depending on the value of this.hideArchivedNotes\n                    for (const parentNote of note.getParentNotes()) {\n                        refreshCtx.noteIdsToReload.add(parentNote.noteId);\n                    }\n                }\n            } else if (attrRow.type === 'relation' && (attrRow.name === 'template' || attrRow.name === 'inherit')) {\n                // missing handling of things inherited from template\n                refreshCtx.noteIdsToReload.add(attrRow.noteId);\n            } else if (attrRow.type === 'relation' && attrRow.name === 'imageLink') {\n                const note = froca.getNoteFromCache(attrRow.noteId);\n\n                if (note && note.getChildNoteIds().includes(attrRow.value)) {\n                    // there's a new /deleted imageLink between note and its image child - which can show/hide\n                    // the image (if there is an imageLink relation between parent and child,\n                    // then it is assumed to be \"contained\" in the note and thus does not have to be displayed in the tree)\n                    refreshCtx.noteIdsToReload.add(attrRow.noteId);\n                }\n            }\n        }\n    }\n\n    async #processBranchRows(branchRows, refreshCtx) {\n        const allBranchesDeleted = branchRows.every(branchRow => !!branchRow.isDeleted);\n\n        // activeNode is supposed to be moved when we find out activeNode is deleted but not all branches are deleted. save it for fixing activeNodePath after all nodes loaded.\n        let movedActiveNode = null;\n        let parentsOfAddedNodes = [];\n\n        for (const branchRow of branchRows) {\n            if (branchRow.parentNoteId === '_share') {\n                // all shared notes have a sign in the tree, even the descendants of shared notes\n                refreshCtx.noteIdsToReload.add(branchRow.noteId);\n            } else {\n                // adding noteId itself to update all potential clones\n                refreshCtx.noteIdsToUpdate.add(branchRow.noteId);\n            }\n\n            if (branchRow.isDeleted) {\n                for (const node of this.getNodesByBranch(branchRow)) {\n                    if (node.isActive()) {\n                        if (allBranchesDeleted) {\n                            const newActiveNode = node.getNextSibling()\n                                || node.getPrevSibling()\n                                || node.getParent();\n\n                            if (newActiveNode) {\n                                newActiveNode.setActive(true, {noEvents: true, noFocus: true});\n                            }\n                        } else {\n                            movedActiveNode = node;\n                        }\n                    }\n\n                    if (node.getParent()) {\n                        node.remove();\n                    }\n\n                    refreshCtx.noteIdsToUpdate.add(branchRow.parentNoteId);\n                }\n            } else {\n                for (const parentNode of this.getNodesByNoteId(branchRow.parentNoteId)) {\n                    parentsOfAddedNodes.push(parentNode)\n\n                    if (parentNode.isFolder() && !parentNode.isLoaded()) {\n                        continue;\n                    }\n\n                    const note = await froca.getNote(branchRow.noteId);\n                    const frocaBranch = froca.getBranch(branchRow.branchId);\n                    const foundNode = (parentNode.getChildren() || []).find(child => child.data.noteId === branchRow.noteId);\n                    if (foundNode) {\n                        // the branch already exists in the tree\n                        if (branchRow.isExpanded !== foundNode.isExpanded()) {\n                            refreshCtx.noteIdsToReload.add(frocaBranch.noteId);\n                        }\n                    } else {\n                        // make sure it's loaded\n                        // we're forcing lazy since it's not clear if the whole required subtree is in froca\n                        parentNode.addChildren([this.prepareNode(frocaBranch, true)]);\n\n                        if (frocaBranch.isExpanded && note.hasChildren()) {\n                            refreshCtx.noteIdsToReload.add(frocaBranch.noteId);\n                        }\n\n                        this.sortChildren(parentNode);\n\n                        // this might be a first child which would force an icon change\n                        refreshCtx.noteIdsToUpdate.add(branchRow.parentNoteId);\n                    }\n                }\n            }\n        }\n\n        return {\n            movedActiveNode,\n            parentsOfAddedNodes\n        };\n    }\n\n    async #executeTreeUpdates(refreshCtx, loadResults) {\n        await this.batchUpdate(async () => {\n            for (const noteId of refreshCtx.noteIdsToReload) {\n                for (const node of this.getNodesByNoteId(noteId)) {\n                    await node.load(true);\n\n                    refreshCtx.noteIdsToUpdate.add(noteId);\n                }\n            }\n\n            for (const parentNoteId of loadResults.getNoteReorderings()) {\n                for (const node of this.getNodesByNoteId(parentNoteId)) {\n                    if (node.isLoaded()) {\n                        this.sortChildren(node);\n                    }\n                }\n            }\n        });\n\n        // for some reason, node update cannot be in the batchUpdate() block (node is not re-rendered)\n        for (const noteId of refreshCtx.noteIdsToUpdate) {\n            for (const node of this.getNodesByNoteId(noteId)) {\n                await this.updateNode(node);\n            }\n        }\n    }\n\n    #getActiveNodeCtx() {\n        const nodeCtx = {\n            activeNotePath: null,\n            activeNodeFocused: null,\n            nextNotePath: null\n        };\n\n        const activeNode = this.getActiveNode();\n        nodeCtx.activeNodeFocused = activeNode?.hasFocus();\n        nodeCtx.activeNotePath = activeNode ? treeService.getNotePath(activeNode) : null;\n        const nextNode = activeNode ? (activeNode.getNextSibling() || activeNode.getPrevSibling() || activeNode.getParent()) : null;\n        nodeCtx.nextNotePath = nextNode ? treeService.getNotePath(nextNode) : null;\n        return nodeCtx;\n    }\n\n    async #setActiveNode(nodeCtx, movedActiveNode, parentsOfAddedNodes) {\n        if (movedActiveNode) {\n            for (const parentNode of parentsOfAddedNodes) {\n                const foundNode = (parentNode.getChildren() || []).find(child => child.data.noteId === movedActiveNode.data.noteId);\n                if (foundNode) {\n                    nodeCtx.activeNotePath = treeService.getNotePath(foundNode);\n                    break;\n                }\n            }\n        }\n\n        if (!nodeCtx.activeNotePath) {\n            return;\n        }\n\n        let node = await this.expandToNote(nodeCtx.activeNotePath, false);\n        if (node && node.data.noteId !== treeService.getNoteIdFromUrl(nodeCtx.activeNotePath)) {\n            // if the active note has been moved elsewhere then it won't be found by the path,\n            // so we switch to the alternative of trying to find it by noteId\n            const notesById = this.getNodesByNoteId(treeService.getNoteIdFromUrl(nodeCtx.activeNotePath));\n\n            // if there are multiple clones, then we'd rather not activate anyone\n            node = notesById.length === 1 ? notesById[0] : null;\n        }\n\n        if (node) {\n            if (nodeCtx.activeNodeFocused) {\n                // needed by Firefox: https://github.com/zadam/trilium/issues/1865\n                this.tree.$container.focus();\n            }\n\n            await node.setActive(true, {noEvents: true, noFocus: !nodeCtx.activeNodeFocused});\n        } else {\n            // this is used when the original note has been deleted, and we want to move the focus to the note above/below\n            node = await this.expandToNote(nodeCtx.nextNotePath, false);\n\n            if (node) {\n                // FIXME: this is conceptually wrong\n                //        here note tree is responsible for updating global state of the application\n                //        this should be done by NoteContext / TabManager and note tree should only listen to\n                //        changes in active note and just set the \"active\" state\n                // We don't await since that can bring up infinite cycles when e.g. custom widget does some backend requests which wait for max sync ID processed\n                appContext.tabManager.getActiveContext().setNote(nodeCtx.nextNotePath).then(() => {\n                    const newActiveNode = this.getActiveNode();\n\n                    // return focus if the previously active node was also focused\n                    if (newActiveNode && nodeCtx.activeNodeFocused) {\n                        newActiveNode.setFocus(true);\n                    }\n                });\n            }\n        }\n    }\n\n    sortChildren(node) {\n        node.sortChildren((nodeA, nodeB) => {\n            const branchA = froca.branches[nodeA.data.branchId];\n            const branchB = froca.branches[nodeB.data.branchId];\n\n            if (!branchA || !branchB) {\n                return 0;\n            }\n\n            return branchA.notePosition - branchB.notePosition;\n        });\n    }\n\n    setExpanded(branchId, isExpanded) {\n        utils.assertArguments(branchId);\n\n        const branch = froca.getBranch(branchId, true);\n\n        if (!branch) {\n            if (branchId && branchId.startsWith('virt')) {\n                // in case of virtual branches there's nothing to update\n                return;\n            }\n            else {\n                logError(`找不到 branch=${branchId}`);\n                return;\n            }\n        }\n\n        branch.isExpanded = isExpanded;\n\n        server.put(`branches/${branchId}/expanded/${isExpanded ? 1 : 0}`);\n    }\n\n    async reloadTreeFromCache() {\n        const activeNode = this.getActiveNode();\n\n        const activeNotePath = activeNode !== null ? treeService.getNotePath(activeNode) : null;\n\n        const rootNode = this.prepareRootNode();\n\n        await this.batchUpdate(async () => {\n            await this.tree.reload([rootNode]);\n        });\n\n        await this.filterHoistedBranch(true);\n\n        if (activeNotePath) {\n            const node = await this.getNodeFromPath(activeNotePath, true);\n\n            if (node) {\n                await node.setActive(true, {noEvents: true, noFocus: true});\n            }\n        }\n    }\n\n    async hoistedNoteChangedEvent({ntxId}) {\n        if (this.isNoteContext(ntxId)) {\n            await this.filterHoistedBranch(true);\n        }\n    }\n\n    async filterHoistedBranch(forceUpdate = false) {\n        if (!this.noteContext) {\n            return;\n        }\n\n        const hoistedNotePath = await treeService.resolveNotePath(this.noteContext.hoistedNoteId);\n\n        if (!forceUpdate && this.lastFilteredHoistedNotePath === hoistedNotePath) {\n            // no need to re-filter if the hoisting did not change\n            // (helps with flickering on simple note change with large subtrees)\n            return;\n        }\n\n        this.lastFilteredHoistedNotePath = hoistedNotePath;\n\n        await this.getNodeFromPath(hoistedNotePath);\n\n        if (this.noteContext.hoistedNoteId === 'root') {\n            this.tree.clearFilter();\n            this.toggleHiddenNode(false); // show everything but the hidden subtree\n        } else {\n            // hack when hoisted note is cloned then it could be filtered multiple times while we want only 1\n            this.tree.filterBranches(node =>\n                node.data.noteId === this.noteContext.hoistedNoteId // optimization to not having always resolve the node path\n                && treeService.getNotePath(node) === hoistedNotePath);\n\n            this.toggleHiddenNode(true); // hoisting will handle hidden note visibility\n        }\n    }\n\n    toggleHiddenNode(show) {\n        const hiddenNode = this.getNodesByNoteId('_hidden')[0];\n        $(hiddenNode.li).toggleClass(\"hidden-node-is-hidden\", !show);\n    }\n\n    frocaReloadedEvent() {\n        this.reloadTreeFromCache();\n    }\n\n    async getHotKeys() {\n        const actions = await keyboardActionsService.getActionsForScope('note-tree');\n        const hotKeyMap = {};\n\n        for (const action of actions) {\n            for (const shortcut of action.effectiveShortcuts) {\n                hotKeyMap[shortcutService.normalizeShortcut(shortcut)] = node => {\n                    const notePath = treeService.getNotePath(node);\n\n                    this.triggerCommand(action.actionName, {node, notePath});\n\n                    return false;\n                }\n            }\n        }\n\n        return hotKeyMap;\n    }\n\n    /**\n     * @param {FancytreeNode} node\n     */\n    getSelectedOrActiveBranchIds(node) {\n        const nodes = this.getSelectedOrActiveNodes(node);\n\n        return nodes.map(node => node.data.branchId);\n    }\n\n    /**\n     * @param {FancytreeNode} node\n     */\n    getSelectedOrActiveNoteIds(node) {\n        const nodes = this.getSelectedOrActiveNodes(node);\n\n        return nodes.map(node => node.data.noteId);\n    }\n\n    async deleteNotesCommand({node}) {\n        const branchIds = this.getSelectedOrActiveBranchIds(node)\n            .filter(branchId => !branchId.startsWith('virt-')); // search results can't be deleted\n\n        if (!branchIds.length) {\n            return;\n        }\n\n        await branchService.deleteNotes(branchIds);\n\n        this.clearSelectedNodes();\n    }\n\n    canBeMovedUpOrDown(node) {\n        if (node.data.noteId === 'root') {\n            return false;\n        }\n\n        const parentNote = froca.getNoteFromCache(node.getParent().data.noteId);\n\n        return !parentNote?.hasLabel('sorted');\n    }\n\n    moveNoteUpCommand({node}) {\n        if (!this.canBeMovedUpOrDown(node)) {\n            return;\n        }\n\n        const beforeNode = node.getPrevSibling();\n\n        if (beforeNode !== null) {\n            branchService.moveBeforeBranch([node.data.branchId], beforeNode.data.branchId);\n        }\n    }\n\n    moveNoteDownCommand({node}) {\n        if (!this.canBeMovedUpOrDown(node)) {\n            return;\n        }\n\n        const afterNode = node.getNextSibling();\n\n        if (afterNode !== null) {\n            branchService.moveAfterBranch([node.data.branchId], afterNode.data.branchId);\n        }\n    }\n\n    moveNoteUpInHierarchyCommand({node}) {\n        branchService.moveNodeUpInHierarchy(node);\n    }\n\n    moveNoteDownInHierarchyCommand({node}) {\n        const toNode = node.getPrevSibling();\n\n        if (toNode !== null) {\n            branchService.moveToParentNote([node.data.branchId], toNode.data.branchId);\n        }\n    }\n\n    addNoteAboveToSelectionCommand() {\n        const node = this.getFocusedNode();\n\n        if (!node) {\n            return;\n        }\n\n        if (node.isActive()) {\n            node.setSelected(true);\n        }\n\n        const prevSibling = node.getPrevSibling();\n\n        if (prevSibling) {\n            prevSibling.setActive(true, {noEvents: true});\n\n            if (prevSibling.isSelected()) {\n                node.setSelected(false);\n            }\n\n            prevSibling.setSelected(true);\n        }\n    }\n\n    addNoteBelowToSelectionCommand() {\n        const node = this.getFocusedNode();\n\n        if (!node) {\n            return;\n        }\n\n        if (node.isActive()) {\n            node.setSelected(true);\n        }\n\n        const nextSibling = node.getNextSibling();\n\n        if (nextSibling) {\n            nextSibling.setActive(true, {noEvents: true});\n\n            if (nextSibling.isSelected()) {\n                node.setSelected(false);\n            }\n\n            nextSibling.setSelected(true);\n        }\n    }\n\n    expandSubtreeCommand({node}) {\n        this.expandTree(node);\n    }\n\n    collapseSubtreeCommand({node}) {\n        this.collapseTree(node);\n    }\n\n    async recentChangesInSubtreeCommand({node}) {\n        this.triggerCommand(\"showRecentChanges\", {ancestorNoteId: node.data.noteId});\n    }\n\n    selectAllNotesInParentCommand({node}) {\n        for (const child of node.getParent().getChildren()) {\n            child.setSelected(true);\n        }\n    }\n\n    copyNotesToClipboardCommand({node}) {\n        clipboard.copy(this.getSelectedOrActiveBranchIds(node));\n    }\n\n    cutNotesToClipboardCommand({node}) {\n        clipboard.cut(this.getSelectedOrActiveBranchIds(node));\n    }\n\n    pasteNotesFromClipboardCommand({node}) {\n        clipboard.pasteInto(node.data.branchId);\n    }\n\n    pasteNotesAfterFromClipboardCommand({node}) {\n        clipboard.pasteAfter(node.data.branchId);\n    }\n\n    async exportNoteCommand({node}) {\n        const notePath = treeService.getNotePath(node);\n\n        this.triggerCommand(\"showExportDialog\", {notePath, defaultType: \"subtree\"});\n    }\n\n    async importIntoNoteCommand({node}) {\n        this.triggerCommand(\"showImportDialog\", {noteId: node.data.noteId});\n    }\n\n    editNoteTitleCommand({node}) {\n        appContext.triggerCommand('focusOnTitle');\n    }\n\n    protectSubtreeCommand({node}) {\n        protectedSessionService.protectNote(node.data.noteId, true, true);\n    }\n\n    unprotectSubtreeCommand({node}) {\n        protectedSessionService.protectNote(node.data.noteId, false, true);\n    }\n\n    duplicateSubtreeCommand({node}) {\n        const nodesToDuplicate = this.getSelectedOrActiveNodes(node);\n\n        for (const nodeToDuplicate of nodesToDuplicate) {\n            const note = froca.getNoteFromCache(nodeToDuplicate.data.noteId);\n\n            if (note.isProtected && !protectedSessionHolder.isProtectedSessionAvailable()) {\n                continue;\n            }\n\n            const branch = froca.getBranch(nodeToDuplicate.data.branchId);\n\n            noteCreateService.duplicateSubtree(nodeToDuplicate.data.noteId, branch.parentNoteId);\n        }\n    }\n\n    moveShortcutToVisibleCommand({node, selectedOrActiveBranchIds}) {\n        branchService.moveToParentNote(selectedOrActiveBranchIds, '_lbVisibleLaunchers');\n    }\n\n    moveShortcutToAvailableCommand({node, selectedOrActiveBranchIds}) {\n        branchService.moveToParentNote(selectedOrActiveBranchIds, '_lbAvailableLaunchers');\n    }\n\n    addNoteLauncherCommand({node}) {\n        this.createLauncherNote(node, 'note');\n    }\n\n    addScriptLauncherCommand({node}) {\n        this.createLauncherNote(node, 'script');\n    }\n\n    addWidgetLauncherCommand({node}) {\n        this.createLauncherNote(node, 'customWidget');\n    }\n\n    addSpacerLauncherCommand({node}) {\n        this.createLauncherNote(node, 'spacer');\n    }\n\n    async createLauncherNote(node, launcherType) {\n        const resp = await server.post(`special-notes/launchers/${node.data.noteId}/${launcherType}`);\n\n        if (!resp.success) {\n            toastService.showError(resp.message);\n        }\n\n        await ws.waitForMaxKnownEntityChangeId();\n\n        appContext.tabManager.getActiveContext().setNote(resp.note.noteId);\n    }\n}\n","import NoteContextAwareWidget from \"./note_context_aware_widget.js\";\nimport protectedSessionHolder from \"../services/protected_session_holder.js\";\nimport server from \"../services/server.js\";\nimport SpacedUpdate from \"../services/spaced_update.js\";\nimport appContext from \"../components/app_context.js\";\nimport branchService from \"../services/branches.js\";\nimport shortcutService from \"../services/shortcuts.js\";\n\nconst TPL = `\n<div class=\"note-title-widget\">\n    <style>\n    .note-title-widget {\n        flex-grow: 1000;\n        height: 100%;\n    }\n    \n    .note-title-widget input.note-title {\n        font-size: 180%;\n        border: 0;\n        min-width: 5em;\n        width: 100%;\n    }\n    \n    .note-title-widget input.note-title.protected {\n        text-shadow: 4px 4px 4px var(--muted-text-color);\n    }\n    </style>\n\n    <input autocomplete=\"off\" value=\"\" placeholder=\"输入笔记标题...\" class=\"note-title\" tabindex=\"100\">\n</div>`;\n\nexport default class NoteTitleWidget extends NoteContextAwareWidget {\n    constructor() {\n        super();\n\n        this.spacedUpdate = new SpacedUpdate(async () => {\n            const title = this.$noteTitle.val();\n\n            protectedSessionHolder.touchProtectedSessionIfNecessary(this.note);\n\n            await server.put(`notes/${this.noteId}/title`, {title}, this.componentId);\n        });\n\n        this.deleteNoteOnEscape = false;\n\n        appContext.addBeforeUnloadListener(this);\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$noteTitle = this.$widget.find(\".note-title\");\n\n        this.$noteTitle.on('input', () => this.spacedUpdate.scheduleUpdate());\n\n        this.$noteTitle.on('blur', () => {\n            this.spacedUpdate.updateNowIfNecessary();\n\n            this.deleteNoteOnEscape = false;\n        });\n\n        shortcutService.bindElShortcut(this.$noteTitle, 'esc', () => {\n            if (this.deleteNoteOnEscape && this.noteContext.isActive()) {\n                branchService.deleteNotes(Object.values(this.noteContext.note.parentToBranch));\n            }\n        });\n\n        shortcutService.bindElShortcut(this.$noteTitle, 'return', () => {\n            this.triggerCommand('focusOnDetail', {ntxId: this.noteContext.ntxId});\n        });\n    }\n\n    async refreshWithNote(note) {\n        const isReadOnly = (note.isProtected && !protectedSessionHolder.isProtectedSessionAvailable())\n            || ['_lbRoot', '_lbAvailableLaunchers', '_lbVisibleLaunchers'].includes(note.noteId)\n            || this.noteContext.viewScope.viewMode !== 'default';\n\n        this.$noteTitle.val(\n            isReadOnly\n                ? await this.noteContext.getNavigationTitle()\n                : note.title\n        );\n        this.$noteTitle.prop(\"readonly\", isReadOnly);\n\n        this.setProtectedStatus(note);\n    }\n\n    /** @param {FNote} note */\n    setProtectedStatus(note) {\n        this.$noteTitle.toggleClass(\"protected\", !!note.isProtected);\n    }\n\n    async beforeNoteSwitchEvent({noteContext}) {\n        if (this.isNoteContext(noteContext.ntxId)) {\n            await this.spacedUpdate.updateNowIfNecessary();\n        }\n    }\n\n    async beforeNoteContextRemoveEvent({ntxIds}) {\n        if (this.isNoteContext(ntxIds)) {\n            await this.spacedUpdate.updateNowIfNecessary();\n        }\n    }\n\n    focusOnTitleEvent() {\n        if (this.noteContext && this.noteContext.isActive()) {\n            this.$noteTitle.trigger('focus');\n        }\n    }\n\n    focusAndSelectTitleEvent({isNewNote} = {isNewNote: false}) {\n        if (this.noteContext && this.noteContext.isActive()) {\n            this.$noteTitle\n                .trigger('focus')\n                .trigger('select');\n\n            this.deleteNoteOnEscape = isNewNote;\n        }\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.isNoteReloaded(this.noteId)) {\n            // not updating the title specifically since the synced title might be older than what the user is currently typing\n            this.setProtectedStatus(this.note);\n        }\n\n        if (loadResults.isNoteReloaded(this.noteId, this.componentId)) {\n            this.refresh();\n        }\n    }\n\n    beforeUnloadEvent() {\n        return this.spacedUpdate.isAllSavedAndTriggerUpdate();\n    }\n}\n","import server from \"./server.js\";\n\n/**\n * @param $el - element on which to init autocomplete\n * @param attributeType - \"relation\" or \"label\" or callback providing one of those values as a type of autocompleted attributes\n * @param open - should the autocomplete be opened after init?\n */\nfunction initAttributeNameAutocomplete({ $el, attributeType, open }) {\n    if (!$el.hasClass(\"aa-input\")) {\n        $el.autocomplete({\n            appendTo: document.querySelector('body'),\n            hint: false,\n            openOnFocus: true,\n            minLength: 0,\n            tabAutocomplete: false\n        }, [{\n            displayKey: 'name',\n            // disabling cache is important here because otherwise cache can stay intact when switching between attribute type which will lead to autocomplete displaying attribute names for incorrect attribute type\n            cache: false,\n            source: async (term, cb) => {\n                const type = typeof attributeType === \"function\" ? attributeType() : attributeType;\n\n                const names = await server.get(`attribute-names/?type=${type}&query=${encodeURIComponent(term)}`);\n                const result = names.map(name => ({name}));\n\n                cb(result);\n            }\n        }]);\n\n        $el.on('autocomplete:opened', () => {\n            if ($el.attr(\"readonly\")) {\n                $el.autocomplete('close');\n            }\n        });\n    }\n\n    if (open) {\n        $el.autocomplete(\"open\");\n    }\n}\n\nasync function initLabelValueAutocomplete({ $el, open, nameCallback }) {\n    if ($el.hasClass(\"aa-input\")) {\n        // we reinit every time because autocomplete seems to have a bug where it retains state from last\n        // open even though the value was reset\n        $el.autocomplete('destroy');\n    }\n\n    const attributeName = nameCallback();\n\n    if (attributeName.trim() === \"\") {\n        return;\n    }\n\n    const attributeValues = (await server.get(`attribute-values/${encodeURIComponent(attributeName)}`))\n        .map(attribute => ({ value: attribute }));\n\n    if (attributeValues.length === 0) {\n        return;\n    }\n\n    $el.autocomplete({\n        appendTo: document.querySelector('body'),\n        hint: false,\n        openOnFocus: false, // handled manually\n        minLength: 0,\n        tabAutocomplete: false\n    }, [{\n        displayKey: 'value',\n        cache: false,\n        source: async function (term, cb) {\n            term = term.toLowerCase();\n\n            const filtered = attributeValues.filter(attr => attr.value.toLowerCase().includes(term));\n\n            cb(filtered);\n        }\n    }]);\n\n    $el.on('autocomplete:opened', () => {\n        if ($el.attr(\"readonly\")) {\n            $el.autocomplete('close');\n        }\n    });\n\n    if (open) {\n        $el.autocomplete(\"open\");\n    }\n}\n\nexport default {\n    initAttributeNameAutocomplete,\n    initLabelValueAutocomplete\n}\n","import server from \"../../services/server.js\";\nimport froca from \"../../services/froca.js\";\nimport linkService from \"../../services/link.js\";\nimport attributeAutocompleteService from \"../../services/attribute_autocomplete.js\";\nimport noteAutocompleteService from \"../../services/note_autocomplete.js\";\nimport promotedAttributeDefinitionParser from '../../services/promoted_attribute_definition_parser.js';\nimport NoteContextAwareWidget from \"../note_context_aware_widget.js\";\nimport SpacedUpdate from \"../../services/spaced_update.js\";\nimport utils from \"../../services/utils.js\";\nimport shortcutService from \"../../services/shortcuts.js\";\nimport appContext from \"../../components/app_context.js\";\n\nconst TPL = `\n<div class=\"attr-detail\">\n    <style>\n        .attr-detail {\n            display: block;\n            background-color: var(--accented-background-color);\n            border: 1px solid var(--main-border-color);\n            border-radius: 4px;\n            z-index: 1000;\n            padding: 15px;\n            position: absolute;\n            width: 500px;\n            max-height: 600px;\n            overflow: auto;\n            box-shadow: 10px 10px 93px -25px black;\n        }\n        \n        .attr-help td {\n            color: var(--muted-text-color);\n            padding: 5px;\n        }\n        \n        .related-notes-list {\n            padding-left: 20px;\n            margin-top: 10px;\n            margin-bottom: 10px;\n        }\n        \n        .attr-edit-table {\n            width: 100%;\n        }\n        \n        .attr-edit-table th {\n            text-align: left;\n        }\n        \n        .attr-edit-table td input {\n            width: 100%;\n        }\n        \n        .close-attr-detail-button {\n            font-size: x-large;\n            cursor: pointer;\n            position: relative;\n            top: -2px;\n        }\n        \n        .attr-save-delete-button-container {\n            display: flex; \n            margin-top: 15px;\n        }\n        \n        .attr-detail input[readonly] {\n            background-color: var(--accented-background-color) !important;\n        }\n    </style>\n\n    <div style=\"display: flex; justify-content: space-between; margin-bottom: 8px;\">\n        <h5 class=\"attr-detail-title\"></h5>\n        \n        <span class=\"bx bx-x close-attr-detail-button\" title=\"取消修改并关闭\"></span>\n    </div>\n\n    <div class=\"attr-is-owned-by\"></div>\n\n    <table class=\"attr-edit-table\">\n        <tr title=\"属性名称只能由字母数字字符, 冒号和下划线组成\">\n            <th>名称:</th>\n            <td><input type=\"text\" class=\"attr-input-name form-control\" /></td>\n        </tr>\n        <tr class=\"attr-help\"></tr>\n        <tr class=\"attr-row-value\">\n            <th>值:</th>\n            <td><input type=\"text\" class=\"attr-input-value form-control\" /></td>\n        </tr>\n        <tr class=\"attr-row-target-note\">\n            <th title=\"关系是源笔记和目标笔记之间的命名连接.\">目标笔记:</th>\n            <td>\n                <div class=\"input-group\">\n                    <input type=\"text\" class=\"attr-input-target-note form-control\" />\n                </div>\n            </td>\n        </tr>\n        <tr class=\"attr-row-promoted\"\n            title=\"升级的属性在笔记上突出显示.\">\n            <th>升级属性:</th>\n            <td><input type=\"checkbox\" class=\"attr-input-promoted form-control form-control-sm\" /></td>\n        </tr>\n        <tr class=\"attr-row-promoted-alias\">\n            <th title=\"The name to be displayed in the promoted attributes UI.\">Alias:</th>\n            <td>\n                <div class=\"input-group\">\n                    <input type=\"text\" class=\"attr-input-promoted-alias form-control\" />\n                </div>\n            </td>\n        </tr>\n        <tr class=\"attr-row-multiplicity\">\n            <th title=\"多重性定义可以创建多少个相同名称的属性 - 最大值为1或大于1.\">多重性:</th>\n            <td>\n                <select class=\"attr-input-multiplicity form-control\">\n                  <option value=\"single\">单值</option>\n                  <option value=\"multi\">多值</option>\n                </select>\n            </td>\n        </tr>\n        <tr class=\"attr-row-label-type\">\n            <th title=\"标签的类型将帮助Trilium选择合适的界面来输入标签值.\">类型:</th>\n            <td>\n                <select class=\"attr-input-label-type form-control\">\n                  <option value=\"text\">文本</option>\n                  <option value=\"number\">数字</option>\n                  <option value=\"boolean\">布尔</option>\n                  <option value=\"date\">日期</option>\n                  <option value=\"datetime\">Date & Time</option>\n                  <option value=\"url\">URL</option>\n                </select>\n            </td>\n        </tr>\n        <tr class=\"attr-row-number-precision\">\n            <th title=\"值设置界面中可以设置的小数点位数.\">精度</th>\n            <td>\n                <div class=\"input-group\">\n                    <input type=\"number\" class=\"form-control attr-input-number-precision\" style=\"text-align: right\">\n                    <div class=\"input-group-append\">\n                        <span class=\"input-group-text\">位数</span>\n                    </div>\n                </div>\n            </td>\n        </tr>\n        <tr class=\"attr-row-inverse-relation\">\n            <th title=\"可选设置用于定义与此相对的关系. 比如 父-子 关系是互为父子.\">逆关系</th>\n            <td>\n                <div class=\"input-group\">\n                    <input type=\"text\" class=\"attr-input-inverse-relation form-control\" />\n                </div>\n            </td>\n        </tr>\n        <tr title=\"可继承属性将被继承给该树下的所有后代.\">\n            <th>可继承</th>\n            <td><input type=\"checkbox\" class=\"attr-input-inheritable form-control form-control-sm\" /></td>\n        </tr>\n    </table>\n\n    <div class=\"attr-save-delete-button-container\">\n        <button class=\"btn btn-primary btn-sm attr-save-changes-and-close-button\" \n            style=\"flex-grow: 1; margin-right: 20px\">\n            保存并关闭 <kbd>Ctrl+回车</kbd></button>\n            \n        <button class=\"btn btn-secondary btn-sm attr-delete-button\">\n            删除</button>\n    </div>\n\n    <div class=\"related-notes-container\">\n        <br/>\n\n        <h5 class=\"related-notes-tile\">其它含有这个标签的笔记</h5>\n        \n        <ul class=\"related-notes-list\"></ul>\n        \n        <div class=\"related-notes-more-notes\"></div>\n    </div>\n</div>`;\n\nconst DISPLAYED_NOTES = 10;\n\nconst ATTR_TITLES = {\n    \"label\": \"标签详情\",\n    \"label-definition\": \"标签定义详情\",\n    \"relation\": \"关系详情\",\n    \"relation-definition\": \"关系定义详情\"\n};\n\nconst ATTR_HELP = {\n    \"label\": {\n        \"disableVersioning\": \"禁用自动版本管理. 对于很大但是不重要的笔记有用, 比如编写脚本用的JS库文件.\",\n        \"calendarRoot\": \"把笔记标记为日记的根笔记, 这个标签只能有一个笔记有.\",\n        \"archived\": \"默认情况下, 带有此标签的笔记不会在搜索结果中(在跳转到, 添加链接等对话框中也不会显示).\",\n        \"excludeFromExport\": \"笔记(及其子树)不会包含在任何笔记导出中\",\n        \"run\": `定义哪个事件脚本应该运行. 可取的值有:\n                <ul>\n                    <li>frontendStartup - 当Trilium前端启动(或刷新)时.</li>\n                    <li>backendStartup - 当Trilium后端启动.</li>\n                    <li>hourly - 每小时一次. 可以通过 <code>runAtHour</code> 标签来指定.</li>\n                    <li>daily - 每天一次</li>\n                </ul>`,\n        \"runOnInstance\": \"定义应在哪个Trilium实例上运行. 默认是在所有实例上运行.\",\n        \"runAtHour\": \"定义在什么时候运行. 需要和 <code>#run=hourly</code> 一起使用, 可以同时定义多个来实现一天内多次运行.\",\n        \"disableInclusion\": \"父级脚本的执行过程中不会包含具有此标签的脚本.\",\n        \"sorted\": \"使子笔记按标题按字母顺序排序\",\n        \"sortDirection\": \"ASC升序(默认) 或 DESC降序\",\n        \"sortFoldersFirst\": \"目录(有子笔记的)在前\",\n        \"top\": \"将笔记放在其父笔记的顶部(仅适用于排序的父级)\",\n        \"hidePromotedAttributes\": \"隐藏此笔记中的升级属性\",\n        \"readOnly\": \"编辑器处于只读模式. 只对文本和代码笔记有效.\",\n        \"autoReadOnlyDisabled\": \"文本/代码笔记过大时, 可以自动设置为阅读模式. 你可以通过给需要的每个笔记添加这个标签来单独禁用这个功能.\",\n        \"appCss\": \"标记可以被Trilium加载用来修改Trilium的外观的CSS笔记.\",\n        \"appTheme\": \"标记可以被作为Trilium主题使用的CSS笔记, 这些笔记可以在Trilium的设置里看到.\",\n        \"cssClass\": \"这个标签的值会被当作CSS类加到对应的笔记中, 可以被用来单独设置笔记的主题. 这个标签也可以在模板笔记里使用.\",\n        \"iconClass\": \"这个标签的值作为CSS类添加到笔记上, 用来修改对应笔记的图标. 比如 bx bx-home 会使用 boxicons 相应的图标. 这个标签也可以在模板笔记里使用. \",\n        \"pageSize\": \"笔记清单中每页的个数\",\n        \"customRequestHandler\": '见 <a href=\"javascript:\" data-help-page=\"Custom request handler\">自定义请求处理器</a>',\n        \"customResourceProvider\": '见 <a href=\"javascript:\" data-help-page=\"Custom request handler\">自定义请求处理器</a>',\n        \"widget\": \"将此笔记标记为自定义窗口小部件, 该窗口小部件会被添加到Trilium部件树中\",\n        \"workspace\": \"将此笔记标记为可简单提升的工作区\",\n        \"workspaceIconClass\": \"提升此笔记时, 笔记标签页中使用的CSS图标\",\n        \"workspaceTabBackgroundColor\": \"提升此笔记时, 笔记标签页中使用的CSS颜色\",\n        \"workspaceCalendarRoot\": \"定义每个工作空间的日历根笔记\",\n        \"workspaceTemplate\": \"这个笔记会出现在新建笔记时的可用模板选择中, 但是只有在提升笔记中包含这个笔记才有效\",\n        \"searchHome\": \"新的搜索记录将被创建为该笔记的子笔记\",\n        \"workspaceSearchHome\": \"当笔记的某些父级笔记被提升时, 新的搜索记录将被创建为该笔记的子笔记\",\n        \"inbox\": \"新笔记的默认收件箱位置 - 当你使用侧边栏的\\\"新建笔记\\\"按钮, 笔记会被创建为标记有<code>#inbox</code>标签的笔记的子笔记\",\n        \"workspaceInbox\": \"当笔记的某些父级笔记被提升时,  新笔记的默认收件箱位置\",\n        \"sqlConsoleHome\": \"SQL控制台笔记的默认位置\",\n        \"bookmarkFolder\": \"带有此标签的笔记将作为文件夹出现在书签中(允许访问其子笔记)\",\n        \"shareHiddenFromTree\": \"此笔记在左侧笔记树中隐藏, 但仍可通过其 URL 访问\",\n        \"shareExternalLink\": \"note will act as a link to an external website in the share tree\",\n        \"shareAlias\": \"定义一个别名,使用该别名可以在 https://服务器地址/share/[你定义的别名] 下使用该笔记\",\n        \"shareOmitDefaultCss\": \"默认共享页面 CSS 将被忽略. 当你想自定义样式时请使用这个标签.\",\n        \"shareRoot\": \"将笔记标记为 /share 访问的首页\",\n        \"shareDescription\": \"定义需要加入到HTML的meta标签的文字\",\n        \"shareRaw\": \"笔记会通过原始格式直接展示, 不会通过HTML页面封装\",\n        \"shareDisallowRobotIndexing\": `通过 <code>X-Robots-Tag: noindex</code> 请求头来阻止爬虫机器人抓取该笔记`,\n        \"shareCredentials\": \"需要身份验证才能访问此共享笔记. 值的格式'用户名:密码'. 别忘了设置为可继承来对所有子笔记和图片生效.\",\n        \"shareIndex\": \"有这个标签的笔记会列出所有分享笔记的根笔记\",\n        \"displayRelations\": \"显示通过逗号分隔的关联关系. 其它的会被隐藏.\",\n        \"hideRelations\": \"隐藏通过逗号分隔的关联关系, 而其它的会显示出来.\",\n        \"titleTemplate\": `当前笔记所属子笔记的默认标题. 这里的字符会被作为Javascript解析, 因此可以使用 <code>now</code> 和 <code>parentNote</code> 来生成动态标题. 例如:\n                        \n                        <ul>\n                            <li><code>\\${parentNote.getLabelValue('authorName')}的文学作品</code></li>\n                            <li><code>\\${now.format('YYYY-MM-DD HH:mm:ss')} 的日志</code></li>\n                        </ul>\n                        \n                        详见 <a href=\"https://github.com/zadam/trilium/wiki/Default-note-title\">wiki</a>. <a href=\"https://zadam.github.io/trilium/backend_api/Note.html\">parentNote</a> 和 <a href=\"https://day.js.org/docs/en/display/format\">now</a> 的API文档.`,\n        \"template\": \"这个笔记会出现在新建笔记时的可用模板选择中\",\n        \"toc\": \"<code>#toc</code> or <code>#toc=show</code>将会强制显示目录,<code>#toc=hide</code> 会隐藏它 如果标签不存在, 会遵循全局设置的配置\",\n        \"color\": \"定义笔记树、链接等中笔记的颜色. 任何有效的CSS颜色值都可以使用, 例如 'red' 或 #a13d5f\",\n        \"keyboardShortcut\": \"定义立即跳转到此笔记的键盘快捷键.例如: 'ctrl+alt+e'. 更改需要重新加载前端才能生效.\",\n        \"keepCurrentHoisting\": \"即使该笔记在当前提升的子树中无法显示, 打开此链接也不会更改提升.\",\n        \"executeButton\": \"执行当前代码笔记的按钮的标题\",\n        \"executeDescription\": \"与执行按钮一起显示的当前代码笔记的较长描述\",\n        \"excludeFromNoteMap\": \"具有此标签的笔记将从笔记地图中隐藏\",\n        \"newNotesOnTop\": \"新笔记将创建在父笔记的顶部, 而不是底部.\",\n        \"hideHighlightWidget\": \"Hide Hightlight List widget\"\n    },\n    \"relation\": {\n        \"runOnNoteCreation\": \"在后端创建笔记时执行. Use this relation if you want to run the script for all notes created under a specific subtree. In that case, create it on the subtree root note and make it inheritable. A new note created within the subtree (any depth) will trigger the script.\",\n        \"runOnChildNoteCreation\": \"executes when new note is created under the note where this relation is defined\",\n        \"runOnNoteTitleChange\": \"笔记标题修改时执行(还包括笔记创建)\",\n        \"runOnNoteContentChange\": \"executes when note content is changed (includes note creation as well).\",\n        \"runOnNoteChange\": \"修改笔记时执行(还包括笔记创建). Does not include content changes\",\n        \"runOnNoteDeletion\": \"在笔记删除时执行\",\n        \"runOnBranchCreation\": \"在分支创建时执行. 分支是父笔记和子笔记之间的连接, 会在比如克隆笔记或移动笔记时创建.\",\n        \"runOnBranchChange\": \"executes when a branch is updated.\",\n        \"runOnBranchDeletion\": \"在分支删除时执行. 分支是父笔记和子笔记之间的连接, 会在比如移动笔记(旧分支/连接删除)时删除.\",\n        \"runOnAttributeCreation\": \"executes when new attribute is created for the note which defines this relation\",\n        \"runOnAttributeChange\": \" executes when the attribute is changed of a note which defines this relation. This is triggered also when the attribute is deleted\",\n        \"template\": \"note's attributes will be inherited even without a parent-child relationship, note's content and subtree will be added to instance notes if empty. See documentation for details.\",\n        \"inherit\": \"note's attributes will be inherited even without a parent-child relationship. See template relation for a similar concept. See attribute inheritance in the documentation.\",\n        \"renderNote\": '类型为\"渲染笔记\"的笔记会被作为代码笔记(HTML或脚本)显示, 并且必须指定需要渲染的笔记关系.',\n        \"widget\": \"此关系的目标将被执行, 并在侧边栏中显示为小部件\",\n        \"shareCss\": \"会被注入到分享页面的CSS笔记. CSS笔记必须也在共享笔记的子树范围内. 请考同时使用 'shareHiddenFromTree' 和 'shareOmitDefaultCss' 标签.\",\n        \"shareJs\": \"会被注入到分享页面的JS笔记. JS笔记必须也在共享笔记的子树范围内. 请考同时使用 'shareHiddenFromTree' 标签.\",\n        \"shareTemplate\": \"Embedded JavaScript note that will be used as the template for displaying the shared note. Falls back to the default template. Consider using 'shareHiddenFromTree'.\",\n        \"shareFavicon\": \"设置为共享页面 Favicon 的笔记. 一般把它放到共享笔记的根目录, 同时让它设置为可继承的. Favicon 笔记必须也在共享笔记的子树范围内. 请考虑同时使用 'shareHiddenFromTree' 标签\",\n    }\n};\n\nexport default class AttributeDetailWidget extends NoteContextAwareWidget {\n    async refresh() {\n        // switching note/tab should close the widget\n\n        this.hide();\n    }\n\n    doRender() {\n        this.relatedNotesSpacedUpdate = new SpacedUpdate(async () => this.updateRelatedNotes(), 1000);\n\n        this.$widget = $(TPL);\n\n        shortcutService.bindElShortcut(this.$widget, 'ctrl+return', () => this.saveAndClose());\n        shortcutService.bindElShortcut(this.$widget, 'esc', () => this.cancelAndClose());\n\n\n        this.$title = this.$widget.find('.attr-detail-title');\n\n        this.$inputName = this.$widget.find('.attr-input-name');\n        this.$inputName.on('input', ev => {\n            if (!ev.originalEvent?.isComposing) { // https://github.com/zadam/trilium/pull/3812\n                this.userEditedAttribute();\n            }\n        });\n        this.$inputName.on('change', () => this.userEditedAttribute());\n        this.$inputName.on('autocomplete:closed', () => this.userEditedAttribute());\n\n        this.$inputName.on('focus', () => {\n            attributeAutocompleteService.initAttributeNameAutocomplete({\n                $el: this.$inputName,\n                attributeType: () => ['relation', 'relation-definition'].includes(this.attrType) ? 'relation' : 'label',\n                open: true\n            });\n        });\n\n        this.$rowValue = this.$widget.find('.attr-row-value');\n        this.$inputValue = this.$widget.find('.attr-input-value');\n        this.$inputValue.on('input', ev => {\n            if (!ev.originalEvent?.isComposing) { // https://github.com/zadam/trilium/pull/3812\n                this.userEditedAttribute();\n            }\n        });\n        this.$inputValue.on('change', () => this.userEditedAttribute());\n        this.$inputValue.on('autocomplete:closed', () => this.userEditedAttribute());\n        this.$inputValue.on('focus', () => {\n            attributeAutocompleteService.initLabelValueAutocomplete({\n                $el: this.$inputValue,\n                open: true,\n                nameCallback: () => this.$inputName.val()\n            });\n        });\n\n        this.$rowPromoted = this.$widget.find('.attr-row-promoted');\n        this.$inputPromoted = this.$widget.find('.attr-input-promoted');\n        this.$inputPromoted.on('change', () => this.userEditedAttribute());\n\n        this.$rowPromotedAlias = this.$widget.find('.attr-row-promoted-alias');\n        this.$inputPromotedAlias = this.$widget.find('.attr-input-promoted-alias');\n        this.$inputPromotedAlias.on('change', () => this.userEditedAttribute());\n\n        this.$rowMultiplicity = this.$widget.find('.attr-row-multiplicity');\n        this.$inputMultiplicity = this.$widget.find('.attr-input-multiplicity');\n        this.$inputMultiplicity.on('change', () => this.userEditedAttribute());\n\n        this.$rowLabelType = this.$widget.find('.attr-row-label-type');\n        this.$inputLabelType = this.$widget.find('.attr-input-label-type');\n        this.$inputLabelType.on('change', () => this.userEditedAttribute());\n\n        this.$rowNumberPrecision = this.$widget.find('.attr-row-number-precision');\n        this.$inputNumberPrecision = this.$widget.find('.attr-input-number-precision');\n        this.$inputNumberPrecision.on('change', () => this.userEditedAttribute());\n\n        this.$rowInverseRelation = this.$widget.find('.attr-row-inverse-relation');\n        this.$inputInverseRelation = this.$widget.find('.attr-input-inverse-relation');\n        this.$inputInverseRelation.on('input', ev => {\n            if (!ev.originalEvent?.isComposing) { // https://github.com/zadam/trilium/pull/3812\n                this.userEditedAttribute();\n            }\n        });\n\n        this.$rowTargetNote = this.$widget.find('.attr-row-target-note');\n        this.$inputTargetNote = this.$widget.find('.attr-input-target-note');\n\n        noteAutocompleteService.initNoteAutocomplete(this.$inputTargetNote, {allowCreatingNotes: true})\n            .on('autocomplete:noteselected', (event, suggestion, dataset) => {\n                if (!suggestion.notePath) {\n                    return false;\n                }\n\n                const pathChunks = suggestion.notePath.split('/');\n\n                this.attribute.value = pathChunks[pathChunks.length - 1]; // noteId\n\n                this.triggerCommand('updateAttributeList', { attributes: this.allAttributes });\n                this.updateRelatedNotes();\n            });\n\n        this.$inputInheritable = this.$widget.find('.attr-input-inheritable');\n        this.$inputInheritable.on('change', () => this.userEditedAttribute());\n\n        this.$closeAttrDetailButton = this.$widget.find('.close-attr-detail-button');\n        this.$closeAttrDetailButton.on('click', () => this.cancelAndClose());\n\n        this.$attrIsOwnedBy = this.$widget.find('.attr-is-owned-by');\n\n        this.$attrSaveDeleteButtonContainer = this.$widget.find('.attr-save-delete-button-container');\n\n        this.$saveAndCloseButton = this.$widget.find('.attr-save-changes-and-close-button');\n        this.$saveAndCloseButton.on('click', () => this.saveAndClose());\n\n        this.$deleteButton = this.$widget.find('.attr-delete-button');\n        this.$deleteButton.on('click', async () => {\n            await this.triggerCommand('updateAttributeList', {\n                attributes: this.allAttributes.filter(attr => attr !== this.attribute)\n            });\n\n            await this.triggerCommand('saveAttributes');\n\n            this.hide();\n        });\n\n        this.$attrHelp = this.$widget.find('.attr-help');\n\n        this.$relatedNotesContainer = this.$widget.find('.related-notes-container');\n        this.$relatedNotesTitle = this.$relatedNotesContainer.find('.related-notes-tile');\n        this.$relatedNotesList = this.$relatedNotesContainer.find('.related-notes-list');\n        this.$relatedNotesMoreNotes = this.$relatedNotesContainer.find('.related-notes-more-notes');\n\n        $(window).on('mousedown', e => {\n            if (!$(e.target).closest(this.$widget[0]).length\n                && !$(e.target).closest(\".algolia-autocomplete\").length\n                && !$(e.target).closest(\"#context-menu-container\").length) {\n                this.hide();\n            }\n        });\n    }\n\n    async showAttributeDetail({allAttributes, attribute, isOwned, x, y, focus}) {\n        if (!attribute) {\n            this.hide();\n\n            return;\n        }\n\n        utils.saveFocusedElement();\n\n        this.attrType = this.getAttrType(attribute);\n\n        const attrName =\n            this.attrType === 'label-definition' ? attribute.name.substr(6)\n                : (this.attrType === 'relation-definition' ? attribute.name.substr(9) : attribute.name);\n\n        const definition = this.attrType.endsWith('-definition')\n            ? promotedAttributeDefinitionParser.parse(attribute.value)\n            : {};\n\n        this.$title.text(ATTR_TITLES[this.attrType]);\n\n        this.allAttributes = allAttributes;\n        this.attribute = attribute;\n\n        // can be slightly slower so just make it async\n        this.updateRelatedNotes();\n\n        this.$attrSaveDeleteButtonContainer.toggle(!!isOwned);\n\n        if (isOwned) {\n            this.$attrIsOwnedBy.hide();\n        }\n        else {\n            this.$attrIsOwnedBy\n                .show()\n                .empty()\n                .append(attribute.type === 'label' ? 'Label' : 'Relation')\n                .append(' is owned by note ')\n                .append(await linkService.createLink(attribute.noteId))\n        }\n\n        this.$inputName\n            .val(attrName)\n            .attr('readonly', () => !isOwned);\n\n        this.$rowValue.toggle(this.attrType === 'label');\n        this.$rowTargetNote.toggle(this.attrType === 'relation');\n\n        this.$rowPromoted.toggle(['label-definition', 'relation-definition'].includes(this.attrType));\n        this.$inputPromoted\n            .prop(\"checked\", !!definition.isPromoted)\n            .attr('disabled', () => !isOwned);\n\n        this.$rowPromotedAlias.toggle(!!definition.isPromoted);\n        this.$inputPromotedAlias\n            .val(definition.promotedAlias)\n            .attr('disabled', () => !isOwned);\n\n        this.$rowMultiplicity.toggle(['label-definition', 'relation-definition'].includes(this.attrType));\n        this.$inputMultiplicity\n            .val(definition.multiplicity)\n            .attr('disabled', () => !isOwned);\n\n        this.$rowLabelType.toggle(this.attrType === 'label-definition');\n        this.$inputLabelType\n            .val(definition.labelType)\n            .attr('disabled', () => !isOwned);\n\n        this.$rowNumberPrecision.toggle(this.attrType === 'label-definition' && definition.labelType === 'number');\n        this.$inputNumberPrecision\n            .val(definition.numberPrecision)\n            .attr('disabled', () => !isOwned);\n\n        this.$rowInverseRelation.toggle(this.attrType === 'relation-definition');\n        this.$inputInverseRelation\n            .val(definition.inverseRelation)\n            .attr('disabled', () => !isOwned);\n\n        if (attribute.type === 'label') {\n            this.$inputValue\n                .val(attribute.value)\n                .attr('readonly', () => !isOwned);\n        }\n        else if (attribute.type === 'relation') {\n            this.$inputTargetNote\n                .attr('readonly', () => !isOwned)\n                .val(\"\")\n                .setSelectedNotePath(\"\");\n\n            if (attribute.value) {\n                const targetNote = await froca.getNote(attribute.value);\n\n                if (targetNote) {\n                    this.$inputTargetNote\n                        .val(targetNote ? targetNote.title : \"\")\n                        .setSelectedNotePath(attribute.value);\n                }\n            }\n        }\n\n        this.$inputInheritable\n            .prop(\"checked\", !!attribute.isInheritable)\n            .attr('disabled', () => !isOwned);\n\n        this.updateHelp();\n\n        this.toggleInt(true);\n\n        const offset = this.parent.$widget.offset();\n        const detPosition = this.getDetailPosition(x, offset);\n\n        this.$widget\n            .css(\"left\", detPosition.left)\n            .css(\"right\", detPosition.right)\n            .css(\"top\", y - offset.top + 70)\n            .css(\"max-height\",\n                this.$widget.outerHeight() + y > $(window).height() - 50\n                    ? $(window).height() - y - 50\n                    : 10000);\n\n        if (focus === 'name') {\n            this.$inputName\n                .trigger('focus')\n                .trigger('select');\n        }\n    }\n\n    getDetailPosition(x, offset) {\n        let left = x - offset.left - this.$widget.outerWidth() / 2;\n        let right = \"\";\n\n        if (left < 0) {\n            left = 10;\n        } else {\n            const rightEdge = left + this.$widget.outerWidth();\n\n            if (rightEdge > this.parent.$widget.outerWidth() - 10) {\n                left = \"\";\n                right = 10;\n            }\n        }\n\n        return {left, right};\n    }\n\n    async saveAndClose() {\n        await this.triggerCommand('saveAttributes');\n\n        this.hide();\n\n        utils.focusSavedElement();\n    }\n\n    async cancelAndClose() {\n        await this.triggerCommand('reloadAttributes');\n\n        this.hide();\n\n        utils.focusSavedElement();\n    }\n\n    userEditedAttribute() {\n        this.updateAttributeInEditor();\n        this.updateHelp();\n        this.relatedNotesSpacedUpdate.scheduleUpdate();\n    }\n\n    updateHelp() {\n        const attrName = this.$inputName.val();\n\n        if (this.attrType in ATTR_HELP && attrName in ATTR_HELP[this.attrType]) {\n            this.$attrHelp\n                .empty()\n                .append($(\"<td colspan=2>\")\n                    .append($(\"<strong>\").text(attrName))\n                    .append(\" - \")\n                    .append(ATTR_HELP[this.attrType][attrName])\n                )\n                .show();\n        }\n        else {\n            this.$attrHelp.empty().hide();\n        }\n    }\n\n    async updateRelatedNotes() {\n        let {results, count} = await server.post('search-related', this.attribute);\n\n        for (const res of results) {\n            res.noteId = res.notePathArray[res.notePathArray.length - 1];\n        }\n\n        results = results.filter(({noteId}) => noteId !== this.noteId);\n\n        if (results.length === 0) {\n            this.$relatedNotesContainer.hide();\n        } else {\n            this.$relatedNotesContainer.show();\n            this.$relatedNotesTitle.text(`其它含有${this.attribute.type}名为\"${this.attribute.name}\"的笔记`);\n\n            this.$relatedNotesList.empty();\n\n            const displayedResults = results.length <= DISPLAYED_NOTES ? results : results.slice(0, DISPLAYED_NOTES);\n            const displayedNotes = await froca.getNotes(displayedResults.map(res => res.noteId));\n            const hoistedNoteId = appContext.tabManager.getActiveContext()?.hoistedNoteId;\n\n            for (const note of displayedNotes) {\n                const notePath = note.getBestNotePathString(hoistedNoteId);\n                const $noteLink = await linkService.createLink(notePath, {showNotePath: true});\n\n                this.$relatedNotesList.append(\n                    $(\"<li>\").append($noteLink)\n                );\n            }\n\n            if (results.length > DISPLAYED_NOTES) {\n                this.$relatedNotesMoreNotes.show().text(`... and ${count - DISPLAYED_NOTES} more.`);\n            } else {\n                this.$relatedNotesMoreNotes.hide();\n            }\n        }\n    }\n\n    getAttrType(attribute) {\n        if (attribute.type === 'label') {\n            if (attribute.name.startsWith('label:')) {\n                return \"label-definition\";\n            } else if (attribute.name.startsWith('relation:')) {\n                return \"relation-definition\";\n            } else {\n                return \"label\";\n            }\n        }\n        else if (attribute.type === 'relation') {\n            return \"relation\";\n        }\n        else {\n            this.$title.text('');\n        }\n    }\n\n    updateAttributeInEditor() {\n        let attrName = this.$inputName.val();\n\n        if (!utils.isValidAttributeName(attrName)) {\n            // invalid characters are simply ignored (from user perspective they are not even entered)\n            attrName = utils.filterAttributeName(attrName);\n\n            this.$inputName.val(attrName);\n        }\n\n        if (this.attrType === 'label-definition') {\n            attrName = `label:${attrName}`;\n        } else if (this.attrType === 'relation-definition') {\n            attrName = `relation:${attrName}`;\n        }\n\n        this.attribute.name = attrName;\n        this.attribute.isInheritable = this.$inputInheritable.is(\":checked\");\n\n        if (this.attrType.endsWith('-definition')) {\n            this.attribute.value = this.buildDefinitionValue();\n        }\n        else if (this.attrType === 'relation') {\n            this.attribute.value = this.$inputTargetNote.getSelectedNoteId();\n        }\n        else {\n            this.attribute.value = this.$inputValue.val();\n        }\n\n        this.triggerCommand('updateAttributeList', { attributes: this.allAttributes });\n    }\n\n    buildDefinitionValue() {\n        const props = [];\n\n        if (this.$inputPromoted.is(\":checked\")) {\n            props.push(\"promoted\");\n\n            if (this.$inputPromotedAlias.val() !== '') {\n                props.push(`alias=${this.$inputPromotedAlias.val()}`);\n            }\n        }\n\n        props.push(this.$inputMultiplicity.val());\n\n        if (this.attrType === 'label-definition') {\n            props.push(this.$inputLabelType.val());\n\n            if (this.$inputLabelType.val() === 'number' && this.$inputNumberPrecision.val() !== '') {\n                props.push(`precision=${this.$inputNumberPrecision.val()}`);\n            }\n        } else if (this.attrType === 'relation-definition' && this.$inputInverseRelation.val().trim().length > 0) {\n            const inverseRelationName = this.$inputInverseRelation.val();\n\n            props.push(`inverse=${utils.filterAttributeName(inverseRelationName)}`);\n        }\n\n        this.$rowNumberPrecision.toggle(\n            this.attrType === 'label-definition'\n            && this.$inputLabelType.val() === 'number');\n\n        this.$rowPromotedAlias.toggle(this.$inputPromoted.is(\":checked\"));\n\n        return props.join(\",\");\n    }\n\n    hide() {\n        this.toggleInt(false);\n    }\n\n    createLink(noteId) {\n        return $(\"<a>\", {\n            href: `#root/${noteId}`,\n            class: 'reference-link'\n        });\n    }\n\n    async noteSwitched() {\n        this.hide();\n    }\n}\n","import utils from \"./utils.js\";\n\nfunction lex(str) {\n    str = str.trim();\n\n    const tokens = [];\n\n    let quotes = false;\n    let currentWord = '';\n\n    function isOperatorSymbol(chr) {\n        return ['=', '*', '>', '<', '!'].includes(chr);\n    }\n\n    function previousOperatorSymbol() {\n        if (currentWord.length === 0) {\n            return false;\n        }\n        else {\n            return isOperatorSymbol(currentWord[currentWord.length - 1]);\n        }\n    }\n\n    /**\n     * @param endIndex - index of the last character of the token\n     */\n    function finishWord(endIndex) {\n        if (currentWord === '') {\n            return;\n        }\n\n        tokens.push({\n            text: currentWord,\n            startIndex: endIndex - currentWord.length + 1,\n            endIndex: endIndex\n        });\n\n        currentWord = '';\n    }\n\n    for (let i = 0; i < str.length; i++) {\n        const chr = str[i];\n\n        if (chr === '\\\\') {\n            if ((i + 1) < str.length) {\n                i++;\n\n                currentWord += str[i];\n            }\n            else {\n                currentWord += chr;\n            }\n\n            continue;\n        }\n        else if (['\"', \"'\", '`'].includes(chr)) {\n            if (!quotes) {\n                if (previousOperatorSymbol()) {\n                    finishWord(i - 1);\n                }\n\n                quotes = chr;\n            }\n            else if (quotes === chr) {\n                quotes = false;\n\n                finishWord(i - 1);\n            }\n            else {\n                // it's a quote, but within other kind of quotes, so it's valid as a literal character\n                currentWord += chr;\n            }\n            continue;\n        }\n        else if (!quotes) {\n            if (currentWord.length === 0 && (chr === '#' || chr === '~')) {\n                currentWord = chr;\n\n                continue;\n            }\n            else if (chr === ' ') {\n                finishWord(i - 1);\n                continue;\n            }\n            else if (['(', ')'].includes(chr)) {\n                finishWord(i - 1);\n\n                currentWord = chr;\n\n                finishWord(i);\n\n                continue;\n            }\n            else if (previousOperatorSymbol() !== isOperatorSymbol(chr)) {\n                finishWord(i - 1);\n\n                currentWord += chr;\n                continue;\n            }\n        }\n\n        currentWord += chr;\n    }\n\n    finishWord(str.length - 1);\n\n    return tokens;\n}\n\nfunction checkAttributeName(attrName) {\n    if (attrName.length === 0) {\n        throw new Error(\"属性名称为空, 请输入属性名称\");\n    }\n\n    if (!utils.isValidAttributeName(attrName)) {\n        throw new Error(`属性名称 \"${attrName}\" 含有不允许的字符, 属性名称只能由字母数字字符组成.`);\n    }\n}\n\nfunction parse(tokens, str, allowEmptyRelations = false) {\n    const attrs = [];\n\n    function context(i) {\n        let {startIndex, endIndex} = tokens[i];\n        startIndex = Math.max(0, startIndex - 20);\n        endIndex = Math.min(str.length, endIndex + 20);\n\n        return `\"${startIndex !== 0 ? \"...\" : \"\"}${str.substr(startIndex, endIndex - startIndex)}${endIndex !== str.length ? \"...\" : \"\"}\"`;\n    }\n\n    for (let i = 0; i < tokens.length; i++) {\n        const {text, startIndex} = tokens[i];\n\n        function isInheritable() {\n            if (tokens.length > i + 3\n                && tokens[i + 1].text === '('\n                && tokens[i + 2].text === '可继承的'\n                && tokens[i + 3].text === ')') {\n\n                i += 3;\n\n                return true;\n            }\n            else {\n                return false;\n            }\n        }\n\n        if (text.startsWith('#')) {\n            const labelName = text.substr(1);\n\n            checkAttributeName(labelName);\n\n            const attr = {\n                type: 'label',\n                name: labelName,\n                isInheritable: isInheritable(),\n                startIndex: startIndex,\n                endIndex: tokens[i].endIndex // i could be moved by isInheritable\n            };\n\n            if (i + 1 < tokens.length && tokens[i + 1].text === \"=\") {\n                if (i + 2 >= tokens.length) {\n                    throw new Error(`${context(i)}里缺少标签 \"${text}\" 的值`);\n                }\n\n                i += 2;\n\n                attr.value = tokens[i].text;\n                attr.endIndex = tokens[i].endIndex;\n            }\n\n            attrs.push(attr);\n        }\n        else if (text.startsWith('~')) {\n            const relationName = text.substr(1);\n\n            checkAttributeName(relationName);\n\n            const attr = {\n                type: 'relation',\n                name: relationName,\n                isInheritable: isInheritable(),\n                startIndex: startIndex,\n                endIndex: tokens[i].endIndex // i could be moved by isInheritable\n            };\n\n            attrs.push(attr);\n\n            if (i + 2 >= tokens.length || tokens[i + 1].text !== '=') {\n                if (allowEmptyRelations) {\n                    break;\n                }\n                else {\n                    throw new Error(`${context(i)} 里的关系 \"${text}\" 应该指向一个笔记.`);\n                }\n            }\n\n            i += 2;\n\n            let notePath = tokens[i].text;\n            if (notePath.startsWith(\"#\")) {\n                notePath = notePath.substr(1);\n            }\n\n            const noteId = notePath.split('/').pop();\n\n            attr.value = noteId;\n            attr.endIndex = tokens[i].endIndex;\n        }\n        else {\n            throw new Error(`${context(i)} 含有无效的属性 \"${text}\"`);\n        }\n    }\n\n    return attrs;\n}\n\nfunction lexAndParse(str, allowEmptyRelations = false) {\n    const tokens = lex(str);\n\n    return parse(tokens, str, allowEmptyRelations);\n}\n\nexport default {\n    lex,\n    parse,\n    lexAndParse\n}\n","import NoteContextAwareWidget from \"../note_context_aware_widget.js\";\nimport noteAutocompleteService from \"../../services/note_autocomplete.js\";\nimport server from \"../../services/server.js\";\nimport contextMenuService from \"../../menus/context_menu.js\";\nimport attributeParser from \"../../services/attribute_parser.js\";\nimport libraryLoader from \"../../services/library_loader.js\";\nimport froca from \"../../services/froca.js\";\nimport attributeRenderer from \"../../services/attribute_renderer.js\";\nimport noteCreateService from \"../../services/note_create.js\";\nimport attributeService from \"../../services/attributes.js\";\nimport linkService from \"../../services/link.js\";\n\nconst HELP_TEXT = `\n<p>要添加标签,只需输入 <code>#rock</code> 或者如果你想设置一个值可以用 <code>#year = 2020</code></p> \n\n<p>添加关系则是类似 <code>~author = @</code>, 自动补全会帮你找到的想要的笔记.</p>\n\n<p>或者可以用右侧的<code>+</code>按钮添加标签和关系.</p>`;\n\nconst TPL = `\n<div style=\"position: relative; padding-top: 10px; padding-bottom: 10px\">\n    <style>\n    .attribute-list-editor {\n        border: 0 !important;\n        outline: 0 !important;\n        box-shadow: none !important;\n        padding: 0 0 0 5px !important;\n        margin: 0 !important;\n        max-height: 100px;\n        overflow: auto;\n        transition: opacity .1s linear;\n    }\n    \n    .attribute-list-editor.ck-content .mention {\n        color: var(--muted-text-color) !important;\n        background: transparent !important;\n    }\n        \n    .save-attributes-button {\n        color: var(--muted-text-color);\n        position: absolute; \n        bottom: 14px;\n        right: 25px;\n        cursor: pointer;\n        border: 1px solid transparent;\n        font-size: 130%;\n    }\n    \n    .add-new-attribute-button {\n        color: var(--muted-text-color);\n        position: absolute; \n        bottom: 13px;\n        right: 0; \n        cursor: pointer;\n        border: 1px solid transparent;\n        font-size: 130%;\n    }\n    \n    .add-new-attribute-button:hover, .save-attributes-button:hover {\n        border: 1px solid var(--button-border-color);\n        border-radius: var(--button-border-radius);\n        background: var(--button-background-color);\n        color: var(--button-text-color);\n    }\n    \n    .attribute-errors {\n        color: red;\n        padding: 5px 50px 0px 5px; /* large right padding to avoid buttons */\n    }\n    </style>\n    \n    <div class=\"attribute-list-editor\" tabindex=\"200\"></div>\n\n    <div class=\"bx bx-save save-attributes-button\" title=\"保存属性<回车>\"></div>\n    <div class=\"bx bx-plus add-new-attribute-button\" title=\"添加新属性\"></div>\n    \n    <div class=\"attribute-errors\" style=\"display: none;\"></div>\n</div>\n`;\n\nconst mentionSetup = {\n    feeds: [\n        {\n            marker: '@',\n            feed: queryText => noteAutocompleteService.autocompleteSourceForCKEditor(queryText),\n            itemRenderer: item => {\n                const itemElement = document.createElement('button');\n\n                itemElement.innerHTML = `${item.highlightedNotePathTitle} `;\n\n                return itemElement;\n            },\n            minimumCharacters: 0\n        },\n        {\n            marker: '#',\n            feed: async queryText => {\n                const names = await server.get(`attribute-names/?type=label&query=${encodeURIComponent(queryText)}`);\n\n                return names.map(name => {\n                    return {\n                        id: `#${name}`,\n                        name: name\n                    }\n                });\n            },\n            minimumCharacters: 0\n        },\n        {\n            marker: '~',\n            feed: async queryText => {\n                const names = await server.get(`attribute-names/?type=relation&query=${encodeURIComponent(queryText)}`);\n\n                return names.map(name => {\n                    return {\n                        id: `~${name}`,\n                        name: name\n                    }\n                });\n            },\n            minimumCharacters: 0\n        }\n    ]\n};\n\nconst editorConfig = {\n    removePlugins: [\n        'Heading',\n        'Link',\n        'Autoformat',\n        'Bold',\n        'Italic',\n        'Underline',\n        'Strikethrough',\n        'Code',\n        'Superscript',\n        'Subscript',\n        'BlockQuote',\n        'Image',\n        'ImageCaption',\n        'ImageStyle',\n        'ImageToolbar',\n        'ImageUpload',\n        'ImageResize',\n        'List',\n        'TodoList',\n        'PasteFromOffice',\n        'Table',\n        'TableToolbar',\n        'TableProperties',\n        'TableCellProperties',\n        'Indent',\n        'IndentBlock',\n        'BlockToolbar',\n        'ParagraphButtonUI',\n        'HeadingButtonsUI',\n        'UploadimagePlugin',\n        'InternalLinkPlugin',\n        'MarkdownImportPlugin',\n        'CuttonotePlugin',\n        'TextTransformation',\n        'Font',\n        'FontColor',\n        'FontBackgroundColor',\n        'CodeBlock',\n        'SelectAll',\n        'IncludeNote',\n        'CutToNote',\n        'Mathematics',\n        'AutoformatMath',\n        'indentBlockShortcutPlugin',\n        'removeFormatLinksPlugin'\n    ],\n    toolbar: {\n        items: []\n    },\n    placeholder: \"在这里输入标签和关系\",\n    mention: mentionSetup\n};\n\nexport default class AttributeEditorWidget extends NoteContextAwareWidget {\n    constructor(attributeDetailWidget) {\n        super();\n\n        this.attributeDetailWidget = attributeDetailWidget;\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$editor = this.$widget.find('.attribute-list-editor');\n\n        this.initialized = this.initEditor();\n\n        this.$editor.on('keydown', async e => {\n            if (e.which === 13) {\n                // allow autocomplete to fill the result textarea\n                setTimeout(() => this.save(), 100);\n            }\n\n            this.attributeDetailWidget.hide();\n        });\n\n        this.$editor.on('blur', () => this.save());\n\n        this.$addNewAttributeButton = this.$widget.find('.add-new-attribute-button');\n        this.$addNewAttributeButton.on('click', e => this.addNewAttribute(e));\n\n        this.$saveAttributesButton = this.$widget.find('.save-attributes-button');\n        this.$saveAttributesButton.on('click', () => this.save());\n\n        this.$errors = this.$widget.find('.attribute-errors');\n    }\n\n    addNewAttribute(e) {\n        contextMenuService.show({\n            x: e.pageX,\n            y: e.pageY,\n            orientation: 'left',\n            items: [\n                {title: `添加新标签 <kbd data-command=\"addNewLabel\"></kbd>`, command: \"addNewLabel\", uiIcon: \"bx bx-hash\"},\n                {title: `添加新关系 <kbd data-command=\"addNewRelation\"></kbd>`, command: \"addNewRelation\", uiIcon: \"bx bx-transfer\"},\n                {title: \"----\"},\n                {title: \"添加新标签定义\", command: \"addNewLabelDefinition\", uiIcon: \"bx bx-empty\"},\n                {title: \"添加新关系定义\", command: \"addNewRelationDefinition\", uiIcon: \"bx bx-empty\"},\n            ],\n            selectMenuItemHandler: ({command}) => this.handleAddNewAttributeCommand(command)\n        });\n    }\n\n    // triggered from keyboard shortcut\n    async addNewLabelEvent({ntxId}) {\n        if (this.isNoteContext(ntxId)) {\n            await this.refresh();\n\n            this.handleAddNewAttributeCommand('addNewLabel');\n        }\n    }\n\n    // triggered from keyboard shortcut\n    async addNewRelationEvent({ntxId}) {\n        if (this.isNoteContext(ntxId)) {\n            await this.refresh();\n\n            this.handleAddNewAttributeCommand('addNewRelation');\n        }\n    }\n\n    async handleAddNewAttributeCommand(command) {\n        const attrs = this.parseAttributes();\n\n        if (!attrs) {\n            return;\n        }\n\n        let type, name, value;\n\n        if (command === 'addNewLabel') {\n            type = 'label';\n            name = 'myLabel';\n            value = '';\n        } else if (command === 'addNewRelation') {\n            type = 'relation';\n            name = 'myRelation';\n            value = '';\n        } else if (command === 'addNewLabelDefinition') {\n            type = 'label';\n            name = 'label:myLabel';\n            value = 'promoted,single,text';\n        } else if (command === 'addNewRelationDefinition') {\n            type = 'label';\n            name = 'relation:myRelation';\n            value = 'promoted,single';\n        } else {\n            return;\n        }\n\n        attrs.push({\n            type,\n            name,\n            value,\n            isInheritable: false\n        });\n\n        await this.renderOwnedAttributes(attrs, false);\n\n        this.$editor.scrollTop(this.$editor[0].scrollHeight);\n\n        const rect = this.$editor[0].getBoundingClientRect();\n\n        setTimeout(() => {\n            // showing a little bit later because there's a conflict with outside click closing the attr detail\n            this.attributeDetailWidget.showAttributeDetail({\n                allAttributes: attrs,\n                attribute: attrs[attrs.length - 1],\n                isOwned: true,\n                x: (rect.left + rect.right) / 2,\n                y: rect.bottom,\n                focus: 'name'\n            });\n        }, 100);\n    }\n\n    async save() {\n        if (this.lastUpdatedNoteId !== this.noteId) {\n            // https://github.com/zadam/trilium/issues/3090\n            console.warn(\"Ignoring blur event because a different note is loaded.\");\n            return;\n        }\n\n        const attributes = this.parseAttributes();\n\n        if (attributes) {\n            await server.put(`notes/${this.noteId}/attributes`, attributes, this.componentId);\n\n            this.$saveAttributesButton.fadeOut();\n\n            // blink the attribute text to give a visual hint that save has been executed\n            this.$editor.css('opacity', 0);\n\n            // revert back\n            setTimeout(() => this.$editor.css('opacity', 1), 100);\n        }\n    }\n\n    parseAttributes() {\n        try {\n            return attributeParser.lexAndParse(this.getPreprocessedData());\n        }\n        catch (e) {\n            this.$errors.text(e.message).slideDown();\n        }\n    }\n\n    getPreprocessedData() {\n        const str = this.textEditor.getData()\n            .replace(/<a[^>]+href=\"(#[A-Za-z0-9_/]*)\"[^>]*>[^<]*<\\/a>/g, \"$1\")\n            .replace(/&nbsp;/g, \" \"); // otherwise .text() below outputs non-breaking space in unicode\n\n        return $(\"<div>\").html(str).text();\n    }\n\n    async initEditor() {\n        await libraryLoader.requireLibrary(libraryLoader.CKEDITOR);\n\n        this.$widget.show();\n\n        this.$editor.on(\"click\", e => this.handleEditorClick(e));\n\n        /** @property {BalloonEditor} */\n        this.textEditor = await BalloonEditor.create(this.$editor[0], editorConfig);\n        this.textEditor.model.document.on('change:data', () => this.dataChanged());\n        this.textEditor.editing.view.document.on('enter', (event, data) => {\n            // disable entering new line - see https://github.com/ckeditor/ckeditor5/issues/9422\n            data.preventDefault();\n            event.stop();\n        }, {priority: 'high'});\n\n        // disable spellcheck for attribute editor\n        this.textEditor.editing.view.change(writer => writer.setAttribute('spellcheck', 'false', this.textEditor.editing.view.document.getRoot()));\n\n        //await import(/* webpackIgnore: true */'../../libraries/ckeditor/inspector');\n        //CKEditorInspector.attach(this.textEditor);\n    }\n\n    dataChanged() {\n        this.lastUpdatedNoteId = this.noteId;\n\n        if (this.lastSavedContent === this.textEditor.getData()) {\n            this.$saveAttributesButton.fadeOut();\n        }\n        else {\n            this.$saveAttributesButton.fadeIn();\n        }\n\n        if (this.$errors.is(\":visible\")) {\n            // using .hide() instead of .slideUp() since this will also hide the error after confirming\n            // mention for relation name which suits up. When using.slideUp() error will appear and the slideUp which is weird\n            this.$errors.hide();\n        }\n    }\n\n    async handleEditorClick(e) {\n        const pos = this.textEditor.model.document.selection.getFirstPosition();\n\n        if (pos && pos.textNode && pos.textNode.data) {\n            const clickIndex = this.getClickIndex(pos);\n\n            let parsedAttrs;\n\n            try {\n                parsedAttrs = attributeParser.lexAndParse(this.getPreprocessedData(), true);\n            }\n            catch (e) {\n                // the input is incorrect because the user messed up with it and now needs to fix it manually\n                return null;\n            }\n\n            let matchedAttr = null;\n\n            for (const attr of parsedAttrs) {\n                if (clickIndex > attr.startIndex && clickIndex <= attr.endIndex) {\n                    matchedAttr = attr;\n                    break;\n                }\n            }\n\n            setTimeout(() => {\n                if (matchedAttr) {\n                    this.$editor.tooltip('hide');\n\n                    this.attributeDetailWidget.showAttributeDetail({\n                        allAttributes: parsedAttrs,\n                        attribute: matchedAttr,\n                        isOwned: true,\n                        x: e.pageX,\n                        y: e.pageY\n                    });\n                }\n                else {\n                    this.showHelpTooltip();\n                }\n            }, 100);\n        }\n        else {\n            this.showHelpTooltip();\n        }\n    }\n\n    showHelpTooltip() {\n        this.attributeDetailWidget.hide();\n\n        this.$editor.tooltip({\n            trigger: 'focus',\n            html: true,\n            title: HELP_TEXT,\n            placement: 'bottom',\n            offset: \"0,30\"\n        });\n\n        this.$editor.tooltip('show');\n    }\n\n    getClickIndex(pos) {\n        let clickIndex = pos.offset - pos.textNode.startOffset;\n\n        let curNode = pos.textNode;\n\n        while (curNode.previousSibling) {\n            curNode = curNode.previousSibling;\n\n            if (curNode.name === 'reference') {\n                clickIndex += curNode._attrs.get('notePath').length + 1;\n            } else {\n                clickIndex += curNode.data.length;\n            }\n        }\n\n        return clickIndex;\n    }\n\n    async loadReferenceLinkTitle($el, href) {\n        const {noteId} = linkService.parseNavigationStateFromUrl(href);\n        const note = await froca.getNote(noteId, true);\n\n        const title = note ? note.title : '[missing]';\n\n        $el.text(title);\n    }\n\n    async refreshWithNote(note) {\n        await this.renderOwnedAttributes(note.getOwnedAttributes(), true);\n    }\n\n    async renderOwnedAttributes(ownedAttributes, saved) {\n        // attrs are not resorted if position changes after the initial load\n        ownedAttributes.sort((a, b) => a.position - b.position);\n\n        let htmlAttrs = (await attributeRenderer.renderAttributes(ownedAttributes, true)).html();\n\n        if (htmlAttrs.length > 0) {\n            htmlAttrs += \"&nbsp;\";\n        }\n\n        this.textEditor.setData(htmlAttrs);\n\n        if (saved) {\n            this.lastSavedContent = this.textEditor.getData();\n\n            this.$saveAttributesButton.fadeOut(0);\n        }\n    }\n\n    async createNoteForReferenceLink(title) {\n        const {note} = await noteCreateService.createNoteWithTypePrompt(this.notePath, {\n            activate: false,\n            title: title\n        });\n\n        return note.getBestNotePathString();\n    }\n\n    async updateAttributeList(attributes) {\n        await this.renderOwnedAttributes(attributes, false);\n    }\n\n    focus() {\n        this.$editor.trigger('focus');\n\n        this.textEditor.model.change( writer => {\n            const positionAt = writer.createPositionAt(this.textEditor.model.document.getRoot(), 'end');\n\n            writer.setSelection(positionAt);\n        } );\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.getAttributeRows(this.componentId).find(attr => attributeService.isAffecting(attr, this.note))) {\n            this.refresh();\n        }\n    }\n}\n","import NoteContextAwareWidget from \"../note_context_aware_widget.js\";\nimport AttributeDetailWidget from \"../attribute_widgets/attribute_detail.js\";\nimport AttributeEditorWidget from \"../attribute_widgets/attribute_editor.js\";\n\nconst TPL = `\n<div class=\"attribute-list\">\n    <style>\n        .attribute-list {\n            margin-left: 7px;\n            margin-right: 7px;\n            margin-top: 5px;\n            margin-bottom: 2px;\n            position: relative;\n        }\n        \n        .attribute-list-editor p {\n            margin: 0 !important;\n        }\n    </style>\n   \n    <div class=\"attr-editor-placeholder\"></div>\n</div>\n`;\n\nexport default class OwnedAttributeListWidget extends NoteContextAwareWidget {\n    get name() {\n        return \"ownedAttributes\";\n    }\n\n    get toggleCommand() {\n        return \"toggleRibbonTabOwnedAttributes\";\n    }\n\n    constructor() {\n        super();\n\n        this.attributeDetailWidget = new AttributeDetailWidget()\n            .contentSized()\n            .setParent(this);\n\n        this.attributeEditorWidget = new AttributeEditorWidget(this.attributeDetailWidget)\n            .contentSized()\n            .setParent(this);\n\n        this.child(this.attributeEditorWidget, this.attributeDetailWidget);\n    }\n\n    getTitle() {\n        return {\n            show: !this.note.isLaunchBarConfig(),\n            title: \"拥有的属性\",\n            icon: \"bx bx-list-check\"\n        };\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.contentSized();\n\n        this.$widget.find('.attr-editor-placeholder').replaceWith(this.attributeEditorWidget.render());\n        this.$widget.append(this.attributeDetailWidget.render());\n\n        this.$title = $('<div>');\n    }\n\n    async saveAttributesCommand() {\n        await this.attributeEditorWidget.save();\n    }\n\n    async reloadAttributesCommand() {\n        await this.attributeEditorWidget.refresh();\n    }\n\n    async updateAttributeListCommand({attributes}) {\n        await this.attributeEditorWidget.updateAttributeList(attributes);\n    }\n\n    focus() {\n        this.attributeEditorWidget.focus();\n    }\n}\n","import NoteContextAwareWidget from \"../note_context_aware_widget.js\";\nimport utils from \"../../services/utils.js\";\nimport branchService from \"../../services/branches.js\";\nimport dialogService from \"../../services/dialog.js\";\nimport server from \"../../services/server.js\";\nimport toastService from \"../../services/toast.js\";\nimport ws from \"../../services/ws.js\";\nimport appContext from \"../../components/app_context.js\";\n\nconst TPL = `\n<div class=\"dropdown note-actions\">\n    <style>\n    .note-actions {\n        width: 35px;\n        height: 35px;\n    }  \n    \n    .note-actions .dropdown-menu {\n        width: 15em;\n    }\n    \n    .note-actions .dropdown-item[disabled], .note-actions .dropdown-item[disabled]:hover {\n        color: var(--muted-text-color) !important;\n        background-color: transparent !important;\n        pointer-events: none; /* makes it unclickable */\n    }\n    </style>\n\n    <button type=\"button\" data-toggle=\"dropdown\" aria-haspopup=\"true\" \n        aria-expanded=\"false\" class=\"icon-action bx bx-dots-vertical-rounded\"></button>\n\n    <div class=\"dropdown-menu dropdown-menu-right\">\n        <a data-trigger-command=\"convertNoteIntoAttachment\" class=\"dropdown-item\">转换为附件</a>\n        <a data-trigger-command=\"renderActiveNote\" class=\"dropdown-item render-note-button\"><kbd data-command=\"renderActiveNote\"></kbd>重新渲染笔记</a>\n        <a data-trigger-command=\"findInText\" class=\"dropdown-item find-in-text-button\">在笔记中搜索<kbd data-command=\"findInText\"></a>\n        <a data-trigger-command=\"showNoteSource\" class=\"dropdown-item show-source-button\"><kbd data-command=\"showNoteSource\"></kbd>笔记源代码</a>\n        <a data-trigger-command=\"showAttachments\" class=\"dropdown-item\"><kbd data-command=\"showAttachments\"></kbd>笔记附件</a>\n        <a data-trigger-command=\"openNoteExternally\" class=\"dropdown-item open-note-externally-button\"\n           title=\"文件将在外部应用程序中打开并监视更改, 然后您可以将修改后的版本上传回Trilium\">\n            <kbd data-command=\"openNoteExternally\"></kbd> \n            用外部程序打开笔记\n        </a>\n        <a data-trigger-command=\"openNoteCustom\" class=\"dropdown-item open-note-custom-button\"><kbd data-command=\"openNoteCustom\"></kbd> 使用自定义程序打开笔记</a>\n        <a class=\"dropdown-item import-files-button\">导入文件</a>\n        <a class=\"dropdown-item export-note-button\">导出笔记</a>\n        <a class=\"dropdown-item delete-note-button\">删除笔记</a>\n        <a data-trigger-command=\"printActiveNote\" class=\"dropdown-item print-active-note-button\"><kbd data-command=\"printActiveNote\"></kbd>打印笔记</a>\n        <a data-trigger-command=\"forceSaveRevision\" class=\"dropdown-item save-revision-button\"><kbd data-command=\"forceSaveRevision\"></kbd>保存笔记历史</a>\n    </div>\n</div>`;\n\nexport default class NoteActionsWidget extends NoteContextAwareWidget {\n    isEnabled() {\n        return this.note?.type !== 'launcher';\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$widget.on('show.bs.dropdown', () => this.refreshVisibility(this.note));\n\n        this.$convertNoteIntoAttachmentButton = this.$widget.find(\"[data-trigger-command='convertNoteIntoAttachment']\");\n        this.$findInTextButton = this.$widget.find('.find-in-text-button');\n        this.$printActiveNoteButton = this.$widget.find('.print-active-note-button');\n        this.$showSourceButton = this.$widget.find('.show-source-button');\n        this.$renderNoteButton = this.$widget.find('.render-note-button');\n\n        this.$exportNoteButton = this.$widget.find('.export-note-button');\n        this.$exportNoteButton.on(\"click\", () => {\n            if (this.$exportNoteButton.hasClass(\"disabled\")) {\n                return;\n            }\n\n            this.triggerCommand(\"showExportDialog\", {\n                notePath: this.noteContext.notePath,\n                defaultType: \"single\"\n            });\n        });\n\n        this.$importNoteButton = this.$widget.find('.import-files-button');\n        this.$importNoteButton.on(\"click\", () => this.triggerCommand(\"showImportDialog\", {noteId: this.noteId}));\n\n        this.$widget.on('click', '.dropdown-item', () => this.$widget.find(\"[data-toggle='dropdown']\").dropdown('toggle'));\n\n        this.$openNoteExternallyButton = this.$widget.find(\".open-note-externally-button\");\n        this.$openNoteCustomButton = this.$widget.find(\".open-note-custom-button\");\n\n        this.$deleteNoteButton = this.$widget.find(\".delete-note-button\");\n        this.$deleteNoteButton.on(\"click\", () => {\n            if (this.note.noteId === 'root') {\n                return;\n            }\n\n            branchService.deleteNotes([this.note.getParentBranches()[0].branchId], true);\n        });\n    }\n\n    async refreshVisibility(note) {\n        this.$convertNoteIntoAttachmentButton.toggle(note.isEligibleForConversionToAttachment());\n\n        this.toggleDisabled(this.$findInTextButton, ['text', 'code', 'book'].includes(note.type));\n\n        this.toggleDisabled(this.$showSourceButton, ['text', 'code', 'relationMap', 'mermaid', 'canvas'].includes(note.type));\n\n        this.toggleDisabled(this.$printActiveNoteButton, ['text', 'code'].includes(note.type));\n\n        this.$renderNoteButton.toggle(note.type === 'render');\n\n        this.toggleDisabled(this.$openNoteExternallyButton, utils.isElectron() && !['search', 'book'].includes(note.type));\n        this.toggleDisabled(this.$openNoteCustomButton,\n            utils.isElectron()\n            && !utils.isMac() // no implementation for Mac yet\n            && !['search', 'book'].includes(note.type)\n        );\n\n        // I don't want to handle all special notes like this, but intuitively user might want to export content of backend log\n        this.toggleDisabled(this.$exportNoteButton, !['_backendLog'].includes(note.noteId));\n\n        this.toggleDisabled(this.$importNoteButton, !['search'].includes(note.type));\n    }\n\n    async convertNoteIntoAttachmentCommand() {\n        if (!await dialogService.confirm(`Are you sure you want to convert note '${this.note.title}' into an attachment of the parent note?`)) {\n            return;\n        }\n\n        const {attachment: newAttachment} = await server.post(`notes/${this.noteId}/convert-to-attachment`);\n\n        if (!newAttachment) {\n            toastService.showMessage(`Converting note '${this.note.title}' failed.`);\n            return;\n        }\n\n        toastService.showMessage(`Note '${newAttachment.title}' has been converted to attachment.`);\n        await ws.waitForMaxKnownEntityChangeId();\n        await appContext.tabManager.getActiveContext().setNote(newAttachment.ownerId, {\n            viewScope: {\n                viewMode: 'attachments',\n                attachmentId: newAttachment.attachmentId\n            }\n        });\n    }\n\n    toggleDisabled($el, enable) {\n        if (enable) {\n            $el.removeAttr('disabled');\n        } else {\n            $el.attr('disabled', 'disabled');\n        }\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.isNoteReloaded(this.noteId)) {\n            this.refresh();\n        }\n    }\n}\n","import NoteContextAwareWidget from \"../note_context_aware_widget.js\";\nimport appContext from \"../../components/app_context.js\";\n\nexport default class TypeWidget extends NoteContextAwareWidget {\n    // for overriding\n    static getType() {}\n\n    doRender() {\n        this.contentSized();\n\n        return super.doRender();\n    }\n\n    /** @param {FNote} note */\n    async doRefresh(note) {}\n\n    async refresh() {\n        const thisWidgetType = this.constructor.getType();\n        const noteWidgetType = await this.parent.getWidgetType();\n\n        if (thisWidgetType !== noteWidgetType) {\n            this.toggleInt(false);\n\n            this.cleanup();\n        }\n        else {\n            this.toggleInt(true);\n\n            await this.doRefresh(this.note);\n\n            this.triggerEvent('noteDetailRefreshed', {ntxId: this.noteContext.ntxId});\n        }\n    }\n\n    isActive() {\n        return this.$widget.is(\":visible\") && this.noteContext?.ntxId === appContext.tabManager.activeNtxId;\n    }\n\n    /** @returns {Promise<Object>|*} promise resolving note data. Note data is an object with content. */\n    getData() {}\n\n    focus() {}\n\n    async readOnlyTemporarilyDisabledEvent({noteContext}) {\n        if (this.isNoteContext(noteContext.ntxId)) {\n            await this.refresh();\n\n            this.focus();\n        }\n    }\n\n    // events should be propagated manually to the children widgets\n    handleEventInChildren(name, data) {\n        if (['activeContextChanged', 'setNoteContext'].includes(name)) {\n            // won't trigger .refresh();\n            return super.handleEventInChildren('setNoteContext', data);\n        }\n        else if (name === 'entitiesReloaded') {\n            return super.handleEventInChildren(name, data);\n        }\n        else {\n            return Promise.resolve();\n        }\n    }\n}\n","import options from \"./options.js\";\n\nconst MIME_TYPES_DICT = [\n    { default: true, title: \"纯文本\", mime: \"text/plain\" },\n    { title: \"APL\", mime: \"text/apl\" },\n    { title: \"ASN.1\", mime: \"text/x-ttcn-asn\" },\n    { title: \"ASP.NET\", mime: \"application/x-aspx\" },\n    { title: \"Asterisk\", mime: \"text/x-asterisk\" },\n    { title: \"Brainfuck\", mime: \"text/x-brainfuck\" },\n    { default: true, title: \"C\", mime: \"text/x-csrc\" },\n    { default: true, title: \"C#\", mime: \"text/x-csharp\" },\n    { default: true, title: \"C++\", mime: \"text/x-c++src\" },\n    { title: \"Clojure\", mime: \"text/x-clojure\" },\n    { title: \"ClojureScript\", mime: \"text/x-clojurescript\" },\n    { title: \"Closure Stylesheets (GSS)\", mime: \"text/x-gss\" },\n    { title: \"CMake\", mime: \"text/x-cmake\" },\n    { title: \"Cobol\", mime: \"text/x-cobol\" },\n    { title: \"CoffeeScript\", mime: \"text/coffeescript\" },\n    { title: \"Common Lisp\", mime: \"text/x-common-lisp\" },\n    { title: \"CQL\", mime: \"text/x-cassandra\" },\n    { title: \"Crystal\", mime: \"text/x-crystal\" },\n    { default: true, title: \"CSS\", mime: \"text/css\" },\n    { title: \"Cypher\", mime: \"application/x-cypher-query\" },\n    { title: \"Cython\", mime: \"text/x-cython\" },\n    { title: \"D\", mime: \"text/x-d\" },\n    { title: \"Dart\", mime: \"application/dart\" },\n    { title: \"diff\", mime: \"text/x-diff\" },\n    { title: \"Django\", mime: \"text/x-django\" },\n    { title: \"Dockerfile\", mime: \"text/x-dockerfile\" },\n    { title: \"DTD\", mime: \"application/xml-dtd\" },\n    { title: \"Dylan\", mime: \"text/x-dylan\" },\n    { title: \"EBNF\", mime: \"text/x-ebnf\" },\n    { title: \"ECL\", mime: \"text/x-ecl\" },\n    { title: \"edn\", mime: \"application/edn\" },\n    { title: \"Eiffel\", mime: \"text/x-eiffel\" },\n    { title: \"Elm\", mime: \"text/x-elm\" },\n    { title: \"Embedded Javascript\", mime: \"application/x-ejs\" },\n    { title: \"Embedded Ruby\", mime: \"application/x-erb\" },\n    { title: \"Erlang\", mime: \"text/x-erlang\" },\n    { title: \"Esper\", mime: \"text/x-esper\" },\n    { title: \"F#\", mime: \"text/x-fsharp\" },\n    { title: \"Factor\", mime: \"text/x-factor\" },\n    { title: \"FCL\", mime: \"text/x-fcl\" },\n    { title: \"Forth\", mime: \"text/x-forth\" },\n    { title: \"Fortran\", mime: \"text/x-fortran\" },\n    { title: \"Gas\", mime: \"text/x-gas\" },\n    { title: \"Gherkin\", mime: \"text/x-feature\" },\n    { title: \"GitHub风格的Markdown\", mime: \"text/x-gfm\" },\n    { default: true, title: \"Go\", mime: \"text/x-go\" },\n    { default: true, title: \"Groovy\", mime: \"text/x-groovy\" },\n    { title: \"HAML\", mime: \"text/x-haml\" },\n    { default: true, title: \"Haskell\", mime: \"text/x-haskell\" },\n    { title: \"Haskell (Literate)\", mime: \"text/x-literate-haskell\" },\n    { title: \"Haxe\", mime: \"text/x-haxe\" },\n    { default: true, title: \"HTML\", mime: \"text/html\" },\n    { default: true, title: \"HTTP\", mime: \"message/http\" },\n    { title: \"HXML\", mime: \"text/x-hxml\" },\n    { title: \"IDL\", mime: \"text/x-idl\" },\n    { default: true, title: \"Java\", mime: \"text/x-java\" },\n    { title: \"Java服务器页面\", mime: \"application/x-jsp\" },\n    { title: \"Jinja2\", mime: \"text/jinja2\" },\n    { default: true, title: \"JS backend\", mime: \"application/javascript;env=backend\" },\n    { default: true, title: \"JS frontend\", mime: \"application/javascript;env=frontend\" },\n    { default: true, title: \"JSON\", mime: \"application/json\" },\n    { title: \"JSON-LD\", mime: \"application/ld+json\" },\n    { title: \"JSX\", mime: \"text/jsx\" },\n    { title: \"Julia\", mime: \"text/x-julia\" },\n    { default: true, title: \"Kotlin\", mime: \"text/x-kotlin\" },\n    { title: \"LaTeX\", mime: \"text/x-latex\" },\n    { title: \"LESS\", mime: \"text/x-less\" },\n    { title: \"LiveScript\", mime: \"text/x-livescript\" },\n    { title: \"Lua\", mime: \"text/x-lua\" },\n    { title: \"MariaDB SQL\", mime: \"text/x-mariadb\" },\n    { default: true, title: \"Markdown\", mime: \"text/x-markdown\" },\n    { title: \"Mathematica\", mime: \"text/x-mathematica\" },\n    { title: \"mbox\", mime: \"application/mbox\" },\n    { title: \"mIRC\", mime: \"text/mirc\" },\n    { title: \"Modelica\", mime: \"text/x-modelica\" },\n    { title: \"MS SQL\", mime: \"text/x-mssql\" },\n    { title: \"mscgen\", mime: \"text/x-mscgen\" },\n    { title: \"msgenny\", mime: \"text/x-msgenny\" },\n    { title: \"MUMPS\", mime: \"text/x-mumps\" },\n    { title: \"MySQL\", mime: \"text/x-mysql\" },\n    { title: \"Nginx\", mime: \"text/x-nginx-conf\" },\n    { title: \"NSIS\", mime: \"text/x-nsis\" },\n    { title: \"NTriples\", mime: \"application/n-triples\" },\n    { title: \"Objective-C\", mime: \"text/x-objectivec\" },\n    { title: \"OCaml\", mime: \"text/x-ocaml\" },\n    { title: \"Octave\", mime: \"text/x-octave\" },\n    { title: \"Oz\", mime: \"text/x-oz\" },\n    { title: \"Pascal\", mime: \"text/x-pascal\" },\n    { title: \"PEG.js\", mime: \"null\" },\n    { default: true, title: \"Perl\", mime: \"text/x-perl\" },\n    { title: \"PGP\", mime: \"application/pgp\" },\n    { default: true, title: \"PHP\", mime: \"text/x-php\" },\n    { title: \"Pig\", mime: \"text/x-pig\" },\n    { title: \"PLSQL\", mime: \"text/x-plsql\" },\n    { title: \"PostgreSQL\", mime: \"text/x-pgsql\" },\n    { title: \"PowerShell\", mime: \"application/x-powershell\" },\n    { title: \"属性文件\", mime: \"text/x-properties\" },\n    { title: \"ProtoBuf\", mime: \"text/x-protobuf\" },\n    { title: \"Pug\", mime: \"text/x-pug\" },\n    { title: \"Puppet\", mime: \"text/x-puppet\" },\n    { default: true, title: \"Python\", mime: \"text/x-python\" },\n    { title: \"Q\", mime: \"text/x-q\" },\n    { title: \"R\", mime: \"text/x-rsrc\" },\n    { title: \"reStructuredText\", mime: \"text/x-rst\" },\n    { title: \"RPM Changes\", mime: \"text/x-rpm-changes\" },\n    { title: \"RPM Spec\", mime: \"text/x-rpm-spec\" },\n    { default: true, title: \"Ruby\", mime: \"text/x-ruby\" },\n    { title: \"Rust\", mime: \"text/x-rustsrc\" },\n    { title: \"SAS\", mime: \"text/x-sas\" },\n    { title: \"Sass\", mime: \"text/x-sass\" },\n    { title: \"Scala\", mime: \"text/x-scala\" },\n    { title: \"Scheme\", mime: \"text/x-scheme\" },\n    { title: \"SCSS\", mime: \"text/x-scss\" },\n    { default: true, title: \"Shell (bash)\", mime: \"text/x-sh\" },\n    { title: \"Sieve\", mime: \"application/sieve\" },\n    { title: \"Slim\", mime: \"text/x-slim\" },\n    { title: \"Smalltalk\", mime: \"text/x-stsrc\" },\n    { title: \"Smarty\", mime: \"text/x-smarty\" },\n    { title: \"SML\", mime: \"text/x-sml\" },\n    { title: \"Solr\", mime: \"text/x-solr\" },\n    { title: \"Soy\", mime: \"text/x-soy\" },\n    { title: \"SPARQL\", mime: \"application/sparql-query\" },\n    { title: \"Spreadsheet\", mime: \"text/x-spreadsheet\" },\n    { default: true, title: \"SQL\", mime: \"text/x-sql\" },\n    { title: \"SQLite\", mime: \"text/x-sqlite\" },\n    { default: true, title: \"SQLite (Trilium)\", mime: \"text/x-sqlite;schema=trilium\" },\n    { title: \"Squirrel\", mime: \"text/x-squirrel\" },\n    { title: \"sTeX\", mime: \"text/x-stex\" },\n    { title: \"Stylus\", mime: \"text/x-styl\" },\n    { default: true, title: \"Swift\", mime: \"text/x-swift\" },\n    { title: \"SystemVerilog\", mime: \"text/x-systemverilog\" },\n    { title: \"Tcl\", mime: \"text/x-tcl\" },\n    { title: \"Textile\", mime: \"text/x-textile\" },\n    { title: \"TiddlyWiki \", mime: \"text/x-tiddlywiki\" },\n    { title: \"Tiki wiki\", mime: \"text/tiki\" },\n    { title: \"TOML\", mime: \"text/x-toml\" },\n    { title: \"Tornado\", mime: \"text/x-tornado\" },\n    { title: \"troff\", mime: \"text/troff\" },\n    { title: \"TTCN\", mime: \"text/x-ttcn\" },\n    { title: \"TTCN_CFG\", mime: \"text/x-ttcn-cfg\" },\n    { title: \"Turtle\", mime: \"text/turtle\" },\n    { title: \"Twig\", mime: \"text/x-twig\" },\n    { title: \"TypeScript\", mime: \"application/typescript\" },\n    { title: \"TypeScript-JSX\", mime: \"text/typescript-jsx\" },\n    { title: \"VB.NET\", mime: \"text/x-vb\" },\n    { title: \"VBScript\", mime: \"text/vbscript\" },\n    { title: \"Velocity\", mime: \"text/velocity\" },\n    { title: \"Verilog\", mime: \"text/x-verilog\" },\n    { title: \"VHDL\", mime: \"text/x-vhdl\" },\n    { title: \"Vue.js部件\", mime: \"text/x-vue\" },\n    { title: \"Web IDL\", mime: \"text/x-webidl\" },\n    { default: true, title: \"XML\", mime: \"text/xml\" },\n    { title: \"XQuery\", mime: \"application/xquery\" },\n    { title: \"xu\", mime: \"text/x-xu\" },\n    { title: \"Yacas\", mime: \"text/x-yacas\" },\n    { default: true, title: \"YAML\", mime: \"text/x-yaml\" },\n    { title: \"Z80\", mime: \"text/x-z80\" }\n];\n\nlet mimeTypes = null;\n\nfunction loadMimeTypes() {\n    mimeTypes = JSON.parse(JSON.stringify(MIME_TYPES_DICT)); // clone\n\n    const enabledMimeTypes = options.getJson('codeNotesMimeTypes')\n        || MIME_TYPES_DICT.filter(mt => mt.default).map(mt => mt.mime);\n\n    for (const mt of mimeTypes) {\n        mt.enabled = enabledMimeTypes.includes(mt.mime) || mt.mime === 'text/plain'; // text/plain is always enabled\n    }\n}\n\nasync function getMimeTypes() {\n    if (mimeTypes === null) {\n        loadMimeTypes();\n    }\n\n    return mimeTypes;\n}\n\nexport default {\n    getMimeTypes,\n    loadMimeTypes\n}\n","import TypeWidget from \"./type_widget.js\";\nimport appContext from \"../../components/app_context.js\";\nimport froca from \"../../services/froca.js\";\nimport linkService from \"../../services/link.js\";\nimport contentRenderer from \"../../services/content_renderer.js\";\nimport utils from \"../../services/utils.js\";\n\nexport default class AbstractTextTypeWidget extends TypeWidget {\n    setupImageOpening(singleClickOpens) {\n        this.$widget.on(\"dblclick\", \"img\", e => this.openImageInCurrentTab($(e.target)));\n\n        this.$widget.on(\"click\", \"img\", e => {\n            const isLeftClick = e.which === 1;\n            const isMiddleClick = e.which === 2;\n            const ctrlKey = utils.isCtrlKey(e);\n\n            if ((isLeftClick && ctrlKey) || isMiddleClick) {\n                this.openImageInNewTab($(e.target));\n            }\n            else if (isLeftClick && singleClickOpens) {\n                this.openImageInCurrentTab($(e.target));\n            }\n        });\n    }\n\n    async openImageInCurrentTab($img) {\n        const { noteId, viewScope } = await this.parseFromImage($img);\n\n        if (noteId) {\n            appContext.tabManager.getActiveContext().setNote(noteId, { viewScope });\n        } else {\n            window.open($img.prop(\"src\"), '_blank');\n        }\n    }\n\n    openImageInNewTab($img) {\n        const { noteId, viewScope } = this.parseFromImage($img);\n\n        if (noteId) {\n            appContext.tabManager.openTabWithNoteWithHoisting(noteId, { viewScope });\n        } else {\n            window.open($img.prop(\"src\"), '_blank');\n        }\n    }\n\n    async parseFromImage($img) {\n        const imgSrc = $img.prop(\"src\");\n\n        const imageNoteMatch = imgSrc.match(/\\/api\\/images\\/([A-Za-z0-9_]+)\\//);\n        if (imageNoteMatch) {\n            return {\n                noteId: imageNoteMatch[1],\n                viewScope: {}\n            }\n        }\n\n        const attachmentMatch = imgSrc.match(/\\/api\\/attachments\\/([A-Za-z0-9_]+)\\/image\\//);\n        if (attachmentMatch) {\n            const attachmentId = attachmentMatch[1];\n            const attachment = await froca.getAttachment(attachmentId);\n\n            return {\n                noteId: attachment.ownerId,\n                viewScope: {\n                    viewMode: 'attachments',\n                    attachmentId: attachmentId\n                }\n            }\n        }\n\n        return null;\n    }\n\n    async loadIncludedNote(noteId, $el) {\n        const note = await froca.getNote(noteId);\n\n        if (note) {\n            const $wrapper = $('<div class=\"include-note-wrapper\">');\n\n            const $link = await linkService.createLink(note.noteId, {\n                showTooltip: false\n            });\n\n            $wrapper.empty().append(\n                $('<h4 class=\"include-note-title\">')\n                    .append($link)\n            );\n\n            const {$renderedContent, type} = await contentRenderer.getRenderedContent(note);\n\n            $wrapper.append(\n                $(`<div class=\"include-note-content type-${type}\">`)\n                    .append($renderedContent)\n            );\n\n            $el.empty().append($wrapper);\n        }\n    }\n\n    async loadReferenceLinkTitle($el, href = null) {\n        await linkService.loadReferenceLinkTitle($el, href);\n    }\n\n    refreshIncludedNote($container, noteId) {\n        if ($container) {\n            $container.find(`section[data-note-id=\"${noteId}\"]`).each((_, el) => {\n                this.loadIncludedNote(noteId, $(el));\n            });\n        }\n    }\n}\n","import libraryLoader from \"../../services/library_loader.js\";\nimport noteAutocompleteService from '../../services/note_autocomplete.js';\nimport mimeTypesService from '../../services/mime_types.js';\nimport utils from \"../../services/utils.js\";\nimport keyboardActionService from \"../../services/keyboard_actions.js\";\nimport froca from \"../../services/froca.js\";\nimport noteCreateService from \"../../services/note_create.js\";\nimport AbstractTextTypeWidget from \"./abstract_text_type_widget.js\";\nimport link from \"../../services/link.js\";\nimport appContext from \"../../components/app_context.js\";\nimport dialogService from \"../../services/dialog.js\";\n\nconst ENABLE_INSPECTOR = false;\n\nconst mentionSetup = {\n    feeds: [\n        {\n            marker: '@',\n            feed: queryText => noteAutocompleteService.autocompleteSourceForCKEditor(queryText),\n            itemRenderer: item => {\n                const itemElement = document.createElement('button');\n\n                itemElement.innerHTML = `${item.highlightedNotePathTitle} `;\n\n                return itemElement;\n            },\n            minimumCharacters: 0\n        }\n    ]\n};\n\nconst TPL = `\n<div class=\"note-detail-editable-text note-detail-printable\">\n    <style>\n    .note-detail-editable-text {\n        font-family: var(--detail-font-family);\n        padding-left: 14px;\n        padding-top: 10px;\n        height: 100%;\n    }\n    \n    body.mobile .note-detail-editable-text {\n        padding-left: 4px;\n    }\n    \n    .note-detail-editable-text a:hover {\n        cursor: pointer;\n    }\n    \n    .note-detail-editable-text a[href^=\"http://\"], .note-detail-editable-text a[href^=\"https://\"] {\n        cursor: text !important;\n    }\n    \n    .note-detail-editable-text *:not(figure,.include-note):first-child {\n        margin-top: 0 !important;\n    }\n         \n    .note-detail-editable-text h2 { font-size: 1.6em; } \n    .note-detail-editable-text h3 { font-size: 1.4em; }\n    .note-detail-editable-text h4 { font-size: 1.2em; }\n    .note-detail-editable-text h5 { font-size: 1.1em; }\n    .note-detail-editable-text h6 { font-size: 1.0em; }\n    \n    body.heading-style-markdown .note-detail-editable-text h2::before { content: \"##\\\\2004\"; color: var(--muted-text-color); }\n    body.heading-style-markdown .note-detail-editable-text h3::before { content: \"###\\\\2004\"; color: var(--muted-text-color); }\n    body.heading-style-markdown .note-detail-editable-text h4:not(.include-note-title)::before { content: \"####\\\\2004\"; color: var(--muted-text-color); }\n    body.heading-style-markdown .note-detail-editable-text h5::before { content: \"#####\\\\2004\"; color: var(--muted-text-color); }\n    body.heading-style-markdown .note-detail-editable-text h6::before { content: \"######\\\\2004\"; color: var(--muted-text-color); }\n    \n    body.heading-style-underline .note-detail-editable-text h2 { border-bottom: 1px solid var(--main-border-color); }\n    body.heading-style-underline .note-detail-editable-text h3 { border-bottom: 1px solid var(--main-border-color); }\n    body.heading-style-underline .note-detail-editable-text h4:not(.include-note-title) { border-bottom: 1px solid var(--main-border-color); }\n    body.heading-style-underline .note-detail-editable-text h5 { border-bottom: 1px solid var(--main-border-color); }\n    body.heading-style-underline .note-detail-editable-text h6 { border-bottom: 1px solid var(--main-border-color); }\n    \n    .note-detail-editable-text-editor {\n        padding-top: 10px;\n        border: 0 !important;\n        box-shadow: none !important;\n        min-height: 50px;\n        height: 100%;\n    }\n    </style>\n\n    <div class=\"note-detail-editable-text-editor\" tabindex=\"300\"></div>\n</div>\n`;\n\nexport default class EditableTextTypeWidget extends AbstractTextTypeWidget {\n    static getType() { return \"editableText\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$editor = this.$widget.find('.note-detail-editable-text-editor');\n\n        this.initialized = this.initEditor();\n\n        keyboardActionService.setupActionsForElement('text-detail', this.$widget, this);\n\n        this.setupImageOpening(false);\n\n        super.doRender();\n    }\n\n    async initEditor() {\n        await libraryLoader.requireLibrary(libraryLoader.CKEDITOR);\n\n        const codeBlockLanguages =\n            (await mimeTypesService.getMimeTypes())\n                .filter(mt => mt.enabled)\n                .map(mt => ({\n                        language: mt.mime.toLowerCase().replace(/[\\W_]+/g,\"-\"),\n                        label: mt.title\n                    }));\n\n        // CKEditor since version 12 needs the element to be visible before initialization. At the same time,\n        // we want to avoid flicker - i.e., show editor only once everything is ready. That's why we have separate\n        // display of $widget in both branches.\n        this.$widget.show();\n\n        this.watchdog = new EditorWatchdog(BalloonEditor, {\n            // An average number of milliseconds between the last editor errors (defaults to 5000).\n            // When the period of time between errors is lower than that and the crashNumberLimit\n            // is also reached, the watchdog changes its state to crashedPermanently, and it stops\n            // restarting the editor. This prevents an infinite restart loop.\n            minimumNonErrorTimePeriod: 5000,\n            // A threshold specifying the number of errors (defaults to 3).\n            // After this limit is reached and the time between last errors\n            // is shorter than minimumNonErrorTimePeriod, the watchdog changes\n            // its state to crashedPermanently, and it stops restarting the editor.\n            // This prevents an infinite restart loop.\n            crashNumberLimit: 3,\n            // A minimum number of milliseconds between saving the editor data internally (defaults to 5000).\n            // Note that for large documents, this might impact the editor performance.\n            saveInterval: 5000\n        });\n\n        this.watchdog.on('stateChange', () => {\n            const currentState = this.watchdog.state;\n\n            if (!['crashed', 'crashedPermanently'].includes(currentState)) {\n                return;\n            }\n\n            console.log(`CKEditor changed to ${currentState}`);\n\n            this.watchdog.crashes.forEach(crashInfo => console.log(crashInfo));\n\n            if (currentState === 'crashedPermanently') {\n                dialogService.info(`Editing component keeps crashing. Please try restarting Trilium. If problem persists, consider creating a bug report.`);\n\n                this.watchdog.editor.enableReadOnlyMode('crashed-editor');\n            }\n        });\n\n        this.watchdog.setCreator(async (elementOrData, editorConfig) => {\n            const editor = await BalloonEditor.create(elementOrData, editorConfig);\n\n            editor.model.document.on('change:data', () => this.spacedUpdate.scheduleUpdate());\n\n            if (glob.isDev && ENABLE_INSPECTOR) {\n                await import(/* webpackIgnore: true */'../../../libraries/ckeditor/inspector.js');\n                CKEditorInspector.attach(editor);\n            }\n\n            return editor;\n        });\n\n        await this.watchdog.create(this.$editor[0], {\n            placeholder: \"在这里输入笔记内容\",\n            mention: mentionSetup,\n            codeBlock: {\n                languages: codeBlockLanguages\n            },\n            math: {\n                engine: 'katex',\n                outputType: 'span', // or script\n                lazyLoad: async () => await libraryLoader.requireLibrary(libraryLoader.KATEX),\n                forceOutputType: false, // forces output to use outputType\n                enablePreview: true // Enable preview view\n            }\n        });\n    }\n\n    async doRefresh(note) {\n        const blob = await note.getBlob();\n\n        await this.spacedUpdate.allowUpdateWithoutChange(() =>\n            this.watchdog.editor.setData(blob.content || \"\"));\n    }\n\n    getData() {\n        const content = this.watchdog.editor.getData();\n\n        // if content is only tags/whitespace (typically <p>&nbsp;</p>), then just make it empty,\n        // this is important when setting a new note to code\n        return {\n            content: utils.isHtmlEmpty(content) ? '' : content\n        };\n    }\n\n    focus() {\n        this.$editor.trigger('focus');\n    }\n\n    scrollToEnd() {\n        this.watchdog?.editor.model.change(writer => {\n            writer.setSelection(writer.createPositionAt(this.watchdog?.editor.model.document.getRoot(), 'end'));\n        });\n\n        this.watchdog?.editor.editing.view.focus();\n    }\n\n    show() {}\n\n    getEditor() {\n        return this.watchdog?.editor;\n    }\n\n    cleanup() {\n        if (this.watchdog?.editor) {\n            this.spacedUpdate.allowUpdateWithoutChange(() => {\n                this.watchdog.editor.setData('');\n            });\n        }\n    }\n\n    insertDateTimeToTextCommand() {\n        const date = new Date();\n        const dateString = utils.formatDateTime(date);\n\n        this.addTextToEditor(dateString);\n    }\n\n    async addLinkToEditor(linkHref, linkTitle) {\n        await this.initialized;\n\n        this.watchdog.editor.model.change(writer => {\n            const insertPosition = this.watchdog.editor.model.document.selection.getFirstPosition();\n            writer.insertText(linkTitle, {linkHref: linkHref}, insertPosition);\n        });\n    }\n\n    async addTextToEditor(text) {\n        await this.initialized;\n\n        this.watchdog.editor.model.change(writer => {\n            const insertPosition = this.watchdog.editor.model.document.selection.getLastPosition();\n            writer.insertText(text, insertPosition);\n        });\n    }\n\n    addTextToActiveEditorEvent({text}) {\n        if (!this.isActive()) {\n            return;\n        }\n\n        this.addTextToEditor(text);\n    }\n\n    async addLink(notePath, linkTitle) {\n        await this.initialized;\n\n        if (linkTitle) {\n            if (this.hasSelection()) {\n                this.watchdog.editor.execute('link', `#${notePath}`);\n            } else {\n                await this.addLinkToEditor(`#${notePath}`, linkTitle);\n            }\n        }\n        else {\n            this.watchdog.editor.execute('referenceLink', { href: '#' + notePath });\n        }\n\n        this.watchdog.editor.editing.view.focus();\n    }\n\n    // returns true if user selected some text, false if there's no selection\n    hasSelection() {\n        const model = this.watchdog.editor.model;\n        const selection = model.document.selection;\n\n        return !selection.isCollapsed;\n    }\n\n    async executeWithTextEditorEvent({callback, resolve, ntxId}) {\n        if (!this.isNoteContext(ntxId)) {\n            return;\n        }\n\n        await this.initialized;\n\n        if (callback) {\n            callback(this.watchdog.editor);\n        }\n\n        resolve(this.watchdog.editor);\n    }\n\n    addLinkToTextCommand() {\n        const selectedText = this.getSelectedText();\n\n        this.triggerCommand('showAddLinkDialog', {textTypeWidget: this, text: selectedText})\n    }\n\n    getSelectedText() {\n        const range = this.watchdog.editor.model.document.selection.getFirstRange();\n        let text = '';\n\n        for (const item of range.getItems()) {\n            if (item.data) {\n                text += item.data;\n            }\n        }\n\n        return text;\n    }\n\n    async followLinkUnderCursorCommand() {\n        await this.initialized;\n\n        const selection = this.watchdog.editor.model.document.selection;\n        const selectedElement = selection.getSelectedElement();\n\n        if (selectedElement?.name === 'reference') {\n            // reference link\n            const notePath = selectedElement.getAttribute('notePath');\n\n            if (notePath) {\n                await appContext.tabManager.getActiveContext().setNote(notePath);\n                return;\n            }\n        }\n\n        if (!selection.hasAttribute('linkHref')) {\n            return;\n        }\n\n        const selectedLinkUrl = selection.getAttribute('linkHref');\n        const notePath = link.getNotePathFromUrl(selectedLinkUrl);\n\n        if (notePath) {\n            await appContext.tabManager.getActiveContext().setNote(notePath);\n        } else {\n            window.open(selectedLinkUrl, '_blank');\n        }\n    }\n\n    addIncludeNoteToTextCommand() {\n        this.triggerCommand(\"showIncludeNoteDialog\", {textTypeWidget: this});\n    }\n\n    addIncludeNote(noteId, boxSize) {\n        this.watchdog.editor.model.change( writer => {\n            // Insert <includeNote>*</includeNote> at the current selection position\n            // in a way that will result in creating a valid model structure\n            this.watchdog.editor.model.insertContent(writer.createElement('includeNote', {\n                noteId: noteId,\n                boxSize: boxSize\n            }));\n        } );\n    }\n\n    async addImage(noteId) {\n        const note = await froca.getNote(noteId);\n\n        this.watchdog.editor.model.change( writer => {\n            const encodedTitle = encodeURIComponent(note.title);\n            const src = `api/images/${note.noteId}/${encodedTitle}`;\n\n            this.watchdog.editor.execute( 'insertImage', { source: src } );\n        } );\n    }\n\n    async createNoteForReferenceLink(title) {\n        const resp = await noteCreateService.createNoteWithTypePrompt(this.notePath, {\n            activate: false,\n            title: title\n        });\n\n        if (!resp) {\n            return;\n        }\n\n        return resp.note.getBestNotePathString();\n    }\n\n    async refreshIncludedNoteEvent({noteId}) {\n        this.refreshIncludedNote(this.$editor, noteId);\n    }\n}\n","import toastService from \"./toast.js\";\n\nfunction copyImageReferenceToClipboard($imageWrapper) {\n    try {\n        $imageWrapper.attr('contenteditable', 'true');\n        selectImage($imageWrapper.get(0));\n\n        const success = document.execCommand('copy');\n\n        if (success) {\n            toastService.showMessage(\"Image copied to the clipboard\");\n        } else {\n            toastService.showAndLogError(\"Could not copy the image to clipboard.\");\n        }\n    }\n    finally {\n        window.getSelection().removeAllRanges();\n        $imageWrapper.removeAttr('contenteditable');\n    }\n}\n\nfunction selectImage(element) {\n    const selection = window.getSelection();\n    const range = document.createRange();\n    range.selectNodeContents(element);\n    selection.removeAllRanges();\n    selection.addRange(range);\n}\n\nexport default {\n    copyImageReferenceToClipboard\n};\n","import server from \"../../services/server.js\";\nimport linkService from \"../../services/link.js\";\nimport libraryLoader from \"../../services/library_loader.js\";\nimport contextMenu from \"../../menus/context_menu.js\";\nimport toastService from \"../../services/toast.js\";\nimport attributeAutocompleteService from \"../../services/attribute_autocomplete.js\";\nimport TypeWidget from \"./type_widget.js\";\nimport appContext from \"../../components/app_context.js\";\nimport utils from \"../../services/utils.js\";\nimport froca from \"../../services/froca.js\";\nimport dialogService from \"../../services/dialog.js\";\n\nconst uniDirectionalOverlays = [\n    [ \"Arrow\", {\n        location: 1,\n        id: \"arrow\",\n        length: 14,\n        foldback: 0.8\n    } ],\n    [ \"Label\", { label: \"\", id: \"label\", cssClass: \"connection-label\" }]\n];\n\nconst biDirectionalOverlays = [\n    [ \"Arrow\", {\n        location: 1,\n        id: \"arrow\",\n        length: 14,\n        foldback: 0.8\n    } ],\n    [ \"Label\", { label: \"\", id: \"label\", cssClass: \"connection-label\" }],\n    [ \"Arrow\", {\n        location: 0,\n        id: \"arrow2\",\n        length: 14,\n        direction: -1,\n        foldback: 0.8\n    } ]\n];\n\nconst inverseRelationsOverlays = [\n    [ \"Arrow\", {\n        location: 1,\n        id: \"arrow\",\n        length: 14,\n        foldback: 0.8\n    } ],\n    [ \"Label\", { label: \"\", location: 0.2, id: \"label-source\", cssClass: \"connection-label\" }],\n    [ \"Label\", { label: \"\", location: 0.8, id: \"label-target\", cssClass: \"connection-label\" }],\n    [ \"Arrow\", {\n        location: 0,\n        id: \"arrow2\",\n        length: 14,\n        direction: -1,\n        foldback: 0.8\n    } ]\n];\n\nconst linkOverlays = [\n    [ \"Arrow\", {\n        location: 1,\n        id: \"arrow\",\n        length: 14,\n        foldback: 0.8\n    } ]\n];\n\nconst TPL = `\n<div class=\"note-detail-relation-map note-detail-printable\">\n    <div class=\"relation-map-wrapper\">\n       <div class=\"relation-map-container\"></div>\n    </div>\n</div>`;\n\nlet containerCounter = 1;\n\nexport default class RelationMapTypeWidget extends TypeWidget {\n    static getType() { return \"relationMap\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$relationMapContainer = this.$widget.find(\".relation-map-container\");\n\n        this.mapData = null;\n        this.jsPlumbInstance = null;\n        // outside of mapData because they are not persisted in the note content\n        this.relations = null;\n        this.pzInstance = null;\n\n        this.$relationMapWrapper = this.$widget.find('.relation-map-wrapper');\n        this.$relationMapWrapper.on('click', event => {\n            if (this.clipboard) {\n                let {x, y} = this.getMousePosition(event);\n\n                // modifying position so that the cursor is on the top-center of the box\n                x -= 80;\n                y -= 15;\n\n                this.createNoteBox(this.clipboard.noteId, this.clipboard.title, x, y);\n\n                this.mapData.notes.push({ noteId: this.clipboard.noteId, x, y });\n\n                this.saveData();\n\n                this.clipboard = null;\n            }\n\n            return true;\n        });\n\n        this.$relationMapContainer.attr(\"id\", \"relation-map-container-\" + (containerCounter++));\n        this.$relationMapContainer.on(\"contextmenu\", \".note-box\", e => {\n            contextMenu.show({\n                x: e.pageX,\n                y: e.pageY,\n                items: [\n                    {title: \"在新标签页中打开\", command: \"openInNewTab\", uiIcon: \"bx bx-empty\"},\n                    {title: \"删除笔记\", command: \"remove\", uiIcon: \"bx bx-trash\"},\n                    {title: \"编辑标题\", command: \"editTitle\", uiIcon: \"bx bx-pencil\"},\n                ],\n                selectMenuItemHandler: ({command}) => this.contextMenuHandler(command, e.target)\n            });\n\n            return false; // blocks default browser right click menu\n        });\n\n        this.clipboard = null;\n\n        this.$widget.on(\"drop\", ev => this.dropNoteOntoRelationMapHandler(ev));\n        this.$widget.on(\"dragover\", ev => ev.preventDefault());\n\n        this.initialized = new Promise(async res => {\n            await libraryLoader.requireLibrary(libraryLoader.RELATION_MAP);\n\n            jsPlumb.ready(res);\n        });\n\n        super.doRender();\n    }\n\n    async contextMenuHandler(command, originalTarget) {\n        const $noteBox = $(originalTarget).closest(\".note-box\");\n        const $title = $noteBox.find(\".title a\");\n        const noteId = this.idToNoteId($noteBox.prop(\"id\"));\n\n        if (command === \"openInNewTab\") {\n            appContext.tabManager.openTabWithNoteWithHoisting(noteId);\n        }\n        else if (command === \"remove\") {\n            const result = await dialogService.confirmDeleteNoteBoxWithNote($title.text());\n\n            if (!result.confirmed) {\n                return;\n            }\n\n            this.jsPlumbInstance.remove(this.noteIdToId(noteId));\n\n            if (result.isDeleteNoteChecked) {\n                const taskId = utils.randomString(10);\n\n                await server.remove(`notes/${noteId}?taskId=${taskId}&last=true`);\n            }\n\n            this.mapData.notes = this.mapData.notes.filter(note => note.noteId !== noteId);\n\n            this.relations = this.relations.filter(relation => relation.sourceNoteId !== noteId && relation.targetNoteId !== noteId);\n\n            this.saveData();\n        }\n        else if (command === \"editTitle\") {\n            const title = await dialogService.prompt({\n                title: \"重命名笔记\",\n                message: \"输入新的笔记标题:\",\n                defaultValue: $title.text()\n            });\n\n            if (!title) {\n                return;\n            }\n\n            await server.put(`notes/${noteId}/title`, { title });\n\n            $title.text(title);\n        }\n    }\n\n    async loadMapData() {\n        this.mapData = {\n            notes: [],\n            // it is important to have this exact value here so that initial transform is the same as this\n            // which will guarantee note won't be saved on first conversion to the relation map note type\n            // this keeps the principle that note type change doesn't destroy note content unless user\n            // does some actual change\n            transform: {\n                x: 0,\n                y: 0,\n                scale: 1\n            }\n        };\n\n        const blob = await this.note.getBlob();\n\n        if (blob.content) {\n            try {\n                this.mapData = JSON.parse(blob.content);\n            } catch (e) {\n                console.log(\"Could not parse content: \", e);\n            }\n        }\n    }\n\n    noteIdToId(noteId) {\n        return `rel-map-note-${noteId}`;\n    }\n\n    idToNoteId(id) {\n        return id.substr(13);\n    }\n\n    async doRefresh(note) {\n        await this.loadMapData();\n\n        this.initJsPlumbInstance();\n\n        this.initPanZoom();\n\n        this.loadNotesAndRelations();\n    }\n\n    clearMap() {\n        // delete all endpoints and connections\n        // this is done at this point (after async operations) to reduce flicker to the minimum\n        this.jsPlumbInstance.deleteEveryEndpoint();\n\n        // without this, we still end up with note boxes remaining in the canvas\n        this.$relationMapContainer.empty();\n    }\n\n    async loadNotesAndRelations() {\n        const noteIds = this.mapData.notes.map(note => note.noteId);\n        const data = await server.post(\"relation-map\", {noteIds, relationMapNoteId: this.noteId});\n\n        this.relations = [];\n\n        for (const relation of data.relations) {\n            const match = this.relations.find(rel =>\n                rel.name === data.inverseRelations[relation.name]\n                && ((rel.sourceNoteId === relation.sourceNoteId && rel.targetNoteId === relation.targetNoteId)\n                || (rel.sourceNoteId === relation.targetNoteId && rel.targetNoteId === relation.sourceNoteId)));\n\n            if (match) {\n                match.type = relation.type = relation.name === data.inverseRelations[relation.name] ? 'biDirectional' : 'inverse';\n                relation.render = false; // don't render second relation\n            } else {\n                relation.type = 'uniDirectional';\n                relation.render = true;\n            }\n\n            this.relations.push(relation);\n        }\n\n        this.mapData.notes = this.mapData.notes.filter(note => note.noteId in data.noteTitles);\n\n        this.jsPlumbInstance.batch(async () => {\n            this.clearMap();\n\n            for (const note of this.mapData.notes) {\n                const title = data.noteTitles[note.noteId];\n\n                await this.createNoteBox(note.noteId, title, note.x, note.y);\n            }\n\n            for (const relation of this.relations) {\n                if (!relation.render) {\n                    continue;\n                }\n\n                const connection = this.jsPlumbInstance.connect({\n                    source: this.noteIdToId(relation.sourceNoteId),\n                    target: this.noteIdToId(relation.targetNoteId),\n                    type: relation.type\n                });\n\n                connection.id = relation.attributeId;\n\n                if (relation.type === 'inverse') {\n                    connection.getOverlay(\"label-source\").setLabel(relation.name);\n                    connection.getOverlay(\"label-target\").setLabel(data.inverseRelations[relation.name]);\n                }\n                else {\n                    connection.getOverlay(\"label\").setLabel(relation.name);\n                }\n\n                connection.canvas.setAttribute(\"data-connection-id\", connection.id);\n            }\n        });\n    }\n\n    initPanZoom() {\n        if (this.pzInstance) {\n            return;\n        }\n\n        this.pzInstance = panzoom(this.$relationMapContainer[0], {\n            maxZoom: 2,\n            minZoom: 0.3,\n            smoothScroll: false,\n            filterKey: function(e, dx, dy, dz) {\n                // if ALT is pressed, then panzoom should bubble the event up\n                // this is to preserve ALT-LEFT, ALT-RIGHT navigation working\n                return e.altKey;\n            }\n        });\n\n        this.pzInstance.on('transform', () => { // gets triggered on any transform change\n            this.jsPlumbInstance.setZoom(this.getZoom());\n\n            this.saveCurrentTransform();\n        });\n\n        if (this.mapData.transform) {\n            this.pzInstance.zoomTo(0, 0, this.mapData.transform.scale);\n\n            this.pzInstance.moveTo(this.mapData.transform.x, this.mapData.transform.y);\n        }\n        else {\n            // set to initial coordinates\n            this.pzInstance.moveTo(0, 0);\n        }\n    }\n\n    saveCurrentTransform() {\n        const newTransform = this.pzInstance.getTransform();\n\n        if (JSON.stringify(newTransform) !== JSON.stringify(this.mapData.transform)) {\n            // clone transform object\n            this.mapData.transform = JSON.parse(JSON.stringify(newTransform));\n\n            this.saveData();\n        }\n    }\n\n    cleanup() {\n        if (this.jsPlumbInstance) {\n            this.clearMap();\n        }\n\n        if (this.pzInstance) {\n            this.pzInstance.dispose();\n            this.pzInstance = null;\n        }\n    }\n\n    initJsPlumbInstance () {\n        if (this.jsPlumbInstance) {\n            this.cleanup();\n\n            return;\n        }\n\n        this.jsPlumbInstance = jsPlumb.getInstance({\n            Endpoint: [\"Dot\", {radius: 2}],\n            Connector: \"StateMachine\",\n            ConnectionOverlays: uniDirectionalOverlays,\n            HoverPaintStyle: { stroke: \"#777\", strokeWidth: 1 },\n            Container: this.$relationMapContainer.attr(\"id\")\n        });\n\n        this.jsPlumbInstance.registerConnectionType(\"uniDirectional\", { anchor:\"Continuous\", connector:\"StateMachine\", overlays: uniDirectionalOverlays });\n\n        this.jsPlumbInstance.registerConnectionType(\"biDirectional\", { anchor:\"Continuous\", connector:\"StateMachine\", overlays: biDirectionalOverlays });\n\n        this.jsPlumbInstance.registerConnectionType(\"inverse\", { anchor:\"Continuous\", connector:\"StateMachine\", overlays: inverseRelationsOverlays });\n\n        this.jsPlumbInstance.registerConnectionType(\"link\", { anchor:\"Continuous\", connector:\"StateMachine\", overlays: linkOverlays });\n\n        this.jsPlumbInstance.bind(\"connection\", (info, originalEvent) => this.connectionCreatedHandler(info, originalEvent));\n    }\n\n    async connectionCreatedHandler(info, originalEvent) {\n        const connection = info.connection;\n\n        connection.bind(\"contextmenu\", (obj, event) => {\n            if (connection.getType().includes(\"link\")) {\n                // don't create context menu if it's a link since there's nothing to do with link from relation map\n                // (don't open browser menu either)\n                event.preventDefault();\n            }\n            else {\n                event.preventDefault();\n                event.stopPropagation();\n\n                contextMenu.show({\n                    x: event.pageX,\n                    y: event.pageY,\n                    items: [ {title: \"删除关系\", command: \"remove\", uiIcon: \"bx bx-trash\"} ],\n                    selectMenuItemHandler: async ({command}) => {\n                        if (command === 'remove') {\n                            if (!await dialogService.confirm(\"确定要删除这个关系吗?\")) {\n                                return;\n                            }\n\n                            const relation = this.relations.find(rel => rel.attributeId === connection.id);\n\n                            await server.remove(`notes/${relation.sourceNoteId}/relations/${relation.name}/to/${relation.targetNoteId}`);\n\n                            this.jsPlumbInstance.deleteConnection(connection);\n\n                            this.relations = this.relations.filter(relation => relation.attributeId !== connection.id);\n                        }\n                    }\n                });\n            }\n        });\n\n        // if there's no event, then this has been triggered programmatically\n        if (!originalEvent) {\n            return;\n        }\n\n        let name = await dialogService.prompt({\n            message: \"指定新的关系名称(允许的字符: 字母数字,冒号和下划线):\",\n            shown: ({ $answer }) => {\n                $answer.on('keyup', () => {\n                    // invalid characters are simply ignored (from user perspective they are not even entered)\n                    const attrName = utils.filterAttributeName($answer.val());\n\n                    $answer.val(attrName);\n                });\n\n                attributeAutocompleteService.initAttributeNameAutocomplete({\n                    $el: $answer,\n                    attributeType: \"relation\",\n                    open: true\n                });\n            }\n        });\n\n        if (!name || !name.trim()) {\n            this.jsPlumbInstance.deleteConnection(connection);\n\n            return;\n        }\n\n        name = utils.filterAttributeName(name);\n\n        const targetNoteId = this.idToNoteId(connection.target.id);\n        const sourceNoteId = this.idToNoteId(connection.source.id);\n\n        const relationExists = this.relations.some(rel =>\n            rel.targetNoteId === targetNoteId\n            && rel.sourceNoteId === sourceNoteId\n            && rel.name === name);\n\n        if (relationExists) {\n            await dialogService.info(`Connection '${name}' between these notes already exists.`);\n\n            this.jsPlumbInstance.deleteConnection(connection);\n\n            return;\n        }\n\n        await server.put(`notes/${sourceNoteId}/relations/${name}/to/${targetNoteId}`);\n\n        this.loadNotesAndRelations();\n    }\n\n    saveData() {\n        this.spacedUpdate.scheduleUpdate();\n    }\n\n    async createNoteBox(noteId, title, x, y) {\n        const $link = await linkService.createLink(noteId, {title});\n        $link.mousedown(e => linkService.goToLink(e));\n\n        const note = await froca.getNote(noteId);\n\n        const $noteBox = $(\"<div>\")\n            .addClass(\"note-box\")\n            .addClass(note.getCssClass())\n            .prop(\"id\", this.noteIdToId(noteId))\n            .append($(\"<span>\").addClass(\"title\").append($link))\n            .append($(\"<div>\").addClass(\"endpoint\").attr(\"title\", \"从这里拖拽到别的笔记来创建关系.\"))\n            .css(\"left\", `${x}px`)\n            .css(\"top\", `${y}px`);\n\n        this.jsPlumbInstance.getContainer().appendChild($noteBox[0]);\n\n        this.jsPlumbInstance.draggable($noteBox[0], {\n            start: params => {},\n            drag: params => {},\n            stop: params => {\n                const noteId = this.idToNoteId(params.el.id);\n\n                const note = this.mapData.notes.find(note => note.noteId === noteId);\n\n                if (!note) {\n                    logError(`笔记 ${noteId} 未找到!`);\n                    return;\n                }\n\n                [note.x, note.y] = params.finalPos;\n\n                this.saveData();\n            }\n        });\n\n        this.jsPlumbInstance.makeSource($noteBox[0], {\n            filter: \".endpoint\",\n            anchor: \"Continuous\",\n            connectorStyle: { stroke: \"#000\", strokeWidth: 1 },\n            connectionType: \"basic\",\n            extract:{\n                \"action\": \"the-action\"\n            }\n        });\n\n        this.jsPlumbInstance.makeTarget($noteBox[0], {\n            dropOptions: { hoverClass: \"dragHover\" },\n            anchor: \"Continuous\",\n            allowLoopback: true\n        });\n    }\n\n    getZoom() {\n        const matrixRegex = /matrix\\((-?\\d*\\.?\\d+),\\s*0,\\s*0,\\s*-?\\d*\\.?\\d+,\\s*-?\\d*\\.?\\d+,\\s*-?\\d*\\.?\\d+\\)/;\n\n        const transform = this.$relationMapContainer.css('transform');\n\n        if (transform === 'none') {\n            return 1;\n        }\n\n        const matches = transform.match(matrixRegex);\n\n        if (!matches) {\n            throw new Error(`Cannot match transform: ${transform}`);\n        }\n\n        return matches[1];\n    }\n\n    async dropNoteOntoRelationMapHandler(ev) {\n        ev.preventDefault();\n\n        const notes = JSON.parse(ev.originalEvent.dataTransfer.getData(\"text\"));\n\n        let {x, y} = this.getMousePosition(ev);\n\n        for (const note of notes) {\n            const exists = this.mapData.notes.some(n => n.noteId === note.noteId);\n\n            if (exists) {\n                toastService.showError(`笔记 \"${note.title}\" 已经在图中.`);\n\n                continue;\n            }\n\n            this.mapData.notes.push({noteId: note.noteId, x, y});\n\n            if (x > 1000) {\n                y += 100;\n                x = 0;\n            }\n            else {\n                x += 200;\n            }\n        }\n\n        this.saveData();\n\n        this.loadNotesAndRelations();\n    }\n\n    getMousePosition(evt) {\n        const rect = this.$relationMapContainer[0].getBoundingClientRect();\n\n        const zoom = this.getZoom();\n\n        return {\n            x: (evt.clientX - rect.left) / zoom,\n            y: (evt.clientY - rect.top) / zoom\n        };\n    }\n\n    getData() {\n        return {\n            content: JSON.stringify(this.mapData)\n        };\n    }\n\n    async relationMapCreateChildNoteEvent({ntxId}) {\n        if (!this.isNoteContext(ntxId)) {\n            return;\n        }\n\n        const title = await dialogService.prompt({ message: \"输入新笔记的标题\",  defaultValue: \"新建笔记\" });\n\n        if (!title.trim()) {\n            return;\n        }\n\n        const {note} = await server.post(`notes/${this.noteId}/children?target=into`, {\n            title,\n            content: '',\n            type: 'text'\n        });\n\n        toastService.showMessage(\"在画布上单击以放置新笔记\");\n\n        this.clipboard = { noteId: note.noteId, title };\n    }\n\n    relationMapResetPanZoomEvent({ntxId}) {\n        if (!this.isNoteContext(ntxId)) {\n            return;\n        }\n\n        // reset to initial pan & zoom state\n        this.pzInstance.zoomTo(0, 0, 1 / this.getZoom());\n        this.pzInstance.moveTo(0, 0);\n    }\n\n    relationMapResetZoomInEvent({ntxId}) {\n        if (!this.isNoteContext(ntxId)) {\n            return;\n        }\n\n        this.pzInstance.zoomTo(0, 0, 1.2);\n    }\n\n    relationMapResetZoomOutEvent({ntxId}) {\n        if (!this.isNoteContext(ntxId)) {\n            return;\n        }\n\n        this.pzInstance.zoomTo(0, 0, 0.8);\n    }\n}\n","/**\n * Returns a function, that, as long as it continues to be invoked, will not\n * be triggered. The function will be called after it stops being called for\n * N milliseconds. If `immediate` is passed, trigger the function on the\n * leading edge, instead of the trailing. The function also has a property 'clear'\n * that is a function which will clear the timer to prevent previously scheduled executions.\n *\n * @source underscore.js\n * @see http://unscriptable.com/2009/03/20/debouncing-javascript-methods/\n * @param {Function} func to wrap\n * @param {Number} waitMs in ms (`100`)\n * @param {Boolean} [immediate=false] whether to execute at the beginning (`false`)\n * @api public\n */\nfunction debounce(func, waitMs, immediate = false) {\n    let timeout, args, context, timestamp, result;\n    if (null == waitMs) waitMs = 100;\n\n    function later() {\n        const last = Date.now() - timestamp;\n\n        if (last < waitMs && last >= 0) {\n            timeout = setTimeout(later, waitMs - last);\n        } else {\n            timeout = null;\n            if (!immediate) {\n                result = func.apply(context, args);\n                context = args = null;\n            }\n        }\n    }\n\n    const debounced = function () {\n        context = this;\n        args = arguments;\n        timestamp = Date.now();\n        const callNow = immediate && !timeout;\n        if (!timeout) timeout = setTimeout(later, waitMs);\n        if (callNow) {\n            result = func.apply(context, args);\n            context = args = null;\n        }\n\n        return result;\n    };\n\n    debounced.clear = function() {\n        if (timeout) {\n            clearTimeout(timeout);\n            timeout = null;\n        }\n    };\n\n    debounced.flush = function() {\n        if (timeout) {\n            result = func.apply(context, args);\n            context = args = null;\n\n            clearTimeout(timeout);\n            timeout = null;\n        }\n    };\n\n    return debounced;\n}\n\n// Adds compatibility for ES modules\ndebounce.debounce = debounce;\n\nexport default debounce;\n","import libraryLoader from \"../../services/library_loader.js\";\nimport TypeWidget from \"./type_widget.js\";\nimport utils from '../../services/utils.js';\nimport linkService from '../../services/link.js';\nimport debounce from \"../../services/debounce.js\";\n\nconst {sleep} = utils;\n\nconst TPL = `\n    <div class=\"canvas-widget note-detail-canvas note-detail-printable note-detail\">\n        <style>\n        .excalidraw .App-menu_top .buttonList {\n            display: flex;\n        }\n        \n        /* Conflict between excalidraw and bootstrap classes keeps the menu hidden */\n        /* https://github.com/zadam/trilium/issues/3780 */\n        /* https://github.com/excalidraw/excalidraw/issues/6567 */\n        .excalidraw .dropdown-menu {\n            display: block;\n        }\n\n        .excalidraw-wrapper {\n            height: 100%;\n        }\n        \n        .excalidraw button[data-testid=\"json-export-button\"] {\n            display: none !important;\n        }\n\n        :root[dir=\"ltr\"]\n        .excalidraw\n        .layer-ui__wrapper\n        .zen-mode-transition.App-menu_bottom--transition-left {\n            transform: none;\n        }\n        \n        /* collaboration not possible so hide the button */\n        .CollabButton {\n            display: none !important;\n        }\n        \n        button[data-testid='save-button'], button[data-testid='json-export-button'] {\n            display: none !important; /* these exports don't work, user should use import/export dialog */\n        }\n        \n        .library-button {\n            display: none !important; /* library won't work without extra support which isn't currently implemented */\n        }\n\n        </style>\n        <!-- height here necessary. otherwise excalidraw not shown -->\n        <div class=\"canvas-render\" style=\"height: 100%\"></div>  \n    </div>\n`;\n\n/**\n * # Canvas note with excalidraw\n * @author thfrei 2022-05-11\n *\n * Background:\n * excalidraw gives great support for hand-drawn notes. It also allows including images and support\n * for sketching. Excalidraw has a vibrant and active community.\n *\n * Functionality:\n * We store the excalidraw assets (elements and files) in the note. In addition to that, we\n * export the SVG from the canvas on every update and store it in the note's attachment. It is used when\n * calling api/images and makes referencing very easy.\n *\n * Paths not taken.\n *  - excalidraw-to-svg (node.js) could be used to avoid storing the svg in the backend.\n *    We could render the SVG on the fly. However, as of now, it does not render any hand drawn\n *    (freedraw) paths. There is an issue with Path2D object not present in the node-canvas library\n *    used by jsdom. (See Trilium PR for samples and other issues in the respective library.\n *    Link will be added later). Related links:\n *     - https://github.com/Automattic/node-canvas/pull/2013\n *     - https://github.com/google/canvas-5-polyfill\n *     - https://github.com/Automattic/node-canvas/issues/1116\n *     - https://www.npmjs.com/package/path2d-polyfill\n *  - excalidraw-to-svg (node.js) takes quite some time to load an image (1-2s)\n *  - excalidraw-utils (browser) does render freedraw, however NOT freedraw with a background. It is not\n *    used, since it is a big dependency, and has the same functionality as react + excalidraw.\n *  - infinite-drawing-canvas with fabric.js. This library lacked a lot of features, excalidraw already\n *    has.\n *\n * Known issues:\n *  - the 3 excalidraw fonts should be included in the share and everywhere, so that it is shown\n *    when requiring svg.\n *\n * Discussion of storing svg in the note attachment:\n *  - Pro: we will combat bit-rot. Showing the SVG will be very fast and easy, since it is already there.\n *  - Con: The note will get bigger (~40-50%?), we will generate more bandwidth. However, using trilium\n *         desktop instance mitigates that issue.\n *\n * Roadmap:\n *  - Support image-notes as reference in excalidraw\n *  - Support canvas note as reference (svg) in other canvas notes.\n *  - Make it easy to include a canvas note inside a text note\n */\nexport default class ExcalidrawTypeWidget extends TypeWidget {\n    constructor() {\n        super();\n\n        // constants\n        this.SCENE_VERSION_INITIAL = -1; // -1 indicates that it is fresh. excalidraw scene version is always >0\n        this.SCENE_VERSION_ERROR = -2; // -2 indicates error\n\n        // config\n        this.DEBOUNCE_TIME_ONCHANGEHANDLER = 750; // ms\n        // ensure that assets are loaded from trilium\n        window.EXCALIDRAW_ASSET_PATH = `${window.location.origin}/node_modules/@excalidraw/excalidraw/dist/`;\n\n        // temporary vars\n        this.currentNoteId = \"\";\n        this.currentSceneVersion = this.SCENE_VERSION_INITIAL;\n\n        // will be overwritten\n        this.excalidrawRef;\n        this.$render;\n        this.$widget;\n        this.reactHandlers; // used to control react state\n\n        // binds\n        this.createExcalidrawReactApp = this.createExcalidrawReactApp.bind(this);\n        this.onChangeHandler = this.onChangeHandler.bind(this);\n        this.isNewSceneVersion = this.isNewSceneVersion.bind(this);\n\n        this.libraryChanged = false;\n    }\n\n    static getType() {\n        return \"canvas\";\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$widget.bind('mousewheel DOMMouseScroll', event => {\n            if (event.ctrlKey) {\n                event.preventDefault();\n                event.stopPropagation();\n                return false;\n            }\n        });\n\n        this.$widget.toggleClass(\"full-height\", true);\n        this.$render = this.$widget.find('.canvas-render');\n        const documentStyle = window.getComputedStyle(document.documentElement);\n        this.themeStyle = documentStyle.getPropertyValue('--theme-style')?.trim();\n\n        libraryLoader\n            .requireLibrary(libraryLoader.EXCALIDRAW)\n            .then(() => {\n                const React = window.React;\n                const ReactDOM = window.ReactDOM;\n                const renderElement = this.$render.get(0);\n\n                ReactDOM.unmountComponentAtNode(renderElement);\n                ReactDOM.render(React.createElement(this.createExcalidrawReactApp), renderElement);\n            });\n\n        return this.$widget;\n    }\n\n    /**\n     * called to populate the widget container with the note content\n     *\n     * @param {FNote} note\n     */\n    async doRefresh(note) {\n        // see if the note changed, since we do not get a new class for a new note\n        const noteChanged = this.currentNoteId !== note.noteId;\n        if (noteChanged) {\n            // reset the scene to omit unnecessary onchange handler\n            this.currentSceneVersion = this.SCENE_VERSION_INITIAL;\n        }\n        this.currentNoteId = note.noteId;\n\n        // get note from backend and put into canvas\n        const blob = await note.getBlob();\n\n        // before we load content into excalidraw, make sure excalidraw has loaded\n        while (!this.excalidrawRef?.current) {\n            console.log(\"excalidrawRef not yet loaded, sleep 200ms...\");\n            await sleep(200);\n        }\n\n        /**\n         * new and empty note - make sure that canvas is empty.\n         * If we do not set it manually, we occasionally get some \"bleeding\" from another\n         * note into this fresh note. Probably due to that this note-instance does not get\n         * newly instantiated?\n         */\n        if (!blob.content?.trim()) {\n            const sceneData = {\n                elements: [],\n                appState: {\n                    theme: this.themeStyle\n                },\n                collaborators: []\n            };\n\n            this.excalidrawRef.current.updateScene(sceneData);\n        }\n        else if (blob.content) {\n            // load saved content into excalidraw canvas\n            let content;\n\n            try {\n                content = blob.getJsonContent();\n            } catch(err) {\n                console.error(\"Error parsing content. Probably note.type changed. Starting with empty canvas\", note, blob, err);\n\n                content = {\n                    elements: [],\n                    files: [],\n                    appState: {}\n                };\n            }\n\n            const {elements, files, appState = {}} = content;\n\n            appState.theme = this.themeStyle;\n\n            const boundingClientRect = this.excalidrawWrapperRef.current.getBoundingClientRect();\n            appState.width = boundingClientRect.width;\n            appState.height = boundingClientRect.height;\n            appState.offsetLeft = boundingClientRect.left;\n            appState.offsetTop = boundingClientRect.top;\n\n            const sceneData = {\n                elements,\n                appState,\n                collaborators: []\n            };\n\n            // files are expected in an array when loading. they are stored as a key-index object\n            // see example for loading here:\n            // https://github.com/excalidraw/excalidraw/blob/c5a7723185f6ca05e0ceb0b0d45c4e3fbcb81b2a/src/packages/excalidraw/example/App.js#L68\n            const fileArray = [];\n            for (const fileId in files) {\n                const file = files[fileId];\n                // TODO: dataURL is replaceable with a trilium image url\n                //       maybe we can save normal images (pasted) with base64 data url, and trilium images\n                //       with their respective url! nice\n                // file.dataURL = \"http://localhost:8080/api/images/ltjOiU8nwoZx/start.png\";\n                fileArray.push(file);\n            }\n\n            this.excalidrawRef.current.updateScene(sceneData);\n            this.excalidrawRef.current.addFiles(fileArray);\n            this.excalidrawRef.current.history.clear();\n        }\n\n        Promise.all(\n            (await note.getAttachmentsByRole('canvasLibraryItem'))\n                .map(attachment => attachment.getBlob())\n        ).then(blobs => {\n            if (note.noteId !== this.currentNoteId) {\n                // current note changed in the course of the async operation\n                return;\n            }\n\n            const libraryItems = blobs.map(blob => blob.getJsonContentSafely()).filter(item => !!item);\n            this.excalidrawRef.current.updateLibrary({libraryItems, merge: false});\n        });\n\n        // set initial scene version\n        if (this.currentSceneVersion === this.SCENE_VERSION_INITIAL) {\n            this.currentSceneVersion = this.getSceneVersion();\n        }\n    }\n\n    /**\n     * gets data from widget container that will be sent via spacedUpdate.scheduleUpdate();\n     * this is automatically called after this.saveData();\n     */\n    async getData() {\n        const elements = this.excalidrawRef.current.getSceneElements();\n        const appState = this.excalidrawRef.current.getAppState();\n\n        /**\n         * A file is not deleted, even though removed from canvas. Therefore, we only keep\n         * files that are referenced by an element. Maybe this will change with a new excalidraw version?\n         */\n        const files = this.excalidrawRef.current.getFiles();\n\n        // parallel svg export to combat bitrot and enable rendering image for note inclusion, preview, and share\n        const svg = await window.ExcalidrawLib.exportToSvg({\n            elements,\n            appState,\n            exportPadding: 5, // 5 px padding\n            metadata: 'trilium-export',\n            files\n        });\n        const svgString = svg.outerHTML;\n\n        const activeFiles = {};\n        elements.forEach((element) => {\n            if (element.fileId) {\n                activeFiles[element.fileId] = files[element.fileId];\n            }\n        });\n\n        const content = {\n            type: \"excalidraw\",\n            version: 2,\n            elements,\n            files: activeFiles,\n            appState: {\n                scrollX: appState.scrollX,\n                scrollY: appState.scrollY,\n                zoom: appState.zoom\n            }\n        };\n\n        const attachments = [\n            { role: 'image', title: 'canvas-export.svg', mime: 'image/svg+xml', content: svgString, position: 0 }\n        ];\n\n        if (this.libraryChanged) {\n            // this.libraryChanged is unset in dataSaved()\n\n            // there's no separate method to get library items, so have to abuse this one\n            const libraryItems = await this.excalidrawRef.current.updateLibrary({merge: true});\n\n            let position = 10;\n\n            for (const libraryItem of libraryItems) {\n                attachments.push({\n                    role: 'canvasLibraryItem',\n                    title: libraryItem.id,\n                    mime: 'application/json',\n                    content: JSON.stringify(libraryItem),\n                    position: position\n                });\n\n                position += 10;\n            }\n        }\n\n        return {\n            content: JSON.stringify(content),\n            attachments\n        };\n    }\n\n    /**\n     * save content to backend\n     * spacedUpdate is kind of a debouncer.\n     */\n    saveData() {\n        this.spacedUpdate.scheduleUpdate();\n    }\n\n    dataSaved() {\n        this.libraryChanged = false;\n    }\n\n    onChangeHandler() {\n        // changeHandler is called upon any tiny change in excalidraw. button clicked, hover, etc.\n        // make sure only when a new element is added, we actually save something.\n        const isNewSceneVersion = this.isNewSceneVersion();\n        /**\n         * FIXME: however, we might want to make an exception, if viewport changed, since viewport\n         *        is desired to save? (add) and appState background, and some things\n         */\n\n        // upon updateScene, onchange is called, even though \"nothing really changed\" that is worth saving\n        const isNotInitialScene = this.currentSceneVersion !== this.SCENE_VERSION_INITIAL;\n\n        const shouldSave = isNewSceneVersion && isNotInitialScene;\n\n        if (shouldSave) {\n            this.updateSceneVersion();\n            this.saveData();\n        }\n    }\n\n    createExcalidrawReactApp() {\n        const React = window.React;\n        const { Excalidraw } = window.ExcalidrawLib;\n\n        const excalidrawRef = React.useRef(null);\n        this.excalidrawRef = excalidrawRef;\n        const excalidrawWrapperRef = React.useRef(null);\n        this.excalidrawWrapperRef = excalidrawWrapperRef;\n        const [dimensions, setDimensions] = React.useState({\n            width: undefined,\n            height: undefined\n        });\n\n        React.useEffect(() => {\n            const dimensions = {\n                width: excalidrawWrapperRef.current.getBoundingClientRect().width,\n                height: excalidrawWrapperRef.current.getBoundingClientRect().height\n            };\n            setDimensions(dimensions);\n\n            const onResize = () => {\n                if (this.note?.type !== 'canvas') {\n                    return;\n                }\n\n                const dimensions = {\n                    width: excalidrawWrapperRef.current.getBoundingClientRect().width,\n                    height: excalidrawWrapperRef.current.getBoundingClientRect().height\n                };\n                setDimensions(dimensions);\n            };\n\n            window.addEventListener(\"resize\", onResize);\n\n            return () => window.removeEventListener(\"resize\", onResize);\n        }, [excalidrawWrapperRef]);\n\n        const onLinkOpen = React.useCallback((element, event) => {\n            let link = element.link;\n\n            if (link.startsWith(\"root/\")) {\n                link = \"#\" + link;\n            }\n\n            const { nativeEvent } = event.detail;\n\n            event.preventDefault();\n\n            return linkService.goToLinkExt(nativeEvent, link, null);\n          }, []);\n\n        return React.createElement(\n            React.Fragment,\n            null,\n            React.createElement(\n                \"div\",\n                {\n                    className: \"excalidraw-wrapper\",\n                    ref: excalidrawWrapperRef\n                },\n                React.createElement(Excalidraw, {\n                    // this makes sure that 1) manual theme switch button is hidden 2) theme stays as it should after opening menu\n                    theme: this.themeStyle,\n                    ref: excalidrawRef,\n                    langCode: \"zh-CN\",\n                    width: dimensions.width,\n                    height: dimensions.height,\n                    onPaste: (data, event) => {\n                        console.log(\"Verbose: excalidraw internal paste. No trilium action implemented.\", data, event);\n                    },\n                    onLibraryChange: () => {\n                        this.libraryChanged = true;\n\n                        this.saveData();\n                    },\n                    onChange: debounce(this.onChangeHandler, this.DEBOUNCE_TIME_ONCHANGEHANDLER),\n                    viewModeEnabled: false,\n                    zenModeEnabled: false,\n                    gridModeEnabled: false,\n                    isCollaborating: false,\n                    detectScroll: false,\n                    handleKeyboardGlobally: false,\n                    autoFocus: false,\n                    onLinkOpen,\n                    UIOptions: {\n                        saveToActiveFile: false,\n                        saveAsImage: false\n                    }\n                })\n            )\n        );\n    }\n\n    /**\n     * needed to ensure, that multipleOnChangeHandler calls do not trigger a save.\n     * we compare the scene version as suggested in:\n     * https://github.com/excalidraw/excalidraw/issues/3014#issuecomment-778115329\n     *\n     * info: sceneVersions are not incrementing. it seems to be a pseudo-random number\n     */\n     isNewSceneVersion() {\n        const sceneVersion = this.getSceneVersion();\n\n        return this.currentSceneVersion === this.SCENE_VERSION_INITIAL // initial scene version update\n            || this.currentSceneVersion !== sceneVersion; // ensure scene changed\n    }\n\n    getSceneVersion() {\n        if (this.excalidrawRef) {\n            const elements = this.excalidrawRef.current.getSceneElements();\n            return window.ExcalidrawLib.getSceneVersion(elements);\n        } else {\n            return this.SCENE_VERSION_ERROR;\n        }\n    }\n\n    updateSceneVersion() {\n        this.currentSceneVersion = this.getSceneVersion();\n    }\n}\n","import libraryLoader from \"../services/library_loader.js\";\nimport server from \"../services/server.js\";\nimport attributeService from \"../services/attributes.js\";\nimport hoistedNoteService from \"../services/hoisted_note.js\";\nimport appContext from \"../components/app_context.js\";\nimport NoteContextAwareWidget from \"./note_context_aware_widget.js\";\nimport linkContextMenuService from \"../menus/link_context_menu.js\";\nimport utils from \"../services/utils.js\";\n\nconst esc = utils.escapeHtml;\n\nconst TPL = `<div class=\"note-map-widget\" style=\"position: relative;\">\n    <style>\n        .note-detail-note-map {\n            height: 100%;\n            overflow: hidden;\n        }\n        \n        .map-type-switcher {\n            position: absolute; \n            top: 10px; \n            left: 10px; \n            z-index: 10; /* should be below dropdown (note actions) */\n        }\n        \n        .map-type-switcher button.bx {\n            font-size: 130%;\n            padding: 1px 10px 1px 10px;\n        }\n    </style>\n    \n    <div class=\"btn-group btn-group-sm map-type-switcher\" role=\"group\">\n      <button type=\"button\" class=\"btn bx bx-network-chart\" title=\"链接地图\" data-type=\"link\"></button>\n      <button type=\"button\" class=\"btn bx bx-sitemap\" title=\"树形图\" data-type=\"tree\"></button>\n    </div>\n\n    <div class=\"style-resolver\"></div>\n\n    <div class=\"note-map-container\"></div>\n</div>`;\n\nexport default class NoteMapWidget extends NoteContextAwareWidget {\n    constructor(widgetMode) {\n        super();\n\n        this.widgetMode = widgetMode; // 'type' or 'ribbon'\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n\n        const documentStyle = window.getComputedStyle(document.documentElement);\n        this.themeStyle = documentStyle.getPropertyValue('--theme-style')?.trim();\n\n        this.$container = this.$widget.find(\".note-map-container\");\n        this.$styleResolver = this.$widget.find('.style-resolver');\n\n        new ResizeObserver(() => this.setDimensions()).observe(this.$container[0]);\n\n        this.$widget.find(\".map-type-switcher button\").on(\"click\",  async e => {\n            const type = $(e.target).closest(\"button\").attr(\"data-type\");\n\n            await attributeService.setLabel(this.noteId, 'mapType', type);\n        });\n\n        super.doRender();\n    }\n\n    setDimensions() {\n        if (!this.graph) { // no graph has been even rendered\n            return;\n        }\n\n        const $parent = this.$widget.parent();\n\n        this.graph\n            .height($parent.height())\n            .width($parent.width());\n    }\n\n    async refreshWithNote(note) {\n        this.$widget.show();\n\n        this.css = {\n            fontFamily: this.$container.css(\"font-family\"),\n            textColor: this.rgb2hex(this.$container.css(\"color\")),\n            mutedTextColor: this.rgb2hex(this.$styleResolver.css(\"color\"))\n        };\n\n        this.mapType = this.note.getLabelValue(\"mapType\") === \"tree\" ? \"tree\" : \"link\";\n\n        await libraryLoader.requireLibrary(libraryLoader.FORCE_GRAPH);\n\n        this.graph = ForceGraph()(this.$container[0])\n            .width(this.$container.width())\n            .height(this.$container.height())\n            .onZoom(zoom => this.setZoomLevel(zoom.k))\n            .d3AlphaDecay(0.01)\n            .d3VelocityDecay(0.08)\n            .nodeCanvasObject((node, ctx) => this.paintNode(node, this.getColorForNode(node), ctx))\n            .nodePointerAreaPaint((node, ctx) => this.paintNode(node, this.getColorForNode(node), ctx))\n            .nodePointerAreaPaint((node, color, ctx) => {\n                ctx.fillStyle = color;\n                ctx.beginPath();\n                ctx.arc(node.x, node.y, this.noteIdToSizeMap[node.id], 0, 2 * Math.PI, false);\n                ctx.fill();\n            })\n            .nodeLabel(node => esc(node.name))\n            .maxZoom(7)\n            .warmupTicks(30)\n            .linkDirectionalArrowLength(5)\n            .linkDirectionalArrowRelPos(1)\n            .linkWidth(1)\n            .linkColor(() => this.css.mutedTextColor)\n            .onNodeClick(node => appContext.tabManager.getActiveContext().setNote(node.id))\n            .onNodeRightClick((node, e) => linkContextMenuService.openContextMenu(node.id, e));\n\n        if (this.mapType === 'link') {\n            this.graph\n                .linkLabel(l => `${esc(l.source.name)} - <strong>${esc(l.name)}</strong> - ${esc(l.target.name)}`)\n                .linkCanvasObject((link, ctx) => this.paintLink(link, ctx))\n                .linkCanvasObjectMode(() => \"after\");\n        }\n\n        const mapRootNoteId = this.getMapRootNoteId();\n        const data = await this.loadNotesAndRelations(mapRootNoteId);\n\n        const nodeLinkRatio = data.nodes.length / data.links.length;\n        const magnifiedRatio = Math.pow(nodeLinkRatio, 1.5);\n        const charge = -20 / magnifiedRatio;\n        const boundedCharge = Math.min(-3, charge);\n\n        this.graph.d3Force('link').distance(40);\n        this.graph.d3Force('center').strength(0.2);\n        this.graph.d3Force('charge').strength(boundedCharge);\n        this.graph.d3Force('charge').distanceMax(1000);\n\n        this.renderData(data);\n    }\n\n    getMapRootNoteId() {\n        if (this.widgetMode === 'ribbon') {\n            return this.noteId;\n        }\n\n        let mapRootNoteId = this.note.getLabelValue(\"mapRootNoteId\");\n\n        if (mapRootNoteId === 'hoisted') {\n            mapRootNoteId = hoistedNoteService.getHoistedNoteId();\n        } else if (!mapRootNoteId) {\n            mapRootNoteId = appContext.tabManager.getActiveContext().parentNoteId;\n        }\n\n        return mapRootNoteId;\n    }\n\n    getColorForNode(node) {\n        if (node.color) {\n            return node.color;\n        } else if (this.widgetMode === 'ribbon' && node.id === this.noteId) {\n            return 'red'; // subtree root mark as red\n        } else {\n            return this.generateColorFromString(node.type);\n        }\n    }\n\n    generateColorFromString(str) {\n        if (this.themeStyle === \"dark\") {\n            str = `0${str}`; // magic lightning modifier\n        }\n\n        let hash = 0;\n        for (let i = 0; i < str.length; i++) {\n            hash = str.charCodeAt(i) + ((hash << 5) - hash);\n        }\n\n        let color = '#';\n        for (let i = 0; i < 3; i++) {\n            const value = (hash >> (i * 8)) & 0xFF;\n\n            color += (`00${value.toString(16)}`).substr(-2);\n        }\n        return color;\n    }\n\n    rgb2hex(rgb) {\n        return `#${rgb.match(/^rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)$/)\n            .slice(1)\n            .map(n => parseInt(n, 10).toString(16).padStart(2, '0'))\n            .join('')}`\n    }\n\n    setZoomLevel(level) {\n        this.zoomLevel = level;\n    }\n\n    paintNode(node, color, ctx) {\n        const {x, y} = node;\n        const size = this.noteIdToSizeMap[node.id];\n\n        ctx.fillStyle = color;\n        ctx.beginPath();\n        ctx.arc(x, y, size, 0, 2 * Math.PI, false);\n        ctx.fill();\n\n        const toRender = this.zoomLevel > 2\n            || (this.zoomLevel > 1 && size > 6)\n            || (this.zoomLevel > 0.3 && size > 10);\n\n        if (!toRender) {\n            return;\n        }\n\n        ctx.fillStyle = this.css.textColor;\n        ctx.font = `${size}px ${this.css.fontFamily}`;\n        ctx.textAlign = 'center';\n        ctx.textBaseline = 'middle';\n\n        let title = node.name;\n\n        if (title.length > 15) {\n            title = `${title.substr(0, 15)}...`;\n        }\n\n        ctx.fillText(title, x, y + Math.round(size * 1.5));\n    }\n\n    paintLink(link, ctx) {\n        if (this.zoomLevel < 5) {\n            return;\n        }\n\n        ctx.font = `3px ${this.css.fontFamily}`;\n        ctx.textAlign = 'center';\n        ctx.textBaseline = 'middle';\n        ctx.fillStyle = this.css.mutedTextColor;\n\n        const {source, target} = link;\n\n        const x = (source.x + target.x) / 2;\n        const y = (source.y + target.y) / 2;\n\n        ctx.save();\n        ctx.translate(x, y);\n\n        const deltaY = source.y - target.y;\n        const deltaX = source.x - target.x;\n\n        let angle = Math.atan2(deltaY, deltaX);\n        let moveY = 2;\n\n        if (angle < -Math.PI / 2 || angle > Math.PI / 2) {\n            angle += Math.PI;\n            moveY = -2;\n        }\n\n        ctx.rotate(angle);\n        ctx.fillText(link.name, 0, moveY);\n        ctx.restore();\n    }\n\n    async loadNotesAndRelations(mapRootNoteId) {\n        const resp = await server.post(`note-map/${mapRootNoteId}/${this.mapType}`);\n\n        this.calculateNodeSizes(resp);\n\n        const links = this.getGroupedLinks(resp.links);\n\n        this.nodes = resp.notes.map(([noteId, title, type, color]) => ({\n            id: noteId,\n            name: title,\n            type: type,\n            color: color\n        }));\n\n        return {\n            nodes: this.nodes,\n            links: links.map(link => ({\n                id: `${link.sourceNoteId}-${link.targetNoteId}`,\n                source: link.sourceNoteId,\n                target: link.targetNoteId,\n                name: link.names.join(\", \")\n            }))\n        };\n    }\n\n    getGroupedLinks(links) {\n        const linksGroupedBySourceTarget = {};\n\n        for (const link of links) {\n            const key = `${link.sourceNoteId}-${link.targetNoteId}`;\n\n            if (key in linksGroupedBySourceTarget) {\n                if (!linksGroupedBySourceTarget[key].names.includes(link.name)) {\n                    linksGroupedBySourceTarget[key].names.push(link.name);\n                }\n            } else {\n                linksGroupedBySourceTarget[key] = {\n                    id: key,\n                    sourceNoteId: link.sourceNoteId,\n                    targetNoteId: link.targetNoteId,\n                    names: [link.name]\n                }\n            }\n        }\n\n        return Object.values(linksGroupedBySourceTarget);\n    }\n\n    calculateNodeSizes(resp) {\n        this.noteIdToSizeMap = {};\n\n        if (this.mapType === 'tree') {\n            const {noteIdToDescendantCountMap} = resp;\n\n            for (const noteId in noteIdToDescendantCountMap) {\n                this.noteIdToSizeMap[noteId] = 4;\n\n                const count = noteIdToDescendantCountMap[noteId];\n\n                if (count > 0) {\n                    this.noteIdToSizeMap[noteId] += 1 + Math.round(Math.log(count) / Math.log(1.5));\n                }\n            }\n        }\n        else if (this.mapType === 'link') {\n            const noteIdToLinkCount = {};\n\n            for (const link of resp.links) {\n                noteIdToLinkCount[link.targetNoteId] = 1 + (noteIdToLinkCount[link.targetNoteId] || 0);\n            }\n\n            for (const [noteId] of resp.notes) {\n                this.noteIdToSizeMap[noteId] = 4;\n\n                if (noteId in noteIdToLinkCount) {\n                    this.noteIdToSizeMap[noteId] += Math.min(Math.pow(noteIdToLinkCount[noteId], 0.5), 15);\n                }\n            }\n        }\n    }\n\n    renderData(data) {\n        this.graph.graphData(data);\n\n        if (this.widgetMode === 'ribbon' && this.note?.type !== 'search') {\n            setTimeout(() => {\n                this.setDimensions();\n\n                const subGraphNoteIds = this.getSubGraphConnectedToCurrentNote(data);\n\n                this.graph.zoomToFit(400, 50, node => subGraphNoteIds.has(node.id));\n\n                if (subGraphNoteIds.size < 30) {\n                    this.graph.d3VelocityDecay(0.4);\n                }\n            }, 1000);\n        }\n        else {\n            if (data.nodes.length > 1) {\n                setTimeout(() => {\n                    this.setDimensions();\n\n                    const noteIdsWithLinks = this.getNoteIdsWithLinks(data);\n\n                    if (noteIdsWithLinks.size > 0) {\n                        this.graph.zoomToFit(400, 30, node => noteIdsWithLinks.has(node.id));\n                    }\n\n                    if (noteIdsWithLinks.size < 30) {\n                        this.graph.d3VelocityDecay(0.4);\n                    }\n                }, 1000);\n            }\n        }\n    }\n\n    getNoteIdsWithLinks(data) {\n        const noteIds = new Set();\n\n        for (const link of data.links) {\n            noteIds.add(link.source.id);\n            noteIds.add(link.target.id);\n        }\n\n        return noteIds;\n    }\n\n    getSubGraphConnectedToCurrentNote(data) {\n        function getGroupedLinks(links, type) {\n            const map = {};\n\n            for (const link of links) {\n                const key = link[type].id;\n                map[key] = map[key] || [];\n                map[key].push(link);\n            }\n\n            return map;\n        }\n\n        const linksBySource = getGroupedLinks(data.links, \"source\");\n        const linksByTarget = getGroupedLinks(data.links, \"target\");\n\n        const subGraphNoteIds = new Set();\n\n        function traverseGraph(noteId) {\n            if (subGraphNoteIds.has(noteId)) {\n                return;\n            }\n\n            subGraphNoteIds.add(noteId);\n\n            for (const link of linksBySource[noteId] || []) {\n                traverseGraph(link.target.id);\n            }\n\n            for (const link of linksByTarget[noteId] || []) {\n                traverseGraph(link.source.id);\n            }\n        }\n\n        traverseGraph(this.noteId);\n        return subGraphNoteIds;\n    }\n\n    cleanup() {\n        this.$container.html('');\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.getAttributeRows(this.componentId).find(\n            attr =>\n                attr.type === 'label'\n                && ['mapType', 'mapRootNoteId'].includes(attr.name)\n                && attributeService.isAffecting(attr, this.note)\n        )) {\n            this.refresh();\n        }\n    }\n}\n","import server from \"../../../services/server.js\";\nimport toastService from \"../../../services/toast.js\";\nimport NoteContextAwareWidget from \"../../note_context_aware_widget.js\";\n\nexport default class OptionsWidget extends NoteContextAwareWidget {\n    constructor() {\n        super();\n\n        this.contentSized();\n    }\n\n    async updateOption(name, value) {\n        const opts = { [name]: value };\n\n        await this.updateMultipleOptions(opts);\n    }\n\n    async updateMultipleOptions(opts) {\n        await server.put('options', opts);\n\n        this.showUpdateNotification();\n    }\n\n    showUpdateNotification() {\n        toastService.showPersistent({\n            id: \"options-change-saved\",\n            title: \"选项状态\",\n            message: \"选项更改已保存.\",\n            icon: \"slider\",\n            closeAfter: 2000\n        });\n    }\n\n    async updateCheckboxOption(name, $checkbox) {\n        const isChecked = $checkbox.prop(\"checked\");\n\n        return await this.updateOption(name, isChecked ? 'true' : 'false');\n    }\n\n    setCheckboxState($checkbox, optionValue) {\n        $checkbox.prop('checked', optionValue === 'true');\n    }\n\n    optionsLoaded(options) {}\n\n    async refreshWithNote(note) {\n        const options = await server.get('options');\n\n        this.optionsLoaded(options);\n    }\n\n    async entitiesReloadedEvent({loadResults}) {\n        if (loadResults.getOptionNames().length > 0) {\n            this.refresh();\n        }\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\nimport utils from \"../../../../services/utils.js\";\n\nconst FONT_FAMILIES = [\n    { value: \"theme\", label: \"Theme defined\" },\n    { value: \"serif\", label: \"Serif\" },\n    { value: \"sans-serif\", label: \"Sans Serif\" },\n    { value: \"monospace\", label: \"Monospace\" },\n    { value: \"Arial\", label: \"Arial\" },\n    { value: \"Verdana\", label: \"Verdana\" },\n    { value: \"Helvetica\", label: \"Helvetica\" },\n    { value: \"Tahoma\", label: \"Tahoma\" },\n    { value: \"Trebuchet MS\", label: \"Trebuchet MS\" },\n    { value: \"Times New Roman\", label: \"Times New Roman\" },\n    { value: \"Georgia\", label: \"Georgia\" },\n    { value: \"Garamond\", label: \"Garamond\" },\n    { value: \"Courier New\", label: \"Courier New\" },\n    { value: \"Brush Script MT\", label: \"Brush Script MT\" },\n    { value: \"Impact\", label: \"Impact\" },\n    { value: \"American Typewriter\", label: \"American Typewriter\" },\n    { value: \"Andalé Mono\", label: \"Andalé Mono\" },\n    { value: \"Lucida Console\", label: \"Lucida Console\" },\n    { value: \"Monaco\", label: \"Monaco\" },\n    { value: \"Bradley Hand\", label: \"Bradley Hand\" },\n    { value: \"Luminari\", label: \"Luminari\" },\n    { value: \"Comic Sans MS\", label: \"Comic Sans MS\" },\n    { value: \"Microsoft YaHei\", label: \"Microsoft YaHei\" },\n];\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>字体</h4>\n    \n    <h5>主字体</h5>\n    \n    <div class=\"form-group row\">\n        <div class=\"col-6\">\n            <label>字体系列</label>\n            <select class=\"main-font-family form-control\"></select>\n        </div>\n    \n        <div class=\"col-6\">\n            <label>大小</label>\n\n            <div class=\"input-group\">\n                <input type=\"number\" class=\"main-font-size form-control options-number-input\" min=\"50\" max=\"200\" step=\"10\"/>\n                <div class=\"input-group-append\">\n                    <span class=\"input-group-text\">%</span>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <h5>笔记树字体</h5>\n\n    <div class=\"form-group row\">\n        <div class=\"col-4\">\n            <label>字体系列</label>\n            <select class=\"tree-font-family form-control\"></select>\n        </div>\n    \n        <div class=\"col-4\">\n            <label>大小</label>\n\n            <div class=\"input-group\">\n                <input type=\"number\" class=\"tree-font-size form-control options-number-input\" min=\"50\" max=\"200\" step=\"10\"/>\n                <div class=\"input-group-append\">\n                    <span class=\"input-group-text\">%</span>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <h5>笔记详情字体</h5>\n    \n    <div class=\"form-group row\">\n        <div class=\"col-4\">\n            <label>字体系列</label>\n            <select class=\"detail-font-family form-control\"></select>\n        </div>\n        \n        <div class=\"col-4\">\n            <label>大小</label>\n\n            <div class=\"input-group\">\n                <input type=\"number\" class=\"detail-font-size form-control options-number-input\" min=\"50\" max=\"200\" step=\"10\"/>\n                <div class=\"input-group-append\">\n                    <span class=\"input-group-text\">%</span>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <h5>等宽字体 (代码)</h5>\n    \n    <div class=\"form-group row\">\n        <div class=\"col-4\">\n            <label>字体系列</label>\n            <select class=\"monospace-font-family form-control\"></select>\n        </div>\n    \n        <div class=\"col-4\">\n            <label>大小</label>\n\n            <div class=\"input-group\">\n                <input type=\"number\" class=\"monospace-font-size form-control options-number-input\" min=\"50\" max=\"200\" step=\"10\"/>\n                <div class=\"input-group-append\">\n                    <span class=\"input-group-text\">%</span>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <p>注意树和详情字体的大小和主字体大小有关.</p>\n\n    <p>并非所有列出的字体都可以在您的系统上使用.</p>\n    \n    <p>\n        应用字体修改, 请点击 \n        <button class=\"btn btn-micro reload-frontend-button\">重新加载前端</button>\n    </p>\n</div>`;\n\nexport default class FontsOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$mainFontSize = this.$widget.find(\".main-font-size\");\n        this.$mainFontFamily = this.$widget.find(\".main-font-family\");\n\n        this.$treeFontSize = this.$widget.find(\".tree-font-size\");\n        this.$treeFontFamily = this.$widget.find(\".tree-font-family\");\n\n        this.$detailFontSize = this.$widget.find(\".detail-font-size\");\n        this.$detailFontFamily = this.$widget.find(\".detail-font-family\");\n\n        this.$monospaceFontSize = this.$widget.find(\".monospace-font-size\");\n        this.$monospaceFontFamily = this.$widget.find(\".monospace-font-family\");\n\n        this.$widget.find(\".reload-frontend-button\").on(\"click\", () => utils.reloadFrontendApp(\"changes from appearance options\"));\n    }\n\n    async optionsLoaded(options) {\n        if (options.overrideThemeFonts !== 'true') {\n            this.toggleInt(false);\n            return;\n        }\n\n        this.toggleInt(true);\n\n        this.$mainFontSize.val(options.mainFontSize);\n        this.fillFontFamilyOptions(this.$mainFontFamily, options.mainFontFamily);\n\n        this.$treeFontSize.val(options.treeFontSize);\n        this.fillFontFamilyOptions(this.$treeFontFamily, options.treeFontFamily);\n\n        this.$detailFontSize.val(options.detailFontSize);\n        this.fillFontFamilyOptions(this.$detailFontFamily, options.detailFontFamily);\n\n        this.$monospaceFontSize.val(options.monospaceFontSize);\n        this.fillFontFamilyOptions(this.$monospaceFontFamily, options.monospaceFontFamily);\n\n        const optionsToSave = [\n            'mainFontFamily', 'mainFontSize',\n            'treeFontFamily', 'treeFontSize',\n            'detailFontFamily', 'detailFontSize',\n            'monospaceFontFamily', 'monospaceFontSize'\n        ];\n\n        for (const optionName of optionsToSave) {\n            this[`$${optionName}`].on('change', () =>\n                this.updateOption(optionName, this[`$${optionName}`].val()));\n        }\n    }\n\n    fillFontFamilyOptions($select, currentValue) {\n        $select.empty();\n\n        for (const {value, label} of FONT_FAMILIES) {\n            $select.append($(\"<option>\")\n                .attr(\"value\", value)\n                .prop(\"selected\", value === currentValue)\n                .text(label));\n        }\n    }\n}\n","import server from \"../../../services/server.js\";\nimport utils from \"../../../services/utils.js\";\nimport dialogService from \"../../../services/dialog.js\";\nimport OptionsWidget from \"./options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section shortcuts-options-section\">\n    <style>\n        .shortcuts-options-section {\n            display: flex; \n            flex-direction: column; \n            height: 100%;\n        }\n    \n        .shortcuts-table-container {\n            overflow: auto; \n            flex-grow: 1; \n            flex-shrink: 1; \n        }    \n        \n        .shortcuts-options-buttons {\n            display: flex; \n            justify-content: space-between;\n            margin: 15px 15px 0 15px;\n        }\n    </style>\n\n    <h4>快捷键</h4>\n    \n    <p>\n      同一操作的多个快捷方式可以用逗号隔开.\n      更多快捷键设置请查看<a href=\"https://www.electronjs.org/docs/latest/api/accelerator\">Electron 文档</a>.\n    </p>\n    \n    <div class=\"form-group\">\n        <input type=\"text\" class=\"keyboard-shortcut-filter form-control\" placeholder=\"输入关键字过滤快捷键...\">\n    </div>\n    \n    <div class=\"shortcuts-table-container\">\n        <table class=\"keyboard-shortcut-table\" cellpadding=\"10\">\n        <thead>\n            <tr>\n                <th>动作名称</th>\n                <th>快捷键</th>\n                <th>默认快捷键</th>\n                <th>描述</th>\n            </tr>\n        </thead>\n        <tbody></tbody>\n        </table>\n    </div>\n    \n    <div class=\"shortcuts-options-buttons\">\n        <button class=\"options-keyboard-shortcuts-reload-app btn btn-primary\">重新加载应用程序以应用更改</button>\n        \n        <button class=\"options-keyboard-shortcuts-set-all-to-default btn\">重置所有快捷键</button>\n    </div>\n</div>`;\n\nlet globActions;\n\nexport default class KeyboardShortcutsOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$widget.find(\".options-keyboard-shortcuts-reload-app\").on(\"click\", () => utils.reloadFrontendApp());\n\n        const $table = this.$widget.find(\".keyboard-shortcut-table tbody\");\n\n        server.get('keyboard-actions').then(actions => {\n            globActions = actions;\n\n            for (const action of actions) {\n                const $tr = $(\"<tr>\");\n\n                if (action.separator) {\n                    $tr.append(\n                        $('<td colspan=\"4\">')\n                            .attr(\"style\",\"background-color: var(--accented-background-color); font-weight: bold;\")\n                            .text(action.separator)\n                    )\n                }\n                else {\n                    $tr.append($(\"<td>\").text(action.actionName))\n                        .append($(\"<td>\").append(\n                            $(`<input type=\"text\" class=\"form-control\">`)\n                                .val(action.effectiveShortcuts.join(\", \"))\n                                .attr('data-keyboard-action-name', action.actionName)\n                                .attr('data-default-keyboard-shortcuts', action.defaultShortcuts.join(\", \"))\n                            )\n                        )\n                        .append($(\"<td>\").text(action.defaultShortcuts.join(\", \")))\n                        .append($(\"<td>\").text(action.description));\n                }\n\n                $table.append($tr);\n            }\n        });\n\n        $table.on('change', 'input.form-control', e => {\n            const $input = this.$widget.find(e.target);\n            const actionName = $input.attr('data-keyboard-action-name');\n            const shortcuts = $input.val()\n                              .replace('+,', \"+Comma\")\n                              .split(\",\")\n                              .map(shortcut => shortcut.replace(\"+Comma\", \"+,\"))\n                              .filter(shortcut => !!shortcut);\n\n            const optionName = `keyboardShortcuts${actionName.substr(0, 1).toUpperCase()}${actionName.substr(1)}`;\n\n            this.updateOption(optionName, JSON.stringify(shortcuts));\n        });\n\n        this.$widget.find(\".options-keyboard-shortcuts-set-all-to-default\").on('click', async () => {\n            if (!await dialogService.confirm(\"确定要重置所有快捷键吗？\")) {\n                return;\n            }\n\n            $table.find('input.form-control').each((_index, el) => {\n                const defaultShortcuts = this.$widget.find(el).attr('data-default-keyboard-shortcuts');\n\n                if (this.$widget.find(el).val() !== defaultShortcuts) {\n                    this.$widget.find(el)\n                        .val(defaultShortcuts)\n                        .trigger('change');\n                }\n            });\n        });\n\n        const $filter = this.$widget.find(\".keyboard-shortcut-filter\");\n\n        $filter.on('keyup', () => {\n            const filter = $filter.val().trim().toLowerCase();\n\n            $table.find(\"tr\").each((i, el) => {\n                if (!filter) {\n                    this.$widget.find(el).show();\n                    return;\n                }\n\n                const actionName = this.$widget.find(el).find('input').attr('data-keyboard-action-name');\n\n                if (!actionName) {\n                    this.$widget.find(el).hide();\n                    return;\n                }\n\n                const action = globActions.find(act => act.actionName === actionName);\n\n                if (!action) {\n                    this.$widget.find(el).hide();\n                    return;\n                }\n\n                this.$widget.find(el).toggle(!!( // !! to avoid toggle overloads with different behavior\n                    action.actionName.toLowerCase().includes(filter)\n                    || action.defaultShortcuts.some(shortcut => shortcut.toLowerCase().includes(filter))\n                    || action.effectiveShortcuts.some(shortcut => shortcut.toLowerCase().includes(filter))\n                    || (action.description && action.description.toLowerCase().includes(filter))\n                ));\n            });\n        });\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\nimport mimeTypesService from \"../../../../services/mime_types.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>下拉菜单可用的MIME文件类型</h4>\n    \n    <ul class=\"options-mime-types\" style=\"list-style-type: none;\"></ul>\n</div>`;\n\nlet idCtr = 1; // global, since this can be shown in multiple dialogs\n\nexport default class CodeMimeTypesOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$mimeTypes = this.$widget.find(\".options-mime-types\");\n    }\n\n    async optionsLoaded(options) {\n        this.$mimeTypes.empty();\n\n        for (const mimeType of await mimeTypesService.getMimeTypes()) {\n            const id = \"code-mime-type-\" + (idCtr++);\n\n            this.$mimeTypes.append($(\"<li>\")\n                .append($('<input type=\"checkbox\">')\n                    .attr(\"id\", id)\n                    .attr(\"data-mime-type\", mimeType.mime)\n                    .prop(\"checked\", mimeType.enabled))\n                .on('change', () => this.save())\n                .append(\" &nbsp; \")\n                .append($('<label>')\n                    .attr(\"for\", id)\n                    .text(mimeType.title))\n            );\n        }\n    }\n\n    async save() {\n        const enabledMimeTypes = [];\n\n        this.$mimeTypes.find(\"input:checked\").each(\n            (i, el) => enabledMimeTypes.push(this.$widget.find(el).attr(\"data-mime-type\")));\n\n        await this.updateOption('codeNotesMimeTypes', JSON.stringify(enabledMimeTypes));\n\n        mimeTypesService.loadMimeTypes();\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\nimport utils from \"../../../../services/utils.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>搜索引擎</h4>\n    \n    <p>自定义搜索引擎需要设置名称和URL。如果其中任何一个未设置，将使用DuckDuckGo作为默认搜索引擎。</p>\n    \n    <form class=\"sync-setup-form\">\n        <div class=\"form-group\">\n            <label>预定义的搜索引擎模板</label>\n            <select class=\"predefined-search-engine-select form-control\">\n                <option value=\"Bing\">必应</option>\n                <option value=\"Baidu\">百度</option>\n                <option value=\"DuckDuckGo\">DuckDuckGo</option>\n                <option value=\"Google\">谷歌</option>\n            </select>\n        </div>\n        \n        <div class=\"form-group\">\n            <label>自定义搜索引擎名称</label>\n            <input type=\"text\" class=\"custom-search-engine-name form-control\" placeholder=\"Customize search engine name\">\n        </div>\n        \n        <div class=\"form-group\">\n            <label>自定义搜索引擎的URL应该包含<code>{keyword}</code>作为搜索词的占位符。</label>\n            <input type=\"text\" class=\"custom-search-engine-url form-control\" placeholder=\"Customize search engine url\">\n        </div>\n        \n        <div style=\"display: flex; justify-content: space-between;\">\n            <button class=\"btn btn-primary\">保存</button>\n        </div>\n    </form>\n</div>`;\n\nconst SEARCH_ENGINES = {\n    \"Bing\": \"https://www.bing.com/search?q={keyword}\",\n    \"Baidu\": \"https://www.baidu.com/s?wd={keyword}\",\n    \"DuckDuckGo\": \"https://duckduckgo.com/?q={keyword}\",\n    \"Google\": \"https://www.google.com/search?q={keyword}\",\n}\n\nexport default class SearchEngineOptions extends OptionsWidget {\n    isEnabled() {\n        return super.isEnabled() && utils.isElectron();\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$form = this.$widget.find(\".sync-setup-form\");\n        this.$predefinedSearchEngineSelect = this.$widget.find(\".predefined-search-engine-select\");\n        this.$customSearchEngineName = this.$widget.find(\".custom-search-engine-name\");\n        this.$customSearchEngineUrl = this.$widget.find(\".custom-search-engine-url\");\n\n        this.$predefinedSearchEngineSelect.on('change', () => {\n            const predefinedSearchEngine = this.$predefinedSearchEngineSelect.val();\n            this.$customSearchEngineName[0].value = predefinedSearchEngine;\n            this.$customSearchEngineUrl[0].value = SEARCH_ENGINES[predefinedSearchEngine];\n        });\n\n        this.$form.on('submit', () => {\n            this.updateMultipleOptions({\n                'customSearchEngineName': this.$customSearchEngineName.val(),\n                'customSearchEngineUrl': this.$customSearchEngineUrl.val()\n            });\n        });\n    }\n\n    async optionsLoaded(options) {\n        this.$predefinedSearchEngineSelect.val(\"\");\n        this.$customSearchEngineName[0].value = options.customSearchEngineName;\n        this.$customSearchEngineUrl[0].value = options.customSearchEngineUrl;\n    }\n}\n","import NoteContextAwareWidget from \"../../note_context_aware_widget.js\";\nimport server from \"../../../services/server.js\";\n\nconst TPL = `<div style=\"height: 100%; display: flex; flex-direction: column;\">\n    <style>\n        .backend-log-textarea {\n            flex-grow: 1; \n            width: 100%;\n            border: none;\n        }   \n    </style>\n\n    <textarea class=\"backend-log-textarea\" readonly=\"readonly\"></textarea>\n    \n    <div style=\"display: flex; justify-content: space-around; margin-top: 10px;\">\n        <button class=\"refresh-backend-log-button btn btn-primary\">刷新</button>\n    </div>\n</div>`;\n\nexport default class BackendLogWidget extends NoteContextAwareWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$backendLogTextArea = this.$widget.find(\".backend-log-textarea\");\n        this.$refreshBackendLog = this.$widget.find(\".refresh-backend-log-button\");\n\n        this.$refreshBackendLog.on('click', () => this.load());\n    }\n\n    scrollToBottom() {\n        this.$backendLogTextArea.scrollTop(this.$backendLogTextArea[0].scrollHeight);\n    }\n\n    async refresh() {\n        await this.load();\n    }\n\n    async load() {\n        const backendLog = await server.get('backend-log');\n\n        this.$backendLogTextArea.text(backendLog);\n\n        this.scrollToBottom();\n    }\n}\n","import TypeWidget from \"./type_widget.js\";\nimport ZoomFactorOptions from \"./options/appearance/zoom_factor.js\";\nimport NativeTitleBarOptions from \"./options/appearance/native_title_bar.js\";\nimport ThemeOptions from \"./options/appearance/theme.js\";\nimport FontsOptions from \"./options/appearance/fonts.js\";\nimport MaxContentWidthOptions from \"./options/appearance/max_content_width.js\";\nimport KeyboardShortcutsOptions from \"./options/shortcuts.js\";\nimport HeadingStyleOptions from \"./options/text_notes/heading_style.js\";\nimport TableOfContentsOptions from \"./options/text_notes/table_of_contents.js\";\nimport HighlightsListOptions from \"./options/text_notes/highlights_list.js\";\nimport TextAutoReadOnlySizeOptions from \"./options/text_notes/text_auto_read_only_size.js\";\nimport VimKeyBindingsOptions from \"./options/code_notes/vim_key_bindings.js\";\nimport WrapLinesOptions from \"./options/code_notes/wrap_lines.js\";\nimport CodeAutoReadOnlySizeOptions from \"./options/code_notes/code_auto_read_only_size.js\";\nimport CodeMimeTypesOptions from \"./options/code_notes/code_mime_types.js\";\nimport ImageOptions from \"./options/images/images.js\";\nimport SpellcheckOptions from \"./options/spellcheck.js\";\nimport PasswordOptions from \"./options/password.js\";\nimport EtapiOptions from \"./options/etapi.js\";\nimport BackupOptions from \"./options/backup.js\";\nimport SyncOptions from \"./options/sync.js\";\nimport SearchEngineOptions from \"./options/other/search_engine.js\";\nimport TrayOptions from \"./options/other/tray.js\";\nimport NoteErasureTimeoutOptions from \"./options/other/note_erasure_timeout.js\";\nimport RevisionsSnapshotIntervalOptions from \"./options/other/revisions_snapshot_interval.js\";\nimport NetworkConnectionsOptions from \"./options/other/network_connections.js\";\nimport AdvancedSyncOptions from \"./options/advanced/sync.js\";\nimport DatabaseIntegrityCheckOptions from \"./options/advanced/database_integrity_check.js\";\nimport ConsistencyChecksOptions from \"./options/advanced/consistency_checks.js\";\nimport VacuumDatabaseOptions from \"./options/advanced/vacuum_database.js\";\nimport DatabaseAnonymizationOptions from \"./options/advanced/database_anonymization.js\";\nimport BackendLogWidget from \"./content/backend_log.js\";\nimport AttachmentErasureTimeoutOptions from \"./options/other/attachment_erasure_timeout.js\";\nimport RibbonOptions from \"./options/appearance/ribbon.js\";\n\nconst TPL = `<div class=\"note-detail-content-widget note-detail-printable\">\n    <style>\n        .type-contentWidget .note-detail {\n            height: 100%;\n        }\n        \n        .note-detail-content-widget {\n            height: 100%;\n        }\n    \n        .note-detail-content-widget-content {\n            padding: 15px;\n            height: 100%;\n        }\n    </style>\n\n    <div class=\"note-detail-content-widget-content\"></div>\n</div>`;\n\nconst CONTENT_WIDGETS = {\n    _optionsAppearance: [\n        ThemeOptions,\n        FontsOptions,\n        ZoomFactorOptions,\n        NativeTitleBarOptions,\n        MaxContentWidthOptions,\n        RibbonOptions\n    ],\n    _optionsShortcuts: [ KeyboardShortcutsOptions ],\n    _optionsTextNotes: [\n        HeadingStyleOptions,\n        TableOfContentsOptions,\n        HighlightsListOptions,\n        TextAutoReadOnlySizeOptions\n    ],\n    _optionsCodeNotes: [\n        VimKeyBindingsOptions,\n        WrapLinesOptions,\n        CodeAutoReadOnlySizeOptions,\n        CodeMimeTypesOptions\n    ],\n    _optionsImages: [ ImageOptions ],\n    _optionsSpellcheck: [ SpellcheckOptions ],\n    _optionsPassword: [ PasswordOptions ],\n    _optionsEtapi: [ EtapiOptions ],\n    _optionsBackup: [ BackupOptions ],\n    _optionsSync: [ SyncOptions ],\n    _optionsOther: [\n        SearchEngineOptions,\n        TrayOptions,\n        NoteErasureTimeoutOptions,\n        AttachmentErasureTimeoutOptions,\n        RevisionsSnapshotIntervalOptions,\n        NetworkConnectionsOptions\n    ],\n    _optionsAdvanced: [\n        DatabaseIntegrityCheckOptions,\n        ConsistencyChecksOptions,\n        DatabaseAnonymizationOptions,\n        AdvancedSyncOptions,\n        VacuumDatabaseOptions\n    ],\n    _backendLog: [ BackendLogWidget ]\n};\n\nexport default class ContentWidgetTypeWidget extends TypeWidget {\n    static getType() { return \"contentWidget\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$content = this.$widget.find(\".note-detail-content-widget-content\");\n\n        super.doRender();\n    }\n\n    async doRefresh(note) {\n        this.$content.empty();\n        this.children = [];\n\n        const contentWidgets = CONTENT_WIDGETS[note.noteId];\n\n        if (contentWidgets) {\n            for (const clazz of contentWidgets) {\n                const widget = new clazz();\n\n                await widget.handleEvent('setNoteContext', { noteContext: this.noteContext });\n                this.child(widget);\n\n                this.$content.append(widget.render());\n                await widget.refresh();\n            }\n        } else {\n            this.$content.append(`Unknown widget for \"${note.noteId}\"`);\n        }\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\nimport server from \"../../../../services/server.js\";\nimport utils from \"../../../../services/utils.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>主题</h4>\n    \n    <div class=\"form-group row\">\n        <div class=\"col-6\">\n            <label>主题</label>\n            <select class=\"theme-select form-control\"></select>\n        </div>\n        \n        <div class=\"col-6\">\n            <label>覆盖主题字体</label>\n            <input type=\"checkbox\" class=\"override-theme-fonts form-control\">\n        </div>\n    </div>\n</div>`;\n\nexport default class ThemeOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$themeSelect = this.$widget.find(\".theme-select\");\n        this.$overrideThemeFonts = this.$widget.find(\".override-theme-fonts\");\n\n        this.$themeSelect.on('change', async () => {\n            const newTheme = this.$themeSelect.val();\n\n            await server.put(`options/theme/${newTheme}`);\n\n            utils.reloadFrontendApp(\"theme change\");\n        });\n\n        this.$overrideThemeFonts.on('change', () => this.updateCheckboxOption('overrideThemeFonts', this.$overrideThemeFonts));\n    }\n\n    async optionsLoaded(options) {\n        const themes = [\n            { val: 'light', title: '明亮' },\n            { val: 'dark', title: '深色' }\n        ].concat(await server.get('options/user-themes'));\n\n        this.$themeSelect.empty();\n\n        for (const theme of themes) {\n            this.$themeSelect.append($(\"<option>\")\n                .attr(\"value\", theme.val)\n                .attr(\"data-note-id\", theme.noteId)\n                .text(theme.title));\n        }\n\n        this.$themeSelect.val(options.theme);\n\n        this.setCheckboxState(this.$overrideThemeFonts, options.overrideThemeFonts);\n    }\n}\n","import appContext from \"../../../../components/app_context.js\";\nimport OptionsWidget from \"../options_widget.js\";\nimport utils from \"../../../../services/utils.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>缩放系数(仅桌面客户端有效)</h4>\n\n    <input type=\"number\" class=\"zoom-factor-select form-control options-number-input\" min=\"0.3\" max=\"2.0\" step=\"0.1\"/>\n    <p>缩放可以通过 ctrl+- 和 ctrl+= 来控制.</p>\n</div>`;\n\nexport default class ZoomFactorOptions extends OptionsWidget {\n    isEnabled() {\n        return super.isEnabled() && utils.isElectron();\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$zoomFactorSelect = this.$widget.find(\".zoom-factor-select\");\n        this.$zoomFactorSelect.on('change', () => { appContext.triggerCommand('setZoomFactorAndSave', {zoomFactor: this.$zoomFactorSelect.val()}); });\n    }\n\n    async optionsLoaded(options) {\n        this.$zoomFactorSelect.val(options.zoomFactor);\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>原生标题栏(需要重启)</h4>\n    \n    <select class=\"native-title-bar-select form-control\">\n        <option value=\"show\">启用</option>\n        <option value=\"hide\">禁用</option>\n    </select>\n</div>`;\n\nexport default class NativeTitleBarOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$nativeTitleBarSelect = this.$widget.find(\".native-title-bar-select\");\n        this.$nativeTitleBarSelect.on('change', () => {\n            const nativeTitleBarVisible = this.$nativeTitleBarSelect.val() === 'show' ? 'true' : 'false';\n\n            this.updateOption('nativeTitleBarVisible', nativeTitleBarVisible);\n        });\n    }\n\n    async optionsLoaded(options) {\n        this.$nativeTitleBarSelect.val(options.nativeTitleBarVisible === 'true' ? 'show' : 'hide');\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\nimport utils from \"../../../../services/utils.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>内容宽度</h4>\n    \n    <p>Trilium默认会限制内容的最大宽度以提高在宽屏中全屏时的可读性.</p>\n    \n    <div class=\"form-group row\">\n        <div class=\"col-4\">\n            <label>内容最大宽度(像素)</label>\n            <input type=\"number\" min=\"200\" step=\"10\" class=\"max-content-width form-control options-number-input\">\n        </div>\n    </div>\n    \n    <p>\n        应用内容宽度修改, 请点击 \n        <button class=\"btn btn-micro reload-frontend-button\">重新加载前端</button>\n    </p>\n</div>`;\n\nexport default class MaxContentWidthOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$maxContentWidth = this.$widget.find(\".max-content-width\");\n\n        this.$maxContentWidth.on('change', async () =>\n            this.updateOption('maxContentWidth', this.$maxContentWidth.val()))\n\n        this.$widget.find(\".reload-frontend-button\").on(\"click\", () => utils.reloadFrontendApp(\"changes from appearance options\"));\n    }\n\n    async optionsLoaded(options) {\n        this.$maxContentWidth.val(options.maxContentWidth);\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>功能选项组件</h4>\n    <label>\n        <input type=\"checkbox\" class=\"promoted-attributes-open-in-ribbon\">\n        如果笔记中存在升级属性，升级属性功能选项卡将自动打开\n    </label>\n    \n    <label>\n        <input type=\"checkbox\" class=\"edited-notes-open-in-ribbon\">\n        日记笔记自动打开编辑过的笔记选项\n    </label>\n</div>`;\n\nexport default class RibbonOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$promotedAttributesOpenInRibbon = this.$widget.find(\".promoted-attributes-open-in-ribbon\");\n        this.$promotedAttributesOpenInRibbon.on('change', () =>\n            this.updateCheckboxOption('promotedAttributesOpenInRibbon', this.$promotedAttributesOpenInRibbon));\n\n        this.$editedNotesOpenInRibbon = this.$widget.find(\".edited-notes-open-in-ribbon\");\n        this.$editedNotesOpenInRibbon.on('change', () =>\n            this.updateCheckboxOption('editedNotesOpenInRibbon', this.$editedNotesOpenInRibbon));\n    }\n\n    async optionsLoaded(options) {\n        this.setCheckboxState(this.$promotedAttributesOpenInRibbon, options.promotedAttributesOpenInRibbon);\n        this.setCheckboxState(this.$editedNotesOpenInRibbon, options.editedNotesOpenInRibbon);\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>标题风格</h4>\n    \n    <select class=\"heading-style form-control\">\n        <option value=\"plain\">纯文本</option>\n        <option value=\"underline\">下划线</option>\n        <option value=\"markdown\">Markdown风格</option>\n    </select>\n</div>`;\n\nexport default class HeadingStyleOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$body = $(\"body\");\n        this.$headingStyle = this.$widget.find(\".heading-style\");\n        this.$headingStyle.on('change', () => {\n            const newHeadingStyle = this.$headingStyle.val();\n\n            this.toggleBodyClass(\"heading-style-\", newHeadingStyle);\n\n            this.updateOption('headingStyle', newHeadingStyle);\n        });\n    }\n\n    async optionsLoaded(options) {\n        this.$headingStyle.val(options.headingStyle);\n    }\n\n    toggleBodyClass(prefix, value) {\n        for (const clazz of Array.from(this.$body[0].classList)) { // create copy to safely iterate over while removing classes\n            if (clazz.startsWith(prefix)) {\n                this.$body.removeClass(clazz);\n            }\n        }\n\n        this.$body.addClass(prefix + value);\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>目录</h4>\n    \n    当笔记具有超过定义数量的标题时, 目录将出现在文本笔记中. 你可以自定义这个数值:\n    \n    <div class=\"form-group\">\n        <input type=\"number\" class=\"min-toc-headings form-control options-number-input options-number-input\" min=\"0\" max=\"9999999999999999\" step=\"1\" />\n    </div>\n    \n    <p>您可以设置一个非常大的数来禁用目录.</p>\n</div>`;\n\nexport default class TableOfContentsOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$minTocHeadings = this.$widget.find(\".min-toc-headings\");\n        this.$minTocHeadings.on('change', () =>\n            this.updateOption('minTocHeadings', this.$minTocHeadings.val()));\n    }\n\n    async optionsLoaded(options) {\n        this.$minTocHeadings.val(options.minTocHeadings);\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>高亮列表</h4>\n\n    <p>您可以自定义在右侧面板显示的高亮列表:</p>\n\n    </div>\n        <label><input type=\"checkbox\" class=\"highlights-list-check\" value=\"bold\"> 粗体字 &nbsp;</label>\n        <label><input type=\"checkbox\" class=\"highlights-list-check\" value=\"italic\"> 斜体字 &nbsp;</label>\n        <label><input type=\"checkbox\" class=\"highlights-list-check\" value=\"underline\"> 下划线字体 &nbsp;</label>\n        <label><input type=\"checkbox\" class=\"highlights-list-check\" value=\"color\"> 彩色字体 &nbsp;</label>\n        <label><input type=\"checkbox\" class=\"highlights-list-check\" value=\"bgColor\"> 带有背景色的字体 &nbsp;</label>\n    </div>\n\n    <br/><br/>\n    <h5>Highlists List visibility</h5>\n\n    <p>您可以通过添加 <code>#hideHighlightWidget</code> 标签来在每个笔记中隐藏高亮小部件。</p>\n</div>`;\n\nexport default class HighlightsListOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$hlt = this.$widget.find(\"input.highlights-list-check\");\n        this.$hlt.on('change', () => {\n            const hltVals = this.$widget.find('input.highlights-list-check[type=\"checkbox\"]:checked').map(function () {\n                return this.value;\n            }).get();\n            this.updateOption('highlightsList', JSON.stringify(hltVals));\n        });\n    }\n\n    async optionsLoaded(options) {\n        const hltVals = JSON.parse(options.highlightsList);\n        this.$widget.find('input.highlights-list-check[type=\"checkbox\"]').each(function () {\n            if ($.inArray($(this).val(), hltVals) !== -1) {\n                $(this).prop(\"checked\", true);\n            } else {\n                $(this).prop(\"checked\", false);\n            }\n        });\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>自动只读大小</h4>\n\n    <p>自动只读大小是指笔记超过设置的大小后自动设置为只读模式(为性能考虑)</p>\n\n    <div class=\"form-group\">\n        <label>自动只读大小 (文字笔记)</label>\n        <input class=\"auto-readonly-size-text form-control options-number-input\" type=\"number\" min=\"0\">\n    </div>\n</div>`;\n\nexport default class TextAutoReadOnlySizeOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$autoReadonlySizeText = this.$widget.find(\".auto-readonly-size-text\");\n        this.$autoReadonlySizeText.on('change', () =>\n            this.updateOption('autoReadonlySizeText', this.$autoReadonlySizeText.val()));\n    }\n\n    async optionsLoaded(options) {\n        this.$autoReadonlySizeText.val(options.autoReadonlySizeText);\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>在代码笔记中使用vim按键绑定(无ex模式)</h4>\n    <label>\n        <input type=\"checkbox\" class=\"vim-keymap-enabled\">\n        启用vim按键绑定\n    </label>\n</div>`;\n\nexport default class VimKeyBindingsOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$vimKeymapEnabled = this.$widget.find(\".vim-keymap-enabled\");\n        this.$vimKeymapEnabled.on('change', () =>\n            this.updateCheckboxOption('vimKeymapEnabled', this.$vimKeymapEnabled));\n    }\n\n    async optionsLoaded(options) {\n        this.setCheckboxState(this.$vimKeymapEnabled, options.vimKeymapEnabled);\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>代码笔记自动换行</h4>\n    <label>\n        <input type=\"checkbox\" class=\"line-wrap-enabled\">\n        启用自动换行(需要重新加载前端才会生效)\n    </label>\n</div>`;\n\nexport default class WrapLinesOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$codeLineWrapEnabled = this.$widget.find(\".line-wrap-enabled\");\n        this.$codeLineWrapEnabled.on('change', () =>\n            this.updateCheckboxOption('codeLineWrapEnabled', this.$codeLineWrapEnabled));\n    }\n\n    async optionsLoaded(options) {\n        this.setCheckboxState(this.$codeLineWrapEnabled, options.codeLineWrapEnabled);\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>自动只读大小</h4>\n\n    <p>自动只读大小是指笔记超过设置的大小后自动设置为只读模式(为性能考虑)</p>\n\n    <div class=\"form-group\">\n        <label>自动只读大小 (代码笔记)</label>\n        <input class=\"auto-readonly-size-code form-control options-number-input\" type=\"number\" min=\"0\">\n    </div>\n</div>`;\n\nexport default class CodeAutoReadOnlySizeOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$autoReadonlySizeCode = this.$widget.find(\".auto-readonly-size-code\");\n        this.$autoReadonlySizeCode.on('change', () =>\n            this.updateOption('autoReadonlySizeCode', this.$autoReadonlySizeCode.val()));\n    }\n\n    async optionsLoaded(options) {\n        this.$autoReadonlySizeCode.val(options.autoReadonlySizeCode);\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <style>\n        .options-section .disabled-field {\n            opacity: 0.5;\n            pointer-events: none;\n        }\n    </style>\n\n    <h4>图片</h4>\n    \n    <label>\n        <input class=\"download-images-automatically\" type=\"checkbox\" name=\"download-images-automatically\">\n        自动下载图片以便于离线使用.\n    </label>\n    \n    <p>(粘贴的HTML可能包含在线图片的引用, Trilium会找到并下载这些图片用于离线使用)</p>\n    \n    <label>\n        <input class=\"image-compresion-enabled\" type=\"checkbox\" name=\"image-compression-enabled\">\n        启用图像压缩\n    </label>\n\n    <div class=\"image-compression-enabled-wraper\">\n        <div class=\"form-group\">\n            <label>图片的最大像素宽度和高度(超过限制会缩放).</label>\n            <input class=\"image-max-width-height form-control options-number-input\" type=\"number\" min=\"1\">\n        </div>\n    \n        <div class=\"form-group\">\n            <label>JPEG质量 (10最低, 100最好, 推荐设置为50-85之间)</label>\n            <input class=\"image-jpeg-quality form-control options-number-input\" min=\"10\" max=\"100\" type=\"number\">\n        </div>\n    </div>\n</div>\n`;\n\nexport default class ImageOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$imageMaxWidthHeight = this.$widget.find(\".image-max-width-height\");\n        this.$imageJpegQuality = this.$widget.find(\".image-jpeg-quality\");\n\n        this.$imageMaxWidthHeight.on('change', () =>\n            this.updateOption('imageMaxWidthHeight', this.$imageMaxWidthHeight.val()));\n\n        this.$imageJpegQuality.on('change', () =>\n            this.updateOption('imageJpegQuality', this.$imageJpegQuality.val().trim() || \"75\"));\n\n        this.$downloadImagesAutomatically = this.$widget.find(\".download-images-automatically\");\n\n        this.$downloadImagesAutomatically.on(\"change\", () =>\n            this.updateCheckboxOption('downloadImagesAutomatically', this.$downloadImagesAutomatically));\n\n        this.$enableImageCompression = this.$widget.find(\".image-compresion-enabled\");\n        this.$imageCompressionWrapper = this.$widget.find(\".image-compression-enabled-wraper\");\n\n        this.$enableImageCompression.on(\"change\", () => {\n            this.updateCheckboxOption('compressImages', this.$enableImageCompression);\n            this.setImageCompression();\n        });\n    }\n\n    optionsLoaded(options) {\n        this.$imageMaxWidthHeight.val(options.imageMaxWidthHeight);\n        this.$imageJpegQuality.val(options.imageJpegQuality);\n\n        this.setCheckboxState(this.$downloadImagesAutomatically, options.downloadImagesAutomatically);\n        this.setCheckboxState(this.$enableImageCompression, options.compressImages);\n\n        this.setImageCompression();\n    }\n\n    setImageCompression() {\n        if (this.$enableImageCompression.prop(\"checked\")) {\n            this.$imageCompressionWrapper.removeClass(\"disabled-field\");\n        } else {\n            this.$imageCompressionWrapper.addClass(\"disabled-field\");\n        }\n    }\n}\n","import utils from \"../../../services/utils.js\";\nimport OptionsWidget from \"./options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>拼写检查</h4>\n\n    <p>这些选项只在桌面客户端有效, 浏览器会使用浏览器的拼写检查. 修改设置后需要重启应用.</p>\n\n    <label>\n        <input type=\"checkbox\" class=\"spell-check-enabled\">\n        开启拼写检查\n    </label>\n\n    <br/>\n\n    <div class=\"form-group\">\n        <label>语言码</label>\n        <input type=\"text\" class=\"spell-check-language-code form-control\" placeholder=\"for example &quot;en-US&quot;, &quot;de-AT&quot;\">\n    </div>\n\n    <p>多个语言可以用逗号分隔, 例如: <code>en-US, de-DE, cs</code>. 拼写检查选项的修改将在应用程序重新启动后生效.</p>\n    \n    <p><strong>可用的语言代码</strong> <span class=\"available-language-codes\"></span></p>\n</div>`;\n\nexport default class SpellcheckOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$spellCheckEnabled = this.$widget.find(\".spell-check-enabled\");\n        this.$spellCheckLanguageCode = this.$widget.find(\".spell-check-language-code\");\n\n        this.$spellCheckEnabled.on('change', () =>\n            this.updateCheckboxOption('spellCheckEnabled', this.$spellCheckEnabled));\n\n        this.$spellCheckLanguageCode.on('change', () =>\n            this.updateOption('spellCheckLanguageCode', this.$spellCheckLanguageCode.val()));\n\n        this.$availableLanguageCodes = this.$widget.find(\".available-language-codes\");\n\n        if (utils.isElectron()) {\n            const { webContents } = utils.dynamicRequire('@electron/remote').getCurrentWindow();\n\n            this.$availableLanguageCodes.text(webContents.session.availableSpellCheckerLanguages.join(', '));\n        }\n    }\n\n    optionsLoaded(options) {\n        this.setCheckboxState(this.$spellCheckEnabled, options.spellCheckEnabled);\n        this.$spellCheckLanguageCode.val(options.spellCheckLanguageCode);\n    }\n}\n","import server from \"../../../services/server.js\";\nimport protectedSessionHolder from \"../../../services/protected_session_holder.js\";\nimport toastService from \"../../../services/toast.js\";\nimport OptionsWidget from \"./options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4 class=\"password-heading\"></h4>\n    \n    <div class=\"alert alert-warning\" role=\"alert\" style=\"font-weight: bold; color: red !important;\">\n      请一定要记住你的新密码. 密码被用来登录和加密笔记. 如果你忘记了密码, 所有受保护的笔记将永远丢失. \n      如果你忘记了密码, <a class=\"reset-password-button\" href=\"javascript:\">点击这里来重置它</a>.\n    </div>\n    \n    <form class=\"change-password-form\">\n        <div class=\"old-password-form-group form-group\">\n            <label>旧密码</label>\n            <input class=\"old-password form-control\" type=\"password\">\n        </div>\n    \n        <div class=\"form-group\">\n            <label>新密码</label>\n            <input class=\"new-password1 form-control\" type=\"password\">\n        </div>\n    \n        <div class=\"form-group\">\n            <label>新密码确认</label>\n            <input class=\"new-password2 form-control\" type=\"password\">\n        </div>\n    \n        <button class=\"save-password-button btn btn-primary\">修改密码</button>\n    </form>\n</div>\n\n<div class=\"options-section\">\n    <h4>保护会话超时</h4>\n\n    <p>保护会话超时是从浏览器内存里清理保护会话的间隔, 这个时间从最后一次编辑保护的笔记开始计算. 详见 <a href=\"https://github.com/zadam/trilium/wiki/Protected-notes\" class=\"external\">wiki</a> 以获取更多信息</p>\n\n    <div class=\"form-group\">\n        <label>保护会话超时(单位:秒)</label>\n        <input class=\"protected-session-timeout-in-seconds form-control options-number-input\" type=\"number\" min=\"60\">\n    </div>\n</div>`;\n\nexport default class PasswordOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$passwordHeading = this.$widget.find(\".password-heading\");\n        this.$changePasswordForm = this.$widget.find(\".change-password-form\");\n        this.$oldPassword = this.$widget.find(\".old-password\");\n        this.$newPassword1 = this.$widget.find(\".new-password1\");\n        this.$newPassword2 = this.$widget.find(\".new-password2\");\n        this.$savePasswordButton = this.$widget.find(\".save-password-button\");\n        this.$resetPasswordButton = this.$widget.find(\".reset-password-button\");\n\n        this.$resetPasswordButton.on(\"click\", async () => {\n            if (confirm(\"重置密码会永远丢失所有受保护的笔记. 确定要重置密码吗?\")) {\n                await server.post(\"password/reset?really=yesIReallyWantToResetPasswordAndLoseAccessToMyProtectedNotes\");\n\n                const options = await server.get('options');\n                this.optionsLoaded(options);\n\n                toastService.showError(\"Password has been reset. Please set new password\");\n            }\n        });\n\n        this.$changePasswordForm.on('submit', () => this.save());\n\n        this.$protectedSessionTimeout = this.$widget.find(\".protected-session-timeout-in-seconds\");\n        this.$protectedSessionTimeout.on('change', () =>\n            this.updateOption('protectedSessionTimeout', this.$protectedSessionTimeout.val()));\n    }\n\n    optionsLoaded(options) {\n        const isPasswordSet = options.isPasswordSet === 'true';\n\n        this.$widget.find(\".old-password-form-group\").toggle(isPasswordSet);\n        this.$passwordHeading.text(isPasswordSet ? '修改密码' : '设置密码');\n        this.$savePasswordButton.text(isPasswordSet ? '修改密码' : '设置密码');\n        this.$protectedSessionTimeout.val(options.protectedSessionTimeout);\n    }\n\n    save() {\n        const oldPassword = this.$oldPassword.val();\n        const newPassword1 = this.$newPassword1.val();\n        const newPassword2 = this.$newPassword2.val();\n\n        this.$oldPassword.val('');\n        this.$newPassword1.val('');\n        this.$newPassword2.val('');\n\n        if (newPassword1 !== newPassword2) {\n            toastService.showError(\"New passwords are not the same.\");\n            return false;\n        }\n\n        server.post('password/change', {\n            'current_password': oldPassword,\n            'new_password': newPassword1\n        }).then(result => {\n            if (result.success) {\n                toastService.showError(\"Password has been changed. Trilium will be reloaded after you press OK.\");\n\n                // password changed so current protected session is invalid and needs to be cleared\n                protectedSessionHolder.resetProtectedSession();\n            }\n            else {\n                toastService.showError(result.message);\n            }\n        });\n\n        return false;\n    }\n}\n","import server from \"../../../services/server.js\";\nimport dialogService from \"../../../services/dialog.js\";\nimport toastService from \"../../../services/toast.js\";\nimport OptionsWidget from \"./options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>ETAPI</h4>\n    \n    <p>ETAPI 是一个 REST API, 用于以编程方式访问 Trilium 实例, 无需 UI. <br/>\n       更多信息请访问 <a href=\"https://github.com/zadam/trilium/wiki/ETAPI\">wiki</a> 和 <a onclick=\"window.open('etapi/etapi.openapi.yaml')\" href=\"etapi/etapi.openapi.yaml\">ETAPI OpenAPI 文档</a>.</p>\n    \n    <button type=\"button\" class=\"create-etapi-token btn btn-sm\">创建新的 ETAPI 令牌</button>\n\n    <h5>已有令牌</h5>\n    \n    <div class=\"no-tokens-yet\">暂无令牌. 点击上方按钮来创建令牌.</div>\n    \n    <div style=\"overflow: auto; height: 500px;\">\n        <table class=\"tokens-table table table-stripped\">\n        <thead>\n            <tr>\n                <th>令牌名称</th>\n                <th>创建</th>\n                <th>动作</th>\n            </tr>\n        </thead>\n        <tbody></tbody>\n        </table>\n    </div>\n</div>\n\n<style>\n    .token-table-button {\n        display: inline-block;\n        cursor: pointer;\n        padding: 3px;\n        margin-right: 20px;\n        font-size: large;\n        border: 1px solid transparent;\n        border-radius: var(--button-border-radius);\n    }\n    \n    .token-table-button:hover {\n        border: 1px solid var(--button-border-color);\n    }\n</style>`;\n\nexport default class EtapiOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$widget.find(\".create-etapi-token\").on(\"click\", async () => {\n            const tokenName = await dialogService.prompt({\n                title: \"新的 ETAPI 令牌\",\n                message: \"请输入新令牌的名称\",\n                defaultValue: \"新令牌\"\n            });\n\n            if (!tokenName.trim()) {\n                toastService.showError(\"令牌名称不能为空\");\n                return;\n            }\n\n            const {authToken} = await server.post('etapi-tokens', {tokenName});\n\n            await dialogService.prompt({\n                title: \"ETAPI 令牌已创建\",\n                message: '复制新令牌到剪贴板. Trilium会保存令牌的哈希值, 请注意这将是你最后一次看到这个令牌.',\n                defaultValue: authToken\n            });\n\n            this.refreshTokens();\n        });\n\n        this.refreshTokens();\n    }\n\n    async refreshTokens() {\n        const $noTokensYet = this.$widget.find(\".no-tokens-yet\");\n        const $tokensTable = this.$widget.find(\".tokens-table\");\n\n        const tokens = await server.get('etapi-tokens');\n\n        $noTokensYet.toggle(tokens.length === 0);\n        $tokensTable.toggle(tokens.length > 0);\n\n        const $tokensTableBody = $tokensTable.find(\"tbody\");\n        $tokensTableBody.empty();\n\n        for (const token of tokens) {\n            $tokensTableBody.append(\n                $(\"<tr>\")\n                    .append($(\"<td>\").text(token.name))\n                    .append($(\"<td>\").text(token.utcDateCreated))\n                    .append($(\"<td>\").append(\n                        $('<span class=\"bx bx-pen token-table-button\" title=\"重命名此令牌\"></span>')\n                            .on(\"click\", () => this.renameToken(token.etapiTokenId, token.name)),\n                        $('<span class=\"bx bx-trash token-table-button\" title=\"删除/停用此令牌\"></span>')\n                            .on(\"click\", () => this.deleteToken(token.etapiTokenId, token.name))\n                    ))\n            );\n        }\n    }\n\n    async renameToken(etapiTokenId, oldName) {\n        const tokenName = await dialogService.prompt({\n            title: \"重命名令牌\",\n            message: \"请输入新令牌的名称\",\n            defaultValue: oldName\n        });\n\n        if (!tokenName?.trim()) {\n            return;\n        }\n\n        await server.patch(`etapi-tokens/${etapiTokenId}`, {name: tokenName});\n\n        this.refreshTokens();\n    }\n\n    async deleteToken(etapiTokenId, name) {\n        if (!await dialogService.confirm(`你确认要删除ETAPI令牌 \"${name}\"?`)) {\n            return;\n        }\n\n        await server.remove(`etapi-tokens/${etapiTokenId}`);\n\n        this.refreshTokens();\n    }\n}\n","import server from \"../../../services/server.js\";\nimport toastService from \"../../../services/toast.js\";\nimport OptionsWidget from \"./options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>自动备份</h4>\n    \n    <p>Trilium 可以自动备份数据库:</p>\n    \n    <ul style=\"list-style: none\">\n        <li>\n            <label>\n                <input type=\"checkbox\" class=\"daily-backup-enabled\">\n                启用每日备份\n            </label>\n        </li>\n        <li>    \n            <label>\n                <input type=\"checkbox\" class=\"weekly-backup-enabled\">\n                启用每周备份\n            </label>\n        </li>\n        <li>\n        <label>\n            <input type=\"checkbox\" class=\"monthly-backup-enabled\">\n            启用每月备份\n            </label>\n        </li>\n    </ul>\n    \n    <p>建议打开备份功能, 但这可能会使大型数据库和/或慢速存储设备的应用程序启动变慢.</p>\n</div>\n\n<div class=\"options-section\">\n    <h4>立即备份</h4>\n    \n    <button class=\"backup-database-button btn\">立即备份数据库</button>\n</div>\n\n<div class=\"options-section\">\n    <h4>已有备份</h4>\n    \n    <ul class=\"existing-backup-list\"></ul>\n</div>\n`;\n\nexport default class BackupOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$backupDatabaseButton = this.$widget.find(\".backup-database-button\");\n\n        this.$backupDatabaseButton.on('click', async () => {\n            const {backupFile} = await server.post('database/backup-database');\n\n            toastService.showMessage(`数据库已备份至${backupFile}`, 10000);\n\n            this.refresh();\n        });\n\n        this.$dailyBackupEnabled = this.$widget.find(\".daily-backup-enabled\");\n        this.$weeklyBackupEnabled = this.$widget.find(\".weekly-backup-enabled\");\n        this.$monthlyBackupEnabled = this.$widget.find(\".monthly-backup-enabled\");\n\n        this.$dailyBackupEnabled.on('change', () =>\n            this.updateCheckboxOption('dailyBackupEnabled', this.$dailyBackupEnabled));\n\n        this.$weeklyBackupEnabled.on('change', () =>\n            this.updateCheckboxOption('weeklyBackupEnabled', this.$weeklyBackupEnabled));\n\n        this.$monthlyBackupEnabled.on('change', () =>\n            this.updateCheckboxOption('monthlyBackupEnabled', this.$monthlyBackupEnabled));\n\n        this.$existingBackupList = this.$widget.find(\".existing-backup-list\");\n    }\n\n    optionsLoaded(options) {\n        this.setCheckboxState(this.$dailyBackupEnabled, options.dailyBackupEnabled);\n        this.setCheckboxState(this.$weeklyBackupEnabled, options.weeklyBackupEnabled);\n        this.setCheckboxState(this.$monthlyBackupEnabled, options.monthlyBackupEnabled);\n\n        server.get(\"database/backups\").then(backupFiles => {\n            this.$existingBackupList.empty();\n\n            if (!backupFiles.length) {\n                backupFiles = [{filePath: \"还没有备份\", mtime: ''}];\n            }\n\n            for (const {filePath, mtime} of backupFiles) {\n                this.$existingBackupList.append($(\"<li>\").text(`${filePath} ${mtime ? ` - ${mtime}` : ''}`));\n            }\n        });\n    }\n}\n","import server from \"../../../services/server.js\";\nimport toastService from \"../../../services/toast.js\";\nimport OptionsWidget from \"./options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4 style=\"margin-top: 0px;\">同步设置</h4>\n    \n    <form class=\"sync-setup-form\">\n        <div class=\"form-group\">\n            <label>服务器地址</label>\n            <input class=\"sync-server-host form-control\" placeholder=\"https://<host>:<port>\">\n        </div>\n    \n        <div class=\"form-group\">\n            <label>同步超时(单位:毫秒)</label>\n            <input class=\"sync-server-timeout form-control\" min=\"1\" max=\"10000000\" type=\"number\" style=\"text-align: left;\">\n        </div>\n    \n        <div class=\"form-group\">\n            <label>同步代理服务器(可选)</label>\n            <input class=\"sync-proxy form-control\" placeholder=\"https://<host>:<port>\">\n    \n            <p><strong>备注:</strong> 代理设置留空则使用系统代理(仅桌面客户端有效).</p>\n            <p>另一个特殊值是<code>noproxy</code>，它会强制忽略代理，即使是系统代理也会忽略，并且会遵从<code>NODE_TLS_REJECT_UNAUTHORIZED</code>.</p>\n        </div>\n    \n        <div style=\"display: flex; justify-content: space-between;\">\n            <button class=\"btn btn-primary\">保存</button>\n    \n            <button class=\"btn\" type=\"button\" data-help-page=\"Synchronization\">帮助</button>\n        </div>\n    </form>\n</div>\n\n<div class=\"options-section\">\n    <h4>同步测试</h4>\n    \n    <p>测试和同步服务器之间的连接. 如果同步服务器没有初始化, 会将本地文档同步到同步服务器上.</p>\n    \n    <button class=\"test-sync-button btn\">测试同步</button>\n</div>`;\n\nexport default class SyncOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$form = this.$widget.find(\".sync-setup-form\");\n        this.$syncServerHost = this.$widget.find(\".sync-server-host\");\n        this.$syncServerTimeout = this.$widget.find(\".sync-server-timeout\");\n        this.$syncProxy = this.$widget.find(\".sync-proxy\");\n        this.$testSyncButton = this.$widget.find(\".test-sync-button\");\n\n        this.$form.on('submit', () => this.save());\n\n        this.$testSyncButton.on('click', async () => {\n            const result = await server.post('sync/test');\n\n            if (result.success) {\n                toastService.showMessage(result.message);\n            }\n            else {\n                toastService.showError(`Sync server handshake failed, error: ${result.message}`);\n            }\n        });\n    }\n\n    optionsLoaded(options) {\n        this.$syncServerHost.val(options.syncServerHost);\n        this.$syncServerTimeout.val(options.syncServerTimeout);\n        this.$syncProxy.val(options.syncProxy);\n    }\n\n    save() {\n        this.updateMultipleOptions({\n            'syncServerHost': this.$syncServerHost.val(),\n            'syncServerTimeout': this.$syncServerTimeout.val(),\n            'syncProxy': this.$syncProxy.val()\n        });\n\n        return false;\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>托盘</h4>\n\n    <label>\n        <input type=\"checkbox\" class=\"tray-enabled\">\n        启用托盘图标(修改需要重启生效)\n    </label>\n</div>`;\n\nexport default class TrayOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$trayEnabled = this.$widget.find(\".tray-enabled\");\n        this.$trayEnabled.on('change', () =>\n            this.updateOption('disableTray', !this.$trayEnabled.is(\":checked\") ? \"true\" : \"false\"));\n    }\n\n    async optionsLoaded(options) {\n        this.$trayEnabled.prop(\"checked\", options.disableTray !== 'true');\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\nimport server from \"../../../../services/server.js\";\nimport toastService from \"../../../../services/toast.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>笔记清理超时</h4>\n\n    <p>被删除的笔记(属性, 修改版本等)只是被标记为\"删除\", 是可以从\"最近笔记\"还原的. 过了一段时间这些笔记会被\"清理\", 被清理的笔记就无法还原了. 这个设置可以用来调整从\"删除\"到被\"清理\"的时间间隔</p>\n\n    <div class=\"form-group\">\n        <label>超过X秒后清理笔记</label>\n        <input class=\"erase-entities-after-time-in-seconds form-control options-number-input\" type=\"number\" min=\"0\">\n    </div>\n    \n    <p>您也可以手动触发清理（而不考虑上述定义的超时时间）:</p>\n    \n    <button class=\"erase-deleted-notes-now-button btn\">清理已删除的笔记</button>\n</div>`;\n\nexport default class NoteErasureTimeoutOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$eraseEntitiesAfterTimeInSeconds = this.$widget.find(\".erase-entities-after-time-in-seconds\");\n        this.$eraseEntitiesAfterTimeInSeconds.on('change', () => this.updateOption('eraseEntitiesAfterTimeInSeconds', this.$eraseEntitiesAfterTimeInSeconds.val()));\n\n        this.$eraseDeletedNotesButton = this.$widget.find(\".erase-deleted-notes-now-button\");\n        this.$eraseDeletedNotesButton.on('click', () => {\n            server.post('notes/erase-deleted-notes-now').then(() => {\n                toastService.showMessage(\"删除的笔记已被清理.\");\n            });\n        });\n    }\n\n    async optionsLoaded(options) {\n        this.$eraseEntitiesAfterTimeInSeconds.val(options.eraseEntitiesAfterTimeInSeconds);\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\nimport server from \"../../../../services/server.js\";\nimport toastService from \"../../../../services/toast.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>附件清理超时</h4>\n\n    <p>如果附件在一段时间后不再被笔记引用，它们将自动被删除(并被清理)。</p>\n\n    <div class=\"form-group\">\n        <label>在附件在笔记中未被使用 X 秒后清理附件</label>\n        <input class=\"erase-unused-attachments-after-time-in-seconds form-control options-number-input\" type=\"number\" min=\"0\">\n    </div>\n    \n    <p>您也可以手动触发清理（而不考虑上述定义的超时时间）:</p>\n    \n    <button class=\"erase-unused-attachments-now-button btn\">立即清理未使用的附件</button>\n</div>`;\n\nexport default class AttachmentErasureTimeoutOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$eraseUnusedAttachmentsAfterTimeInSeconds = this.$widget.find(\".erase-unused-attachments-after-time-in-seconds\");\n        this.$eraseUnusedAttachmentsAfterTimeInSeconds.on('change', () => this.updateOption('eraseUnusedAttachmentsAfterSeconds', this.$eraseUnusedAttachmentsAfterTimeInSeconds.val()));\n\n        this.$eraseUnusedAttachmentsNowButton = this.$widget.find(\".erase-unused-attachments-now-button\");\n        this.$eraseUnusedAttachmentsNowButton.on('click', () => {\n            server.post('notes/erase-unused-attachments-now').then(() => {\n                toastService.showMessage(\"未使用的附件已被删除.\");\n            });\n        });\n    }\n\n    async optionsLoaded(options) {\n        this.$eraseUnusedAttachmentsAfterTimeInSeconds.val(options.eraseUnusedAttachmentsAfterSeconds);\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>笔记修改快照间隔</h4>\n\n    <p>这个是笔记修改后创建快照的时间. 详见:<a href=\"https://github.com/zadam/trilium/wiki/Note-revisions\" class=\"external\">wiki</a> 以获取更多信息</p>\n\n    <div class=\"form-group\">\n        <label>笔记修改快照间隔(单位:秒)</label>\n        <input class=\"revision-snapshot-time-interval-in-seconds form-control options-number-input\" type=\"number\" min=\"10\">\n    </div>\n</div>`;\n\nexport default class RevisionsSnapshotIntervalOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$revisionsTimeInterval = this.$widget.find(\".revision-snapshot-time-interval-in-seconds\");\n        this.$revisionsTimeInterval.on('change', () =>\n            this.updateOption('revisionSnapshotTimeInterval', this.$revisionsTimeInterval.val()));\n    }\n\n    async optionsLoaded(options) {\n        this.$revisionsTimeInterval.val(options.revisionSnapshotTimeInterval);\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>网络连接</h4>\n        \n    <label>\n        <input class=\"check-for-updates\" type=\"checkbox\" name=\"check-for-updates\">\n        自动检查更新\n    </label>\n</div>`;\n\nexport default class NetworkConnectionsOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$checkForUpdates = this.$widget.find(\".check-for-updates\");\n        this.$checkForUpdates.on(\"change\", () =>\n            this.updateCheckboxOption('checkForUpdates', this.$checkForUpdates));\n    }\n\n    async optionsLoaded(options) {\n        this.setCheckboxState(this.$checkForUpdates, options.checkForUpdates);\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\nimport toastService from \"../../../../services/toast.js\";\nimport server from \"../../../../services/server.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>数据库完整性检查</h4>\n    \n    <p>检查SQLite数据库是否损坏. 根据数据库大小, 可能会需要一些时间.</p>\n    \n    <button class=\"check-integrity-button btn\">检查数据库完整性</button>\n</div>`;\n\nexport default class DatabaseIntegrityCheckOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$checkIntegrityButton = this.$widget.find(\".check-integrity-button\");\n        this.$checkIntegrityButton.on('click', async () => {\n            toastService.showMessage(\"正在检查数据库完整性...\");\n\n            const {results} = await server.get('database/check-integrity');\n\n            if (results.length === 1 && results[0].integrity_check === \"ok\") {\n                toastService.showMessage(\"完整性检查成功 - 未发现问题.\");\n            }\n            else {\n                toastService.showMessage(`Integrity check failed: ${JSON.stringify(results, null, 2)}`, 15000);\n            }\n        });\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\nimport toastService from \"../../../../services/toast.js\";\nimport server from \"../../../../services/server.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>一致性检查</h4>\n    \n    <button class=\"find-and-fix-consistency-issues-button btn\">查找并解决一致性问题</button>\n</div>`;\n\nexport default class ConsistencyChecksOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$findAndFixConsistencyIssuesButton = this.$widget.find(\".find-and-fix-consistency-issues-button\");\n        this.$findAndFixConsistencyIssuesButton.on('click', async () => {\n            toastService.showMessage(\"查找并修复一致性问题...\");\n\n            await server.post('database/find-and-fix-consistency-issues');\n\n            toastService.showMessage(\"一致性问题应该已经解决了.\");\n        });\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\nimport toastService from \"../../../../services/toast.js\";\nimport server from \"../../../../services/server.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>数据库匿名化</h4>\n    \n    <h5>完全匿名化</h5>\n    \n    <p>这会创建一个数据库的副本并匿名化处理(删除所有笔记内容, 仅保留结构和一些非敏感的元数据信息)用来分享到网上做调试而不用担心泄漏你的个人资料.</p>\n    \n    <button class=\"anonymize-full-button btn\">保存完全匿名化的数据库</button>\n\n    <h5>轻度匿名化</h5>\n    \n    <p>此操作将创建数据库的新副本并对其进行轻度匿名化 - 仅删除所有笔记的内容,但标题和属性将保留. 另外, 自定义前端和后端JS代码以及自定义部件会保留. 这会给查找bug提供更完整的环境.</p>\n    \n    <p>您可以自行决定是否要提供完全或轻度匿名化的数据库. 完全匿名化的数据库会对解决问题有帮助, 在一些情况下, 如果能提供轻度匿名化的数据库能加快定位bug和修复的过程.</p>\n    \n    <button class=\"anonymize-light-button btn\">保存轻度匿名化的数据库</button>\n    \n    <h5>已有匿名化数据库</h5>\n    \n    <ul class=\"existing-anonymized-databases\"></ul>\n</div>`;\n\nexport default class DatabaseAnonymizationOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$anonymizeFullButton = this.$widget.find(\".anonymize-full-button\");\n        this.$anonymizeLightButton = this.$widget.find(\".anonymize-light-button\");\n        this.$anonymizeFullButton.on('click', async () => {\n            toastService.showMessage(\"创建完全匿名的数据库...\");\n\n            const resp = await server.post('database/anonymize/full');\n\n            if (!resp.success) {\n                toastService.showError(\"无法创建匿名化数据库, 详情请检查后台日志.\");\n            }\n            else {\n                toastService.showMessage(`Created fully anonymized database in ${resp.anonymizedFilePath}`, 10000);\n            }\n\n            this.refresh();\n        });\n\n        this.$anonymizeLightButton.on('click', async () => {\n            toastService.showMessage(\"创建轻度匿名数据库...\");\n\n            const resp = await server.post('database/anonymize/light');\n\n            if (!resp.success) {\n                toastService.showError(\"无法创建匿名化数据库, 详情请检查后台日志.\");\n            }\n            else {\n                toastService.showMessage(`Created lightly anonymized database in ${resp.anonymizedFilePath}`, 10000);\n            }\n\n            this.refresh();\n        });\n\n        this.$existingAnonymizedDatabases = this.$widget.find(\".existing-anonymized-databases\");\n    }\n\n    optionsLoaded(options) {\n        server.get(\"database/anonymized-databases\").then(anonymizedDatabases => {\n            this.$existingAnonymizedDatabases.empty();\n\n            if (!anonymizedDatabases.length) {\n                anonymizedDatabases = [{filePath: \"还没有匿名化的数据库\"}];\n            }\n\n            for (const {filePath} of anonymizedDatabases) {\n                this.$existingAnonymizedDatabases.append($(\"<li>\").text(filePath));\n            }\n        });\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\nimport server from \"../../../../services/server.js\";\nimport toastService from \"../../../../services/toast.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>同步</h4>\n    <button class=\"force-full-sync-button btn\">强制完全同步</button> \n    \n    <button class=\"fill-entity-changes-button btn\">填充变化记录</button>\n</div>`;\n\nexport default class AdvancedSyncOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$forceFullSyncButton = this.$widget.find(\".force-full-sync-button\");\n        this.$fillEntityChangesButton = this.$widget.find(\".fill-entity-changes-button\");\n        this.$forceFullSyncButton.on('click', async () => {\n            await server.post('sync/force-full-sync');\n\n            toastService.showMessage(\"完全同步已触发\");\n        });\n\n        this.$fillEntityChangesButton.on('click', async () => {\n            toastService.showMessage(\"填充实体修改数据...\");\n\n            await server.post('sync/fill-entity-changes');\n\n            toastService.showMessage(\"同步行已成功填充\");\n        });\n    }\n\n    async optionsLoaded(options) {\n\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\nimport toastService from \"../../../../services/toast.js\";\nimport server from \"../../../../services/server.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>整理数据库</h4>\n    \n    <p>这会重建数据库, 通常会减少占用空间, 不会删除数据.</p>\n    \n    <button class=\"vacuum-database-button btn\">整理数据库</button>\n</div>`;\n\nexport default class VacuumDatabaseOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$vacuumDatabaseButton = this.$widget.find(\".vacuum-database-button\");\n        this.$vacuumDatabaseButton.on('click', async () => {\n            toastService.showMessage(\"整理数据库...\");\n\n            await server.post('database/vacuum-database');\n\n            toastService.showMessage(\"数据库已整理\");\n        });\n    }\n}\n","import BasicWidget from \"../basic_widget.js\";\nimport server from \"../../services/server.js\";\nimport dialogService from \"../../services/dialog.js\";\nimport toastService from \"../../services/toast.js\";\nimport ws from \"../../services/ws.js\";\nimport appContext from \"../../components/app_context.js\";\nimport openService from \"../../services/open.js\";\nimport utils from \"../../services/utils.js\";\n\nconst TPL = `\n<div class=\"dropdown attachment-actions\">\n    <style>\n    .attachment-actions {\n        width: 35px;\n        height: 35px;\n    }\n    \n    .attachment-actions .dropdown-menu {\n        width: 20em;\n    }\n    \n    .attachment-actions .dropdown-item[disabled], .attachment-actions .dropdown-item[disabled]:hover {\n        color: var(--muted-text-color) !important;\n        background-color: transparent !important;\n        pointer-events: none; /* makes it unclickable */\n    }\n    </style>\n\n    <button type=\"button\" data-toggle=\"dropdown\" aria-haspopup=\"true\" \n        aria-expanded=\"false\" class=\"icon-action icon-action-always-border bx bx-dots-vertical-rounded\"\n        style=\"position: relative; top: 3px;\"></button>\n\n    <div class=\"dropdown-menu dropdown-menu-right\">\n        <a data-trigger-command=\"openAttachment\" class=\"dropdown-item\"\n            title=\"文件将在外部应用程序中打开并监视更改, 然后您可以将修改后的版本上传回Trilium\">用外部程序打开</a>\n        <a data-trigger-command=\"openAttachmentCustom\" class=\"dropdown-item\"\n            title=\"文件将在外部应用程序中打开并监视更改, 然后您可以将修改后的版本上传回Trilium\">使用自定义程序打开</a>\n        <a data-trigger-command=\"downloadAttachment\" class=\"dropdown-item\">下载</a>\n        <a data-trigger-command=\"renameAttachment\" class=\"dropdown-item\">重命名附件</a>\n        <a data-trigger-command=\"uploadNewAttachmentRevision\" class=\"dropdown-item\">上传新的修改</a>\n        <a data-trigger-command=\"copyAttachmentLinkToClipboard\" class=\"dropdown-item\">复制链接到剪贴板</a>\n        <a data-trigger-command=\"convertAttachmentIntoNote\" class=\"dropdown-item\">将附件转换为笔记</a>\n        <a data-trigger-command=\"deleteAttachment\" class=\"dropdown-item\">删除附件</a>\n    </div>\n    \n    <input type=\"file\" class=\"attachment-upload-new-revision-input\" style=\"display: none\">\n</div>`;\n\nexport default class AttachmentActionsWidget extends BasicWidget {\n    constructor(attachment, isFullDetail) {\n        super();\n\n        this.attachment = attachment;\n        this.isFullDetail = isFullDetail;\n    }\n\n    get attachmentId() {\n        return this.attachment.attachmentId;\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$widget.on('click', '.dropdown-item', () => this.$widget.find(\"[data-toggle='dropdown']\").dropdown('toggle'));\n\n        this.$uploadNewRevisionInput = this.$widget.find(\".attachment-upload-new-revision-input\");\n        this.$uploadNewRevisionInput.on('change', async () => {\n            const fileToUpload = this.$uploadNewRevisionInput[0].files[0]; // copy to allow reset below\n            this.$uploadNewRevisionInput.val('');\n\n            const result = await server.upload(`attachments/${this.attachmentId}/file`, fileToUpload);\n\n            if (result.uploaded) {\n                toastService.showMessage(\"已上传新附件版本。\");\n            } else {\n                toastService.showError(\"Upload of a new attachment revision failed.\");\n            }\n        });\n\n        if (!this.isFullDetail) {\n            // we deactivate this button because the WatchedFileUpdateStatusWidget assumes only one visible attachment\n            // in a note context, so it doesn't work in a list\n            const $openAttachmentButton = this.$widget.find(\"[data-trigger-command='openAttachment']\");\n            $openAttachmentButton\n                .addClass(\"disabled\")\n                .append($('<span class=\"disabled-tooltip\"> (?)</span>')\n                    .attr(\"title\", \"用外部程序打开附件仅在详细页面使用, 请先单击附件详情并重复操作\")\n                );\n            const $openAttachmentCustomButton = this.$widget.find(\"[data-trigger-command='openAttachmentCustom']\");\n            $openAttachmentCustomButton\n                .addClass(\"disabled\")\n                .append($('<span class=\"disabled-tooltip\"> (?)</span>')\n                    .attr(\"title\", \"用外部程序打开附件仅在详细页面使用, 请先单击附件详情并重复操作\")\n                );\n        }\n        if (!utils.isElectron()){\n            const $openAttachmentCustomButton = this.$widget.find(\"[data-trigger-command='openAttachmentCustom']\");\n            $openAttachmentCustomButton\n                .addClass(\"disabled\")\n                .append($('<span class=\"disabled-tooltip\"> (?)</span>')\n                    .attr(\"title\", \"Custom opening of attachments can only be done from the client.\")\n                );\n        }\n    }\n\n    async openAttachmentCommand() {\n        await openService.openAttachmentExternally(this.attachmentId, this.attachment.mime);\n    }\n\n    async openAttachmentCustomCommand() {\n        await openService.openAttachmentCustom(this.attachmentId, this.attachment.mime);\n    }\n\n    async downloadAttachmentCommand() {\n        await openService.downloadAttachment(this.attachmentId);\n    }\n\n    async uploadNewAttachmentRevisionCommand() {\n        this.$uploadNewRevisionInput.trigger('click');\n    }\n\n    async copyAttachmentLinkToClipboardCommand() {\n        this.parent.copyAttachmentLinkToClipboard();\n    }\n\n    async deleteAttachmentCommand() {\n        if (!await dialogService.confirm(`您确定要删除附件吗 '${this.attachment.title}'?`)) {\n            return;\n        }\n\n        await server.remove(`attachments/${this.attachmentId}`);\n        toastService.showMessage(`已删除附件 '${this.attachment.title}'`);\n    }\n\n    async convertAttachmentIntoNoteCommand() {\n        if (!await dialogService.confirm(`Are you sure you want to convert attachment '${this.attachment.title}' into a separate note?`)) {\n            return;\n        }\n\n        const {note: newNote} = await server.post(`attachments/${this.attachmentId}/convert-to-note`)\n        toastService.showMessage(`附件 '${this.attachment.title}' 已转换为笔记`);\n        await ws.waitForMaxKnownEntityChangeId();\n        await appContext.tabManager.getActiveContext().setNote(newNote.noteId);\n    }\n\n    async renameAttachmentCommand() {\n        const attachmentTitle = await dialogService.prompt({\n            title: \"重命名附件\",\n            message: \"请输入新附件的名称\",\n            defaultValue: this.attachment.title\n        });\n\n        if (!attachmentTitle?.trim()) {\n            return;\n        }\n\n        await server.put(`attachments/${this.attachmentId}/rename`, {title: attachmentTitle});\n    }\n}\n","import utils from \"../services/utils.js\";\nimport AttachmentActionsWidget from \"./buttons/attachments_actions.js\";\nimport BasicWidget from \"./basic_widget.js\";\nimport options from \"../services/options.js\";\nimport imageService from \"../services/image.js\";\nimport linkService from \"../services/link.js\";\nimport contentRenderer from \"../services/content_renderer.js\";\nimport toastService from \"../services/toast.js\";\n\nconst TPL = `\n<div class=\"attachment-detail-widget\">\n    <style>\n        .attachment-detail-widget {\n            height: 100%;\n        }\n    \n        .attachment-detail-wrapper {\n            margin-bottom: 20px;\n            display: flex;\n            flex-direction: column;\n        }\n        \n        .attachment-title-line {\n            display: flex;\n            align-items: baseline;\n            gap: 1em;\n        }\n        \n        .attachment-details {\n            margin-left: 10px;\n        }\n        \n        .attachment-content-wrapper {\n            flex-grow: 1;\n        }\n        \n        .attachment-content-wrapper .rendered-content {\n            height: 100%;\n        }\n        \n        .attachment-content-wrapper pre {\n            background: var(--accented-background-color);\n            padding: 10px;\n            margin-top: 10px;\n            margin-bottom: 10px;\n        }\n        \n        .attachment-detail-wrapper.list-view .attachment-content-wrapper {\n            max-height: 300px;\n        }\n\n        .attachment-detail-wrapper.full-detail {\n            height: 100%;\n        }\n\n        .attachment-detail-wrapper.full-detail .attachment-content-wrapper {\n            height: 100%;\n        }\n        \n        .attachment-detail-wrapper.list-view .attachment-content-wrapper pre {\n            max-height: 400px;\n        }\n        \n        .attachment-content-wrapper img {\n            margin: 10px;\n        }\n        \n        .attachment-detail-wrapper.list-view .attachment-content-wrapper img, .attachment-detail-wrapper.list-view .attachment-content-wrapper video {\n            max-height: 300px; \n            max-width: 90%; \n            object-fit: contain;\n        }\n        \n        .attachment-detail-wrapper.full-detail .attachment-content-wrapper img {\n            max-width: 90%; \n            object-fit: contain;\n        }\n        \n        .attachment-detail-wrapper.scheduled-for-deletion .attachment-content-wrapper img {\n            filter: contrast(10%);\n        }\n    </style>\n\n    <div class=\"attachment-detail-wrapper\">\n        <div class=\"attachment-title-line\">\n            <div class=\"attachment-actions-container\"></div>\n            <h4 class=\"attachment-title\"></h4>                \n            <div class=\"attachment-details\"></div>\n            <div style=\"flex: 1 1;\"></div>\n        </div>\n        \n        <div class=\"attachment-deletion-warning alert alert-info\" style=\"margin-top: 15px;\"></div>\n        \n        <div class=\"attachment-content-wrapper\"></div>\n    </div>\n</div>`;\n\nexport default class AttachmentDetailWidget extends BasicWidget {\n    constructor(attachment, isFullDetail) {\n        super();\n\n        this.contentSized();\n        this.attachment = attachment;\n        this.attachmentActionsWidget = new AttachmentActionsWidget(attachment, isFullDetail);\n        this.isFullDetail = isFullDetail;\n        this.child(this.attachmentActionsWidget);\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.refresh();\n\n        super.doRender();\n    }\n\n    async refresh() {\n        this.$widget.find('.attachment-detail-wrapper')\n            .empty()\n            .append(\n                $(TPL)\n                    .find('.attachment-detail-wrapper')\n                    .html()\n            );\n        this.$wrapper = this.$widget.find('.attachment-detail-wrapper');\n        this.$wrapper.addClass(this.isFullDetail ? \"full-detail\" : \"list-view\");\n\n        if (!this.isFullDetail) {\n            this.$wrapper.find('.attachment-title').append(\n                await linkService.createLink(this.attachment.ownerId, {\n                    title: this.attachment.title,\n                    viewScope: {\n                        viewMode: 'attachments',\n                        attachmentId: this.attachment.attachmentId\n                    }\n                })\n            );\n        } else {\n            this.$wrapper.find('.attachment-title')\n                .text(this.attachment.title);\n        }\n\n        const $deletionWarning = this.$wrapper.find('.attachment-deletion-warning');\n        const {utcDateScheduledForErasureSince} = this.attachment;\n\n        if (utcDateScheduledForErasureSince) {\n            this.$wrapper.addClass(\"scheduled-for-deletion\");\n\n            const scheduledSinceTimestamp = utils.parseDate(utcDateScheduledForErasureSince)?.getTime();\n            const intervalMs = options.getInt('eraseUnusedAttachmentsAfterSeconds') * 1000;\n            const deletionTimestamp = scheduledSinceTimestamp + intervalMs;\n            const willBeDeletedInMs = deletionTimestamp - Date.now();\n\n            $deletionWarning.show();\n\n            if (willBeDeletedInMs >= 60000) {\n                $deletionWarning.text(`此附件将在 ${utils.formatTimeInterval(willBeDeletedInMs)} 后自动删除。`);\n            } else {\n                $deletionWarning.text(`此附件将很快被自动删除`);\n            }\n\n            $deletionWarning.append(\", 因为附件未在笔记内容中链接。为防止被删除，请将附件链接添加回内容中或将附件转换为笔记。\");\n        } else {\n            this.$wrapper.removeClass(\"scheduled-for-deletion\");\n            $deletionWarning.hide();\n        }\n\n        this.$wrapper.find('.attachment-details')\n            .text(`角色：${this.attachment.role}，大小：${utils.formatSize(this.attachment.contentLength)}`);\n        this.$wrapper.find('.attachment-actions-container').append(this.attachmentActionsWidget.render());\n\n        const {$renderedContent} = await contentRenderer.getRenderedContent(this.attachment, { imageHasZoom: this.isFullDetail });\n        this.$wrapper.find('.attachment-content-wrapper').append($renderedContent);\n    }\n\n    async copyAttachmentLinkToClipboard() {\n        if (this.attachment.role === 'image') {\n            imageService.copyImageReferenceToClipboard(this.$wrapper.find('.attachment-content-wrapper'));\n        } else if (this.attachment.role === 'file') {\n            const $link = await linkService.createLink(this.attachment.ownerId, {\n                referenceLink: true,\n                viewScope: {\n                    viewMode: 'attachments',\n                    attachmentId: this.attachment.attachmentId\n                }\n            });\n\n            utils.copyHtmlToClipboard($link[0].outerHTML);\n\n            toastService.showMessage(\"附件链接已复制到剪贴板.\");\n        } else {\n            throw new Error(`Unrecognized attachment role '${this.attachment.role}'.`);\n        }\n    }\n\n    async entitiesReloadedEvent({loadResults}) {\n        const attachmentRow = loadResults.getAttachmentRows().find(att => att.attachmentId === this.attachment.attachmentId);\n\n        if (attachmentRow) {\n            if (attachmentRow.isDeleted) {\n                this.toggleInt(false);\n            } else {\n                this.refresh();\n            }\n        }\n    }\n}\n","import NoteContextAwareWidget from \"./note_context_aware_widget.js\";\nimport protectedSessionHolder from \"../services/protected_session_holder.js\";\nimport SpacedUpdate from \"../services/spaced_update.js\";\nimport server from \"../services/server.js\";\nimport libraryLoader from \"../services/library_loader.js\";\nimport appContext from \"../components/app_context.js\";\nimport keyboardActionsService from \"../services/keyboard_actions.js\";\nimport noteCreateService from \"../services/note_create.js\";\nimport attributeService from \"../services/attributes.js\";\nimport attributeRenderer from \"../services/attribute_renderer.js\";\n\nimport EmptyTypeWidget from \"./type_widgets/empty.js\";\nimport EditableTextTypeWidget from \"./type_widgets/editable_text.js\";\nimport EditableCodeTypeWidget from \"./type_widgets/editable_code.js\";\nimport FileTypeWidget from \"./type_widgets/file.js\";\nimport ImageTypeWidget from \"./type_widgets/image.js\";\nimport RenderTypeWidget from \"./type_widgets/render.js\";\nimport RelationMapTypeWidget from \"./type_widgets/relation_map.js\";\nimport CanvasTypeWidget from \"./type_widgets/canvas.js\";\nimport ProtectedSessionTypeWidget from \"./type_widgets/protected_session.js\";\nimport BookTypeWidget from \"./type_widgets/book.js\";\nimport ReadOnlyTextTypeWidget from \"./type_widgets/read_only_text.js\";\nimport ReadOnlyCodeTypeWidget from \"./type_widgets/read_only_code.js\";\nimport NoneTypeWidget from \"./type_widgets/none.js\";\nimport NoteMapTypeWidget from \"./type_widgets/note_map.js\";\nimport WebViewTypeWidget from \"./type_widgets/web_view.js\";\nimport DocTypeWidget from \"./type_widgets/doc.js\";\nimport ContentWidgetTypeWidget from \"./type_widgets/content_widget.js\";\nimport AttachmentListTypeWidget from \"./type_widgets/attachment_list.js\";\nimport AttachmentDetailTypeWidget from \"./type_widgets/attachment_detail.js\";\n\nconst TPL = `\n<div class=\"note-detail\">\n    <style>\n    .note-detail {\n        font-family: var(--detail-font-family);\n        font-size: var(--detail-font-size);\n    }\n    \n    .note-detail.full-height {\n        height: 100%;\n    }\n    </style>\n</div>\n`;\n\nconst typeWidgetClasses = {\n    'empty': EmptyTypeWidget,\n    'editableText': EditableTextTypeWidget,\n    'readOnlyText': ReadOnlyTextTypeWidget,\n    'editableCode': EditableCodeTypeWidget,\n    'readOnlyCode': ReadOnlyCodeTypeWidget,\n    'file': FileTypeWidget,\n    'image': ImageTypeWidget,\n    'search': NoneTypeWidget,\n    'render': RenderTypeWidget,\n    'relationMap': RelationMapTypeWidget,\n    'canvas': CanvasTypeWidget,\n    'protectedSession': ProtectedSessionTypeWidget,\n    'book': BookTypeWidget,\n    'noteMap': NoteMapTypeWidget,\n    'webView': WebViewTypeWidget,\n    'doc': DocTypeWidget,\n    'contentWidget': ContentWidgetTypeWidget,\n    'attachmentDetail': AttachmentDetailTypeWidget,\n    'attachmentList': AttachmentListTypeWidget\n};\n\nexport default class NoteDetailWidget extends NoteContextAwareWidget {\n    constructor() {\n        super();\n\n        this.typeWidgets = {};\n\n        this.spacedUpdate = new SpacedUpdate(async () => {\n            const {note} = this.noteContext;\n            const {noteId} = note;\n\n            const data = await this.getTypeWidget().getData();\n\n            // for read only notes\n            if (data === undefined) {\n                return;\n            }\n\n            protectedSessionHolder.touchProtectedSessionIfNecessary(note);\n\n            await server.put(`notes/${noteId}/data`, data, this.componentId);\n\n            this.getTypeWidget().dataSaved?.();\n        });\n\n        appContext.addBeforeUnloadListener(this);\n    }\n\n    isEnabled() {\n        return true;\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.contentSized();\n    }\n\n    async refresh() {\n        this.type = await this.getWidgetType();\n        this.mime = this.note?.mime;\n\n        if (!(this.type in this.typeWidgets)) {\n            const clazz = typeWidgetClasses[this.type];\n\n            if (!clazz) {\n                throw new Error(`Cannot find type widget for type '${this.type}'`);\n            }\n\n            const typeWidget = this.typeWidgets[this.type] = new clazz();\n            typeWidget.spacedUpdate = this.spacedUpdate;\n            typeWidget.setParent(this);\n\n            const $renderedWidget = typeWidget.render();\n            keyboardActionsService.updateDisplayedShortcuts($renderedWidget);\n\n            this.$widget.append($renderedWidget);\n\n            await typeWidget.handleEvent('setNoteContext', {noteContext: this.noteContext});\n\n            // this is happening in update(), so note has been already set, and we need to reflect this\n            await typeWidget.handleEvent('noteSwitched', {\n                noteContext: this.noteContext,\n                notePath: this.noteContext.notePath\n            });\n\n            this.child(typeWidget);\n        }\n\n        this.checkFullHeight();\n    }\n\n    /**\n     * sets full height of container that contains note content for a subset of note-types\n     */\n    checkFullHeight() {\n        // https://github.com/zadam/trilium/issues/2522\n        this.$widget.toggleClass(\"full-height\",\n            (\n                !this.noteContext.hasNoteList()\n                && ['canvas', 'webView', 'noteMap'].includes(this.type)\n                && this.mime !== 'text/x-sqlite;schema=trilium'\n            )\n            || this.noteContext.viewScope.viewMode === 'attachments'\n        );\n    }\n\n    getTypeWidget() {\n        if (!this.typeWidgets[this.type]) {\n            throw new Error(`Could not find typeWidget for type '${this.type}'`);\n        }\n\n        return this.typeWidgets[this.type];\n    }\n\n    async getWidgetType() {\n        const note = this.note;\n\n        if (!note) {\n            return \"empty\";\n        }\n\n        let type = note.type;\n        const viewScope = this.noteContext.viewScope;\n\n        if (viewScope.viewMode === 'source') {\n            type = 'readOnlyCode';\n        } else if (viewScope.viewMode === 'attachments') {\n            type = viewScope.attachmentId ? 'attachmentDetail' : 'attachmentList';\n        } else if (type === 'text' && await this.noteContext.isReadOnly()) {\n            type = 'readOnlyText';\n        } else if ((type === 'code' || type === 'mermaid') && await this.noteContext.isReadOnly()) {\n            type = 'readOnlyCode';\n        } else if (type === 'text') {\n            type = 'editableText';\n        } else if (type === 'code' || type === 'mermaid') {\n            type = 'editableCode';\n        } else if (type === 'launcher') {\n            type = 'doc';\n        }\n\n        if (note.isProtected && !protectedSessionHolder.isProtectedSessionAvailable()) {\n            type = 'protectedSession';\n        }\n\n        return type;\n    }\n\n    async focusOnDetailEvent({ntxId}) {\n        if (this.noteContext.ntxId !== ntxId) {\n            return;\n        }\n\n        await this.refresh();\n        const widget = this.getTypeWidget();\n        await widget.initialized;\n        widget.focus();\n    }\n\n    async scrollToEndEvent({ntxId}) {\n        if (this.noteContext.ntxId !== ntxId) {\n            return;\n        }\n\n        await this.refresh();\n        const widget = this.getTypeWidget();\n        await widget.initialized;\n\n        if (widget.scrollToEnd) {\n            widget.scrollToEnd();\n        }\n    }\n\n    async beforeNoteSwitchEvent({noteContext}) {\n        if (this.isNoteContext(noteContext.ntxId)) {\n            await this.spacedUpdate.updateNowIfNecessary();\n        }\n    }\n\n    async beforeNoteContextRemoveEvent({ntxIds}) {\n        if (this.isNoteContext(ntxIds)) {\n            await this.spacedUpdate.updateNowIfNecessary();\n        }\n    }\n\n    async runActiveNoteCommand(params) {\n        if (this.isNoteContext(params.ntxId)) {\n            // make sure that script is saved before running it #4028\n            await this.spacedUpdate.updateNowIfNecessary();\n        }\n\n        return await this.parent.triggerCommand('runActiveNote', params);\n    }\n\n    async printActiveNoteEvent() {\n        if (!this.noteContext.isActive()) {\n            return;\n        }\n\n        await libraryLoader.requireLibrary(libraryLoader.PRINT_THIS);\n\n        let $promotedAttributes = $(\"\");\n\n        if (this.note.getPromotedDefinitionAttributes().length > 0) {\n            $promotedAttributes = (await attributeRenderer.renderNormalAttributes(this.note)).$renderedAttributes;\n        }\n\n        const {assetPath} = window.glob;\n\n        this.$widget.find('.note-detail-printable:visible').printThis({\n            header: $(\"<div>\")\n                        .append($(\"<h2>\").text(this.note.title))\n                        .append($promotedAttributes)\n                        .prop('outerHTML'),\n\n            footer: `\n<script src=\"${assetPath}/node_modules/katex/dist/katex.min.js\"></script>\n<script src=\"${assetPath}/node_modules/katex/dist/contrib/mhchem.min.js\"></script>\n<script src=\"${assetPath}/node_modules/katex/dist/contrib/auto-render.min.js\"></script>\n<script>\n    document.body.className += ' ck-content printed-content';\n    \n    renderMathInElement(document.body, {trust: true});\n</script>\n`,\n            importCSS: false,\n            loadCSS: [\n                `${assetPath}/libraries/codemirror/codemirror.css`,\n                `${assetPath}/libraries/ckeditor/ckeditor-content.css`,\n                `${assetPath}/libraries/bootstrap/css/bootstrap.min.css`,\n                `${assetPath}/node_modules/katex/dist/katex.min.css`,\n                `${assetPath}/stylesheets/print.css`,\n                `${assetPath}/stylesheets/relation_map.css`,\n                `${assetPath}/stylesheets/ckeditor-theme.css`\n            ],\n            debug: true\n        });\n    }\n\n    hoistedNoteChangedEvent({ntxId}) {\n        if (this.isNoteContext(ntxId)) {\n            this.refresh();\n        }\n    }\n\n    async entitiesReloadedEvent({loadResults}) {\n        // we're detecting note type change on the note_detail level, but triggering the noteTypeMimeChanged\n        // globally, so it gets also to e.g. ribbon components. But this means that the event can be generated multiple\n        // times if the same note is open in several tabs.\n\n        if (loadResults.isNoteContentReloaded(this.noteId, this.componentId)) {\n            // probably incorrect event\n            // calling this.refresh() is not enough since the event needs to be propagated to children as well\n            // FIXME: create a separate event to force hierarchical refresh\n\n            // this uses handleEvent to make sure that the ordinary content updates are propagated only in the subtree\n            // to avoid the problem in #3365\n            this.handleEvent('noteTypeMimeChanged', {noteId: this.noteId});\n        }\n        else if (loadResults.isNoteReloaded(this.noteId, this.componentId)\n            && (this.type !== await this.getWidgetType() || this.mime !== this.note.mime)) {\n\n            // this needs to have a triggerEvent so that e.g., note type (not in the component subtree) is updated\n            this.triggerEvent('noteTypeMimeChanged', {noteId: this.noteId});\n        }\n        else {\n            const attrs = loadResults.getAttributeRows();\n\n            const label = attrs.find(attr =>\n                attr.type === 'label'\n                && ['readOnly', 'autoReadOnlyDisabled', 'cssClass', 'displayRelations', 'hideRelations'].includes(attr.name)\n                && attributeService.isAffecting(attr, this.note));\n\n            const relation = attrs.find(attr =>\n                attr.type === 'relation'\n                && ['template', 'inherit', 'renderNote'].includes(attr.name)\n                && attributeService.isAffecting(attr, this.note));\n\n            if (label || relation) {\n                // probably incorrect event\n                // calling this.refresh() is not enough since the event needs to be propagated to children as well\n                this.triggerEvent('noteTypeMimeChanged', {noteId: this.noteId});\n            }\n        }\n    }\n\n    beforeUnloadEvent() {\n        return this.spacedUpdate.isAllSavedAndTriggerUpdate();\n    }\n\n    readOnlyTemporarilyDisabledEvent({noteContext}) {\n        if (this.isNoteContext(noteContext.ntxId)) {\n            this.refresh();\n        }\n    }\n\n    async executeInActiveNoteDetailWidgetEvent({callback}) {\n        if (!this.isActiveNoteContext()) {\n            return;\n        }\n\n        await this.initialized;\n\n        callback(this);\n    }\n\n    async cutIntoNoteCommand() {\n        const note = appContext.tabManager.getActiveContextNote();\n\n        if (!note) {\n            return;\n        }\n\n        // without await as this otherwise causes deadlock through component mutex\n        noteCreateService.createNote(appContext.tabManager.getActiveContextNotePath(), {\n            isProtected: note.isProtected,\n            saveSelection: true,\n            textEditor: await this.noteContext.getTextEditor()\n        });\n    }\n\n    // used by cutToNote in CKEditor build\n    async saveNoteDetailNowCommand() {\n        await this.spacedUpdate.updateNowIfNecessary();\n    }\n\n    renderActiveNoteEvent() {\n        if (this.noteContext.isActive()) {\n            this.refresh();\n        }\n    }\n\n    async executeWithTypeWidgetEvent({resolve, ntxId}) {\n        if (!this.isNoteContext(ntxId)) {\n            return;\n        }\n\n        await this.initialized;\n\n        await this.getWidgetType();\n\n        resolve(this.getTypeWidget());\n    }\n}\n","import noteAutocompleteService from '../../services/note_autocomplete.js';\nimport TypeWidget from \"./type_widget.js\";\nimport appContext from \"../../components/app_context.js\";\nimport searchService from \"../../services/search.js\";\n\nconst TPL = `\n<div class=\"note-detail-empty note-detail-printable\">\n    <style>\n        .workspace-notes {\n            display: flex;\n            flex-direction: row;\n            flex-wrap: wrap;\n            justify-content: space-evenly;\n        }\n        \n        .workspace-notes .workspace-note {\n            width: 130px;\n            text-align: center;\n            margin: 10px;\n            padding; 10px;\n            border: 1px transparent solid;\n        }\n        \n        .workspace-notes .workspace-note:hover {\n            cursor: pointer;\n            border: 1px solid var(--main-border-color);\n        }\n        \n        .workspace-icon {\n            text-align: center;\n            font-size: 500%;\n        }\n    </style>\n\n    <div class=\"form-group\">\n        <label>在下方输入笔记名称或者点树形图来打开笔记.</label>\n        <div class=\"input-group\">\n            <input class=\"form-control note-autocomplete\" placeholder=\"根据名称搜索笔记\">\n        </div>\n    </div>\n    \n    <div class=\"workspace-notes\"></div>\n</div>`;\n\nexport default class EmptyTypeWidget extends TypeWidget {\n    static getType() { return \"empty\"; }\n\n    doRender() {\n        // FIXME: this might be optimized - cleaned up after use since it's always used only for new tab\n\n        this.$widget = $(TPL);\n        this.$autoComplete = this.$widget.find(\".note-autocomplete\");\n\n        noteAutocompleteService.initNoteAutocomplete(this.$autoComplete, {\n            hideGoToSelectedNoteButton: true,\n            allowCreatingNotes: true\n        })\n            .on('autocomplete:noteselected', function(event, suggestion, dataset) {\n                if (!suggestion.notePath) {\n                    return false;\n                }\n\n                appContext.tabManager.getActiveContext().setNote(suggestion.notePath);\n            });\n\n        this.$workspaceNotes = this.$widget.find('.workspace-notes');\n\n        super.doRender();\n    }\n\n    async doRefresh(note) {\n        const workspaceNotes = await searchService.searchForNotes('#workspace #!template');\n\n        this.$workspaceNotes.empty();\n\n        for (const workspaceNote of workspaceNotes) {\n            this.$workspaceNotes.append(\n                $('<div class=\"workspace-note\">')\n                    .append($(\"<div>\").addClass(`${workspaceNote.getIcon()} workspace-icon`))\n                    .append($(\"<div>\").text(workspaceNote.title))\n                    .attr(\"title\", `进入工作空间 ${workspaceNote.title}`)\n                    .on('click', () => this.triggerCommand('hoistNote', {noteId: workspaceNote.noteId}))\n            );\n        }\n\n        this.$autoComplete\n            .trigger('focus')\n            .trigger('select');\n    }\n}\n","import AbstractTextTypeWidget from \"./abstract_text_type_widget.js\";\nimport libraryLoader from \"../../services/library_loader.js\";\n\nconst TPL = `\n<div class=\"note-detail-readonly-text note-detail-printable\">\n    <style>\n    /* h1 should not be used at all since semantically that's a note title */\n    .note-detail-readonly-text h1 { font-size: 1.8em; }\n    .note-detail-readonly-text h2 { font-size: 1.6em; }\n    .note-detail-readonly-text h3 { font-size: 1.4em; }\n    .note-detail-readonly-text h4 { font-size: 1.2em; }\n    .note-detail-readonly-text h5 { font-size: 1.1em; }\n    .note-detail-readonly-text h6 { font-size: 1.0em; }\n    \n    body.heading-style-markdown .note-detail-readonly-text h1::before { content: \"#\\\\2004\"; color: var(--muted-text-color); }\n    body.heading-style-markdown .note-detail-readonly-text h2::before { content: \"##\\\\2004\"; color: var(--muted-text-color); }\n    body.heading-style-markdown .note-detail-readonly-text h3::before { content: \"###\\\\2004\"; color: var(--muted-text-color); }\n    body.heading-style-markdown .note-detail-readonly-text h4:not(.include-note-title)::before { content: \"####\\\\2004\"; color: var(--muted-text-color); }\n    body.heading-style-markdown .note-detail-readonly-text h5::before { content: \"#####\\\\2004\"; color: var(--muted-text-color); }\n    body.heading-style-markdown .note-detail-readonly-text h6::before { content: \"######\\\\2004\"; color: var(--muted-text-color); }\n\n    body.heading-style-underline .note-detail-readonly-text h1 { border-bottom: 1px solid var(--main-border-color); }\n    body.heading-style-underline .note-detail-readonly-text h2 { border-bottom: 1px solid var(--main-border-color); }\n    body.heading-style-underline .note-detail-readonly-text h3 { border-bottom: 1px solid var(--main-border-color); }\n    body.heading-style-underline .note-detail-readonly-text h4:not(.include-note-title) { border-bottom: 1px solid var(--main-border-color); }\n    body.heading-style-underline .note-detail-readonly-text h5 { border-bottom: 1px solid var(--main-border-color); }\n    body.heading-style-underline .note-detail-readonly-text h6 { border-bottom: 1px solid var(--main-border-color); }\n    \n    .note-detail-readonly-text {\n        padding-left: 24px;\n        padding-top: 10px;\n        font-family: var(--detail-font-family);\n        min-height: 50px;\n        position: relative;\n    }\n    \n    body.mobile .note-detail-readonly-text {\n        padding-left: 10px;\n    }\n        \n    .note-detail-readonly-text p:first-child, .note-detail-readonly-text::before {\n        margin-top: 0;\n    }\n    \n    .note-detail-readonly-text img {\n        max-width: 100%;\n        cursor: pointer;\n    }\n    \n    .edit-text-note-button {\n        position: absolute; \n        top: 5px;\n        right: 10px;\n        font-size: 150%;\n        padding: 5px;\n        cursor: pointer;\n        border: 1px solid transparent;\n        border-radius: var(--button-border-radius);\n        color: var(--button-text-color);\n    }\n    \n    .edit-text-note-button:hover {\n        border-color: var(--button-border-color);\n    }\n    </style>\n\n    <div class=\"note-detail-readonly-text-content ck-content\"></div>\n</div>\n`;\n\nexport default class ReadOnlyTextTypeWidget extends AbstractTextTypeWidget {\n    static getType() { return \"readOnlyText\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$content = this.$widget.find('.note-detail-readonly-text-content');\n\n        this.setupImageOpening(true);\n\n        super.doRender();\n    }\n\n    cleanup() {\n        this.$content.html('');\n    }\n\n    async doRefresh(note) {\n        // we load CKEditor also for read only notes because they contain content styles required for correct rendering of even read only notes\n        // we could load just ckeditor-content.css but that causes CSS conflicts when both build CSS and this content CSS is loaded at the same time\n        // (see https://github.com/zadam/trilium/issues/1590 for example of such conflict)\n        await libraryLoader.requireLibrary(libraryLoader.CKEDITOR);\n\n        const blob = await note.getBlob();\n\n        this.$content.html(blob.content);\n\n        this.$content.find(\"a.reference-link\").each(async (_, el) => {\n            this.loadReferenceLinkTitle($(el));\n        });\n\n        this.$content.find(\"section\").each(async (_, el) => {\n            const noteId = $(el).attr('data-note-id');\n\n            this.loadIncludedNote(noteId, $(el));\n        });\n\n        if (this.$content.find('span.math-tex').length > 0) {\n            await libraryLoader.requireLibrary(libraryLoader.KATEX);\n\n            renderMathInElement(this.$content[0], {trust: true});\n        }\n    }\n\n    async refreshIncludedNoteEvent({noteId}) {\n        this.refreshIncludedNote(this.$content, noteId);\n    }\n\n    async executeWithContentElementEvent({resolve, ntxId}) {\n        if (!this.isNoteContext(ntxId)) {\n            return;\n        }\n\n        await this.initialized;\n\n        resolve(this.$content);\n    }\n}\n","import libraryLoader from \"../../services/library_loader.js\";\nimport TypeWidget from \"./type_widget.js\";\nimport keyboardActionService from \"../../services/keyboard_actions.js\";\nimport options from \"../../services/options.js\";\n\nconst TPL = `\n<div class=\"note-detail-code note-detail-printable\">\n    <style>\n    .note-detail-code {\n        position: relative;\n        height: 100%;\n    }\n    \n    .note-detail-code-editor {\n        min-height: 50px;\n        height: 100%;\n    }\n    </style>\n\n    <div class=\"note-detail-code-editor\"></div>\n</div>`;\n\nexport default class EditableCodeTypeWidget extends TypeWidget {\n    static getType() { return \"editableCode\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$editor = this.$widget.find('.note-detail-code-editor');\n\n        keyboardActionService.setupActionsForElement('code-detail', this.$widget, this);\n\n        super.doRender();\n\n        this.initialized = this.initEditor();\n    }\n\n    async initEditor() {\n        await libraryLoader.requireLibrary(libraryLoader.CODE_MIRROR);\n\n        CodeMirror.keyMap.default[\"Shift-Tab\"] = \"indentLess\";\n        CodeMirror.keyMap.default[\"Tab\"] = \"indentMore\";\n\n        // these conflict with backward/forward navigation shortcuts\n        delete CodeMirror.keyMap.default[\"Alt-Left\"];\n        delete CodeMirror.keyMap.default[\"Alt-Right\"];\n\n        CodeMirror.modeURL = `${window.glob.assetPath}/libraries/codemirror/mode/%N/%N.js`;\n\n        this.codeEditor = CodeMirror(this.$editor[0], {\n            value: \"\",\n            viewportMargin: Infinity,\n            indentUnit: 4,\n            matchBrackets: true,\n            keyMap: options.is('vimKeymapEnabled') ? \"vim\": \"default\",\n            matchTags: {bothTags: true},\n            highlightSelectionMatches: {showToken: false, annotateScrollbar: false},\n            lint: true,\n            gutters: [\"CodeMirror-lint-markers\"],\n            lineNumbers: true,\n            tabindex: 300,\n            // we line wrap partly also because without it horizontal scrollbar displays only when you scroll\n            // all the way to the bottom of the note. With line wrap, there's no horizontal scrollbar so no problem\n            lineWrapping: options.is('codeLineWrapEnabled'),\n            dragDrop: false, // with true the editor inlines dropped files which is not what we expect\n            placeholder: \"在此处输入代码笔记的内容...\",\n        });\n\n        this.codeEditor.on('change', () => this.spacedUpdate.scheduleUpdate());\n    }\n\n    async doRefresh(note) {\n        const blob = await this.note.getBlob();\n\n        await this.spacedUpdate.allowUpdateWithoutChange(() => {\n            // CodeMirror breaks pretty badly on null, so even though it shouldn't happen (guarded by a consistency check)\n            // we provide fallback\n            this.codeEditor.setValue(blob.content || \"\");\n            this.codeEditor.clearHistory();\n\n            let info = CodeMirror.findModeByMIME(note.mime);\n            if (!info) {\n                // Switch back to plain text if CodeMirror does not have a mode for whatever MIME type we're editing.\n                // To avoid inheriting a mode from a previously open code note.\n                info = CodeMirror.findModeByMIME(\"text/plain\");\n            }\n\n            this.codeEditor.setOption(\"mode\", info.mime);\n            CodeMirror.autoLoadMode(this.codeEditor, info.mode);\n        });\n\n        this.show();\n    }\n\n    show() {\n        this.$widget.show();\n\n        if (this.codeEditor) { // show can be called before render\n            this.codeEditor.refresh();\n        }\n    }\n\n    getData() {\n        return {\n            content: this.codeEditor.getValue()\n        };\n    }\n\n    focus() {\n        this.$editor.focus();\n        this.codeEditor.focus();\n    }\n\n    scrollToEnd() {\n        this.codeEditor.setCursor(this.codeEditor.lineCount(), 0);\n        this.codeEditor.focus();\n    }\n\n    cleanup() {\n        if (this.codeEditor) {\n            this.spacedUpdate.allowUpdateWithoutChange(() => {\n                this.codeEditor.setValue('');\n            });\n        }\n    }\n\n    async executeWithCodeEditorEvent({resolve, ntxId}) {\n        if (!this.isNoteContext(ntxId)) {\n            return;\n        }\n\n        await this.initialized;\n\n        resolve(this.codeEditor);\n    }\n}\n","import TypeWidget from \"./type_widget.js\";\n\nconst TPL = `\n<div class=\"note-detail-readonly-code note-detail-printable\">\n    <style>\n    .note-detail-readonly-code {\n        min-height: 50px;\n        position: relative;\n    }\n    \n    .note-detail-readonly-code-content {\n        padding: 10px;\n    }\n    </style>\n\n    <pre class=\"note-detail-readonly-code-content\"></pre>\n</div>`;\n\nexport default class ReadOnlyCodeTypeWidget extends TypeWidget {\n    static getType() { return \"readOnlyCode\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$content = this.$widget.find('.note-detail-readonly-code-content');\n\n        super.doRender();\n    }\n\n    async doRefresh(note) {\n        let {content} = await this.note.getBlob();\n\n        if (note.type === 'text' && this.noteContext?.viewScope?.viewMode === 'source') {\n            content = this.format(content);\n        }\n\n        this.$content.text(content);\n    }\n\n    async executeWithContentElementEvent({resolve, ntxId}) {\n        if (!this.isNoteContext(ntxId)) {\n            return;\n        }\n\n        await this.initialized;\n\n        resolve(this.$content);\n    }\n\n    format(html) {\n        let indent = '\\n';\n        const tab = '\\t';\n        let i = 0;\n        let pre = [];\n\n        html = html\n            .replace(new RegExp('<pre>((.|\\\\t|\\\\n|\\\\r)+)?</pre>'), function (x) {\n                pre.push({indent: '', tag: x});\n                return '<--TEMPPRE' + i++ + '/-->'\n            })\n            .replace(new RegExp('<[^<>]+>[^<]?', 'g'), function (x) {\n                let ret;\n                let tag = /<\\/?([^\\s/>]+)/.exec(x)[1];\n                let p = new RegExp('<--TEMPPRE(\\\\d+)/-->').exec(x);\n\n                if (p) {\n                    pre[p[1]].indent = indent;\n                }\n\n                if (['area', 'base', 'br', 'col', 'command', 'embed', 'hr', 'img', 'input', 'keygen', 'link', 'menuitem', 'meta', 'param', 'source', 'track', 'wbr'].indexOf(tag) >= 0) { // self closing tag\n                    ret = indent + x;\n                } else {\n                    if (x.indexOf('</') < 0) { //open tag\n                        if (x.charAt(x.length - 1) !== '>') ret = indent + x.substr(0, x.length - 1) + indent + tab + x.substr(x.length - 1, x.length); else ret = indent + x;\n                        !p && (indent += tab);\n                    } else {//close tag\n                        indent = indent.substr(0, indent.length - 1);\n                        if (x.charAt(x.length - 1) !== '>') ret = indent + x.substr(0, x.length - 1) + indent + x.substr(x.length - 1, x.length); else ret = indent + x;\n                    }\n                }\n                return ret;\n            });\n\n        for (i = pre.length; i--;) {\n            html = html.replace('<--TEMPPRE' + i + '/-->', pre[i].tag.replace('<pre>', '<pre>\\n').replace('</pre>', pre[i].indent + '</pre>'));\n        }\n\n        return html.charAt(0) === '\\n' ? html.substr(1, html.length - 1) : html;\n    }\n}\n","import openService from \"../../services/open.js\";\nimport TypeWidget from \"./type_widget.js\";\n\nconst TPL = `\n<div class=\"note-detail-file note-detail-printable\">\n    <style>\n        .type-file .note-detail {\n            height: 100%;\n        }\n        \n        .note-detail-file {\n            padding: 10px;\n            height: 100%;\n        }\n\n        .file-preview-content {\n            background-color: var(--accented-background-color);\n            padding: 15px;\n            height: 100%;\n            overflow: auto;\n            margin: 10px;\n        }\n    </style>\n    \n    <pre class=\"file-preview-content\"></pre>\n    \n    <div class=\"file-preview-not-available alert alert-info\">\n        这种文件格式不支持预览.\n    </div>\n    \n    <iframe class=\"pdf-preview\" style=\"width: 100%; height: 100%; flex-grow: 100;\"></iframe>\n    \n    <video class=\"video-preview\" controls></video>\n    \n    <audio class=\"audio-preview\" controls></audio>\n</div>`;\n\nexport default class FileTypeWidget extends TypeWidget {\n    static getType() { return \"file\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$previewContent = this.$widget.find(\".file-preview-content\");\n        this.$previewNotAvailable = this.$widget.find(\".file-preview-not-available\");\n        this.$pdfPreview = this.$widget.find(\".pdf-preview\");\n        this.$videoPreview = this.$widget.find(\".video-preview\");\n        this.$audioPreview = this.$widget.find(\".audio-preview\");\n\n        super.doRender();\n    }\n\n    async doRefresh(note) {\n        this.$widget.show();\n\n        const blob = await this.note.getBlob();\n\n        this.$previewContent.empty().hide();\n        this.$pdfPreview.attr('src', '').empty().hide();\n        this.$previewNotAvailable.hide();\n        this.$videoPreview.hide();\n        this.$audioPreview.hide();\n\n        if (blob.content) {\n            this.$previewContent.show().scrollTop(0);\n            this.$previewContent.text(blob.content);\n        }\n        else if (note.mime === 'application/pdf') {\n            this.$pdfPreview.show().attr(\"src\", openService.getUrlForDownload(`api/notes/${this.noteId}/open`));\n        }\n        else if (note.mime.startsWith('video/')) {\n            this.$videoPreview\n                .show()\n                .attr(\"src\", openService.getUrlForDownload(`api/notes/${this.noteId}/open-partial`))\n                .attr(\"type\", this.note.mime)\n                .css(\"width\", this.$widget.width());\n        }\n        else if (note.mime.startsWith('audio/')) {\n            this.$audioPreview\n                .show()\n                .attr(\"src\", openService.getUrlForDownload(`api/notes/${this.noteId}/open-partial`))\n                .attr(\"type\", this.note.mime)\n                .css(\"width\", this.$widget.width());\n        }\n        else {\n            this.$previewNotAvailable.show();\n        }\n    }\n\n    async entitiesReloadedEvent({loadResults}) {\n        if (loadResults.isNoteReloaded(this.noteId)) {\n            this.refresh();\n        }\n    }\n}\n","import utils from \"../../services/utils.js\";\nimport TypeWidget from \"./type_widget.js\";\nimport libraryLoader from \"../../services/library_loader.js\";\nimport contextMenu from \"../../menus/context_menu.js\";\nimport imageService from \"../../services/image.js\";\n\nconst TPL = `\n<div class=\"note-detail-image note-detail-printable\">\n    <style>\n        .type-image .note-detail {\n            height: 100%;\n        }\n    \n        .note-detail-image {\n            height: 100%; \n        }\n        \n        .note-detail-image-wrapper {\n            position: relative;\n            display: flex;\n            align-items: center;\n            overflow: hidden;\n            justify-content: center;\n            height: 100%;\n        }\n        \n        .note-detail-image-view {\n            display: block;\n            width: auto;\n            height: auto;\n            align-self: center;\n            flex-shrink: 0;\n        }\n    </style>\n\n    <div class=\"note-detail-image-wrapper\">\n        <img class=\"note-detail-image-view\" />\n    </div>\n</div>`;\n\nclass ImageTypeWidget extends TypeWidget {\n    static getType() { return \"image\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$imageWrapper = this.$widget.find('.note-detail-image-wrapper');\n        this.$imageView = this.$widget.find('.note-detail-image-view')\n            .attr(\"id\", `image-view-${utils.randomString(10)}`);\n\n        libraryLoader.requireLibrary(libraryLoader.WHEEL_ZOOM).then(() => {\n            WZoom.create(`#${this.$imageView.attr(\"id\")}`, {\n                maxScale: 50,\n                speed: 1.3,\n                zoomOnClick: false\n            });\n        });\n\n        if (utils.isElectron()) {\n            // for browser, we want to let the native menu\n            this.$imageView.on('contextmenu', e => {\n                e.preventDefault();\n\n                contextMenu.show({\n                    x: e.pageX,\n                    y: e.pageY,\n                    items: [\n                        {\n                            title: \"复制引用到剪贴板\",\n                            command: \"copyImageReferenceToClipboard\",\n                            uiIcon: \"bx bx-empty\"\n                        },\n                        {title: \"复制图片到剪贴板\", command: \"copyImageToClipboard\", uiIcon: \"bx bx-empty\"},\n                    ],\n                    selectMenuItemHandler: ({command}) => {\n                        if (command === 'copyImageReferenceToClipboard') {\n                            imageService.copyImageReferenceToClipboard(this.$imageWrapper);\n                        } else if (command === 'copyImageToClipboard') {\n                            const webContents = utils.dynamicRequire('@electron/remote').getCurrentWebContents();\n                            utils.dynamicRequire('electron');\n                            webContents.copyImageAt(e.pageX, e.pageY);\n                        } else {\n                            throw new Error(`未识别的命令 '${command}'`);\n                        }\n                    }\n                });\n            });\n        }\n\n        super.doRender();\n    }\n\n    async doRefresh(note) {\n        this.$imageView.prop(\"src\", utils.createImageSrcUrl(note));\n    }\n\n    copyImageReferenceToClipboardEvent({ntxId}) {\n        if (!this.isNoteContext(ntxId)) {\n            return;\n        }\n\n        imageService.copyImageReferenceToClipboard(this.$imageWrapper);\n    }\n\n    async entitiesReloadedEvent({loadResults}) {\n        if (loadResults.isNoteReloaded(this.noteId)) {\n            this.refresh();\n        }\n    }\n}\n\nexport default ImageTypeWidget\n","import TypeWidget from \"./type_widget.js\";\n\nconst TPL = `<div class=\"note-detail-none note-detail-printable\"></div>`;\n\nexport default class NoneTypeWidget extends TypeWidget {\n    static getType() { return \"none\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n\n        super.doRender();\n    }\n}\n","import renderService from \"../../services/render.js\";\nimport TypeWidget from \"./type_widget.js\";\n\nconst TPL = `\n<div class=\"note-detail-render note-detail-printable\">\n    <style>\n        .note-detail-render {\n            position: relative;\n        }\n    </style>\n\n    <div class=\"note-detail-render-help alert alert-warning\" style=\"margin: 50px; padding: 20px;\">\n        <p><strong>之所以显示此帮助说明, 是因为该类型的渲染HTML没有设置好必须的关联关系.</strong></p>\n\n        <p>笔记类型: 渲染HTML 是用来<a class=\"external\" href=\"https://github.com/zadam/trilium/wiki/Scripts\">编写脚本</a>用的. 简单说就是你可以写HTML代码(或者加上一些JavaScript代码), 然后这个笔记会把页面渲染出来. 你得定义一个叫\"renderNote\"的<a class=\"external\" href=\"https://github.com/zadam/trilium/wiki/Attributes\">关系</a>来指向要渲染的HTML笔记.</p>\n    </div>\n\n    <div class=\"note-detail-render-content\"></div>\n</div>`;\n\nexport default class RenderTypeWidget extends TypeWidget {\n    static getType() { return \"render\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$noteDetailRenderHelp = this.$widget.find('.note-detail-render-help');\n        this.$noteDetailRenderContent = this.$widget.find('.note-detail-render-content');\n\n        super.doRender();\n    }\n\n    async doRefresh(note) {\n        this.$widget.show();\n        this.$noteDetailRenderHelp.hide();\n\n        const renderNotesFound = await renderService.render(note, this.$noteDetailRenderContent);\n\n        if (!renderNotesFound) {\n            this.$noteDetailRenderHelp.show();\n        }\n    }\n\n    cleanup() {\n        this.$noteDetailRenderContent.empty();\n    }\n\n    renderActiveNoteEvent() {\n        if (this.noteContext.isActive()) {\n            this.refresh();\n        }\n    }\n\n    async executeWithContentElementEvent({resolve, ntxId}) {\n        if (!this.isNoteContext(ntxId)) {\n            return;\n        }\n\n        await this.initialized;\n\n        resolve(this.$noteDetailRenderContent);\n    }\n}\n","import protectedSessionService from '../../services/protected_session.js';\nimport TypeWidget from \"./type_widget.js\";\n\nconst TPL = `\n<div class=\"protected-session-password-component note-detail-printable\">\n    <style>\n    .protected-session-password-component {\n        width: 300px;\n        margin: 30px auto auto;\n    }\n    </style>\n\n    <form class=\"protected-session-password-form\">\n        <div class=\"form-group\">\n            <label for=\"protected-session-password-in-detail\">查看受保护的笔记需要输入密码:</label>\n            <input class=\"protected-session-password-in-detail form-control protected-session-password\" type=\"password\">\n        </div>\n\n        <button class=\"btn btn-primary\">开始受保护的会话<kbd>回车</kbd></button>\n    </form>\n</div>`;\n\nexport default class ProtectedSessionTypeWidget extends TypeWidget {\n    static getType() { return \"protectedSession\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$passwordForm = this.$widget.find(\".protected-session-password-form\");\n        this.$passwordInput = this.$widget.find(\".protected-session-password\");\n\n        this.$passwordForm.on('submit', () => {\n            const password = this.$passwordInput.val();\n            this.$passwordInput.val(\"\");\n\n            protectedSessionService.setupProtectedSession(password);\n\n            return false;\n        });\n\n        super.doRender();\n    }\n}\n","import TypeWidget from \"./type_widget.js\";\n\nconst TPL = `\n<div class=\"note-detail-book note-detail-printable\">\n    <style>\n    .note-detail-book-auto-help {\n        background-color: var(--accented-background-color);\n        text-align: center;\n        border-radius: 10px;\n        padding: 5px;\n        margin: 0 10px 10px 10px;\n    }\n    </style>\n\n    <div class=\"note-detail-book-empty-help alert alert-warning\" style=\"margin: 50px; padding: 20px;\">\n        这个类型为\"书\"的笔记没有任何子笔记, 所以什么也不显示. 详见 <a href=\"https://github.com/zadam/trilium/wiki/Book-note\">wiki</a>.\n    </div>\n</div>`;\n\nexport default class BookTypeWidget extends TypeWidget {\n    static getType() { return \"book\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$helpNoChildren = this.$widget.find('.note-detail-book-empty-help');\n\n        super.doRender();\n    }\n\n    async doRefresh(note) {\n        this.$helpNoChildren.toggle(!this.note.hasChildren());\n    }\n}\n","import TypeWidget from \"./type_widget.js\";\nimport NoteMapWidget from \"../note_map.js\";\n\nconst TPL = `<div class=\"note-detail-note-map note-detail-printable\"></div>`;\n\nexport default class NoteMapTypeWidget extends TypeWidget {\n    static getType() { return \"noteMap\"; }\n\n    constructor() {\n        super();\n\n        this.noteMapWidget = new NoteMapWidget('type');\n        this.child(this.noteMapWidget);\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$widget.append(this.noteMapWidget.render());\n\n        super.doRender();\n    }\n\n    async doRefresh(note) {\n        await this.noteMapWidget.refresh();\n    }\n}\n","import TypeWidget from \"./type_widget.js\";\nimport attributeService from \"../../services/attributes.js\";\n\nconst TPL = `\n<div class=\"note-detail-web-view note-detail-printable\" style=\"height: 100%\">\n    <div class=\"note-detail-web-view-help alert alert-warning\" style=\"margin: 50px; padding: 20px 20px 0px 20px;\">\n        <h4>网页视图</h4>\n        \n        <p>网页视图类型的笔记允许您将网站嵌入到 Trilium.</p>\n\n        <p>首先, 请创建一个带有您要嵌入的 URL 地址的标签, 例如<code>#webViewSrc=\"https://www.baidu.com\"</code></p>\n\n        <h4>实验性功能免责声明</h4>\n        \n        <p>网页视图是一种实验性笔记类型, 将来可能会被删除或大幅更改. 网页视图只在桌面端有效</p>\n    </div>\n\n    <webview class=\"note-detail-web-view-content\"></webview>\n</div>`;\n\nexport default class WebViewTypeWidget extends TypeWidget {\n    static getType() { return \"webView\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$noteDetailWebViewHelp = this.$widget.find('.note-detail-web-view-help');\n        this.$noteDetailWebViewContent = this.$widget.find('.note-detail-web-view-content');\n\n        window.addEventListener('resize', () => this.setDimensions(), false);\n\n        super.doRender();\n    }\n\n    async doRefresh(note) {\n        this.$widget.show();\n        this.$noteDetailWebViewHelp.hide();\n        this.$noteDetailWebViewContent.hide();\n\n        const webViewSrc = this.note.getLabelValue('webViewSrc');\n\n        if (webViewSrc) {\n            this.$noteDetailWebViewContent\n                .show()\n                .attr(\"src\", webViewSrc);\n        }\n        else {\n            this.$noteDetailWebViewContent.hide();\n            this.$noteDetailWebViewHelp.show();\n        }\n\n        this.setDimensions();\n\n        setTimeout(() => this.setDimensions(), 1000);\n    }\n\n    cleanup() {\n        this.$noteDetailWebViewContent.removeAttribute(\"src\");\n    }\n\n    setDimensions() {\n        const $parent = this.$widget;\n\n        this.$noteDetailWebViewContent\n            .height($parent.height())\n            .width($parent.width());\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.getAttributeRows().find(attr => attr.name === 'webViewSrc' && attributeService.isAffecting(attr, this.noteContext.note))) {\n            this.refresh();\n        }\n    }\n}\n","import TypeWidget from \"./type_widget.js\";\n\nconst TPL = `<div class=\"note-detail-doc note-detail-printable\">\n    <style>\n        .note-detail-doc-content {\n            padding: 15px;\n        }\n        \n        .note-detail-doc-content pre {\n            background-color: var(--accented-background-color);\n            border: 1px solid var(--main-border-color);\n            padding: 15px;\n            border-radius: 5px;\n        }\n    </style>\n    \n    <div class=\"note-detail-doc-content\"></div>\n</div>`;\n\nexport default class DocTypeWidget extends TypeWidget {\n    static getType() { return \"doc\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$content = this.$widget.find('.note-detail-doc-content');\n\n        super.doRender();\n    }\n\n    async doRefresh(note) {\n        const docName = note.getLabelValue('docName');\n\n        if (docName) {\n            this.$content.load(`${window.glob.appPath}/doc_notes/${docName}.html`);\n        } else {\n            this.$content.empty();\n        }\n    }\n}\n","import TypeWidget from \"./type_widget.js\";\nimport AttachmentDetailWidget from \"../attachment_detail.js\";\nimport linkService from \"../../services/link.js\";\nimport froca from \"../../services/froca.js\";\nimport utils from \"../../services/utils.js\";\n\nconst TPL = `\n<div class=\"attachment-detail note-detail-printable\">\n    <style>\n        .attachment-detail {\n            padding-left: 15px;\n            padding-right: 15px;\n            height: 100%;\n            display: flex;\n            flex-direction: column;\n        }\n        \n        .attachment-detail .links-wrapper {\n            font-size: larger;\n            padding: 0 0 16px 0;\n        }\n        \n        .attachment-detail .attachment-wrapper {\n            flex-grow: 1;\n        }\n    </style>\n\n    <div class=\"links-wrapper\"></div>\n\n    <div class=\"attachment-wrapper\"></div>\n</div>`;\n\nexport default class AttachmentDetailTypeWidget extends TypeWidget {\n    static getType() {\n        return \"attachmentDetail\";\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$wrapper = this.$widget.find('.attachment-wrapper');\n        this.$linksWrapper = this.$widget.find('.links-wrapper');\n\n        super.doRender();\n    }\n\n    async doRefresh(note) {\n        this.$wrapper.empty();\n        this.children = [];\n\n        const $helpButton = $('<button class=\"attachment-help-button\" type=\"button\" data-help-page=\"attachments\" title=\"打开附件帮助页面\"><span class=\"bx bx-help-circle\"></span></button>');\n        utils.initHelpButtons($helpButton);\n\n        this.$linksWrapper.empty().append(\n            \"所属笔记: \",\n            await linkService.createLink(this.noteId),\n            \", 你也可以打开 \",\n            await linkService.createLink(this.noteId, {\n                title: '所有附件列表',\n                viewScope: {\n                    viewMode: 'attachments'\n                }\n            }),\n            $helpButton\n        );\n\n        const attachment = await froca.getAttachment(this.attachmentId, true);\n\n        if (!attachment) {\n            this.$wrapper.html(\"<strong>这个附件已被删除</strong>\");\n\n            return;\n        }\n\n        const attachmentDetailWidget = new AttachmentDetailWidget(attachment, true);\n        this.child(attachmentDetailWidget);\n\n        this.$wrapper.append(attachmentDetailWidget.render());\n    }\n\n    async entitiesReloadedEvent({loadResults}) {\n        const attachmentRow = loadResults.getAttachmentRows().find(att => att.attachmentId === this.attachmentId);\n\n        if (attachmentRow?.isDeleted) {\n            this.refresh(); // all other updates are handled within AttachmentDetailWidget\n        }\n    }\n\n    get attachmentId() {\n        return this.noteContext.viewScope.attachmentId;\n    }\n}\n","import TypeWidget from \"./type_widget.js\";\nimport AttachmentDetailWidget from \"../attachment_detail.js\";\nimport linkService from \"../../services/link.js\";\nimport utils from \"../../services/utils.js\";\n\nconst TPL = `\n<div class=\"attachment-list note-detail-printable\">\n    <style>\n        .attachment-list {\n            padding-left: 15px;\n            padding-right: 15px;\n        }\n        \n        .attachment-list .links-wrapper {\n            font-size: larger;\n            margin-bottom: 15px;\n            display: flex;\n            justify-content: space-between;\n            align-items: baseline;\n        }\n    </style>\n    \n    <div class=\"links-wrapper\"></div>\n\n    <div class=\"attachment-list-wrapper\"></div>\n</div>`;\n\nexport default class AttachmentListTypeWidget extends TypeWidget {\n    static getType() {\n        return \"attachmentList\";\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$list = this.$widget.find('.attachment-list-wrapper');\n        this.$linksWrapper = this.$widget.find('.links-wrapper');\n\n        super.doRender();\n    }\n\n    async doRefresh(note) {\n        const $helpButton = $('<button class=\"attachment-help-button\" type=\"button\" data-help-page=\"attachments\" title=\"打开附件帮助页面\"><span class=\"bx bx-help-circle\"></span></button>');\n        utils.initHelpButtons($helpButton);\n\n        const noteLink = await linkService.createLink(this.noteId); // do separately to avoid race condition between empty() and .append()\n\n        this.$linksWrapper.empty().append(\n            $('<div>').append(\n                \"所属笔记: \",\n                noteLink,\n            ),\n            $('<div>').append(\n                $('<button class=\"btn btn-sm\">')\n                    .text(\"上传附件\")\n                    .on('click', () => this.triggerCommand(\"showUploadAttachmentsDialog\", {noteId: this.noteId})),\n                $helpButton\n            )\n        );\n\n        this.$list.empty();\n        this.children = [];\n        this.renderedAttachmentIds = new Set();\n\n        const attachments = await note.getAttachments();\n\n        if (attachments.length === 0) {\n            this.$list.html('<div class=\"alert alert-info\">这个笔记没有附件</div>');\n\n            return;\n        }\n\n        for (const attachment of attachments) {\n            const attachmentDetailWidget = new AttachmentDetailWidget(attachment, false);\n\n            this.child(attachmentDetailWidget);\n\n            this.renderedAttachmentIds.add(attachment.attachmentId);\n\n            this.$list.append(attachmentDetailWidget.render());\n        }\n    }\n\n    async entitiesReloadedEvent({loadResults}) {\n        // updates and deletions are handled by the detail, for new attachments the whole list has to be refreshed\n        const attachmentsAdded = loadResults.getAttachmentRows()\n            .some(att => !this.renderedAttachmentIds.has(att.attachmentId));\n\n        if (attachmentsAdded) {\n            this.refresh();\n        }\n    }\n}\n","import NoteContextAwareWidget from \"../note_context_aware_widget.js\";\nimport keyboardActionsService from \"../../services/keyboard_actions.js\";\nimport attributeService from \"../../services/attributes.js\";\n\nconst TPL = `\n<div class=\"ribbon-container\">\n    <style>\n    .ribbon-container {\n        margin-bottom: 5px;\n    }\n    \n    .ribbon-top-row {\n        display: flex;\n    }\n    \n    .ribbon-tab-container {\n        display: flex;\n        flex-direction: row;\n        justify-content: center;\n        margin-left: 10px;\n        flex-grow: 1;\n        flex-flow: row wrap;\n    }\n    \n    .ribbon-tab-title {\n        color: var(--muted-text-color);\n        border-bottom: 1px solid var(--main-border-color); \n        min-width: 24px;\n        flex-basis: 24px;\n        max-width: max-content;\n        flex-grow: 10;\n    }\n\n    .ribbon-tab-title .bx {\n        font-size: 150%;\n        position: relative;\n        top: 3px;\n    }\n    \n    .ribbon-tab-title.active {\n        color: var(--main-text-color);\n        border-bottom: 3px solid var(--main-text-color);\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n    }\n    \n    .ribbon-tab-title:hover {\n        cursor: pointer;\n    }\n\n    .ribbon-tab-title:hover {\n        color: var(--main-text-color);\n    }\n    \n    .ribbon-tab-title:first-of-type {\n        padding-left: 10px;\n    }\n    \n    .ribbon-tab-spacer {\n        flex-basis: 0;\n        min-width: 0;\n        max-width: 35px;\n        flex-grow: 1;\n        border-bottom: 1px solid var(--main-border-color);\n    }\n        \n    .ribbon-tab-spacer:last-of-type {\n        flex-grow: 1;\n        flex-basis: 0;\n        min-width: 0;\n        max-width: 10000px;\n    }\n    \n    .ribbon-button-container {\n        display: flex;\n        border-bottom: 1px solid var(--main-border-color); \n        margin-right: 5px;\n    }\n    \n    .ribbon-button-container > * {\n        position: relative;\n        top: -3px;\n        margin-left: 10px;\n    }\n    \n    .ribbon-body {\n        display: none;\n        border-bottom: 1px solid var(--main-border-color);\n        margin-left: 10px;\n        margin-right: 5px; /* needs to have this value so that the bottom border is the same width as the top one */\n    }\n    \n    .ribbon-body.active {\n        display: block;\n    }\n    \n    .ribbon-tab-title-label {\n        display: none;\n    }\n    \n    .ribbon-tab-title.active .ribbon-tab-title-label {\n        display: inline;\n    }\n    </style>\n\n    <div class=\"ribbon-top-row\">\n        <div class=\"ribbon-tab-container\"></div>\n        <div class=\"ribbon-button-container\"></div>\n    </div>\n    \n    <div class=\"ribbon-body-container\"></div>\n</div>`;\n\nexport default class RibbonContainer extends NoteContextAwareWidget {\n    constructor() {\n        super();\n\n        this.contentSized();\n        this.ribbonWidgets = [];\n        this.buttonWidgets = [];\n    }\n\n    isEnabled() {\n        return super.isEnabled()\n            && this.noteContext.viewScope.viewMode === 'default';\n    }\n\n    ribbon(widget) {\n        super.child(widget);\n\n        this.ribbonWidgets.push(widget);\n\n        return this;\n    }\n\n    button(widget) {\n        super.child(widget);\n\n        this.buttonWidgets.push(widget);\n\n        return this;\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$tabContainer = this.$widget.find('.ribbon-tab-container');\n        this.$buttonContainer = this.$widget.find('.ribbon-button-container');\n        this.$bodyContainer = this.$widget.find('.ribbon-body-container');\n\n        for (const ribbonWidget of this.ribbonWidgets) {\n            this.$bodyContainer.append(\n                $('<div class=\"ribbon-body\">')\n                    .attr('data-ribbon-component-id', ribbonWidget.componentId)\n                    .append(ribbonWidget.render())\n            );\n        }\n\n        for (const buttonWidget of this.buttonWidgets) {\n            this.$buttonContainer.append(buttonWidget.render());\n        }\n\n        this.$tabContainer.on('click', '.ribbon-tab-title', e => {\n            const $ribbonTitle = $(e.target).closest('.ribbon-tab-title');\n\n            this.toggleRibbonTab($ribbonTitle);\n        });\n    }\n\n    toggleRibbonTab($ribbonTitle, refreshActiveTab = true) {\n        const activate = !$ribbonTitle.hasClass(\"active\");\n\n        this.$tabContainer.find('.ribbon-tab-title').removeClass(\"active\");\n        this.$bodyContainer.find('.ribbon-body').removeClass(\"active\");\n\n        if (activate) {\n            const ribbonComponendId = $ribbonTitle.attr('data-ribbon-component-id');\n\n            const wasAlreadyActive = this.lastActiveComponentId === ribbonComponendId;\n\n            this.lastActiveComponentId = ribbonComponendId;\n\n            this.$tabContainer.find(`.ribbon-tab-title[data-ribbon-component-id=\"${ribbonComponendId}\"]`).addClass(\"active\");\n            this.$bodyContainer.find(`.ribbon-body[data-ribbon-component-id=\"${ribbonComponendId}\"]`).addClass(\"active\");\n\n            const activeChild = this.getActiveRibbonWidget();\n\n            if (activeChild && (refreshActiveTab || !wasAlreadyActive)) {\n                const handleEventPromise = activeChild.handleEvent('noteSwitched', {noteContext: this.noteContext, notePath: this.notePath});\n\n                if (refreshActiveTab) {\n                    if (handleEventPromise) {\n                        handleEventPromise.then(() => activeChild.focus?.());\n                    } else {\n                        activeChild.focus?.();\n                    }\n                }\n            }\n        } else {\n            this.lastActiveComponentId = null;\n        }\n    }\n\n    async noteSwitched() {\n        this.lastActiveComponentId = null;\n\n        await super.noteSwitched();\n    }\n\n    async refreshWithNote(note, noExplicitActivation = false) {\n        this.lastNoteType = note.type;\n\n        let $ribbonTabToActivate, $lastActiveRibbon;\n\n        this.$tabContainer.empty();\n\n        for (const ribbonWidget of this.ribbonWidgets) {\n            const ret = ribbonWidget.getTitle(note);\n\n            if (!ret.show) {\n                continue;\n            }\n\n            const $ribbonTitle = $('<div class=\"ribbon-tab-title\">')\n                .attr('data-ribbon-component-id', ribbonWidget.componentId)\n                .attr('data-ribbon-component-name', ribbonWidget.name)\n                .append($('<span class=\"ribbon-tab-title-icon\">')\n                            .addClass(ret.icon)\n                            .attr(\"data-title\", ret.title)\n                            .attr('data-toggle-command', ribbonWidget.toggleCommand))\n                .append(\" \")\n                .append($('<span class=\"ribbon-tab-title-label\">').text(ret.title));\n\n            this.$tabContainer.append($ribbonTitle);\n            this.$tabContainer.append('<div class=\"ribbon-tab-spacer\">');\n\n            if (ret.activate && !this.lastActiveComponentId && !$ribbonTabToActivate && !noExplicitActivation) {\n                $ribbonTabToActivate = $ribbonTitle;\n            }\n\n            if (this.lastActiveComponentId === ribbonWidget.componentId) {\n                $lastActiveRibbon = $ribbonTitle;\n            }\n        }\n\n        keyboardActionsService.getActions().then(actions => {\n            this.$tabContainer.find('.ribbon-tab-title-icon').tooltip({\n                title: function() {\n                    const toggleCommandName = $(this).attr(\"data-toggle-command\");\n                    const action = actions.find(act => act.actionName === toggleCommandName);\n                    const title = $(this).attr(\"data-title\");\n\n                    if (action && action.effectiveShortcuts.length > 0) {\n                        return `${title} (${action.effectiveShortcuts.join(\", \")})`;\n                    }\n                    else {\n                        return title;\n                    }\n                }\n            });\n        });\n\n        if (!$ribbonTabToActivate) {\n            $ribbonTabToActivate = $lastActiveRibbon;\n        }\n\n        if ($ribbonTabToActivate) {\n            this.toggleRibbonTab($ribbonTabToActivate, false);\n        }\n        else {\n            this.$bodyContainer.find('.ribbon-body').removeClass(\"active\");\n        }\n    }\n\n    isRibbonTabActive(name) {\n        const $ribbonComponent = this.$widget.find(`.ribbon-tab-title[data-ribbon-component-name='${name}']`);\n\n        return $ribbonComponent.hasClass(\"active\");\n    }\n\n    ensureOwnedAttributesAreOpen(ntxId) {\n        if (this.isNoteContext(ntxId) && !this.isRibbonTabActive('ownedAttributes')) {\n            this.toggleRibbonTabWithName('ownedAttributes', ntxId);\n        }\n    }\n\n    addNewLabelEvent({ntxId}) {\n        this.ensureOwnedAttributesAreOpen(ntxId);\n    }\n\n    addNewRelationEvent({ntxId}) {\n        this.ensureOwnedAttributesAreOpen(ntxId);\n    }\n\n    toggleRibbonTabWithName(name, ntxId) {\n        if (!this.isNoteContext(ntxId)) {\n            return false;\n        }\n\n        const $ribbonComponent = this.$widget.find(`.ribbon-tab-title[data-ribbon-component-name='${name}']`);\n\n        if ($ribbonComponent) {\n            this.toggleRibbonTab($ribbonComponent);\n        }\n    }\n\n    handleEvent(name, data) {\n        const PREFIX = \"toggleRibbonTab\";\n\n        if (name.startsWith(PREFIX)) {\n            let componentName = name.substr(PREFIX.length);\n            componentName = componentName[0].toLowerCase() + componentName.substr(1);\n\n            this.toggleRibbonTabWithName(componentName, data.ntxId);\n        }\n        else {\n            return super.handleEvent(name, data);\n        }\n    }\n\n    async handleEventInChildren(name, data) {\n        if (['activeContextChanged', 'setNoteContext'].includes(name)) {\n            // won't trigger .refresh();\n            await super.handleEventInChildren('setNoteContext', data);\n        }\n        else if (this.isEnabled() || name === 'initialRenderComplete') {\n            const activeRibbonWidget = this.getActiveRibbonWidget();\n\n            // forward events only to active ribbon tab, inactive ones don't need to be updated\n            if (activeRibbonWidget) {\n                await activeRibbonWidget.handleEvent(name, data);\n            }\n\n            for (const buttonWidget of this.buttonWidgets) {\n                await buttonWidget.handleEvent(name, data);\n            }\n        }\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.isNoteReloaded(this.noteId) && this.lastNoteType !== this.note.type) {\n            // note type influences the list of available ribbon tabs the most\n            // check for the type is so that we don't update on each title rename\n            this.lastNoteType = this.note.type;\n\n            this.refresh();\n        }\n        else if (loadResults.getAttributeRows(this.componentId).find(attr => attributeService.isAffecting(attr, this.note))) {\n            this.refreshWithNote(this.note, true);\n        }\n    }\n\n    getActiveRibbonWidget() {\n        return this.ribbonWidgets.find(ch => ch.componentId === this.lastActiveComponentId)\n    }\n}\n","import server from \"../../services/server.js\";\nimport ws from \"../../services/ws.js\";\nimport treeService from \"../../services/tree.js\";\nimport noteAutocompleteService from \"../../services/note_autocomplete.js\";\nimport NoteContextAwareWidget from \"../note_context_aware_widget.js\";\nimport attributeService from \"../../services/attributes.js\";\nimport options from \"../../services/options.js\";\nimport utils from \"../../services/utils.js\";\n\nconst TPL = `\n<div class=\"promoted-attributes-widget\">\n    <style>\n    body.mobile .promoted-attributes-widget {\n        /* https://github.com/zadam/trilium/issues/4468 */\n        flex-shrink: 0.4;\n        overflow: auto;\n    }\n    \n    .promoted-attributes-container {\n        margin: auto;\n        display: flex;\n        flex-direction: row;\n        flex-shrink: 0;\n        flex-grow: 0;\n        justify-content: space-evenly;\n        overflow: auto;\n        max-height: 400px;\n        flex-wrap: wrap;\n    }\n    \n    .promoted-attribute-cell {\n        display: flex;\n        align-items: center;\n        margin: 10px;\n    }\n    \n    .promoted-attribute-cell div.input-group {\n        margin-left: 10px;\n    }\n    .promoted-attribute-cell strong {\n        word-break:keep-all;\n        white-space: nowrap;\n    }\n    </style>\n    \n    <div class=\"promoted-attributes-container\"></div>\n</div>`;\n\n/**\n * This widget is quite special because it's used in the desktop ribbon, but in mobile outside of ribbon.\n * This works without many issues (apart from autocomplete), but it should be kept in mind when changing things\n * and testing.\n */\nexport default class PromotedAttributesWidget extends NoteContextAwareWidget {\n    get name() {\n        return \"promotedAttributes\";\n    }\n\n    get toggleCommand() {\n        return \"toggleRibbonTabPromotedAttributes\";\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.contentSized();\n        this.$container = this.$widget.find(\".promoted-attributes-container\");\n    }\n\n    getTitle(note) {\n        const promotedDefAttrs = note.getPromotedDefinitionAttributes();\n\n        if (promotedDefAttrs.length === 0) {\n            return {show: false};\n        }\n\n        return {\n            show: true,\n            activate: options.is('promotedAttributesOpenInRibbon'),\n            title: \"升级属性\",\n            icon: \"bx bx-table\"\n        };\n    }\n\n    async refreshWithNote(note) {\n        this.$container.empty();\n\n        const promotedDefAttrs = note.getPromotedDefinitionAttributes();\n        const ownedAttributes = note.getOwnedAttributes();\n        // attrs are not resorted if position changes after the initial load\n        // promoted attrs are sorted primarily by order of definitions, but with multi-valued promoted attrs\n        // the order of attributes is important as well\n        ownedAttributes.sort((a, b) => a.position - b.position);\n\n        if (promotedDefAttrs.length === 0) {\n            this.toggleInt(false);\n            return;\n        }\n\n        const $cells = [];\n\n        for (const definitionAttr of promotedDefAttrs) {\n            const valueType = definitionAttr.name.startsWith('label:') ? 'label' : 'relation';\n            const valueName = definitionAttr.name.substr(valueType.length + 1);\n\n            let valueAttrs = ownedAttributes.filter(el => el.name === valueName && el.type === valueType);\n\n            if (valueAttrs.length === 0) {\n                valueAttrs.push({\n                    attributeId: \"\",\n                    type: valueType,\n                    name: valueName,\n                    value: \"\"\n                });\n            }\n\n            if (definitionAttr.getDefinition().multiplicity === 'single') {\n                valueAttrs = valueAttrs.slice(0, 1);\n            }\n\n            for (const valueAttr of valueAttrs) {\n                const $cell = await this.createPromotedAttributeCell(definitionAttr, valueAttr, valueName);\n\n                $cells.push($cell);\n            }\n        }\n\n        // we replace the whole content in one step, so there can't be any race conditions\n        // (previously we saw promoted attributes doubling)\n        this.$container.empty().append(...$cells);\n        this.toggleInt(true);\n    }\n\n    async createPromotedAttributeCell(definitionAttr, valueAttr, valueName) {\n        const definition = definitionAttr.getDefinition();\n\n        const $input = $(\"<input>\")\n            .prop(\"tabindex\", 200 + definitionAttr.position)\n            .attr(\"data-attribute-id\", valueAttr.noteId === this.noteId ? valueAttr.attributeId : '') // if not owned, we'll force creation of a new attribute instead of updating the inherited one\n            .attr(\"data-attribute-type\", valueAttr.type)\n            .attr(\"data-attribute-name\", valueAttr.name)\n            .prop(\"value\", valueAttr.value)\n            .addClass(\"form-control\")\n            .addClass(\"promoted-attribute-input\")\n            .on('change', event => this.promotedAttributeChanged(event));\n\n        const $actionCell = $(\"<div>\");\n        const $multiplicityCell = $(\"<td>\")\n            .addClass(\"multiplicity\")\n            .attr(\"nowrap\", true);\n\n        const $wrapper = $('<div class=\"promoted-attribute-cell\" style=\"white-space: nowrap;\">')\n            .append($(\"<strong>\").text(definition.promotedAlias ?? valueName))\n            .append($(\"<div>\").addClass(\"input-group\").append($input))\n            .append($actionCell)\n            .append($multiplicityCell);\n\n        if (valueAttr.type === 'label') {\n            if (definition.labelType === 'text') {\n                $input.prop(\"type\", \"text\");\n\n                // autocomplete for label values is just nice to have, mobile can keep labels editable without autocomplete\n                if (utils.isDesktop()) {\n                    // no need to await for this, can be done asynchronously\n                    server.get(`attribute-values/${encodeURIComponent(valueAttr.name)}`).then(attributeValues => {\n                        if (attributeValues.length === 0) {\n                            return;\n                        }\n\n                        attributeValues = attributeValues.map(attribute => ({value: attribute}));\n\n                        $input.autocomplete({\n                            appendTo: document.querySelector('body'),\n                            hint: false,\n                            autoselect: false,\n                            openOnFocus: true,\n                            minLength: 0,\n                            tabAutocomplete: false\n                        }, [{\n                            displayKey: 'value',\n                            source: function (term, cb) {\n                                term = term.toLowerCase();\n\n                                const filtered = attributeValues.filter(attr => attr.value.toLowerCase().includes(term));\n\n                                cb(filtered);\n                            }\n                        }]);\n\n                        $input.on('autocomplete:selected', e => this.promotedAttributeChanged(e));\n                    });\n                }\n            }\n            else if (definition.labelType === 'number') {\n                $input.prop(\"type\", \"number\");\n\n                let step = 1;\n\n                for (let i = 0; i < (definition.numberPrecision || 0) && i < 10; i++) {\n                    step /= 10;\n                }\n\n                $input.prop(\"step\", step);\n                $input\n                    .css(\"text-align\", \"right\")\n                    .css(\"width\", \"120\");\n            }\n            else if (definition.labelType === 'boolean') {\n                $input.prop(\"type\", \"checkbox\");\n                // hack, without this the checkbox is invisible\n                // we should be using a different bootstrap structure for checkboxes\n                $input.css('width', '80px');\n\n                if (valueAttr.value === \"true\") {\n                    $input.prop(\"checked\", \"checked\");\n                }\n            }\n            else if (definition.labelType === 'date') {\n                $input.prop(\"type\", \"date\");\n            }\n            else if (definition.labelType === 'datetime') {\n                $input.prop('type', 'datetime-local')\n            }\n            else if (definition.labelType === 'url') {\n                $input.prop(\"placeholder\", \"http://website...\");\n\n                const $openButton = $(\"<span>\")\n                    .addClass(\"input-group-text open-external-link-button bx bx-window-open\")\n                    .prop(\"title\", \"Open external link\")\n                    .on('click', () => window.open($input.val(), '_blank'));\n\n                $input.after($(\"<div>\")\n                    .addClass(\"input-group-append\")\n                    .append($openButton));\n            }\n            else {\n                ws.logError(`Unknown labelType '${definitionAttr.labelType}'`);\n            }\n        }\n        else if (valueAttr.type === 'relation') {\n            if (valueAttr.value) {\n                $input.val(await treeService.getNoteTitle(valueAttr.value));\n            }\n\n            if (utils.isDesktop()) {\n                // no need to wait for this\n                noteAutocompleteService.initNoteAutocomplete($input, {allowCreatingNotes: true});\n\n                $input.on('autocomplete:noteselected', (event, suggestion, dataset) => {\n                    this.promotedAttributeChanged(event);\n                });\n\n                $input.setSelectedNotePath(valueAttr.value);\n            } else {\n                // we can't provide user a way to edit the relation so make it read only\n                $input.attr(\"readonly\", \"readonly\");\n            }\n        }\n        else {\n            ws.logError(`Unknown attribute type '${valueAttr.type}'`);\n            return;\n        }\n\n        if (definition.multiplicity === \"multi\") {\n            const $addButton = $(\"<span>\")\n                .addClass(\"bx bx-plus pointer\")\n                .prop(\"title\", \"Add new attribute\")\n                .on('click', async () => {\n                    const $new = await this.createPromotedAttributeCell(definitionAttr, {\n                        attributeId: \"\",\n                        type: valueAttr.type,\n                        name: valueName,\n                        value: \"\"\n                    }, valueName);\n\n                    $wrapper.after($new);\n\n                    $new.find('input').trigger('focus');\n                });\n\n            const $removeButton = $(\"<span>\")\n                .addClass(\"bx bx-trash pointer\")\n                .prop(\"title\", \"Remove this attribute\")\n                .on('click', async () => {\n                    const attributeId = $input.attr(\"data-attribute-id\");\n\n                    if (attributeId) {\n                        await server.remove(`notes/${this.noteId}/attributes/${attributeId}`, this.componentId);\n                    }\n\n                    // if it's the last one the create new empty form immediately\n                    const sameAttrSelector = `input[data-attribute-type='${valueAttr.type}'][data-attribute-name='${valueName}']`;\n\n                    if (this.$widget.find(sameAttrSelector).length <= 1) {\n                        const $new = await this.createPromotedAttributeCell(definitionAttr, {\n                            attributeId: \"\",\n                            type: valueAttr.type,\n                            name: valueName,\n                            value: \"\"\n                        }, valueName);\n\n                        $wrapper.after($new);\n                    }\n\n                    $wrapper.remove();\n                });\n\n            $multiplicityCell\n                .append(\" &nbsp;\")\n                .append($addButton)\n                .append(\" &nbsp;\")\n                .append($removeButton);\n        }\n\n        return $wrapper;\n    }\n\n    async promotedAttributeChanged(event) {\n        const $attr = $(event.target);\n\n        let value;\n\n        if ($attr.prop(\"type\") === \"checkbox\") {\n            value = $attr.is(':checked') ? \"true\" : \"false\";\n        }\n        else if ($attr.attr(\"data-attribute-type\") === \"relation\") {\n            const selectedPath = $attr.getSelectedNotePath();\n\n            value = selectedPath ? treeService.getNoteIdFromUrl(selectedPath) : \"\";\n        }\n        else {\n            value = $attr.val();\n        }\n\n        const result = await server.put(`notes/${this.noteId}/attribute`, {\n            attributeId: $attr.attr(\"data-attribute-id\"),\n            type: $attr.attr(\"data-attribute-type\"),\n            name: $attr.attr(\"data-attribute-name\"),\n            value: value\n        }, this.componentId);\n\n        $attr.attr(\"data-attribute-id\", result.attributeId);\n    }\n\n    focus() {\n        this.$widget.find(\".promoted-attribute-input:first\").focus();\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.getAttributeRows(this.componentId).find(attr => attributeService.isAffecting(attr, this.note))) {\n            this.refresh();\n        }\n    }\n}\n","import NoteContextAwareWidget from \"../note_context_aware_widget.js\";\nimport AttributeDetailWidget from \"../attribute_widgets/attribute_detail.js\";\nimport attributeRenderer from \"../../services/attribute_renderer.js\";\nimport attributeService from \"../../services/attributes.js\";\n\nconst TPL = `\n<div class=\"inherited-attributes-widget\">\n    <style>\n    .inherited-attributes-widget {\n        position: relative;\n    }\n    \n    .inherited-attributes-container {\n        color: var(--muted-text-color);\n        max-height: 200px;\n        overflow: auto;\n        padding: 14px 12px 13px 12px;\n    }\n    </style>\n\n    <div class=\"inherited-attributes-container\"></div>\n</div>`;\n\nexport default class InheritedAttributesWidget extends NoteContextAwareWidget {\n    get name() {\n        return \"inheritedAttributes\";\n    }\n\n    get toggleCommand() {\n        return \"toggleRibbonTabInheritedAttributes\";\n    }\n\n    constructor() {\n        super();\n\n        /** @type {AttributeDetailWidget} */\n        this.attributeDetailWidget = new AttributeDetailWidget()\n            .contentSized()\n            .setParent(this);\n\n        this.child(this.attributeDetailWidget);\n    }\n\n    getTitle() {\n        return {\n            show: !this.note.isLaunchBarConfig(),\n            title: \"继承的属性\",\n            icon: \"bx bx-list-plus\"\n        };\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.contentSized();\n\n        this.$container = this.$widget.find('.inherited-attributes-container');\n        this.$widget.append(this.attributeDetailWidget.render());\n    }\n\n    async refreshWithNote(note) {\n        this.$container.empty();\n\n        const inheritedAttributes = this.getInheritedAttributes(note);\n\n        if (inheritedAttributes.length === 0) {\n            this.$container.append(\"没有继承的属性.\");\n            return;\n        }\n\n        for (const attribute of inheritedAttributes) {\n            const $attr = (await attributeRenderer.renderAttribute(attribute, false))\n                .on('click', e => {\n                    setTimeout(() =>\n                        this.attributeDetailWidget.showAttributeDetail({\n                            attribute: {\n                                noteId: attribute.noteId,\n                                type: attribute.type,\n                                name: attribute.name,\n                                value: attribute.value,\n                                isInheritable: attribute.isInheritable\n                            },\n                            isOwned: false,\n                            x: e.pageX,\n                            y: e.pageY\n                        }), 100);\n                });\n\n            this.$container\n                .append($attr)\n                .append(\" \");\n        }\n    }\n\n    getInheritedAttributes(note) {\n        const attrs = note.getAttributes().filter(attr => attr.noteId !== this.noteId);\n\n        attrs.sort((a, b) => {\n            if (a.noteId === b.noteId) {\n                return a.position - b.position;\n            } else {\n                // inherited attributes should stay grouped: https://github.com/zadam/trilium/issues/3761\n                return a.noteId < b.noteId ? -1 : 1;\n            }\n        });\n\n        return attrs;\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.getAttributeRows(this.componentId).find(attr => attributeService.isAffecting(attr, this.note))) {\n            this.refresh();\n        }\n    }\n}\n","import linkService from \"./link.js\";\nimport contentRenderer from \"./content_renderer.js\";\nimport froca from \"./froca.js\";\nimport attributeRenderer from \"./attribute_renderer.js\";\nimport libraryLoader from \"./library_loader.js\";\nimport treeService from \"./tree.js\";\n\nconst TPL = `\n<div class=\"note-list\">\n    <style>\n    .note-list {\n        overflow: hidden;\n        position: relative;\n        height: 100%;\n    }\n\n    .note-list.grid-view .note-list-container {\n        display: flex;\n        flex-wrap: wrap;\n    }\n\n    .note-list.grid-view .note-book-card {\n        flex-basis: 300px;\n        border: 1px solid transparent;\n    }\n\n    .note-list.grid-view .note-expander {\n        display: none;\n    }\n\n    .note-list.grid-view .note-book-card {\n        max-height: 300px;\n    }\n    \n    .note-list.grid-view .note-book-card img {\n        max-height: 220px;\n        object-fit: contain;\n    }\n\n    .note-list.grid-view .note-book-card:hover {\n        cursor: pointer;\n        border: 1px solid var(--main-border-color);\n        background: var(--more-accented-background-color);\n    }\n\n    .note-book-card {\n        border-radius: 10px;\n        background-color: var(--accented-background-color);\n        padding: 10px 15px 15px 8px;\n        margin: 5px 5px 5px 5px;\n        overflow: hidden;\n        display: flex;\n        flex-direction: column;\n        flex-shrink: 0;\n        flex-grow: 1;\n    }\n\n    .note-book-card:not(.expanded) .note-book-content {\n        display: none !important;\n        padding: 10px\n    }\n\n    .note-book-card.expanded .note-book-content {\n        display: block;\n        min-height: 0;\n        height: 100%;\n        padding-top: 10px;\n    }\n\n    .note-book-content .rendered-content {\n        height: 100%;\n    }\n\n    .note-book-header {\n        border-bottom: 1px solid var(--main-border-color);\n        margin-bottom: 0;\n        padding-bottom: .5rem;\n        word-break: break-all;\n    }\n\n    /* not-expanded title is limited to one line only */\n    .note-book-card:not(.expanded) .note-book-header {\n        overflow: hidden;\n        white-space: nowrap;\n        text-overflow: ellipsis;\n    }\n\n    .note-book-header .rendered-note-attributes {\n        font-size: medium;\n    }\n\n    .note-book-header .rendered-note-attributes:before {\n        content: \"\\\\00a0\\\\00a0\";\n    }\n\n    .note-book-header .note-icon {\n        font-size: 100%;\n        display: inline-block;\n        padding-right: 7px;\n        position: relative;\n    }\n\n    .note-book-card .note-book-card {\n        border: 1px solid var(--main-border-color);\n    }\n\n    .note-book-content.type-image, .note-book-content.type-file, .note-book-content.type-protectedSession {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        text-align: center;\n        padding: 10px;\n    }\n\n    .note-book-content.type-image img, .note-book-content.type-canvas svg {\n        max-width: 100%;\n        max-height: 100%;\n        object-fit: contain;\n    }\n\n    .note-book-card.type-image .note-book-content img,\n    .note-book-card.type-text .note-book-content img,\n    .note-book-card.type-canvas .note-book-content img {\n        max-width: 100%;\n        max-height: 100%;\n    }\n\n    .note-book-header {\n        flex-grow: 0;\n    }\n\n    .note-list-wrapper {\n        height: 100%;\n        overflow: auto;\n    }\n\n    .note-expander {\n        font-size: x-large;\n        position: relative;\n        top: 3px;\n        cursor: pointer;\n    }\n\n    .note-list-pager {\n        text-align: center;\n    }\n    </style>\n\n    <div class=\"note-list-wrapper\">\n        <div class=\"note-list-pager\"></div>\n\n        <div class=\"note-list-container\"></div>\n\n        <div class=\"note-list-pager\"></div>\n    </div>\n</div>`;\n\nclass NoteListRenderer {\n    /*\n     * We're using noteIds so that it's not necessary to load all notes at once when paging\n     */\n    constructor($parent, parentNote, noteIds, showNotePath = false) {\n        this.$noteList = $(TPL);\n\n        // note list must be added to the DOM immediately, otherwise some functionality scripting (canvas) won't work\n        $parent.empty();\n\n        this.parentNote = parentNote;\n        const includedNoteIds = this.getIncludedNoteIds();\n\n        this.noteIds = noteIds.filter(noteId => !includedNoteIds.has(noteId) && noteId !== '_hidden');\n\n        if (this.noteIds.length === 0) {\n            return;\n        }\n\n        $parent.append(this.$noteList);\n\n        this.page = 1;\n        this.pageSize = parseInt(parentNote.getLabelValue('pageSize'));\n\n        if (!this.pageSize || this.pageSize < 1) {\n            this.pageSize = 20;\n        }\n\n        this.viewType = parentNote.getLabelValue('viewType');\n\n        if (!['list', 'grid'].includes(this.viewType)) {\n            // when not explicitly set, decide based on the note type\n            this.viewType = parentNote.type === 'search' ? 'list' : 'grid';\n        }\n\n        this.$noteList.addClass(`${this.viewType}-view`);\n\n        this.showNotePath = showNotePath;\n    }\n\n    /** @returns {Set<string>} list of noteIds included (images, included notes) in the parent note and which\n     *                        don't have to be shown in the note list. */\n    getIncludedNoteIds() {\n        const includedLinks = this.parentNote\n            ? this.parentNote.getRelations().filter(rel => rel.name === 'imageLink' || rel.name === 'includeNoteLink')\n            : [];\n\n        return new Set(includedLinks.map(rel => rel.value));\n    }\n\n    async renderList() {\n        if (this.noteIds.length === 0) {\n            this.$noteList.hide();\n            return;\n        }\n\n        const highlightedTokens = this.parentNote.highlightedTokens || [];\n        if (highlightedTokens.length > 0) {\n            await libraryLoader.requireLibrary(libraryLoader.MARKJS);\n\n            this.highlightRegex = new RegExp(highlightedTokens.join(\"|\"), 'gi');\n        } else {\n            this.highlightRegex = null;\n        }\n\n        this.$noteList.show();\n\n        const $container = this.$noteList.find('.note-list-container').empty();\n\n        const startIdx = (this.page - 1) * this.pageSize;\n        const endIdx = startIdx + this.pageSize;\n\n        const pageNoteIds = this.noteIds.slice(startIdx, Math.min(endIdx, this.noteIds.length));\n        const pageNotes = await froca.getNotes(pageNoteIds);\n\n        for (const note of pageNotes) {\n            const $card = await this.renderNote(note, this.parentNote.isLabelTruthy('expanded'));\n\n            $container.append($card);\n        }\n\n        this.renderPager();\n\n        return this.$noteList;\n    }\n\n    renderPager() {\n        const $pager = this.$noteList.find('.note-list-pager').empty();\n        const pageCount = Math.ceil(this.noteIds.length / this.pageSize);\n\n        $pager.toggle(pageCount > 1);\n\n        let lastPrinted;\n\n        for (let i = 1; i <= pageCount; i++) {\n            if (pageCount < 20 || i <= 5 || pageCount - i <= 5 || Math.abs(this.page - i) <= 2) {\n                lastPrinted = true;\n\n                const startIndex = (i - 1) * this.pageSize + 1;\n                const endIndex = Math.min(this.noteIds.length, i * this.pageSize);\n\n                $pager.append(\n                    i === this.page\n                        ? $('<span>').text(i).css('text-decoration', 'underline').css('font-weight', \"bold\")\n                        : $('<a href=\"javascript:\">')\n                            .text(i)\n                            .attr(\"title\", `Page of ${startIndex} - ${endIndex}`)\n                            .on('click', () => {\n                                this.page = i;\n                                this.renderList();\n                            }),\n                    \" &nbsp; \"\n                );\n            }\n            else if (lastPrinted) {\n                $pager.append(\"... &nbsp; \");\n\n                lastPrinted = false;\n            }\n        }\n\n        // no need to distinguish \"note\" vs \"notes\" since in case of one result, there's no paging at all\n        $pager.append(`<span class=\"note-list-pager-total-count\">(${this.noteIds.length} notes)</span>`);\n    }\n\n    async renderNote(note, expand = false) {\n        const $expander = $('<span class=\"note-expander bx bx-chevron-right\"></span>');\n\n        const {$renderedAttributes} = await attributeRenderer.renderNormalAttributes(note);\n        const notePath = this.parentNote.type === 'search'\n            ? note.noteId // for search note parent, we want to display a non-search path\n            : `${this.parentNote.noteId}/${note.noteId}`;\n\n        const $card = $('<div class=\"note-book-card\">')\n            .attr('data-note-id', note.noteId)\n            .append(\n                $('<h5 class=\"note-book-header\">')\n                    .append($expander)\n                    .append($('<span class=\"note-icon\">').addClass(note.getIcon()))\n                    .append(this.viewType === 'grid'\n                        ? $('<span class=\"note-book-title\">').text(await treeService.getNoteTitle(note.noteId, this.parentNote.noteId))\n                        : (await linkService.createLink(notePath, {showTooltip: false, showNotePath: this.showNotePath}))\n                            .addClass(\"note-book-title\")\n                    )\n                    .append($renderedAttributes)\n            );\n\n        if (this.viewType === 'grid') {\n            $card\n                .addClass(\"block-link\")\n                .attr(\"data-href\", `#${notePath}`)\n                .on('click', e => linkService.goToLink(e));\n        }\n\n        $expander.on('click', () => this.toggleContent($card, note, !$card.hasClass(\"expanded\")));\n\n        if (this.highlightRegex) {\n            $card.find(\".note-book-title\").markRegExp(this.highlightRegex, {\n                element: \"span\",\n                className: \"ck-find-result\",\n                separateWordSearch: false,\n                caseSensitive: false\n            });\n        }\n\n        await this.toggleContent($card, note, expand);\n\n        return $card;\n    }\n\n    async toggleContent($card, note, expand) {\n        if (this.viewType === 'list' && ((expand && $card.hasClass(\"expanded\")) || (!expand && !$card.hasClass(\"expanded\")))) {\n            return;\n        }\n\n        const $expander = $card.find('> .note-book-header .note-expander');\n\n        if (expand || this.viewType === 'grid') {\n            $card.addClass(\"expanded\");\n            $expander.addClass(\"bx-chevron-down\").removeClass(\"bx-chevron-right\");\n        }\n        else {\n            $card.removeClass(\"expanded\");\n            $expander.addClass(\"bx-chevron-right\").removeClass(\"bx-chevron-down\");\n        }\n\n        if ((expand || this.viewType === 'grid') && $card.find('.note-book-content').length === 0) {\n            $card.append(await this.renderNoteContent(note));\n        }\n    }\n\n    async renderNoteContent(note) {\n        const $content = $('<div class=\"note-book-content\">');\n\n        try {\n            const {$renderedContent, type} = await contentRenderer.getRenderedContent(note, {\n                trim: this.viewType === 'grid' // for grid only short content is needed\n            });\n\n            if (this.highlightRegex) {\n                $renderedContent.markRegExp(this.highlightRegex, {\n                    element: \"span\",\n                    className: \"ck-find-result\",\n                    separateWordSearch: false,\n                    caseSensitive: false\n                });\n            }\n\n            $content.append($renderedContent);\n            $content.addClass(`type-${type}`);\n        } catch (e) {\n            console.log(`Caught error while rendering note '${note.noteId}' of type '${note.type}': ${e.message}, stack: ${e.stack}`);\n\n            $content.append(\"rendering error\");\n        }\n\n        if (this.viewType === 'list') {\n            const imageLinks = note.getRelations('imageLink');\n\n            const childNotes = (await note.getChildNotes())\n                .filter(childNote => !imageLinks.find(rel => rel.value === childNote.noteId));\n\n            for (const childNote of childNotes) {\n                $content.append(await this.renderNote(childNote));\n            }\n        }\n\n        return $content;\n    }\n}\n\nexport default NoteListRenderer;\n","import NoteContextAwareWidget from \"./note_context_aware_widget.js\";\nimport NoteListRenderer from \"../services/note_list_renderer.js\";\n\nconst TPL = `\n<div class=\"note-list-widget\">\n    <style>\n    .note-list-widget {\n        min-height: 0;\n        overflow: auto;\n    }\n    \n    .note-list-widget .note-list {\n        padding: 10px;\n    }\n    </style>\n    \n    <div class=\"note-list-widget-content\">\n    </div>\n</div>`;\n\nexport default class NoteListWidget extends NoteContextAwareWidget {\n    isEnabled() {\n        return super.isEnabled() && this.noteContext.hasNoteList();\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.contentSized();\n        this.$content = this.$widget.find('.note-list-widget-content');\n\n        const observer = new IntersectionObserver(entries => {\n            this.isIntersecting = entries[0].isIntersecting;\n\n            this.checkRenderStatus();\n        }, {\n            rootMargin: '50px',\n            threshold: 0.1\n        });\n\n        // there seems to be a race condition on Firefox which triggers the observer only before the widget is visible\n        // (intersection is false). https://github.com/zadam/trilium/issues/4165\n        setTimeout(() => observer.observe(this.$widget[0]), 10);\n    }\n\n    checkRenderStatus() {\n        // console.log(\"this.isIntersecting\", this.isIntersecting);\n        // console.log(`${this.noteIdRefreshed} === ${this.noteId}`, this.noteIdRefreshed === this.noteId);\n        // console.log(\"this.shownNoteId !== this.noteId\", this.shownNoteId !== this.noteId);\n\n        if (this.isIntersecting\n            && this.noteIdRefreshed === this.noteId\n            && this.shownNoteId !== this.noteId) {\n\n            this.shownNoteId = this.noteId;\n            this.renderNoteList(this.note);\n        }\n    }\n\n    async renderNoteList(note) {\n        const noteListRenderer = new NoteListRenderer(this.$content, note, note.getChildNoteIds());\n        await noteListRenderer.renderList();\n    }\n\n    async refresh() {\n        this.shownNoteId = null;\n\n        await super.refresh();\n    }\n\n    async refreshNoteListEvent({noteId}) {\n        if (this.isNote(noteId)) {\n            await this.renderNoteList(this.note);\n        }\n    }\n\n    /**\n     * We have this event so that we evaluate intersection only after note detail is loaded.\n     * If it's evaluated before note detail, then it's clearly intersected (visible) although after note detail load\n     * it is not intersected (visible) anymore.\n     */\n    noteDetailRefreshedEvent({ntxId}) {\n        if (!this.isNoteContext(ntxId)) {\n            return;\n        }\n\n        this.noteIdRefreshed = this.noteId;\n\n        setTimeout(() => this.checkRenderStatus(), 100);\n    }\n\n    notesReloadedEvent({noteIds}) {\n        if (noteIds.includes(this.noteId)) {\n            this.refresh();\n        }\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.getAttributeRows().find(attr => attr.noteId === this.noteId && ['viewType', 'expanded', 'pageSize'].includes(attr.name))) {\n            this.shownNoteId = null; // force render\n\n            this.checkRenderStatus();\n        }\n    }\n}\n","import server from \"../../services/server.js\";\nimport ws from \"../../services/ws.js\";\nimport Component from \"../../components/component.js\";\nimport utils from \"../../services/utils.js\";\n\nexport default class AbstractSearchOption extends Component {\n    constructor(attribute, note) {\n        super();\n\n        this.attribute = attribute;\n        this.note = note;\n    }\n\n    static async setAttribute(noteId, type, name, value = '') {\n        await server.put(`notes/${noteId}/set-attribute`, { type, name, value });\n\n        await ws.waitForMaxKnownEntityChangeId();\n    }\n\n    async setAttribute(type, name, value = '') {\n        await this.constructor.setAttribute(this.note.noteId, type, name, value);\n    }\n\n    render() {\n        try {\n            const $rendered = this.doRender();\n\n            $rendered.find('.search-option-del')\n                .on('click', () => this.deleteOption())\n                .attr('title', '去掉这个搜索选项');\n\n            utils.initHelpDropdown($rendered);\n\n            return $rendered;\n        }\n        catch (e) {\n            logError(`渲染搜索选项 ${JSON.stringify(this.attribute.dto)} 失败, 错误: ${e.message} ${e.stack}`);\n            return null;\n        }\n    }\n\n    // to be overridden\n    doRender() {}\n\n    async deleteOption() {\n        await this.deleteAttribute(this.constructor.attributeType, this.constructor.optionName);\n\n        await ws.waitForMaxKnownEntityChangeId();\n\n        await this.triggerCommand('refreshSearchDefinition');\n    }\n\n    async deleteAttribute(type, name) {\n        for (const attr of this.note.getOwnedAttributes()) {\n            if (attr.type === type && attr.name === name) {\n                await server.remove(`notes/${this.note.noteId}/attributes/${attr.attributeId}`);\n            }\n        }\n    }\n}\n","import server from \"../../services/server.js\";\nimport ws from \"../../services/ws.js\";\nimport utils from \"../../services/utils.js\";\n\nexport default class AbstractBulkAction {\n    constructor(attribute, actionDef) {\n        this.attribute = attribute;\n        this.actionDef = actionDef;\n    }\n\n    render() {\n        try {\n            const $rendered = this.doRender();\n\n            $rendered.find('.action-conf-del')\n                .on('click', () => this.deleteAction())\n                .attr('title', '去掉这个搜索动作');\n\n            utils.initHelpDropdown($rendered);\n\n            return $rendered;\n        }\n        catch (e) {\n            logError(`Failed rendering search action: ${JSON.stringify(this.attribute.dto)} with error: ${e.message} ${e.stack}`);\n            return null;\n        }\n    }\n\n    // to be overridden\n    doRender() {}\n\n    async saveAction(data) {\n        const actionObject = Object.assign({ name: this.constructor.actionName }, data);\n\n        await server.put(`notes/${this.attribute.noteId}/attribute`, {\n            attributeId: this.attribute.attributeId,\n            type: 'label',\n            name: 'action',\n            value: JSON.stringify(actionObject)\n        });\n\n        await ws.waitForMaxKnownEntityChangeId();\n    }\n\n    async deleteAction() {\n        await server.remove(`notes/${this.attribute.noteId}/attributes/${this.attribute.attributeId}`);\n\n        await ws.waitForMaxKnownEntityChangeId();\n\n        //await this.triggerCommand('refreshSearchDefinition');\n    }\n}\n","import SpacedUpdate from \"../../../services/spaced_update.js\";\nimport AbstractBulkAction from \"../abstract_bulk_action.js\";\nimport noteAutocompleteService from \"../../../services/note_autocomplete.js\";\n\nconst TPL = `\n<tr>\n    <td colspan=\"2\">\n        <div style=\"display: flex; align-items: center\">\n            <div style=\"margin-right: 10px;\" class=\"text-nowrap\">移动笔记</div> \n                            \n            <div style=\"margin-right: 10px;\" class=\"text-nowrap\">到</div>\n            \n            <div class=\"input-group\">\n                <input type=\"text\" class=\"form-control target-parent-note\" placeholder=\"目标父笔记\"/>\n            </div>\n        </div>\n    </td>\n    <td class=\"button-column\">\n        <div class=\"dropdown help-dropdown\">\n            <span class=\"bx bx-help-circle icon-action\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"></span>\n            <div class=\"dropdown-menu dropdown-menu-right p-4\">\n                <p>对于所有匹配的笔记:</p>\n                \n                <ul>\n                    <li>如果笔记只有一个父级, 则将笔记移动到新父级(旧笔记删除, 新笔记被创建到新的父级笔记下)</li>\n                    <li>如果笔记有多个克隆, 则将笔记克隆到新父级(因为不清楚应该删除哪个)</li>\n                    <li>如果无法将笔记移动到目标笔记, 什么也不做(防止形成循环树)</li>\n                </ul>\n            </div> \n        </div>\n    \n        <span class=\"bx bx-x icon-action action-conf-del\"></span>\n    </td>\n</tr>`;\n\nexport default class MoveNoteBulkAction extends AbstractBulkAction {\n    static get actionName() { return \"moveNote\"; }\n    static get actionTitle() { return \"移动笔记\"; }\n\n    doRender() {\n        const $action = $(TPL);\n\n        const $targetParentNote = $action.find('.target-parent-note');\n        noteAutocompleteService.initNoteAutocomplete($targetParentNote);\n        $targetParentNote.setNote(this.actionDef.targetParentNoteId);\n\n        $targetParentNote.on('autocomplete:closed', () => spacedUpdate.scheduleUpdate());\n\n        const spacedUpdate = new SpacedUpdate(async () => {\n            await this.saveAction({\n                targetParentNoteId: $targetParentNote.getSelectedNoteId()\n            });\n        }, 1000)\n\n        $targetParentNote.on('input', () => spacedUpdate.scheduleUpdate());\n\n        return $action;\n    }\n}\n","import AbstractBulkAction from \"../abstract_bulk_action.js\";\n\nconst TPL = `\n<tr>\n    <td colspan=\"2\">\n        <span class=\"bx bx-trash\"></span>\n    \n        删除匹配的笔记\n    </td>\n    <td class=\"button-column\">\n        <div class=\"dropdown help-dropdown\">\n            <span class=\"bx bx-help-circle icon-action\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"></span>\n            <div class=\"dropdown-menu dropdown-menu-right p-4\">\n                <p>这会删除匹配的笔记</p>\n                 \n                <p>删除后,可以取消删除<span class=\"bx bx-history\"></span>最近的笔记对话框.</p>\n                \n                <p>要永久删除笔记,您可以在删除后转到选项 -> 其他,然后单击\"立即删除已删除的笔记\"按钮.</p>\n            </div>\n        </div>\n        \n        <span class=\"bx bx-x icon-action action-conf-del\"></span>\n    </td>\n</tr>`;\n\nexport default class DeleteNoteBulkAction extends AbstractBulkAction {\n    static get actionName() { return \"deleteNote\"; }\n    static get actionTitle() { return \"删除笔记\"; }\n\n    doRender() {\n        return $(TPL);\n    }\n}\n","import AbstractBulkAction from \"../abstract_bulk_action.js\";\n\nconst TPL = `\n<tr>\n    <td colspan=\"2\">\n        <span class=\"bx bx-trash\"></span>\n    \n        删除笔记历史版本\n    </td>\n    <td class=\"button-column\">\n        <div class=\"dropdown help-dropdown\">\n            <span class=\"bx bx-help-circle icon-action\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"></span>\n            <div class=\"dropdown-menu dropdown-menu-right p-4\">\n                匹配的笔记的所有历史版本都会被删除, 笔记本身会被保留.\n            </div>\n        </div>\n    \n        <span class=\"bx bx-x icon-action action-conf-del\"></span>\n    </td>\n</tr>`;\n\nexport default class DeleteRevisionsBulkAction extends AbstractBulkAction {\n    static get actionName() { return \"deleteRevisions\"; }\n    static get actionTitle() { return \"删除笔记历史版本\"; }\n\n    doRender() {\n        return $(TPL);\n    }\n}\n","import SpacedUpdate from \"../../../services/spaced_update.js\";\nimport AbstractBulkAction from \"../abstract_bulk_action.js\";\n\nconst TPL = `\n<tr>\n    <td>\n        删除标签:\n    </td>\n    <td>\n        <input type=\"text\" \n           class=\"form-control label-name\"\n           pattern=\"[\\\\p{L}\\\\p{N}_:]+\"\n           title=\"允许使用字母数字字符,下划线和冒号.\"\n           placeholder=\"标签名称\"/>\n    </td>\n    <td class=\"button-column\">\n        <span class=\"bx bx-x icon-action action-conf-del\"></span>\n    </td>\n</tr>`;\n\nexport default class DeleteLabelBulkAction extends AbstractBulkAction {\n    static get actionName() { return \"deleteLabel\"; }\n    static get actionTitle() { return \"删除标签\"; }\n\n    doRender() {\n        const $action = $(TPL);\n        const $labelName = $action.find('.label-name');\n        $labelName.val(this.actionDef.labelName || \"\");\n\n        const spacedUpdate = new SpacedUpdate(async () => {\n            await this.saveAction({ labelName: $labelName.val() });\n        }, 1000)\n\n        $labelName.on('input', () => spacedUpdate.scheduleUpdate());\n\n        return $action;\n    }\n}\n","import SpacedUpdate from \"../../../services/spaced_update.js\";\nimport AbstractBulkAction from \"../abstract_bulk_action.js\";\n\nconst TPL = `\n<tr>\n    <td>\n        删除关系:\n    </td>\n    <td>\n        <div style=\"display: flex; align-items: center\">\n            <input type=\"text\" \n                class=\"form-control relation-name\"                    \n                pattern=\"[\\\\p{L}\\\\p{N}_:]+\"\n                placeholder=\"关系名称\"\n                title=\"允许使用字母数字字符,下划线和冒号.\"/>\n        </div>\n    </td>\n    <td class=\"button-column\">\n        <span class=\"bx bx-x icon-action action-conf-del\"></span>\n    </td>\n</tr>`;\n\nexport default class DeleteRelationBulkAction extends AbstractBulkAction {\n    static get actionName() { return \"deleteRelation\"; }\n    static get actionTitle() { return \"删除关系\"; }\n\n    doRender() {\n        const $action = $(TPL);\n        const $relationName = $action.find('.relation-name');\n        $relationName.val(this.actionDef.relationName || \"\");\n\n        const spacedUpdate = new SpacedUpdate(async () => {\n            await this.saveAction({ relationName: $relationName.val() });\n        }, 1000)\n\n        $relationName.on('input', () => spacedUpdate.scheduleUpdate());\n\n        return $action;\n    }\n}\n","import SpacedUpdate from \"../../../services/spaced_update.js\";\nimport AbstractBulkAction from \"../abstract_bulk_action.js\";\n\nconst TPL = `\n<tr>\n    <td colspan=\"2\">\n        <div style=\"display: flex; align-items: center\">\n            <div style=\"margin-right: 10px; flex-shrink: 0;\">重命名标签由:</div> \n            \n            <input type=\"text\" \n                class=\"form-control old-label-name\" \n                placeholder=\"旧名称\" \n                pattern=\"[\\\\p{L}\\\\p{N}_:]+\"\n                title=\"允许使用字母数字字符,下划线和冒号.\"/>\n            \n            <div style=\"margin-right: 10px; margin-left: 10px;\">为:</div> \n            \n            <input type=\"text\" \n                class=\"form-control new-label-name\" \n                placeholder=\"新名称\"\n                pattern=\"[\\\\p{L}\\\\p{N}_:]+\"\n                title=\"允许使用字母数字字符,下划线和冒号.\"/>\n        </div>\n    </td>\n    <td class=\"button-column\">\n        <span class=\"bx bx-x icon-action action-conf-del\"></span>\n    </td>\n</tr>`;\n\nexport default class RenameLabelBulkAction extends AbstractBulkAction {\n    static get actionName() { return \"renameLabel\"; }\n    static get actionTitle() { return \"重命名标签\"; }\n\n    doRender() {\n        const $action = $(TPL);\n\n        const $oldLabelName = $action.find('.old-label-name');\n        $oldLabelName.val(this.actionDef.oldLabelName || \"\");\n\n        const $newLabelName = $action.find('.new-label-name');\n        $newLabelName.val(this.actionDef.newLabelName || \"\");\n\n        const spacedUpdate = new SpacedUpdate(async () => {\n            await this.saveAction({\n                oldLabelName: $oldLabelName.val(),\n                newLabelName: $newLabelName.val()\n            });\n        }, 1000);\n\n        $oldLabelName.on('input', () => spacedUpdate.scheduleUpdate());\n        $newLabelName.on('input', () => spacedUpdate.scheduleUpdate());\n\n        return $action;\n    }\n}\n","import SpacedUpdate from \"../../../services/spaced_update.js\";\nimport AbstractBulkAction from \"../abstract_bulk_action.js\";\n\nconst TPL = `\n<tr>\n    <td colspan=\"2\">\n        <div style=\"display: flex; align-items: center\">\n            <div style=\"margin-right: 10px; flex-shrink: 0;\">重命名关系由:</div> \n            \n            <input type=\"text\" \n                class=\"form-control old-relation-name\" \n                placeholder=\"旧名称\" \n                pattern=\"[\\\\p{L}\\\\p{N}_:]+\"\n                title=\"允许使用字母数字字符,下划线和冒号.\"/>\n            \n            <div style=\"margin-right: 10px; margin-left: 10px;\">为:</div> \n            \n            <input type=\"text\" \n                class=\"form-control new-relation-name\" \n                placeholder=\"新名称\"\n                pattern=\"[\\\\p{L}\\\\p{N}_:]+\"\n                title=\"允许使用字母数字字符,下划线和冒号.\"/>\n        </div>\n    </td>\n    <td class=\"button-column\">\n        <span class=\"bx bx-x icon-action action-conf-del\"></span>\n    </td>\n</tr>`;\n\nexport default class RenameRelationBulkAction extends AbstractBulkAction {\n    static get actionName() { return \"renameRelation\"; }\n    static get actionTitle() { return \"重命名关系\"; }\n\n    doRender() {\n        const $action = $(TPL);\n\n        const $oldRelationName = $action.find('.old-relation-name');\n        $oldRelationName.val(this.actionDef.oldRelationName || \"\");\n\n        const $newRelationName = $action.find('.new-relation-name');\n        $newRelationName.val(this.actionDef.newRelationName || \"\");\n\n        const spacedUpdate = new SpacedUpdate(async () => {\n            await this.saveAction({\n                oldRelationName: $oldRelationName.val(),\n                newRelationName: $newRelationName.val()\n            });\n        }, 1000)\n\n        $oldRelationName.on('input', () => spacedUpdate.scheduleUpdate());\n        $newRelationName.on('input', () => spacedUpdate.scheduleUpdate());\n\n        return $action;\n    }\n}\n","import SpacedUpdate from \"../../../services/spaced_update.js\";\nimport AbstractBulkAction from \"../abstract_bulk_action.js\";\n\nconst TPL = `\n<tr>\n    <td colspan=\"2\">\n        <div style=\"display: flex; align-items: center\">\n            <div style=\"margin-right: 10px;\" class=\"text-nowrap\">更新标签值</div> \n            \n            <input type=\"text\" \n                class=\"form-control label-name\" \n                placeholder=\"标签名称\"\n                pattern=\"[\\\\p{L}\\\\p{N}_:]+\"\n                title=\"允许使用字母数字字符,下划线和冒号.\"/>\n            \n            <div style=\"margin-right: 10px; margin-left: 10px;\" class=\"text-nowrap\">为</div>\n            \n            <input type=\"text\" class=\"form-control label-value\" placeholder=\"新值\"/>\n        </div>\n    </td>\n    <td class=\"button-column\">\n        <div class=\"dropdown help-dropdown\">\n            <span class=\"bx bx-help-circle icon-action\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"></span>\n            <div class=\"dropdown-menu dropdown-menu-right p-4\">\n                <p>对所有匹配的笔记更改现有标签的值.</p>\n                \n                <p>您也可以不带参数地调用这个方法, 这种情况下, 分配给笔记的标签就没有值.</p>\n            </div> \n        </div>\n    \n        <span class=\"bx bx-x icon-action action-conf-del\"></span>\n    </td>\n</tr>`;\n\nexport default class UpdateLabelValueBulkAction extends AbstractBulkAction {\n    static get actionName() { return \"updateLabelValue\"; }\n    static get actionTitle() { return \"更新标签值\"; }\n\n    doRender() {\n        const $action = $(TPL);\n\n        const $labelName = $action.find('.label-name');\n        $labelName.val(this.actionDef.labelName || \"\");\n\n        const $labelValue = $action.find('.label-value');\n        $labelValue.val(this.actionDef.labelValue || \"\");\n\n        const spacedUpdate = new SpacedUpdate(async () => {\n            await this.saveAction({\n                labelName: $labelName.val(),\n                labelValue: $labelValue.val()\n            });\n        }, 1000)\n\n        $labelName.on('input', () => spacedUpdate.scheduleUpdate());\n        $labelValue.on('input', () => spacedUpdate.scheduleUpdate());\n\n        return $action;\n    }\n}\n","import SpacedUpdate from \"../../../services/spaced_update.js\";\nimport AbstractBulkAction from \"../abstract_bulk_action.js\";\nimport noteAutocompleteService from \"../../../services/note_autocomplete.js\";\n\nconst TPL = `\n<tr>\n    <td colspan=\"2\">\n        <div style=\"display: flex; align-items: center\">\n            <div style=\"margin-right: 10px;\" class=\"text-nowrap\">更新关系</div> \n            \n            <input type=\"text\" \n                class=\"form-control relation-name\" \n                placeholder=\"关系名称\"\n                pattern=\"[\\\\p{L}\\\\p{N}_:]+\"\n                style=\"flex-shrink: 3\"\n                title=\"允许使用字母数字字符,下划线和冒号.\"/>\n                \n            <div style=\"margin-right: 10px; margin-left: 10px;\" class=\"text-nowrap\">到</div>\n            \n            <div class=\"input-group\" style=\"flex-shrink: 2\">\n                <input type=\"text\" class=\"form-control target-note\" placeholder=\"目标笔记\"/>\n            </div>\n        </div>\n    </td>\n    <td class=\"button-column\">\n        <div class=\"dropdown help-dropdown\">\n            <span class=\"bx bx-help-circle icon-action\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"></span>\n            <div class=\"dropdown-menu dropdown-menu-right p-4\">\n                <p>对于所有匹配的笔记:</p>\n                \n                <ul>\n                    <li>如果笔记还没有关系, 则创建给定的关系</li>\n                    <li>或修改现有关系的目标笔记</li>\n                </ul>\n            </div> \n        </div>\n    \n        <span class=\"bx bx-x icon-action action-conf-del\"></span>\n    </td>\n</tr>`;\n\nexport default class UpdateRelationTargetBulkAction extends AbstractBulkAction {\n    static get actionName() { return \"updateRelationTarget\"; }\n    static get actionTitle() { return \"更新关系目标\"; }\n\n    doRender() {\n        const $action = $(TPL);\n\n        const $relationName = $action.find('.relation-name');\n        $relationName.val(this.actionDef.relationName || \"\");\n\n        const $targetNote = $action.find('.target-note');\n        noteAutocompleteService.initNoteAutocomplete($targetNote);\n        $targetNote.setNote(this.actionDef.targetNoteId);\n\n        $targetNote.on('autocomplete:closed', () => spacedUpdate.scheduleUpdate());\n\n        const spacedUpdate = new SpacedUpdate(async () => {\n            await this.saveAction({\n                relationName: $relationName.val(),\n                targetNoteId: $targetNote.getSelectedNoteId()\n            });\n        }, 1000)\n\n        $relationName.on('input', () => spacedUpdate.scheduleUpdate());\n        $targetNote.on('input', () => spacedUpdate.scheduleUpdate());\n\n        return $action;\n    }\n}\n","import SpacedUpdate from \"../../services/spaced_update.js\";\nimport AbstractBulkAction from \"./abstract_bulk_action.js\";\n\nconst TPL = `\n<tr>\n    <td>\n        执行脚本:\n    </td>\n    <td>\n        <input type=\"text\" \n           class=\"form-control script\"\n           placeholder=\"note.title = note.title + '- suffix';\"/>\n    </td>\n    <td class=\"button-column\">\n        <div style=\"display: flex\">\n            <div class=\"dropdown help-dropdown\">\n              <span class=\"bx bx-help-circle icon-action\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"></span>\n              <div class=\"dropdown-menu dropdown-menu-right p-4\">\n                你可以在匹配的笔记上执行简单的脚本.\n                \n                比如在笔记标题后附加一串字符:\n                \n                <pre>note.title = note.title + ' - suffix';</pre>\n                \n                一个更复杂的例子, 删除所有匹配到笔记的属性:\n                \n                <pre>for (const attr of note.getOwnedAttributes) { attr.markAsDeleted(); }</pre>\n              </div>\n            </div>\n        \n            <span class=\"bx bx-x icon-action action-conf-del\"></span>\n        </div>\n    </td>\n</tr>`;\n\nexport default class ExecuteScriptBulkAction extends AbstractBulkAction {\n    static get actionName() { return \"executeScript\"; }\n    static get actionTitle() { return \"执行脚本\"; }\n\n    doRender() {\n        const $action = $(TPL);\n        const $script = $action.find('.script');\n        $script.val(this.actionDef.script || \"\");\n\n        const spacedUpdate = new SpacedUpdate(async () => {\n            await this.saveAction({ script: $script.val() });\n        }, 1000);\n\n        $script.on('input', () => spacedUpdate.scheduleUpdate());\n\n        return $action;\n    }\n}\n","import SpacedUpdate from \"../../../services/spaced_update.js\";\nimport AbstractBulkAction from \"../abstract_bulk_action.js\";\n\nconst TPL = `\n<tr>\n    <td colspan=\"2\">\n        <div style=\"display: flex; align-items: center\">\n            <div style=\"margin-right: 10px;\" class=\"text-nowrap\">添加标签</div> \n            \n            <input type=\"text\" \n                class=\"form-control label-name\" \n                placeholder=\"标签名称\"\n                pattern=\"[\\\\p{L}\\\\p{N}_:]+\"\n                title=\"允许使用字母数字字符,下划线和冒号.\"/>\n            \n            <div style=\"margin-right: 10px; margin-left: 10px;\" class=\"text-nowrap\">为</div>\n            \n            <input type=\"text\" class=\"form-control label-value\" placeholder=\"新值\"/>\n        </div>\n    </td>\n    <td class=\"button-column\">\n        <div class=\"dropdown help-dropdown\">\n            <span class=\"bx bx-help-circle icon-action\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"></span>\n            <div class=\"dropdown-menu dropdown-menu-right p-4\">\n                <p>对于所有匹配的笔记:</p>\n                \n                <ul>\n                    <li>如果笔记还没有, 则创建给定标签</li>\n                    <li>或修改现有标签的值</li>\n                </ul>\n                \n                <p>您也可以不带参数地调用这个方法, 这种情况下, 分配给笔记的标签就没有值.</p>\n            </div> \n        </div>\n    \n        <span class=\"bx bx-x icon-action action-conf-del\"></span>\n    </td>\n</tr>`;\n\nexport default class AddLabelBulkAction extends AbstractBulkAction {\n    static get actionName() { return \"addLabel\"; }\n    static get actionTitle() { return \"添加标签\"; }\n\n    doRender() {\n        const $action = $(TPL);\n\n        const $labelName = $action.find('.label-name');\n        $labelName.val(this.actionDef.labelName || \"\");\n\n        const $labelValue = $action.find('.label-value');\n        $labelValue.val(this.actionDef.labelValue || \"\");\n\n        const spacedUpdate = new SpacedUpdate(async () => {\n            await this.saveAction({\n                labelName: $labelName.val(),\n                labelValue: $labelValue.val()\n            });\n        }, 1000);\n\n        $labelName.on('input', () => spacedUpdate.scheduleUpdate());\n        $labelValue.on('input', () => spacedUpdate.scheduleUpdate());\n\n        return $action;\n    }\n}\n","import SpacedUpdate from \"../../../services/spaced_update.js\";\nimport AbstractBulkAction from \"../abstract_bulk_action.js\";\nimport noteAutocompleteService from \"../../../services/note_autocomplete.js\";\n\nconst TPL = `\n<tr>\n    <td colspan=\"2\">\n        <div style=\"display: flex; align-items: center\">\n            <div style=\"margin-right: 10px;\" class=\"text-nowrap\">添加关系</div> \n\n            <input type=\"text\" \n                class=\"form-control relation-name\" \n                placeholder=\"关系名称\"\n                pattern=\"[\\\\p{L}\\\\p{N}_:]+\"\n                style=\"flex-shrink: 3\"\n                title=\"允许使用字母数字字符,下划线和冒号.\"/>\n                \n            <div style=\"margin-right: 10px; margin-left: 10px;\" class=\"text-nowrap\">到</div>\n            \n            <div class=\"input-group\" style=\"flex-shrink: 2\">\n                <input type=\"text\" class=\"form-control target-note\" placeholder=\"目标笔记\"/>\n            </div>\n        </div>\n    </td>\n    <td class=\"button-column\">\n        <div class=\"dropdown help-dropdown\">\n            <span class=\"bx bx-help-circle icon-action\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"></span>\n            <div class=\"dropdown-menu dropdown-menu-right p-4\">\n                <p>在所有匹配的笔记上创建给定的关系.</p>\n            </div> \n        </div>\n    \n        <span class=\"bx bx-x icon-action action-conf-del\"></span>\n    </td>\n</tr>`;\n\nexport default class AddRelationBulkAction extends AbstractBulkAction {\n    static get actionName() { return \"addRelation\"; }\n    static get actionTitle() { return \"添加关系\"; }\n\n    doRender() {\n        const $action = $(TPL);\n\n        const $relationName = $action.find('.relation-name');\n        $relationName.val(this.actionDef.relationName || \"\");\n\n        const $targetNote = $action.find('.target-note');\n        noteAutocompleteService.initNoteAutocomplete($targetNote);\n        $targetNote.setNote(this.actionDef.targetNoteId);\n\n        $targetNote.on('autocomplete:closed', () => spacedUpdate.scheduleUpdate());\n\n        const spacedUpdate = new SpacedUpdate(async () => {\n            await this.saveAction({\n                relationName: $relationName.val(),\n                targetNoteId: $targetNote.getSelectedNoteId()\n            });\n        }, 1000)\n\n        $relationName.on('input', () => spacedUpdate.scheduleUpdate());\n        $targetNote.on('input', () => spacedUpdate.scheduleUpdate());\n\n        return $action;\n    }\n}\n","import SpacedUpdate from \"../../../services/spaced_update.js\";\nimport AbstractBulkAction from \"../abstract_bulk_action.js\";\n\nconst TPL = `\n<tr>\n    <td colspan=\"2\">\n        <div style=\"display: flex; align-items: center\">\n            <div style=\"margin-right: 10px; flex-shrink: 0;\">将笔记标题重命名为:</div> \n            \n            <input type=\"text\" \n                class=\"form-control new-title\" \n                placeholder=\"新笔记标题\" \n                title=\"单击右侧的帮助图标以查看所有选项\"/>\n        </div>\n    </td>\n    <td class=\"button-column\">\n        <div class=\"dropdown help-dropdown\">\n            <span class=\"bx bx-help-circle icon-action\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"></span>\n            <div class=\"dropdown-menu dropdown-menu-right p-4\">\n                <p>给定的值会被作为Javascript解析, 因此可以注入丰富的动态内容 <code>note</code>变量 (被重命名的笔记). 例如:</p>\n                \n                <ul>\n                    <li><code>笔记</code>- 所有匹配的笔记都重命名为\"Note\"</li>\n                    <li><code>NEW: \\${note.title}</code>- 匹配的笔记标题前缀\"NEW:\"</li>\n                    <li><code>\\${note.dateCreatedObj.format('MM-DD:')}: \\${note.title}</code>- 匹配的笔记添加笔记的创建月份日期为前缀</li>\n                </ul>\n                \n                请参阅 API 文档了解 <a href=\"https://zadam.github.io/trilium/backend_api/Note.html\">note</a> 及其 <a href=\"https://day.js.org/docs/en/display/format\">dateCreatedObj / utcDateCreatedObj 属性</a>.\n            </div>\n        </div>\n    \n        <span class=\"bx bx-x icon-action action-conf-del\"></span>\n    </td>\n</tr>`;\n\nexport default class RenameNoteBulkAction extends AbstractBulkAction {\n    static get actionName() { return \"renameNote\"; }\n    static get actionTitle() { return \"重命名笔记\"; }\n\n    doRender() {\n        const $action = $(TPL);\n\n        const $newTitle = $action.find('.new-title');\n        $newTitle.val(this.actionDef.newTitle || \"\");\n\n        const spacedUpdate = new SpacedUpdate(async () => {\n            await this.saveAction({\n                newTitle: $newTitle.val(),\n            });\n        }, 1000);\n\n        $newTitle.on('input', () => spacedUpdate.scheduleUpdate());\n\n        return $action;\n    }\n}\n","import server from \"./server.js\";\nimport ws from \"./ws.js\";\nimport MoveNoteBulkAction from \"../widgets/bulk_actions/note/move_note.js\";\nimport DeleteNoteBulkAction from \"../widgets/bulk_actions/note/delete_note.js\";\nimport DeleteRevisionsBulkAction from \"../widgets/bulk_actions/note/delete_revisions.js\";\nimport DeleteLabelBulkAction from \"../widgets/bulk_actions/label/delete_label.js\";\nimport DeleteRelationBulkAction from \"../widgets/bulk_actions/relation/delete_relation.js\";\nimport RenameLabelBulkAction from \"../widgets/bulk_actions/label/rename_label.js\";\nimport RenameRelationBulkAction from \"../widgets/bulk_actions/relation/rename_relation.js\";\nimport UpdateLabelValueBulkAction from \"../widgets/bulk_actions/label/update_label_value.js\";\nimport UpdateRelationTargetBulkAction from \"../widgets/bulk_actions/relation/update_relation_target.js\";\nimport ExecuteScriptBulkAction from \"../widgets/bulk_actions/execute_script.js\";\nimport AddLabelBulkAction from \"../widgets/bulk_actions/label/add_label.js\";\nimport AddRelationBulkAction from \"../widgets/bulk_actions/relation/add_relation.js\";\nimport RenameNoteBulkAction from \"../widgets/bulk_actions/note/rename_note.js\";\n\nconst ACTION_GROUPS = [\n    {\n        title: '标签',\n        actions: [AddLabelBulkAction, UpdateLabelValueBulkAction, RenameLabelBulkAction, DeleteLabelBulkAction]\n    },\n    {\n        title: '关系',\n        actions: [AddRelationBulkAction, UpdateRelationTargetBulkAction, RenameRelationBulkAction, DeleteRelationBulkAction]\n    },\n    {\n        title: '笔记',\n        actions: [RenameNoteBulkAction, MoveNoteBulkAction, DeleteNoteBulkAction, DeleteRevisionsBulkAction],\n    },\n    {\n        title: '其他',\n        actions: [ExecuteScriptBulkAction]\n    }\n];\n\nconst ACTION_CLASSES = [\n    RenameNoteBulkAction,\n    MoveNoteBulkAction,\n    DeleteNoteBulkAction,\n    DeleteRevisionsBulkAction,\n    DeleteLabelBulkAction,\n    DeleteRelationBulkAction,\n    RenameLabelBulkAction,\n    RenameRelationBulkAction,\n    AddLabelBulkAction,\n    AddRelationBulkAction,\n    UpdateLabelValueBulkAction,\n    UpdateRelationTargetBulkAction,\n    ExecuteScriptBulkAction\n];\n\nasync function addAction(noteId, actionName) {\n    await server.post(`notes/${noteId}/attributes`, {\n        type: 'label',\n        name: 'action',\n        value: JSON.stringify({\n            name: actionName\n        })\n    });\n\n    await ws.waitForMaxKnownEntityChangeId();\n}\n\nfunction parseActions(note) {\n    const actionLabels = note.getLabels('action');\n\n    return actionLabels.map(actionAttr => {\n        let actionDef;\n\n        try {\n            actionDef = JSON.parse(actionAttr.value);\n        } catch (e) {\n            logError(`Parsing of attribute: '${actionAttr.value}' failed with error: ${e.message}`);\n            return null;\n        }\n\n        const ActionClass = ACTION_CLASSES.find(actionClass => actionClass.actionName === actionDef.name);\n\n        if (!ActionClass) {\n            logError(`No action class for '${actionDef.name}' found.`);\n            return null;\n        }\n\n        return new ActionClass(actionAttr, actionDef);\n    })\n        .filter(action => !!action);\n}\n\nexport default {\n    addAction,\n    parseActions,\n    ACTION_CLASSES,\n    ACTION_GROUPS\n};\n","import server from \"../../services/server.js\";\nimport NoteContextAwareWidget from \"../note_context_aware_widget.js\";\nimport froca from \"../../services/froca.js\";\nimport ws from \"../../services/ws.js\";\nimport toastService from \"../../services/toast.js\";\nimport treeService from \"../../services/tree.js\";\n\nimport SearchString from \"../search_options/search_string.js\";\nimport FastSearch from \"../search_options/fast_search.js\";\nimport Ancestor from \"../search_options/ancestor.js\";\nimport IncludeArchivedNotes from \"../search_options/include_archived_notes.js\";\nimport OrderBy from \"../search_options/order_by.js\";\nimport SearchScript from \"../search_options/search_script.js\";\nimport Limit from \"../search_options/limit.js\";\nimport Debug from \"../search_options/debug.js\";\nimport appContext from \"../../components/app_context.js\";\nimport bulkActionService from \"../../services/bulk_action.js\";\n\nconst TPL = `\n<div class=\"search-definition-widget\">\n    <style> \n    .search-setting-table {\n        margin-top: 0;\n        margin-bottom: 7px;\n        width: 100%;\n        border-collapse: separate;\n        border-spacing: 10px;\n    }\n    \n    .search-setting-table div {\n        white-space: nowrap;\n    }\n    \n    .search-setting-table .button-column {\n        /* minimal width so that table remains static sized and most space remains for middle column with settings */\n        width: 50px;\n        white-space: nowrap;\n        text-align: right;\n    }\n    \n    .search-setting-table .title-column {\n        /* minimal width so that table remains static sized and most space remains for middle column with settings */\n        width: 50px;\n        white-space: nowrap;    \n    }\n    \n    .search-setting-table .button-column .dropdown-menu {\n        white-space: normal;\n    }\n    \n    .attribute-list hr {\n        height: 1px;\n        border-color: var(--main-border-color);\n        position: relative;\n        top: 4px;\n        margin-top: 5px;\n        margin-bottom: 0;\n    }\n    \n    .search-definition-widget input:invalid {\n        border: 3px solid red;\n    }\n\n    .add-search-option button {\n        margin-top: 5px; /* to give some spacing when buttons overflow on the next line */\n    }\n    \n    .dropdown-header {\n        background-color: var(--accented-background-color);\n    }\n    </style>\n\n    <div class=\"search-settings\">\n        <table class=\"search-setting-table\">\n            <tr>\n                <td class=\"title-column\">添加搜索选项</td>\n                <td colspan=\"2\" class=\"add-search-option\">\n                    <button type=\"button\" class=\"btn btn-sm\" data-search-option-add=\"searchString\">\n                        <span class=\"bx bx-text\"></span> \n                        搜索字符串\n                    </button>\n                    \n                    <button type=\"button\" class=\"btn btn-sm\" data-search-option-add=\"searchScript\">\n                        <span class=\"bx bx-code\"></span> \n                        搜索脚本\n                    </button>\n                    \n                    <button type=\"button\" class=\"btn btn-sm\" data-search-option-add=\"ancestor\">\n                        <span class=\"bx bx-filter-alt\"></span> \n                        父级节点\n                    </button>\n                    \n                    <button type=\"button\" class=\"btn btn-sm\" data-search-option-add=\"fastSearch\"\n                        title=\"\"快速搜索\"选项禁用了笔记内容的全文搜索, 这可能会加快大型数据库中的搜索速度.\">\n                        <span class=\"bx bx-run\"></span>\n                        快速搜索\n                    </button>\n                    \n                    <button type=\"button\" class=\"btn btn-sm\" data-search-option-add=\"includeArchivedNotes\"\n                        title=\"默认情况下, 归档的笔记不包括在搜索结果中, 使用此选项将包括这些笔记.\">\n                        <span class=\"bx bx-archive\"></span>\n                        包括归档笔记\n                    </button>\n                    \n                    <button type=\"button\" class=\"btn btn-sm\" data-search-option-add=\"orderBy\">\n                        <span class=\"bx bx-arrow-from-top\"></span>\n                        排序\n                    </button>\n                    \n                    <button type=\"button\" class=\"btn btn-sm\" data-search-option-add=\"limit\" title=\"限制结果数\">\n                        <span class=\"bx bx-stop\"></span>\n                        限制条数\n                    </button>\n                    \n                    <button type=\"button\" class=\"btn btn-sm\" data-search-option-add=\"debug\" title=\"调试会将更多调试信息打印到控制台中, 以帮助调试复杂的查询\">\n                        <span class=\"bx bx-bug\"></span>\n                        调试\n                    </button>\n                    \n                    <div class=\"dropdown\" style=\"display: inline-block;\">\n                      <button class=\"btn btn-sm dropdown-toggle action-add-toggle\" type=\"button\" id=\"dropdownMenuButton\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">\n                        <span class=\"bx bxs-zap\"></span>\n                        动作\n                      </button>\n                      <div class=\"dropdown-menu action-list\"></div>\n                    </div>\n                </td>\n            </tr>\n            <tbody class=\"search-options\"></tbody>\n            <tbody class=\"action-options\"></tbody>\n            <tbody>\n                <tr>\n                    <td colspan=\"3\">\n                        <div style=\"display: flex; justify-content: space-evenly\">\n                            <button type=\"button\" class=\"btn btn-sm search-button\">\n                                <span class=\"bx bx-search\"></span>\n                                搜索\n                                \n                                <kbd>回车</kbd>\n                            </button>\n        \n                            <button type=\"button\" class=\"btn btn-sm search-and-execute-button\">\n                                <span class=\"bx bxs-zap\"></span>\n                                搜索并执行动作\n                            </button>\n                            \n                            <button type=\"button\" class=\"btn btn-sm save-to-note-button\">\n                                <span class=\"bx bx-save\"></span>\n                                保存到笔记\n                            </button>\n                        </div>\n                    </td>\n                </tr>\n            </tbody>\n        </table>\n    </div>\n</div>`;\n\nconst OPTION_CLASSES = [\n    SearchString,\n    SearchScript,\n    Ancestor,\n    FastSearch,\n    IncludeArchivedNotes,\n    OrderBy,\n    Limit,\n    Debug\n];\n\nexport default class SearchDefinitionWidget extends NoteContextAwareWidget {\n    get name() {\n        return \"searchDefinition\";\n    }\n\n    isEnabled() {\n        return this.note && this.note.type === 'search';\n    }\n\n    getTitle() {\n        return {\n            show: this.isEnabled(),\n            activate: true,\n            title: '搜索参数',\n            icon: 'bx bx-search'\n        };\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.contentSized();\n        this.$component = this.$widget.find('.search-definition-widget');\n        this.$actionList = this.$widget.find('.action-list');\n\n        for (const actionGroup of bulkActionService.ACTION_GROUPS) {\n            this.$actionList.append($('<h6 class=\"dropdown-header\">').append(actionGroup.title));\n\n            for (const action of actionGroup.actions) {\n                this.$actionList.append(\n                    $('<a class=\"dropdown-item\" href=\"#\">')\n                        .attr('data-action-add', action.actionName)\n                        .text(action.actionTitle)\n                );\n            }\n        }\n\n        this.$widget.on('click', '[data-search-option-add]', async event => {\n            const searchOptionName = $(event.target).attr('data-search-option-add');\n            const clazz = OPTION_CLASSES.find(SearchOptionClass => SearchOptionClass.optionName === searchOptionName);\n\n            if (clazz) {\n                await clazz.create(this.noteId);\n            }\n            else {\n                logError(`Unknown search option ${searchOptionName}`);\n            }\n\n            this.refresh();\n        });\n\n        this.$widget.on('click', '[data-action-add]', async event => {\n            this.$widget.find('.action-add-toggle').dropdown('toggle');\n\n            const actionName = $(event.target).attr('data-action-add');\n\n            await bulkActionService.addAction(this.noteId, actionName);\n\n            this.refresh();\n        });\n\n        this.$searchOptions = this.$widget.find('.search-options');\n        this.$actionOptions = this.$widget.find('.action-options');\n\n        this.$searchButton = this.$widget.find('.search-button');\n        this.$searchButton.on('click', () => this.triggerCommand('refreshResults'));\n\n        this.$searchAndExecuteButton = this.$widget.find('.search-and-execute-button');\n        this.$searchAndExecuteButton.on('click', () => this.searchAndExecute());\n\n        this.$saveToNoteButton = this.$widget.find('.save-to-note-button');\n        this.$saveToNoteButton.on('click', async () => {\n            const {notePath} = await server.post(\"special-notes/save-search-note\", {searchNoteId: this.noteId});\n\n            await ws.waitForMaxKnownEntityChangeId();\n\n            await appContext.tabManager.getActiveContext().setNote(notePath);\n\n            toastService.showMessage(`Search note has been saved into ${await treeService.getNotePathTitle(notePath)}`);\n        });\n    }\n\n    async refreshResultsCommand() {\n        try {\n            const {error} = await froca.loadSearchNote(this.noteId);\n\n            if (error) {\n                this.handleEvent('showSearchError', { error });\n            }\n        }\n        catch (e) {\n            toastService.showError(e.message);\n        }\n\n        this.triggerEvent('searchRefreshed', {ntxId: this.noteContext.ntxId});\n    }\n\n    async refreshSearchDefinitionCommand() {\n        await this.refresh();\n    }\n\n    async refreshWithNote(note) {\n        this.$component.show();\n\n        this.$saveToNoteButton.toggle(note.isHiddenCompletely());\n\n        this.$searchOptions.empty();\n\n        for (const OptionClass of OPTION_CLASSES) {\n            const {attributeType, optionName} = OptionClass;\n\n            const attr = this.note.getAttribute(attributeType, optionName);\n\n            this.$widget.find(`[data-search-option-add='${optionName}'`).toggle(!attr);\n\n            if (attr) {\n                const searchOption = new OptionClass(attr, this.note).setParent(this);\n                this.child(searchOption);\n\n                this.$searchOptions.append(searchOption.render());\n            }\n        }\n\n        const actions = bulkActionService.parseActions(this.note);\n\n        this.$actionOptions\n            .empty()\n            .append(...actions.map(action => action.render()));\n\n        this.$searchAndExecuteButton.css('visibility', actions.length > 0 ? 'visible' : '_hidden');\n    }\n\n    getContent() {\n        return '';\n    }\n\n    async searchAndExecute() {\n        await server.post(`search-and-execute-note/${this.noteId}`);\n\n        this.triggerCommand('refreshResults');\n\n        toastService.showMessage('动作已执行.', 3000);\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        // only refreshing deleted attrs, otherwise components update themselves\n        if (loadResults.getAttributeRows().find(attrRow =>\n            attrRow.type === 'label' && attrRow.name === 'action' && attrRow.isDeleted)) {\n\n            this.refresh();\n        }\n    }\n}\n","import AbstractSearchOption from \"./abstract_search_option.js\";\nimport SpacedUpdate from \"../../services/spaced_update.js\";\nimport server from \"../../services/server.js\";\nimport shortcutService from \"../../services/shortcuts.js\";\nimport appContext from \"../../components/app_context.js\";\n\nconst TPL = `\n<tr>\n    <td class=\"title-column\">搜索字符串:</td>\n    <td>\n        <textarea class=\"form-control search-string\" placeholder=\"全文搜索关键字, #标签=值 ...\"></textarea>\n    </td>\n    <td class=\"button-column\">\n        <div class=\"dropdown help-dropdown\">\n          <span class=\"bx bx-help-circle icon-action\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"></span>\n          <div class=\"dropdown-menu dropdown-menu-right p-4\">\n            <strong>搜索语法</strong> - 参见 <button class=\"btn btn-sm\" type=\"button\" data-help-page=\"Search\">搜索语法完整帮助文档</button>\n            <p>\n            <ul>\n                <li>输入任意文字进行全文搜索</li>\n                <li><code>#abc</code> - 会返回含有abc标签的笔记</li>\n                <li><code>#year = 2019</code> - <code>year</code>并且值是<code>2019</code>的笔记</li>\n                <li><code>#rock #pop</code> - 会匹配同时含有 <code>rock</code> 和  <code>pop</code> 标签的笔记</li>\n                <li><code>#rock or #pop</code> - 含有其中任意一个标签的笔记</li>\n                <li><code>#year &lt;= 2000</code> - 可以用比较符号(比如 &gt;, &gt;=, &lt;).</li>\n                <li><code>note.dateCreated >= MONTH-1</code> - 上个月创建的笔记</li>\n            </ul>\n            </p>\n          </div>\n        </div>\n        \n        <span class=\"bx bx-x icon-action search-option-del\"></span>\n    </td>\n</tr>`;\n\nexport default class SearchString extends AbstractSearchOption {\n    static get optionName() { return \"searchString\" };\n    static get attributeType() { return \"label\" };\n\n    static async create(noteId) {\n        await AbstractSearchOption.setAttribute(noteId, 'label', 'searchString');\n    }\n\n    doRender() {\n        const $option = $(TPL);\n        this.$searchString = $option.find('.search-string');\n        this.$searchString.on('input', () => this.spacedUpdate.scheduleUpdate());\n\n        shortcutService.bindElShortcut(this.$searchString, 'return', async () => {\n            // this also in effect disallows new lines in query string.\n            // on one hand, this makes sense since search string is a label\n            // on the other hand, it could be nice for structuring long search string. It's probably a niche case though.\n            await this.spacedUpdate.updateNowIfNecessary();\n\n            this.triggerCommand('refreshResults');\n        });\n\n        this.spacedUpdate = new SpacedUpdate(async () => {\n            const searchString = this.$searchString.val();\n            appContext.lastSearchString = searchString;\n\n            await this.setAttribute('label', 'searchString', searchString);\n\n            if (this.note.title.startsWith('Search:') || this.note.title.startsWith('搜索:')) {\n                await server.put(`notes/${this.note.noteId}/title`, {\n                    title: `Search: ${searchString.length < 30 ? searchString : `${searchString.substr(0, 30)}…`}`\n                });\n            }\n        }, 1000);\n\n        this.$searchString.val(this.note.getLabelValue('searchString'));\n\n        return $option;\n    }\n\n    showSearchErrorEvent({error}) {\n        this.$searchString.tooltip({\n            trigger: 'manual',\n            title: `Search error: ${error}`,\n            placement: 'bottom'\n        });\n\n        this.$searchString.tooltip(\"show\");\n\n        setTimeout(() => this.$searchString.tooltip(\"dispose\"), 4000);\n    }\n\n    focusOnSearchDefinitionEvent() {\n        this.$searchString.val(this.$searchString.val().trim() || appContext.lastSearchString).focus().select();\n        this.spacedUpdate.scheduleUpdate();\n    }\n}\n","import AbstractSearchOption from \"./abstract_search_option.js\";\nimport noteAutocompleteService from \"../../services/note_autocomplete.js\";\n\nconst TPL = `\n<tr>\n    <td class=\"title-column\">\n        搜索脚本 \n    </td>\n    <td>\n        <div class=\"input-group\">\n            <input class=\"search-script form-control\" placeholder=\"根据名称搜索笔记\">\n        </div>\n    </td>\n        <td class=\"button-column\">\n        <div class=\"dropdown help-dropdown\">\n          <span class=\"bx bx-help-circle icon-action\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"></span>\n          <div class=\"dropdown-menu dropdown-menu-right p-4\">\n            <p>搜索脚本允许通过运行脚本来定义搜索结果.</p>\n            \n            <p>搜索脚本的类型必须为\"代码\",子类型必须为\" JavaScript后端\".</p>\n            \n            <p>请参阅以下示例:</p>\n            \n            <pre>\n// 1. prefiltering using standard search\nconst candidateNotes = api.searchForNotes(\"#journal\"); \n\n// 2. applying custom search criteria\nconst matchedNotes = candidateNotes\n    .filter(note => note.title.match(/[0-9]{1,2}\\. ?[0-9]{1,2}\\. ?[0-9]{4}\\/));\n\nreturn matchedNotes;</pre>\n\n            <p>请注意,搜索脚本和搜索字符串不能一起使用.</p>\n          </div>\n        </div>\n        \n        <span class=\"bx bx-x icon-action search-option-del\"></span>\n    </td>\n</tr>`;\n\nexport default class SearchScript extends AbstractSearchOption {\n    static get optionName() { return \"searchScript\" };\n    static get attributeType() { return \"relation\" };\n\n    static async create(noteId) {\n        await AbstractSearchOption.setAttribute(noteId, 'relation', 'searchScript', 'root');\n    }\n\n    doRender() {\n        const $option = $(TPL);\n        const $searchScript = $option.find('.search-script');\n        noteAutocompleteService.initNoteAutocomplete($searchScript, {allowCreatingNotes: true});\n\n        $searchScript.on('autocomplete:closed', async () => {\n            const searchScriptNoteId = $searchScript.getSelectedNoteId();\n\n            if (searchScriptNoteId) {\n                await this.setAttribute('relation', 'searchScript', searchScriptNoteId);\n            }\n        });\n\n        const searchScriptNoteId = this.note.getRelationValue('searchScript');\n\n        if (searchScriptNoteId !== 'root') {\n            $searchScript.setNote(searchScriptNoteId);\n        }\n\n        return $option;\n    }\n}\n","import AbstractSearchOption from \"./abstract_search_option.js\";\nimport noteAutocompleteService from \"../../services/note_autocomplete.js\";\n\nconst TPL = `\n<tr>\n    <td colspan=\"2\">\n        <div style=\"display: flex; align-items: center;\">\n            <div style=\"margin-right: 10px\">祖先:</div> \n            <div class=\"input-group\" style=\"flex-shrink: 2\">\n                <input class=\"ancestor form-control\" placeholder=\"根据名称搜索笔记\">\n            </div>\n            \n            <div style=\"margin-left: 10px; margin-right: 10px\">深度:</div>\n            \n            <select name=\"depth\" class=\"form-control d-inline ancestor-depth\" style=\"flex-shrink: 3\">\n                <option value=\"\">任意</option>\n                <option value=\"eq1\">正好是1(直接子代)</option>\n                <option value=\"eq2\">正好是2</option>\n                <option value=\"eq3\">正好是3</option>\n                <option value=\"eq4\">正好是4</option>\n                <option value=\"eq5\">正好是5</option>\n                <option value=\"eq6\">正好是6</option>\n                <option value=\"eq7\">正好是7</option>\n                <option value=\"eq8\">正好是8</option>\n                <option value=\"eq9\">正好是9</option>\n                <option value=\"gt0\">大于0</option>\n                <option value=\"gt1\">大于1</option>\n                <option value=\"gt2\">大于2</option>\n                <option value=\"gt3\">大于3</option>\n                <option value=\"gt4\">大于4</option>\n                <option value=\"gt5\">大于5</option>\n                <option value=\"gt6\">大于6</option>\n                <option value=\"gt7\">大于7</option>\n                <option value=\"gt8\">大于8</option>\n                <option value=\"gt9\">大于9</option>\n                <option value=\"lt2\">小于2</option>\n                <option value=\"lt3\">小于3</option>\n                <option value=\"lt4\">小于4</option>\n                <option value=\"lt5\">小于5</option>\n                <option value=\"lt6\">小于6</option>\n                <option value=\"lt7\">小于7</option>\n                <option value=\"lt8\">小于8</option>\n                <option value=\"lt9\">小于9</option>\n            </select>\n        </div>\n    </td>\n    <td class=\"button-column\">\n        <span class=\"bx bx-x icon-action search-option-del\"></span>\n    </td>\n</tr>`;\n\nexport default class Ancestor extends AbstractSearchOption {\n    static get optionName() { return \"ancestor\" };\n    static get attributeType() { return \"relation\" };\n\n    static async create(noteId) {\n        await AbstractSearchOption.setAttribute(noteId, 'relation', 'ancestor', 'root');\n    }\n\n    doRender() {\n        const $option = $(TPL);\n        const $ancestor = $option.find('.ancestor');\n        const $ancestorDepth = $option.find('.ancestor-depth');\n        noteAutocompleteService.initNoteAutocomplete($ancestor);\n\n        $ancestor.on('autocomplete:closed', async () => {\n            const ancestorNoteId = $ancestor.getSelectedNoteId();\n\n            if (ancestorNoteId) {\n                await this.setAttribute('relation', 'ancestor', ancestorNoteId);\n            }\n        });\n\n        $ancestorDepth.on('change', async () => {\n            const ancestorDepth = $ancestorDepth.val();\n\n            if (ancestorDepth) {\n                await this.setAttribute('label', 'ancestorDepth', ancestorDepth);\n            }\n            else {\n                await this.deleteAttribute('label', 'ancestorDepth');\n            }\n        });\n\n        const ancestorNoteId = this.note.getRelationValue('ancestor');\n\n        if (ancestorNoteId !== 'root') {\n            $ancestor.setNote(ancestorNoteId);\n        }\n\n        const ancestorDepth = this.note.getLabelValue('ancestorDepth');\n\n        if (ancestorDepth) {\n            $ancestorDepth.val(ancestorDepth);\n        }\n\n        return $option;\n    }\n\n    async deleteOption() {\n        await this.deleteAttribute('label', 'ancestorDepth');\n\n        await super.deleteOption();\n    }\n}\n","import AbstractSearchOption from \"./abstract_search_option.js\";\n\nconst TPL = `\n<tr data-search-option-conf=\"fastSearch\">\n    <td colSpan=\"2\">\n        <span class=\"bx bx-run\"></span>\n\n        快速搜索\n    </td>\n    <td class=\"button-column\">\n        <div class=\"dropdown help-dropdown\">\n            <span class=\"bx bx-help-circle icon-action\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"></span>\n            <div class=\"dropdown-menu dropdown-menu-right p-4\">\n                \"快速搜索\"选项禁用了笔记内容的全文搜索, 这可能会加快大型数据库中的搜索速度.\n            </div> \n        </div>\n    \n        <span class=\"bx bx-x icon-action search-option-del\"></span>\n    </td>\n</tr>`;\n\nexport default class FastSearch extends AbstractSearchOption {\n    static get optionName() { return \"fastSearch\" };\n    static get attributeType() { return \"label\" };\n\n    static async create(noteId) {\n        await AbstractSearchOption.setAttribute(noteId,'label', 'fastSearch');\n    }\n\n    doRender() {\n        return $(TPL);\n    }\n}\n","import AbstractSearchOption from \"./abstract_search_option.js\";\n\nconst TPL = `\n<tr data-search-option-conf=\"includeArchivedNotes\">\n    <td colspan=\"2\">\n        <span class=\"bx bx-archive\"></span>\n    \n        包含已归档笔记\n    </td>\n    <td class=\"button-column\">\n        <span class=\"bx bx-x icon-action search-option-del\"></span>\n    </td>\n</tr>`;\n\nexport default class IncludeArchivedNotes extends AbstractSearchOption {\n    static get optionName() { return \"includeArchivedNotes\" };\n    static get attributeType() { return \"label\" };\n\n    static async create(noteId) {\n        await AbstractSearchOption.setAttribute(noteId,'label', 'includeArchivedNotes');\n    }\n\n    doRender() {\n        return $(TPL);\n    }\n}\n","import AbstractSearchOption from \"./abstract_search_option.js\";\n\nconst TPL = `\n<tr data-search-option-conf=\"orderBy\">\n    <td class=\"title-column\">\n        <span class=\"bx bx-arrow-from-top\"></span>\n    \n        排序\n    </td>\n    <td>\n        <select name=\"orderBy\" class=\"form-control w-auto d-inline\">\n            <option value=\"relevancy\">相关性 (默认)</option>\n            <option value=\"title\">标题</option>\n            <option value=\"dateCreated\">创建日期</option>\n            <option value=\"dateModified\">最后修改日期</option>\n            <option value=\"contentSize\">笔记内容大小</option>\n            <option value=\"contentAndAttachmentsSize\">包括附件的笔记内容大小</option>\n            <option value=\"contentAndAttachmentsAndRevisionsSize\">包括附件和笔记历史的笔记内容大小</option>\n            <option value=\"revisionCount\">历史数量</option>\n            <option value=\"childrenCount\">子笔记数</option>\n            <option value=\"parentCount\">克隆数</option>\n            <option value=\"ownedLabelCount\">标签数量</option>\n            <option value=\"ownedRelationCount\">关系数</option>\n            <option value=\"targetRelationCount\">指向笔记的关系数</option>\n            <option value=\"random\">随机顺序</option>\n        </select>\n        \n        <select name=\"orderDirection\" class=\"form-control w-auto d-inline\">\n            <option value=\"asc\">升序(默认)</option>\n            <option value=\"desc\">降序</option>\n        </select>\n    </td>\n    <td class=\"button-column\">\n        <span class=\"bx bx-x icon-action search-option-del\"></span>\n    </td>\n</tr>`;\n\nexport default class OrderBy extends AbstractSearchOption {\n    static get optionName() { return \"orderBy\" };\n    static get attributeType() { return \"label\" };\n\n    static async create(noteId) {\n        await AbstractSearchOption.setAttribute(noteId, 'label', 'orderBy', 'relevancy');\n        await AbstractSearchOption.setAttribute(noteId, 'label', 'orderDirection', 'asc');\n    }\n\n    doRender() {\n        const $option = $(TPL);\n\n        const $orderBy = $option.find('select[name=orderBy]');\n        $orderBy.on('change', async () => {\n            const orderBy = $orderBy.val();\n\n            await this.setAttribute('label', 'orderBy', orderBy);\n        });\n        $orderBy.val(this.note.getLabelValue('orderBy'));\n\n        const $orderDirection = $option.find('select[name=orderDirection]');\n        $orderDirection.on('change', async () => {\n            const orderDirection = $orderDirection.val();\n\n            await this.setAttribute('label', 'orderDirection', orderDirection);\n        });\n        $orderDirection.val(this.note.getLabelValue('orderDirection') || 'asc');\n\n        return $option;\n    }\n\n    async deleteOption() {\n        await this.deleteAttribute('label', 'orderDirection');\n\n        await super.deleteOption();\n    }\n}\n","import AbstractSearchOption from \"./abstract_search_option.js\";\n\nconst TPL = `\n<tr data-search-option-conf=\"limit\">\n    <td class=\"title-column\">\n        <span class=\"bx bx-stop\"></span>\n    \n        限制\n    </td>\n    <td>\n        <input name=\"limit\" class=\"form-control\" type=\"number\" min=\"1\" step=\"1\" />\n    </td>\n    <td class=\"button-column\">\n        <div class=\"dropdown help-dropdown\">\n            <span class=\"bx bx-help-circle icon-action\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"></span>\n            <div class=\"dropdown-menu dropdown-menu-right p-4\">\n                只取前N条结果.\n            </div> \n        </div>\n    \n        <span class=\"bx bx-x icon-action search-option-del\"></span>\n    </td>\n</tr>`;\n\nexport default class Limit extends AbstractSearchOption {\n    static get optionName() { return \"limit\" };\n    static get attributeType() { return \"label\" };\n\n    static async create(noteId) {\n        await AbstractSearchOption.setAttribute(noteId, 'label', 'limit', '10');\n    }\n\n    doRender() {\n        const $option = $(TPL);\n\n        this.$limit = $option.find('input[name=limit]');\n        this.$limit.on('change', () => this.update());\n        this.$limit.on('input', () => this.update());\n        this.$limit.val(this.note.getLabelValue('limit'));\n\n        return $option;\n    }\n\n    async update() {\n        const limit = this.$limit.val();\n\n        await this.setAttribute('label', 'limit', limit);\n    }\n}\n","import AbstractSearchOption from \"./abstract_search_option.js\";\n\nconst TPL = `\n<tr data-search-option-conf=\"debug\">\n    <td colSpan=\"2\">\n        <span class=\"bx bx-bug\"></span>\n\n        调试\n    </td>\n    <td class=\"button-column\">\n        <div class=\"dropdown help-dropdown\">\n            <span class=\"bx bx-help-circle icon-action\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"></span>\n            <div class=\"dropdown-menu dropdown-menu-right p-4\">\n                <p>调试会将更多调试信息打印到控制台中, 以帮助调试复杂的查询.</p>\n                \n                <p>要访问调试信息, 请执行查询, 然后单击左上角的\"显示后端日志\".</p> \n            </div>\n        </div>\n    \n        <span class=\"bx bx-x icon-action search-option-del\"></span>\n    </td>\n</tr>`;\n\nexport default class Debug extends AbstractSearchOption {\n    static get optionName() { return \"debug\" };\n    static get attributeType() { return \"label\" };\n\n    static async create(noteId) {\n        await AbstractSearchOption.setAttribute(noteId,'label', 'debug');\n    }\n\n    doRender() {\n        return $(TPL);\n    }\n}\n","import NoteContextAwareWidget from \"./note_context_aware_widget.js\";\n\nconst TPL = `\n<div class=\"sql-result-widget\">\n    <style>\n    .sql-result-widget {\n        padding: 15px;\n    }\n    </style>\n   \n    <div class=\"sql-query-no-rows alert alert-info\" style=\"display: none;\">\n        No rows have been returned for this query.\n    </div>\n   \n    <div class=\"sql-console-result-container\"></div>\n</div>`;\n\nexport default class SqlResultWidget extends NoteContextAwareWidget {\n    isEnabled() {\n        return this.note\n            && this.note.mime === 'text/x-sqlite;schema=trilium'\n            && super.isEnabled();\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$resultContainer = this.$widget.find('.sql-console-result-container');\n        this.$noRowsAlert = this.$widget.find('.sql-query-no-rows');\n    }\n\n    async sqlQueryResultsEvent({ntxId, results}) {\n        if (!this.isNoteContext(ntxId)) {\n            return;\n        }\n\n        this.$noRowsAlert.toggle(results.length === 1 && results[0].length === 0);\n        this.$resultContainer.toggle(results.length > 1 || results[0].length > 0);\n\n        this.$resultContainer.empty();\n\n        for (const rows of results) {\n            if (typeof rows === 'object' && !Array.isArray(rows)) {\n                // inserts, updates\n                this.$resultContainer.empty().show().append(\n                    $(\"<pre>\").text(JSON.stringify(rows, null, '\\t'))\n                );\n\n                continue;\n            }\n\n            if (!rows.length) {\n                continue;\n            }\n\n            const $table = $('<table class=\"table table-striped\">');\n            this.$resultContainer.append($table);\n\n            const result = rows[0];\n            const $row = $(\"<tr>\");\n\n            for (const key in result) {\n                $row.append($(\"<th>\").text(key));\n            }\n\n            $table.append($row);\n\n            for (const result of rows) {\n                const $row = $(\"<tr>\");\n\n                for (const key in result) {\n                    $row.append($(\"<td>\").text(result[key]));\n                }\n\n                $table.append($row);\n            }\n        }\n    }\n}\n","import NoteContextAwareWidget from \"./note_context_aware_widget.js\";\nimport server from \"../services/server.js\";\n\nconst TPL = `\n<div class=\"sql-table-schemas-widget\">\n    <style>\n    .sql-table-schemas-widget {\n        padding: 12px;\n        padding-right: 10%;\n    }\n\n    .sql-table-schemas button {\n        padding: 0.25rem 0.4rem;\n        font-size: 0.875rem;\n        line-height: 0.5;\n        border: 1px solid var(--button-border-color);\n        border-radius: var(--button-border-radius);\n        background: var(--button-background-color);\n        color: var(--button-text-color);\n    }\n\n    .sql-console-result-container {\n        width: 100%;\n        font-size: smaller;\n        margin-top: 10px;\n        flex-grow: 1;\n        overflow: auto;\n        min-height: 0;\n    }\n\n    .table-schema td {\n        padding: 5px;\n    }\n    </style>\n\n    Tables:\n    <span class=\"sql-table-schemas\"></span>\n</div>`;\n\nexport default class SqlTableSchemasWidget extends NoteContextAwareWidget {\n    isEnabled() {\n        return this.note\n            && this.note.mime === 'text/x-sqlite;schema=trilium'\n            && super.isEnabled();\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.contentSized();\n\n        this.$sqlConsoleTableSchemas = this.$widget.find('.sql-table-schemas');\n    }\n\n    async refreshWithNote(note) {\n        if (this.tableSchemasShown) {\n            return;\n        }\n\n        this.tableSchemasShown = true;\n\n        const tableSchema = await server.get('sql/schema');\n\n        for (const table of tableSchema) {\n            const $tableLink = $('<button class=\"btn\">').text(table.name);\n\n            const $table = $('<table class=\"table-schema\">');\n\n            for (const column of table.columns) {\n                $table.append(\n                    $(\"<tr>\")\n                        .append($(\"<td>\").text(column.name))\n                        .append($(\"<td>\").text(column.type))\n                );\n            }\n\n            this.$sqlConsoleTableSchemas.append($tableLink).append(\" \");\n\n            $tableLink.tooltip({\n                html: true,\n                placement: 'bottom',\n                boundary: 'window',\n                title: $table[0].outerHTML,\n                sanitize: false\n            });\n        }\n    }\n}\n","import server from \"../../services/server.js\";\nimport NoteContextAwareWidget from \"../note_context_aware_widget.js\";\nimport toastService from \"../../services/toast.js\";\nimport openService from \"../../services/open.js\";\nimport utils from \"../../services/utils.js\";\nimport protectedSessionHolder from \"../../services/protected_session_holder.js\";\n\nconst TPL = `\n<div class=\"file-properties-widget\">\n    <style> \n        .file-table {\n            width: 100%;\n            margin-top: 10px;\n        }\n        \n        .file-table th, .file-table td {\n            padding: 5px;\n            overflow-wrap: anywhere;\n        }\n        \n        .file-buttons {\n            padding: 10px; \n            display: flex; \n            justify-content: space-evenly;\n        }\n    </style>\n\n    <table class=\"file-table\">\n        <tr>\n            <th>笔记ID:</th>\n            <td class=\"file-note-id\"></td>\n            <th>原始文件名:</th>\n            <td class=\"file-filename\"></td>\n        </tr>\n        <tr>\n            <th>文件类型:</th>\n            <td class=\"file-filetype\"></td>\n            <th>文件大小:</th>\n            <td class=\"file-filesize\"></td>\n        </tr>\n        \n        <tr>\n            <td colspan=\"4\">\n                <div class=\"file-buttons\">\n                    <button class=\"file-download btn btn-sm btn-primary\" type=\"button\">下载</button>\n                    &nbsp;\n                    <button class=\"file-open btn btn-sm btn-primary\" type=\"button\">打开</button>\n                    &nbsp;\n                    <button class=\"file-upload-new-revision btn btn-sm btn-primary\">上传新的修改</button>\n                \n                    <input type=\"file\" class=\"file-upload-new-revision-input\" style=\"display: none\">\n                </div>\n            </td>\n        </tr>\n    </table>\n</div>`;\n\nexport default class FilePropertiesWidget extends NoteContextAwareWidget {\n    get name() {\n        return \"fileProperties\";\n    }\n\n    get toggleCommand() {\n        return \"toggleRibbonTabFileProperties\";\n    }\n\n    isEnabled() {\n        return this.note && this.note.type === 'file';\n    }\n\n    getTitle() {\n        return {\n            show: this.isEnabled(),\n            activate: true,\n            title: '文件',\n            icon: 'bx bx-file'\n        };\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.contentSized();\n        this.$fileNoteId = this.$widget.find(\".file-note-id\");\n        this.$fileName = this.$widget.find(\".file-filename\");\n        this.$fileType = this.$widget.find(\".file-filetype\");\n        this.$fileSize = this.$widget.find(\".file-filesize\");\n        this.$downloadButton = this.$widget.find(\".file-download\");\n        this.$openButton = this.$widget.find(\".file-open\");\n        this.$uploadNewRevisionButton = this.$widget.find(\".file-upload-new-revision\");\n        this.$uploadNewRevisionInput = this.$widget.find(\".file-upload-new-revision-input\");\n\n        this.$downloadButton.on('click', () => openService.downloadFileNote(this.noteId));\n        this.$openButton.on('click', () => openService.openNoteExternally(this.noteId, this.note.mime));\n\n        this.$uploadNewRevisionButton.on(\"click\", () => {\n            this.$uploadNewRevisionInput.trigger(\"click\");\n        });\n\n        this.$uploadNewRevisionInput.on('change', async () => {\n            const fileToUpload = this.$uploadNewRevisionInput[0].files[0]; // copy to allow reset below\n            this.$uploadNewRevisionInput.val('');\n\n            const result = await server.upload(`notes/${this.noteId}/file`, fileToUpload);\n\n            if (result.uploaded) {\n                toastService.showMessage(\"新文件修改已上传.\");\n\n                this.refresh();\n            }\n            else {\n                toastService.showError(\"上传新笔记修改是该:\");\n            }\n        });\n    }\n\n    async refreshWithNote(note) {\n        this.$widget.show();\n\n        this.$fileNoteId.text(note.noteId);\n        this.$fileName.text(note.getLabelValue('originalFileName') || \"?\");\n        this.$fileType.text(note.mime);\n\n        const blob = await this.note.getBlob();\n\n        this.$fileSize.text(utils.formatSize(blob.contentLength));\n\n        // open doesn't work for protected notes since it works through a browser which isn't in protected session\n        this.$openButton.toggle(!note.isProtected);\n        this.$downloadButton.toggle(!note.isProtected || protectedSessionHolder.isProtectedSessionAvailable())\n        this.$uploadNewRevisionButton.toggle(!note.isProtected || protectedSessionHolder.isProtectedSessionAvailable())\n    }\n}\n","import server from \"../../services/server.js\";\nimport NoteContextAwareWidget from \"../note_context_aware_widget.js\";\nimport toastService from \"../../services/toast.js\";\nimport openService from \"../../services/open.js\";\nimport utils from \"../../services/utils.js\";\n\nconst TPL = `\n<div class=\"image-properties\">\n    <div style=\"display: flex; justify-content: space-evenly; margin: 10px;\">\n        <span>\n            <strong>原始文件名:</strong>\n            <span class=\"image-filename\"></span>\n        </span>\n\n        <span>\n            <strong>文件类型:</strong>\n            <span class=\"image-filetype\"></span>\n        </span>\n\n        <span>\n            <strong>文件大小:</strong>\n            <span class=\"image-filesize\"></span>\n        </span>\n    </div>\n    \n    <div class=\"no-print\" style=\"display: flex; justify-content: space-evenly; margin: 10px;\">\n        <button class=\"image-download btn btn-sm btn-primary\" type=\"button\">下载</button>\n\n        <button class=\"image-open btn btn-sm btn-primary\" type=\"button\">打开</button>\n\n        <button class=\"image-copy-reference-to-clipboard btn btn-sm btn-primary\" type=\"button\">复制引用到剪贴板</button>\n\n        <button class=\"image-upload-new-revision btn btn-sm btn-primary\" type=\"button\">上传新的修改</button>\n    </div>\n\n    <input type=\"file\" class=\"image-upload-new-revision-input\" style=\"display: none\">\n</div>`;\n\nexport default class ImagePropertiesWidget extends NoteContextAwareWidget {\n    get name() {\n        return \"imageProperties\";\n    }\n\n    get toggleCommand() {\n        return \"toggleRibbonTabImageProperties\";\n    }\n\n    isEnabled() {\n        return this.note && this.note.type === 'image';\n    }\n\n    getTitle() {\n        return {\n            show: this.isEnabled(),\n            activate: true,\n            title: '图像',\n            icon: 'bx bx-image'\n        };\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.contentSized();\n\n        this.$copyReferenceToClipboardButton = this.$widget.find(\".image-copy-reference-to-clipboard\");\n        this.$copyReferenceToClipboardButton.on('click', () => this.triggerEvent(`copyImageReferenceToClipboard`, {ntxId: this.noteContext.ntxId}));\n\n        this.$uploadNewRevisionButton = this.$widget.find(\".image-upload-new-revision\");\n        this.$uploadNewRevisionInput = this.$widget.find(\".image-upload-new-revision-input\");\n\n        this.$fileName = this.$widget.find(\".image-filename\");\n        this.$fileType = this.$widget.find(\".image-filetype\");\n        this.$fileSize = this.$widget.find(\".image-filesize\");\n\n        this.$openButton = this.$widget.find(\".image-open\");\n        this.$openButton.on('click', () => openService.openNoteExternally(this.noteId, this.note.mime));\n\n        this.$imageDownloadButton = this.$widget.find(\".image-download\");\n        this.$imageDownloadButton.on('click', () => openService.downloadFileNote(this.noteId));\n\n        this.$uploadNewRevisionButton.on(\"click\", () => {\n            this.$uploadNewRevisionInput.trigger(\"click\");\n        });\n\n        this.$uploadNewRevisionInput.on('change', async () => {\n            const fileToUpload = this.$uploadNewRevisionInput[0].files[0]; // copy to allow reset below\n            this.$uploadNewRevisionInput.val('');\n\n            const result = await server.upload(`images/${this.noteId}`, fileToUpload);\n\n            if (result.uploaded) {\n                toastService.showMessage(\"新的图像修改已上传.\");\n\n                await utils.clearBrowserCache();\n\n                this.refresh();\n            }\n            else {\n                toastService.showError(`Upload of a new image revision failed: ${result.message}`);\n            }\n        });\n    }\n\n    async refreshWithNote(note) {\n        this.$widget.show();\n\n        const blob = await this.note.getBlob();\n\n        this.$fileName.text(note.getLabelValue('originalFileName') || \"?\");\n        this.$fileSize.text(utils.formatSize(blob.contentLength));\n        this.$fileType.text(note.mime);\n    }\n}\n","import NoteContextAwareWidget from \"../note_context_aware_widget.js\";\n\nconst TPL = `\n<div class=\"note-properties-widget\">\n    <style>\n        .note-properties-widget {\n            padding: 12px;\n            color: var(--muted-text-color);\n        }\n    </style>\n\n    <div style=\"overflow: hidden; text-overflow: ellipsis; white-space: nowrap\">\n        笔记来源: <a class=\"page-url external\"></a>\n    </div>\n</div>`;\n\n/**\n * TODO: figure out better name or conceptualize better.\n */\nexport default class NotePropertiesWidget extends NoteContextAwareWidget {\n    isEnabled() {\n        return this.note && !!this.note.getLabelValue('pageUrl');\n    }\n\n    getTitle() {\n        return {\n            show: this.isEnabled(),\n            activate: true,\n            title: '信息',\n            icon: 'bx bx-info-square'\n        };\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.contentSized();\n\n        this.$pageUrl = this.$widget.find('.page-url');\n    }\n\n    async refreshWithNote(note) {\n        const pageUrl = note.getLabelValue('pageUrl');\n\n        this.$pageUrl\n            .attr('href', pageUrl)\n            .attr('title', pageUrl)\n            .text(pageUrl);\n    }\n}\n","import NoteContextAwareWidget from \"./note_context_aware_widget.js\";\nimport attributeService from \"../services/attributes.js\";\nimport server from \"../services/server.js\";\n\nconst TPL = `\n<div class=\"note-icon-widget dropdown\">\n    <style>\n    .note-icon-widget {\n        padding-top: 3px;\n        padding-left: 7px;\n        margin-right: 0;\n        width: 50px;\n        height: 50px;\n    }\n    \n    .note-icon-widget button.note-icon {\n        font-size: 180%;\n        background-color: transparent;\n        border: 1px solid transparent;\n        cursor: pointer;\n        padding: 6px;\n        color: var(--main-text-color);\n    }\n    \n    .note-icon-widget button.note-icon:hover {\n        border: 1px solid var(--main-border-color);\n    }\n    \n    .note-icon-widget .dropdown-menu {\n        border-radius: 10px;\n        border-width: 2px;\n        box-shadow: 10px 10px 93px -25px black;\n        padding: 10px 15px 10px 15px !important;\n    }\n    \n    .note-icon-widget .filter-row {\n        padding-top: 10px;\n        padding-bottom: 10px;\n        padding-right: 20px;\n        display: flex; \n        align-items: baseline;\n    }\n    \n    .note-icon-widget .filter-row span {\n        display: block;\n        padding-left: 15px;\n        padding-right: 15px;\n        font-weight: bold;\n    }\n    \n    .note-icon-widget .icon-list {\n        height: 500px;\n        overflow: auto;\n    }\n    \n    .note-icon-widget .icon-list span {\n        display: inline-block;\n        padding: 10px;\n        cursor: pointer;\n        border: 1px solid transparent;\n        font-size: 180%;\n    }\n    \n    .note-icon-widget .icon-list span:hover {\n        border: 1px solid var(--main-border-color);\n    }\n    </style>\n    \n    <button class=\"btn dropdown-toggle note-icon\" type=\"button\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\" title=\"修改笔记图标\"></button>\n    <div class=\"dropdown-menu\" aria-labelledby=\"note-path-list-button\" style=\"width: 610px;\">\n        <div class=\"filter-row\">\n            <span>类别:</span> <select name=\"icon-category\" class=\"form-control\"></select>\n            \n            <span>搜索:</span> <input type=\"text\" name=\"icon-search\" class=\"form-control\" />\n        </div>\n        \n        <div class=\"icon-list\"></div>\n    </div>\n</div>`;\n\nexport default class NoteIconWidget extends NoteContextAwareWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$icon = this.$widget.find('button.note-icon');\n        this.$iconList = this.$widget.find('.icon-list');\n        this.$iconList.on('click', 'span', async e => {\n            const clazz = $(e.target).attr('class');\n\n            await attributeService.setLabel(this.noteId,\n                this.note.hasOwnedLabel('workspace') ? 'workspaceIconClass' : 'iconClass',\n                clazz\n            );\n        });\n\n        this.$iconCategory = this.$widget.find(\"select[name='icon-category']\");\n        this.$iconCategory.on('change', () => this.renderDropdown());\n        this.$iconCategory.on('click', e => e.stopPropagation());\n\n        this.$iconSearch = this.$widget.find(\"input[name='icon-search']\");\n        this.$iconSearch.on('input', () => this.renderDropdown());\n\n        this.$notePathList = this.$widget.find(\".note-path-list\");\n        this.$widget.on('show.bs.dropdown', async () => {\n            const {categories} = (await import('./icon_list.js')).default;\n\n            this.$iconCategory.empty();\n\n            for (const category of categories) {\n                this.$iconCategory.append(\n                    $(\"<option>\")\n                        .text(category.name)\n                        .attr(\"value\", category.id)\n                );\n            }\n\n            this.$iconSearch.val('');\n\n            this.renderDropdown();\n        });\n    }\n\n    async refreshWithNote(note) {\n        this.$icon.removeClass().addClass(`${note.getIcon()} note-icon`);\n    }\n\n    async entitiesReloadedEvent({loadResults}) {\n        if (loadResults.isNoteReloaded(this.noteId)) {\n            this.refresh();\n            return;\n        }\n\n        for (const attr of loadResults.getAttributeRows()) {\n            if (attr.type === 'label'\n                && ['iconClass', 'workspaceIconClass'].includes(attr.name)\n                && attributeService.isAffecting(attr, this.note)) {\n\n                this.refresh();\n                break;\n            }\n        }\n    }\n\n    async renderDropdown() {\n        const iconToCount = await this.getIconToCountMap();\n        const {icons} = (await import('./icon_list.js')).default;\n\n        this.$iconList.empty();\n\n        if (this.getIconLabels().length > 0) {\n            this.$iconList.append(\n                $(`<div style=\"text-align: center\">`)\n                    .append(\n                        $('<button class=\"btn btn-sm\">重置为默认图标</button>')\n                            .on('click', () => this.getIconLabels()\n                                .forEach(label => attributeService.removeAttributeById(this.noteId, label.attributeId))\n                            )\n                    )\n            );\n        }\n\n        const categoryId = parseInt(this.$iconCategory.find('option:selected').val());\n        const search = this.$iconSearch.val().trim().toLowerCase();\n\n        const filteredIcons = icons.filter(icon => {\n            if (categoryId && icon.category_id !== categoryId) {\n                return false;\n            }\n\n            if (search) {\n                if (!icon.name.includes(search) && !icon.term?.find(t => t.includes(search))) {\n                    return false;\n                }\n            }\n\n            return true;\n        });\n\n        filteredIcons.sort((a, b) => {\n            const countA = iconToCount[a.className] || 0;\n            const countB = iconToCount[b.className] || 0;\n\n            return countB - countA;\n        });\n\n        for (const icon of filteredIcons) {\n            this.$iconList.append(this.renderIcon(icon));\n        }\n\n        this.$iconSearch.focus();\n    }\n\n    async getIconToCountMap() {\n        if (!this.iconToCountCache) {\n            this.iconToCountCache = server.get('other/icon-usage');\n            setTimeout(() => this.iconToCountCache = null, 20000); // invalidate cache after 20 seconds\n        }\n\n        return (await this.iconToCountCache).iconClassToCountMap;\n    }\n\n    renderIcon(icon) {\n        return $('<span>')\n            .addClass(\"bx \" + icon.className)\n            .attr(\"title\", icon.name);\n    }\n\n    getIconLabels() {\n        return this.note.getOwnedLabels()\n            .filter(label => ['workspaceIconClass', 'iconClass'].includes(label.name));\n    }\n}\n","import NoteContextAwareWidget from \"./note_context_aware_widget.js\";\nimport NoteListRenderer from \"../services/note_list_renderer.js\";\n\nconst TPL = `\n<div class=\"search-result-widget\">\n    <style>\n    .search-result-widget {\n        flex-grow: 100000;\n        flex-shrink: 100000;\n        min-height: 0;\n        overflow: auto;\n    }\n    \n    .search-result-widget .note-list {\n        padding: 10px;\n    }\n    \n    .search-no-results, .search-not-executed-yet {\n        margin: 20px;\n        padding: 20px;\n    }\n    </style>\n    \n    <div class=\"search-no-results alert alert-info\">\n        没有找到符合搜索条件的笔记.\n    </div>\n    \n    <div class=\"search-not-executed-yet alert alert-info\">\n        点击上方的\"搜索\"按钮开始搜索\n    </div>\n    \n    <div class=\"search-result-widget-content\">\n    </div>\n</div>`;\n\nexport default class SearchResultWidget extends NoteContextAwareWidget {\n    isEnabled() {\n        return super.isEnabled()\n            && this.note.type === 'search';\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.contentSized();\n        this.$content = this.$widget.find('.search-result-widget-content');\n        this.$noResults = this.$widget.find('.search-no-results');\n        this.$notExecutedYet = this.$widget.find('.search-not-executed-yet');\n    }\n\n    async refreshWithNote(note) {\n        this.$content.empty();\n        this.$noResults.toggle(note.getChildNoteIds().length === 0 && !!note.searchResultsLoaded);\n        this.$notExecutedYet.toggle(!note.searchResultsLoaded);\n\n        const noteListRenderer = new NoteListRenderer(this.$content, note, note.getChildNoteIds(), true);\n        await noteListRenderer.renderList();\n    }\n\n    searchRefreshedEvent({ntxId}) {\n        if (!this.isNoteContext(ntxId)) {\n            return;\n        }\n\n        this.refresh();\n    }\n\n    notesReloadedEvent({noteIds}) {\n        if (noteIds.includes(this.noteId)) {\n            this.refresh();\n        }\n    }\n}\n","import Container from \"./container.js\";\n\nexport default class ScrollingContainer extends Container {\n    constructor() {\n        super();\n\n        this.class(\"scrolling-container\");\n        this.css('overflow', 'auto');\n        this.css('scroll-behavior', 'smooth');\n        this.css('position', 'relative');\n    }\n\n    setNoteContextEvent({noteContext}) {\n        /** @var {NoteContext} */\n        this.noteContext = noteContext;\n    }\n\n    async noteSwitchedEvent({noteContext, notePath}) {\n        this.$widget.scrollTop(0);\n    }\n\n    async noteSwitchedAndActivatedEvent({noteContext, notePath}) {\n        this.noteContext = noteContext;\n\n        this.$widget.scrollTop(0);\n    }\n\n    async activeContextChangedEvent({noteContext}) {\n        this.noteContext = noteContext;\n    }\n\n    handleEventInChildren(name, data) {\n        if (name === 'readOnlyTemporarilyDisabled'\n                && this.noteContext\n                && this.noteContext.ntxId === data.noteContext.ntxId) {\n\n            const scrollTop = this.$widget.scrollTop();\n\n            const promise = super.handleEventInChildren(name, data);\n\n            // there seems to be some asynchronicity, and we need to wait a bit before scrolling\n            promise.then(() => setTimeout(() => this.$widget.scrollTop(scrollTop), 500));\n\n            return promise;\n        }\n        else {\n            return super.handleEventInChildren(name, data);\n        }\n    }\n\n    scrollContainerToCommand({position}) {\n        this.$widget.scrollTop(position);\n    }\n}\n","import FlexContainer from \"./flex_container.js\";\n\nexport default class RootContainer extends FlexContainer {\n    constructor() {\n        super('row');\n\n        this.id('root-widget');\n        this.css('height', '100%');\n    }\n}\n","import ws from \"./ws.js\";\nimport appContext from \"../components/app_context.js\";\n\nconst fileModificationStatus = {\n    notes: {},\n    attachments: {}\n};\n\nfunction checkType(type) {\n    if (type !== 'notes' && type !== 'attachments') {\n        throw new Error(`Unrecognized type '${type}', should be 'notes' or 'attachments'`);\n    }\n}\n\nfunction getFileModificationStatus(entityType, entityId) {\n    checkType(entityType);\n\n    return fileModificationStatus[entityType][entityId];\n}\n\nfunction fileModificationUploaded(entityType, entityId) {\n    checkType(entityType);\n\n    delete fileModificationStatus[entityType][entityId];\n}\n\nfunction ignoreModification(entityType, entityId) {\n    checkType(entityType);\n\n    delete fileModificationStatus[entityType][entityId];\n}\n\nws.subscribeToMessages(async message => {\n    if (message.type !== 'openedFileUpdated') {\n        return;\n    }\n\n    checkType(message.entityType);\n\n    fileModificationStatus[message.entityType][message.entityId] = message;\n\n    appContext.triggerEvent('openedFileUpdated', {\n        entityType: message.entityType,\n        entityId: message.entityId,\n        lastModifiedMs: message.lastModifiedMs,\n        filePath: message.filePath\n    });\n});\n\nexport default {\n    getFileModificationStatus,\n    fileModificationUploaded,\n    ignoreModification\n}\n","import NoteContextAwareWidget from \"./note_context_aware_widget.js\";\nimport server from \"../services/server.js\";\nimport fileWatcher from \"../services/file_watcher.js\";\n\nconst TPL = `\n<div class=\"dropdown watched-file-update-status-widget alert alert-warning\">\n    <style>\n        .watched-file-update-status-widget {\n            margin: 10px;\n            contain: none;\n        }\n    </style>\n    \n    <p>文件<code class=\"file-path\"></code> 最后修改于 <span class=\"file-last-modified\"></span>.</p> \n\n    <div style=\"display: flex; flex-direction: row; justify-content: space-evenly;\">\n        <button class=\"btn btn-sm file-upload-button\">上传修改后的文件</button>\n        \n        <button class=\"btn btn-sm ignore-this-change-button\">忽略此修改</button>\n    </div>\n</div>`;\n\nexport default class WatchedFileUpdateStatusWidget extends NoteContextAwareWidget {\n    isEnabled() {\n        const { entityType, entityId } = this.getEntity();\n\n        return super.isEnabled() && !!fileWatcher.getFileModificationStatus(entityType, entityId);\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$filePath = this.$widget.find(\".file-path\");\n        this.$fileLastModified = this.$widget.find(\".file-last-modified\");\n        this.$fileUploadButton = this.$widget.find(\".file-upload-button\");\n\n        this.$fileUploadButton.on(\"click\", async () => {\n            const { entityType, entityId } = this.getEntity();\n\n            await server.post(`${entityType}/${entityId}/upload-modified-file`, {\n                filePath: this.$filePath.text()\n            });\n\n            fileWatcher.fileModificationUploaded(entityType, entityId);\n            this.refresh();\n        });\n\n        this.$ignoreThisChangeButton = this.$widget.find(\".ignore-this-change-button\");\n        this.$ignoreThisChangeButton.on('click', () => {\n            const { entityType, entityId } = this.getEntity();\n\n            fileWatcher.ignoreModification(entityType, entityId);\n            this.refresh();\n        });\n    }\n\n    async refreshWithNote(note) {\n        const { entityType, entityId } = this.getEntity();\n        const status = fileWatcher.getFileModificationStatus(entityType, entityId);\n\n        this.$filePath.text(status.filePath);\n        this.$fileLastModified.text(dayjs.unix(status.lastModifiedMs / 1000).format(\"HH:mm:ss\"));\n    }\n\n    getEntity() {\n        if (!this.noteContext) {\n            return {};\n        }\n\n        const { viewScope } = this.noteContext;\n\n        if (viewScope.viewMode === 'attachments' && viewScope.attachmentId) {\n            return {\n                entityType: 'attachments',\n                entityId: viewScope.attachmentId\n            };\n        } else {\n            return {\n                entityType: 'notes',\n                entityId: this.noteId\n            };\n        }\n    }\n\n    openedFileUpdatedEvent(data) {console.log(data);\n        const { entityType, entityId } = this.getEntity();\n\n        if (data.entityType === entityType && data.entityId === entityId) {\n            this.refresh();\n        }\n    }\n}\n","import BasicWidget from \"./basic_widget.js\";\nimport contextMenu from \"../menus/context_menu.js\";\nimport appContext from \"../components/app_context.js\";\n\nconst TPL = `<div class=\"spacer\"></div>`;\n\nexport default class SpacerWidget extends BasicWidget {\n    constructor(baseSize = 0, growthFactor = 1000) {\n        super();\n\n        this.baseSize = baseSize;\n        this.growthFactor = growthFactor;\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$widget.css(\"flex-basis\", this.baseSize);\n        this.$widget.css(\"flex-grow\", this.growthFactor);\n        this.$widget.css(\"flex-shrink\", 1000);\n\n        this.$widget.on(\"contextmenu\", e => {\n            this.$widget.tooltip(\"hide\");\n\n            contextMenu.show({\n                x: e.pageX,\n                y: e.pageY,\n                items: [\n                    {title: \"配置启动栏\", command: \"showLaunchBarSubtree\", uiIcon: \"bx bx-sidebar\"}\n                ],\n                selectMenuItemHandler: ({command}) => {\n                    appContext.triggerCommand(command);\n                }\n            });\n\n            return false; // blocks default browser right click menu\n        });\n    }\n}\n","import BasicWidget from \"./basic_widget.js\";\nimport server from \"../services/server.js\";\nimport linkService from \"../services/link.js\";\nimport froca from \"../services/froca.js\";\nimport utils from \"../services/utils.js\";\nimport appContext from \"../components/app_context.js\";\nimport shortcutService from \"../services/shortcuts.js\";\n\nconst TPL = `\n<div class=\"quick-search input-group input-group-sm\">\n  <style>\n    .quick-search {\n        padding: 10px 10px 10px 0px;\n        height: 50px;\n    }\n    \n    .quick-search button, .quick-search input {\n        border: 0;\n        font-size: 100% !important;\n    }\n  \n    .quick-search .dropdown-menu {\n        max-height: 600px;\n        max-width: 400px;\n        overflow-y: auto;\n        overflow-x: hidden;\n        text-overflow: ellipsis;\n        box-shadow: -30px 50px 93px -50px black;\n    }\n  </style>\n  \n  <div class=\"input-group-prepend\">\n    <button class=\"btn btn-outline-secondary search-button\" type=\"button\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">\n        <span class=\"bx bx-search\"></span>\n    </button>\n    <div class=\"dropdown-menu dropdown-menu-left\"></div>\n  </div>\n  <input type=\"text\" class=\"form-control form-control-sm search-string\" placeholder=\"快速搜索\">\n  </div>\n</div>`;\n\nconst MAX_DISPLAYED_NOTES = 15;\n\nexport default class QuickSearchWidget extends BasicWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$searchString = this.$widget.find('.search-string');\n        this.$dropdownMenu = this.$widget.find('.dropdown-menu');\n        this.$dropdownToggle = this.$widget.find('.search-button');\n        this.$dropdownToggle.dropdown();\n\n        this.$widget.find('.input-group-prepend').on('shown.bs.dropdown', () => this.search());\n\n        if(utils.isMobile()) {\n            this.$searchString.keydown(e =>{\n                if(e.which === 13) {\n                    if (this.$dropdownMenu.is(\":visible\")) {\n                        this.search(); // just update already visible dropdown\n                    } else {\n                        this.$dropdownToggle.dropdown('show');\n                    }\n                    e.preventDefault();\n                    e.stopPropagation();\n                }\n            })\n        }\n\n        shortcutService.bindElShortcut(this.$searchString, 'return', () => {\n            if (this.$dropdownMenu.is(\":visible\")) {\n                this.search(); // just update already visible dropdown\n            } else {\n                this.$dropdownToggle.dropdown('show');\n            }\n\n            this.$searchString.focus();\n        });\n\n        shortcutService.bindElShortcut(this.$searchString, 'down', () => {\n            this.$dropdownMenu.find('.dropdown-item:first').focus();\n        });\n\n        shortcutService.bindElShortcut(this.$searchString, 'esc', () => {\n            this.$dropdownToggle.dropdown('hide');\n        });\n\n        return this.$widget;\n    }\n\n    async search() {\n        const searchString = this.$searchString.val().trim();\n\n        if (!searchString) {\n            this.$dropdownToggle.dropdown(\"hide\");\n            return;\n        }\n\n        this.$dropdownMenu.empty();\n        this.$dropdownMenu.append('<span class=\"dropdown-item disabled\"><span class=\"bx bx-loader bx-spin\"></span>正在搜索...</span>');\n\n        const {searchResultNoteIds, error} = await server.get(`quick-search/${encodeURIComponent(searchString)}`);\n\n        if (error) {\n            this.$searchString.tooltip({\n                trigger: 'manual',\n                title: `Search error: ${error}`,\n                placement: 'right'\n            });\n\n            this.$searchString.tooltip(\"show\");\n\n            setTimeout(() => this.$searchString.tooltip(\"dispose\"), 4000);\n        }\n\n        const displayedNoteIds = searchResultNoteIds.slice(0, Math.min(MAX_DISPLAYED_NOTES, searchResultNoteIds.length));\n\n        this.$dropdownMenu.empty();\n\n        if (displayedNoteIds.length === 0) {\n            this.$dropdownMenu.append('<span class=\"dropdown-item disabled\">没有找到结果</span>');\n        }\n\n        for (const note of await froca.getNotes(displayedNoteIds)) {\n            const $link = await linkService.createLink(note.noteId, {showNotePath: true});\n            $link.addClass('dropdown-item');\n            $link.attr(\"tabIndex\", \"0\");\n            $link.on('click', e => {\n                this.$dropdownToggle.dropdown(\"hide\");\n\n                if (!e.target || e.target.nodeName !== 'A') {\n                    // click on the link is handled by link handling, but we want the whole item clickable\n                    appContext.tabManager.getActiveContext().setNote(note.noteId);\n                }\n            });\n            shortcutService.bindElShortcut($link, 'return', () => {\n                this.$dropdownToggle.dropdown(\"hide\");\n\n                appContext.tabManager.getActiveContext().setNote(note.noteId);\n            });\n\n            this.$dropdownMenu.append($link);\n        }\n\n        if (searchResultNoteIds.length > MAX_DISPLAYED_NOTES) {\n            this.$dropdownMenu.append(`<span class=\"dropdown-item disabled\">... 以及另外 ${searchResultNoteIds.length - MAX_DISPLAYED_NOTES} 个结果</span>`);\n        }\n\n        const $showInFullButton = $('<a class=\"dropdown-item\" tabindex=\"0\">')\n            .append($('<button class=\"btn btn-sm\">在搜索中显示</button>'));\n\n        this.$dropdownMenu.append($showInFullButton);\n\n        $showInFullButton.on('click', () => this.showInFullSearch());\n\n        shortcutService.bindElShortcut($showInFullButton, 'return', () => this.showInFullSearch());\n\n        shortcutService.bindElShortcut(this.$dropdownMenu.find('.dropdown-item:first'), 'up', () => this.$searchString.focus());\n\n        this.$dropdownToggle.dropdown('update');\n    }\n\n    async showInFullSearch() {\n        this.$dropdownToggle.dropdown(\"hide\");\n\n        await appContext.triggerCommand('searchNotes', {\n            searchString: this.$searchString.val()\n        });\n    }\n\n    quickSearchEvent() {\n        this.$searchString.focus();\n    }\n}\n","import FlexContainer from \"./flex_container.js\";\nimport appContext from \"../../components/app_context.js\";\n\nexport default class SplitNoteContainer extends FlexContainer {\n    constructor(widgetFactory) {\n        super('row');\n\n        this.widgetFactory = widgetFactory;\n        this.widgets = {};\n\n        this.class('split-note-container-widget');\n        this.css('flex-grow', '1');\n        this.collapsible();\n    }\n\n    async newNoteContextCreatedEvent({noteContext}) {\n        const widget = this.widgetFactory();\n\n        const $renderedWidget = widget.render();\n\n        $renderedWidget.attr(\"data-ntx-id\", noteContext.ntxId);\n        $renderedWidget.on('click', () => appContext.tabManager.activateNoteContext(noteContext.ntxId));\n\n        this.$widget.append($renderedWidget);\n\n        widget.handleEvent('initialRenderComplete');\n\n        widget.toggleExt(false);\n\n        this.widgets[noteContext.ntxId] = widget;\n\n        await widget.handleEvent('setNoteContext', { noteContext });\n\n        this.child(widget);\n    }\n\n    async openNewNoteSplitEvent({ntxId, notePath, hoistedNoteId, viewScope}) {\n        const mainNtxId = appContext.tabManager.getActiveMainContext().ntxId;\n\n        if (!ntxId) {\n            logError(\"empty ntxId!\");\n\n            ntxId = mainNtxId;\n        }\n\n        hoistedNoteId = hoistedNoteId || appContext.tabManager.getActiveContext().hoistedNoteId;\n\n        const noteContext = await appContext.tabManager.openEmptyTab(null, hoistedNoteId, mainNtxId);\n\n        // remove the original position of newly created note context\n        const ntxIds = appContext.tabManager.children.map(c => c.ntxId)\n            .filter(id => id !== noteContext.ntxId);\n\n        // insert the note context after the originating note context\n        ntxIds.splice(ntxIds.indexOf(ntxId) + 1, 0, noteContext.ntxId);\n\n        this.triggerCommand(\"noteContextReorder\", {ntxIdsInOrder: ntxIds});\n\n        // move the note context rendered widget after the originating widget\n        this.$widget.find(`[data-ntx-id=\"${noteContext.ntxId}\"]`)\n            .insertAfter(this.$widget.find(`[data-ntx-id=\"${ntxId}\"]`));\n\n        await appContext.tabManager.activateNoteContext(noteContext.ntxId);\n\n        if (notePath) {\n            await noteContext.setNote(notePath, viewScope);\n        }\n        else {\n            await noteContext.setEmpty();\n        }\n    }\n\n    closeThisNoteSplitCommand({ntxId}) {\n        appContext.tabManager.removeNoteContext(ntxId);\n    }\n\n    async moveThisNoteSplitCommand({ntxId, isMovingLeft}) {\n        if (!ntxId) {\n            logError(\"empty ntxId!\");\n            return;\n        }\n\n        const contexts = appContext.tabManager.noteContexts;\n\n        const currentIndex = contexts.findIndex(c => c.ntxId === ntxId);\n        const leftIndex = isMovingLeft ? currentIndex - 1 : currentIndex;\n\n        if (currentIndex === -1 || leftIndex < 0 || leftIndex + 1 >= contexts.length) {\n            logError(`invalid context! currentIndex: ${currentIndex}, leftIndex: ${leftIndex}, contexts.length: ${contexts.length}`);\n            return;\n        }\n\n        if (contexts[leftIndex].isEmpty() && contexts[leftIndex + 1].isEmpty()) {\n            // no op\n            return;\n        }\n\n        const ntxIds = contexts.map(c => c.ntxId);\n        const newNtxIds = [\n            ...ntxIds.slice(0, leftIndex),\n            ntxIds[leftIndex + 1],\n            ntxIds[leftIndex],\n            ...ntxIds.slice(leftIndex + 2),\n        ];\n        const isChangingMainContext = !contexts[leftIndex].mainNtxId;\n\n        this.triggerCommand(\"noteContextReorder\", {\n            ntxIdsInOrder: newNtxIds,\n            oldMainNtxId: isChangingMainContext ? ntxIds[leftIndex] : null,\n            newMainNtxId: isChangingMainContext ? ntxIds[leftIndex + 1]: null,\n        });\n\n        // reorder the note context widgets\n        this.$widget.find(`[data-ntx-id=\"${ntxIds[leftIndex]}\"]`)\n            .insertAfter(this.$widget.find(`[data-ntx-id=\"${ntxIds[leftIndex + 1]}\"]`));\n\n        // activate context that now contains the original note\n        await appContext.tabManager.activateNoteContext(isMovingLeft ? ntxIds[leftIndex + 1] : ntxIds[leftIndex]);\n    }\n\n    activeContextChangedEvent() {\n        this.refresh();\n    }\n\n    noteSwitchedAndActivatedEvent() {\n        this.refresh();\n    }\n\n    noteContextRemovedEvent({ntxIds}) {\n        this.children = this.children.filter(c => !ntxIds.includes(c.ntxId));\n\n        for (const ntxId of ntxIds) {\n            this.$widget.find(`[data-ntx-id=\"${ntxId}\"]`).remove();\n\n            delete this.widgets[ntxId];\n        }\n    }\n\n    contextsReopenedEvent({ntxId, afterNtxId}) {\n        if (ntxId === undefined || afterNtxId === undefined) {\n            // no single split reopened\n            return;\n        }\n        this.$widget.find(`[data-ntx-id=\"${ntxId}\"]`)\n            .insertAfter(this.$widget.find(`[data-ntx-id=\"${afterNtxId}\"]`));\n    }\n\n    async refresh() {\n        this.toggleExt(true);\n    }\n\n    toggleInt(show) {} // not needed\n\n    toggleExt(show) {\n        const activeMainContext = appContext.tabManager.getActiveMainContext();\n        const activeNtxId = activeMainContext ? activeMainContext.ntxId : null;\n\n        for (const ntxId in this.widgets) {\n            const noteContext = appContext.tabManager.getNoteContextById(ntxId);\n\n            const widget = this.widgets[ntxId];\n            widget.toggleExt(show && activeNtxId && [noteContext.ntxId, noteContext.mainNtxId].includes(activeNtxId));\n        }\n    }\n\n    /**\n     * widget.hasBeenAlreadyShown is intended for lazy loading of cached tabs - initial note switches of new tabs\n     * are not executed, we're waiting for the first tab activation, and then we update the tab. After this initial\n     * activation, further note switches are always propagated to the tabs.\n     */\n    handleEventInChildren(name, data) {\n        if (['noteSwitched', 'noteSwitchedAndActivated'].includes(name)) {\n            // this event is propagated only to the widgets of a particular tab\n            const widget = this.widgets[data.noteContext.ntxId];\n\n            if (!widget) {\n                return Promise.resolve();\n            }\n\n            if (widget.hasBeenAlreadyShown\n                || name === 'noteSwitchedAndActivated'\n                || appContext.tabManager.getActiveMainContext() === data.noteContext.getMainContext()\n            ) {\n                widget.hasBeenAlreadyShown = true;\n\n                return [\n                    widget.handleEvent('noteSwitched', data),\n                    this.refreshNotShown(data)\n                ];\n            }\n            else {\n                return Promise.resolve();\n            }\n        }\n\n        if (name === 'activeContextChanged') {\n            return this.refreshNotShown(data);\n        } else {\n            return super.handleEventInChildren(name, data);\n        }\n    }\n\n    refreshNotShown(data) {\n        const promises = [];\n\n        for (const subContext of data.noteContext.getMainContext().getSubContexts()) {\n            const widget = this.widgets[subContext.ntxId];\n\n            if (!widget.hasBeenAlreadyShown) {\n                widget.hasBeenAlreadyShown = true;\n\n                promises.push(widget.handleEvent('activeContextChanged', {noteContext: subContext}));\n            }\n        }\n\n        this.refresh();\n\n        return Promise.all(promises);\n    }\n}\n","import options from \"./options.js\";\n\nlet leftInstance;\nlet rightInstance;\n\nfunction setupLeftPaneResizer(leftPaneVisible) {\n    if (leftInstance) {\n        leftInstance.destroy();\n        leftInstance = null;\n    }\n\n    $(\"#left-pane\").toggle(leftPaneVisible);\n\n    if (!leftPaneVisible) {\n        $(\"#rest-pane\").css('width', '100%');\n\n        return;\n    }\n\n    let leftPaneWidth = options.getInt('leftPaneWidth');\n    if (!leftPaneWidth || leftPaneWidth < 5) {\n        leftPaneWidth = 5;\n    }\n\n    if (leftPaneVisible) {\n        leftInstance = Split(['#left-pane', '#rest-pane'], {\n            sizes: [leftPaneWidth, 100 - leftPaneWidth],\n            gutterSize: 5,\n            onDragEnd: sizes => options.save('leftPaneWidth', Math.round(sizes[0]))\n        });\n    }\n}\n\nfunction setupRightPaneResizer() {\n    if (rightInstance) {\n        rightInstance.destroy();\n        rightInstance = null;\n    }\n\n    const rightPaneVisible = $(\"#right-pane\").is(\":visible\");\n\n    if (!rightPaneVisible) {\n        $(\"#center-pane\").css('width', '100%');\n\n        return;\n    }\n\n    let rightPaneWidth = options.getInt('rightPaneWidth');\n    if (!rightPaneWidth || rightPaneWidth < 5) {\n        rightPaneWidth = 5;\n    }\n\n    if (rightPaneVisible) {\n        rightInstance = Split(['#center-pane', '#right-pane'], {\n            sizes: [100 - rightPaneWidth, rightPaneWidth],\n            gutterSize: 5,\n            onDragEnd: sizes => options.save('rightPaneWidth', Math.round(sizes[1]))\n        });\n    }\n}\n\nexport default {\n    setupLeftPaneResizer,\n    setupRightPaneResizer,\n};\n","import NoteContextAwareWidget from \"../note_context_aware_widget.js\";\n\nconst TPL = `<button class=\"button-widget bx\"\n      data-toggle=\"tooltip\"\n      title=\"\"></button>`;\n\nexport default class AbstractButtonWidget extends NoteContextAwareWidget {\n    isEnabled() {\n        return true;\n    }\n\n    constructor() {\n        super();\n\n        this.settings = {\n            titlePlacement: 'right',\n            title: null,\n            icon: null,\n            onContextMenu: null\n        };\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n\n        if (this.settings.onContextMenu) {\n            this.$widget.on(\"contextmenu\", e => {\n                this.$widget.tooltip(\"hide\");\n\n                this.settings.onContextMenu(e);\n\n                return false; // blocks default browser right click menu\n            });\n        }\n\n        this.$widget.attr(\"data-placement\", this.settings.titlePlacement);\n\n        this.$widget.tooltip({\n            html: true,\n            title: () => this.getTitle(),\n            trigger: \"hover\"\n        });\n\n        super.doRender();\n    }\n\n    getTitle() {\n        return typeof this.settings.title === \"function\"\n            ? this.settings.title()\n            : this.settings.title;\n    }\n\n    refreshIcon() {\n        for (const className of this.$widget[0].classList) {\n            if (className.startsWith(\"bx-\")) {\n                this.$widget.removeClass(className);\n            }\n        }\n\n        const icon = typeof this.settings.icon === \"function\"\n            ? this.settings.icon()\n            : this.settings.icon;\n\n        this.$widget.addClass(icon);\n    }\n\n    initialRenderCompleteEvent() {\n        this.refreshIcon();\n    }\n\n    /** @param {string|function} icon */\n    icon(icon) {\n        this.settings.icon = icon;\n        return this;\n    }\n\n    /** @param {string|function} title */\n    title(title) {\n        this.settings.title = title;\n        return this;\n    }\n\n    /** @param {string} placement - \"top\", \"bottom\", \"left\", \"right\" */\n    titlePlacement(placement) {\n        this.settings.titlePlacement = placement;\n        return this;\n    }\n\n    onContextMenu(handler) {\n        this.settings.onContextMenu = handler;\n        return this;\n    }\n}\n","import keyboardActionsService from \"../../services/keyboard_actions.js\";\nimport AbstractButtonWidget from \"./abstract_button.js\";\n\nlet actions;\n\nkeyboardActionsService.getActions().then(as => actions = as);\n\nexport default class CommandButtonWidget extends AbstractButtonWidget {\n    doRender() {\n        super.doRender();\n\n        if (this.settings.command) {\n            this.$widget.on(\"click\", () => {\n                this.$widget.tooltip(\"hide\");\n\n                this.triggerCommand(this._command);\n            });\n        } else {\n            console.warn(`Button widget '${this.componentId}' has no defined command`, this.settings);\n        }\n    }\n\n    getTitle() {\n        const title = super.getTitle();\n\n        const action = actions.find(act => act.actionName === this._command);\n\n        if (action && action.effectiveShortcuts.length > 0) {\n            return `${title} (${action.effectiveShortcuts.join(\", \")})`;\n        } else {\n            return title;\n        }\n    }\n\n    onClick(handler) {\n        this.settings.onClick = handler;\n        return this;\n    }\n\n    /**\n     * @param {function|string} command\n     * @returns {this}\n     */\n    command(command) {\n        this.settings.command = command;\n        return this;\n    }\n\n    get _command() {\n        return typeof this.settings.command === \"function\"\n            ? this.settings.command()\n            : this.settings.command;\n    }\n}\n","import options from \"../../services/options.js\";\nimport splitService from \"../../services/resizer.js\";\nimport CommandButtonWidget from \"./command_button.js\";\n\nexport default class LeftPaneToggleWidget extends CommandButtonWidget {\n    constructor() {\n        super();\n\n        this.class(\"launcher-button\");\n\n        this.settings.icon = () => options.is('leftPaneVisible')\n            ? \"bx-chevrons-left\"\n            : \"bx-chevrons-right\";\n\n        this.settings.title = () => options.is('leftPaneVisible')\n            ? \"隐藏面板\"\n            : \"打开面板\";\n\n        this.settings.command = () => options.is('leftPaneVisible')\n            ? \"hideLeftPane\"\n            : \"showLeftPane\";\n    }\n\n    refreshIcon() {\n        super.refreshIcon();\n\n        splitService.setupLeftPaneResizer(options.is('leftPaneVisible'));\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.isOptionReloaded(\"leftPaneVisible\")) {\n            this.refreshIcon();\n        }\n    }\n}\n","import AbstractButtonWidget from \"./abstract_button.js\";\n\nexport default class OnClickButtonWidget extends AbstractButtonWidget {\n    doRender() {\n        super.doRender();\n\n        if (this.settings.onClick) {\n            this.$widget.on(\"click\", e => {\n                e.stopPropagation();\n                this.$widget.tooltip(\"hide\");\n\n                this.settings.onClick(this, e);\n            });\n        } else {\n            console.warn(`Button widget '${this.componentId}' has no defined click handler`, this.settings);\n        }\n\n        if (this.settings.onAuxClick) {\n            this.$widget.on(\"auxclick\", e => {\n                this.$widget.tooltip(\"hide\");\n\n                this.settings.onAuxClick(this, e);\n            });\n        }\n    }\n\n    onClick(handler) {\n        this.settings.onClick = handler;\n        return this;\n    }\n\n    onAuxClick(handler) {\n        this.settings.onAuxClick = handler;\n        return this;\n    }\n}\n","import OnClickButtonWidget from \"./onclick_button.js\";\n\nexport default class CreatePaneButton extends OnClickButtonWidget {\n    constructor() {\n        super();\n\n        this.icon(\"bx-dock-right\")\n            .title(\"拆分面板\")\n            .titlePlacement(\"bottom\")\n            .onClick(widget => widget.triggerCommand(\"openNewNoteSplit\", { ntxId: widget.getClosestNtxId() }))\n            .class(\"icon-action\");\n    }\n}\n","import OnClickButtonWidget from \"./onclick_button.js\";\n\nexport default class ClosePaneButton extends OnClickButtonWidget {\n    isEnabled() {\n        return super.isEnabled()\n            // main note context should not be closeable\n            && this.noteContext && !!this.noteContext.mainNtxId;\n    }\n\n    async noteContextReorderEvent({ntxIdsInOrder}) {\n        this.refresh();\n    }\n\n    constructor() {\n        super();\n\n        this.icon(\"bx-x\")\n            .title(\"关闭面板\")\n            .titlePlacement(\"bottom\")\n            .onClick((widget, e) => {\n                // to avoid split pane container detecting click within the pane which would try to activate this\n                // pane (which is being removed)\n                e.stopPropagation();\n\n                widget.triggerCommand(\"closeThisNoteSplit\", { ntxId: widget.getClosestNtxId() });\n            })\n            .class(\"icon-action\");\n    }\n}\n","import server from '../services/server.js';\nimport mimeTypesService from '../services/mime_types.js';\nimport NoteContextAwareWidget from \"./note_context_aware_widget.js\";\nimport dialogService from \"../services/dialog.js\";\n\nconst NOTE_TYPES = [\n    { type: \"file\", title: \"文件\", selectable: false },\n    { type: \"image\", title: \"图像\", selectable: false },\n    { type: \"search\", title: \"保存的搜索\", selectable: false },\n    { type: \"noteMap\", mime: '', title: \"笔记地图\", selectable: false },\n    { type: \"launcher\", mime: '', title: \"启动栏\", selectable: false },\n    { type: \"doc\", mime: '', title: \"文档\", selectable: false },\n    { type: \"contentWidget\", mime: '', title: \"部件\", selectable: false },\n\n    { type: \"text\", mime: \"text/html\", title: \"文本\", selectable: true },\n    { type: \"relationMap\", mime: \"application/json\", title: \"关系图\", selectable: true },\n    { type: \"render\", mime: '', title: \"渲染笔记\", selectable: true },\n    { type: \"canvas\", mime: 'application/json', title: \"画布\", selectable: true },\n    { type: \"mermaid\", mime: 'text/mermaid', title: \"美人鱼图\", selectable: true },\n    { type: \"book\", mime: '', title: \"书\", selectable: true },\n    { type: \"webView\", mime: '', title: \"网页视图\", selectable: true },\n    { type: \"code\", mime: 'text/plain', title: \"代码\", selectable: true }\n];\n\nconst NOT_SELECTABLE_NOTE_TYPES = NOTE_TYPES.filter(nt => !nt.selectable).map(nt => nt.type);\n\nconst TPL = `\n<div class=\"dropdown note-type-widget\">\n    <style>\n    .note-type-dropdown {\n        max-height: 500px;\n        overflow-y: auto;\n        overflow-x: hidden;\n    }\n    </style>\n    <button type=\"button\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\" class=\"btn btn-sm dropdown-toggle note-type-button\">\n        <span class=\"note-type-desc\"></span>\n        <span class=\"caret\"></span>\n    </button>\n    <div class=\"note-type-dropdown dropdown-menu dropdown-menu-left\"></div>\n</div>\n`;\n\nexport default class NoteTypeWidget extends NoteContextAwareWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$widget.on('show.bs.dropdown', () => this.renderDropdown());\n\n        this.$noteTypeDropdown = this.$widget.find(\".note-type-dropdown\");\n        this.$noteTypeButton = this.$widget.find(\".note-type-button\");\n        this.$noteTypeDesc = this.$widget.find(\".note-type-desc\");\n\n        this.$widget.on('click', '.dropdown-item',\n            () => this.$widget.find('.dropdown-toggle').dropdown('toggle'));\n    }\n\n    async refreshWithNote(note) {\n        this.$noteTypeButton.prop(\"disabled\",\n            () => NOT_SELECTABLE_NOTE_TYPES.includes(note.type));\n\n        this.$noteTypeDesc.text(await this.findTypeTitle(note.type, note.mime));\n\n        this.$noteTypeButton.dropdown('hide');\n    }\n\n    /** the actual body is rendered lazily on note-type button click */\n    async renderDropdown() {\n        this.$noteTypeDropdown.empty();\n\n        for (const noteType of NOTE_TYPES.filter(nt => nt.selectable)) {\n            const $typeLink = $('<a class=\"dropdown-item\">')\n                .attr(\"data-note-type\", noteType.type)\n                .append('<span class=\"check\">&check;</span> ')\n                .append($('<strong>').text(noteType.title))\n                .on('click', e => {\n                    const type = $typeLink.attr('data-note-type');\n                    const noteType = NOTE_TYPES.find(nt => nt.type === type);\n\n                    this.save(noteType.type, noteType.mime);\n                });\n\n            if (this.note.type === noteType.type) {\n                $typeLink.addClass(\"selected\");\n            }\n\n            this.$noteTypeDropdown.append($typeLink);\n\n            if (noteType.type !== 'code') {\n                this.$noteTypeDropdown.append('<div class=\"dropdown-divider\"></div>');\n            }\n        }\n\n        for (const mimeType of await mimeTypesService.getMimeTypes()) {\n            if (!mimeType.enabled) {\n                continue;\n            }\n\n            const $mimeLink = $('<a class=\"dropdown-item\">')\n                .attr(\"data-mime-type\", mimeType.mime)\n                .append('<span class=\"check\">&check;</span> ')\n                .append($('<span>').text(mimeType.title))\n                .on('click', e => {\n                    const $link = $(e.target).closest('.dropdown-item');\n\n                    this.save('code', $link.attr('data-mime-type'));\n                });\n\n            if (this.note.type === 'code' && this.note.mime === mimeType.mime) {\n                $mimeLink.addClass(\"selected\");\n\n                this.$noteTypeDesc.text(mimeType.title);\n            }\n\n            this.$noteTypeDropdown.append($mimeLink);\n        }\n    }\n\n    async findTypeTitle(type, mime) {\n        if (type === 'code') {\n            const mimeTypes = await mimeTypesService.getMimeTypes();\n            const found = mimeTypes.find(mt => mt.mime === mime);\n\n            return found ? found.title : mime;\n        }\n        else {\n            const noteType = NOTE_TYPES.find(nt => nt.type === type);\n\n            return noteType ? noteType.title : type;\n        }\n    }\n\n    async save(type, mime) {\n        if (type === this.note.type && mime === this.note.mime) {\n            return;\n        }\n\n        if (type !== this.note.type && !await this.confirmChangeIfContent()) {\n            return;\n        }\n\n        await server.put(`notes/${this.noteId}/type`, { type, mime });\n    }\n\n    async confirmChangeIfContent() {\n        const blob = await this.note.getBlob();\n\n        if (!blob.content || !blob.content.trim().length) {\n            return true;\n        }\n\n        return await dialogService.confirm(\"不建议在笔记有内容的情况下修改笔记类型, 是否要继续?\");\n    }\n\n    async entitiesReloadedEvent({loadResults}) {\n        if (loadResults.isNoteReloaded(this.noteId)) {\n            this.refresh();\n        }\n    }\n}\n","import NoteContextAwareWidget from \"./note_context_aware_widget.js\";\n\nconst TPL = `\n<div class=\"switch-widget\">\n    <style>    \n    .switch-widget {\n        display: flex;\n        align-items: center;\n    }\n    \n    /* The switch - the box around the slider */\n    .switch-widget .switch {\n        position: relative;\n        display: block;\n        width: 50px;\n        height: 24px;\n        margin: 0;\n    }\n    \n    .switch-on, .switch-off {\n        display: flex;\n    }\n    \n    /* The slider */\n    .switch-widget .slider {\n        border-radius: 24px;\n        position: absolute;\n        cursor: pointer;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background-color: var(--more-accented-background-color);\n        transition: .4s;\n    }\n    \n    .switch-widget .slider:before {\n        border-radius: 50%;\n        position: absolute;\n        content: \"\";\n        height: 16px;\n        width: 16px;\n        left: 4px;\n        bottom: 4px;\n        background-color: var(--main-background-color);\n        -webkit-transition: .4s;\n        transition: .4s;\n    }\n    \n    .switch-widget .slider.checked {\n        background-color: var(--main-text-color);\n    }\n    \n    .switch-widget .slider.checked:before {\n        transform: translateX(26px);\n    }\n    \n    .switch-widget .switch-disabled {\n        opacity: 70%;\n        pointer-events: none;\n    }\n    \n    .switch-widget .switch-help-button {\n        font-weight: 900;\n        border: 0;\n        background: none;\n        cursor: pointer;\n        color: var(--main-text-color);\n    }\n    </style>\n\n    <div class=\"switch-on\">\n        <span class=\"switch-on-name\"></span>\n    \n        &nbsp;\n    \n        <span class=\"switch-on-button\">\n            <label class=\"switch\">\n            <span class=\"slider\"></span>\n        </span>\n    </div>\n    <div class=\"switch-off\">\n        <span class=\"switch-off-name\"></span>\n        \n        &nbsp;\n    \n        <span class=\"switch-off-button\">\n            <label class=\"switch\">\n            <span class=\"slider checked\"></span>\n        </span>\n    </div>\n    \n    <button class=\"switch-help-button\" type=\"button\" data-help-page=\"\" title=\"打开帮助页\" style=\"display: none;\">?</button>\n</div>`;\n\nexport default class SwitchWidget extends NoteContextAwareWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$switchOn = this.$widget.find(\".switch-on\");\n        this.$switchOnName = this.$widget.find(\".switch-on-name\");\n        this.$switchOnButton = this.$widget.find(\".switch-on-button\");\n\n        this.$switchOnButton.on('click', () => this.toggle(true));\n\n        this.$switchOff = this.$widget.find(\".switch-off\");\n        this.$switchOffName = this.$widget.find(\".switch-off-name\");\n        this.$switchOffButton = this.$widget.find(\".switch-off-button\");\n\n        this.$switchOffButton.on('click', () => this.toggle(false));\n\n        this.$helpButton = this.$widget.find(\".switch-help-button\");\n    }\n\n    toggle(state) {\n        if (state) {\n            this.switchOn();\n        } else {\n            this.switchOff();\n        }\n    }\n\n    switchOff() {}\n    switchOn() {}\n}\n","import protectedSessionService from \"../services/protected_session.js\";\nimport SwitchWidget from \"./switch.js\";\n\nexport default class ProtectedNoteSwitchWidget extends SwitchWidget {\n    doRender() {\n        super.doRender();\n\n        this.$switchOnName.text(\"保护笔记\");\n        this.$switchOnButton.attr(\"title\", \"笔记不受保护, 点击以使其受保护\");\n\n        this.$switchOffName.text(\"取消保护笔记\");\n        this.$switchOffButton.attr(\"title\", \"笔记已受保护, 点击以使其不受保护\");\n    }\n\n    switchOn() {\n        protectedSessionService.protectNote(this.noteId, true, false);\n    }\n\n    switchOff() {\n        protectedSessionService.protectNote(this.noteId, false, false)\n    }\n\n    async refreshWithNote(note) {\n        this.$switchOn.toggle(!note.isProtected);\n        this.$switchOff.toggle(!!note.isProtected);\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.isNoteReloaded(this.noteId)) {\n            this.refresh();\n        }\n    }\n}\n","import attributeService from '../services/attributes.js';\nimport NoteContextAwareWidget from \"./note_context_aware_widget.js\";\n\nconst TPL = `\n<div class=\"dropdown editability-select-widget\">\n    <style>\n    .editability-dropdown {\n        width: 300px;\n    }\n    \n    .editability-dropdown .dropdown-item div {\n        font-size: small;\n        color: var(--muted-text-color);\n        white-space: normal;\n    }\n    </style>\n    <button type=\"button\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\" class=\"btn btn-sm dropdown-toggle editability-button\">\n        <span class=\"editability-active-desc\">自动</span>\n        <span class=\"caret\"></span>\n    </button>\n    <div class=\"editability-dropdown dropdown-menu dropdown-menu-right\">\n        <a class=\"dropdown-item\" href=\"#\" data-editability=\"auto\">\n            <span class=\"check\">&check;</span>\n            自动\n            <div>短笔记是可编辑的.</div>    \n        </a>\n        <a class=\"dropdown-item\" href=\"#\" data-editability=\"readOnly\">\n            <span class=\"check\">&check;</span>\n            只读\n            <div>笔记是只读的, 但可以通过单击一个按钮进行编辑.</div>\n        </a>\n        <a class=\"dropdown-item\" href=\"#\" data-editability=\"autoReadOnlyDisabled\">\n            <span class=\"check\">&check;</span>\n            总是可编辑的\n            <div>笔记总是可编辑的, 无论其长度如何.</div>\n        </a>\n    </div>\n</div>\n`;\n\nexport default class EditabilitySelectWidget extends NoteContextAwareWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$editabilityActiveDesc = this.$widget.find(\".editability-active-desc\");\n\n        this.$widget.on('click', '.dropdown-item',\n            async e => {\n            this.$widget.find('.dropdown-toggle').dropdown('toggle');\n\n            const editability = $(e.target).closest(\"[data-editability]\").attr(\"data-editability\");\n\n            for (const ownedAttr of this.note.getOwnedLabels()) {\n                if (['readOnly', 'autoReadOnlyDisabled'].includes(ownedAttr.name)) {\n                    await attributeService.removeAttributeById(this.noteId, ownedAttr.attributeId);\n                }\n            }\n\n            if (editability !== 'auto') {\n                await attributeService.addLabel(this.noteId, editability);\n            }\n        });\n    }\n\n    async refreshWithNote(note) {\n        let editability = 'auto'\n\n        if (this.note.isLabelTruthy('readOnly')) {\n            editability = 'readOnly';\n        }\n        else if (this.note.isLabelTruthy('autoReadOnlyDisabled')) {\n            editability = 'autoReadOnlyDisabled';\n        }\n\n        const labels = {\n            \"auto\": \"自动\",\n            \"readOnly\": \"只读\",\n            \"autoReadOnlyDisabled\": \"总是可编辑的\"\n        }\n\n        this.$widget.find('.dropdown-item').removeClass(\"selected\");\n        this.$widget.find(`.dropdown-item[data-editability='${editability}']`).addClass(\"selected\");\n\n        this.$editabilityActiveDesc.text(labels[editability]);\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.getAttributeRows().find(attr => attr.noteId === this.noteId)) {\n            this.refresh();\n        }\n    }\n}\n","import SwitchWidget from \"./switch.js\";\nimport server from \"../services/server.js\";\nimport toastService from \"../services/toast.js\";\n\nexport default class BookmarkSwitchWidget extends SwitchWidget {\n    isEnabled() {\n        return super.isEnabled()\n            // it's not possible to bookmark root because that would clone it under bookmarks and thus create a cycle\n            && !['root', '_hidden'].includes(this.noteId);\n    }\n\n    doRender() {\n        super.doRender();\n\n        this.$switchOnName.text(\"书签\");\n        this.$switchOnButton.attr(\"title\", \"将此笔记添加到左侧面板的书签\");\n\n        this.$switchOffName.text(\"书签\");\n        this.$switchOffButton.attr(\"title\", \"删除书签\");\n    }\n\n    async toggle(state) {\n        const resp = await server.put(`notes/${this.noteId}/toggle-in-parent/_lbBookmarks/${!!state}`);\n\n        if (!resp.success) {\n            toastService.showError(resp.message);\n        }\n    }\n\n    async refreshWithNote(note) {\n        const isBookmarked = !!note.getParentBranches().find(b => b.parentNoteId === '_lbBookmarks');\n\n        this.$switchOn.toggle(!isBookmarked);\n        this.$switchOff.toggle(isBookmarked);\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.getBranchRows().find(b => b.noteId === this.noteId)) {\n            this.refresh();\n        }\n    }\n}\n","import server from './server.js';\nimport toastService from \"./toast.js\";\n\nasync function syncNow(ignoreNotConfigured = false) {\n    const result = await server.post('sync/now');\n\n    if (result.success) {\n        toastService.showMessage(\"同步成功.\");\n    }\n    else {\n        if (result.message.length > 200) {\n            result.message = `${result.message.substr(0, 200)}...`;\n        }\n\n        if (!ignoreNotConfigured || result.errorCode !== 'NOT_CONFIGURED') {\n            toastService.showError(`Sync failed: ${result.message}`);\n        }\n    }\n}\n\nexport default {\n    syncNow\n};\n","import SwitchWidget from \"./switch.js\";\nimport branchService from \"../services/branches.js\";\nimport server from \"../services/server.js\";\nimport utils from \"../services/utils.js\";\nimport syncService from \"../services/sync.js\";\nimport dialogService from \"../services/dialog.js\";\n\nexport default class SharedSwitchWidget extends SwitchWidget {\n    isEnabled() {\n        return super.isEnabled()\n            && !['root', '_share', '_hidden'].includes(this.noteId);\n    }\n\n    doRender() {\n        super.doRender();\n\n        this.$switchOnName.text(\"分享\");\n        this.$switchOnButton.attr(\"title\", \"分享笔记\");\n\n        this.$switchOffName.text(\"分享\");\n        this.$switchOffButton.attr(\"title\", \"取消分享笔记\");\n\n        this.$helpButton.attr(\"data-help-page\", \"Sharing\").show();\n        this.$helpButton.on('click', e => utils.openHelp($(e.target)));\n    }\n\n    async switchOn() {\n        await branchService.cloneNoteToParentNote(this.noteId, '_share');\n\n        syncService.syncNow(true);\n    }\n\n    async switchOff() {\n        const shareBranch = this.note.getParentBranches().find(b => b.parentNoteId === '_share');\n\n        if (!shareBranch) {\n            return;\n        }\n\n        if (this.note.getParentBranches().length === 1) {\n            const text = \"This note exists only as a shared note, unsharing would delete it. Do you want to continue and thus delete this note?\";\n\n            if (!await dialogService.confirm(text)) {\n                return;\n            }\n        }\n\n        await server.remove(`branches/${shareBranch.branchId}?taskId=no-progress-reporting`);\n\n        syncService.syncNow(true);\n    }\n\n    async refreshWithNote(note) {\n        const isShared = note.hasAncestor('_share');\n        const canBeUnshared = isShared && note.getParentBranches().find(b => b.parentNoteId === '_share');\n        const switchDisabled = isShared && !canBeUnshared;\n\n        this.$switchOn.toggle(!isShared);\n        this.$switchOff.toggle(!!isShared);\n\n        if (switchDisabled) {\n            this.$widget.attr(\"title\", \"这里无法取消分享笔记, 因为它是从父级笔记继承的分享.\");\n            this.$switchOff.addClass(\"switch-disabled\");\n        }\n        else {\n            this.$widget.removeAttr(\"title\");\n            this.$switchOff.removeClass(\"switch-disabled\");\n        }\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.getBranchRows().find(b => b.noteId === this.noteId)) {\n            this.refresh();\n        }\n    }\n}\n","import NoteContextAwareWidget from \"../note_context_aware_widget.js\";\nimport NoteTypeWidget from \"../note_type.js\";\nimport ProtectedNoteSwitchWidget from \"../protected_note_switch.js\";\nimport EditabilitySelectWidget from \"../editability_select.js\";\nimport BookmarkSwitchWidget from \"../bookmark_switch.js\";\nimport SharedSwitchWidget from \"../shared_switch.js\";\n\nconst TPL = `\n<div class=\"basic-properties-widget\">\n    <style>\n        .basic-properties-widget {\n            padding: 0px 12px 6px 12px;\n            display: flex;\n            align-items: baseline;\n            flex-wrap: wrap;\n        }\n        \n        .basic-properties-widget > * {\n            margin-right: 30px;\n            margin-top: 9px;\n            margin-bottom: 2px;\n        }\n        \n        .note-type-container, .editability-select-container {\n            display: flex;\n            align-items: center;\n        }\n    </style>\n    \n    <div class=\"note-type-container\">\n        <span>笔记类型:</span> &nbsp;\n    </div>\n    \n    <div class=\"protected-note-switch-container\"></div>\n    \n    <div class=\"editability-select-container\">\n        <span>可编辑:</span> &nbsp;\n    </div>\n    \n    <div class=\"bookmark-switch-container\"></div>\n    \n    <div class=\"shared-switch-container\"></div>\n</div>`;\n\nexport default class BasicPropertiesWidget extends NoteContextAwareWidget {\n    constructor() {\n        super();\n\n        this.noteTypeWidget = new NoteTypeWidget().contentSized();\n        this.protectedNoteSwitchWidget = new ProtectedNoteSwitchWidget().contentSized();\n        this.editabilitySelectWidget = new EditabilitySelectWidget().contentSized();\n        this.bookmarkSwitchWidget = new BookmarkSwitchWidget().contentSized();\n        this.sharedSwitchWidget = new SharedSwitchWidget().contentSized();\n\n        this.child(\n            this.noteTypeWidget,\n            this.protectedNoteSwitchWidget,\n            this.editabilitySelectWidget,\n            this.bookmarkSwitchWidget,\n            this.sharedSwitchWidget\n        );\n    }\n\n    get name() {\n        return \"basicProperties\";\n    }\n\n    get toggleCommand() {\n        return \"toggleRibbonBasicProperties\";\n    }\n\n    getTitle() {\n        return {\n            show: !this.note.isLaunchBarConfig(),\n            title: '基本属性',\n            icon: 'bx bx-slider'\n        };\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.contentSized();\n\n        this.$widget.find(\".note-type-container\").append(this.noteTypeWidget.render());\n        this.$widget.find(\".protected-note-switch-container\").append(this.protectedNoteSwitchWidget.render());\n        this.$widget.find(\".editability-select-container\").append(this.editabilitySelectWidget.render());\n        this.$widget.find(\".bookmark-switch-container\").append(this.bookmarkSwitchWidget.render());\n        this.$widget.find(\".shared-switch-container\").append(this.sharedSwitchWidget.render());\n    }\n\n    async refreshWithNote(note) {\n        await super.refreshWithNote(note);\n\n        this.$widget.find(\".editability-select-container\").toggle(this.note && ['text', 'code'].includes(this.note.type))\n    }\n}\n","import NoteContextAwareWidget from \"../note_context_aware_widget.js\";\nimport server from \"../../services/server.js\";\nimport utils from \"../../services/utils.js\";\n\nconst TPL = `\n<div class=\"note-info-widget\">\n    <style>\n        .note-info-widget {\n            padding: 12px;\n        }\n        \n        .note-info-widget-table {\n            max-width: 100%;            \n            display: block;\n            overflow-x: auto;\n            white-space: nowrap;\n        } \n   \n        .note-info-widget-table td, .note-info-widget-table th {\n            padding: 5px;\n        }\n        \n        .note-info-mime {\n            max-width: 13em;\n            overflow: hidden;\n            text-overflow: ellipsis;\n            white-space: nowrap;\n        }\n    </style>\n\n    <table class=\"note-info-widget-table\">\n        <tr>\n            <th>笔记ID:</th>\n            <td class=\"note-info-note-id\"></td>\n            <th>创建:</th>\n            <td class=\"note-info-date-created\"></td>\n            <th>修改:</th>\n            <td class=\"note-info-date-modified\"></td>\n        </tr>\n        <tr>\n            <th>类型:</th>\n            <td>\n                <span class=\"note-info-type\"></span>\n                \n                <span class=\"note-info-mime\"></span>\n            </td>\n\n            <th title=\"估算这个笔记占用的空间, 包括笔记内容和笔记历史.\">笔记大小:</th>\n           \n            <td colspan=\"3\">\n                <button class=\"btn btn-sm calculate-button\" style=\"padding: 0px 10px 0px 10px;\">\n                    <span class=\"bx bx-calculator\"></span> 计算\n                </button>\n                \n                <span class=\"note-sizes-wrapper\">\n                    <span class=\"note-size\"></span>\n                    \n                    <span class=\"subtree-size\"></span>\n                </span>\n            </td>\n        </tr>\n    </table>\n</div>\n`;\nexport default class NoteInfoWidget extends NoteContextAwareWidget {\n    get name() {\n        return \"noteInfo\";\n    }\n\n    get toggleCommand() {\n        return \"toggleRibbonTabNoteInfo\";\n    }\n\n    isEnabled() {\n        return this.note;\n    }\n\n    getTitle() {\n        return {\n            show: this.isEnabled(),\n            title: '笔记信息',\n            icon: 'bx bx-info-circle'\n        };\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.contentSized();\n\n        this.$noteId = this.$widget.find(\".note-info-note-id\");\n        this.$dateCreated = this.$widget.find(\".note-info-date-created\");\n        this.$dateModified = this.$widget.find(\".note-info-date-modified\");\n        this.$type = this.$widget.find(\".note-info-type\");\n        this.$mime = this.$widget.find(\".note-info-mime\");\n\n        this.$noteSizesWrapper = this.$widget.find('.note-sizes-wrapper');\n        this.$noteSize = this.$widget.find(\".note-size\");\n        this.$subTreeSize = this.$widget.find(\".subtree-size\");\n\n        this.$calculateButton = this.$widget.find(\".calculate-button\");\n        this.$calculateButton.on('click', async () => {\n            this.$noteSizesWrapper.show();\n            this.$calculateButton.hide();\n\n            this.$noteSize.empty().append($('<span class=\"bx bx-loader bx-spin\"></span>'));\n            this.$subTreeSize.empty().append($('<span class=\"bx bx-loader bx-spin\"></span>'));\n\n            const noteSizeResp = await server.get(`stats/note-size/${this.noteId}`);\n            this.$noteSize.text(utils.formatSize(noteSizeResp.noteSize));\n\n            const subTreeResp = await server.get(`stats/subtree-size/${this.noteId}`);\n\n            if (subTreeResp.subTreeNoteCount > 1) {\n                this.$subTreeSize.text(`(子树大小: ${utils.formatSize(subTreeResp.subTreeSize)} 共计 ${subTreeResp.subTreeNoteCount} 个笔记)`);\n            }\n            else {\n                this.$subTreeSize.text(\"\");\n            }\n        });\n    }\n\n    async refreshWithNote(note) {\n        const metadata = await server.get(`notes/${this.noteId}/metadata`);\n\n        this.$noteId.text(note.noteId);\n        this.$dateCreated\n            .text(metadata.dateCreated.substr(0, 16))\n            .attr(\"title\", metadata.dateCreated);\n\n        this.$dateModified\n            .text(metadata.dateModified.substr(0, 16))\n            .attr(\"title\", metadata.dateModified);\n\n        this.$type.text(note.type);\n\n        if (note.mime) {\n            this.$mime.text(`(${note.mime})`);\n        } else {\n            this.$mime.empty();\n        }\n\n        this.$calculateButton.show();\n        this.$noteSizesWrapper.hide();\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.isNoteReloaded(this.noteId) || loadResults.isNoteContentReloaded(this.noteId)) {\n            this.refresh();\n        }\n    }\n}\n","import NoteContextAwareWidget from \"../note_context_aware_widget.js\";\nimport attributeService from \"../../services/attributes.js\";\n\nconst TPL = `\n<div class=\"book-properties-widget\">\n    <style>\n        .book-properties-widget {\n            padding: 12px 12px 6px 12px;\n            display: flex;\n        }\n        \n        .book-properties-widget > * {\n            margin-right: 15px;\n        }\n    </style>\n\n    <div style=\"display: flex; align-items: baseline\">\n        <span style=\"white-space: nowrap\">视图类型:</span>\n        \n        <select class=\"view-type-select form-control form-control-sm\">\n            <option value=\"grid\">网格</option>\n            <option value=\"list\">列表</option>\n        </select>\n    </div>\n    \n    <button type=\"button\"\n            class=\"collapse-all-button btn btn-sm\"\n            title=\"折叠所有笔记\">\n    \n        <span class=\"bx bx-layer-minus\"></span>\n        \n        折叠\n    </button>\n\n    <button type=\"button\"\n            class=\"expand-children-button btn btn-sm\"\n            title=\"展开所有子笔记\">\n        <span class=\"bx bx-move-vertical\"></span>\n        \n        展开\n    </button>\n</div>\n`;\nexport default class BookPropertiesWidget extends NoteContextAwareWidget {\n    get name() {\n        return \"bookProperties\";\n    }\n\n    get toggleCommand() {\n        return \"toggleRibbonTabBookProperties\";\n    }\n\n    isEnabled() {\n        return this.note && this.note.type === 'book';\n    }\n\n    getTitle() {\n        return {\n            show: this.isEnabled(),\n            activate: true,\n            title: '图书属性',\n            icon: 'bx bx-book'\n        };\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.contentSized();\n\n        this.$viewTypeSelect = this.$widget.find('.view-type-select');\n        this.$viewTypeSelect.on('change', () => this.toggleViewType(this.$viewTypeSelect.val()));\n\n        this.$expandChildrenButton = this.$widget.find('.expand-children-button');\n        this.$expandChildrenButton.on('click', async () => {\n            if (!this.note.isLabelTruthy('expanded')) {\n                await attributeService.addLabel(this.noteId, 'expanded');\n            }\n\n            this.triggerCommand('refreshNoteList', {noteId: this.noteId});\n        });\n\n        this.$collapseAllButton = this.$widget.find('.collapse-all-button');\n        this.$collapseAllButton.on('click', async () => {\n            // owned is important - we shouldn't remove inherited expanded labels\n            for (const expandedAttr of this.note.getOwnedLabels('expanded')) {\n                await attributeService.removeAttributeById(this.noteId, expandedAttr.attributeId);\n            }\n\n            this.triggerCommand('refreshNoteList', {noteId: this.noteId});\n        });\n    }\n\n    async refreshWithNote(note) {\n        const viewType = this.note.getLabelValue('viewType') || 'grid';\n\n        this.$viewTypeSelect.val(viewType);\n\n        this.$expandChildrenButton.toggle(viewType === 'list');\n        this.$collapseAllButton.toggle(viewType === 'list');\n    }\n\n    async toggleViewType(type) {\n        if (type !== 'list' && type !== 'grid') {\n            throw new Error(`Invalid view type '${type}'`);\n        }\n\n        await attributeService.setLabel(this.noteId, 'viewType', type);\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.getAttributeRows().find(attr => attr.noteId === this.noteId && attr.name === 'viewType')) {\n            this.refresh();\n        }\n    }\n}\n","import NoteContextAwareWidget from \"../note_context_aware_widget.js\";\nimport NoteMapWidget from \"../note_map.js\";\n\nconst TPL = `\n<div class=\"note-map-ribbon-widget\">\n    <style>\n        .note-map-ribbon-widget {\n            position: relative;\n        }\n        \n        .note-map-ribbon-widget .note-map-container {\n            height: 300px;\n        }\n    \n        .open-full-button, .collapse-button {\n            position: absolute;\n            right: 5px;\n            bottom: 5px;\n            z-index: 1000;\n        }\n        \n        .style-resolver {\n            color: var(--muted-text-color);\n            display: none;\n        }\n    </style>\n\n    <button class=\"bx bx-arrow-to-bottom icon-action open-full-button\" title=\"完整显示\"></button>\n    <button class=\"bx bx-arrow-to-top icon-action collapse-button\" style=\"display: none;\" title=\"折叠到正常大小\"></button>\n\n    <div class=\"note-map-container\"></div>\n</div>`;\n\nexport default class NoteMapRibbonWidget extends NoteContextAwareWidget {\n    constructor() {\n        super();\n\n        this.noteMapWidget = new NoteMapWidget('ribbon');\n        this.child(this.noteMapWidget);\n    }\n\n    get name() {\n        return \"noteMap\";\n    }\n\n    get toggleCommand() {\n        return \"toggleRibbonTabNoteMap\";\n    }\n\n    getTitle() {\n        return {\n            show: this.isEnabled(),\n            title: '笔记地图',\n            icon: 'bx bx-map-alt'\n        };\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.contentSized();\n        this.$container = this.$widget.find(\".note-map-container\");\n        this.$container.append(this.noteMapWidget.render());\n\n        this.openState = 'small';\n\n        this.$openFullButton = this.$widget.find('.open-full-button');\n        this.$openFullButton.on('click', () => {\n            this.setFullHeight();\n\n            this.$openFullButton.hide();\n            this.$collapseButton.show();\n\n            this.openState = 'full';\n\n            this.noteMapWidget.setDimensions();\n        });\n\n        this.$collapseButton = this.$widget.find('.collapse-button');\n        this.$collapseButton.on('click', () => {\n            this.setSmallSize();\n\n            this.$openFullButton.show();\n            this.$collapseButton.hide();\n\n            this.openState = 'small';\n\n            this.noteMapWidget.setDimensions();\n        });\n\n        const handleResize = () => {\n            if (!this.noteMapWidget.graph) { // no graph has been even rendered\n                return;\n            }\n\n            if (this.openState === 'full') {\n                this.setFullHeight();\n            }\n            else if (this.openState === 'small') {\n                this.setSmallSize();\n            }\n        }\n\n        new ResizeObserver(handleResize).observe(this.$widget[0]);\n    }\n\n    setSmallSize() {\n        const SMALL_SIZE_HEIGHT = 300;\n        const width = this.$widget.width();\n\n        this.$widget.find('.note-map-container')\n            .height(SMALL_SIZE_HEIGHT)\n            .width(width);\n    }\n\n    setFullHeight() {\n        const {top} = this.$widget[0].getBoundingClientRect();\n\n        const height = $(window).height() - top;\n        const width = this.$widget.width();\n\n        this.$widget.find('.note-map-container')\n            .height(height)\n            .width(width);\n    }\n}\n","import NoteContextAwareWidget from \"../note_context_aware_widget.js\";\nimport treeService from \"../../services/tree.js\";\nimport linkService from \"../../services/link.js\";\n\nconst TPL = `\n<div class=\"note-paths-widget\">\n    <style>\n    .note-paths-widget {\n        padding: 12px;\n        max-height: 300px;\n        overflow-y: auto;\n    }\n    \n    .note-path-list {\n        margin-top: 10px;\n    }\n    \n    .note-path-list .path-current {\n        font-weight: bold;\n    }\n    \n    .note-path-list .path-archived {\n        color: var(--muted-text-color) !important;\n    }\n    \n    .note-path-list .path-search {\n        font-style: italic;\n    }\n    </style>\n    \n    <div class=\"note-path-intro\"></div>\n    \n    <ul class=\"note-path-list\"></ul>\n    \n    <button class=\"btn btn-sm\" data-trigger-command=\"cloneNoteIdsTo\">克隆到新路径...</button>\n</div>`;\n\nexport default class NotePathsWidget extends NoteContextAwareWidget {\n    get name() {\n        return \"notePaths\";\n    }\n\n    get toggleCommand() {\n        return \"toggleRibbonTabNotePaths\";\n    }\n\n    getTitle() {\n        return {\n            show: true,\n            title: '笔记路径',\n            icon: 'bx bx-collection'\n        };\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.contentSized();\n\n        this.$notePathIntro = this.$widget.find(\".note-path-intro\");\n        this.$notePathList = this.$widget.find(\".note-path-list\");\n        this.$widget.on('show.bs.dropdown', () => this.renderDropdown());\n    }\n\n    async refreshWithNote(note) {\n        this.$notePathList.empty();\n\n        if (this.noteId === 'root') {\n            this.$notePathList.empty().append(\n                await this.getRenderedPath('root')\n            );\n\n            return;\n        }\n\n        const sortedNotePaths = this.note.getSortedNotePathRecords(this.hoistedNoteId)\n            .filter(notePath => !notePath.isHidden);\n\n        if (sortedNotePaths.length > 0) {\n            this.$notePathIntro.text(\"这个笔记已被放到以下路径中:\");\n        }\n        else {\n            this.$notePathIntro.text(\"这个笔记还没有被放到笔记树中.\");\n        }\n\n        const renderedPaths = [];\n\n        for (const notePathRecord of sortedNotePaths) {\n            const notePath = notePathRecord.notePath.join('/');\n\n            renderedPaths.push(await this.getRenderedPath(notePath, notePathRecord));\n        }\n\n        this.$notePathList.empty().append(...renderedPaths);\n    }\n\n    async getRenderedPath(notePath, notePathRecord = null) {\n        const title = await treeService.getNotePathTitle(notePath);\n\n        const $noteLink = await linkService.createLink(notePath, {title});\n\n        $noteLink\n            .find('a')\n            .addClass(\"no-tooltip-preview\");\n\n        const icons = [];\n\n        if (this.notePath === notePath) {\n            $noteLink.addClass(\"path-current\");\n        }\n\n        if (!notePathRecord || notePathRecord.isInHoistedSubTree) {\n            $noteLink.addClass(\"path-in-hoisted-subtree\");\n        }\n        else {\n            icons.push(`<span class=\"bx bx-trending-up\" title=\"该路径不在提升笔记的范围内,您必须取消提升.\"></span>`);\n        }\n\n        if (notePathRecord?.isArchived) {\n            $noteLink.addClass(\"path-archived\");\n\n            icons.push(`<span class=\"bx bx-archive\" title=\"已归档\"></span>`);\n        }\n\n        if (notePathRecord?.isSearch) {\n            $noteLink.addClass(\"path-search\");\n\n            icons.push(`<span class=\"bx bx-search\" title=\"搜索\"></span>`);\n        }\n\n        if (icons.length > 0) {\n            $noteLink.append(` ${icons.join(' ')}`);\n        }\n\n        return $(\"<li>\").append($noteLink);\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.getBranchRows().find(branch => branch.noteId === this.noteId)\n            || loadResults.isNoteReloaded(this.noteId)) {\n\n            this.refresh();\n        }\n    }\n}\n","import linkService from \"../../services/link.js\";\nimport server from \"../../services/server.js\";\nimport froca from \"../../services/froca.js\";\nimport NoteContextAwareWidget from \"../note_context_aware_widget.js\";\n\nconst TPL = `\n<div class=\"similar-notes-widget\">\n    <style>    \n    .similar-notes-wrapper {\n        max-height: 200px;\n        overflow: auto;\n        padding: 12px;\n    }\n\n    .similar-notes-wrapper a {\n        display: inline-block;\n        border: 1px dotted var(--main-border-color);\n        border-radius: 20px;\n        background-color: var(--accented-background-color);\n        padding: 0 10px 0 10px;\n        margin: 0 3px 0 3px;\n        max-width: 10em;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n        overflow: hidden;\n    }\n    </style>\n\n    <div class=\"similar-notes-wrapper\"></div>\n</div>\n`;\n\nexport default class SimilarNotesWidget extends NoteContextAwareWidget {\n    get name() {\n        return \"similarNotes\";\n    }\n\n    get toggleCommand() {\n        return \"toggleRibbonTabSimilarNotes\";\n    }\n\n    isEnabled() {\n        return super.isEnabled()\n            && this.note.type !== 'search'\n            && !this.note.isLabelTruthy('similarNotesWidgetDisabled');\n    }\n\n    getTitle() {\n        return {\n            show: this.isEnabled(),\n            title: '相似笔记',\n            icon: 'bx bx-bar-chart'\n        };\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.contentSized();\n\n        this.$similarNotesWrapper = this.$widget.find(\".similar-notes-wrapper\");\n    }\n\n    async refreshWithNote(note) {\n        // remember which title was when we found the similar notes\n        this.title = this.note.title;\n\n        const similarNotes = await server.get(`similar-notes/${this.noteId}`);\n\n        if (similarNotes.length === 0) {\n            this.$similarNotesWrapper.empty().append(\"没有找到相似笔记.\");\n\n            return;\n        }\n\n        const noteIds = similarNotes.flatMap(note => note.notePath);\n\n        await froca.getNotes(noteIds, true); // preload all at once\n\n        const $list = $('<div>');\n\n        for (const similarNote of similarNotes) {\n            const note = await froca.getNote(similarNote.noteId, true);\n\n            if (!note) {\n                continue;\n            }\n\n            const $item = (await linkService.createLink(similarNote.notePath.join(\"/\")))\n                .css(\"font-size\", 24 * (1 - 1 / (1 +  similarNote.score)));\n\n            $list.append($item);\n        }\n\n        this.$similarNotesWrapper.empty().append($list);\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (this.note && this.title !== this.note.title) {\n            this.rendered = false;\n\n            this.refresh();\n        }\n    }\n}\n","import FlexContainer from \"./flex_container.js\";\nimport splitService from \"../../services/resizer.js\";\n\nexport default class RightPaneContainer extends FlexContainer {\n    constructor() {\n        super('column');\n\n        this.id('right-pane');\n        this.css('height', '100%');\n        this.collapsible();\n    }\n\n    isEnabled() {\n        return super.isEnabled()\n            && this.children.length > 0\n            && !!this.children.find(ch => ch.isEnabled() && ch.canBeShown());\n    }\n\n    handleEventInChildren(name, data) {\n        const promise = super.handleEventInChildren(name, data);\n\n        if (['activeContextChanged', 'noteSwitchedAndActivated', 'noteSwitched'].includes(name)) {\n            // the right pane is displayed only if some child widget is active,\n            // we'll reevaluate the visibility based on events which are probable to cause visibility change\n            // but these events need to be finished and only then we check\n            if (promise) {\n                promise.then(() => this.reEvaluateRightPaneVisibilityCommand());\n            }\n            else {\n                this.reEvaluateRightPaneVisibilityCommand();\n            }\n        }\n\n        return promise;\n    }\n\n    reEvaluateRightPaneVisibilityCommand() {\n        const oldToggle = !this.isHiddenInt();\n        const newToggle = this.isEnabled();\n\n        if (oldToggle !== newToggle) {\n            this.toggleInt(newToggle);\n\n            splitService.setupRightPaneResizer();\n        }\n    }\n}\n","import OnClickButtonWidget from \"./onclick_button.js\";\nimport appContext from \"../../components/app_context.js\";\nimport attributeService from \"../../services/attributes.js\";\nimport protectedSessionHolder from \"../../services/protected_session_holder.js\";\n\nexport default class EditButton extends OnClickButtonWidget {\n    isEnabled() {\n        return super.isEnabled()\n            && this.note\n            && this.noteContext.viewScope.viewMode === 'default';\n    }\n\n    constructor() {\n        super();\n\n        this.icon(\"bx-edit-alt\")\n            .title(\"编辑笔记\")\n            .titlePlacement(\"bottom\")\n            .onClick(widget => {\n                this.noteContext.viewScope.readOnlyTemporarilyDisabled = true;\n\n                appContext.triggerEvent('readOnlyTemporarilyDisabled', {noteContext: this.noteContext});\n\n                this.refresh();\n            });\n    }\n\n    async refreshWithNote(note) {\n        if (note.isProtected && !protectedSessionHolder.isProtectedSessionAvailable()) {\n            this.toggleInt(false);\n        }\n        else {\n            // prevent flickering by assuming hidden before async operation\n            this.toggleInt(false);\n\n            const wasVisible = this.isVisible();\n\n            // can't do this in isEnabled() since isReadOnly is async\n            this.toggleInt(await this.noteContext.isReadOnly());\n\n            // make the edit button stand out on the first display, otherwise\n            // it's difficult to notice that the note is readonly\n            if (this.isVisible() && !wasVisible) {\n                this.$widget.addClass(\"bx-tada bx-lg\");\n\n                setTimeout(() => {\n                    this.$widget.removeClass(\"bx-tada bx-lg\");\n                }, 1700);\n            }\n        }\n\n        await super.refreshWithNote(note);\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.getAttributeRows().find(\n            attr => attr.type === 'label'\n                && attr.name.toLowerCase().includes(\"readonly\")\n                && attributeService.isAffecting(attr, this.note)\n        )) {\n            this.noteContext.viewScope.readOnlyTemporarilyDisabled = false;\n\n            this.refresh();\n        }\n    }\n\n    async noteTypeMimeChangedEvent({noteId}) {\n        if (this.isNote(noteId)) {\n            await this.refresh();\n        }\n    }\n}\n","import linkService from \"../../services/link.js\";\nimport server from \"../../services/server.js\";\nimport froca from \"../../services/froca.js\";\nimport NoteContextAwareWidget from \"../note_context_aware_widget.js\";\nimport options from \"../../services/options.js\";\n\nconst TPL = `\n<div class=\"edited-notes-widget\">\n    <style>\n        .edited-notes-widget {\n            padding: 12px;\n            max-height: 200px;\n            width: 100%;\n            overflow: auto;\n        }\n    </style>\n    \n    <div class=\"no-edited-notes-found\">这天没有编辑过笔记...</div>\n    \n    <div class=\"edited-notes-list\"></div>\n</div>\n`;\n\nexport default class EditedNotesWidget extends NoteContextAwareWidget {\n    get name() {\n        return \"editedNotes\";\n    }\n\n    isEnabled() {\n        return super.isEnabled()\n            && this.note.hasOwnedLabel(\"dateNote\");\n    }\n\n    getTitle() {\n        return {\n            show: this.isEnabled(),\n            // promoted attributes have priority over edited notes\n            activate:\n                (this.note.getPromotedDefinitionAttributes().length === 0 || !options.is('promotedAttributesOpenInRibbon'))\n                && options.is('editedNotesOpenInRibbon'),\n            title: '编辑过的笔记',\n            icon: 'bx bx-calendar-edit'\n        };\n    }\n\n    async doRender() {\n        this.$widget = $(TPL);\n        this.contentSized();\n        this.$list = this.$widget.find('.edited-notes-list');\n        this.$noneFound = this.$widget.find('.no-edited-notes-found');\n    }\n\n    async refreshWithNote(note) {\n        let editedNotes = await server.get(`edited-notes/${note.getLabelValue(\"dateNote\")}`);\n\n        editedNotes = editedNotes.filter(n => n.noteId !== note.noteId);\n\n        this.$list.empty();\n        this.$noneFound.hide();\n\n        if (editedNotes.length === 0) {\n            this.$noneFound.show();\n            return;\n        }\n\n        const noteIds = editedNotes.flatMap(n => n.noteId);\n\n        await froca.getNotes(noteIds, true); // preload all at once\n\n        for (let i = 0; i < editedNotes.length; i++) {\n            const editedNote = editedNotes[i];\n            const $item = $('<span class=\"edited-note-line\">');\n\n            if (editedNote.isDeleted) {\n                const title = `${editedNote.title} (deleted)`;\n                $item.append(\n                    $(\"<i>\")\n                        .text(title)\n                        .attr(\"title\", title)\n                );\n            }\n            else {\n                $item.append(editedNote.notePath\n                    ? await linkService.createLink(editedNote.notePath.join(\"/\"), {showNotePath: true})\n                    : $(\"<span>\").text(editedNote.title));\n            }\n\n            if (i < editedNotes.length - 1) {\n                $item.append(\", \");\n            }\n\n            this.$list.append($item);\n        }\n    }\n}\n","import libraryLoader from \"../services/library_loader.js\";\nimport NoteContextAwareWidget from \"./note_context_aware_widget.js\";\nimport server from \"../services/server.js\";\n\nconst TPL = `<div class=\"mermaid-widget\">\n    <style>\n        .mermaid-widget {\n            flex-grow: 2;\n            overflow: auto;\n            min-height: 200px;\n            border-bottom: 1px solid var(--main-border-color);\n            padding: 20px;\n            margin-bottom: 10px;\n            flex-basis: 0;\n        }\n        \n        .mermaid-render {\n            overflow: auto;\n            height: 100%;\n            text-align: center;\n        }\n        \n        .mermaid-render svg {\n            width: 95%; /* https://github.com/zadam/trilium/issues/4340 */\n        }\n    </style>\n\n    <div class=\"mermaid-error alert alert-warning\">\n        <p><strong>图表无法显示. 请看 <a href=\"https://mermaid-js.github.io/mermaid/#/flowchart?id=graph\">帮助和示例</a>.</strong></p>\n        <p class=\"error-content\"></p>\n    </div>\n\n    <div class=\"mermaid-render\"></div>\n</div>`;\n\nlet idCounter = 1;\n\nexport default class MermaidWidget extends NoteContextAwareWidget {\n    isEnabled() {\n        return super.isEnabled()\n            && this.note?.type === 'mermaid'\n            && this.note.isContentAvailable()\n            && this.noteContext?.viewScope.viewMode === 'default';\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.contentSized();\n        this.$display = this.$widget.find('.mermaid-render');\n        this.$errorContainer = this.$widget.find(\".mermaid-error\");\n        this.$errorMessage = this.$errorContainer.find(\".error-content\");\n    }\n\n    async refreshWithNote(note) {\n        this.$errorContainer.hide();\n\n        await libraryLoader.requireLibrary(libraryLoader.MERMAID);\n\n        const documentStyle = window.getComputedStyle(document.documentElement);\n        const mermaidTheme = documentStyle.getPropertyValue('--mermaid-theme');\n\n        mermaid.mermaidAPI.initialize({\n            startOnLoad: false,\n            theme: mermaidTheme.trim(),\n            securityLevel: 'antiscript',\n            flow: { useMaxWidth: false },\n            sequence: { useMaxWidth: false },\n            gantt: { useMaxWidth: false },\n            \"class\": { useMaxWidth: false },\n            state: { useMaxWidth: false },\n            pie: { useMaxWidth: true },\n            journey: { useMaxWidth: false },\n            git: { useMaxWidth: false },\n        });\n\n        this.$display.empty();\n\n        const wheelZoomLoaded = libraryLoader.requireLibrary(libraryLoader.WHEEL_ZOOM);\n\n        this.$errorContainer.hide();\n\n        try {\n            const svg = await this.renderSvg();\n\n            if (this.dirtyAttachment) {\n                const payload = {\n                    role: 'image',\n                    title: 'mermaid-export.svg',\n                    mime: 'image/svg+xml',\n                    content: svg,\n                    position: 0\n                };\n\n                server.post(`notes/${this.noteId}/attachments?matchBy=title`, payload).then(() => {\n                    this.dirtyAttachment = false;\n                });\n            }\n\n            this.$display.html(svg);\n\n            await wheelZoomLoaded;\n\n            this.$display.attr(\"id\", `mermaid-render-${idCounter}`);\n\n            WZoom.create(`#mermaid-render-${idCounter}`, {\n                type: 'html',\n                maxScale: 50,\n                speed: 1.3,\n                zoomOnClick: false\n            });\n        } catch (e) {\n            this.$errorMessage.text(e.message);\n            this.$errorContainer.show();\n        }\n    }\n\n    async renderSvg() {\n        idCounter++;\n\n        const blob = await this.note.getBlob();\n        const content = blob.content || \"\";\n\n        const {svg} = await mermaid.mermaidAPI.render(`mermaid-graph-${idCounter}`, content);\n        return svg;\n    }\n\n    async entitiesReloadedEvent({loadResults}) {\n        if (loadResults.isNoteContentReloaded(this.noteId)) {\n            this.dirtyAttachment = true;\n\n            await this.refresh();\n        }\n    }\n\n    async exportMermaidEvent({ntxId}) {\n        if (!this.isNoteContext(ntxId)) {\n            return;\n        }\n\n        const svg = await this.renderSvg();\n        this.download(`${this.note.title}.svg`, svg);\n    }\n\n    download(filename, text) {\n        const element = document.createElement('a');\n        element.setAttribute('href', `data:image/svg+xml;charset=utf-8,${encodeURIComponent(text)}`);\n        element.setAttribute('download', filename);\n\n        element.style.display = 'none';\n        document.body.appendChild(element);\n\n        element.click();\n\n        document.body.removeChild(element);\n    }\n}\n","import FlexContainer from \"./containers/flex_container.js\";\nimport utils from \"../services/utils.js\";\nimport attributeService from \"../services/attributes.js\";\n\nexport default class NoteWrapperWidget extends FlexContainer {\n    constructor() {\n        super('column');\n\n        this.css(\"flex-grow\", \"1\")\n            .collapsible();\n    }\n\n    setNoteContextEvent({noteContext}) {\n        this.noteContext = noteContext;\n\n        this.refresh();\n    }\n\n    noteSwitchedAndActivatedEvent() {\n        this.refresh();\n    }\n\n    noteSwitchedEvent() {\n        this.refresh();\n    }\n\n    activeContextChangedEvent() {\n        this.refresh();\n    }\n\n    refresh() {\n        const isHiddenExt = this.isHiddenExt(); // preserve through class reset\n\n        this.$widget.removeClass();\n\n        this.toggleExt(!isHiddenExt);\n\n        this.$widget.addClass(\"component note-split\");\n\n        const note = this.noteContext?.note;\n        if (!note) {\n            return;\n        }\n\n        this.$widget.toggleClass(\"full-content-width\",\n            ['image', 'mermaid', 'book', 'render', 'canvas', 'webView'].includes(note.type)\n            || !!note?.isLabelTruthy('fullContentWidth')\n        );\n\n        this.$widget.addClass(note.getCssClass());\n\n        this.$widget.addClass(utils.getNoteTypeClass(note.type));\n        this.$widget.addClass(utils.getMimeTypeClass(note.mime));\n\n        this.$widget.toggleClass(\"protected\", note.isProtected);\n    }\n\n    async entitiesReloadedEvent({loadResults}) {\n        // listening on changes of note.type and CSS class\n\n        const noteId = this.noteContext?.noteId;\n        if (loadResults.isNoteReloaded(noteId)\n            || loadResults.getAttributeRows().find(attr => attr.type === 'label' && attr.name === 'cssClass' && attributeService.isAffecting(attr, this.noteContext?.note))) {\n\n            this.refresh();\n        }\n    }\n}\n","/**\n * !!! Filename is intentionally mangled, because some adblockers don't like the word \"backlinks\".\n */\n\nimport NoteContextAwareWidget from \"../note_context_aware_widget.js\";\nimport linkService from \"../../services/link.js\";\nimport server from \"../../services/server.js\";\nimport froca from \"../../services/froca.js\";\n\nconst TPL = `\n<div class=\"backlinks-widget\">\n    <style>\n        .backlinks-widget {\n            position: relative;\n        }\n    \n        .backlinks-ticker {\n            border-radius: 10px;\n            border-color: var(--main-border-color);\n            background-color: var(--more-accented-background-color);\n            padding: 4px 10px 4px 10px;\n            opacity: 90%;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n        \n        .backlinks-count {\n            cursor: pointer;\n        }\n                        \n        .backlinks-items {\n            z-index: 10;\n            position: absolute;\n            top: 50px;\n            right: 10px;\n            width: 400px;\n            border-radius: 10px;\n            background-color: var(--accented-background-color);\n            color: var(--main-text-color);\n            padding: 20px;\n            overflow-y: auto;\n        }\n        \n        .backlink-excerpt {\n            border-left: 2px solid var(--main-border-color);\n            padding-left: 10px;\n            opacity: 80%;\n            font-size: 90%;\n        }\n        \n        .backlink-excerpt .backlink-link { /* the actual backlink */\n            font-weight: bold;\n            background-color: yellow;\n        }\n    </style>\n    \n    <div class=\"backlinks-ticker\">\n        <span class=\"backlinks-count\"></span>\n    </div>   \n    \n    <div class=\"backlinks-items\" style=\"display: none;\"></div>\n</div>\n`;\n\nexport default class BacklinksWidget extends NoteContextAwareWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$count = this.$widget.find('.backlinks-count');\n        this.$items = this.$widget.find('.backlinks-items');\n        this.$ticker = this.$widget.find('.backlinks-ticker');\n\n        this.$count.on(\"click\", () => {\n            this.$items.toggle();\n            this.$items.css(\"max-height\", $(window).height() - this.$items.offset().top - 10);\n\n            if (this.$items.is(\":visible\")) {\n                this.renderBacklinks();\n            }\n        });\n\n        this.contentSized();\n    }\n\n    async refreshWithNote(note) {\n        this.clearItems();\n\n        if (this.noteContext?.viewScope?.viewMode !== 'default') {\n            this.toggle(false);\n            return;\n        }\n\n        // can't use froca since that would count only relations from loaded notes\n        const resp = await server.get(`note-map/${this.noteId}/backlink-count`);\n\n        if (!resp || !resp.count) {\n            this.toggle(false);\n            return;\n        }\n\n        this.toggle(true);\n        this.$count.text(\n            `${resp.count} 个反链`\n        );\n    }\n\n    toggle(show) {\n        this.$widget.toggleClass(\"hidden-no-content\", !show);\n    }\n\n    clearItems() {\n        this.$items.empty().hide();\n    }\n\n    async renderBacklinks() {\n        if (!this.note) {\n            return;\n        }\n\n        this.$items.empty();\n\n        const backlinks = await server.get(`note-map/${this.noteId}/backlinks`);\n\n        if (!backlinks.length) {\n            return;\n        }\n\n        await froca.getNotes(backlinks.map(bl => bl.noteId)); // prefetch all\n\n        for (const backlink of backlinks) {\n            const $item = $(\"<div>\");\n\n            $item.append(await linkService.createLink(backlink.noteId, {\n                showNoteIcon: true,\n                showNotePath: true,\n                showTooltip: false\n            }));\n\n            if (backlink.relationName) {\n                $item.append($(\"<p>\").text(`relation: ${backlink.relationName}`));\n            }\n            else {\n                $item.append(...backlink.excerpts);\n            }\n\n            this.$items.append($item);\n        }\n    }\n}\n","import NoteContextAwareWidget from \"./note_context_aware_widget.js\";\nimport options from \"../services/options.js\";\nimport attributeService from \"../services/attributes.js\";\n\nconst TPL = `\n<div class=\"shared-info-widget alert alert-warning\">\n    <style>\n        .shared-info-widget {\n            margin: 10px;\n            contain: none;\n            padding: 10px;\n            font-weight: bold;\n        }\n    </style>\n    \n    <span class=\"shared-text\"></span> <a class=\"shared-link external\"></a>. 需要帮助请访问 <a href=\"https://github.com/zadam/trilium/wiki/Sharing\">wiki</a>.\n</div>`;\n\nexport default class SharedInfoWidget extends NoteContextAwareWidget {\n    isEnabled() {\n        return super.isEnabled() && this.noteId !== '_share' && this.note.hasAncestor('_share');\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$sharedLink = this.$widget.find(\".shared-link\");\n        this.$sharedText = this.$widget.find(\".shared-text\");\n        this.contentSized();\n    }\n\n    async refreshWithNote(note) {\n        const syncServerHost = options.get(\"syncServerHost\");\n        let link;\n\n        const shareId = this.getShareId(note);\n\n        if (syncServerHost) {\n            link = `${syncServerHost}/share/${shareId}`;\n            this.$sharedText.text(\"这个笔记分享在公开地址\");\n        }\n        else {\n            let host = location.host;\n            if (host.endsWith('/')) {\n                // seems like IE has trailing slash\n                // https://github.com/zadam/trilium/issues/3782\n                host = host.substr(0, host.length - 1);\n            }\n\n            link = `${location.protocol}//${host}${location.pathname}share/${shareId}`;\n            this.$sharedText.text(\"这个笔记分享在本地地址\");\n        }\n\n        this.$sharedLink.attr(\"href\", link).text(link);\n    }\n\n    getShareId(note) {\n        if (note.hasOwnedLabel('shareRoot')) {\n            return '';\n        }\n\n        return note.getOwnedLabelValue('shareAlias') || note.noteId;\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.getAttributeRows().find(attr => attr.name.startsWith('_share') && attributeService.isAffecting(attr, this.note))) {\n            this.refresh();\n        }\n        else if (loadResults.getBranchRows().find(branch => branch.noteId === this.noteId)) {\n            this.refresh();\n        }\n    }\n}\n","export default class FindInText {\n    constructor(parent) {\n        /** @property {FindWidget} */\n        this.parent = parent;\n    }\n\n    async getTextEditor() {\n        return this.parent.noteContext.getTextEditor();\n    }\n\n    async performFind(searchTerm, matchCase, wholeWord) {\n        // Do this even if the searchTerm is empty so the markers are cleared and\n        // the counters updated\n        const textEditor = await this.getTextEditor();\n        const model = textEditor.model;\n        let findResult = null;\n        let totalFound = 0;\n        let currentFound = -1;\n\n        // Clear\n        const findAndReplaceEditing = textEditor.plugins.get('FindAndReplaceEditing');\n        findAndReplaceEditing.state.clear(model);\n        findAndReplaceEditing.stop();\n        if (searchTerm !== \"\") {\n            // Parameters are callback/text, options.matchCase=false, options.wholeWords=false\n            // See https://github.com/ckeditor/ckeditor5/blob/b95e2faf817262ac0e1e21993d9c0bde3f1be594/packages/ckeditor5-find-and-replace/src/findcommand.js#L44\n            // XXX Need to use the callback version for regexp\n            // searchTerm = escapeRegExp(searchTerm);\n            // let re = new RegExp(searchTerm, 'gi');\n            // let m = text.match(re);\n            // totalFound = m ? m.length : 0;\n            const options = { \"matchCase\" : matchCase, \"wholeWords\" : wholeWord };\n            findResult = textEditor.execute('find', searchTerm, options);\n            totalFound = findResult.results.length;\n            // Find the result beyond the cursor\n            const cursorPos = model.document.selection.getLastPosition();\n            for (let i = 0; i < findResult.results.length; ++i) {\n                const marker = findResult.results.get(i).marker;\n                const fromPos = marker.getStart();\n                if (fromPos.compareWith(cursorPos) !== \"before\") {\n                    currentFound = i;\n                    break;\n                }\n            }\n        }\n\n        this.findResult = findResult;\n\n        // Calculate curfound if not already, highlight it as\n        // selected\n        if (totalFound > 0) {\n            currentFound = Math.max(0, currentFound);\n            // XXX Do this accessing the private data?\n            // See https://github.com/ckeditor/ckeditor5/blob/b95e2faf817262ac0e1e21993d9c0bde3f1be594/packages/ckeditor5-find-and-replace/src/findnextcommand.js\n            for (let i = 0 ; i < currentFound; ++i) {\n                textEditor.execute('findNext', searchTerm);\n            }\n        }\n\n        return {\n            totalFound,\n            currentFound: Math.min(currentFound + 1, totalFound)\n        };\n    }\n\n    async findNext(direction, currentFound, nextFound) {\n        const textEditor = await this.getTextEditor();\n\n        // There are no parameters for findNext/findPrev\n        // See https://github.com/ckeditor/ckeditor5/blob/b95e2faf817262ac0e1e21993d9c0bde3f1be594/packages/ckeditor5-find-and-replace/src/findnextcommand.js#L57\n        // curFound wrap around above assumes findNext and\n        // findPrevious wraparound, which is what they do\n        if (direction > 0) {\n            textEditor.execute('findNext');\n        } else {\n            textEditor.execute('findPrevious');\n        }\n    }\n\n    async findBoxClosed(totalFound, currentFound) {\n        const textEditor = await this.getTextEditor();\n\n        if (totalFound > 0) {\n            // Clear the markers and set the caret to the\n            // current occurrence\n            const model = textEditor.model;\n            const range = this.findResult.results.get(currentFound).marker.getRange();\n            // From\n            // https://github.com/ckeditor/ckeditor5/blob/b95e2faf817262ac0e1e21993d9c0bde3f1be594/packages/ckeditor5-find-and-replace/src/findandreplace.js#L92\n            // XXX Roll our own since already done for codeEditor and\n            //     will probably allow more refactoring?\n            let findAndReplaceEditing = textEditor.plugins.get('FindAndReplaceEditing');\n            findAndReplaceEditing.state.clear(model);\n            findAndReplaceEditing.stop();\n            model.change(writer => {\n                writer.setSelection(range, 0);\n            });\n            textEditor.editing.view.scrollToTheSelection();\n        }\n\n        this.findResult = null;\n\n        textEditor.focus();\n    }\n}\n","// ck-find-result and ck-find-result_selected are the styles ck-editor\n// uses for highlighting matches, use the same one on CodeMirror\n// for consistency\nimport utils from \"../services/utils.js\";\n\nconst FIND_RESULT_SELECTED_CSS_CLASSNAME = \"ck-find-result_selected\";\nconst FIND_RESULT_CSS_CLASSNAME = \"ck-find-result\";\n\nexport default class FindInCode {\n    constructor(parent) {\n        /** @property {FindWidget} */\n        this.parent = parent;\n    }\n\n    async getCodeEditor() {\n        return this.parent.noteContext.getCodeEditor();\n    }\n\n    async performFind(searchTerm, matchCase, wholeWord) {\n        let findResult = null;\n        let totalFound = 0;\n        let currentFound = -1;\n\n        // See https://codemirror.net/addon/search/searchcursor.js for tips\n        const codeEditor = await this.getCodeEditor();\n        const doc = codeEditor.doc;\n        const text = doc.getValue();\n\n        // Clear all markers\n        if (this.findResult != null) {\n            codeEditor.operation(() => {\n                for (let i = 0; i < this.findResult.length; ++i) {\n                    const marker = this.findResult[i];\n                    marker.clear();\n                }\n            });\n        }\n\n        if (searchTerm !== \"\") {\n            searchTerm = utils.escapeRegExp(searchTerm);\n\n            // Find and highlight matches\n            // Find and highlight matches\n            // XXX Using \\\\b and not using the unicode flag probably doesn't\n            //     work with non-ASCII alphabets, findAndReplace uses a more\n            //     complicated regexp, see\n            //     https://github.com/ckeditor/ckeditor5/blob/b95e2faf817262ac0e1e21993d9c0bde3f1be594/packages/ckeditor5-find-and-replace/src/utils.js#L145\n            const wholeWordChar = wholeWord ? \"\\\\b\" : \"\";\n            const re = new RegExp(wholeWordChar + searchTerm + wholeWordChar,\n                'g' + (matchCase ? '' : 'i'));\n            let curLine = 0;\n            let curChar = 0;\n            let curMatch = null;\n            findResult = [];\n            // All those markText take several seconds on e.g., this ~500-line\n            // script, batch them inside an operation, so they become\n            // unnoticeable. Alternatively, an overlay could be used, see\n            // https://codemirror.net/addon/search/match-highlighter.js ?\n            codeEditor.operation(() => {\n                for (let i = 0; i < text.length; ++i) {\n                    // Fetch the next match if it's the first time or if past the current match start\n                    if ((curMatch == null) || (curMatch.index < i)) {\n                        curMatch = re.exec(text);\n                        if (curMatch == null) {\n                            // No more matches\n                            break;\n                        }\n                    }\n                    // Create a non-selected highlight marker for the match, the\n                    // selected marker highlight will be done later\n                    if (i === curMatch.index) {\n                        let fromPos = { \"line\" : curLine, \"ch\" : curChar };\n                        // If multiline is supported, this needs to recalculate curLine since the match may span lines\n                        let toPos = { \"line\" : curLine, \"ch\" : curChar + curMatch[0].length};\n                        // or css = \"color: #f3\"\n                        let marker = doc.markText( fromPos, toPos, { \"className\" : FIND_RESULT_CSS_CLASSNAME });\n                        findResult.push(marker);\n\n                        // Set the first match beyond the cursor as the current match\n                        if (currentFound === -1) {\n                            const cursorPos = codeEditor.getCursor();\n                            if ((fromPos.line > cursorPos.line) ||\n                                ((fromPos.line === cursorPos.line) &&\n                                    (fromPos.ch >= cursorPos.ch))){\n                                currentFound = totalFound;\n                            }\n                        }\n\n                        totalFound++;\n                    }\n                    // Do line and char position tracking\n                    if (text[i] === \"\\n\") {\n                        curLine++;\n                        curChar = 0;\n                    } else {\n                        curChar++;\n                    }\n                }\n            });\n        }\n\n        this.findResult = findResult;\n\n        // Calculate curfound if not already, highlight it as selected\n        if (totalFound > 0) {\n            currentFound = Math.max(0, currentFound)\n            let marker = findResult[currentFound];\n            let pos = marker.find();\n            codeEditor.scrollIntoView(pos.to);\n            marker.clear();\n            findResult[currentFound] = doc.markText( pos.from, pos.to,\n                { \"className\" : FIND_RESULT_SELECTED_CSS_CLASSNAME }\n            );\n        }\n\n        return {\n            totalFound,\n            currentFound: Math.min(currentFound + 1, totalFound)\n        };\n    }\n\n    async findNext(direction, currentFound, nextFound) {\n        const codeEditor = await this.getCodeEditor();\n        const doc = codeEditor.doc;\n\n        //\n        // Dehighlight current, highlight & scrollIntoView next\n        //\n\n        let marker = this.findResult[currentFound];\n        let pos = marker.find();\n        marker.clear();\n        marker = doc.markText(\n            pos.from, pos.to,\n            { \"className\" : FIND_RESULT_CSS_CLASSNAME }\n        );\n        this.findResult[currentFound] = marker;\n\n        marker = this.findResult[nextFound];\n        pos = marker.find();\n        marker.clear();\n        marker = doc.markText(\n            pos.from, pos.to,\n            { \"className\" : FIND_RESULT_SELECTED_CSS_CLASSNAME }\n        );\n        this.findResult[nextFound] = marker;\n\n        codeEditor.scrollIntoView(pos.from);\n    }\n\n    async findBoxClosed(totalFound, currentFound) {\n        const codeEditor = await this.getCodeEditor();\n\n        if (totalFound > 0) {\n            const doc = codeEditor.doc;\n            const pos = this.findResult[currentFound].find();\n            // Note setting the selection sets the cursor to\n            // the end of the selection and scrolls it into\n            // view\n            doc.setSelection(pos.from, pos.to);\n            // Clear all markers\n            codeEditor.operation(() => {\n                for (let i = 0; i < this.findResult.length; ++i) {\n                    let marker = this.findResult[i];\n                    marker.clear();\n                }\n            });\n        }\n        this.findResult = null;\n\n        codeEditor.focus();\n    }\n}\n","// ck-find-result and ck-find-result_selected are the styles ck-editor\n// uses for highlighting matches, use the same one on CodeMirror\n// for consistency\nimport libraryLoader from \"../services/library_loader.js\";\nimport utils from \"../services/utils.js\";\nimport appContext from \"../components/app_context.js\";\n\nconst FIND_RESULT_SELECTED_CSS_CLASSNAME = \"ck-find-result_selected\";\nconst FIND_RESULT_CSS_CLASSNAME = \"ck-find-result\";\n\nexport default class FindInHtml {\n    constructor(parent) {\n        /** @property {FindWidget} */\n        this.parent = parent;\n        this.currentIndex = 0;\n        this.$results = null;\n    }\n\n    async performFind(searchTerm, matchCase, wholeWord) {\n        await libraryLoader.requireLibrary(libraryLoader.MARKJS);\n\n        const $content = await this.parent.noteContext.getContentElement();\n\n        const wholeWordChar = wholeWord ? \"\\\\b\" : \"\";\n        const regExp = new RegExp(wholeWordChar + utils.escapeRegExp(searchTerm) + wholeWordChar, matchCase ? \"g\" : \"gi\");\n\n        return new Promise(res => {\n            $content.unmark({\n                done: () => {\n                    $content.markRegExp(regExp, {\n                        element: \"span\",\n                        className: FIND_RESULT_CSS_CLASSNAME,\n                        separateWordSearch: false,\n                        caseSensitive: matchCase,\n                        done: async () => {\n                            this.$results = $content.find(`.${FIND_RESULT_CSS_CLASSNAME}`);\n                            this.currentIndex = 0;\n                            await this.jumpTo();\n\n                            res({\n                                totalFound: this.$results.length,\n                                currentFound: Math.min(1, this.$results.length)\n                            });\n                        }\n                    });\n                }\n            });\n        });\n    }\n\n    async findNext(direction, currentFound, nextFound) {\n        if (this.$results.length) {\n            this.currentIndex += direction;\n\n            if (this.currentIndex < 0) {\n                this.currentIndex = this.$results.length - 1;\n            }\n\n            if (this.currentIndex > this.$results.length - 1) {\n                this.currentIndex = 0;\n            }\n\n            await this.jumpTo();\n        }\n    }\n\n    async findBoxClosed(totalFound, currentFound) {\n        const $content = await this.parent.noteContext.getContentElement();\n        $content.unmark();\n    }\n\n    async jumpTo() {\n        if (this.$results.length) {\n            const offsetTop = 100;\n            const $current = this.$results.eq(this.currentIndex);\n            this.$results.removeClass(FIND_RESULT_SELECTED_CSS_CLASSNAME);\n\n            if ($current.length) {\n                $current.addClass(FIND_RESULT_SELECTED_CSS_CLASSNAME);\n                const position = $current.position().top - offsetTop;\n\n                const $content = await this.parent.noteContext.getContentElement();\n                const $contentWiget = appContext.getComponentByEl($content);\n\n                $contentWiget.triggerCommand(\"scrollContainerTo\", {position});\n            }\n        }\n    }\n}\n","/**\n * (c) Antonio Tejada 2022\n * https://github.com/antoniotejada/Trilium-FindWidget\n */\n\nimport NoteContextAwareWidget from \"./note_context_aware_widget.js\";\nimport FindInText from \"./find_in_text.js\";\nimport FindInCode from \"./find_in_code.js\";\nimport FindInHtml from \"./find_in_html.js\";\n\nconst findWidgetDelayMillis = 200;\nconst waitForEnter = (findWidgetDelayMillis < 0);\n\n// tabIndex=-1 on the checkbox labels is necessary, so when clicking on the label,\n// the focusout handler is called with relatedTarget equal to the label instead\n// of undefined. It's -1 instead of > 0, so they don't tabstop\nconst TPL = `\n<div style=\"contain: none;\">\n    <style>\n        .find-widget-box {\n            padding: 10px;\n            border-top: 1px solid var(--main-border-color); \n            align-items: center;\n        }\n        \n        .find-widget-box > * {\n            margin-right: 15px;\n        }\n        \n        .find-widget-box {\n            display: flex;\n        }\n        \n        .find-widget-found-wrapper {\n            font-weight: bold;\n        }\n        \n        .find-widget-search-term-input-group {\n            max-width: 300px;\n        }\n        \n        .find-widget-spacer {\n            flex-grow: 1;\n        }\n    </style>\n\n    <div class=\"find-widget-box\">\n        <div class=\"input-group find-widget-search-term-input-group\">\n            <input type=\"text\" class=\"form-control find-widget-search-term-input\">\n            <div class=\"input-group-append\">\n                <button class=\"btn btn-outline-secondary bx bxs-chevron-up find-widget-previous-button\" type=\"button\"></button>\n                <button class=\"btn btn-outline-secondary bx bxs-chevron-down find-widget-next-button\" type=\"button\"></button>\n            </div>\n        </div>\n        \n        <div class=\"form-check\">\n            <label tabIndex=\"-1\" class=\"form-check-label\">\n                <input type=\"checkbox\" class=\"form-check-input find-widget-case-sensitive-checkbox\"> \n                区分大小写\n            </label>\n        </div>\n\n        <div class=\"form-check\">\n            <label tabIndex=\"-1\" class=\"form-check-label\">\n                <input type=\"checkbox\" class=\"form-check-input find-widget-match-words-checkbox\"> \n                全字匹配\n            </label>\n        </div>\n        \n        <div class=\"find-widget-found-wrapper\">\n            <span class=\"find-widget-current-found\">0</span>\n            /\n            <span class=\"find-widget-total-found\">0</span>\n        </div>\n        \n        <div class=\"find-widget-spacer\"></div>\n        \n        <div class=\"find-widget-close-button\"><button class=\"btn icon-action bx bx-x\"></button></div>\n    </div>\n</div>`;\n\nexport default class FindWidget extends NoteContextAwareWidget {\n    constructor() {\n        super();\n\n        this.searchTerm = null;\n\n        this.textHandler = new FindInText(this);\n        this.codeHandler = new FindInCode(this);\n        this.htmlHandler = new FindInHtml(this);\n    }\n\n    async noteSwitched() {\n        await super.noteSwitched();\n\n        await this.closeSearch();\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$findBox = this.$widget.find('.find-widget-box');\n        this.$findBox.hide();\n        this.$input = this.$widget.find('.find-widget-search-term-input');\n        this.$currentFound = this.$widget.find('.find-widget-current-found');\n        this.$totalFound = this.$widget.find('.find-widget-total-found');\n        this.$caseSensitiveCheckbox = this.$widget.find(\".find-widget-case-sensitive-checkbox\");\n        this.$caseSensitiveCheckbox.change(() => this.performFind());\n        this.$matchWordsCheckbox = this.$widget.find(\".find-widget-match-words-checkbox\");\n        this.$matchWordsCheckbox.change(() => this.performFind());\n        this.$previousButton = this.$widget.find(\".find-widget-previous-button\");\n        this.$previousButton.on(\"click\", () => this.findNext(-1));\n        this.$nextButton = this.$widget.find(\".find-widget-next-button\");\n        this.$nextButton.on(\"click\", () => this.findNext(1));\n        this.$closeButton = this.$widget.find(\".find-widget-close-button\");\n        this.$closeButton.on(\"click\", () => this.closeSearch());\n\n        this.$input.keydown(async e => {\n            if ((e.metaKey || e.ctrlKey) && (e.key === 'F' || e.key === 'f')) {\n                // If ctrl+f is pressed when the findbox is shown, select the\n                // whole input to find\n                this.$input.select();\n            } else if (e.key === 'Enter' || e.key === 'F3') {\n                await this.findNext(e?.shiftKey ? -1 : 1);\n                e.preventDefault();\n                return false;\n            }\n        });\n\n        this.$findBox.keydown(async e => {\n            if (e.key === 'Escape') {\n                await this.closeSearch();\n            }\n        });\n\n        this.$input.on('input', () => this.startSearch());\n\n        return this.$widget;\n    }\n\n    async findInTextEvent() {\n        if (!this.isActiveNoteContext()) {\n            return;\n        }\n\n        if (!['text', 'code', 'render'].includes(this.note.type)) {\n            return;\n        }\n\n        this.handler = await this.getHandler();\n\n        const selectedText = window.getSelection().toString() || \"\";\n\n        this.$findBox.show();\n        this.$input.focus();\n\n        const isAlreadyVisible = this.$findBox.is(\":visible\");\n\n        if (isAlreadyVisible) {\n            if (selectedText) {\n                this.$input.val(selectedText);\n            }\n\n            if (this.$input.val()) {\n                await this.performFind();\n            }\n\n            this.$input.select();\n        } else {\n            this.$totalFound.text(0);\n            this.$currentFound.text(0);\n            this.$input.val(selectedText);\n\n            if (selectedText) {\n                this.$input.select();\n                await this.performFind();\n            }\n        }\n    }\n\n    async getHandler() {\n        if (this.note.type === 'render') {\n            return this.htmlHandler;\n        }\n\n        const readOnly = await this.noteContext.isReadOnly();\n\n        if (readOnly) {\n            return this.htmlHandler;\n        } else {\n            return this.note.type === \"code\"\n                ? this.codeHandler\n                : this.textHandler;\n        }\n    }\n\n    startSearch() {\n        // XXX This should clear the previous search immediately in all cases\n        //     (the search is stale when waitforenter but also while the\n        //     delay is running for the non waitforenter case)\n        if (!waitForEnter) {\n            // Clear the previous timeout if any, it's ok if timeoutId is\n            // null or undefined\n            clearTimeout(this.timeoutId);\n\n            // Defer the search a few millis so the search doesn't start\n            // immediately, as this can cause search word typing lag with\n            // one or two-char searchwords and long notes\n            // See https://github.com/antoniotejada/Trilium-FindWidget/issues/1\n            this.timeoutId = setTimeout(async () => {\n                this.timeoutId = null;\n                await this.performFind();\n            }, findWidgetDelayMillis);\n        }\n    }\n\n    /**\n     * @param direction +1 for next, -1 for previous\n     * @returns {Promise<void>}\n     */\n    async findNext(direction) {\n        const searchTerm = this.$input.val();\n        if (waitForEnter && this.searchTerm !== searchTerm) {\n            await this.performFind();\n        }\n        const totalFound = parseInt(this.$totalFound.text());\n        const currentFound = parseInt(this.$currentFound.text()) - 1;\n\n        if (totalFound > 0) {\n            let nextFound = currentFound + direction;\n            // Wrap around\n            if (nextFound > totalFound - 1) {\n                nextFound = 0;\n            } else if (nextFound < 0) {\n                nextFound = totalFound - 1;\n            }\n\n            this.$currentFound.text(nextFound + 1);\n\n            await this.handler.findNext(direction, currentFound, nextFound);\n        }\n    }\n\n    /** Perform the find and highlight the find results. */\n    async performFind() {\n        const searchTerm = this.$input.val();\n        const matchCase = this.$caseSensitiveCheckbox.prop(\"checked\");\n        const wholeWord = this.$matchWordsCheckbox.prop(\"checked\");\n\n        const {totalFound, currentFound} = await this.handler.performFind(searchTerm, matchCase, wholeWord);\n\n        this.$totalFound.text(totalFound);\n        this.$currentFound.text(currentFound);\n\n        this.searchTerm = searchTerm;\n    }\n\n    async closeSearch() {\n        if (this.$findBox.is(\":visible\")) {\n            this.$findBox.hide();\n\n            // Restore any state, if there's a current occurrence clear markers\n            // and scroll to and select the last occurrence\n            const totalFound = parseInt(this.$totalFound.text());\n            const currentFound = parseInt(this.$currentFound.text()) - 1;\n\n            this.searchTerm = null;\n\n            await this.handler.findBoxClosed(totalFound, currentFound);\n        }\n    }\n\n    isEnabled() {\n        return super.isEnabled() && ['text', 'code', 'render'].includes(this.note.type);\n    }\n}\n","/**\n * Table of contents widget\n * (c) Antonio Tejada 2022\n *\n * By design, there's no support for nonsensical or malformed constructs:\n * - headings inside elements (e.g. Trilium allows headings inside tables, but\n *   not inside lists)\n * - nested headings when using raw HTML <H2><H3></H3></H2>\n * - malformed headings when using raw HTML <H2></H3></H2><H3>\n * - etc.\n *\n * In those cases, the generated TOC may be incorrect, or the navigation may lead\n * to the wrong heading (although what \"right\" means in those cases is not\n * clear), but it won't crash.\n */\n\nimport attributeService from \"../services/attributes.js\";\nimport RightPanelWidget from \"./right_panel_widget.js\";\nimport options from \"../services/options.js\";\nimport OnClickButtonWidget from \"./buttons/onclick_button.js\";\nimport appContext from \"../components/app_context.js\";\n\nconst TPL = `<div class=\"toc-widget\">\n    <style>\n        .toc-widget {\n            padding: 10px;\n            contain: none; \n            overflow: auto;\n            position: relative;\n        }\n        \n        .toc ol {\n            padding-left: 25px;\n        }\n        \n        .toc > ol {\n            padding-left: 20px;\n        }\n        \n        .toc li {\n            cursor: pointer;\n            text-align: justify;\n            text-justify: distribute;\n            word-wrap: break-word;\n            hyphens: auto;\n        }\n        \n        .toc li:hover {\n            font-weight: bold;\n        }\n    </style>\n\n    <span class=\"toc\"></span>\n</div>`;\n\nexport default class TocWidget extends RightPanelWidget {\n    get widgetTitle() {\n        return \"目录\";\n    }\n\n    get widgetButtons() {\n        return [\n            new OnClickButtonWidget()\n                .icon(\"bx-slider\")\n                .title(\"Options\")\n                .titlePlacement(\"left\")\n                .onClick(() => appContext.tabManager.openContextWithNote('_optionsTextNotes', {activate: true}))\n                .class(\"icon-action\"),\n            new OnClickButtonWidget()\n                .icon(\"bx-x\")\n                .titlePlacement(\"left\")\n                .onClick(widget => widget.triggerCommand(\"closeToc\"))\n                .class(\"icon-action\")\n        ];\n    }\n\n    isEnabled() {\n        return super.isEnabled()\n            && this.note.type === 'text'\n            && !this.noteContext.viewScope.tocTemporarilyHidden\n            && this.noteContext.viewScope.viewMode === 'default';\n    }\n\n    async doRenderBody() {\n        this.$body.empty().append($(TPL));\n        this.$toc = this.$body.find('.toc');\n    }\n\n    async refreshWithNote(note) {\n        /*The reason for adding tocPreviousVisible is to record whether the previous state of the toc is hidden or displayed,\n        * and then let it be displayed/hidden at the initial time. If there is no such value,\n        * when the right panel needs to display highlighttext but not toc, every time the note content is changed,\n        * toc will appear and then close immediately, because getToc(html) function will consume time*/\n        this.toggleInt(!!this.noteContext.viewScope.tocPreviousVisible);\n\n        const tocLabel = note.getLabel('toc');\n\n        if (tocLabel?.value === 'hide') {\n            this.toggleInt(false);\n            this.triggerCommand(\"reEvaluateRightPaneVisibility\");\n            return;\n        }\n\n        let $toc = \"\", headingCount = 0;\n        // Check for type text unconditionally in case alwaysShowWidget is set\n        if (this.note.type === 'text') {\n            const { content } = await note.getBlob();\n            ({$toc, headingCount} = await this.getToc(content));\n        }\n\n        this.$toc.html($toc);\n        if ([\"\", \"show\"].includes(tocLabel?.value) || headingCount >= options.getInt('minTocHeadings')){\n            this.toggleInt(true);\n            this.noteContext.viewScope.tocPreviousVisible=true;\n        }else{\n            this.toggleInt(false);\n            this.noteContext.viewScope.tocPreviousVisible=false;\n        }\n\n        this.triggerCommand(\"reEvaluateRightPaneVisibility\");\n    }\n\n    /**\n     * Builds a jquery table of contents.\n     *\n     * @param {string} html Note's html content\n     * @returns {$toc: jQuery, headingCount: integer} ordered list table of headings, nested by heading level\n     *         with an onclick event that will cause the document to scroll to\n     *         the desired position.\n     */\n    getToc(html) {\n        // Regular expression for headings <h1>...</h1> using non-greedy\n        // matching and backreferences\n        const headingTagsRegex = /<h(\\d+)[^>]*>(.*?)<\\/h\\1>/gi;\n\n        // Use jquery to build the table rather than html text, since it makes\n        // it easier to set the onclick event that will be executed with the\n        // right captured callback context\n        let $toc = $(\"<ol>\");\n        // Note heading 2 is the first level Trilium makes available to the note\n        let curLevel = 2;\n        const $ols = [$toc];\n        let headingCount;\n        for (let m = null, headingIndex = 0; ((m = headingTagsRegex.exec(html)) !== null); headingIndex++) {\n            //\n            // Nest/unnest whatever necessary number of ordered lists\n            //\n            const newLevel = m[1];\n            const levelDelta = newLevel - curLevel;\n            if (levelDelta > 0) {\n                // Open as many lists as newLevel - curLevel\n                for (let i = 0; i < levelDelta; i++) {\n                    const $ol = $(\"<ol>\");\n                    $ols[$ols.length - 1].append($ol);\n                    $ols.push($ol);\n                }\n            } else if (levelDelta < 0) {\n                // Close as many lists as curLevel - newLevel\n                // be careful not to empty $ols completely, the root element should stay (could happen with a rogue h1 element)\n                for (let i = 0; i < -levelDelta && $ols.length > 1; ++i) {\n                    $ols.pop();\n                }\n            }\n            curLevel = newLevel;\n\n            //\n            // Create the list item and set up the click callback\n            //\n\n            const headingText = $(\"<div>\").html(m[2]).text();\n            const $li = $('<li>').text(headingText);\n            $li.on(\"click\", () => this.jumpToHeading(headingIndex));\n            $ols[$ols.length - 1].append($li);\n            headingCount = headingIndex;\n        }\n\n        $toc = this.pullLeft($toc);\n\n        return {\n            $toc,\n            headingCount\n        };\n    }\n\n    /**\n     * Reduce indent if a larger headings are not being used: https://github.com/zadam/trilium/issues/4363\n     */\n    pullLeft($toc) {\n        while (true) {\n            const $children = $toc.children();\n\n            if ($children.length !== 1) {\n                break;\n            }\n\n            const $first = $toc.children(\":first\");\n\n            if ($first[0].tagName !== 'OL') {\n                break;\n            }\n\n            $toc = $first;\n        }\n        return $toc;\n    }\n\n    async jumpToHeading(headingIndex) {\n        // A readonly note can change state to \"readonly disabled\n        // temporarily\" (ie \"edit this note\" button) without any\n        // intervening events, do the readonly calculation at navigation\n        // time and not at outline creation time\n        // See https://github.com/zadam/trilium/issues/2828\n        const isReadOnly = await this.noteContext.isReadOnly();\n\n        let $container;\n        if (isReadOnly) {\n            $container = await this.noteContext.getContentElement();\n        } else {\n            const textEditor = await this.noteContext.getTextEditor();\n            $container = $(textEditor.sourceElement);\n        }\n\n        const headingElement = $container?.find(\":header:not(section.include-note :header)\")?.[headingIndex];\n        headingElement?.scrollIntoView({ behavior: \"smooth\" });\n    }\n\n    async closeTocCommand() {\n        this.noteContext.viewScope.tocTemporarilyHidden = true;\n        await this.refresh();\n        this.triggerCommand('reEvaluateRightPaneVisibility');\n    }\n\n    async entitiesReloadedEvent({loadResults}) {\n        if (loadResults.isNoteContentReloaded(this.noteId)) {\n            await this.refresh();\n        } else if (loadResults.getAttributeRows().find(attr => attr.type === 'label'\n            && (attr.name.toLowerCase().includes('readonly') || attr.name === 'toc')\n            && attributeService.isAffecting(attr, this.note))) {\n\n            await this.refresh();\n        }\n    }\n}\n","/**\n * Widget: Show highlighted text in the right pane\n *\n * By design, there's no support for nonsensical or malformed constructs:\n * - For example, if there is a formula in the middle of the highlighted text, the two ends of the formula will be regarded as two entries\n */\n\nimport attributeService from \"../services/attributes.js\";\nimport RightPanelWidget from \"./right_panel_widget.js\";\nimport options from \"../services/options.js\";\nimport OnClickButtonWidget from \"./buttons/onclick_button.js\";\nimport appContext from \"../components/app_context.js\";\n\nconst TPL = `<div class=\"highlights-list-widget\">\n    <style>\n        .highlights-list-widget {\n            padding: 10px;\n            contain: none; \n            overflow: auto;\n            position: relative;\n        }\n        \n        .highlights-list > ol {\n            padding-left: 20px;\n        }\n        \n        .highlights-list li {\n            cursor: pointer;\n            margin-bottom: 3px;\n            text-align: justify;\n            text-justify: distribute;\n            word-wrap: break-word;\n            hyphens: auto;\n        }\n        \n        .highlights-list li:hover {\n            font-weight: bold;\n        }\n    </style>\n\n    <span class=\"highlights-list\"></span>\n</div>`;\n\nexport default class HighlightsListWidget extends RightPanelWidget {\n    get widgetTitle() {\n        return \"高亮列表\";\n    }\n\n    get widgetButtons() {\n        return [\n            new OnClickButtonWidget()\n                .icon(\"bx-slider\")\n                .title(\"选项\")\n                .titlePlacement(\"left\")\n                .onClick(() => appContext.tabManager.openContextWithNote('_optionsTextNotes', {activate: true}))\n                .class(\"icon-action\"),\n            new OnClickButtonWidget()\n                .icon(\"bx-x\")\n                .titlePlacement(\"left\")\n                .onClick(widget => widget.triggerCommand(\"closeHlt\"))\n                .class(\"icon-action\")\n        ];\n    }\n\n    isEnabled() {\n        return super.isEnabled()\n            && this.note.type === 'text'\n            && !this.noteContext.viewScope.highlightsListTemporarilyHidden\n            && this.noteContext.viewScope.viewMode === 'default';\n    }\n\n    async doRenderBody() {\n        this.$body.empty().append($(TPL));\n        this.$highlightsList = this.$body.find('.highlights-list');\n    }\n\n    async refreshWithNote(note) {\n        /* The reason for adding highlightsListPreviousVisible is to record whether the previous state\n           of the highlightsList is hidden or displayed, and then let it be displayed/hidden at the initial time.\n           If there is no such value, when the right panel needs to display toc but not highlighttext,\n           every time the note content is changed, highlighttext Widget will appear and then close immediately,\n           because getHlt function will consume time */\n        if (this.noteContext.viewScope.highlightsListPreviousVisible) {\n            this.toggleInt(true);\n        } else {\n            this.toggleInt(false);\n        }\n\n        const optionsHighlightsList = JSON.parse(options.get('highlightsList'));\n\n        if (note.isLabelTruthy('hideHighlightWidget') || !optionsHighlightsList.length) {\n            this.toggleInt(false);\n            this.triggerCommand(\"reEvaluateRightPaneVisibility\");\n            return;\n        }\n\n        let $highlightsList = \"\", hlLiCount = -1;\n        // Check for type text unconditionally in case alwaysShowWidget is set\n        if (this.note.type === 'text') {\n            const {content} = await note.getNoteComplement();\n            ({$highlightsList, hlLiCount} = this.getHighlightList(content, optionsHighlightsList));\n        }\n        this.$highlightsList.empty().append($highlightsList);\n        if (hlLiCount > 0) {\n            this.toggleInt(true);\n            this.noteContext.viewScope.highlightsListPreviousVisible = true;\n        } else {\n            this.toggleInt(false);\n            this.noteContext.viewScope.highlightsListPreviousVisible = false;\n        }\n\n        this.triggerCommand(\"reEvaluateRightPaneVisibility\");\n    }\n\n    getHighlightList(content, optionsHighlightsList) {\n        // matches a span containing background-color\n        const regex1 = /<span[^>]*style\\s*=\\s*[^>]*background-color:[^>]*?>[\\s\\S]*?<\\/span>/gi;\n        // matches a span containing color\n        const regex2 = /<span[^>]*style\\s*=\\s*[^>]*[^-]color:[^>]*?>[\\s\\S]*?<\\/span>/gi;\n        // match italics\n        const regex3 = /<i>[\\s\\S]*?<\\/i>/gi;\n        // match bold\n        const regex4 = /<strong>[\\s\\S]*?<\\/strong>/gi;\n        // match underline\n        const regex5 = /<u>[\\s\\S]*?<\\/u>/g;\n        // Possible values in optionsHighlightsList： '[\"bold\",\"italic\",\"underline\",\"color\",\"bgColor\"]'\n        // element priority： span>i>strong>u\n        let findSubStr = \"\", combinedRegexStr = \"\";\n        if (optionsHighlightsList.includes(\"bgColor\")) {\n            findSubStr += `,span[style*=\"background-color\"]:not(section.include-note span[style*=\"background-color\"])`;\n            combinedRegexStr += `|${regex1.source}`;\n        }\n        if (optionsHighlightsList.includes(\"color\")) {\n            findSubStr += `,span[style*=\"color\"]:not(section.include-note span[style*=\"color\"])`;\n            combinedRegexStr += `|${regex2.source}`;\n        }\n        if (optionsHighlightsList.includes(\"italic\")) {\n            findSubStr += `,i:not(section.include-note i)`;\n            combinedRegexStr += `|${regex3.source}`;\n        }\n        if (optionsHighlightsList.includes(\"bold\")) {\n            findSubStr += `,strong:not(section.include-note strong)`;\n            combinedRegexStr += `|${regex4.source}`;\n        }\n        if (optionsHighlightsList.includes(\"underline\")) {\n            findSubStr += `,u:not(section.include-note u)`;\n            combinedRegexStr += `|${regex5.source}`;\n        }\n\n        findSubStr = findSubStr.substring(1)\n        combinedRegexStr = `(` + combinedRegexStr.substring(1) + `)`;\n        const combinedRegex = new RegExp(combinedRegexStr, 'gi');\n        const $highlightsList = $(\"<ol>\");\n        let prevEndIndex = -1, hlLiCount = 0;\n        for (let match = null, hltIndex = 0; ((match = combinedRegex.exec(content)) !== null); hltIndex++) {\n            const subHtml = match[0];\n            const startIndex = match.index;\n            const endIndex = combinedRegex.lastIndex;\n            if (prevEndIndex !== -1 && startIndex === prevEndIndex) {\n                // If the previous element is connected to this element in HTML, then concatenate them into one.\n                $highlightsList.children().last().append(subHtml);\n            } else {\n                // TODO: can't be done with $(subHtml).text()?\n                //Can’t remember why regular expressions are used here, but modified to $(subHtml).text() works as expected\n                //const hasText = [...subHtml.matchAll(/(?<=^|>)[^><]+?(?=<|$)/g)].map(matchTmp => matchTmp[0]).join('').trim();\n                const hasText = $(subHtml).text().trim();\n\n                if (hasText) {\n                    $highlightsList.append(\n                        $('<li>')\n                            .html(subHtml)\n                            .on(\"click\", () => this.jumpToHighlightsList(findSubStr, hltIndex))\n                    );\n\n                    hlLiCount++;\n                } else {\n                    // hide li if its text content is empty\n                    continue;\n                }\n            }\n            prevEndIndex = endIndex;\n        }\n        return {\n            $highlightsList,\n            hlLiCount\n        };\n    }\n\n    async jumpToHighlightsList(findSubStr, itemIndex) {\n        const isReadOnly = await this.noteContext.isReadOnly();\n        let targetElement;\n        if (isReadOnly) {\n            const $container = await this.noteContext.getContentElement();\n            targetElement = $container.find(findSubStr).filter(function () {\n                if (findSubStr.indexOf(\"color\") >= 0 && findSubStr.indexOf(\"background-color\") < 0) {\n                    let color = this.style.color;\n                    return !($(this).prop('tagName') === \"SPAN\" && color === \"\");\n                } else {\n                    return true;\n                }\n            }).filter(function () {\n                return $(this).parent(findSubStr).length === 0\n                    && $(this).parent().parent(findSubStr).length === 0\n                    && $(this).parent().parent().parent(findSubStr).length === 0\n                    && $(this).parent().parent().parent().parent(findSubStr).length === 0;\n            })\n        } else {\n            const textEditor = await this.noteContext.getTextEditor();\n            targetElement = $(textEditor.editing.view.domRoots.values().next().value).find(findSubStr).filter(function () {\n                // When finding span[style*=\"color\"] but not looking for span[style*=\"background-color\"],\n                // the background-color error will be regarded as color, so it needs to be filtered\n                if (findSubStr.indexOf(\"color\") >= 0 && findSubStr.indexOf(\"background-color\") < 0) {\n                    let color = this.style.color;\n                    return !($(this).prop('tagName') === \"SPAN\" && color === \"\");\n                } else {\n                    return true;\n                }\n            }).filter(function () {\n                // Need to filter out the child elements of the element that has been found\n                return $(this).parent(findSubStr).length === 0\n                    && $(this).parent().parent(findSubStr).length === 0\n                    && $(this).parent().parent().parent(findSubStr).length === 0\n                    && $(this).parent().parent().parent().parent(findSubStr).length === 0;\n            })\n        }\n        targetElement[itemIndex].scrollIntoView({\n            behavior: \"smooth\", block: \"center\"\n        });\n    }\n\n    async closeHltCommand() {\n        this.noteContext.viewScope.highlightsListTemporarilyHidden = true;\n        await this.refresh();\n        this.triggerCommand('reEvaluateRightPaneVisibility');\n    }\n\n    async entitiesReloadedEvent({loadResults}) {\n        if (loadResults.isNoteContentReloaded(this.noteId)) {\n            await this.refresh();\n        } else if (loadResults.getAttributeRows().find(attr => attr.type === 'label'\n            && (attr.name.toLowerCase().includes('readonly') || attr.name === 'hideHighlightWidget')\n            && attributeService.isAffecting(attr, this.note))) {\n            await this.refresh();\n        }\n    }\n}\n","import BasicWidget from \"../basic_widget.js\";\nimport froca from \"../../services/froca.js\";\nimport bulkActionService from \"../../services/bulk_action.js\";\nimport utils from \"../../services/utils.js\";\nimport server from \"../../services/server.js\";\nimport toastService from \"../../services/toast.js\";\n\nconst TPL = `\n<div class=\"bulk-actions-dialog modal mx-auto\" tabindex=\"-1\" role=\"dialog\">\n    <style>\n        .bulk-actions-dialog .modal-body h4:not(:first-child) {\n            margin-top: 20px;\n        }\n    \n        .bulk-actions-dialog .bulk-available-action-list button {\n            padding: 2px 7px;\n            margin-right: 10px;\n            margin-bottom: 5px;\n        }\n    \n        .bulk-actions-dialog .bulk-existing-action-list {\n            width: 100%;\n        }\n    \n        .bulk-actions-dialog .bulk-existing-action-list td {\n            padding: 7px;\n        }\n    \n        .bulk-actions-dialog .bulk-existing-action-list .button-column {\n            /* minimal width so that table remains static sized and most space remains for middle column with settings */\n            width: 50px;\n            white-space: nowrap;\n            text-align: right;\n        }\n    </style>\n\n    <div class=\"modal-dialog modal-xl\" role=\"document\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <h5 class=\"modal-title mr-auto\">批量动作</h5>\n\n                <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\" style=\"margin-left: 0 !important;\">\n                    <span aria-hidden=\"true\">&times;</span>\n                </button>\n            </div>\n            <div class=\"modal-body\">\n                <h4>受影响的笔记:<span class=\"affected-note-count\">0</span></h4>\n\n                <div class=\"form-check\">\n                    <label class=\"form-check-label\">\n                        <input class=\"include-descendants form-check-input\" type=\"checkbox\" value=\"\">\n                        包括所选笔记的子笔记\n                    </label>\n                </div>\n\n                <h4>可用动作</h4>\n\n                <table class=\"bulk-available-action-list\"></table>\n\n                <h4>选择的动作</h4>\n\n                <table class=\"bulk-existing-action-list\"></table>\n            </div>\n            <div class=\"modal-footer\">\n                <button type=\"submit\" class=\"execute-bulk-actions btn btn-primary\">执行批量动作</button>\n            </div>\n        </div>\n    </div>\n</div>`;\n\nexport default class BulkActionsDialog extends BasicWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$includeDescendants = this.$widget.find(\".include-descendants\");\n        this.$includeDescendants.on(\"change\", () => this.refresh());\n\n        this.$affectedNoteCount = this.$widget.find(\".affected-note-count\");\n\n        this.$availableActionList = this.$widget.find(\".bulk-available-action-list\");\n        this.$existingActionList = this.$widget.find(\".bulk-existing-action-list\");\n\n        this.$widget.on('click', '[data-action-add]', async event => {\n            const actionName = $(event.target).attr('data-action-add');\n\n            await bulkActionService.addAction('_bulkAction', actionName);\n\n            await this.refresh();\n        });\n\n        this.$executeButton = this.$widget.find(\".execute-bulk-actions\");\n        this.$executeButton.on(\"click\", async () => {\n            await server.post(\"bulk-action/execute\", {\n                noteIds: this.selectedOrActiveNoteIds,\n                includeDescendants: this.$includeDescendants.is(\":checked\")\n            });\n\n            toastService.showMessage(\"批量动作已成功执行.\", 3000);\n\n            utils.closeActiveDialog();\n        });\n    }\n\n    async refresh() {\n        this.renderAvailableActions();\n\n        const {affectedNoteCount} = await server.post('bulk-action/affected-notes', {\n            noteIds: this.selectedOrActiveNoteIds,\n            includeDescendants: this.$includeDescendants.is(\":checked\")\n        });\n\n        this.$affectedNoteCount.text(affectedNoteCount);\n\n        const bulkActionNote = await froca.getNote('_bulkAction');\n\n        const actions = bulkActionService.parseActions(bulkActionNote);\n\n        this.$existingActionList.empty();\n\n        if (actions.length > 0) {\n            this.$existingActionList.append(...actions.map(action => action.render()));\n        } else {\n            this.$existingActionList.append($(\"<p>还没好 ... 点击上方按钮添加动作.</p>\"))\n        }\n    }\n\n    renderAvailableActions() {\n        this.$availableActionList.empty();\n\n        for (const actionGroup of bulkActionService.ACTION_GROUPS) {\n            const $actionGroupList = $(\"<td>\");\n            const $actionGroup = $(\"<tr>\")\n                .append($(\"<td>\").text(`${actionGroup.title}: `))\n                .append($actionGroupList);\n\n            for (const action of actionGroup.actions) {\n                $actionGroupList.append(\n                    $('<button class=\"btn btn-sm\">')\n                        .attr('data-action-add', action.actionName)\n                        .text(action.actionTitle)\n                );\n            }\n\n            this.$availableActionList.append($actionGroup);\n        }\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        // only refreshing deleted attrs, otherwise components update themselves\n        if (loadResults.getAttributeRows().find(row =>\n            row.type === 'label'\n            && row.name === 'action'\n            && row.noteId === '_bulkAction'\n            && row.isDeleted)) {\n\n            // this may be triggered from e.g., sync without open widget, then no need to refresh the widget\n            if (this.selectedOrActiveNoteIds && this.$widget.is(\":visible\")) {\n                this.refresh();\n            }\n        }\n    }\n\n    async openBulkActionsDialogEvent({selectedOrActiveNoteIds}) {\n        this.selectedOrActiveNoteIds = selectedOrActiveNoteIds;\n        this.$includeDescendants.prop(\"checked\", false);\n\n        await this.refresh();\n\n        utils.openDialog(this.$widget);\n    }\n}\n","import server from \"../../services/server.js\";\nimport utils from \"../../services/utils.js\";\nimport BasicWidget from \"../basic_widget.js\";\n\nconst TPL = `\n<div class=\"about-dialog modal fade mx-auto\" tabindex=\"-1\" role=\"dialog\">\n    <div class=\"modal-dialog modal-lg\" role=\"document\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <h5 class=\"modal-title mr-auto\">关于 Trilium Notes</h5>\n\n                <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\" style=\"margin-left: 0;\">\n                    <span aria-hidden=\"true\">&times;</span>\n                </button>\n            </div>\n            <div class=\"modal-body\">\n                <table class=\"table table-borderless\">\n                    <tr>\n                        <th>项目主页</th>\n                        <td><a href=\"https://github.com/zadam/trilium\" class=\"external\">https://github.com/zadam/trilium</a></td>\n                    </tr>\n                    <tr>\n                        <th>应用版本:</th>\n                        <td class=\"app-version\"></td>\n                    </tr>\n                    <tr>\n                        <th>数据库版本:</th>\n                        <td class=\"db-version\"></td>\n                    </tr>\n                    <tr>\n                        <th>同步版本:</th>\n                        <td class=\"sync-version\"></td>\n                    </tr>\n                    <tr>\n                        <th>编译日期:</th>\n                        <td class=\"build-date\"></td>\n                    </tr>\n\n                    <tr>\n                        <th>编译版本:</th>\n                        <td><a href=\"\" class=\"build-revision external\" target=\"_blank\"></a></td>\n                    </tr>\n\n                    <tr>\n                        <th>数据目录:</th>\n                        <td class=\"data-directory\"></td>\n                    </tr>\n\n                    <tr>\n                        <th>翻译者:</th>\n                        <td><a href=\"https://github.com/Nriver/trilium-translation\" class=\"external\">https://github.com/Nriver/trilium-translation</a></td>\n                    </tr>\n                </table>\n            </div>\n        </div>\n    </div>\n</div>`;\n\nexport default class AboutDialog extends BasicWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$appVersion = this.$widget.find(\".app-version\");\n        this.$dbVersion = this.$widget.find(\".db-version\");\n        this.$syncVersion = this.$widget.find(\".sync-version\");\n        this.$buildDate = this.$widget.find(\".build-date\");\n        this.$buildRevision = this.$widget.find(\".build-revision\");\n        this.$dataDirectory = this.$widget.find(\".data-directory\");\n    }\n\n    async refresh() {\n        const appInfo = await server.get('app-info');\n\n        this.$appVersion.text(appInfo.appVersion);\n        this.$dbVersion.text(appInfo.dbVersion);\n        this.$syncVersion.text(appInfo.syncVersion);\n        this.$buildDate.text(appInfo.buildDate);\n        this.$buildRevision.text(appInfo.buildRevision);\n        this.$buildRevision.attr('href', `https://github.com/zadam/trilium/commit/${appInfo.buildRevision}`);\n        this.$dataDirectory.text(appInfo.dataDirectory);\n    }\n\n    async openAboutDialogEvent() {\n        await this.refresh();\n\n        utils.openDialog(this.$widget);\n    }\n}\n","import utils from \"../../services/utils.js\";\nimport BasicWidget from \"../basic_widget.js\";\n\nconst TPL = `\n<div class=\"help-dialog modal\" tabindex=\"-1\" role=\"dialog\">\n    <div class=\"modal-dialog\" role=\"document\" style=\"min-width: 100%; height: 100%; margin: 0;\">\n        <div class=\"modal-content\" style=\"height: auto;\">\n            <div class=\"modal-header\">\n                <h5 class=\"modal-title mr-auto\">帮助 (完整<a class=\"external\" href=\"https://github.com/zadam/trilium/wiki\">在线文档</a>)</h5>\n\n                <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n                    <span aria-hidden=\"true\">&times;</span>\n                </button>\n            </div>\n            <div class=\"modal-body\" style=\"overflow: auto; height: calc(100vh - 70px);\">\n                <div class=\"card-columns help-cards\">\n                    <div class=\"card\">\n                        <div class=\"card-body\">\n                            <h5 class=\"card-title\">笔记导航</h5>\n\n                            <p class=\"card-text\">\n                                <ul>\n                                    <li><kbd>上</kbd>, <kbd>下</kbd>-在笔记列表中向上/向下</li>\n                                    <li><kbd>左</kbd>, <kbd>右</kbd> - 折叠/展开节点</li>\n                                    <li><kbd data-command=\"backInNoteHistory\">not set</kbd>, <kbd data-command=\"forwardInNoteHistory\">not set</kbd> - 历史浏览记录后退/前进</li>\n                                    <li><kbd data-command=\"jumpToNote\">not set</kbd>- 显示<a class=\"external\" href=\"https://github.com/zadam/trilium/wiki/Note-navigation#jump-to-note\">\"跳转到\"对话框</a></li>\n                                    <li><kbd data-command=\"scrollToActiveNote\">not set</kbd> - 滚动到当前笔记</li>\n                                    <li><kbd>退格键</kbd> - 跳转到父级笔记</li>\n                                    <li><kbd data-command=\"collapseTree\">not set</kbd> - 折叠整个笔记树</li>\n                                    <li><kbd data-command=\"collapseSubtree\">not set</kbd> - 折叠子树</li>\n                                </ul>\n                            </p>\n                        </div>\n                    </div>\n\n                    <div class=\"card\">\n                        <div class=\"card-body\">\n                            <h5 class=\"card-title\">标签快捷方式</h5>\n\n                            <p class=\"card-text\">\n                            <ul>\n                                <li><kbd>CTRL+鼠标左键</kbd>(或单击鼠标中键)在新标签页中打开笔记链接</li>\n                            </ul>\n\n                            仅桌面客户端有效 (electron 编译版):\n                            <ul>\n                                <li><kbd data-command=\"openNewTab\">not set</kbd>打开空白标签</li>\n                                <li><kbd data-command=\"closeActiveTab\">not set</kbd>关闭活动标签</li>\n                                <li><kbd data-command=\"activateNextTab\">not set</kbd>激活下一个标签</li>\n                                <li><kbd data-command=\"activatePreviousTab\">not set</kbd>激活上一个标签</li>\n                            </ul>\n                            </p>\n                        </div>\n                    </div>\n\n                    <div class=\"card\">\n                        <div class=\"card-body\">\n                            <h5 class=\"card-title\">创建笔记</h5>\n\n                            <p class=\"card-text\">\n                                <ul>\n                                    <li><kbd data-command=\"createNoteAfter\">not set</kbd>- 在当前笔记后创建新笔记</li>\n                                    <li><kbd data-command=\"createNoteInto\">not set</kbd>-在当前笔记中创建新的子笔记</li>\n                                    <li><kbd data-command=\"editBranchPrefix\">not set</kbd> - 编辑活跃笔记的 <a class=\"external\" href=\"https://github.com/zadam/trilium/wiki/Tree concepts#prefix\">前缀</a></li>\n                                </ul>\n                            </p>\n                        </div>\n                    </div>\n\n                    <div class=\"card\">\n                        <div class=\"card-body\">\n                            <h5 class=\"card-title\">移动/克隆笔记</h5>\n\n                            <p class=\"card-text\">\n                                <ul>\n                                    <li><kbd data-command=\"moveNoteUp\">not set</kbd>, <kbd data-command=\"moveNoteDown\">not set</kbd> - 在笔记列表中向上/向下移动笔记</li>\n                                    <li><kbd data-command=\"moveNoteUpInHierarchy\">not set</kbd>, <kbd data-command=\"moveNoteDownInHierarchy\">not set</kbd> - 在层次结构中向上移动笔记</li>\n                                    <li><kbd data-command=\"addNoteAboveToSelection\">not set</kbd>, <kbd data-command=\"addNoteBelowToSelection\">not set</kbd> - 多选上方/下方笔记</li>\n                                    <li><kbd data-command=\"selectAllNotesInParent\">not set</kbd> - 选择当前级别的所有笔记</li>\n                                    <li><kbd>Shift+鼠标左键</kbd> - 选择笔记</li>\n                                    <li><kbd data-command=\"copyNotesToClipboard\">not set</kbd> - 将活动笔记(或当前选择)复制到剪贴板(用于 <a class=\"external\" href=\"https://github.com/zadam/trilium/wiki/Cloning notes\">克隆</a>)</li>\n                                    <li><kbd data-command=\"cutNotesToClipboard\">not set</kbd> - 将当前(或当前选择)笔记剪切到剪贴板中(用于移动笔记)</li>\n                                    <li><kbd data-command=\"pasteNotesFromClipboard\">not set</kbd> - 将笔记作为子笔记粘贴到活动笔记中(可以是移动还是克隆, 具体取决于它是被复制还是剪切到剪贴板中)</li>\n                                    <li><kbd data-command=\"deleteNotes\">not set</kbd> - 删除笔记/子树</li>\n                                </ul>\n                            </p>\n                        </div>\n                    </div>\n\n                    <div class=\"card\">\n                        <div class=\"card-body\">\n                            <h5 class=\"card-title\">编辑笔记</h5>\n\n                            <p class=\"card-text\">\n                                <ul>\n                                    <li><kbd data-command=\"editNoteTitle\">not set</kbd> 从笔记树切换到笔记标题, 或者从笔记标题切换到笔记内容.\n                                        <kbd data-command=\"scrollToActiveNote\">not set</kbd>将从编辑器切换回树状窗格.</li>\n                                    <li><kbd>Ctrl+K</kbd> - 创建/编辑外部链接</li>\n                                    <li><kbd data-command=\"addLinkToText\">not set</kbd> - 创建内部链接</li>\n                                    <li><kbd data-command=\"followLinkUnderCursor\">not set</kbd> - 跟随链接</li>\n                                    <li><kbd data-command=\"insertDateTimeToText\">not set</kbd> - 在光标位置插入当前日期和时间</li>\n                                    <li><kbd data-command=\"scrollToActiveNote\">not set</kbd> - 跳到树状窗格并滚动到活动笔记</li>\n                                </ul>\n                            </p>\n                        </div>\n                    </div>\n\n                    <div class=\"card\">\n                        <div class=\"card-body\">\n                            <h5 class=\"card-title\"><a class=\"external\" href=\"https://github.com/zadam/trilium/wiki/Text-notes#autoformat\">像Markdown一样的自动格式化</a></h5>\n\n                            <p class=\"card-text\">\n                                <ul>\n                                    <li><kbd>##</kbd>, <kbd>###</kbd>, <kbd>####</kbd>等, 然后加上标题空间</li>\n                                    <li><kbd>*</kbd>或者<kbd>-</kbd>后面接着项目符号列表的空位</li>\n                                    <li><kbd>1.</kbd>或者<kbd>1)</kbd>后面接着编号列表的空位</li>\n                                    <li>行首<kbd>&gt;</kbd>后面接着引用块的空位</li>\n                                </ul>\n                            </p>\n                        </div>\n                    </div>\n\n                    <div class=\"card\">\n                        <div class=\"card-body\">\n                            <h5 class=\"card-title\">故障排除</h5>\n\n                            <p class=\"card-text\">\n                                <ul>\n                                    <li><kbd data-command=\"reloadFrontendApp\">not set</kbd> - 重新加载Trilium前端</li>\n                                    <li><kbd data-command=\"openDevTools\">not set</kbd> - 显示开发人员工具</li>\n                                    <li><kbd data-command=\"showSQLConsole\">not set</kbd> - 显示SQL控制台</li>\n                                </ul>\n                            </p>\n                        </div>\n                    </div>\n\n                    <div class=\"card\">\n                        <div class=\"card-body\">\n                            <h5 class=\"card-title\">其他</h5>\n\n                            <p class=\"card-text\">\n                                <ul>\n                                    <li><kbd data-command=\"quickSearch\">not set</kbd> - 定位到快速搜索</li>\n                                    <li><kbd data-command=\"findInText\">not set</kbd> - 页内搜索</li>\n                                </ul>\n                            </p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>`;\n\nexport default class HelpDialog extends BasicWidget {\n    doRender() {\n        this.$widget = $(TPL);\n    }\n\n    showHelpEvent() {\n        utils.openDialog(this.$widget);\n    }\n}\n","import linkService from '../../services/link.js';\nimport utils from '../../services/utils.js';\nimport server from '../../services/server.js';\nimport froca from \"../../services/froca.js\";\nimport appContext from \"../../components/app_context.js\";\nimport hoistedNoteService from \"../../services/hoisted_note.js\";\nimport BasicWidget from \"../basic_widget.js\";\nimport dialogService from \"../../services/dialog.js\";\nimport toastService from \"../../services/toast.js\";\nimport ws from \"../../services/ws.js\";\n\nconst TPL = `\n<div class=\"recent-changes-dialog modal fade mx-auto\" tabindex=\"-1\" role=\"dialog\">\n    <div class=\"modal-dialog modal-lg modal-dialog-scrollable\" role=\"document\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <h5 class=\"modal-title mr-auto\">最近修改</h5>\n                \n                <button class=\"erase-deleted-notes-now-button btn btn-sm\" style=\"padding: 0 10px\">\n                    清理已删除的笔记</button>\n                \n                <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\" style=\"margin-left: 0 !important;\">\n                    <span aria-hidden=\"true\">&times;</span>\n                </button>\n            </div>\n            <div class=\"modal-body\">\n                <div class=\"recent-changes-content\"></div>\n            </div>\n        </div>\n    </div>\n</div>`;\n\nexport default class RecentChangesDialog extends BasicWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$content = this.$widget.find(\".recent-changes-content\");\n        this.$eraseDeletedNotesNow = this.$widget.find(\".erase-deleted-notes-now-button\");\n        this.$eraseDeletedNotesNow.on(\"click\", () => {\n            server.post('notes/erase-deleted-notes-now').then(() => {\n                this.refresh();\n\n                toastService.showMessage(\"删除的笔记已被清理.\");\n            });\n        });\n    }\n\n    async showRecentChangesEvent({ancestorNoteId}) {\n        this.ancestorNoteId = ancestorNoteId;\n\n        await this.refresh();\n\n        utils.openDialog(this.$widget);\n    }\n\n    async refresh() {\n        if (!this.ancestorNoteId) {\n            this.ancestorNoteId = hoistedNoteService.getHoistedNoteId();\n        }\n\n        const recentChangesRows = await server.get(`recent-changes/${this.ancestorNoteId}`);\n\n        // preload all notes into cache\n        await froca.getNotes(recentChangesRows.map(r => r.noteId), true);\n\n        this.$content.empty();\n\n        if (recentChangesRows.length === 0) {\n            this.$content.append(\"还没有修改过...\");\n        }\n\n        const groupedByDate = this.groupByDate(recentChangesRows);\n\n        for (const [dateDay, dayChanges] of groupedByDate) {\n            const $changesList = $('<ul>');\n\n            const dayEl = $('<div>').append($('<b>').text(dateDay)).append($changesList);\n\n            for (const change of dayChanges) {\n                const formattedTime = change.date.substr(11, 5);\n\n                let $noteLink;\n\n                if (change.current_isDeleted) {\n                    $noteLink = $(\"<span>\").text(change.current_title);\n\n                    if (change.canBeUndeleted) {\n                        const $undeleteLink = $(`<a href=\"javascript:\">`)\n                            .text(\"撤销删除\")\n                            .on('click', async () => {\n                                const text = '确定要撤销删除这个笔记和它的子笔记吗?';\n\n                                if (await dialogService.confirm(text)) {\n                                    await server.put(`notes/${change.noteId}/undelete`);\n\n                                    this.$widget.modal('hide');\n\n                                    await ws.waitForMaxKnownEntityChangeId();\n\n                                    appContext.tabManager.getActiveContext().setNote(change.noteId);\n                                }\n                            });\n\n                        $noteLink\n                            .append(' (')\n                            .append($undeleteLink)\n                            .append(')');\n                    }\n                } else {\n                    const note = await froca.getNote(change.noteId);\n                    const notePath = note.getBestNotePathString();\n\n                    if (notePath) {\n                        $noteLink = await linkService.createLink(notePath, {\n                            title: change.title,\n                            showNotePath: true\n                        });\n                    } else {\n                        $noteLink = $(\"<span>\").text(note.title);\n                    }\n                }\n\n                $changesList.append($('<li>')\n                    .append(\n                        $(\"<span>\")\n                            .text(formattedTime)\n                            .attr(\"title\", change.date)\n                    )\n                    .append(' - ')\n                    .append($noteLink));\n            }\n\n            this.$content.append(dayEl);\n        }\n    }\n\n    groupByDate(rows) {\n        const groupedByDate = new Map();\n\n        for (const row of rows) {\n            const dateDay = row.date.substr(0, 10);\n\n            if (!groupedByDate.has(dateDay)) {\n                groupedByDate.set(dateDay, []);\n            }\n\n            groupedByDate.get(dateDay).push(row);\n        }\n\n        return groupedByDate;\n    }\n}\n","import treeService from '../../services/tree.js';\nimport server from '../../services/server.js';\nimport froca from \"../../services/froca.js\";\nimport toastService from \"../../services/toast.js\";\nimport utils from \"../../services/utils.js\";\nimport BasicWidget from \"../basic_widget.js\";\nimport appContext from \"../../components/app_context.js\";\n\nlet branchId;\n\nconst TPL = `<div class=\"branch-prefix-dialog modal fade mx-auto\" tabindex=\"-1\" role=\"dialog\">\n    <div class=\"modal-dialog modal-lg\" role=\"document\">\n        <form class=\"branch-prefix-form\">\n            <div class=\"modal-content\">\n                <div class=\"modal-header\">\n                    <h5 class=\"modal-title mr-auto\">编辑分支前缀</h5>\n\n                    <button class=\"help-button\" type=\"button\" data-help-page=\"Tree-concepts#prefix\" title=\"有关树前缀的帮助\">?</button>\n\n                    <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\" style=\"margin-left: 0;\">\n                        <span aria-hidden=\"true\">&times;</span>\n                    </button>\n                </div>\n                <div class=\"modal-body\">\n                    <div class=\"form-group\">\n                        <label for=\"branch-prefix-input\">前缀: </label> &nbsp;\n\n                        <div class=\"input-group\">\n                            <input class=\"branch-prefix-input form-control\">\n\n                            <div class=\"input-group-append\">\n                                <div class=\"branch-prefix-note-title input-group-text\"></div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <div class=\"modal-footer\">\n                    <button class=\"btn btn-primary btn-sm\">保存</button>\n                </div>\n            </div>\n        </form>\n    </div>\n</div>`;\n\nexport default class BranchPrefixDialog extends BasicWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$form = this.$widget.find(\".branch-prefix-form\");\n        this.$treePrefixInput = this.$widget.find(\".branch-prefix-input\");\n        this.$noteTitle = this.$widget.find('.branch-prefix-note-title');\n\n        this.$form.on('submit', () => {\n            this.savePrefix();\n\n            return false;\n        });\n\n        this.$widget.on('shown.bs.modal', () => this.$treePrefixInput.trigger('focus'));\n    }\n\n    async refresh(notePath) {\n        const {noteId, parentNoteId} = treeService.getNoteIdAndParentIdFromUrl(notePath);\n\n        if (!noteId || !parentNoteId) {\n            return;\n        }\n\n        branchId = await froca.getBranchId(parentNoteId, noteId);\n        const branch = froca.getBranch(branchId);\n\n        if (!branch || branch.noteId === 'root') {\n            return;\n        }\n\n        const parentNote = await froca.getNote(branch.parentNoteId);\n\n        if (parentNote.type === 'search') {\n            return;\n        }\n\n        this.$treePrefixInput.val(branch.prefix);\n\n        const noteTitle = await treeService.getNoteTitle(noteId);\n\n        this.$noteTitle.text(` - ${noteTitle}`);\n    }\n\n    async editBranchPrefixEvent() {\n        const notePath = appContext.tabManager.getActiveContextNotePath();\n\n        await this.refresh(notePath);\n\n        utils.openDialog(this.$widget);\n    }\n\n    async savePrefix() {\n        const prefix = this.$treePrefixInput.val();\n\n        await server.put(`branches/${branchId}/set-prefix`, {prefix: prefix});\n\n        this.$widget.modal('hide');\n\n        toastService.showMessage(\"分支前缀已保存.\");\n    }\n}\n","import server from \"../../services/server.js\";\nimport utils from \"../../services/utils.js\";\nimport BasicWidget from \"../basic_widget.js\";\n\nconst TPL = `<div class=\"sort-child-notes-dialog modal mx-auto\" tabindex=\"-1\" role=\"dialog\">\n    <div class=\"modal-dialog modal-lg\" style=\"max-width: 500px\" role=\"document\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <h5 class=\"modal-title mr-auto\">根据...排列子笔记</h5>\n\n                <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\" style=\"margin-left: 0 !important;\">\n                    <span aria-hidden=\"true\">&times;</span>\n                </button>\n            </div>\n            <form class=\"sort-child-notes-form\">\n                <div class=\"modal-body\">\n                    <h5>排序标准</h5>\n\n                    <div class=\"form-check\">\n                        <label class=\"form-check-label\">\n                           <input class=\"form-check-input\" type=\"radio\" name=\"sort-by\" value=\"title\" checked>\n                            标题\n                        </label>\n                    </div>\n\n                    <div class=\"form-check\">\n                        <label class=\"form-check-label\">\n                            <input class=\"form-check-input\" type=\"radio\" name=\"sort-by\" value=\"dateCreated\">\n                            创建日期\n                        </label>\n                    </div>\n\n                    <div class=\"form-check\">\n                        <label class=\"form-check-label\">\n                            <input class=\"form-check-input\" type=\"radio\" name=\"sort-by\" value=\"dateModified\">\n                            修改日期\n                        </label>\n                    </div>\n\n                    <br/>\n\n                    <h5>排列顺序</h5>\n\n                    <div class=\"form-check\">\n                        <label class=\"form-check-label\">\n                            <input class=\"form-check-input\" type=\"radio\" name=\"sort-direction\" value=\"asc\" checked>\n                            升序\n                        </label>\n                    </div>\n\n                    <div class=\"form-check\">\n                        <label class=\"form-check-label\">\n                            <input class=\"form-check-input\" type=\"radio\" name=\"sort-direction\" value=\"desc\">\n                            降序\n                        </label>\n                    </div>\n\n                    <br />\n\n                    <h5>文件夹</h5>\n\n                    <div class=\"form-check\">\n                        <label class=\"form-check-label\">\n                            <input class=\"form-check-input\" type=\"checkbox\" name=\"sort-folders-first\" value=\"1\">\n                            文件夹排列在前面\n                        </label>\n                    </div>\n                    \n                    <br />\n                    \n                    <h5>自然排序</h5>\n\n                    <div class=\"form-check\">\n                        <label class=\"form-check-label\">\n                            <input class=\"form-check-input\" type=\"checkbox\" name=\"sort-natural\" value=\"1\">\n                            根据不同语言或地区的字符排序和排序规则进行排序。\n                        </label>\n                    </div>\n                    <br />\n                    \n                    <div class=\"form-check\">\n                        <label>\n                            自然排序语言\n                            <input class=\"form-control\" name=\"sort-locale\">\n                            自然排序的语言代码, 例如中文的\"zh-CN\"\n                        </label>\n                    </div>\n                </div>\n                <div class=\"modal-footer\">\n                    <button type=\"submit\" class=\"btn btn-primary\">排序<kbd>回车</kbd></button>\n                </div>\n            </form>\n        </div>\n    </div>\n</div>`;\n\nexport default class SortChildNotesDialog extends BasicWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$form = this.$widget.find(\".sort-child-notes-form\");\n\n        this.$form.on('submit', async () => {\n            const sortBy = this.$form.find(\"input[name='sort-by']:checked\").val();\n            const sortDirection = this.$form.find(\"input[name='sort-direction']:checked\").val();\n            const foldersFirst = this.$form.find(\"input[name='sort-folders-first']\").is(\":checked\");\n            const sortNatural = this.$form.find(\"input[name='sort-natural']\").is(\":checked\");\n            const sortLocale = this.$form.find(\"input[name='sort-locale']\").val();\n\n            await server.put(`notes/${this.parentNoteId}/sort-children`, {sortBy, sortDirection, foldersFirst, sortNatural, sortLocale});\n\n            utils.closeActiveDialog();\n        });\n    }\n\n    async sortChildNotesEvent({node}) {\n        this.parentNoteId = node.data.noteId;\n\n        utils.openDialog(this.$widget);\n\n        this.$form.find('input:first').focus();\n    }\n}\n","import utils from \"../../services/utils.js\";\nimport BasicWidget from \"../basic_widget.js\";\n\nconst TPL = `\n<div class=\"password-not-set-dialog modal fade mx-auto\" tabindex=\"-1\" role=\"dialog\">\n    <div class=\"modal-dialog modal-md\" role=\"document\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <h5 class=\"modal-title mr-auto\">未设置密码</h5>\n\n                <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\" style=\"margin-left: 0;\">\n                    <span aria-hidden=\"true\">&times;</span>\n                </button>\n            </div>\n            <div class=\"modal-body\">\n                受保护的笔记使用用户密码进行加密，但是目前没有设置密码.\n\n                要保护笔记, 请<a class=\"open-password-options-button\" href=\"javascript:\">点击这里打开设置界面</a>并设置密码.\n            </div>\n        </div>\n    </div>\n</div>\n`;\n\nexport default class PasswordNoteSetDialog extends BasicWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$openPasswordOptionsButton = this.$widget.find(\".open-password-options-button\");\n        this.$openPasswordOptionsButton.on(\"click\", () => {\n            this.triggerCommand(\"showOptions\", { section: '_optionsPassword' });\n        });\n    }\n\n    showPasswordNotSetEvent() {\n        utils.openDialog(this.$widget);\n    }\n}\n","import treeService from '../../services/tree.js';\nimport noteAutocompleteService from '../../services/note_autocomplete.js';\nimport utils from \"../../services/utils.js\";\nimport froca from \"../../services/froca.js\";\nimport BasicWidget from \"../basic_widget.js\";\n\nconst TPL = `\n<div class=\"include-note-dialog modal mx-auto\" tabindex=\"-1\" role=\"dialog\">\n    <div class=\"modal-dialog modal-lg\" role=\"document\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <h5 class=\"modal-title\">包含笔记</h5>\n                <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n                    <span aria-hidden=\"true\">&times;</span>\n                </button>\n            </div>\n            <form class=\"include-note-form\">\n                <div class=\"modal-body\">\n                    <div class=\"form-group\">\n                        <label for=\"include-note-autocomplete\">笔记</label>\n                        <div class=\"input-group\">\n                            <input class=\"include-note-autocomplete form-control\" placeholder=\"根据名称搜索笔记\">\n                        </div>\n                    </div>\n\n                    包含的笔记框大小\n\n                    <div class=\"form-check\">\n                        <label class=\"form-check-label\">\n                            <input class=\"form-check-input\" type=\"radio\" name=\"include-note-box-size\" value=\"small\">\n                            小（约10行）\n                        </label>\n                    </div>\n                    <div class=\"form-check\">\n                        <label class=\"form-check-label\">\n                            <input class=\"form-check-input\" type=\"radio\" name=\"include-note-box-size\" value=\"medium\" checked>\n                            中等（约30行）\n                        </label>\n                    </div>\n                    <div class=\"form-check\">\n                        <label class=\"form-check-label\">\n                            <input class=\"form-check-input\" type=\"radio\" name=\"include-note-box-size\" value=\"full\">\n                            完整（框显示完整文本）\n                        </label>\n                    </div>\n                </div>\n                <div class=\"modal-footer\">\n                    <button type=\"submit\" class=\"btn btn-primary\">包含笔记<kbd>回车</kbd></button>\n                </div>\n            </form>\n        </div>\n    </div>\n</div>`;\n\nexport default class IncludeNoteDialog extends BasicWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$form = this.$widget.find(\".include-note-form\");\n        this.$autoComplete = this.$widget.find(\".include-note-autocomplete\");\n        this.$form.on('submit', () => {\n            const notePath = this.$autoComplete.getSelectedNotePath();\n\n            if (notePath) {\n                this.$widget.modal('hide');\n\n                this.includeNote(notePath);\n            }\n            else {\n                logError(\"缺少要包含的noteId.\");\n            }\n\n            return false;\n        })\n    }\n\n    async showIncludeNoteDialogEvent({textTypeWidget}) {\n        this.textTypeWidget = textTypeWidget;\n\n        await this.refresh();\n\n        utils.openDialog(this.$widget);\n    }\n\n    async refresh(widget) {\n        this.$autoComplete.val('');\n\n        noteAutocompleteService.initNoteAutocomplete(this.$autoComplete, {\n            hideGoToSelectedNoteButton: true,\n            allowCreatingNotes: true\n        });\n        noteAutocompleteService.showRecentNotes(this.$autoComplete);\n    }\n\n    async includeNote(notePath) {\n        const noteId = treeService.getNoteIdFromUrl(notePath);\n        const note = await froca.getNote(noteId);\n\n        const boxSize = $(\"input[name='include-note-box-size']:checked\").val();\n\n        if (['image', 'canvas', 'mermaid'].includes(note.type)) {\n            // there's no benefit to use insert note functionlity for images,\n            // so we'll just add an IMG tag\n            this.textTypeWidget.addImage(noteId);\n        }\n        else {\n            this.textTypeWidget.addIncludeNote(noteId, boxSize);\n        }\n    }\n}\n","import noteTypesService from \"../../services/note_types.js\";\nimport BasicWidget from \"../basic_widget.js\";\n\nconst TPL = `\n<div class=\"note-type-chooser-dialog modal mx-auto\" tabindex=\"-1\" role=\"dialog\">\n    <style>\n        .note-type-chooser-dialog {\n            /* note type chooser needs to be higher than other dialogs from which it is triggered, e.g. \"add link\"*/\n            z-index: 1100 !important;\n        }\n        \n        .note-type-chooser-dialog .note-type-dropdown {\n            position: relative;\n            font-size: large;\n            padding: 20px;\n            width: 100%;\n            margin-top: 15px;\n            max-height: 80vh;\n            overflow: auto;\n        }\n    </style>\n    <div class=\"modal-dialog\" style=\"max-width: 500px;\" role=\"document\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <h5 class=\"modal-title mr-auto\">选择笔记类型</h5>\n\n                <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\" style=\"margin-left: 0 !important;\">\n                    <span aria-hidden=\"true\">&times;</span>\n                </button>\n            </div>\n            <div class=\"modal-body\">\n                请选择新笔记的类型/模板:\n\n                <div class=\"dropdown\">\n                    <button class=\"note-type-dropdown-trigger\" type=\"button\" style=\"display: none;\" data-toggle=\"dropdown\">下拉触发</button>\n\n                    <div class=\"note-type-dropdown dropdown-menu\"></div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>`;\n\nexport default class NoteTypeChooserDialog extends BasicWidget {\n    constructor(props) {\n        super(props);\n\n        this.resolve = null;\n        this.$originalFocused = null; // element focused before the dialog was opened, so we can return to it afterward\n        this.$originalDialog = null;\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$noteTypeDropdown = this.$widget.find(\".note-type-dropdown\");\n        this.$noteTypeDropdownTrigger = this.$widget.find(\".note-type-dropdown-trigger\");\n        this.$noteTypeDropdownTrigger.dropdown();\n\n        this.$widget.on(\"hidden.bs.modal\", () => {\n            if (this.resolve) {\n                this.resolve({success: false});\n            }\n\n            if (this.$originalFocused) {\n                this.$originalFocused.trigger('focus');\n                this.$originalFocused = null;\n            }\n\n            glob.activeDialog = this.$originalDialog;\n        });\n\n        this.$noteTypeDropdown.on('click', '.dropdown-item', e => this.doResolve(e));\n\n        this.$noteTypeDropdown.on('focus', '.dropdown-item', e => {\n            this.$noteTypeDropdown.find('.dropdown-item').each((i, el) => {\n                $(el).toggleClass('active', el === e.target);\n            });\n        });\n\n        this.$noteTypeDropdown.on('keydown', '.dropdown-item', e => {\n            if (e.key === 'Enter') {\n                this.doResolve(e);\n                e.preventDefault();\n                return false;\n            }\n        });\n\n        this.$noteTypeDropdown.parent().on('hide.bs.dropdown', e => {\n            // prevent closing dropdown by clicking outside\n            if (e.clickEvent) {\n                e.preventDefault();\n            }\n        });\n    }\n\n    async chooseNoteTypeEvent({callback}) {\n        this.$originalFocused = $(':focus');\n\n        const noteTypes = await noteTypesService.getNoteTypeItems();\n\n        this.$noteTypeDropdown.empty();\n\n        for (const noteType of noteTypes) {\n            if (noteType.title === '----') {\n                this.$noteTypeDropdown.append($('<h6 class=\"dropdown-header\">').append(\"Templates:\"));\n            }\n            else {\n                this.$noteTypeDropdown.append(\n                    $('<a class=\"dropdown-item\" tabindex=\"0\">')\n                        .attr(\"data-note-type\", noteType.type)\n                        .attr(\"data-template-note-id\", noteType.templateNoteId)\n                        .append($(\"<span>\").addClass(noteType.uiIcon))\n                        .append(` ${noteType.title}`)\n                );\n            }\n        }\n\n        this.$noteTypeDropdownTrigger.dropdown('show');\n\n        this.$originalDialog = glob.activeDialog;\n        glob.activeDialog = this.$widget;\n        this.$widget.modal();\n\n        this.$noteTypeDropdown.find(\".dropdown-item:first\").focus();\n\n        this.resolve = callback;\n    }\n\n    doResolve(e) {\n        const $item = $(e.target).closest(\".dropdown-item\");\n        const noteType = $item.attr(\"data-note-type\");\n        const templateNoteId = $item.attr(\"data-template-note-id\");\n\n        this.resolve({\n            success: true,\n            noteType,\n            templateNoteId\n        });\n        this.resolve = null;\n\n        this.$widget.modal(\"hide\");\n    }\n}\n","import noteAutocompleteService from '../../services/note_autocomplete.js';\nimport utils from \"../../services/utils.js\";\nimport appContext from \"../../components/app_context.js\";\nimport BasicWidget from \"../basic_widget.js\";\nimport shortcutService from \"../../services/shortcuts.js\";\n\nconst TPL = `<div class=\"jump-to-note-dialog modal mx-auto\" tabindex=\"-1\" role=\"dialog\">\n    <div class=\"modal-dialog modal-lg\" role=\"document\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <div class=\"input-group\">\n                    <input class=\"jump-to-note-autocomplete form-control\" placeholder=\"根据名称搜索笔记\">\n                </div>\n\n                <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n                    <span aria-hidden=\"true\">&times;</span>\n                </button>\n            </div>\n            <div class=\"modal-body\">\n                <div class=\"algolia-autocomplete-container jump-to-note-results\"></div>\n            </div>\n            <div class=\"modal-footer\">\n                <button class=\"show-in-full-text-button btn btn-sm\">全文搜索<kbd>Ctrl+回车</kbd></button>\n            </div>\n        </div>\n    </div>\n</div>`;\n\nconst KEEP_LAST_SEARCH_FOR_X_SECONDS = 120;\n\nexport default class JumpToNoteDialog extends BasicWidget {\n    constructor() {\n        super();\n\n        this.lastOpenedTs = 0;\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$autoComplete = this.$widget.find(\".jump-to-note-autocomplete\");\n        this.$results = this.$widget.find(\".jump-to-note-results\");\n        this.$showInFullTextButton = this.$widget.find(\".show-in-full-text-button\");\n        this.$showInFullTextButton.on('click', e => this.showInFullText(e));\n\n        shortcutService.bindElShortcut(this.$widget, 'ctrl+return', e => this.showInFullText(e));\n    }\n\n    async jumpToNoteEvent() {\n        utils.openDialog(this.$widget);\n\n        // first open dialog, then refresh since refresh is doing focus which should be visible\n        this.refresh();\n\n        this.lastOpenedTs = Date.now();\n    }\n\n    async refresh() {\n        noteAutocompleteService.initNoteAutocomplete(this.$autoComplete, {\n            allowCreatingNotes: true,\n            hideGoToSelectedNoteButton: true,\n            container: this.$results\n        })\n            // clear any event listener added in previous invocation of this function\n            .off('autocomplete:noteselected')\n            .on('autocomplete:noteselected', function (event, suggestion, dataset) {\n                if (!suggestion.notePath) {\n                    return false;\n                }\n\n                appContext.tabManager.getActiveContext().setNote(suggestion.notePath);\n            });\n\n        // if you open the Jump To dialog soon after using it previously, it can often mean that you\n        // actually want to search for the same thing (e.g., you opened the wrong note at first try)\n        // so we'll keep the content.\n        // if it's outside of this time limit, then we assume it's a completely new search and show recent notes instead.\n        if (Date.now() - this.lastOpenedTs > KEEP_LAST_SEARCH_FOR_X_SECONDS * 1000) {\n            noteAutocompleteService.showRecentNotes(this.$autoComplete);\n        } else {\n            this.$autoComplete\n                // hack, the actual search value is stored in <pre> element next to the search input\n                // this is important because the search input value is replaced with the suggestion note's title\n                .autocomplete(\"val\", this.$autoComplete.next().text())\n                .trigger('focus')\n                .trigger('select');\n        }\n    }\n\n    showInFullText(e) {\n        // stop from propagating upwards (dangerous, especially with ctrl+enter executable javascript notes)\n        e.preventDefault();\n        e.stopPropagation();\n\n        const searchString = this.$autoComplete.val();\n\n        this.triggerCommand('searchNotes', {searchString});\n\n        this.$widget.modal('hide');\n    }\n}\n","import treeService from '../../services/tree.js';\nimport noteAutocompleteService from \"../../services/note_autocomplete.js\";\nimport utils from \"../../services/utils.js\";\nimport BasicWidget from \"../basic_widget.js\";\n\nconst TPL = `\n<div class=\"add-link-dialog modal mx-auto\" tabindex=\"-1\" role=\"dialog\">\n    <div class=\"modal-dialog modal-lg\" style=\"max-width: 1000px\" role=\"document\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <h5 class=\"modal-title mr-auto\">添加链接</h5>\n\n                <button type=\"button\" class=\"help-button\" title=\"链接帮助\" data-help-page=\"Links\">?</button>\n\n                <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\" style=\"margin-left: 0 !important;\">\n                    <span aria-hidden=\"true\">&times;</span>\n                </button>\n            </div>\n            <form class=\"add-link-form\">\n                <div class=\"modal-body\">\n                    <div class=\"form-group\">\n                        <label for=\"add-link-note-autocomplete\">笔记</label>\n\n                        <div class=\"input-group\">\n                            <input class=\"add-link-note-autocomplete form-control\" placeholder=\"根据名称搜索笔记\">\n                        </div>\n                    </div>\n\n                    <div class=\"add-link-title-settings\">\n                        <div class=\"add-link-title-radios form-check\">\n                            <label class=\"form-check-label\">\n                                <input class=\"form-check-input\" type=\"radio\" name=\"link-type\" value=\"reference-link\" checked>\n                                链接标题跟随笔记标题变化\n                            </label>\n                        </div>\n                        <div class=\"add-link-title-radios form-check\">\n                            <label class=\"form-check-label\">\n                                <input class=\"form-check-input\" type=\"radio\" name=\"link-type\" value=\"hyper-link\">\n                                链接标题可随意修改\n                            </label>\n                        </div>\n\n                        <div class=\"add-link-title-form-group form-group\">\n                            <br/>\n                            <label>\n                                Link title\n                                \n                                <input class=\"link-title form-control\" style=\"width: 100%;\">\n                            </label>\n                        </div>\n                    </div>\n                </div>\n                <div class=\"modal-footer\">\n                    <button type=\"submit\" class=\"btn btn-primary\">添加链接 <kbd>回车</kbd></button>\n                </div>\n            </form>\n        </div>\n    </div>\n</div>`;\n\nexport default class AddLinkDialog extends BasicWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$form = this.$widget.find(\".add-link-form\");\n        this.$autoComplete = this.$widget.find(\".add-link-note-autocomplete\");\n        this.$linkTitle = this.$widget.find(\".link-title\");\n        this.$addLinkTitleSettings = this.$widget.find(\".add-link-title-settings\");\n        this.$addLinkTitleRadios = this.$widget.find(\".add-link-title-radios\");\n        this.$addLinkTitleFormGroup = this.$widget.find(\".add-link-title-form-group\");\n\n        /** @var TextTypeWidget */\n        this.textTypeWidget = null;\n\n        this.$form.on('submit', () => {\n            if (this.$autoComplete.getSelectedNotePath()) {\n                this.$widget.modal('hide');\n\n                const linkTitle = this.getLinkType() === 'reference-link' ? null : this.$linkTitle.val();\n\n                this.textTypeWidget.addLink(this.$autoComplete.getSelectedNotePath(), linkTitle);\n            }\n            else if (this.$autoComplete.getSelectedExternalLink()) {\n                this.$widget.modal('hide');\n\n                this.textTypeWidget.addLink(this.$autoComplete.getSelectedExternalLink(), this.$linkTitle.val());\n            }\n            else {\n                logError(\"No link to add.\");\n            }\n\n            return false;\n        });\n    }\n\n    async showAddLinkDialogEvent({textTypeWidget, text = ''}) {\n        this.textTypeWidget = textTypeWidget;\n\n        this.$addLinkTitleSettings.toggle(!this.textTypeWidget.hasSelection());\n\n        this.$addLinkTitleSettings.find('input[type=radio]').on('change', e => this.updateTitleSettingsVisibility(e));\n\n        // with selection hyperlink is implied\n        if (this.textTypeWidget.hasSelection()) {\n            this.$addLinkTitleSettings.find(\"input[value='hyper-link']\").prop(\"checked\", true);\n        }\n        else {\n            this.$addLinkTitleSettings.find(\"input[value='reference-link']\").prop(\"checked\", true);\n        }\n\n        this.updateTitleSettingsVisibility();\n\n        utils.openDialog(this.$widget);\n\n        this.$autoComplete.val('');\n        this.$linkTitle.val('');\n\n        const setDefaultLinkTitle = async noteId => {\n            const noteTitle = await treeService.getNoteTitle(noteId);\n\n            this.$linkTitle.val(noteTitle);\n        };\n\n        noteAutocompleteService.initNoteAutocomplete(this.$autoComplete, {\n            allowExternalLinks: true,\n            allowCreatingNotes: true\n        });\n\n        this.$autoComplete.on('autocomplete:noteselected', (event, suggestion, dataset) => {\n            if (!suggestion.notePath) {\n                return false;\n            }\n\n            this.updateTitleSettingsVisibility();\n\n            const noteId = treeService.getNoteIdFromUrl(suggestion.notePath);\n\n            if (noteId) {\n                setDefaultLinkTitle(noteId);\n            }\n        });\n\n        this.$autoComplete.on('autocomplete:externallinkselected', (event, suggestion, dataset) => {\n            if (!suggestion.externalLink) {\n                return false;\n            }\n\n            this.updateTitleSettingsVisibility();\n\n            this.$linkTitle.val(suggestion.externalLink);\n        });\n\n        this.$autoComplete.on('autocomplete:cursorchanged',  (event, suggestion, dataset) => {\n            if (suggestion.externalLink) {\n                this.$linkTitle.val(suggestion.externalLink)\n            }\n            else {\n                const noteId = treeService.getNoteIdFromUrl(suggestion.notePath);\n\n                if (noteId) {\n                    setDefaultLinkTitle(noteId);\n                }\n            }\n        });\n\n        if (text && text.trim()) {\n            noteAutocompleteService.setText(this.$autoComplete, text);\n        }\n        else {\n            noteAutocompleteService.showRecentNotes(this.$autoComplete);\n        }\n\n        this.$autoComplete\n            .trigger('focus')\n            .trigger('select'); // to be able to quickly remove entered text\n    }\n\n    getLinkType() {\n        if (this.$autoComplete.getSelectedExternalLink()) {\n            return 'external-link';\n        }\n\n        return this.$addLinkTitleSettings.find('input[type=radio]:checked').val();\n    }\n\n    updateTitleSettingsVisibility() {\n        const linkType = this.getLinkType();\n\n        this.$addLinkTitleFormGroup.toggle(linkType !== 'reference-link');\n        this.$addLinkTitleRadios.toggle(linkType !== 'external-link')\n    }\n}\n","import noteAutocompleteService from \"../../services/note_autocomplete.js\";\nimport utils from \"../../services/utils.js\";\nimport treeService from \"../../services/tree.js\";\nimport toastService from \"../../services/toast.js\";\nimport froca from \"../../services/froca.js\";\nimport branchService from \"../../services/branches.js\";\nimport appContext from \"../../components/app_context.js\";\nimport BasicWidget from \"../basic_widget.js\";\n\nconst TPL = `\n<div class=\"clone-to-dialog modal mx-auto\" tabindex=\"-1\" role=\"dialog\">\n    <div class=\"modal-dialog modal-lg\" style=\"max-width: 1000px\" role=\"document\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <h5 class=\"modal-title mr-auto\">克隆笔记到...</h5>\n\n                <button type=\"button\" class=\"help-button\" title=\"链接帮助\" data-help-page=\"Cloning-notes\">?</button>\n\n                <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\" style=\"margin-left: 0 !important;\">\n                    <span aria-hidden=\"true\">&times;</span>\n                </button>\n            </div>\n            <form class=\"clone-to-form\">\n                <div class=\"modal-body\">\n                    <h5>要克隆的笔记</h5>\n\n                    <ul class=\"clone-to-note-list\" style=\"max-height: 200px; overflow: auto;\"></ul>\n\n                    <div class=\"form-group\">\n                        <label style=\"width: 100%\">\n                            目标父级笔记\n                            <div class=\"input-group\">\n                                <input class=\"clone-to-note-autocomplete form-control\" placeholder=\"根据名称搜索笔记\">\n                            </div>\n                        </label>\n                    </div>\n\n                    <div class=\"form-group\" title=\"克隆的笔记将显示在带有给定前缀的笔记树中\">\n                        <label style=\"width: 100%\">\n                            前缀(可选)\n                            <input class=\"clone-prefix form-control\" style=\"width: 100%;\">\n                        </label>\n                    </div>\n                </div>\n                <div class=\"modal-footer\">\n                    <button type=\"submit\" class=\"btn btn-primary\">克隆到选定的笔记<kbd>回车</kbd></button>\n                </div>\n            </form>\n        </div>\n    </div>\n</div>`;\n\nexport default class CloneToDialog extends BasicWidget {\n    constructor() {\n        super();\n\n        this.clonedNoteIds = null;\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$form = this.$widget.find(\".clone-to-form\");\n        this.$noteAutoComplete = this.$widget.find(\".clone-to-note-autocomplete\");\n        this.$clonePrefix = this.$widget.find(\".clone-prefix\");\n        this.$noteList = this.$widget.find(\".clone-to-note-list\");\n\n        this.$form.on('submit', () => {\n            const notePath = this.$noteAutoComplete.getSelectedNotePath();\n\n            if (notePath) {\n                this.$widget.modal('hide');\n\n                this.cloneNotesTo(notePath);\n            }\n            else {\n                logError(\"缺少要克隆到的路径.\");\n            }\n\n            return false;\n        });\n    }\n\n    async cloneNoteIdsToEvent({noteIds}) {\n        if (!noteIds || noteIds.length === 0) {\n            noteIds = [ appContext.tabManager.getActiveContextNoteId() ];\n        }\n\n        this.clonedNoteIds = [];\n\n        for (const noteId of noteIds) {\n            if (!this.clonedNoteIds.includes(noteId)) {\n                this.clonedNoteIds.push(noteId);\n            }\n        }\n\n        utils.openDialog(this.$widget);\n\n        this.$noteAutoComplete.val('').trigger('focus');\n\n        this.$noteList.empty();\n\n        for (const noteId of this.clonedNoteIds) {\n            const note = await froca.getNote(noteId);\n\n            this.$noteList.append($(\"<li>\").text(note.title));\n        }\n\n        noteAutocompleteService.initNoteAutocomplete(this.$noteAutoComplete);\n        noteAutocompleteService.showRecentNotes(this.$noteAutoComplete);\n    }\n\n    async cloneNotesTo(notePath) {\n        const {noteId, parentNoteId} = treeService.getNoteIdAndParentIdFromUrl(notePath);\n        const targetBranchId = await froca.getBranchId(parentNoteId, noteId);\n\n        for (const cloneNoteId of this.clonedNoteIds) {\n            await branchService.cloneNoteToBranch(cloneNoteId, targetBranchId, this.$clonePrefix.val());\n\n            const clonedNote = await froca.getNote(cloneNoteId);\n            const targetNote = await froca.getBranch(targetBranchId).getNote();\n\n            toastService.showMessage(`笔记 \"${clonedNote.title}\" 已被克隆至 ${targetNote.title}`);\n        }\n    }\n}\n","import noteAutocompleteService from \"../../services/note_autocomplete.js\";\nimport utils from \"../../services/utils.js\";\nimport toastService from \"../../services/toast.js\";\nimport froca from \"../../services/froca.js\";\nimport branchService from \"../../services/branches.js\";\nimport treeService from \"../../services/tree.js\";\nimport BasicWidget from \"../basic_widget.js\";\n\nconst TPL = `\n<div class=\"move-to-dialog modal mx-auto\" tabindex=\"-1\" role=\"dialog\">\n    <div class=\"modal-dialog modal-lg\" style=\"max-width: 1000px\" role=\"document\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <h5 class=\"modal-title mr-auto\">将笔记移至...</h5>\n                \n                <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\" style=\"margin-left: 0 !important;\">\n                    <span aria-hidden=\"true\">&times;</span>\n                </button>\n            </div>\n            <form class=\"move-to-form\">\n                <div class=\"modal-body\">\n                    <h5>要移动的笔记</h5>\n\n                    <ul class=\"move-to-note-list\" style=\"max-height: 200px; overflow: auto;\"></ul>\n\n                    <div class=\"form-group\">\n                        <label style=\"width: 100%\">\n                            目标父级笔记\n                            <div class=\"input-group\">\n                                <input class=\"move-to-note-autocomplete form-control\" placeholder=\"根据名称搜索笔记\">\n                            </div>\n                        </label>\n                    </div>\n                </div>\n                <div class=\"modal-footer\">\n                    <button type=\"submit\" class=\"btn btn-primary\">移至所选笔记<kbd>回车</kbd></button>\n                </div>\n            </form>\n        </div>\n    </div>\n</div>`;\n\nexport default class MoveToDialog extends BasicWidget {\n    constructor() {\n        super();\n\n        this.movedBranchIds = null;\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$form = this.$widget.find(\".move-to-form\");\n        this.$noteAutoComplete = this.$widget.find(\".move-to-note-autocomplete\");\n        this.$noteList = this.$widget.find(\".move-to-note-list\");\n\n        this.$form.on('submit', () => {\n            const notePath = this.$noteAutoComplete.getSelectedNotePath();\n\n            if (notePath) {\n                this.$widget.modal('hide');\n\n                const {noteId, parentNoteId} = treeService.getNoteIdAndParentIdFromUrl(notePath);\n                froca.getBranchId(parentNoteId, noteId).then(branchId => this.moveNotesTo(branchId));\n            }\n            else {\n                logError(\"缺少要移动到的路径.\");\n            }\n\n            return false;\n        });\n    }\n\n    async moveBranchIdsToEvent({branchIds}) {\n        this.movedBranchIds = branchIds;\n\n        utils.openDialog(this.$widget);\n\n        this.$noteAutoComplete.val('').trigger('focus');\n\n        this.$noteList.empty();\n\n        for (const branchId of this.movedBranchIds) {\n            const branch = froca.getBranch(branchId);\n            const note = await froca.getNote(branch.noteId);\n\n            this.$noteList.append($(\"<li>\").text(note.title));\n        }\n\n        noteAutocompleteService.initNoteAutocomplete(this.$noteAutoComplete);\n        noteAutocompleteService.showRecentNotes(this.$noteAutoComplete);\n    }\n\n    async moveNotesTo(parentBranchId) {\n        await branchService.moveToParentNote(this.movedBranchIds, parentBranchId);\n\n        const parentBranch = froca.getBranch(parentBranchId);\n        const parentNote = await parentBranch.getNote();\n\n        toastService.showMessage(`选中的笔记已经被移动到 ${parentNote.title}`);\n    }\n}\n","import utils from '../../services/utils.js';\nimport treeService from \"../../services/tree.js\";\nimport importService from \"../../services/import.js\";\nimport options from \"../../services/options.js\";\nimport BasicWidget from \"../basic_widget.js\";\n\nconst TPL = `\n<div class=\"import-dialog modal fade mx-auto\" tabindex=\"-1\" role=\"dialog\">\n    <div class=\"modal-dialog modal-lg\" role=\"document\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <h5 class=\"modal-title\">导入到笔记</h5>\n                <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n                    <span aria-hidden=\"true\">&times;</span>\n                </button>\n            </div>\n            <form class=\"import-form\">\n                <div class=\"modal-body\">\n                    <div class=\"form-group\">\n                        <label for=\"import-file-upload-input\"><strong>选择导入文件</strong></label>\n\n                        <input type=\"file\" class=\"import-file-upload-input form-control-file\" multiple />\n\n                        <p>选中的文件内容将作为子笔记导入<strong class=\"import-note-title\"></strong>.\n                    </div>\n\n                    <div class=\"form-group\">\n                        <strong>选项:</strong>\n\n                        <div class=\"checkbox\">\n                            <label data-toggle=\"tooltip\" title=\"Trilium <code> .zip </ code>导出文件可以包含可执行脚本, 这些脚本可能包含有害行为. 安全导入会取消所有导入的脚本的执行. 只有在您完全确认脚本安全的情况下取消勾选 &quot;安全导入&quot;.\">\n                                <input class=\"safe-import-checkbox\" value=\"1\" type=\"checkbox\" checked>\n                                <span>安全导入</span>\n                            </label>\n                        </div>\n\n                        <div class=\"checkbox\">\n                            <label data-toggle=\"tooltip\" title=\"如果选中此选项, 则Trilium将读取<code> .zip </ code>, <code> .enex </ code>和<code> .opml </ code>文件, 并从这些存档中的文件创建笔记.\">\n                                <input class=\"explode-archives-checkbox\" value=\"1\" type=\"checkbox\" checked>\n                                <span>读取 <code>.zip</code>, <code>.enex</code> 和 <code>.opml</code> 文件的内容.</span>\n                            </label>\n                        </div>\n\n                        <div class=\"checkbox\">\n                            <label data-toggle=\"tooltip\" title=\"<p>如果您选中此选项, Trilium将尝试通过缩放和优化来压缩导入的图像, 这可能会影响您看到的图像质量.</p><p>这不适用于<code>.zip</code>假定这些文件已经过优化, 使用元数据导入.</p>\">\n                                <input class=\"shrink-images-checkbox\" value=\"1\" type=\"checkbox\" checked> <span>压缩图像</span>\n                            </label>\n                        </div>\n\n                        <div class=\"checkbox\">\n                            <label>\n                                <input class=\"text-imported-as-text-checkbox\" value=\"1\" type=\"checkbox\" checked>\n\n                                如果无法从笔记的元数据识别类型, 则将HTML, Markdown 和 TXT导入为文本笔记\n                            </label>\n                        </div>\n\n                        <div class=\"checkbox\">\n                            <label>\n                                <input class=\"code-imported-as-code-checkbox\" value=\"1\" type=\"checkbox\" checked> 如果无法从笔记的元数据识别类型, 则将导入可识别的代码文件(例如 <code>.json</code>) 为代码笔记\n                            </label>\n                        </div>\n\n                        <div class=\"checkbox\">\n                            <label>\n                                <input class=\"replace-underscores-with-spaces-checkbox\" value=\"1\" type=\"checkbox\" checked>\n\n                                将笔记名称中的下划线替换为空格\n                            </label>\n                        </div>\n                    </div>\n                </div>\n                <div class=\"modal-footer\">\n                    <button class=\"import-button btn btn-primary\">导入</button>\n                </div>\n            </form>\n        </div>\n    </div>\n</div>`;\n\nexport default class ImportDialog extends BasicWidget {\n    constructor() {\n        super();\n\n        this.parentNoteId = null;\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$form = this.$widget.find(\".import-form\");\n        this.$noteTitle = this.$widget.find(\".import-note-title\");\n        this.$fileUploadInput = this.$widget.find(\".import-file-upload-input\");\n        this.$importButton = this.$widget.find(\".import-button\");\n        this.$safeImportCheckbox = this.$widget.find(\".safe-import-checkbox\");\n        this.$shrinkImagesCheckbox = this.$widget.find(\".shrink-images-checkbox\");\n        this.$textImportedAsTextCheckbox = this.$widget.find(\".text-imported-as-text-checkbox\");\n        this.$codeImportedAsCodeCheckbox = this.$widget.find(\".code-imported-as-code-checkbox\");\n        this.$explodeArchivesCheckbox = this.$widget.find(\".explode-archives-checkbox\");\n        this.$replaceUnderscoresWithSpacesCheckbox = this.$widget.find(\".replace-underscores-with-spaces-checkbox\");\n\n        this.$form.on('submit', () => {\n            // disabling so that import is not triggered again.\n            this.$importButton.attr(\"disabled\", \"disabled\");\n\n            this.importIntoNote(this.parentNoteId);\n\n            return false;\n        });\n\n        this.$fileUploadInput.on('change', () => {\n            if (this.$fileUploadInput.val()) {\n                this.$importButton.removeAttr(\"disabled\");\n            }\n            else {\n                this.$importButton.attr(\"disabled\", \"disabled\");\n            }\n        });\n\n        this.$widget.find('[data-toggle=\"tooltip\"]').tooltip({\n            html: true\n        });\n    }\n\n    async showImportDialogEvent({noteId}) {\n        this.parentNoteId = noteId;\n\n        this.$fileUploadInput.val('').trigger('change'); // to trigger Import button disabling listener below\n\n        this.$safeImportCheckbox.prop(\"checked\", true);\n        this.$shrinkImagesCheckbox.prop(\"checked\", options.is('compressImages'));\n        this.$textImportedAsTextCheckbox.prop(\"checked\", true);\n        this.$codeImportedAsCodeCheckbox.prop(\"checked\", true);\n        this.$explodeArchivesCheckbox.prop(\"checked\", true);\n        this.$replaceUnderscoresWithSpacesCheckbox.prop(\"checked\", true);\n\n        this.$noteTitle.text(await treeService.getNoteTitle(this.parentNoteId));\n\n        utils.openDialog(this.$widget);\n    }\n\n    async importIntoNote(parentNoteId) {\n        const files = Array.from(this.$fileUploadInput[0].files); // shallow copy since we're resetting the upload button below\n\n        const boolToString = $el => $el.is(\":checked\") ? \"true\" : \"false\";\n\n        const options = {\n            safeImport: boolToString(this.$safeImportCheckbox),\n            shrinkImages: boolToString(this.$shrinkImagesCheckbox),\n            textImportedAsText: boolToString(this.$textImportedAsTextCheckbox),\n            codeImportedAsCode: boolToString(this.$codeImportedAsCodeCheckbox),\n            explodeArchives: boolToString(this.$explodeArchivesCheckbox),\n            replaceUnderscoresWithSpaces: boolToString(this.$replaceUnderscoresWithSpacesCheckbox)\n        };\n\n        this.$widget.modal('hide');\n\n        await importService.uploadFiles('notes', parentNoteId, files, options);\n    }\n}\n","import treeService from \"../../services/tree.js\";\nimport utils from \"../../services/utils.js\";\nimport ws from \"../../services/ws.js\";\nimport toastService from \"../../services/toast.js\";\nimport froca from \"../../services/froca.js\";\nimport openService from \"../../services/open.js\";\nimport BasicWidget from \"../basic_widget.js\";\n\nconst TPL = `\n<div class=\"export-dialog modal fade mx-auto\" tabindex=\"-1\" role=\"dialog\">\n    <style>\n    .export-dialog .export-form .form-check {\n        padding-top: 10px;\n        padding-bottom: 10px;\n    }\n    \n    .export-dialog .export-form .format-choice {\n        padding-left: 40px;\n        display: none;\n    }\n    \n    .export-dialog .export-form .opml-versions {\n        padding-left: 60px;\n        display: none;\n    }\n    \n    .export-dialog .export-form .form-check-label {\n        padding: 2px;\n    }\n    </style>\n\n    <div class=\"modal-dialog modal-lg\" role=\"document\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <h5 class=\"modal-title\">导出笔记 \"<span class=\"export-note-title\"></span>\"</h5>\n                <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n                    <span aria-hidden=\"true\">&times;</span>\n                </button>\n            </div>\n            <form class=\"export-form\">\n                <div class=\"modal-body\">\n                    <div class=\"form-check\">\n                        <label class=\"form-check-label\">\n                            <input class=\"export-type-subtree form-check-input\" type=\"radio\" name=\"export-type\" value=\"subtree\">\n                            此笔记及其所有子笔记\n                        </label>\n                    </div>\n\n                    <div class=\"export-subtree-formats format-choice\">\n                        <div class=\"form-check\">\n                            <label class=\"form-check-label\">\n                                <input class=\"form-check-input\" type=\"radio\" name=\"export-subtree-format\" value=\"html\">\n                                ZIP压缩的HTML - 推荐, 因为会保留所有格式.\n                            </label>\n                        </div>\n\n                        <div class=\"form-check\">\n                            <label class=\"form-check-label\">\n                                <input class=\"form-check-input\" type=\"radio\" name=\"export-subtree-format\" value=\"markdown\">\n                                Markdown - 会保留大部分格式.\n                            </label>\n                        </div>\n\n                        <div class=\"form-check\">\n                            <label class=\"form-check-label\">\n                                <input class=\"form-check-input\" type=\"radio\" name=\"export-subtree-format\" value=\"opml\">\n                                OPML - 用来导出文本大纲, 其它的格式信息, 图片数据和文件都不会包含在内.\n                            </label>\n                        </div>\n\n                        <div class=\"opml-versions\">\n                            <div class=\"form-check\">\n                                <label class=\"form-check-label\">\n                                    <input class=\"form-check-input\" type=\"radio\" name=\"opml-version\" value=\"1.0\">\n                                    OPML v1.0 - 仅纯文本\n                                </label>\n                            </div>\n\n                            <div class=\"form-check\">\n                                <label class=\"form-check-label\">\n                                    <input class=\"form-check-input\" type=\"radio\" name=\"opml-version\" value=\"2.0\">\n                                    OMPL v2.0 - 还允许HTML\n                                </label>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class=\"form-check\">\n                        <label class=\"form-check-label\">\n                            <input class=\"form-check-input\" type=\"radio\" name=\"export-type\" value=\"single\">\n                            只包含这个笔记, 不包含子笔记\n                        </label>\n                    </div>\n\n                    <div class=\"export-single-formats format-choice\">\n                        <div class=\"form-check\">\n                            <label class=\"form-check-label\">\n                                <input class=\"form-check-input\" type=\"radio\" name=\"export-single-format\" value=\"html\">\n                                HTML - 推荐, 可以保留所有格式.\n                            </label>\n                        </div>\n\n                        <div class=\"form-check\">\n                            <label class=\"form-check-label\">\n                                <input class=\"form-check-input\" type=\"radio\" name=\"export-single-format\" value=\"markdown\">                            \n                                Markdown - 会保留大部分格式.\n                            </label>\n                        </div>\n                    </div>\n                </div>\n                <div class=\"modal-footer\">\n                    <button class=\"export-button btn btn-primary\">导出</button>\n                </div>\n            </form>\n        </div>\n    </div>\n</div>`;\n\nexport default class ExportDialog extends BasicWidget {\n    constructor() {\n        super();\n\n        this.taskId = '';\n        this.branchId = null;\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$form = this.$widget.find(\".export-form\");\n        this.$noteTitle = this.$widget.find(\".export-note-title\");\n        this.$subtreeFormats = this.$widget.find(\".export-subtree-formats\");\n        this.$singleFormats = this.$widget.find(\".export-single-formats\");\n        this.$subtreeType = this.$widget.find(\".export-type-subtree\");\n        this.$singleType = this.$widget.find(\".export-type-single\");\n        this.$exportButton = this.$widget.find(\".export-button\");\n        this.$opmlVersions = this.$widget.find(\".opml-versions\");\n\n        this.$form.on('submit', () => {\n            this.$widget.modal('hide');\n\n            const exportType = this.$widget.find(\"input[name='export-type']:checked\").val();\n\n            if (!exportType) {\n                // this shouldn't happen as we always choose a default export type\n                toastService.showError(\"请先选择导出类型\");\n                return;\n            }\n\n            const exportFormat = exportType === 'subtree'\n                ? this.$widget.find(\"input[name=export-subtree-format]:checked\").val()\n                : this.$widget.find(\"input[name=export-single-format]:checked\").val();\n\n            const exportVersion = exportFormat === 'opml'\n                ? this.$widget.find(\"input[name='opml-version']:checked\").val()\n                : \"1.0\";\n\n            this.exportBranch(this.branchId, exportType, exportFormat, exportVersion);\n\n            return false;\n        });\n\n        this.$widget.find('input[name=export-type]').on('change', e => {\n            if (e.currentTarget.value === 'subtree') {\n                if (this.$widget.find(\"input[name=export-subtree-format]:checked\").length === 0) {\n                    this.$widget.find(\"input[name=export-subtree-format]:first\").prop(\"checked\", true);\n                }\n\n                this.$subtreeFormats.slideDown();\n                this.$singleFormats.slideUp();\n            }\n            else {\n                if (this.$widget.find(\"input[name=export-single-format]:checked\").length === 0) {\n                    this.$widget.find(\"input[name=export-single-format]:first\").prop(\"checked\", true);\n                }\n\n                this.$subtreeFormats.slideUp();\n                this.$singleFormats.slideDown();\n            }\n        });\n\n        this.$widget.find('input[name=export-subtree-format]').on('change', e => {\n            if (e.currentTarget.value === 'opml') {\n                this.$opmlVersions.slideDown();\n            }\n            else {\n                this.$opmlVersions.slideUp();\n            }\n        });\n    }\n\n    async showExportDialogEvent({notePath, defaultType}) {\n        // each opening of the dialog resets the taskId, so we don't associate it with previous exports anymore\n        this.taskId = '';\n        this.$exportButton.removeAttr(\"disabled\");\n\n        if (defaultType === 'subtree') {\n            this.$subtreeType.prop(\"checked\", true).trigger('change');\n\n            // to show/hide OPML versions\n            this.$widget.find(\"input[name=export-subtree-format]:checked\").trigger('change');\n        }\n        else if (defaultType === 'single') {\n            this.$singleType.prop(\"checked\", true).trigger('change');\n        }\n        else {\n            throw new Error(`Unrecognized type '${defaultType}'`);\n        }\n\n        this.$widget.find(\".opml-v2\").prop(\"checked\", true); // setting default\n\n        utils.openDialog(this.$widget);\n\n        const {noteId, parentNoteId} = treeService.getNoteIdAndParentIdFromUrl(notePath);\n\n        this.branchId = await froca.getBranchId(parentNoteId, noteId);\n        this.$noteTitle.text(await treeService.getNoteTitle(noteId));\n    }\n\n    exportBranch(branchId, type, format, version) {\n        this.taskId = utils.randomString(10);\n\n        const url = openService.getUrlForDownload(`api/branches/${branchId}/export/${type}/${format}/${version}/${this.taskId}`);\n\n        openService.download(url);\n    }\n}\n\nws.subscribeToMessages(async message => {\n    const makeToast = (id, message) => ({\n        id: id,\n        title: \"导出状态\",\n        message: message,\n        icon: \"arrow-square-up-right\"\n    });\n\n    if (message.taskType !== 'export') {\n        return;\n    }\n\n    if (message.type === 'taskError') {\n        toastService.closePersistent(message.taskId);\n        toastService.showError(message.message);\n    }\n    else if (message.type === 'taskProgressCount') {\n        toastService.showPersistent(makeToast(message.taskId, `Export in progress: ${message.progressCount}`));\n    }\n    else if (message.type === 'taskSucceeded') {\n        const toast = makeToast(message.taskId, \"Export finished successfully.\");\n        toast.closeAfter = 5000;\n\n        toastService.showPersistent(toast);\n    }\n});\n","import toastService from \"../../services/toast.js\";\nimport utils from \"../../services/utils.js\";\nimport appContext from \"../../components/app_context.js\";\nimport BasicWidget from \"../basic_widget.js\";\nimport shortcutService from \"../../services/shortcuts.js\";\nimport server from \"../../services/server.js\";\n\nconst TPL = `\n<div class=\"markdown-import-dialog modal fade mx-auto\" tabindex=\"-1\" role=\"dialog\">\n    <div class=\"modal-dialog modal-lg\" role=\"document\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <h5 class=\"modal-title\">导入Markdown</h5>\n                <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n                    <span aria-hidden=\"true\">&times;</span>\n                </button>\n            </div>\n            <div class=\"modal-body\">\n                <p>由于使用浏览器沙箱, 因此无法直接从JavaScript读取剪贴板.</p>\n\n                <textarea class=\"markdown-import-textarea\" style=\"height: 340px; width: 100%\"></textarea>\n            </div>\n            <div class=\"modal-footer\">\n                <button class=\"markdown-import-button btn btn-primary\">导入<kbd>Ctrl+回车</kbd></button>\n            </div>\n        </div>\n    </div>\n</div>`;\n\nexport default class MarkdownImportDialog extends BasicWidget {\n    constructor() {\n        super();\n\n        this.lastOpenedTs = 0;\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$importTextarea = this.$widget.find('.markdown-import-textarea');\n        this.$importButton = this.$widget.find('.markdown-import-button');\n\n        this.$importButton.on('click', () => this.sendForm());\n\n        this.$widget.on('shown.bs.modal', () => this.$importTextarea.trigger('focus'));\n\n        shortcutService.bindElShortcut(this.$widget, 'ctrl+return', () => this.sendForm());\n    }\n\n    async convertMarkdownToHtml(markdownContent) {\n        const {htmlContent} = await server.post('other/render-markdown', { markdownContent });\n\n        const textEditor = await appContext.tabManager.getActiveContext().getTextEditor();\n\n        const viewFragment = textEditor.data.processor.toView(htmlContent);\n        const modelFragment = textEditor.data.toModel(viewFragment);\n\n        textEditor.model.insertContent(modelFragment, textEditor.model.document.selection);\n\n        toastService.showMessage(\"Markdown内容已导入到文档中.\");\n    }\n\n    async pasteMarkdownIntoTextEvent() {\n        await this.importMarkdownInlineEvent(); // BC with keyboard shortcuts command\n    }\n\n    async importMarkdownInlineEvent() {\n        if (appContext.tabManager.getActiveContextNoteType() !== 'text') {\n            return;\n        }\n\n        if (utils.isElectron()) {\n            const {clipboard} = utils.dynamicRequire('electron');\n            const text = clipboard.readText();\n\n            this.convertMarkdownToHtml(text);\n        }\n        else {\n            utils.openDialog(this.$widget);\n        }\n    }\n\n    async sendForm() {\n        const text = this.$importTextarea.val();\n\n        this.$widget.modal('hide');\n\n        await this.convertMarkdownToHtml(text);\n\n        this.$importTextarea.val('');\n    }\n}\n","import protectedSessionService from \"../../services/protected_session.js\";\nimport utils from \"../../services/utils.js\";\nimport BasicWidget from \"../basic_widget.js\";\n\nconst TPL = `\n<div class=\"protected-session-password-dialog modal mx-auto\" data-backdrop=\"false\" tabindex=\"-1\" role=\"dialog\">\n    <div class=\"modal-dialog modal-md\" role=\"document\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <h5 class=\"modal-title mr-auto\">保护会话</h5>\n\n                <button class=\"help-button\" type=\"button\" data-help-page=\"Protected-notes\" title=\"保护会话帮助文档\">?</button>\n\n                <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\" style=\"margin-left: 0;\">\n                    <span aria-hidden=\"true\">&times;</span>\n                </button>\n            </div>\n            <form class=\"protected-session-password-form\">\n                <div class=\"modal-body\">\n                    <div class=\"form-group\">\n                        <label style=\"width: -webkit-fill-available\">\n                            输入密码进入保护会话以继续\n                            <input class=\"form-control protected-session-password\" type=\"password\">\n                        </label>\n                    </div>\n                </div>\n                <div class=\"modal-footer\">\n                    <button class=\"btn btn-primary\">开始受保护的会话<kbd>回车</kbd></button>\n                </div>\n            </form>\n        </div>\n    </div>\n</div>`;\n\nexport default class ProtectedSessionPasswordDialog extends BasicWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$passwordForm = this.$widget.find(\".protected-session-password-form\");\n        this.$passwordInput = this.$widget.find(\".protected-session-password\");\n        this.$passwordForm.on('submit', () => {\n            const password = this.$passwordInput.val();\n            this.$passwordInput.val(\"\");\n\n            protectedSessionService.setupProtectedSession(password);\n\n            return false;\n        });\n    }\n\n    showProtectedSessionPasswordDialogEvent() {\n        utils.openDialog(this.$widget);\n\n        this.$passwordInput.trigger('focus');\n    }\n\n    closeProtectedSessionPasswordDialogEvent() {\n        this.$widget.modal('hide');\n    }\n}\n","import utils from '../../services/utils.js';\nimport server from '../../services/server.js';\nimport toastService from \"../../services/toast.js\";\nimport appContext from \"../../components/app_context.js\";\nimport libraryLoader from \"../../services/library_loader.js\";\nimport openService from \"../../services/open.js\";\nimport protectedSessionHolder from \"../../services/protected_session_holder.js\";\nimport BasicWidget from \"../basic_widget.js\";\nimport dialogService from \"../../services/dialog.js\";\n\nconst TPL = `\n<div class=\"revisions-dialog modal fade mx-auto\" tabindex=\"-1\" role=\"dialog\">\n    <style>\n        .revisions-dialog .revision-content-wrapper {\n            flex-grow: 1;\n            margin-left: 20px;\n            display: flex;\n            flex-direction: column;\n            min-width: 0;\n        }\n\n        .revisions-dialog .revision-content {\n            overflow: auto;\n            word-break: break-word;\n        }\n\n        .revisions-dialog .revision-content img {\n            max-width: 100%;\n            object-fit: contain;\n        }\n\n        .revisions-dialog .revision-content pre {\n            max-width: 100%;\n            word-break: break-all;\n            white-space: pre-wrap;\n        }\n    </style>\n\n    <div class=\"modal-dialog modal-xl\" role=\"document\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <h5 class=\"modal-title mr-auto\">笔记修改历史</h5>\n\n                <button class=\"revisions-erase-all-revisions-button btn btn-sm\"\n                        title=\"删除此笔记的所有历史\"\n                        style=\"padding: 0 10px 0 10px;\" type=\"button\">删除所有历史</button>\n\n                <button class=\"help-button\" type=\"button\" data-help-page=\"Note-revisions\" title=\"有关笔记历史的帮助\">?</button>\n\n                <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\" style=\"margin-left: 0 !important;\">\n                    <span aria-hidden=\"true\">&times;</span>\n                </button>\n            </div>\n            <div class=\"modal-body\" style=\"display: flex; height: 80vh;\">\n                <div class=\"dropdown\">\n                    <button class=\"revision-list-dropdown\" type=\"button\" style=\"display: none;\" data-toggle=\"dropdown\">下拉触发</button>\n\n                    <div class=\"revision-list dropdown-menu\" style=\"position: static; height: 100%; overflow: auto;\"></div>\n                </div>\n\n                <div class=\"revision-content-wrapper\">\n                    <div style=\"flex-grow: 0; display: flex; justify-content: space-between;\">\n                        <h3 class=\"revision-title\" style=\"margin: 3px; flex-grow: 100;\"></h3>\n\n                        <div class=\"revision-title-buttons\"></div>\n                    </div>\n\n                    <div class=\"revision-content\"></div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>`;\n\nexport default class RevisionsDialog extends BasicWidget {\n    constructor() {\n        super();\n\n        this.revisionItems = [];\n        this.note = null;\n        this.revisionId = null;\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$list = this.$widget.find(\".revision-list\");\n        this.$listDropdown = this.$widget.find(\".revision-list-dropdown\");\n        this.$content = this.$widget.find(\".revision-content\");\n        this.$title = this.$widget.find(\".revision-title\");\n        this.$titleButtons = this.$widget.find(\".revision-title-buttons\");\n        this.$eraseAllRevisionsButton = this.$widget.find(\".revisions-erase-all-revisions-button\");\n\n        this.$listDropdown.dropdown();\n\n        this.$listDropdown.parent().on('hide.bs.dropdown', e => {\n            // prevent closing dropdown by clicking outside\n            if (e.clickEvent) {\n                e.preventDefault();\n            }\n        });\n\n        this.$widget.on('shown.bs.modal', () => {\n            this.$list.find(`[data-revision-id=\"${this.revisionId}\"]`)\n                .trigger('focus');\n        });\n\n        this.$eraseAllRevisionsButton.on('click', async () => {\n            const text = '确定要删除这个笔记所有的历史版本吗? 这会删除所有历史版本的标题和内容, 但元信息会保留.';\n\n            if (await dialogService.confirm(text)) {\n                await server.remove(`notes/${this.note.noteId}/revisions`);\n\n                this.$widget.modal('hide');\n\n                toastService.showMessage('笔记历史已被删除.');\n            }\n        });\n\n        this.$list.on('click', '.dropdown-item', e => {\n            e.preventDefault();\n            return false;\n        });\n\n        this.$list.on('focus', '.dropdown-item', e => {\n            this.$list.find('.dropdown-item').each((i, el) => {\n                $(el).toggleClass('active', el === e.target);\n            });\n\n            this.setContentPane();\n        });\n    }\n\n    async showRevisionsEvent({noteId = appContext.tabManager.getActiveContextNoteId()}) {\n        utils.openDialog(this.$widget);\n\n        await this.loadRevisions(noteId);\n    }\n\n    async loadRevisions(noteId) {\n        this.$list.empty();\n        this.$content.empty();\n        this.$titleButtons.empty();\n\n        this.note = appContext.tabManager.getActiveContextNote();\n        this.revisionItems = await server.get(`notes/${noteId}/revisions`);\n\n        for (const item of this.revisionItems) {\n            this.$list.append(\n                $('<a class=\"dropdown-item\" tabindex=\"0\">')\n                    .text(`${item.dateLastEdited.substr(0, 16)} (${utils.formatSize(item.contentLength)})`)\n                    .attr('data-revision-id', item.revisionId)\n                    .attr('title', `这个历史版本最后编辑于 ${item.dateLastEdited}`)\n            );\n        }\n\n        this.$listDropdown.dropdown('show');\n\n        if (this.revisionItems.length > 0) {\n            if (!this.revisionId) {\n                this.revisionId = this.revisionItems[0].revisionId;\n            }\n        } else {\n            this.$title.text(\"这个笔记没有修改记录...\");\n            this.revisionId = null;\n        }\n\n        this.$eraseAllRevisionsButton.toggle(this.revisionItems.length > 0);\n    }\n\n    async setContentPane() {\n        const revisionId = this.$list.find(\".active\").attr('data-revision-id');\n\n        const revisionItem = this.revisionItems.find(r => r.revisionId === revisionId);\n\n        this.$title.html(revisionItem.title);\n\n        this.renderContentButtons(revisionItem);\n\n        await this.renderContent(revisionItem);\n    }\n\n    renderContentButtons(revisionItem) {\n        this.$titleButtons.empty();\n\n        const $restoreRevisionButton = $('<button class=\"btn btn-sm\" type=\"button\">恢复此历史版本</button>');\n\n        $restoreRevisionButton.on('click', async () => {\n            const text = '确定要恢复这个历史版本吗? 这会覆盖掉当前版本的标题和内容.';\n\n            if (await dialogService.confirm(text)) {\n                await server.post(`revisions/${revisionItem.revisionId}/restore`);\n\n                this.$widget.modal('hide');\n\n                toastService.showMessage('笔记历史已被还原.');\n            }\n        });\n\n        const $eraseRevisionButton = $('<button class=\"btn btn-sm\" type=\"button\">删除此历史版本</button>');\n\n        $eraseRevisionButton.on('click', async () => {\n            const text = '确定要删除这个历史版本吗? 这会删掉历史版本的标题和内容, 但元信息会保留.';\n\n            if (await dialogService.confirm(text)) {\n                await server.remove(`revisions/${revisionItem.revisionId}`);\n\n                this.loadRevisions(revisionItem.noteId);\n\n                toastService.showMessage('笔记历史已被删除.');\n            }\n        });\n\n        if (!revisionItem.isProtected || protectedSessionHolder.isProtectedSessionAvailable()) {\n            this.$titleButtons\n                .append($restoreRevisionButton)\n                .append(' &nbsp; ');\n        }\n\n        this.$titleButtons\n            .append($eraseRevisionButton)\n            .append(' &nbsp; ');\n\n        const $downloadButton = $('<button class=\"btn btn-sm btn-primary\" type=\"button\">下载</button>');\n\n        $downloadButton.on('click', () => openService.downloadRevision(revisionItem.noteId, revisionItem.revisionId));\n\n        if (!revisionItem.isProtected || protectedSessionHolder.isProtectedSessionAvailable()) {\n            this.$titleButtons.append($downloadButton);\n        }\n    }\n\n    async renderContent(revisionItem) {\n        this.$content.empty();\n\n        const fullRevision = await server.get(`revisions/${revisionItem.revisionId}`);\n\n        if (revisionItem.type === 'text') {\n            this.$content.html(fullRevision.content);\n\n            if (this.$content.find('span.math-tex').length > 0) {\n                await libraryLoader.requireLibrary(libraryLoader.KATEX);\n\n                renderMathInElement(this.$content[0], {trust: true});\n            }\n        } else if (revisionItem.type === 'code') {\n            this.$content.html($(\"<pre>\").text(fullRevision.content));\n        } else if (revisionItem.type === 'image') {\n            this.$content.html($(\"<img>\")\n                // the reason why we put this inline as base64 is that we do not want to let user copy this\n                // as a URL to be used in a note. Instead, if they copy and paste it into a note, it will be uploaded as a new note\n                .attr(\"src\", `data:${fullRevision.mime};base64,${fullRevision.content}`)\n                .css(\"max-width\", \"100%\")\n                .css(\"max-height\", \"100%\"));\n        } else if (revisionItem.type === 'file') {\n            const $table = $(\"<table cellpadding='10'>\")\n                .append($(\"<tr>\").append(\n                    $(\"<th>\").text(\"MIME: \"),\n                    $(\"<td>\").text(revisionItem.mime)\n                ))\n                .append($(\"<tr>\").append(\n                    $(\"<th>\").text(\"文件大小:\"),\n                    $(\"<td>\").text(utils.formatSize(revisionItem.contentLength))\n                ));\n\n            if (fullRevision.content) {\n                $table.append($(\"<tr>\").append(\n                    $('<td colspan=\"2\">').append(\n                        $('<div style=\"font-weight: bold;\">').text(\"预览:\"),\n                        $('<pre class=\"file-preview-content\"></pre>')\n                            .text(fullRevision.content)\n                    )\n                ));\n            }\n\n            this.$content.html($table);\n        } else if (revisionItem.type === 'canvas') {\n            const encodedTitle = encodeURIComponent(revisionItem.title);\n\n            this.$content.html($(\"<img>\")\n                .attr(\"src\", `api/revisions/${revisionItem.revisionId}/image/${encodedTitle}?${Math.random()}`)\n                .css(\"max-width\", \"100%\"));\n        } else if (revisionItem.type === 'mermaid') {\n            const encodedTitle = encodeURIComponent(revisionItem.title);\n\n            this.$content.html($(\"<img>\")\n                .attr(\"src\", `api/revisions/${revisionItem.revisionId}/image/${encodedTitle}?${Math.random()}`)\n                .css(\"max-width\", \"100%\"));\n\n            this.$content.append($(\"<pre>\").text(fullRevision.content));\n        } else {\n            this.$content.text(\"这种类型的笔记无法预览.\");\n        }\n    }\n}\n","import server from \"../../services/server.js\";\nimport froca from \"../../services/froca.js\";\nimport linkService from \"../../services/link.js\";\nimport utils from \"../../services/utils.js\";\nimport BasicWidget from \"../basic_widget.js\";\n\nconst TPL = `\n<div class=\"delete-notes-dialog modal mx-auto\" tabindex=\"-1\" role=\"dialog\">\n    <div class=\"modal-dialog modal-dialog-scrollable modal-xl\" role=\"document\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <h4 class=\"modal-title mr-auto\">删除笔记预览</h4>\n\n                <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n                    <span aria-hidden=\"true\">&times;</span>\n                </button>\n            </div>\n            <div class=\"modal-body\">\n                <div class=\"checkbox\">\n                    <label>\n                        <input class=\"delete-all-clones\" value=\"1\" type=\"checkbox\">\n\n                        同时删除所有克隆 (可以在最近修改里恢复)\n                    </label>\n                </div>\n\n                <div class=\"checkbox\">\n                    <label title=\"Normal (soft) deletion only marks the notes as deleted and they can be undeleted (in recent changes dialog) within a period of time. Checking this option will erase the notes immediately and it won't be possible to undelete the notes.\">\n                        <input class=\"erase-notes\" value=\"1\" type=\"checkbox\">\n\n                        永久删除笔记(不可恢复), 包括所有的克隆. 应用会强制重新加载.\n                    </label>\n                </div>\n\n                <div class=\"delete-notes-list-wrapper\">\n                    <h4>以下笔记将被删除 (<span class=\"deleted-notes-count\"></span>)</h4>\n\n                    <ul class=\"delete-notes-list\" style=\"max-height: 200px; overflow: auto;\"></ul>\n                </div>\n\n                <div class=\"no-note-to-delete-wrapper alert alert-info\">\n                    没有笔记会被删除(只删除克隆).\n                </div>\n\n                <div class=\"broken-relations-wrapper\">\n                    <div class=\"alert alert-danger\">\n                        <h4>以下关系将被破坏并删除 (<span class=\"broke-relations-count\"></span>)</h4>\n\n                        <ul class=\"broken-relations-list\" style=\"max-height: 200px; overflow: auto;\"></ul>\n                    </div>\n                </div>\n            </div>\n            <div class=\"modal-footer\">\n                <button class=\"delete-notes-dialog-cancel-button btn btn-sm\">取消</button>\n\n                &nbsp;\n\n                <button class=\"delete-notes-dialog-ok-button btn btn-primary btn-sm\">好的</button>\n            </div>\n        </div>\n    </div>\n</div>`;\n\nexport default class DeleteNotesDialog extends BasicWidget {\n    constructor() {\n        super();\n\n        this.branchIds = null;\n        this.resolve = null;\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$content = this.$widget.find(\".recent-changes-content\");\n        this.$okButton = this.$widget.find(\".delete-notes-dialog-ok-button\");\n        this.$cancelButton = this.$widget.find(\".delete-notes-dialog-cancel-button\");\n        this.$deleteNotesList = this.$widget.find(\".delete-notes-list\");\n        this.$brokenRelationsList = this.$widget.find(\".broken-relations-list\");\n        this.$deletedNotesCount = this.$widget.find(\".deleted-notes-count\");\n        this.$noNoteToDeleteWrapper = this.$widget.find(\".no-note-to-delete-wrapper\");\n        this.$deleteNotesListWrapper = this.$widget.find(\".delete-notes-list-wrapper\");\n        this.$brokenRelationsListWrapper = this.$widget.find(\".broken-relations-wrapper\");\n        this.$brokenRelationsCount = this.$widget.find(\".broke-relations-count\");\n        this.$deleteAllClones = this.$widget.find(\".delete-all-clones\");\n        this.$eraseNotes = this.$widget.find(\".erase-notes\");\n\n        this.$widget.on('shown.bs.modal', () => this.$okButton.trigger(\"focus\"));\n\n        this.$cancelButton.on('click', () => {\n            utils.closeActiveDialog();\n\n            this.resolve({proceed: false});\n        });\n\n        this.$okButton.on('click', () => {\n            utils.closeActiveDialog();\n\n            this.resolve({\n                proceed: true,\n                deleteAllClones: this.forceDeleteAllClones || this.isDeleteAllClonesChecked(),\n                eraseNotes: this.isEraseNotesChecked()\n            });\n        });\n\n        this.$deleteAllClones.on('click', () => this.renderDeletePreview());\n    }\n\n    async renderDeletePreview() {\n        const response = await server.post('delete-notes-preview', {\n            branchIdsToDelete: this.branchIds,\n            deleteAllClones: this.forceDeleteAllClones || this.isDeleteAllClonesChecked()\n        });\n\n        this.$deleteNotesList.empty();\n        this.$brokenRelationsList.empty();\n\n        this.$deleteNotesListWrapper.toggle(response.noteIdsToBeDeleted.length > 0);\n        this.$noNoteToDeleteWrapper.toggle(response.noteIdsToBeDeleted.length === 0);\n\n        for (const note of await froca.getNotes(response.noteIdsToBeDeleted)) {\n            this.$deleteNotesList.append(\n                $(\"<li>\").append(\n                    await linkService.createLink(note.noteId, {showNotePath: true})\n                )\n            );\n        }\n\n        this.$deletedNotesCount.text(response.noteIdsToBeDeleted.length);\n\n        this.$brokenRelationsListWrapper.toggle(response.brokenRelations.length > 0);\n        this.$brokenRelationsCount.text(response.brokenRelations.length);\n\n        await froca.getNotes(response.brokenRelations.map(br => br.noteId));\n\n        for (const attr of response.brokenRelations) {\n            this.$brokenRelationsList.append(\n                $(\"<li>\")\n                    .append(`笔记 `)\n                    .append(await linkService.createLink(attr.value))\n                    .append(`(将被删除的笔记) 被以下关系 <code>${attr.name}</code> 引用, 来自 `)\n                    .append(await linkService.createLink(attr.noteId))\n            );\n        }\n    }\n\n    async showDeleteNotesDialogEvent({branchIdsToDelete, callback, forceDeleteAllClones}) {\n        this.branchIds = branchIdsToDelete;\n        this.forceDeleteAllClones = forceDeleteAllClones;\n\n        await this.renderDeletePreview();\n\n        utils.openDialog(this.$widget);\n\n        this.$deleteAllClones\n            .prop(\"checked\", !!forceDeleteAllClones)\n            .prop(\"disabled\", !!forceDeleteAllClones);\n\n        this.$eraseNotes.prop(\"checked\", false);\n\n        this.resolve = callback;\n    }\n\n    isDeleteAllClonesChecked() {\n        return this.$deleteAllClones.is(\":checked\");\n    }\n\n    isEraseNotesChecked() {\n        return this.$eraseNotes.is(\":checked\");\n    }\n}\n","import utils from \"../../services/utils.js\";\nimport BasicWidget from \"../basic_widget.js\";\n\nconst TPL = `\n<div class=\"info-dialog modal mx-auto\" tabindex=\"-1\" role=\"dialog\" style=\"z-index: 2000;\">\n    <div class=\"modal-dialog\" role=\"document\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <h5 class=\"modal-title mr-auto\">笔记信息</h5>\n\n                <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n                    <span aria-hidden=\"true\">&times;</span>\n                </button>\n            </div>\n            <div class=\"modal-body\">\n                <div class=\"info-dialog-content\"></div>\n            </div>\n            <div class=\"modal-footer\">\n                <button class=\"info-dialog-ok-button btn btn-primary btn-sm\">好的</button>\n            </div>\n        </div>\n    </div>\n</div>`;\n\nexport default class InfoDialog extends BasicWidget {\n    constructor() {\n        super();\n\n        this.resolve = null;\n        this.$originallyFocused = null; // element focused before the dialog was opened, so we can return to it afterward\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$infoContent = this.$widget.find(\".info-dialog-content\");\n        this.$okButton = this.$widget.find(\".info-dialog-ok-button\");\n\n        this.$widget.on('shown.bs.modal', () => this.$okButton.trigger(\"focus\"));\n\n        this.$widget.on(\"hidden.bs.modal\", () => {\n            if (this.resolve) {\n                this.resolve();\n            }\n\n            if (this.$originallyFocused) {\n                this.$originallyFocused.trigger('focus');\n                this.$originallyFocused = null;\n            }\n        });\n\n        this.$okButton.on('click', () => this.$widget.modal(\"hide\"));\n    }\n\n    showInfoDialogEvent({message, callback}) {\n        this.$originallyFocused = $(':focus');\n\n        this.$infoContent.text(message);\n\n        utils.openDialog(this.$widget);\n\n        this.resolve = callback;\n    }\n}\n","import BasicWidget from \"../basic_widget.js\";\n\nconst DELETE_NOTE_BUTTON_CLASS = \"confirm-dialog-delete-note\";\n\nconst TPL = `\n<div class=\"confirm-dialog modal mx-auto\" tabindex=\"-1\" role=\"dialog\" style=\"z-index: 2000;\">\n    <div class=\"modal-dialog modal-dialog-scrollable\" role=\"document\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <h5 class=\"modal-title mr-auto\">确认</h5>\n\n                <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n                    <span aria-hidden=\"true\">&times;</span>\n                </button>\n            </div>\n            <div class=\"modal-body\">\n                <div class=\"confirm-dialog-content\"></div>\n\n                <div class=\"confirm-dialog-custom\"></div>\n            </div>\n            <div class=\"modal-footer\">\n                <button class=\"confirm-dialog-cancel-button btn btn-sm\">取消</button>\n\n                &nbsp;\n\n                <button class=\"confirm-dialog-ok-button btn btn-primary btn-sm\">好的</button>\n            </div>\n        </div>\n    </div>\n</div>`;\n\nexport default class ConfirmDialog extends BasicWidget {\n    constructor() {\n        super();\n\n        this.resolve = null;\n        this.$originallyFocused = null; // element focused before the dialog was opened, so we can return to it afterward\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$confirmContent = this.$widget.find(\".confirm-dialog-content\");\n        this.$okButton = this.$widget.find(\".confirm-dialog-ok-button\");\n        this.$cancelButton = this.$widget.find(\".confirm-dialog-cancel-button\");\n        this.$custom = this.$widget.find(\".confirm-dialog-custom\");\n\n        this.$widget.on('shown.bs.modal', () => this.$okButton.trigger(\"focus\"));\n\n        this.$widget.on(\"hidden.bs.modal\", () => {\n            if (this.resolve) {\n                this.resolve(false);\n            }\n\n            if (this.$originallyFocused) {\n                this.$originallyFocused.trigger('focus');\n                this.$originallyFocused = null;\n            }\n        });\n\n        this.$cancelButton.on('click', () => this.doResolve(false));\n        this.$okButton.on('click', () => this.doResolve(true));\n    }\n\n    showConfirmDialogEvent({message, callback}) {\n        this.$originallyFocused = $(':focus');\n\n        this.$custom.hide();\n\n        glob.activeDialog = this.$widget;\n\n        if (typeof message === 'string') {\n            message = $(\"<div>\").text(message);\n        }\n\n        this.$confirmContent.empty().append(message);\n\n        this.$widget.modal();\n\n        this.resolve = callback;\n    }\n\n    showConfirmDeleteNoteBoxWithNoteDialogEvent({title, callback}) {\n        glob.activeDialog = this.$widget;\n\n        this.$confirmContent.text(`Are you sure you want to remove the note \"${title}\" from relation map?`);\n\n        this.$custom.empty()\n            .append(\"<br/>\")\n            .append($(\"<div>\")\n                .addClass(\"form-check\")\n                .append(\n                    $(\"<label>\")\n                        .addClass(\"form-check-label\")\n                        .attr(\"style\", \"text-decoration: underline dotted var(--main-text-color)\")\n                        .attr(\"title\", \"如果不勾选这个, 笔记只会从关系地图里移除.\")\n                        .append(\n                            $(\"<input>\")\n                                .attr(\"type\", \"checkbox\")\n                                .addClass(`form-check-input ${DELETE_NOTE_BUTTON_CLASS}`)\n                        )\n                        .append(\"Also delete the note\")\n                ));\n\n        this.$custom.show();\n\n        this.$widget.modal();\n\n        this.resolve = callback;\n    }\n\n    doResolve(ret) {\n        this.resolve({\n            confirmed: ret,\n            isDeleteNoteChecked: this.$widget.find(`.${DELETE_NOTE_BUTTON_CLASS}:checked`).length > 0\n        });\n\n        this.resolve = null;\n\n        this.$widget.modal(\"hide\");\n    }\n}\n","import utils from \"../../services/utils.js\";\nimport BasicWidget from \"../basic_widget.js\";\n\nconst TPL = `\n<div class=\"prompt-dialog modal mx-auto\" tabindex=\"-1\" role=\"dialog\" style=\"z-index: 2000;\">\n    <div class=\"modal-dialog modal-lg\" role=\"document\">\n        <div class=\"modal-content\">\n            <form class=\"prompt-dialog-form\">\n                <div class=\"modal-header\">\n                    <h5 class=\"prompt-title modal-title mr-auto\">提示</h5>\n\n                    <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n                        <span aria-hidden=\"true\">&times;</span>\n                    </button>\n                </div>\n                <div class=\"modal-body\">\n                </div>\n                <div class=\"modal-footer\">\n                    <button class=\"prompt-dialog-ok-button btn btn-primary btn-sm\">好的<kbd>回车</kbd></button>\n                </div>\n            </form>\n        </div>\n    </div>\n</div>`;\n\nexport default class PromptDialog extends BasicWidget {\n    constructor() {\n        super();\n\n        this.resolve = null;\n        this.shownCb = null;\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$dialogBody = this.$widget.find(\".modal-body\");\n        this.$form = this.$widget.find(\".prompt-dialog-form\");\n        this.$question = null;\n        this.$answer = null;\n\n        this.$widget.on('shown.bs.modal', () => {\n            if (this.shownCb) {\n                this.shownCb({\n                    $dialog: this.$widget,\n                    $question: this.$question,\n                    $answer: this.$answer,\n                    $form: this.$form\n                });\n            }\n\n            this.$answer.trigger('focus').select();\n        });\n\n        this.$widget.on(\"hidden.bs.modal\", () => {\n            if (this.resolve) {\n                this.resolve(null);\n            }\n        });\n\n        this.$form.on('submit', e => {\n            e.preventDefault();\n            this.resolve(this.$answer.val());\n\n            this.$widget.modal('hide');\n        });\n    }\n\n    showPromptDialogEvent({ title, message, defaultValue, shown, callback }) {\n        this.shownCb = shown;\n        this.resolve = callback;\n\n        this.$widget.find(\".prompt-title\").text(title || \"Prompt\");\n\n        this.$question = $(\"<label>\")\n            .prop(\"for\", \"prompt-dialog-answer\")\n            .text(message);\n\n        this.$answer = $(\"<input>\")\n            .prop(\"type\", \"text\")\n            .prop(\"id\", \"prompt-dialog-answer\")\n            .addClass(\"form-control\")\n            .val(defaultValue || \"\");\n\n        this.$dialogBody.empty().append(\n            $(\"<div>\")\n                .addClass(\"form-group\")\n                .append(this.$question)\n                .append(this.$answer));\n\n        utils.openDialog(this.$widget, false);\n    }\n}\n","import NoteContextAwareWidget from \"../note_context_aware_widget.js\";\n\nconst TPL = `\n<div class=\"floating-buttons no-print\">\n    <style>\n        .floating-buttons {\n            position: relative;\n        }\n        \n        .floating-buttons-children {\n            position: absolute; \n            top: 10px; \n            right: 10px;\n            display: flex;\n            flex-direction: row;\n            z-index: 100;\n        }\n        \n        .type-canvas .floating-buttons-children {\n            top: 70px; \n        }\n        \n        .floating-buttons-children > *:not(.hidden-int):not(.no-content-hidden) {\n            margin-left: 10px;\n        }\n        \n        .floating-buttons-children > button, .floating-buttons-children .floating-button {\n            font-size: 150%;\n            padding: 5px 10px 4px 10px;\n            width: 40px;\n            cursor: pointer;\n            color: var(--button-text-color);\n            background: var(--button-background-color);\n            border-radius: var(--button-border-radius);\n            border: 1px solid transparent;\n            display: flex;\n            justify-content: space-around;\n        }\n        \n        .floating-buttons-children > button:hover, .floating-buttons-children .floating-button:hover {\n            text-decoration: none;\n            border-color: var(--button-border-color);\n        }\n        \n        .floating-buttons.temporarily-hidden {\n            display: none;\n        }\n    </style>\n    \n    <div class=\"floating-buttons-children\"></div>\n</div>`;\n\nexport default class FloatingButtons extends NoteContextAwareWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$children = this.$widget.find(\".floating-buttons-children\");\n\n        for (const widget of this.children) {\n            this.$children.append(widget.render());\n        }\n    }\n\n    async refreshWithNote(note) {\n        this.toggle(true);\n    }\n\n    toggle(show) {\n        this.$widget.toggleClass(\"temporarily-hidden\", !show);\n    }\n\n    hideFloatingButtonsCommand() {\n        this.toggle(false);\n    }\n}\n","import NoteContextAwareWidget from \"../note_context_aware_widget.js\";\n\nconst TPL = `\n<div class=\"relation-map-buttons\">\n    <style>\n        .relation-map-buttons {\n            display: flex;\n            gap: 10px;\n        }\n    </style>\n\n    <button type=\"button\"\n            class=\"relation-map-create-child-note floating-button btn bx bx-folder-plus\"\n            title=\"创建新的子笔记并将其添加到此关系图中\"></button>\n    \n    <button type=\"button\"\n            class=\"relation-map-reset-pan-zoom floating-button btn bx bx-crop\"\n            title=\"重置放大系数和座标\"></button>\n    \n    <div class=\"btn-group\">\n        <button type=\"button\"\n                class=\"relation-map-zoom-in floating-button btn bx bx-zoom-in\"\n                title=\"放大\"></button>\n    \n        <button type=\"button\"\n                class=\"relation-map-zoom-out floating-button btn bx bx-zoom-out\"\n                title=\"缩小\"></button>\n    </div>\n</div>`;\n\nexport default class RelationMapButtons extends NoteContextAwareWidget {\n    isEnabled() {\n        return super.isEnabled() && this.note?.type === 'relationMap';\n    }\n\n    doRender() {\n        super.doRender();\n\n        this.$widget = $(TPL);\n        this.$createChildNote = this.$widget.find(\".relation-map-create-child-note\");\n        this.$zoomInButton = this.$widget.find(\".relation-map-zoom-in\");\n        this.$zoomOutButton = this.$widget.find(\".relation-map-zoom-out\");\n        this.$resetPanZoomButton = this.$widget.find(\".relation-map-reset-pan-zoom\");\n\n        this.$createChildNote.on('click', () => this.triggerEvent('relationMapCreateChildNote', {ntxId: this.ntxId}));\n        this.$resetPanZoomButton.on('click', () => this.triggerEvent('relationMapResetPanZoom', {ntxId: this.ntxId}));\n\n        this.$zoomInButton.on('click', () => this.triggerEvent('relationMapResetZoomIn', {ntxId: this.ntxId}));\n        this.$zoomOutButton.on('click', () => this.triggerEvent('relationMapResetZoomOut', {ntxId: this.ntxId}));\n        this.contentSized();\n    }\n}\n","import NoteContextAwareWidget from \"../note_context_aware_widget.js\";\n\nconst TPL = `\n<button type=\"button\"\n        class=\"export-mermaid-button\"\n        title=\"将美人鱼图导出为SVG\">\n        <span class=\"bx bx-export\"></span>\n</button>\n`;\n\nexport default class MermaidExportButton extends NoteContextAwareWidget {\n    isEnabled() {\n        return super.isEnabled()\n            && this.note?.type === 'mermaid'\n            && this.note.isContentAvailable()\n            && this.noteContext?.viewScope.viewMode === 'default';\n    }\n\n    doRender() {\n        super.doRender();\n\n        this.$widget = $(TPL);\n        this.$widget.on('click', () => this.triggerEvent('exportMermaid', {ntxId: this.ntxId}));\n        this.contentSized();\n    }\n}\n","import BasicWidget from \"../basic_widget.js\";\n\nconst TPL = `\n<div class=\"dropdown right-dropdown-widget dropright\">\n    <style>\n    .right-dropdown-widget {\n        height: 53px;\n    }\n    </style>\n\n    <button type=\"button\" data-toggle=\"dropdown\" data-placement=\"right\"\n            aria-haspopup=\"true\" aria-expanded=\"false\" \n            class=\"bx right-dropdown-button launcher-button\"></button>\n    \n    <div class=\"dropdown-menu dropdown-menu-right\"></div>\n</div>\n`;\n\nexport default class RightDropdownButtonWidget extends BasicWidget {\n    constructor(title, iconClass, dropdownTpl) {\n        super();\n\n        this.iconClass = iconClass;\n        this.title = title;\n        this.dropdownTpl = dropdownTpl;\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$dropdownMenu = this.$widget.find(\".dropdown-menu\");\n\n        const $button = this.$widget.find(\".right-dropdown-button\")\n            .addClass(this.iconClass)\n            .attr(\"title\", this.title)\n            .tooltip({ trigger: \"hover\" })\n            .on(\"click\", () => $button.tooltip(\"hide\"));\n\n        this.$widget.on('show.bs.dropdown', async () => {\n            await this.dropdownShown();\n\n            const rect = this.$dropdownMenu[0].getBoundingClientRect();\n            const pixelsToBottom = $(window).height() - rect.bottom;\n\n            if (pixelsToBottom < 0) {\n                this.$dropdownMenu.css(\"top\", pixelsToBottom);\n            }\n        });\n\n        this.$dropdownContent = $(this.dropdownTpl);\n        this.$widget.find(\".dropdown-menu\").append(this.$dropdownContent);\n    }\n\n    // to be overridden\n    async dropdownShow() {}\n\n    hideDropdown() {\n        this.$widget.dropdown(\"hide\");\n        this.$dropdownMenu.removeClass(\"show\");\n    }\n}\n","import libraryLoader from \"../../services/library_loader.js\";\nimport utils from \"../../services/utils.js\";\nimport dateNoteService from \"../../services/date_notes.js\";\nimport server from \"../../services/server.js\";\nimport appContext from \"../../components/app_context.js\";\nimport RightDropdownButtonWidget from \"./right_dropdown_button.js\";\nimport toastService from \"../../services/toast.js\";\n\nconst DROPDOWN_TPL = `\n<div class=\"calendar-dropdown-widget\">\n  <style>\n  .calendar-dropdown-widget {\n      width: 350px;\n  }\n  </style>\n\n  <div class=\"calendar-header\">\n    <button class=\"calendar-btn bx bx-left-arrow-alt\" data-calendar-toggle=\"previous\"></button>\n\n    <div class=\"calendar-header-label\" data-calendar-label=\"month\"></div>\n\n    <button class=\"calendar-btn bx bx-right-arrow-alt\" data-calendar-toggle=\"next\"></button>\n  </div>\n\n  <div class=\"calendar-week\">\n    <span>一</span> <span>二</span><span>三</span> <span>四</span> <span>五</span> <span>六</span> <span>日</span>\n  </div>\n  <div class=\"calendar-body\" data-calendar-area=\"month\"></div>\n</div>`;\n\nexport default class CalendarWidget extends RightDropdownButtonWidget {\n    constructor(title, icon) {\n        super(title, icon, DROPDOWN_TPL);\n    }\n\n    doRender() {\n        super.doRender();\n\n        this.$month = this.$dropdownContent.find('[data-calendar-area=\"month\"]');\n        this.$next = this.$dropdownContent.find('[data-calendar-toggle=\"next\"]');\n        this.$previous = this.$dropdownContent.find('[data-calendar-toggle=\"previous\"]');\n        this.$label = this.$dropdownContent.find('[data-calendar-label=\"month\"]');\n\n        this.$next.on('click', () => {\n            this.date.setMonth(this.date.getMonth() + 1);\n            this.createMonth();\n        });\n\n        this.$previous.on('click', e => {\n            this.date.setMonth(this.date.getMonth() - 1);\n            this.createMonth();\n        });\n\n        this.$dropdownContent.find('.calendar-header').on(\"click\", e => e.stopPropagation());\n\n        this.$dropdownContent.on('click', '.calendar-date', async ev => {\n            const date = $(ev.target).closest('.calendar-date').attr('data-calendar-date');\n\n            const note = await dateNoteService.getDayNote(date);\n\n            if (note) {\n                appContext.tabManager.getActiveContext().setNote(note.noteId);\n                this.hideDropdown();\n            }\n            else {\n                toastService.showError(\"Cannot find day note\");\n            }\n        });\n    }\n\n    async dropdownShown() {\n        await libraryLoader.requireLibrary(libraryLoader.CALENDAR_WIDGET);\n\n        const activeNote = appContext.tabManager.getActiveContextNote();\n\n        this.init(activeNote?.getOwnedLabelValue(\"dateNote\"));\n    }\n\n    init(activeDate) {\n        // attaching time fixes local timezone handling\n        this.activeDate = activeDate ? new Date(`${activeDate}T12:00:00`) : null;\n        this.todaysDate = new Date();\n        this.date = new Date((this.activeDate || this.todaysDate).getTime());\n        this.date.setDate(1);\n\n        this.createMonth();\n    }\n\n    createDay(dateNotesForMonth, num, day) {\n        const $newDay = $('<a>')\n            .addClass(\"calendar-date\")\n            .attr('data-calendar-date', utils.formatDateISO(this.date));\n        const $date = $('<span>').html(num);\n\n        // if it's the first day of the month\n        if (num === 1) {\n            if (day === 0) {\n                $newDay.css(\"marginLeft\", (6 * 14.28) + '%');\n            } else {\n                $newDay.css(\"marginLeft\", `${(day - 1) * 14.28}%`);\n            }\n        }\n\n        const dateNoteId = dateNotesForMonth[utils.formatDateISO(this.date)];\n\n        if (dateNoteId) {\n            $newDay.addClass('calendar-date-exists');\n            $newDay.attr(\"href\", `#root/${dateNoteId}`);\n        }\n\n        if (this.isEqual(this.date, this.activeDate)) {\n            $newDay.addClass('calendar-date-active');\n        }\n\n        if (this.isEqual(this.date, this.todaysDate)) {\n            $newDay.addClass('calendar-date-today');\n        }\n\n        $newDay.append($date);\n        return $newDay;\n    }\n\n    isEqual(a, b) {\n        if (!a && b || a && !b) {\n            return false;\n        }\n\n        return a.getFullYear() === b.getFullYear()\n            && a.getMonth() === b.getMonth()\n            && a.getDate() === b.getDate();\n    }\n\n    async createMonth() {\n        const month = utils.formatDateISO(this.date).substr(0, 7);\n        const dateNotesForMonth = await server.get(`special-notes/notes-for-month/${month}`);\n\n        this.$month.empty();\n\n        const currentMonth = this.date.getMonth();\n        while (this.date.getMonth() === currentMonth) {\n            const $day = this.createDay(\n                dateNotesForMonth,\n                this.date.getDate(),\n                this.date.getDay(),\n                this.date.getFullYear()\n            );\n\n            this.$month.append($day);\n\n            this.date.setDate(this.date.getDate() + 1);\n        }\n        // while loop trips over and day is at 30/31, bring it back\n        this.date.setDate(1);\n        this.date.setMonth(this.date.getMonth() - 1);\n\n        this.$label.html(`${this.monthsAsString(this.date.getMonth())} ${this.date.getFullYear()}`);\n    }\n\n    monthsAsString(monthIndex) {\n        return [\n            '一月',\n            '二月',\n            '三月',\n            '四月',\n            '五月',\n            '六月',\n            '七月',\n            '八月',\n            '九月',\n            '十月',\n            '十一月',\n            '十二月'\n        ][monthIndex];\n    }\n}\n","import OnClickButtonWidget from \"./onclick_button.js\";\nimport linkContextMenuService from \"../../menus/link_context_menu.js\";\nimport utils from \"../../services/utils.js\";\nimport appContext from \"../../components/app_context.js\";\n\nexport default class OpenNoteButtonWidget extends OnClickButtonWidget {\n    constructor(noteToOpen) {\n        super();\n\n        this.noteToOpen = noteToOpen;\n\n        this.title(() => this.noteToOpen.title)\n            .icon(() => this.noteToOpen.getIcon())\n            .onClick((widget, evt) => this.launch(evt))\n            .onAuxClick((widget, evt) => this.launch(evt))\n            .onContextMenu(evt => linkContextMenuService.openContextMenu(this.noteToOpen.noteId, evt));\n    }\n\n    async launch(evt) {\n        if (evt.which === 3) {\n            return;\n        }\n        const ctrlKey = utils.isCtrlKey(evt);\n\n        if ((evt.which === 1 && ctrlKey) || evt.which === 2) {\n            await appContext.tabManager.openInNewTab(this.noteToOpen.noteId);\n        } else {\n            await appContext.tabManager.openInSameTab(this.noteToOpen.noteId);\n        }\n    }\n\n    initialRenderCompleteEvent() {\n        // we trigger refresh above\n    }\n}\n","import RightDropdownButtonWidget from \"./right_dropdown_button.js\";\nimport linkService from \"../../services/link.js\";\n\nconst DROPDOWN_TPL = `\n<div class=\"bookmark-folder-widget\">\n    <style>\n        .bookmark-folder-widget {\n            min-width: 400px;\n            max-height: 500px;\n            padding: 7px 15px 0 15px;\n            font-size: 1.2rem;\n            overflow: auto;\n        }\n        \n        .bookmark-folder-widget ul {\n            padding: 0;\n            list-style-type: none;\n        }\n        \n        .bookmark-folder-widget .note-link {\n            display: block;\n            padding: 5px 10px 5px 5px;\n        }\n        \n        .bookmark-folder-widget .note-link:hover {\n            background-color: var(--accented-background-color);\n            text-decoration: none;\n        }\n        \n        .dropdown-menu .bookmark-folder-widget a:hover {\n            text-decoration: none;\n            background: transparent !important;\n        }\n        \n        .bookmark-folder-widget li .note-link {\n            padding-left: 35px;\n        }\n    </style>\n    \n    <div class=\"parent-note\"></div>\n    \n    <ul class=\"children-notes\"></ul>\n</div>`;\n\nexport default class BookmarkFolderWidget extends RightDropdownButtonWidget {\n    constructor(note) {\n        super(note.title, note.getIcon(), DROPDOWN_TPL);\n\n        this.note = note;\n    }\n\n    doRender() {\n        super.doRender();\n\n        this.$parentNote = this.$dropdownContent.find('.parent-note');\n        this.$childrenNotes = this.$dropdownContent.find('.children-notes');\n    }\n\n    async dropdownShown() {\n        this.$parentNote.empty();\n        this.$childrenNotes.empty();\n\n        const linkOptions = {\n            showTooltip: false,\n            showNoteIcon: true\n        };\n\n        this.$parentNote.append(\n            (await linkService.createLink(this.note.noteId, linkOptions))\n                .addClass(\"note-link\")\n        );\n\n        for (const childNote of await this.note.getChildNotes()) {\n            this.$childrenNotes.append(\n                $(\"<li>\")\n                    .append(\n                        (await linkService.createLink(childNote.noteId, linkOptions))\n                            .addClass(\"note-link\")\n                    )\n            );\n        }\n    }\n\n    refreshIcon() {}\n}\n","import FlexContainer from \"./containers/flex_container.js\";\nimport OpenNoteButtonWidget from \"./buttons/open_note_button_widget.js\";\nimport BookmarkFolderWidget from \"./buttons/bookmark_folder.js\";\nimport froca from \"../services/froca.js\";\n\nexport default class BookmarkButtons extends FlexContainer {\n    constructor() {\n        super(\"column\");\n\n        this.contentSized();\n    }\n\n    async refresh() {\n        this.$widget.empty();\n        this.children = [];\n        this.noteIds = [];\n\n        const bookmarkParentNote = await froca.getNote('_lbBookmarks');\n\n        for (const note of await bookmarkParentNote.getChildNotes()) {\n            this.noteIds.push(note.noteId);\n\n            const buttonWidget = note.isLabelTruthy(\"bookmarkFolder\")\n                ? new BookmarkFolderWidget(note)\n                : new OpenNoteButtonWidget(note)\n                    .class(\"launcher-button\");\n\n            this.child(buttonWidget);\n\n            this.$widget.append(buttonWidget.render());\n\n            buttonWidget.refreshIcon();\n        }\n    }\n\n    initialRenderCompleteEvent() {\n        this.refresh();\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.getBranchRows().find(branch => branch.parentNoteId === '_lbBookmarks')) {\n            this.refresh();\n        }\n\n        if (loadResults.getAttributeRows().find(attr => attr.type === 'label'\n            && ['iconClass', 'workspaceIconClass', 'bookmarkFolder'].includes(attr.name)\n            && this.noteIds.includes(attr.noteId))\n        ) {\n            this.refresh();\n        }\n    }\n}\n","import protectedSessionHolder from \"../../services/protected_session_holder.js\";\nimport CommandButtonWidget from \"./command_button.js\";\n\nexport default class ProtectedSessionStatusWidget extends CommandButtonWidget {\n    constructor() {\n        super();\n\n        this.class(\"launcher-button\");\n\n        this.settings.icon = () => protectedSessionHolder.isProtectedSessionAvailable()\n            ? \"bx-check-shield\"\n            : \"bx-shield-quarter\";\n\n        this.settings.title = () => protectedSessionHolder.isProtectedSessionAvailable()\n            ? \"受保护的会话已启动. 点击退出受保护的会话.\"\n            : \"点击进入受保护的会话\";\n\n        this.settings.command = () => protectedSessionHolder.isProtectedSessionAvailable()\n            ? \"leaveProtectedSession\"\n            : \"enterProtectedSession\";\n    }\n\n    protectedSessionStartedEvent() {\n        this.refreshIcon();\n    }\n}\n","import BasicWidget from \"./basic_widget.js\";\nimport ws from \"../services/ws.js\";\nimport options from \"../services/options.js\";\nimport syncService from \"../services/sync.js\";\n\nconst TPL = `\n<div class=\"sync-status-widget launcher-button\">\n    <style>\n    .sync-status-widget {\n    }\n    \n    .sync-status {\n        box-sizing: border-box;\n    }\n    \n    .sync-status .sync-status-icon {\n        display: inline-block;\n        position: relative;\n        top: -5px;\n        font-size: 110%;\n    }\n    \n    .sync-status .sync-status-sub-icon {\n        font-size: 40%; \n        position: absolute; \n        left: 0;\n        top: 16px;\n    }\n    \n    .sync-status .sync-status-icon span {\n        border: none !important;\n    }\n    \n    .sync-status-icon:not(.sync-status-in-progress):hover {\n        background-color: var(--hover-item-background-color);\n        cursor: pointer;\n    }\n    </style>\n\n    <div class=\"sync-status\">\n        <span class=\"sync-status-icon sync-status-unknown bx bx-time\" \n              data-toggle=\"tooltip\" \n              data-placement=\"right\"\n              title=\"<p>下次同步时可获取同步状态.</p><p>点击开始同步.</p>\">\n        </span>\n        <span class=\"sync-status-icon sync-status-connected-with-changes bx bx-wifi\"\n              data-toggle=\"tooltip\" \n              data-placement=\"right\"\n              title=\"<p>已连接到同步服务器. <br>还有一些修改的数据需要同步.</p><p>点击开始同步.</p>\">\n            <span class=\"bx bxs-star sync-status-sub-icon\"></span>\n        </span>\n        <span class=\"sync-status-icon sync-status-connected-no-changes bx bx-wifi\" \n              data-toggle=\"tooltip\" \n              data-placement=\"right\"\n              title=\"<p>已连接到同步服务器.<br>所有的修改已经同步.</p><p>点击开始同步.</p>\">\n        </span>\n        <span class=\"sync-status-icon sync-status-disconnected-with-changes bx bx-wifi-off\"\n              data-toggle=\"tooltip\" \n              data-placement=\"right\"\n              title=\"<p>连接到同步服务器失败.<br>还有一些修改的数据需要同步.</p><p>点击开始同步.</p>\">\n            <span class=\"bx bxs-star sync-status-sub-icon\"></span>\n        </span>\n        <span class=\"sync-status-icon sync-status-disconnected-no-changes bx bx-wifi-off\" \n              data-toggle=\"tooltip\"\n              data-placement=\"right\"\n              title=\"<p>连接到同步服务器失败.<br>所有的修改已经同步.</p><p>点击开始同步.</p>\">\n        </span>\n        <span class=\"sync-status-icon sync-status-in-progress bx bx-analyse bx-spin\" \n              data-toggle=\"tooltip\"\n              data-placement=\"right\"\n              title=\"同步中.\">\n        </span>\n    </div>\n</div>\n`;\n\nexport default class SyncStatusWidget extends BasicWidget {\n    constructor() {\n        super();\n\n        this.syncState = 'unknown';\n        this.allChangesPushed = false;\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$widget.hide();\n\n        this.$widget.find('[data-toggle=\"tooltip\"]').tooltip({\n            html: true\n        });\n\n        this.$widget.find('.sync-status-icon:not(.sync-status-in-progress)')\n            .on('click', () => syncService.syncNow());\n\n        ws.subscribeToMessages(message => this.processMessage(message));\n    }\n\n    showIcon(className) {\n        if (!options.get('syncServerHost')) {\n            this.toggleInt(false);\n            return;\n        }\n\n        this.$widget.show();\n        this.$widget.find('.sync-status-icon').hide();\n        this.$widget.find(`.sync-status-${className}`).show();\n    }\n\n    processMessage(message) {\n        if (message.type === 'sync-pull-in-progress') {\n            this.syncState = 'in-progress';\n            this.lastSyncedPush = message.lastSyncedPush;\n        }\n        else if (message.type === 'sync-push-in-progress') {\n            this.syncState = 'in-progress';\n            this.lastSyncedPush = message.lastSyncedPush;\n        }\n        else if (message.type === 'sync-finished') {\n            this.syncState = 'connected';\n            this.lastSyncedPush = message.lastSyncedPush;\n        }\n        else if (message.type === 'sync-failed') {\n            this.syncState = 'disconnected';\n            this.lastSyncedPush = message.lastSyncedPush;\n        }\n        else if (message.type === 'frontend-update') {\n            this.lastSyncedPush = message.data.lastSyncedPush;\n        }\n\n        this.allChangesPushed = this.lastSyncedPush === ws.getMaxKnownEntityChangeSyncId();\n\n        if (['unknown', 'in-progress'].includes(this.syncState)) {\n            this.showIcon(this.syncState);\n        } else {\n            this.showIcon(`${this.syncState}-${this.allChangesPushed ? 'no-changes' : 'with-changes'}`);\n        }\n    }\n}\n","import shortcutService from \"../../../services/shortcuts.js\";\nimport attributesService from \"../../../services/attributes.js\";\nimport OnClickButtonWidget from \"../onclick_button.js\";\n\nexport default class AbstractLauncher extends OnClickButtonWidget {\n    constructor(launcherNote) {\n        super();\n\n        this.class(\"launcher-button\");\n\n        /** @type {FNote} */\n        this.launcherNote = launcherNote;\n\n        for (const label of launcherNote.getOwnedLabels('keyboardShortcut')) {\n            this.bindNoteShortcutHandler(label);\n        }\n    }\n\n    launch() {\n        throw new Error(\"Abstract implementation\");\n    }\n\n    bindNoteShortcutHandler(labelOrRow) {\n        const namespace = labelOrRow.attributeId;\n\n        if (labelOrRow.isDeleted) { // only applicable if row\n            shortcutService.removeGlobalShortcut(namespace);\n        } else {\n            shortcutService.bindGlobalShortcut(labelOrRow.value, () => this.launch(), namespace);\n        }\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        for (const attr of loadResults.getAttributeRows()) {\n            if (attr.noteId === this.launcherNote.noteId && attr.type === 'label' && attr.name === 'keyboardShortcut') {\n                this.bindNoteShortcutHandler(attr);\n            } else if (attr.type === 'label' && attr.name === 'iconClass' && attributesService.isAffecting(attr, this.launcherNote)) {\n                this.refreshIcon();\n            }\n        }\n    }\n}\n","import AbstractLauncher from \"./abstract_launcher.js\";\nimport dialogService from \"../../../services/dialog.js\";\nimport appContext from \"../../../components/app_context.js\";\nimport utils from \"../../../services/utils.js\";\nimport linkContextMenuService from \"../../../menus/link_context_menu.js\";\n\n// we're intentionally displaying the launcher title and icon instead of the target,\n// e.g. you want to make launchers to 2 mermaid diagrams which both have mermaid icon (ok),\n// but on the launchpad you want them distinguishable.\n// for titles, the note titles may follow a different scheme than maybe desirable on the launchpad\n// another reason is the discrepancy between what user sees on the launchpad and in the config (esp. icons).\n// The only downside is more work in setting up the typical case\n// where you actually want to have both title and icon in sync, but for those cases there are bookmarks\nexport default class NoteLauncher extends AbstractLauncher {\n    constructor(launcherNote) {\n        super(launcherNote);\n\n        this.title(() => this.launcherNote.title)\n            .icon(() => this.launcherNote.getIcon())\n            .onClick((widget, evt) => this.launch(evt))\n            .onAuxClick((widget, evt) => this.launch(evt))\n            .onContextMenu(evt => {\n                const targetNoteId = this.getTargetNoteId();\n                if (!targetNoteId) {\n                    return;\n                }\n\n                const hoistedNoteId = this.getHoistedNoteId();\n\n                linkContextMenuService.openContextMenu(targetNoteId, evt, {}, hoistedNoteId);\n            });\n    }\n\n    async launch(evt) {\n        // await because subclass overrides can be async\n        const targetNoteId = await this.getTargetNoteId();\n        if (!targetNoteId || evt.which === 3) {\n            return;\n        }\n\n        const hoistedNoteId = await this.getHoistedNoteId();\n\n        if (!evt) {\n            // keyboard shortcut\n            await appContext.tabManager.openInSameTab(targetNoteId, hoistedNoteId);\n        } else {\n            const ctrlKey = utils.isCtrlKey(evt);\n\n            if ((evt.which === 1 && ctrlKey) || evt.which === 2) {\n                await appContext.tabManager.openInNewTab(targetNoteId, hoistedNoteId);\n            } else {\n                await appContext.tabManager.openInSameTab(targetNoteId, hoistedNoteId);\n            }\n        }\n    }\n\n    getTargetNoteId() {\n        const targetNoteId = this.launcherNote.getRelationValue('target');\n\n        if (!targetNoteId) {\n            dialogService.info(\"This launcher doesn't define target note.\");\n            return;\n        }\n\n        return targetNoteId;\n    }\n\n    getHoistedNoteId() {\n        return this.launcherNote.getRelationValue('hoistedNote')\n            || appContext.tabManager.getActiveContext().hoistedNoteId;\n    }\n\n    getTitle() {\n        const shortcuts = this.launcherNote.getLabels(\"keyboardShortcut\")\n            .map(l => l.value)\n            .filter(v => !!v)\n            .join(\", \");\n\n        let title = super.getTitle();\n        if (shortcuts) {\n            title += ` (${shortcuts})`;\n        }\n\n        return title;\n    }\n}\n","import AbstractLauncher from \"./abstract_launcher.js\";\n\nexport default class ScriptLauncher extends AbstractLauncher {\n    constructor(launcherNote) {\n        super(launcherNote);\n\n        this.title(() => this.launcherNote.title)\n            .icon(() => this.launcherNote.getIcon())\n            .onClick(() => this.launch());\n    }\n\n    async launch() {\n        if (this.launcherNote.isLabelTruthy('scriptInLauncherContent')) {\n            await this.launcherNote.executeScript();\n        } else {\n            const script = await this.launcherNote.getRelationTarget('script');\n\n            await script.executeScript();\n        }\n    }\n}\n","import NoteLauncher from \"./note_launcher.js\";\nimport dateNotesService from \"../../../services/date_notes.js\";\nimport appContext from \"../../../components/app_context.js\";\n\nexport default class TodayLauncher extends NoteLauncher {\n    async getTargetNoteId() {\n        const todayNote = await dateNotesService.getTodayNote();\n\n        return todayNote.noteId;\n    }\n\n    getHoistedNoteId() {\n        return appContext.tabManager.getActiveContext().hoistedNoteId;\n    }\n}\n","import froca from \"../../services/froca.js\";\nimport attributeService from \"../../services/attributes.js\";\nimport CommandButtonWidget from \"./command_button.js\";\n\nexport default class ButtonFromNoteWidget extends CommandButtonWidget {\n    constructor() {\n        super();\n\n        this.settings.buttonNoteIdProvider = null;\n    }\n\n    buttonNoteIdProvider(provider) {\n        this.settings.buttonNoteIdProvider = provider;\n        return this;\n    }\n\n    doRender() {\n        super.doRender();\n\n        this.updateIcon();\n    }\n\n    updateIcon() {\n        const buttonNoteId = this.settings.buttonNoteIdProvider();\n\n        if (!buttonNoteId) {\n            console.error(`buttonNoteId for '${this.componentId}' is not defined.`);\n            return;\n        }\n\n        froca.getNote(buttonNoteId).then(note => {\n            this.settings.icon = note.getIcon();\n\n            this.refreshIcon();\n        });\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        const buttonNote = froca.getNoteFromCache(this.buttonNoteIdProvider());\n\n        if (!buttonNote) {\n            return;\n        }\n\n        if (loadResults.getAttributeRows(this.componentId).find(attr =>\n            attr.type === 'label'\n            && attr.name === 'iconClass'\n            && attributeService.isAffecting(attr, buttonNote))) {\n\n            this.updateIcon();\n        }\n    }\n}","import utils from \"../../services/utils.js\";\nimport contextMenu from \"../../menus/context_menu.js\";\nimport treeService from \"../../services/tree.js\";\nimport ButtonFromNoteWidget from \"./button_from_note.js\";\n\nexport default class HistoryNavigationButton extends ButtonFromNoteWidget {\n    constructor(launcherNote, command) {\n        super();\n\n        this.title(() => launcherNote.title)\n            .icon(() => launcherNote.getIcon())\n            .command(() => command)\n            .titlePlacement(\"right\")\n            .buttonNoteIdProvider(() => launcherNote.noteId)\n            .onContextMenu(e => this.showContextMenu(e))\n            .class(\"launcher-button\");\n    }\n\n    isEnabled() {\n        return super.isEnabled() && utils.isElectron();\n    }\n\n    doRender() {\n        super.doRender();\n\n        if (!utils.isElectron()) {\n            return;\n        }\n\n        this.webContents = utils.dynamicRequire('@electron/remote').getCurrentWebContents();\n\n        // without this, the history is preserved across frontend reloads\n        this.webContents.clearHistory();\n\n        this.refresh();\n    }\n\n    async showContextMenu(e) {\n        e.preventDefault();\n\n        // API is broken and will be replaced: https://github.com/electron/electron/issues/33899\n        // until then no context menu\n        if (true) { // avoid warning in dev console\n            return;\n        }\n\n        if (this.webContents.history.length < 2) {\n            return;\n        }\n\n        let items = [];\n\n        const activeIndex = this.webContents.getActiveIndex();\n\n        for (const idx in this.webContents.history) {\n            const url = this.webContents.history[idx];\n            const [_, notePathWithTab] = url.split('#');\n            // broken: use linkService.parseNavigationStateFromUrl();\n            const [notePath, ntxId] = notePathWithTab.split('-');\n\n            const title = await treeService.getNotePathTitle(notePath);\n\n            items.push({\n                title,\n                idx,\n                uiIcon: idx == activeIndex ? \"bx bx-radio-circle-marked\" : // compare with type coercion!\n                    (idx < activeIndex ? \"bx bx-left-arrow-alt\" : \"bx bx-right-arrow-alt\")\n            });\n        }\n\n        items.reverse();\n\n        if (items.length > 20) {\n            items = items.slice(0, 50);\n        }\n\n        contextMenu.show({\n            x: e.pageX,\n            y: e.pageY,\n            items,\n            selectMenuItemHandler: ({idx}) => this.webContents.goToIndex(idx)\n        });\n    }\n\n    refresh() {\n        if (!utils.isElectron()) {\n            return;\n        }\n\n        // disabling this because in electron 9 there's a weird performance problem which makes these webContents calls\n        // block UI thread for > 1 second on specific notes (book notes displaying underlying render notes with scripts)\n\n        // this.$backInHistory.toggleClass('disabled', !this.webContents.canGoBack());\n        // this.$forwardInHistory.toggleClass('disabled', !this.webContents.canGoForward());\n    }\n\n    activeNoteChangedEvent() {\n        this.refresh();\n    }\n}\n","import CalendarWidget from \"../buttons/calendar.js\";\nimport SpacerWidget from \"../spacer.js\";\nimport BookmarkButtons from \"../bookmark_buttons.js\";\nimport ProtectedSessionStatusWidget from \"../buttons/protected_session_status.js\";\nimport SyncStatusWidget from \"../sync_status.js\";\nimport BasicWidget from \"../basic_widget.js\";\nimport NoteLauncher from \"../buttons/launcher/note_launcher.js\";\nimport ScriptLauncher from \"../buttons/launcher/script_launcher.js\";\nimport CommandButtonWidget from \"../buttons/command_button.js\";\nimport utils from \"../../services/utils.js\";\nimport TodayLauncher from \"../buttons/launcher/today_launcher.js\";\nimport HistoryNavigationButton from \"../buttons/history_navigation.js\";\n\nexport default class LauncherWidget extends BasicWidget {\n    constructor() {\n        super();\n\n        this.innerWidget = null;\n    }\n\n    isEnabled() {\n        return this.innerWidget.isEnabled();\n    }\n\n    doRender() {\n        this.$widget = this.innerWidget.render();\n    }\n\n    async initLauncher(note) {\n        if (note.type !== 'launcher') {\n            throw new Error(`Note '${note.noteId}' '${note.title}' is not a launcher even though it's in the launcher subtree`);\n        }\n\n        if (!utils.isDesktop() && note.isLabelTruthy('desktopOnly')) {\n            return false;\n        }\n\n        const launcherType = note.getLabelValue(\"launcherType\");\n\n        if (glob.TRILIUM_SAFE_MODE && launcherType === 'customWidget') {\n            return false;\n        }\n\n        if (launcherType === 'command') {\n            this.innerWidget = this.initCommandLauncherWidget(note)\n                .class(\"launcher-button\");\n        } else if (launcherType === 'note') {\n            this.innerWidget = new NoteLauncher(note)\n                .class(\"launcher-button\");\n        } else if (launcherType === 'script') {\n            this.innerWidget = new ScriptLauncher(note)\n                .class(\"launcher-button\");\n        } else if (launcherType === 'customWidget') {\n            this.innerWidget = await this.initCustomWidget(note);\n        } else if (launcherType === 'builtinWidget') {\n            this.innerWidget = this.initBuiltinWidget(note);\n        } else {\n            throw new Error(`Unrecognized launcher type '${launcherType}' for launcher '${note.noteId}' title '${note.title}'`);\n        }\n\n        if (!this.innerWidget) {\n            throw new Error(`Unknown initialization error for note '${note.noteId}', title '${note.title}'`);\n        }\n\n        this.child(this.innerWidget);\n\n        return true;\n    }\n\n    initCommandLauncherWidget(note) {\n        return new CommandButtonWidget()\n            .title(() => note.title)\n            .icon(() => note.getIcon())\n            .command(() => note.getLabelValue(\"command\"));\n    }\n\n    async initCustomWidget(note) {\n        const widget = await note.getRelationTarget('widget');\n\n        if (widget) {\n            return await widget.executeScript();\n        } else {\n            throw new Error(`Custom widget of launcher '${note.noteId}' '${note.title}' is not defined.`);\n        }\n    }\n\n    initBuiltinWidget(note) {\n        const builtinWidget = note.getLabelValue(\"builtinWidget\");\n\n        if (builtinWidget === 'calendar') {\n            return new CalendarWidget(note.title, note.getIcon());\n        } else if (builtinWidget === 'spacer') {\n            // || has to be inside since 0 is a valid value\n            const baseSize = parseInt(note.getLabelValue(\"baseSize\") || \"40\");\n            const growthFactor = parseInt(note.getLabelValue(\"growthFactor\") || \"100\");\n\n            return new SpacerWidget(baseSize, growthFactor);\n        } else if (builtinWidget === 'bookmarks') {\n            return new BookmarkButtons();\n        } else if (builtinWidget === 'protectedSession') {\n            return new ProtectedSessionStatusWidget();\n        } else if (builtinWidget === 'syncStatus') {\n            return new SyncStatusWidget();\n        } else if (builtinWidget === 'backInHistoryButton') {\n            return new HistoryNavigationButton(note, \"backInNoteHistory\");\n        } else if (builtinWidget === 'forwardInHistoryButton') {\n            return new HistoryNavigationButton(note, \"forwardInNoteHistory\");\n        } else if (builtinWidget === 'todayInJournal') {\n            return new TodayLauncher(note);\n        } else {\n            throw new Error(`Unrecognized builtin widget ${builtinWidget} for launcher ${note.noteId} \"${note.title}\"`);\n        }\n    }\n}\n","import FlexContainer from \"./flex_container.js\";\nimport froca from \"../../services/froca.js\";\nimport appContext from \"../../components/app_context.js\";\nimport LauncherWidget from \"./launcher.js\";\n\nexport default class LauncherContainer extends FlexContainer {\n    constructor() {\n        super('column');\n\n        this.id('launcher-container');\n        this.css('height', '100%');\n        this.filling();\n\n        this.load();\n    }\n\n    async load() {\n        await froca.initializedPromise;\n\n        const visibleLaunchersRoot = await froca.getNote('_lbVisibleLaunchers', true);\n\n        if (!visibleLaunchersRoot) {\n            console.log(\"Visible launchers root note doesn't exist.\");\n\n            return;\n        }\n\n        const newChildren = [];\n\n        for (const launcherNote of await visibleLaunchersRoot.getChildNotes()) {\n            try {\n                const launcherWidget = new LauncherWidget();\n                const success = await launcherWidget.initLauncher(launcherNote);\n\n                if (success) {\n                    newChildren.push(launcherWidget);\n                }\n            }\n            catch (e) {\n                console.error(e);\n            }\n        }\n\n        this.children = [];\n        this.child(...newChildren);\n\n        this.$widget.empty();\n        this.renderChildren();\n\n        await this.handleEventInChildren('initialRenderComplete');\n\n        const activeContext = appContext.tabManager.getActiveContext();\n\n        if (activeContext) {\n            await this.handleEvent('setNoteContext', {\n                noteContext: activeContext\n            });\n\n            if (activeContext.notePath) {\n                await this.handleEvent('noteSwitched', {\n                    noteContext: activeContext,\n                    notePath: activeContext.notePath\n                });\n            }\n        }\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.getBranchRows().find(branch => froca.getNoteFromCache(branch.parentNoteId)?.isLaunchBarConfig())) {\n            // changes in note placement require reload of all launchers, all other changes are handled by individual\n            // launchers\n            this.load();\n        }\n    }\n}\n","import CommandButtonWidget from \"./command_button.js\";\n\nexport default class RevisionsButton extends CommandButtonWidget {\n    constructor() {\n        super();\n\n        this.icon('bx-history')\n            .title(\"笔记修改历史\")\n            .command(\"showRevisions\")\n            .titlePlacement(\"bottom\")\n            .class(\"icon-action\");\n    }\n\n    isEnabled() {\n        return super.isEnabled() && !['launcher', 'doc'].includes(this.note?.type);\n    }\n}\n","import server from \"../../services/server.js\";\nimport ws from \"../../services/ws.js\";\nimport appContext from \"../../components/app_context.js\";\nimport toastService from \"../../services/toast.js\";\nimport treeService from \"../../services/tree.js\";\nimport NoteContextAwareWidget from \"../note_context_aware_widget.js\";\nimport keyboardActionService from \"../../services/keyboard_actions.js\";\n\nconst TPL = `\n<div class=\"code-buttons-widget\">\n    <style>\n        .code-buttons-widget {\n            display: flex;\n            gap: 10px;\n        }\n    </style>\n\n    <button data-trigger-command=\"runActiveNote\" class=\"execute-button floating-button btn\" title=\"执行脚本\">\n        <span class=\"bx bx-run\"></span>\n    </button>\n    \n    <button class=\"trilium-api-docs-button floating-button btn\" title=\"打开 Trilium API 文档\">\n        <span class=\"bx bx-help-circle\"></span>\n    </button>\n    \n    <button class=\"save-to-note-button floating-button btn\">\n        <span class=\"bx bx-save\"></span>\n    </button>\n</div>`;\n\nexport default class CodeButtonsWidget extends NoteContextAwareWidget {\n    isEnabled() {\n        return super.isEnabled()\n            && this.note\n            && (this.note.mime.startsWith('application/javascript')  || this.note.mime === 'text/x-sqlite;schema=trilium');\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$openTriliumApiDocsButton = this.$widget.find(\".trilium-api-docs-button\");\n        this.$openTriliumApiDocsButton.on(\"click\", () => {\n            toastService.showMessage(\"打开API文档...\");\n\n            if (this.note.mime.endsWith(\"frontend\")) {\n                window.open(\"https://zadam.github.io/trilium/frontend_api/FrontendScriptApi.html\", \"_blank\");\n            }\n            else {\n                window.open(\"https://zadam.github.io/trilium/backend_api/BackendScriptApi.html\", \"_blank\");\n            }\n        });\n\n        this.$executeButton = this.$widget.find('.execute-button');\n        this.$saveToNoteButton = this.$widget.find('.save-to-note-button');\n        this.$saveToNoteButton.on('click', async () => {\n            const {notePath} = await server.post(\"special-notes/save-sql-console\", {sqlConsoleNoteId: this.noteId});\n\n            await ws.waitForMaxKnownEntityChangeId();\n\n            await appContext.tabManager.getActiveContext().setNote(notePath);\n\n            toastService.showMessage(`SQL Console note has been saved into ${await treeService.getNotePathTitle(notePath)}`);\n        });\n\n        keyboardActionService.updateDisplayedShortcuts(this.$widget);\n\n        this.contentSized();\n\n        super.doRender();\n    }\n\n    async refreshWithNote(note) {\n        this.$executeButton.toggle(\n            note.mime.startsWith('application/javascript')\n            || note.mime === 'text/x-sqlite;schema=trilium'\n        );\n\n        this.$saveToNoteButton.toggle(\n            note.mime === 'text/x-sqlite;schema=trilium'\n            && note.isHiddenCompletely()\n        );\n\n        this.$openTriliumApiDocsButton.toggle(note.mime.startsWith('application/javascript;env='));\n    }\n\n    async noteTypeMimeChangedEvent({noteId}) {\n        if (this.isNote(noteId)) {\n            await this.refresh();\n        }\n    }\n}\n","import NoteContextAwareWidget from \"./note_context_aware_widget.js\";\n\nconst TPL = `\n<div class=\"api-log-widget\">\n    <style>\n    .api-log-widget {\n        padding: 15px;\n        flex-grow: 1;\n        max-height: 40%;\n        position: relative;\n    }\n    \n    .hidden-api-log {\n        display: none;\n    }\n    \n    .api-log-container {\n        overflow: auto;\n        height: 100%;\n    }\n    \n    .close-api-log-button {\n        padding: 5px;\n        border: 1px solid var(--button-border-color);\n        background-color: var(--button-background-color);\n        border-radius: var(--button-border-radius);\n        color: var(--button-text-color);\n        position: absolute;\n        top: 10px;\n        right: 40px;\n        cursor: pointer;\n    }\n    </style>\n    \n    <div class=\"bx bx-x close-api-log-button\" title=\"Close\"></div>\n   \n    <div class=\"api-log-container\"></div>\n</div>`;\n\nexport default class ApiLogWidget extends NoteContextAwareWidget {\n    isEnabled() {\n        return this.note\n            && this.note.mime.startsWith('application/javascript;env=')\n            && super.isEnabled();\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.toggle(false);\n\n        this.$logContainer = this.$widget.find('.api-log-container');\n        this.$closeButton = this.$widget.find(\".close-api-log-button\");\n        this.$closeButton.on(\"click\", () => this.toggle(false));\n    }\n\n    async refreshWithNote(note) {\n        this.$logContainer.empty();\n    }\n\n    apiLogMessagesEvent({messages, noteId}) {\n        if (!this.isNote(noteId)) {\n            return;\n        }\n\n        this.toggle(true);\n\n        for (const message of messages) {\n            this.$logContainer.append(message).append($(\"<br>\"));\n        }\n    }\n\n    toggle(show) {\n        this.$widget.toggleClass(\"hidden-api-log\", !show);\n    }\n}\n","import NoteContextAwareWidget from \"../note_context_aware_widget.js\";\n\nconst TPL = `\n<div class=\"close-floating-buttons\">\n    <style>\n        .close-floating-buttons {\n            display: none;\n            margin-left: 5px !important;\n        }\n    \n        /* conditionally display close button if there's some other button visible */\n        .floating-buttons *:not(.hidden-int):not(.hidden-no-content) ~ .close-floating-buttons {\n            display: block;\n        }\n        \n        .close-floating-buttons-button {\n            border: 1px solid transparent;\n            color: var(--button-text-color);\n            padding: 6px;\n            border-radius: 100px;\n        }\n        \n        .close-floating-buttons-button:hover {\n            border: 1px solid var(--button-border-color);\n        }\n    </style>\n\n    <button type=\"button\"\n            class=\"close-floating-buttons-button btn bx bx-x\"\n            title=\"隐藏按钮\"></button>\n</div>\n`;\n\nexport default class HideFloatingButtonsButton extends NoteContextAwareWidget {\n    doRender() {\n        super.doRender();\n\n        this.$widget = $(TPL);\n        this.$widget.on('click', () => this.triggerCommand('hideFloatingButtons'));\n        this.contentSized();\n    }\n}\n","import NoteContextAwareWidget from \"../note_context_aware_widget.js\";\nimport keyboardActionService from \"../../services/keyboard_actions.js\";\n\nconst TPL = `\n<div class=\"script-runner-widget\">\n    <style>\n        .script-runner-widget {\n            padding: 12px;\n            color: var(--muted-text-color);\n        }\n\n        .execute-description {\n            margin-bottom: 10px;\n        }\n    </style>\n\n    <div class=\"execute-description\"></div>\n    \n    <div style=\"display: flex; justify-content: space-around\">\n        <button data-trigger-command=\"runActiveNote\" class=\"execute-button btn btn-sm\"></button>\n    </div>\n</div>`;\n\nexport default class ScriptExecutorWidget extends NoteContextAwareWidget {\n    isEnabled() {\n        return super.isEnabled()\n            && this.note\n            && (this.note.mime.startsWith('application/javascript') || this.isTriliumSqlite())\n            && (this.note.hasLabel('executeDescription') || this.note.hasLabel('executeButton'));\n    }\n\n    isTriliumSqlite() {\n        return this.note.mime === 'text/x-sqlite;schema=trilium';\n    }\n\n    getTitle() {\n        return {\n            show: this.isEnabled(),\n            activate: true,\n            title: this.isTriliumSqlite() ? 'Query' : 'Script',\n            icon: 'bx bx-run'\n        };\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.contentSized();\n\n        this.$executeButton = this.$widget.find('.execute-button');\n        this.$executeDescription = this.$widget.find('.execute-description');\n    }\n\n    async refreshWithNote(note) {\n        const executeTitle = note.getLabelValue('executeButton')\n            || (this.isTriliumSqlite() ? 'Execute Query' : 'Execute Script');\n\n        this.$executeButton.text(executeTitle);\n        this.$executeButton.attr('title', executeTitle);\n        keyboardActionService.updateDisplayedShortcuts(this.$widget);\n\n        const executeDescription = note.getLabelValue('executeDescription');\n\n        if (executeDescription) {\n            this.$executeDescription.show().html(executeDescription);\n        } else {\n            this.$executeDescription.empty().hide();\n        }\n    }\n}\n","import OnClickButtonWidget from \"./onclick_button.js\";\nimport appContext from \"../../components/app_context.js\";\n\nexport default class MovePaneButton extends OnClickButtonWidget {\n    constructor(isMovingLeft) {\n        super();\n\n        this.isMovingLeft = isMovingLeft;\n\n        this.icon(isMovingLeft ? \"bx-chevron-left\" : \"bx-chevron-right\")\n            .title(isMovingLeft ? \"向左移动\" : \"向右移动\")\n            .titlePlacement(\"bottom\")\n            .onClick(async (widget, e) => {\n                e.stopPropagation();\n                widget.triggerCommand(\"moveThisNoteSplit\", {ntxId: widget.getClosestNtxId(), isMovingLeft: this.isMovingLeft});\n            })\n            .class(\"icon-action\");\n    }\n\n    isEnabled() {\n        if (!super.isEnabled()) {\n            return false;\n        }\n\n        if (this.isMovingLeft) {\n            // movable if the current context is not a main context, i.e. non-null mainNtxId\n            return !!this.noteContext?.mainNtxId;\n        } else {\n            const currentIndex = appContext.tabManager.noteContexts.findIndex(c => c.ntxId === this.ntxId);\n            const nextContext = appContext.tabManager.noteContexts[currentIndex + 1];\n            // movable if the next context is not null and not a main context, i.e. non-null mainNtxId\n            return !!nextContext?.mainNtxId;\n        }\n    }\n\n    async noteContextRemovedEvent() {\n        this.refresh();\n    }\n\n    async newNoteContextCreatedEvent() {\n        this.refresh();\n    }\n\n    async noteContextReorderEvent() {\n        this.refresh();\n    }\n\n    async contextsReopenedEvent() {\n        this.refresh();\n    }\n}\n","import utils from '../../services/utils.js';\nimport treeService from \"../../services/tree.js\";\nimport importService from \"../../services/import.js\";\nimport options from \"../../services/options.js\";\nimport BasicWidget from \"../basic_widget.js\";\n\nconst TPL = `\n<div class=\"upload-attachments-dialog modal fade mx-auto\" tabindex=\"-1\" role=\"dialog\">\n    <div class=\"modal-dialog modal-lg\" role=\"document\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <h5 class=\"modal-title\">上传附件到笔记</h5>\n                <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n                    <span aria-hidden=\"true\">&times;</span>\n                </button>\n            </div>\n            <form class=\"upload-attachment-form\">\n                <div class=\"modal-body\">\n                    <div class=\"form-group\">\n                        <label for=\"upload-attachment-file-upload-input\"><strong>选择文件</strong></label>\n\n                        <input type=\"file\" class=\"upload-attachment-file-upload-input form-control-file\" multiple />\n\n                        <p>文件将作为附件上传到<strong class=\"upload-attachment-note-title\"></strong>.\n                    </div>\n\n                    <div class=\"form-group\">\n                        <strong>选项:</strong>\n\n                        <div class=\"checkbox\">\n                            <label data-toggle=\"tooltip\" title=\"<p>如果您选择此选项, Trilium将尝试通过缩放和优化来缩小上传的图像, 这可能会影响感知的图像质量. 如果未选中, 则图像将以原样上传.</p>\">\n                                <input class=\"shrink-images-checkbox\" value=\"1\" type=\"checkbox\" checked> <span>压缩图像</span>\n                            </label>\n                        </div>\n                    </div>\n                </div>\n                <div class=\"modal-footer\">\n                    <button class=\"upload-attachment-button btn btn-primary\">上传</button>\n                </div>\n            </form>\n        </div>\n    </div>\n</div>`;\n\nexport default class UploadAttachmentsDialog extends BasicWidget {\n    constructor() {\n        super();\n\n        this.parentNoteId = null;\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$form = this.$widget.find(\".upload-attachment-form\");\n        this.$noteTitle = this.$widget.find(\".upload-attachment-note-title\");\n        this.$fileUploadInput = this.$widget.find(\".upload-attachment-file-upload-input\");\n        this.$uploadButton = this.$widget.find(\".upload-attachment-button\");\n        this.$shrinkImagesCheckbox = this.$widget.find(\".shrink-images-checkbox\");\n\n        this.$form.on('submit', () => {\n            // disabling so that import is not triggered again.\n            this.$uploadButton.attr(\"disabled\", \"disabled\");\n\n            this.uploadAttachments(this.parentNoteId);\n\n            return false;\n        });\n\n        this.$fileUploadInput.on('change', () => {\n            if (this.$fileUploadInput.val()) {\n                this.$uploadButton.removeAttr(\"disabled\");\n            }\n            else {\n                this.$uploadButton.attr(\"disabled\", \"disabled\");\n            }\n        });\n\n        this.$widget.find('[data-toggle=\"tooltip\"]').tooltip({\n            html: true\n        });\n    }\n\n    async showUploadAttachmentsDialogEvent({noteId}) {\n        this.parentNoteId = noteId;\n\n        this.$fileUploadInput.val('').trigger('change'); // to trigger upload button disabling listener below\n        this.$shrinkImagesCheckbox.prop(\"checked\", options.is('compressImages'));\n\n        this.$noteTitle.text(await treeService.getNoteTitle(this.parentNoteId));\n\n        utils.openDialog(this.$widget);\n    }\n\n    async uploadAttachments(parentNoteId) {\n        const files = Array.from(this.$fileUploadInput[0].files); // shallow copy since we're resetting the upload button below\n\n        const boolToString = $el => $el.is(\":checked\") ? \"true\" : \"false\";\n\n        const options = {\n            shrinkImages: boolToString(this.$shrinkImagesCheckbox),\n        };\n\n        this.$widget.modal('hide');\n\n        await importService.uploadFiles('attachments', parentNoteId, files, options);\n    }\n}\n","import NoteContextAwareWidget from \"../note_context_aware_widget.js\";\nimport utils from \"../../services/utils.js\";\nimport imageService from \"../../services/image.js\";\n\nconst TPL = `\n<button type=\"button\"\n        class=\"copy-image-reference-button\"\n        title=\"复制图像引用到剪贴板, 可以粘贴到文本笔记中.\">\n        <span class=\"bx bx-copy\"></span>\n        \n        <div class=\"hidden-image-copy\"></div>\n</button>`;\n\nexport default class CopyImageReferenceButton extends NoteContextAwareWidget {\n    isEnabled() {\n        return super.isEnabled()\n            && ['mermaid', 'canvas'].includes(this.note?.type)\n            && this.note.isContentAvailable()\n            && this.noteContext?.viewScope.viewMode === 'default';\n    }\n\n    doRender() {\n        super.doRender();\n\n        this.$widget = $(TPL);\n        this.$hiddenImageCopy = this.$widget.find(\".hidden-image-copy\");\n\n        this.$widget.on('click', () => {\n            this.$hiddenImageCopy.empty().append(\n                $(\"<img>\")\n                    .attr(\"src\", utils.createImageSrcUrl(this.note))\n            );\n\n            imageService.copyImageReferenceToClipboard(this.$hiddenImageCopy);\n\n            this.$hiddenImageCopy.empty();\n        });\n        this.contentSized();\n    }\n}\n","import NoteContextAwareWidget from \"./note_context_aware_widget.js\";\n\nconst TPL = `<div class=\"scroll-padding-widget\"></div>`;\n\nexport default class ScrollPaddingWidget extends NoteContextAwareWidget {\n    isEnabled() {\n        return super.isEnabled() && [\"text\", \"code\"].includes(this.note?.type);\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.contentSized();\n\n        this.$widget.on(\"click\", () =>\n            this.triggerCommand('scrollToEnd', {ntxId: this.ntxId}));\n    }\n\n    initialRenderCompleteEvent() {\n        this.$scrollingContainer = this.$widget.closest(\".scrolling-container\");\n\n        new ResizeObserver(() => this.refreshHeight()).observe(this.$scrollingContainer[0]);\n\n        this.refreshHeight();\n    }\n\n    refreshHeight() {\n        const containerHeight = this.$scrollingContainer.height();\n\n        this.$widget.css(\"height\", Math.round(containerHeight / 2));\n    }\n}\n","import FlexContainer from \"../widgets/containers/flex_container.js\";\nimport GlobalMenuWidget from \"../widgets/buttons/global_menu.js\";\nimport TabRowWidget from \"../widgets/tab_row.js\";\nimport TitleBarButtonsWidget from \"../widgets/title_bar_buttons.js\";\nimport LeftPaneContainer from \"../widgets/containers/left_pane_container.js\";\nimport NoteTreeWidget from \"../widgets/note_tree.js\";\nimport NoteTitleWidget from \"../widgets/note_title.js\";\nimport OwnedAttributeListWidget from \"../widgets/ribbon_widgets/owned_attribute_list.js\";\nimport NoteActionsWidget from \"../widgets/buttons/note_actions.js\";\nimport NoteDetailWidget from \"../widgets/note_detail.js\";\nimport RibbonContainer from \"../widgets/containers/ribbon_container.js\";\nimport PromotedAttributesWidget from \"../widgets/ribbon_widgets/promoted_attributes.js\";\nimport InheritedAttributesWidget from \"../widgets/ribbon_widgets/inherited_attribute_list.js\";\nimport NoteListWidget from \"../widgets/note_list.js\";\nimport SearchDefinitionWidget from \"../widgets/ribbon_widgets/search_definition.js\";\nimport SqlResultWidget from \"../widgets/sql_result.js\";\nimport SqlTableSchemasWidget from \"../widgets/sql_table_schemas.js\";\nimport FilePropertiesWidget from \"../widgets/ribbon_widgets/file_properties.js\";\nimport ImagePropertiesWidget from \"../widgets/ribbon_widgets/image_properties.js\";\nimport NotePropertiesWidget from \"../widgets/ribbon_widgets/note_properties.js\";\nimport NoteIconWidget from \"../widgets/note_icon.js\";\nimport SearchResultWidget from \"../widgets/search_result.js\";\nimport ScrollingContainer from \"../widgets/containers/scrolling_container.js\";\nimport RootContainer from \"../widgets/containers/root_container.js\";\nimport WatchedFileUpdateStatusWidget from \"../widgets/watched_file_update_status.js\";\nimport SpacerWidget from \"../widgets/spacer.js\";\nimport QuickSearchWidget from \"../widgets/quick_search.js\";\nimport SplitNoteContainer from \"../widgets/containers/split_note_container.js\";\nimport LeftPaneToggleWidget from \"../widgets/buttons/left_pane_toggle.js\";\nimport CreatePaneButton from \"../widgets/buttons/create_pane_button.js\";\nimport ClosePaneButton from \"../widgets/buttons/close_pane_button.js\";\nimport BasicPropertiesWidget from \"../widgets/ribbon_widgets/basic_properties.js\";\nimport NoteInfoWidget from \"../widgets/ribbon_widgets/note_info_widget.js\";\nimport BookPropertiesWidget from \"../widgets/ribbon_widgets/book_properties.js\";\nimport NoteMapRibbonWidget from \"../widgets/ribbon_widgets/note_map.js\";\nimport NotePathsWidget from \"../widgets/ribbon_widgets/note_paths.js\";\nimport SimilarNotesWidget from \"../widgets/ribbon_widgets/similar_notes.js\";\nimport RightPaneContainer from \"../widgets/containers/right_pane_container.js\";\nimport EditButton from \"../widgets/buttons/edit_button.js\";\nimport EditedNotesWidget from \"../widgets/ribbon_widgets/edited_notes.js\";\nimport MermaidWidget from \"../widgets/mermaid.js\";\nimport NoteWrapperWidget from \"../widgets/note_wrapper.js\";\nimport BacklinksWidget from \"../widgets/floating_buttons/zpetne_odkazy.js\";\nimport SharedInfoWidget from \"../widgets/shared_info.js\";\nimport FindWidget from \"../widgets/find.js\";\nimport TocWidget from \"../widgets/toc.js\";\nimport HighlightsListWidget from \"../widgets/highlights_list.js\";\nimport BulkActionsDialog from \"../widgets/dialogs/bulk_actions.js\";\nimport AboutDialog from \"../widgets/dialogs/about.js\";\nimport HelpDialog from \"../widgets/dialogs/help.js\";\nimport RecentChangesDialog from \"../widgets/dialogs/recent_changes.js\";\nimport BranchPrefixDialog from \"../widgets/dialogs/branch_prefix.js\";\nimport SortChildNotesDialog from \"../widgets/dialogs/sort_child_notes.js\";\nimport PasswordNoteSetDialog from \"../widgets/dialogs/password_not_set.js\";\nimport IncludeNoteDialog from \"../widgets/dialogs/include_note.js\";\nimport NoteTypeChooserDialog from \"../widgets/dialogs/note_type_chooser.js\";\nimport JumpToNoteDialog from \"../widgets/dialogs/jump_to_note.js\";\nimport AddLinkDialog from \"../widgets/dialogs/add_link.js\";\nimport CloneToDialog from \"../widgets/dialogs/clone_to.js\";\nimport MoveToDialog from \"../widgets/dialogs/move_to.js\";\nimport ImportDialog from \"../widgets/dialogs/import.js\";\nimport ExportDialog from \"../widgets/dialogs/export.js\";\nimport MarkdownImportDialog from \"../widgets/dialogs/markdown_import.js\";\nimport ProtectedSessionPasswordDialog from \"../widgets/dialogs/protected_session_password.js\";\nimport RevisionsDialog from \"../widgets/dialogs/revisions.js\";\nimport DeleteNotesDialog from \"../widgets/dialogs/delete_notes.js\";\nimport InfoDialog from \"../widgets/dialogs/info.js\";\nimport ConfirmDialog from \"../widgets/dialogs/confirm.js\";\nimport PromptDialog from \"../widgets/dialogs/prompt.js\";\nimport FloatingButtons from \"../widgets/floating_buttons/floating_buttons.js\";\nimport RelationMapButtons from \"../widgets/floating_buttons/relation_map_buttons.js\";\nimport MermaidExportButton from \"../widgets/floating_buttons/mermaid_export_button.js\";\nimport LauncherContainer from \"../widgets/containers/launcher_container.js\";\nimport RevisionsButton from \"../widgets/buttons/revisions_button.js\";\nimport CodeButtonsWidget from \"../widgets/floating_buttons/code_buttons.js\";\nimport ApiLogWidget from \"../widgets/api_log.js\";\nimport HideFloatingButtonsButton from \"../widgets/floating_buttons/hide_floating_buttons_button.js\";\nimport ScriptExecutorWidget from \"../widgets/ribbon_widgets/script_executor.js\";\nimport MovePaneButton from \"../widgets/buttons/move_pane_button.js\";\nimport UploadAttachmentsDialog from \"../widgets/dialogs/upload_attachments.js\";\nimport CopyImageReferenceButton from \"../widgets/floating_buttons/copy_image_reference_button.js\";\nimport ScrollPaddingWidget from \"../widgets/scroll_padding.js\";\n\nexport default class DesktopLayout {\n    constructor(customWidgets) {\n        this.customWidgets = customWidgets;\n    }\n\n    getRootWidget(appContext) {\n        appContext.noteTreeWidget = new NoteTreeWidget();\n\n        return new RootContainer()\n            .setParent(appContext)\n            .child(new FlexContainer(\"column\")\n                .id(\"launcher-pane\")\n                .css(\"width\", \"53px\")\n                .child(new GlobalMenuWidget())\n                .child(new LauncherContainer())\n                .child(new LeftPaneToggleWidget())\n            )\n            .child(new LeftPaneContainer()\n                .child(new QuickSearchWidget())\n                .child(appContext.noteTreeWidget)\n                .child(...this.customWidgets.get('left-pane'))\n            )\n            .child(new FlexContainer('column')\n                .id('rest-pane')\n                .css(\"flex-grow\", \"1\")\n                .child(new FlexContainer('row')\n                    .child(new TabRowWidget())\n                    .child(new TitleBarButtonsWidget())\n                    .css('height', '40px')\n                )\n                .child(new FlexContainer('row')\n                    .filling()\n                    .collapsible()\n                    .child(new FlexContainer('column')\n                        .filling()\n                        .collapsible()\n                        .id('center-pane')\n                        .child(new SplitNoteContainer(() =>\n                                new NoteWrapperWidget()\n                                    .child(new FlexContainer('row').class('title-row')\n                                        .css(\"height\", \"50px\")\n                                        .css(\"min-height\", \"50px\")\n                                        .css('align-items', \"center\")\n                                        .cssBlock('.title-row > * { margin: 5px; }')\n                                        .child(new NoteIconWidget())\n                                        .child(new NoteTitleWidget())\n                                        .child(new SpacerWidget(0, 1))\n                                        .child(new MovePaneButton(true))\n                                        .child(new MovePaneButton(false))\n                                        .child(new ClosePaneButton())\n                                        .child(new CreatePaneButton())\n                                    )\n                                    .child(\n                                        new RibbonContainer()\n                                            // the order of the widgets matter. Some of these want to \"activate\" themselves\n                                            // when visible. When this happens to multiple of them, the first one \"wins\".\n                                            // promoted attributes should always win.\n                                            .ribbon(new PromotedAttributesWidget())\n                                            .ribbon(new ScriptExecutorWidget())\n                                            .ribbon(new SearchDefinitionWidget())\n                                            .ribbon(new EditedNotesWidget())\n                                            .ribbon(new BookPropertiesWidget())\n                                            .ribbon(new NotePropertiesWidget())\n                                            .ribbon(new FilePropertiesWidget())\n                                            .ribbon(new ImagePropertiesWidget())\n                                            .ribbon(new BasicPropertiesWidget())\n                                            .ribbon(new OwnedAttributeListWidget())\n                                            .ribbon(new InheritedAttributesWidget())\n                                            .ribbon(new NotePathsWidget())\n                                            .ribbon(new NoteMapRibbonWidget())\n                                            .ribbon(new SimilarNotesWidget())\n                                            .ribbon(new NoteInfoWidget())\n                                            .button(new RevisionsButton())\n                                            .button(new NoteActionsWidget())\n                                    )\n                                    .child(new SharedInfoWidget())\n                                    .child(new WatchedFileUpdateStatusWidget())\n                                    .child(new FloatingButtons()\n                                        .child(new EditButton())\n                                        .child(new CodeButtonsWidget())\n                                        .child(new RelationMapButtons())\n                                        .child(new CopyImageReferenceButton())\n                                        .child(new MermaidExportButton())\n                                        .child(new BacklinksWidget())\n                                        .child(new HideFloatingButtonsButton())\n                                    )\n                                    .child(new MermaidWidget())\n                                    .child(\n                                        new ScrollingContainer()\n                                            .filling()\n                                            .child(new SqlTableSchemasWidget())\n                                            .child(new NoteDetailWidget())\n                                            .child(new NoteListWidget())\n                                            .child(new SearchResultWidget())\n                                            .child(new SqlResultWidget())\n                                            .child(new ScrollPaddingWidget())\n                                    )\n                                    .child(new ApiLogWidget())\n                                    .child(new FindWidget())\n                                    .child(\n                                        ...this.customWidgets.get('node-detail-pane'), // typo, let's keep it for a while as BC\n                                        ...this.customWidgets.get('note-detail-pane')\n                                    )\n                            )\n                        )\n                        .child(...this.customWidgets.get('center-pane'))\n                    )\n                    .child(new RightPaneContainer()\n                        .child(new TocWidget())\n                        .child(new HighlightsListWidget())\n                        .child(...this.customWidgets.get('right-pane'))\n                    )\n                )\n            )\n            .child(new BulkActionsDialog())\n            .child(new AboutDialog())\n            .child(new HelpDialog())\n            .child(new RecentChangesDialog())\n            .child(new BranchPrefixDialog())\n            .child(new SortChildNotesDialog())\n            .child(new PasswordNoteSetDialog())\n            .child(new IncludeNoteDialog())\n            .child(new NoteTypeChooserDialog())\n            .child(new JumpToNoteDialog())\n            .child(new AddLinkDialog())\n            .child(new CloneToDialog())\n            .child(new MoveToDialog())\n            .child(new ImportDialog())\n            .child(new ExportDialog())\n            .child(new UploadAttachmentsDialog())\n            .child(new MarkdownImportDialog())\n            .child(new ProtectedSessionPasswordDialog())\n            .child(new RevisionsDialog())\n            .child(new DeleteNotesDialog())\n            .child(new InfoDialog())\n            .child(new ConfirmDialog())\n            .child(new PromptDialog());\n    }\n}\n","import utils from \"./utils.js\";\nimport appContext from \"../components/app_context.js\";\nimport server from \"./server.js\";\nimport libraryLoader from \"./library_loader.js\";\nimport ws from \"./ws.js\";\nimport froca from \"./froca.js\";\nimport linkService from \"./link.js\";\n\nfunction setupGlobs() {\n    window.glob.isDesktop = utils.isDesktop;\n    window.glob.isMobile = utils.isMobile;\n\n    window.glob.getComponentByEl = el => appContext.getComponentByEl(el);\n    window.glob.getHeaders = server.getHeaders;\n    window.glob.getReferenceLinkTitle = href => linkService.getReferenceLinkTitle(href);\n    window.glob.getReferenceLinkTitleSync = href => linkService.getReferenceLinkTitleSync(href);\n\n    // required for ESLint plugin and CKEditor\n    window.glob.getActiveContextNote = () => appContext.tabManager.getActiveContextNote();\n    window.glob.requireLibrary = libraryLoader.requireLibrary;\n    window.glob.ESLINT = libraryLoader.ESLINT;\n    window.glob.appContext = appContext; // for debugging\n    window.glob.froca = froca;\n    window.glob.treeCache = froca; // compatibility for CKEditor builds for a while\n\n    // for CKEditor integration (button on block toolbar)\n    window.glob.importMarkdownInline = async () => appContext.triggerCommand(\"importMarkdownInline\");\n\n    window.glob.SEARCH_HELP_TEXT = `\n    <strong>搜索建议</strong> - 参见 <button class=\"btn btn-sm\" type=\"button\" data-help-page=\"Search\">搜索语法完整帮助文档</button>\n    <p>\n    <ul>\n        <li>输入任意文字进行全文搜索</li>\n                <li><code>#abc</code> - 会返回含有abc标签的笔记</li>\n                <li><code>#year = 2019</code> - <code>year</code>并且值是<code>2019</code>的笔记</li>\n                <li><code>#rock #pop</code> - 会匹配同时含有 <code>rock</code> 和  <code>pop</code> 标签的笔记</li>\n                <li><code>#rock or #pop</code> - 含有其中任意一个标签的笔记</li>\n                <li><code>#year &lt;= 2000</code> - 可以用比较符号(比如 &gt;, &gt;=, &lt;).</li>\n                <li><code>note.dateCreated >= MONTH-1</code> - 上个月创建的笔记</li>\n        <li><code>=handler</code> - 会执行<code>=handler</code>关联的代码来获取结果</li>\n    </ul>\n    </p>`;\n\n    window.onerror = function (msg, url, lineNo, columnNo, error) {\n        const string = msg.toLowerCase();\n\n        let message = \"未捕获的错误: \";\n\n        if (string.includes(\"script error\")) {\n            message += '没有详细信息';\n        } else {\n            message += [\n                `信息: ${msg}`,\n                `URL: ${url}`,\n                `行数: ${lineNo}`,\n                `列数: ${columnNo}`,\n                `错误对象: ${JSON.stringify(error)}`,\n                `堆栈: ${error && error.stack}`\n            ].join(', ');\n        }\n\n        ws.logError(message);\n\n        return false;\n    };\n\n    for (const appCssNoteId of glob.appCssNoteIds || []) {\n        libraryLoader.requireCss(`api/notes/download/${appCssNoteId}`, false);\n    }\n\n    utils.initHelpButtons($(window));\n\n    $(\"body\").on(\"click\", \"a.external\", function () {\n        window.open($(this).attr(\"href\"), '_blank');\n\n        return false;\n    });\n}\n\nexport default {\n    setupGlobs\n}\n","import appContext from \"./components/app_context.js\";\nimport utils from './services/utils.js';\nimport noteTooltipService from './services/note_tooltip.js';\nimport bundleService from \"./services/bundle.js\";\nimport noteAutocompleteService from './services/note_autocomplete.js';\nimport macInit from './services/mac_init.js';\nimport electronContextMenu from \"./menus/electron_context_menu.js\";\nimport DesktopLayout from \"./layouts/desktop_layout.js\";\nimport glob from \"./services/glob.js\";\n\nbundleService.getWidgetBundlesByParent().then(widgetBundles => {\n    appContext.setLayout(new DesktopLayout(widgetBundles));\n    appContext.start();\n});\n\nglob.setupGlobs();\n\nif (utils.isElectron()) {\n    utils.dynamicRequire('electron').ipcRenderer.on('globalShortcut',\n        async (event, actionName) => appContext.triggerCommand(actionName));\n}\n\nmacInit.init();\n\nnoteTooltipService.setupGlobalTooltip();\n\nnoteAutocompleteService.init();\n\nif (utils.isElectron()) {\n    electronContextMenu.setupContextMenu();\n}\n"],"names":["RootCommandExecutor","editReadOnlyNoteCommand","noteContext","viewScope","readOnlyTemporarilyDisabled","async","sqlConsoleNote","noteId","activate","ntxId","searchString","ancestorNoteId","searchNote","froca","notePath","tree","this","searchNotesCommand","openNoteExternallyCommand","mime","openNoteCustomCommand","enterProtectedSessionCommand","leaveProtectedSessionCommand","hideLeftPaneCommand","options","showLeftPaneCommand","toggleLeftPaneCommand","showAndHoistSubtree","section","hoistedNoteId","subtreeNoteId","viewMode","toggleTrayCommand","utils","BrowserWindow","windows","getAllWindows","action","every","w","isVisible","window","firstTabCommand","secondTabCommand","thirdTabCommand","fourthTabCommand","fifthTabCommand","sixthTabCommand","seventhTabCommand","eigthTabCommand","ninthTabCommand","lastTabCommand","Number","POSITIVE_INFINITY","tabNumber","mainNoteContexts","tab","length","Entrypoints","constructor","super","jQuery","hotkeys","filterInputAcceptingElements","filterContentEditable","filterTextInputs","openDevToolsCommand","getCurrentWindow","toggleDevTools","inboxNote","note","server","content","type","isProtected","ws","isNewNote","noteToHoist","activeNoteContext","unhoist","setHoistedNoteId","copyWithoutFormattingCommand","toggleFullscreenCommand","win","isFullScreenable","setFullScreen","isFullScreen","reloadFrontendAppCommand","logoutCommand","$logoutForm","$","append","glob","csrfToken","trigger","backInNoteHistoryCommand","webContents","getCurrentWebContents","activeIndex","parseInt","getActiveIndex","goToIndex","history","back","forwardInNoteHistoryCommand","forward","extraWindowHash","ipcRenderer","send","url","location","protocol","host","pathname","open","openInWindowCommand","endsWith","bundle","resp","success","toast","error","results","hideAllPopups","autocomplete","noteSwitchedEvent","activeContextChangedEvent","NoteContext","mainNtxId","generateNtxId","resetViewScope","static","setEmpty","parentNoteId","triggerEvent","isEmpty","inputNotePath","opts","triggerSwitchEvent","undefined","resolvedNotePath","getResolvedNotePath","saveToRecentNotes","setHoistedNoteIfNeeded","triggerCommand","screen","startsWith","isLabelTruthy","isLaunchBarConfig","isOptions","getSubContexts","nc","isMainContext","getMainContext","e","setTimeout","logError","notePathArray","split","isActive","getPojoState","active","noteIdToHoist","includes","setNote","blob","getBlob","sizeLimit","contentLength","loadResults","isNoteReloaded","getEntityRow","isDeleted","hasNoteList","hasChildren","callback","timeout","Promise","resolve","promise","race","res","title","attachmentId","attachment","getAttachmentById","Mutex","current","lock","resolveFun","subPromise","newPromise","then","cb","unlock","TabManager","children","mutex","activeNtxId","recentlyClosedTabs","tabsUpdate","openNoteContexts","noteContexts","map","filter","t","JSON","stringify","noteContextsToOpen","flatMap","filteredNoteContexts","openTab","parsedFromUrl","href","push","find","allowUpdateWithoutChange","openContextWithNote","message","stack","openEmptyTab","setCurrentNavigationStateToHash","scheduleUpdate","calculatedHash","calculateHash","hash","pushState","getActiveContext","updateDocumentTitle","getNoteContexts","getMainNoteContexts","getNoteContextById","Error","getActiveMainContext","getActiveContextNotePath","activeContext","getActiveContextNote","getActiveContextNoteId","activeNote","getActiveContextNoteType","getActiveContextNoteMime","activateNoteContext","existingNoteContext","child","targetNoteId","runExclusively","noteContextToRemove","noteContextsToRemove","ntxIdsToRemove","ntxIds","openAndActivateEmptyTab","findIndex","activatePreviousTabCommand","activateNextTabCommand","siblings","idx","contextToActivate","removeNoteContexts","position","addToRecentlyClosedTabs","contexts","tabReorderEvent","ntxIdsInOrder","order","i","sort","a","b","noteContextReorderEvent","oldMainNtxId","newMainNtxId","Object","fromEntries","v","forEach","c","activeMainNtxId","oldIdx","newActiveNtxId","removeNoteContext","beforeUnloadEvent","updateNowIfNecessary","openNewTabCommand","ntxIdToRemove","closeLastEmptyTab","lastClosedTab","pop","ntxsInOrder","slice","mainNtx","tabPosition","afterNtxId","noteContextToActivate","hoistedNoteChangedEvent","titleFragments","getNavigationTitle","Boolean","document","join","MobileScreenSwitcherExecutor","setActiveScreenCommand","activeScreen","MainTreeExecutors","selectedOrActiveNoteIds","getSelectedOrActiveNodes","node","data","noteIds","selectedOrActiveBranchIds","branchId","branchIds","saveSelection","getActiveNode","parentNotePath","getParent","target","targetBranchId","ShortcutComponent","shortcutAttributes","attr","bindNoteShortcutHandler","labelOrRow","namespace","attributeId","value","getAttributeRows","name","AppContext","isMainWindow","components","beforeUnloadListeners","setLayout","layout","initComponents","renderWidgets","tabManager","loadTabs","component","zoom","rootWidget","getRootWidget","$renderedWidget","render","on","hasClass","commandName","closest","prop","$el","handleEvent","executor","fun","callMethod","console","debug","getComponentByEl","el","addBeforeUnloadListener","obj","WeakRef","appContext","allSaved","wr","deref","weakRef","log","componentId","switchToNoteContext","Component","sanitizedClassName","initialized","replace","setParent","parent","callMethodPromise","childrenPromise","handleEventInChildren","all","promises","ret","startTime","Date","now","call","took","isDev","ZoomComponent","setZoomFactor","addEventListener","event","ctrlKey","setZoomFactorAndSave","getCurrentZoom","deltaY","zoomFactor","parseFloat","webFrame","Math","round","getZoomFactor","zoomOutEvent","zoomInEvent","zoomResetEvent","setZoomFactorAndSaveEvent","row","update","ownerId","role","dateModified","utcDateModified","utcDateScheduledForErasureSince","attachments","getNote","notes","isInheritable","isAutoLink","toString","isDefinition","getDefinition","isDefinitionFor","dto","assign","notePosition","prefix","isExpanded","fromSearchNote","getNoteFromCache","isTopLevel","pojo","registeredClasses","Set","color","trim","normalizedColorName","className","has","add","LABEL","RELATION","NOTE_TYPE_ICONS","attributes","targetRelations","parents","parentToBranch","childToBranch","blobId","addParent","sortParents","addChild","childNoteId","sortChildren","branchIdPos","values","getBranch","isJson","getContent","parse","getParentBranchIds","getBranchIds","getParentBranches","getBranches","getChildBranches","getParentNoteIds","getParentNotes","getNotesFromCache","aNoteId","bNoteId","aBranchId","aNote","isArchived","isHiddenCompletely","hasAttribute","getChildNoteIds","getNotes","getAttachmentsForNote","getAttachments","att","isEligibleForConversionToAttachment","isContentAvailable","getTargetRelations","relation","parentNote","referencingNote","getOwnedAttributes","attrs","__filterAttrs","getAttributes","__getCachedAttributes","path","newPath","attrArrs","__getInheritableAttributes","templateAttr","flat","templateNote","addedAttributeIds","isRoot","getAllNotePaths","parentNotes","notePaths","getSortedNotePathRecords","isHoistedRoot","isInHoistedSubTree","some","isSearch","isHidden","getBestNotePath","getBestNotePathString","__validateTypeName","firstLetter","charAt","getOwnedLabels","getLabels","getIcon","iconClassLabels","workspaceIconClass","getWorkspaceIconClass","isFolder","getColorClass","getLabelValue","getFilteredChildBranches","childBranches","getOwnedRelations","getRelations","hasOwnedAttribute","getOwnedAttribute","getAttribute","getOwnedAttributeValue","getAttributeValue","hasOwnedLabel","hasLabel","label","getLabel","hasOwnedRelation","hasRelation","getOwnedLabel","getOwnedRelation","getRelation","getOwnedLabelValue","getOwnedRelationValue","getRelationValue","targets","getRelationTargets","relations","getNotesToInheritAttributesFrom","rel","getPromotedDefinitionAttributes","promotedAttrs","def","isPromoted","hasAncestor","followTemplates","visitedNoteIds","isInHiddenSubtree","invalidateAttributeCache","tr","getCssClass","l","labels","getWorkspaceTabBackgroundColor","isJavaScript","isHtml","getScriptEnv","env","bundleService","default","getAndExecuteBundle","isShared","$widget","dateContextMenuOpenedMs","hide","empty","addItems","items","positionMenu","clientHeight","documentElement","clientWidth","contextMenuHeight","outerHeight","contextMenuWidth","outerWidth","top","left","y","orientation","x","css","display","addClass","$parent","item","$icon","uiIcon","$link","$item","stopPropagation","which","handler","selectMenuItemHandler","enabled","$subMenu","openContextMenu","pageX","pageY","command","subContexts","renderAttribute","attribute","renderIsInheritable","$attr","createTextNode","val","test","class","text","createLink","renderAttributes","$container","html","HIDDEN_ATTRIBUTES","renderNormalAttributes","promotedDefinitionAttributes","promAttr","$renderedAttributes","count","filterSearchBranches","filterRootNote","branch","makeToast","id","icon","taskType","taskId","progressCount","closeAfter","moveBeforeBranch","branchIdsToMove","beforeBranchId","beforeBranch","branchIdToMove","moveAfterBranch","afterBranchId","afterNote","reverse","moveToParentNote","newParentBranchId","branchToMove","getParentNote","deleteNotes","branchIdsToDelete","forceDeleteAllClones","proceed","deleteAllClones","eraseNotes","counter","branchIdToDelete","query","moveNodeUpInHierarchy","noteType","getChildren","folder","renderTitle","cloneNoteAfter","cloneNoteToBranch","parentBranchId","cloneNoteToParentNote","originEntity","script","params","executeBundle","apiContext","allNoteIds","eval","executeStartupBundles","isMobile","scriptBundles","WidgetsByParent","byParent","widget","parentWidget","get","parentName","prototype","getWidgetBundlesByParent","widgetsByParent","clipboardBranchIds","clipboardMode","isClipboardEmpty","pasteAfter","clipboardBranches","clipboardBranch","clipboardNote","pasteInto","cut","copy","clipboard","links","referenceLink","outerHTML","writeHTML","idCounter","getRenderedContent","entity","tooltip","getRenderingType","$renderedContent","childNoteIds","childNotes","childNote","showTooltip","showNoteIcon","renderChildrenList","renderMathInElement","trust","getNoteIdFromLink","referenceLinks","noteIdsToPrefetch","renderText","renderCode","encodedTitle","encodeURIComponent","random","$img","imageHasZoom","WZoom","create","maxScale","speed","zoomOnClick","renderImage","entityType","entityId","$content","$pdfPreview","$audioPreview","$videoPreview","$downloadButton","$openButton","toggle","renderFile","mermaidTheme","getComputedStyle","getPropertyValue","mermaid","mermaidAPI","initialize","startOnLoad","theme","securityLevel","svg","$error","renderMermaid","ctx","$button","getDayNote","date","getInboxNote","dayjs","format","getTodayNote","getWeekNote","getMonthNote","month","getYearNote","year","createSqlConsole","createSearchNote","info","confirm","confirmed","confirmDeleteNoteBoxWithNote","prompt","props","FBlob","getJsonContent","getJsonContentSafely","initializedPromise","loadInitialTree","branches","blobPromises","addResp","subTreeNoteId","noteRows","branchRows","attributeRows","noteIdsToSort","noteRow","p","branchRow","attributeRow","targetNote","Array","from","searchResultNoteIds","highlightedTokens","isArray","resultNoteId","index","searchResultsLoaded","silentNotFoundError","trace","missingNoteIds","reloadNotes","attachmentRows","logInfo","processAttachmentRows","attachmentRow","key","catch","getHoistedNoteId","isHoistedNode","isTopLevelNode","checkNoteAccess","requestedNote","hoistedNote","isHoistedInHiddenSubtree","uploadFiles","files","file","formData","FormData","ajax","baseApiUrl","headers","dataType","xhr","responseText","contentType","processData","result","importedNoteId","keyboardActionRepo","keyboardActionsLoaded","actions","actionName","effectiveShortcuts","shortcut","getActionsForScope","scope","getAction","silent","updateDisplayedShortcuts","each","keyboardActions","shortcuts","newTitle","setupActionsForElement","getActions","loadedScriptPromises","requireScript","assetPath","cache","requireCss","prependAssetPath","querySelectorAll","requireLibrary","library","cssUrl","js","scriptUrl","CKEDITOR","CODE_MIRROR","ESLINT","RELATION_MAP","PRINT_THIS","CALENDAR_WIDGET","KATEX","WHEEL_ZOOM","FORCE_GRAPH","MERMAID","EXCALIDRAW","MARKJS","getLinkIcon","paramStr","pair","keys","parseNavigationStateFromUrl","hashIdx","indexOf","substr","paramString","match","decodeURIComponent","warn","goToLink","evt","goToLinkExt","hrefLink","preventDefault","isLeftClick","isMiddleClick","openInNewTab","leftClick","middleClick","withinEditLink","outsideOfCKEditor","toLowerCase","shell","openPath","getReferenceLinkTitle","address","getNotePathFromUrl","notePathMatch","exec","showNotePath","autoConvertToImage","linkTitle","$noteLink","resolvedNotePathSegments","loadReferenceLinkTitle","tagName","prepend","getReferenceLinkTitleSync","invalidate","createNote","focus","selectedHtml","dom","parseHTML","parseSelectedHtml","textEditor","getSelectedHtml","templateNoteId","removeSelection","chooseNoteType","createNoteWithTypePrompt","duplicateSubtree","origNote","mouseEnterHandler","linkId","floor","is","renderTooltip","tooltipClass","container","placement","boundary","template","sanitize","customClass","checkTooltip","bestNotePath","setupGlobalTooltip","remove","setupElementTooltip","getNoteTypeItems","templateNoteIds","templateNotes","checkType","getFileUrl","getUrlForDownload","download","downloadURL","openCustom","filePath","tmpFilePath","platform","process","terminals","openFileWithTerminal","terminal","stdout","stderr","searchTerminal","err","URL","hostname","port","getHost","openExternally","electron","canOpenInBrowser","getOpenFileUrl","downloadFileNote","downloadRevision","revisionId","downloadAttachment","openNoteExternally","openAttachmentExternally","openNoteCustom","openAttachmentCustom","load","arr","getNames","getJson","getInt","getFloat","set","payload","save","tokens","defObj","token","labelType","multiplicity","chunks","numberPrecision","promotedAlias","inverseRelation","protectedSessionDeferred","enterProtectedSession","dfd","Deferred","protectingLabel","protect","reloadData","protectNote","includingSubtree","leaveProtectedSession","setupProtectedSession","password","isProtectedSessionAvailable","touchProtectedSession","enableProtectedSession","resetProtectedSession","touchProtectedSessionIfNecessary","renderNoteIds","renderNoteId","$scriptContainer","startNote","currentNote","prepareParams","RightPanelWidget","NoteContextAwareWidget","BasicWidget","activateNote","activateNewNote","openTabWithNote","openSplitWithNote","addButtonToToolbar","reqBody","__runOnBackendInner","func","transactional","startNoteId","currentNoteId","originEntityName","originEntityId","executionResult","runOnBackend","runAsyncOnBackendWithManualTransactionHandling","searchForNotes","search","searchForNote","getInstanceName","instanceName","formatDateISO","parseDate","showMessage","showError","showInfoDialog","dialog","showConfirmDialog","showPromptDialog","createNoteLink","addTextToActiveContextEditor","getActiveContextTextEditor","getTextEditor","getActiveContextCodeEditor","getCodeEditor","getActiveNoteDetailWidget","protectSubTree","bindGlobalShortcut","waitUntilSynced","refreshIncludedNote","includedNoteId","randomString","formatSize","formatNoteSize","logMessages","logSpacedUpdates","messages","modules","allNotes","apis","require","moduleNoteIds","moduleName","candidates","exports","searchForNoteIds","ValidationError","getHeaders","allHeaders","headerName","cookie","idToRequestMap","maxKnownEntityChangeId","method","ipc","requestId","reject","silentNotFound","rej","body","textStatus","jqXhr","respHeaders","getAllResponseHeaders","line","parts","header","shift","status","reportError","maxEntityChangeIdStr","max","handleSuccessfulResponse","arg","statusCode","response","toastService","requestUrl","showErrorTitleAndMessage","throwError","getWithSilentNotFound","post","put","patch","upload","fileToUpload","getMaxKnownEntityChangeId","keyboardShortcut","bindElShortcut","normalizeShortcut","eventName","off","bind","removeGlobalShortcut","SpacedUpdate","updater","updateInterval","lastUpdated","changed","changeForbidden","triggerUpdate","isAllSavedAndTriggerUpdate","$toast","delay","autohide","showAndLogError","showPersistent","closePersistent","resolveNotePathToSegments","logErrors","effectivePathSegments","pathToRoot","getNoteIdFromUrl","urlOrNotePath","segments","getNoteIdAndParentIdFromUrl","getNoteTitle","getNotePathTitleComponents","titleComponents","show","resolveNotePath","runPath","getParentProtectedStatus","getNotePath","getBranchIdFromUrl","getNotePathTitle","getNoteTitleWithPathAsSuffix","$titleWithPath","isNotePathInHiddenSubtree","padNum","num","getFullYear","getMonth","getDate","isElectron","isMac","navigator","entityMap","closeActiveDialog","activeDialog","modal","$lastFocusedElement","saveFocusedElement","focusSavedElement","editor","editing","view","dynamicRequire","wikiBaseUrl","openHelp","helpPage","initHelpButtons","ATTR_NAME_MATCHER","RegExp","reloadFrontendApp","reason","reload","str","formatDateTime","formatDate","getHours","getMinutes","formatTime","formatTimeInterval","ms","seconds","minutes","hours","days","plural","size","localNowDateTime","getSeconds","isCtrlKey","metaKey","assertArguments","arguments","escapeHtml","s","toObject","array","fn","len","possible","device","userAgent","isDesktop","setCookie","expires","toUTCString","getNoteTypeClass","getMimeTypeClass","semicolonIdx","openDialog","$dialog","closeActDialog","isHtmlEmpty","clearBrowserCache","session","clearCache","copySelectionToClipboard","getSelection","writeText","timeLimit","limitMs","errorMessage","resolved","initHelpDropdown","$dropdownMenu","filterAttributeName","isValidAttributeName","sleep","time_ms","escapeRegExp","areObjectsEqual","leftChain","rightChain","compare2Objects","isNaN","String","isPrototypeOf","hasOwnProperty","copyHtmlToClipboard","clipboardItem","ClipboardItem","Blob","write","createImageSrcUrl","LoadResults","entityChanges","entities","entityName","noteIdToComponentId","componentIdToNoteIds","noteReorderings","revisionRows","contentNoteIdToComponentId","optionNames","addNote","addBranch","getBranchRows","addNoteReordering","getNoteReorderings","addAttribute","addRevision","hasRevisionForNote","getNoteIds","componentIds","sId","addNoteContent","isNoteContentReloaded","addOption","isOptionReloaded","getOptionNames","addAttachmentRow","getAttachmentRows","hasAttributeRelatedChanges","isEmptyForTree","processNoteChange","ec","isErased","processBranchChange","processNoteReordering","parentNoteIdsToSort","positions","processAttributeChange","sourceNote","processAttachment","processEntityChanges","messageHandlers","lastPingTs","lastAcceptedEntityChangeId","maxEntityChangeIdAtLoad","lastAcceptedEntityChangeSyncId","maxEntityChangeSyncIdAtLoad","lastProcessedEntityChangeId","frontendUpdateDataQueue","readyState","consumeQueuePromise","processedEntityChangeIds","handleMessage","messageHandler","filteredRows","logRows","entityChange","isSynced","sendPing","allEntityChanges","nonProcessedEntityChanges","entityChangeIdReachedListeners","desiredEntityChangeId","resolvePromise","start","consumeFrontendUpdateData","executeFrontendUpdate","connectWebSocket","loc","webSocketUri","WebSocket","onopen","onmessage","OPEN","lastEntityChangeId","CLOSED","CLOSING","setInterval","subscribeToMessages","waitForMaxKnownEntityChangeId","getMaxKnownEntityChangeSyncId","webpackEmptyContext","req","code","module","style","classes","childPositionCounter","contentSized","collapsible","filling","cssBlock","block","cssEl","doRender","isEnabled","toggleInt","toggleClass","isHiddenInt","toggleExt","isHiddenExt","canBeShown","getPosition","getClosestNtxId","cleanup","isNoteContext","isActiveNoteContext","isNote","refreshWithNote","noteSwitched","refresh","activeContextChanged","setNoteContextEvent","widgetTitle","widgetButtons","help","$bodyWrapper","$body","$title","$buttons","buttonWidget","doRenderBody","__webpack_module_cache__","inProgress","dataWebpackPrefix","__webpack_require__","moduleId","cachedModule","__webpack_modules__","m","d","definition","o","defineProperty","enumerable","f","chunkId","reduce","u","done","needAttach","scripts","getElementsByTagName","createElement","charset","setAttribute","src","onScriptComplete","prev","onerror","onload","clearTimeout","doneFns","parentNode","removeChild","head","appendChild","r","Symbol","toStringTag","installedChunks","j","installedChunkData","errorType","realSrc","request","webpackJsonpCallback","parentChunkLoadingFunction","chunkIds","moreModules","runtime","chunkLoadingGlobal","global","SELECTED_NOTE_PATH_KEY","autocompleteSource","term","activeNoteId","allowCreatingNotes","noteTitle","highlightedNotePathTitle","concat","allowExternalLinks","externalLink","clearText","setSelectedNotePath","showRecentNotes","Event","autocompleteSourceForCKEditor","queryText","rows","notePathTitle","link","initNoteAutocomplete","$clearTextButton","$showRecentNotesButton","$goToSelectedNoteButton","$sideButtons","hideGoToSelectedNoteButton","after","autocompleteOptions","dropdownMenuContainer","appendTo","querySelector","hint","autoselect","openOnFocus","minLength","tabAutocomplete","source","displayKey","templates","suggestion","setSelectedExternalLink","setText","init","getSelectedNotePath","getSelectedNoteId","getSelectedExternalLink","cmd","execCommand","remote","editFlags","hasText","selectionText","platformModifier","misspelledWord","dictionarySuggestions","spellingSuggestion","addWordToSpellCheckerDictionary","isEditable","canCut","canCopy","linkURL","mediaType","bookmark","linkText","canPaste","paste","pasteAndMatchStyle","shortenedSelection","customSearchEngineName","customSearchEngineUrl","searchEngineName","searchEngineUrl","searchUrl","openExternal","zoomLevel","insertText","Container","renderChildren","FlexContainer","direction","UpdateAvailableWidget","updateVersionStatus","latestVersion","triliumVersion","GlobalMenuWidget","updateAvailableWidget","$dropdown","dropdown","$updateToLatestVersionButton","$zoomState","updateZoomState","zoomPercent","fetchLatestVersion","fetch","json","tag_name","substring","downloadLatestVersionCommand","addLabel","setLabel","removeAttributeById","isAffecting","attrRow","affectedNote","attrNote","owningNotes","owningNote","jQueryBridget","n","h","option","isPlainObject","extend","apply","_init","bridget","getSize","_","P","width","padding","borderStyle","borderWidth","boxSizing","isBoxSizeOuter","nodeType","height","innerWidth","innerHeight","E","offsetWidth","offsetHeight","isBorderBox","paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth","g","EvEmitter","_events","once","_onceEvents","splice","emitEvent","allOff","Unipointer","bindStartEvent","_bindStartEvent","unbindStartEvent","PointerEvent","getTouch","identifier","pointerIdentifier","onmousedown","button","_pointerDown","ontouchstart","changedTouches","onpointerdown","isPointerDown","pointerId","pointerDown","_bindPostStartEvents","mousedown","touchstart","pointerdown","_boundPointerEvents","_unbindPostStartEvents","removeEventListener","onmousemove","_pointerMove","onpointermove","ontouchmove","pointerMove","onmouseup","_pointerUp","onpointerup","ontouchend","_pointerDone","pointerUp","_pointerReset","pointerDone","onpointercancel","_pointerCancel","ontouchcancel","pointerCancel","getPointerPoint","Unidragger","bindHandles","_bindHandles","unbindHandles","_touchActionValue","handles","touchAction","okayPointerDown","pointerDownPointer","pointerDownBlur","TEXTAREA","INPUT","SELECT","OPTION","radio","checkbox","submit","image","nodeName","activeElement","blur","_dragPointerMove","_dragMove","isDragging","hasDragStarted","_dragStart","abs","_dragPointerUp","_dragEnd","_staticClick","isPreventingClicks","dragStart","dragMove","dragEnd","onclick","isIgnoringMouseUp","staticClick","Draggabilly","element","$element","defaults","_create","relative","absolute","fixed","_getPosition","startPoint","dragPoint","startPosition","onPointerMove","onPointerUp","enable","setHandles","handle","dispatchEvent","dispatchJQueryEvent","_getPositionCoord","_addTransformPosition","transform","onPointerDown","classList","measureContainment","setLeftTop","animate","getContainer","getBoundingClientRect","relativeStartPosition","containSize","containment","HTMLElement","grid","containDrag","axis","min","positionDrag","requestAnimationFrame","setPosition","disable","destroy","removeData","TabRowWidget","draggabillies","setupStyle","setupEvents","setupDraggabilly","setupNewButton","setupFiller","layoutTabs","setVisibility","$style","ResizeObserver","cleanUpPreviouslyDraggedTabs","observe","tabEls","tabEl","setTabCloseEvent","$tabContainer","tabWidths","numberOfTabs","tabsContainerWidth","marginWidth","targetWidth","clampedTargetWidth","flooredClampedTargetWidth","widths","extraWidthRemaining","extraWidth","$filler","getTabPositions","tabPositions","newTabPosition","fillerPosition","tabContainerWidths","removeAttribute","styleHTML","addTab","$tab","removeClass","$newTab","before","updateTitle","closeActiveTabCommand","activeTabEl","getTabById","newNoteContextCreatedEvent","removeTab","getNtxIdsInOrder","getTabId","noteContextRemovedEvent","draggabillyDragging","originalIndex","originalTabPositionX","draggabilly","finalTranslateX","pointer","moveVector","currentIndex","currentTabPositionX","destinationIndexTarget","destinationIndex","animateTabMove","originIndex","insertBefore","beforeEl","Infinity","closestIndex","noteSwitchedAndActivatedEvent","updateTabById","contextsReopenedEvent","updateTab","clazz","removeAttr","frocaReloadedEvent","TitleBarButtonsWidget","$topBtn","$minimizeBtn","$maximizeBtn","$closeBtn","getFocusedWindow","isAlwaysOnTop","focusedWindow","setAlwaysOnTop","minimize","isMaximized","unmaximize","maximize","close","LeftPaneContainer","entitiesReloadedEvent","visible","MAX_SEARCH_RESULTS_IN_TREE","cancelClickPropagation","NoteTreeWidget","treeName","$tree","$treeActions","refreshSearch","ui","fancytree","getNode","$treeSettingsPopup","$hideArchivedNotesCheckbox","$autoCollapseNoteTree","$treeSettingsButton","hideArchivedNotes","autoCollapseNoteTree","offsetTop","offsetLeft","$saveTreeSettingsButton","setHideArchivedNotes","setAutoCollapseNoteTree","reloadTreeFromCache","initFancyTree","setupNoteTitleTooltip","currentTarget","$sub","conOffset","offset","conDistanceFromTop","conDistanceFromLeft","subOffset","subDistanceFromTop","subDistanceFromLeft","isEnclosing","innerText","treeData","prepareRootNode","titlesTabbable","keyboard","extensions","scrollOfs","bottom","scrollParent","minExpandLevel","click","activityDetected","targetType","isSelected","getSelectedOrActiveNoteIds","shiftKey","activeNode","selectInBetween","first","second","setSelected","getNextSibling","clearSelectedNodes","getIndex","setFocus","altKey","reactivate","setActive","beforeActivate","expand","setExpanded","collapse","mode","autoExpand","dnd5","autoExpandMS","preventLazyParents","dataTransfer","setData","$list","dragEnter","dragDrop","hitMode","safeImport","shrinkImages","textImportedAsText","codeImportedAsCode","explodeArchives","replaceUnderscoresWithSpaces","jsonStr","getData","selectedBranchIds","lazyLoad","prepareChildren","clones","highlightActiveClones","enhanceTitle","$span","span","isHoistedNote","$enterWorkspaceButton","$refreshSearchButton","$createChildNoteButton","$unhoistButton","loadChildren","visit","subNode","isUndefined","select","getHotKeys","hotKeys","LauncherContextMenu","TreeContextMenu","getTree","prepareNode","noteList","extraClasses","getExtraClasses","noEvents","noAnimation","forceLazy","refKey","lazy","expanded","cssClass","colorClass","getSelectedNodes","stopOnParents","nodes","getNodesByNoteId","batchUpdate","filterHoistedBranch","setExpandedStatusForSubtree","collapseTreeEvent","collapseTree","getFocusedNode","getFocusNode","selectedNode","expandToNote","makeVisible","scrollIntoView","noFocus","isLoaded","updateNode","foundChildNode","findChildNode","childNode","getNodeFromPath","getNodesByBranch","getNodesByRef","oldActiveNode","newActiveNode","oldActiveNodeFocused","hasFocus","enableUpdate","autoCollapseTimeoutId","noteIdsToKeepExpanded","noneCollapsedYet","getRootNode","nodeCtx","refreshCtx","noteIdsToUpdate","noteIdsToReload","movedActiveNode","parentsOfAddedNodes","dirtyingLabels","allBranchesDeleted","getPrevSibling","frocaBranch","foundNode","addChildren","activeNotePath","activeNodeFocused","nextNotePath","nextNode","notesById","nodeA","nodeB","branchA","branchB","rootNode","forceUpdate","hoistedNotePath","lastFilteredHoistedNotePath","clearFilter","toggleHiddenNode","filterBranches","hiddenNode","li","hotKeyMap","getSelectedOrActiveBranchIds","canBeMovedUpOrDown","moveNoteUpCommand","beforeNode","moveNoteDownCommand","afterNode","moveNoteUpInHierarchyCommand","moveNoteDownInHierarchyCommand","toNode","addNoteAboveToSelectionCommand","prevSibling","addNoteBelowToSelectionCommand","nextSibling","expandSubtreeCommand","expandTree","collapseSubtreeCommand","selectAllNotesInParentCommand","copyNotesToClipboardCommand","cutNotesToClipboardCommand","pasteNotesFromClipboardCommand","pasteNotesAfterFromClipboardCommand","defaultType","editNoteTitleCommand","protectSubtreeCommand","unprotectSubtreeCommand","duplicateSubtreeCommand","nodesToDuplicate","nodeToDuplicate","moveShortcutToVisibleCommand","moveShortcutToAvailableCommand","addNoteLauncherCommand","createLauncherNote","addScriptLauncherCommand","addWidgetLauncherCommand","addSpacerLauncherCommand","launcherType","NoteTitleWidget","spacedUpdate","$noteTitle","deleteNoteOnEscape","isReadOnly","setProtectedStatus","focusOnTitleEvent","focusAndSelectTitleEvent","attributeType","nameCallback","attributeName","attributeValues","ATTR_TITLES","ATTR_HELP","AttributeDetailWidget","relatedNotesSpacedUpdate","updateRelatedNotes","saveAndClose","cancelAndClose","$inputName","ev","originalEvent","isComposing","userEditedAttribute","attrType","$rowValue","$inputValue","$rowPromoted","$inputPromoted","$rowPromotedAlias","$inputPromotedAlias","$rowMultiplicity","$inputMultiplicity","$rowLabelType","$inputLabelType","$rowNumberPrecision","$inputNumberPrecision","$rowInverseRelation","$inputInverseRelation","$rowTargetNote","$inputTargetNote","dataset","pathChunks","allAttributes","$inputInheritable","$closeAttrDetailButton","$attrIsOwnedBy","$attrSaveDeleteButtonContainer","$saveAndCloseButton","$deleteButton","$attrHelp","$relatedNotesContainer","$relatedNotesTitle","$relatedNotesList","$relatedNotesMoreNotes","isOwned","getAttrType","attrName","updateHelp","detPosition","getDetailPosition","right","updateAttributeInEditor","displayedResults","displayedNotes","buildDefinitionValue","inverseRelationName","lex","quotes","currentWord","isOperatorSymbol","chr","previousOperatorSymbol","finishWord","endIndex","startIndex","checkAttributeName","allowEmptyRelations","context","labelName","relationName","editorConfig","removePlugins","toolbar","placeholder","mention","feeds","marker","feed","itemRenderer","itemElement","innerHTML","minimumCharacters","AttributeEditorWidget","attributeDetailWidget","$editor","initEditor","$addNewAttributeButton","addNewAttribute","$saveAttributesButton","$errors","handleAddNewAttributeCommand","parseAttributes","renderOwnedAttributes","scrollTop","scrollHeight","rect","showAttributeDetail","lastUpdatedNoteId","fadeOut","getPreprocessedData","slideDown","handleEditorClick","BalloonEditor","model","dataChanged","stop","priority","change","writer","getRoot","lastSavedContent","fadeIn","pos","selection","getFirstPosition","textNode","clickIndex","getClickIndex","parsedAttrs","matchedAttr","showHelpTooltip","startOffset","curNode","previousSibling","_attrs","ownedAttributes","saved","htmlAttrs","positionAt","createPositionAt","setSelection","OwnedAttributeListWidget","toggleCommand","attributeEditorWidget","getTitle","replaceWith","updateAttributeList","NoteActionsWidget","refreshVisibility","$convertNoteIntoAttachmentButton","$findInTextButton","$printActiveNoteButton","$showSourceButton","$renderNoteButton","$exportNoteButton","$importNoteButton","$openNoteExternallyButton","$openNoteCustomButton","$deleteNoteButton","toggleDisabled","newAttachment","TypeWidget","getType","getWidgetType","doRefresh","MIME_TYPES_DICT","loadMimeTypes","enabledMimeTypes","mt","getMimeTypes","AbstractTextTypeWidget","setupImageOpening","singleClickOpens","openImageInCurrentTab","openImageInNewTab","parseFromImage","imgSrc","imageNoteMatch","attachmentMatch","$wrapper","loadIncludedNote","$imageWrapper","range","createRange","selectNodeContents","removeAllRanges","addRange","selectImage","uniDirectionalOverlays","foldback","biDirectionalOverlays","inverseRelationsOverlays","linkOverlays","containerCounter","debounce","waitMs","immediate","args","timestamp","later","last","debounced","callNow","clear","flush","esc","NoteMapWidget","widgetMode","documentStyle","themeStyle","$styleResolver","setDimensions","graph","fontFamily","textColor","rgb2hex","mutedTextColor","mapType","ForceGraph","onZoom","setZoomLevel","k","d3AlphaDecay","d3VelocityDecay","nodeCanvasObject","paintNode","getColorForNode","nodePointerAreaPaint","fillStyle","beginPath","arc","noteIdToSizeMap","PI","fill","nodeLabel","maxZoom","warmupTicks","linkDirectionalArrowLength","linkDirectionalArrowRelPos","linkWidth","linkColor","onNodeClick","onNodeRightClick","linkLabel","linkCanvasObject","paintLink","linkCanvasObjectMode","mapRootNoteId","getMapRootNoteId","loadNotesAndRelations","nodeLinkRatio","charge","pow","boundedCharge","d3Force","distance","strength","distanceMax","renderData","generateColorFromString","charCodeAt","rgb","padStart","level","font","textAlign","textBaseline","fillText","translate","deltaX","angle","atan2","moveY","rotate","restore","calculateNodeSizes","getGroupedLinks","sourceNoteId","names","linksGroupedBySourceTarget","noteIdToDescendantCountMap","noteIdToLinkCount","graphData","subGraphNoteIds","getSubGraphConnectedToCurrentNote","zoomToFit","noteIdsWithLinks","getNoteIdsWithLinks","linksBySource","linksByTarget","traverseGraph","OptionsWidget","updateMultipleOptions","showUpdateNotification","$checkbox","isChecked","updateOption","setCheckboxState","optionValue","optionsLoaded","FONT_FAMILIES","globActions","idCtr","SEARCH_ENGINES","BackendLogWidget","$backendLogTextArea","$refreshBackendLog","scrollToBottom","backendLog","CONTENT_WIDGETS","_optionsAppearance","$themeSelect","$overrideThemeFonts","newTheme","updateCheckboxOption","themes","overrideThemeFonts","$mainFontSize","$mainFontFamily","$treeFontSize","$treeFontFamily","$detailFontSize","$detailFontFamily","$monospaceFontSize","$monospaceFontFamily","mainFontSize","fillFontFamilyOptions","mainFontFamily","treeFontSize","treeFontFamily","detailFontSize","detailFontFamily","monospaceFontSize","monospaceFontFamily","optionsToSave","optionName","$select","currentValue","$zoomFactorSelect","$nativeTitleBarSelect","nativeTitleBarVisible","$maxContentWidth","maxContentWidth","$promotedAttributesOpenInRibbon","$editedNotesOpenInRibbon","promotedAttributesOpenInRibbon","editedNotesOpenInRibbon","_optionsShortcuts","$table","$tr","separator","defaultShortcuts","description","$input","toUpperCase","_index","$filter","act","_optionsTextNotes","$headingStyle","newHeadingStyle","toggleBodyClass","headingStyle","$minTocHeadings","minTocHeadings","$hlt","hltVals","highlightsList","inArray","$autoReadonlySizeText","autoReadonlySizeText","_optionsCodeNotes","$vimKeymapEnabled","vimKeymapEnabled","$codeLineWrapEnabled","codeLineWrapEnabled","$autoReadonlySizeCode","autoReadonlySizeCode","$mimeTypes","mimeType","_optionsImages","$imageMaxWidthHeight","$imageJpegQuality","$downloadImagesAutomatically","$enableImageCompression","$imageCompressionWrapper","setImageCompression","imageMaxWidthHeight","imageJpegQuality","downloadImagesAutomatically","compressImages","_optionsSpellcheck","$spellCheckEnabled","$spellCheckLanguageCode","$availableLanguageCodes","availableSpellCheckerLanguages","spellCheckEnabled","spellCheckLanguageCode","_optionsPassword","$passwordHeading","$changePasswordForm","$oldPassword","$newPassword1","$newPassword2","$savePasswordButton","$resetPasswordButton","$protectedSessionTimeout","isPasswordSet","protectedSessionTimeout","oldPassword","newPassword1","newPassword2","_optionsEtapi","tokenName","defaultValue","authToken","refreshTokens","$noTokensYet","$tokensTable","$tokensTableBody","utcDateCreated","renameToken","etapiTokenId","deleteToken","oldName","_optionsBackup","$backupDatabaseButton","backupFile","$dailyBackupEnabled","$weeklyBackupEnabled","$monthlyBackupEnabled","$existingBackupList","dailyBackupEnabled","weeklyBackupEnabled","monthlyBackupEnabled","backupFiles","mtime","_optionsSync","$form","$syncServerHost","$syncServerTimeout","$syncProxy","$testSyncButton","syncServerHost","syncServerTimeout","syncProxy","_optionsOther","$predefinedSearchEngineSelect","$customSearchEngineName","$customSearchEngineUrl","predefinedSearchEngine","$trayEnabled","disableTray","$eraseEntitiesAfterTimeInSeconds","$eraseDeletedNotesButton","eraseEntitiesAfterTimeInSeconds","$eraseUnusedAttachmentsAfterTimeInSeconds","$eraseUnusedAttachmentsNowButton","eraseUnusedAttachmentsAfterSeconds","$revisionsTimeInterval","revisionSnapshotTimeInterval","$checkForUpdates","checkForUpdates","_optionsAdvanced","$checkIntegrityButton","integrity_check","$findAndFixConsistencyIssuesButton","$anonymizeFullButton","$anonymizeLightButton","anonymizedFilePath","$existingAnonymizedDatabases","anonymizedDatabases","$forceFullSyncButton","$fillEntityChangesButton","$vacuumDatabaseButton","_backendLog","AttachmentActionsWidget","isFullDetail","$uploadNewRevisionInput","uploaded","copyAttachmentLinkToClipboard","newNote","attachmentTitle","AttachmentDetailWidget","attachmentActionsWidget","$deletionWarning","scheduledSinceTimestamp","getTime","willBeDeletedInMs","typeWidgetClasses","$autoComplete","$workspaceNotes","workspaceNotes","workspaceNote","codeBlockLanguages","language","watchdog","EditorWatchdog","minimumNonErrorTimePeriod","crashNumberLimit","saveInterval","currentState","state","crashes","crashInfo","enableReadOnlyMode","setCreator","elementOrData","codeBlock","languages","math","engine","outputType","forceOutputType","enablePreview","scrollToEnd","getEditor","insertDateTimeToTextCommand","dateString","addTextToEditor","linkHref","insertPosition","getLastPosition","addTextToActiveEditorEvent","hasSelection","execute","addLinkToEditor","isCollapsed","addLinkToTextCommand","selectedText","getSelectedText","textTypeWidget","getFirstRange","getItems","selectedElement","getSelectedElement","selectedLinkUrl","addIncludeNoteToTextCommand","addIncludeNote","boxSize","insertContent","CodeMirror","keyMap","modeURL","codeEditor","viewportMargin","indentUnit","matchBrackets","matchTags","bothTags","highlightSelectionMatches","showToken","annotateScrollbar","lint","gutters","lineNumbers","tabindex","lineWrapping","setValue","clearHistory","findModeByMIME","setOption","autoLoadMode","getValue","setCursor","lineCount","indent","pre","tag","$previewContent","$previewNotAvailable","$imageView","copyImageAt","copyImageReferenceToClipboardEvent","$noteDetailRenderHelp","$noteDetailRenderContent","renderActiveNoteEvent","$relationMapContainer","mapData","jsPlumbInstance","pzInstance","$relationMapWrapper","getMousePosition","createNoteBox","saveData","contextMenuHandler","dropNoteOntoRelationMapHandler","jsPlumb","ready","originalTarget","$noteBox","idToNoteId","noteIdToId","isDeleteNoteChecked","scale","loadMapData","initJsPlumbInstance","initPanZoom","clearMap","deleteEveryEndpoint","relationMapNoteId","inverseRelations","noteTitles","batch","connection","connect","getOverlay","canvas","panzoom","minZoom","smoothScroll","filterKey","dx","dy","dz","setZoom","getZoom","saveCurrentTransform","zoomTo","moveTo","newTransform","getTransform","dispose","getInstance","Endpoint","radius","Connector","ConnectionOverlays","HoverPaintStyle","stroke","strokeWidth","registerConnectionType","anchor","connector","overlays","connectionCreatedHandler","deleteConnection","shown","$answer","draggable","drag","finalPos","makeSource","connectorStyle","connectionType","extract","makeTarget","dropOptions","hoverClass","allowLoopback","matches","clientX","clientY","relationMapResetPanZoomEvent","relationMapResetZoomInEvent","relationMapResetZoomOutEvent","SCENE_VERSION_INITIAL","SCENE_VERSION_ERROR","DEBOUNCE_TIME_ONCHANGEHANDLER","EXCALIDRAW_ASSET_PATH","origin","currentSceneVersion","excalidrawRef","$render","reactHandlers","createExcalidrawReactApp","onChangeHandler","isNewSceneVersion","libraryChanged","React","ReactDOM","renderElement","unmountComponentAtNode","elements","appState","boundingClientRect","excalidrawWrapperRef","sceneData","collaborators","fileArray","fileId","updateScene","addFiles","getAttachmentsByRole","blobs","libraryItems","updateLibrary","merge","getSceneVersion","getSceneElements","getAppState","getFiles","svgString","ExcalidrawLib","exportToSvg","exportPadding","metadata","activeFiles","version","scrollX","scrollY","libraryItem","dataSaved","isNotInitialScene","updateSceneVersion","Excalidraw","useRef","dimensions","useState","useEffect","onResize","onLinkOpen","useCallback","nativeEvent","detail","Fragment","ref","langCode","onPaste","onLibraryChange","onChange","viewModeEnabled","zenModeEnabled","gridModeEnabled","isCollaborating","detectScroll","handleKeyboardGlobally","autoFocus","UIOptions","saveToActiveFile","saveAsImage","sceneVersion","$passwordForm","$passwordInput","$helpNoChildren","noteMapWidget","$noteDetailWebViewHelp","$noteDetailWebViewContent","webViewSrc","docName","appPath","contentWidgets","$linksWrapper","$helpButton","attachmentDetailWidget","noteLink","renderedAttachmentIds","NoteDetailWidget","typeWidgets","getTypeWidget","typeWidget","checkFullHeight","$promotedAttributes","printThis","footer","importCSS","loadCSS","readOnlyTemporarilyDisabledEvent","RibbonContainer","ribbonWidgets","buttonWidgets","ribbon","$buttonContainer","$bodyContainer","ribbonWidget","$ribbonTitle","toggleRibbonTab","refreshActiveTab","ribbonComponendId","wasAlreadyActive","lastActiveComponentId","activeChild","getActiveRibbonWidget","handleEventPromise","noExplicitActivation","$ribbonTabToActivate","$lastActiveRibbon","lastNoteType","toggleCommandName","isRibbonTabActive","ensureOwnedAttributesAreOpen","toggleRibbonTabWithName","addNewLabelEvent","addNewRelationEvent","$ribbonComponent","componentName","PREFIX","activeRibbonWidget","ch","PromotedAttributesWidget","promotedDefAttrs","$cells","definitionAttr","valueType","valueName","valueAttrs","valueAttr","$cell","createPromotedAttributeCell","promotedAttributeChanged","$actionCell","$multiplicityCell","step","$addButton","$new","$removeButton","sameAttrSelector","selectedPath","InheritedAttributesWidget","inheritedAttributes","getInheritedAttributes","$noteList","includedNoteIds","getIncludedNoteIds","page","pageSize","viewType","includedLinks","highlightRegex","startIdx","endIdx","pageNoteIds","pageNotes","$card","renderNote","renderPager","$pager","pageCount","ceil","lastPrinted","renderList","$expander","toggleContent","markRegExp","separateWordSearch","caseSensitive","renderNoteContent","imageLinks","getChildNotes","NoteListWidget","observer","IntersectionObserver","entries","isIntersecting","checkRenderStatus","rootMargin","threshold","noteIdRefreshed","shownNoteId","renderNoteList","noteListRenderer","noteDetailRefreshedEvent","notesReloadedEvent","AbstractSearchOption","$rendered","deleteOption","deleteAttribute","AbstractBulkAction","actionDef","deleteAction","actionObject","MoveNoteBulkAction","actionTitle","$action","$targetParentNote","targetParentNoteId","saveAction","DeleteNoteBulkAction","DeleteRevisionsBulkAction","DeleteLabelBulkAction","$labelName","DeleteRelationBulkAction","$relationName","RenameLabelBulkAction","$oldLabelName","oldLabelName","$newLabelName","newLabelName","RenameRelationBulkAction","$oldRelationName","oldRelationName","$newRelationName","newRelationName","UpdateLabelValueBulkAction","$labelValue","labelValue","UpdateRelationTargetBulkAction","$targetNote","ExecuteScriptBulkAction","$script","AddLabelBulkAction","AddRelationBulkAction","RenameNoteBulkAction","$newTitle","ACTION_CLASSES","actionAttr","ActionClass","actionClass","OPTION_CLASSES","$option","$searchString","showSearchErrorEvent","focusOnSearchDefinitionEvent","$searchScript","searchScriptNoteId","$ancestor","$ancestorDepth","ancestorDepth","$orderBy","orderBy","$orderDirection","orderDirection","$limit","limit","SearchDefinitionWidget","$component","$actionList","actionGroup","searchOptionName","SearchOptionClass","$searchOptions","$actionOptions","$searchButton","$searchAndExecuteButton","searchAndExecute","$saveToNoteButton","searchNoteId","OptionClass","searchOption","SqlResultWidget","$resultContainer","$noRowsAlert","$row","SqlTableSchemasWidget","$sqlConsoleTableSchemas","tableSchemasShown","tableSchema","table","$tableLink","column","columns","FilePropertiesWidget","$fileNoteId","$fileName","$fileType","$fileSize","$uploadNewRevisionButton","ImagePropertiesWidget","$copyReferenceToClipboardButton","$imageDownloadButton","NotePropertiesWidget","$pageUrl","pageUrl","NoteIconWidget","$iconList","$iconCategory","renderDropdown","$iconSearch","$notePathList","categories","category","iconToCount","getIconToCountMap","icons","getIconLabels","categoryId","filteredIcons","category_id","countA","renderIcon","iconToCountCache","iconClassToCountMap","SearchResultWidget","$noResults","$notExecutedYet","searchRefreshedEvent","ScrollingContainer","scrollContainerToCommand","RootContainer","fileModificationStatus","lastModifiedMs","WatchedFileUpdateStatusWidget","getEntity","$filePath","$fileLastModified","$fileUploadButton","$ignoreThisChangeButton","unix","openedFileUpdatedEvent","SpacerWidget","baseSize","growthFactor","QuickSearchWidget","$dropdownToggle","keydown","displayedNoteIds","$showInFullButton","showInFullSearch","quickSearchEvent","SplitNoteContainer","widgetFactory","widgets","insertAfter","closeThisNoteSplitCommand","isMovingLeft","leftIndex","newNtxIds","isChangingMainContext","activeMainContext","hasBeenAlreadyShown","refreshNotShown","subContext","leftInstance","rightInstance","leftPaneVisible","leftPaneWidth","Split","sizes","gutterSize","onDragEnd","rightPaneVisible","rightPaneWidth","AbstractButtonWidget","settings","titlePlacement","onContextMenu","refreshIcon","initialRenderCompleteEvent","as","CommandButtonWidget","_command","onClick","LeftPaneToggleWidget","OnClickButtonWidget","onAuxClick","CreatePaneButton","ClosePaneButton","NOTE_TYPES","selectable","NOT_SELECTABLE_NOTE_TYPES","nt","NoteTypeWidget","$noteTypeDropdown","$noteTypeButton","$noteTypeDesc","findTypeTitle","$typeLink","$mimeLink","found","confirmChangeIfContent","SwitchWidget","$switchOn","$switchOnName","$switchOnButton","$switchOff","$switchOffName","$switchOffButton","switchOn","switchOff","ProtectedNoteSwitchWidget","EditabilitySelectWidget","$editabilityActiveDesc","editability","ownedAttr","BookmarkSwitchWidget","isBookmarked","ignoreNotConfigured","errorCode","SharedSwitchWidget","sync","shareBranch","canBeUnshared","switchDisabled","BasicPropertiesWidget","noteTypeWidget","protectedNoteSwitchWidget","editabilitySelectWidget","bookmarkSwitchWidget","sharedSwitchWidget","NoteInfoWidget","$noteId","$dateCreated","$dateModified","$type","$mime","$noteSizesWrapper","$noteSize","$subTreeSize","$calculateButton","noteSizeResp","noteSize","subTreeResp","subTreeNoteCount","subTreeSize","dateCreated","BookPropertiesWidget","$viewTypeSelect","toggleViewType","$expandChildrenButton","$collapseAllButton","expandedAttr","NoteMapRibbonWidget","openState","$openFullButton","setFullHeight","$collapseButton","setSmallSize","NotePathsWidget","$notePathIntro","getRenderedPath","sortedNotePaths","renderedPaths","notePathRecord","SimilarNotesWidget","$similarNotesWrapper","similarNotes","similarNote","score","rendered","RightPaneContainer","reEvaluateRightPaneVisibilityCommand","oldToggle","newToggle","EditButton","wasVisible","EditedNotesWidget","$noneFound","editedNotes","editedNote","MermaidWidget","$display","$errorContainer","$errorMessage","flow","useMaxWidth","sequence","gantt","pie","journey","git","wheelZoomLoaded","renderSvg","dirtyAttachment","filename","NoteWrapperWidget","BacklinksWidget","$count","$items","$ticker","renderBacklinks","clearItems","backlinks","bl","backlink","excerpts","SharedInfoWidget","$sharedLink","$sharedText","shareId","getShareId","FindInText","searchTerm","matchCase","wholeWord","findResult","totalFound","currentFound","findAndReplaceEditing","plugins","cursorPos","getStart","compareWith","nextFound","getRange","scrollToTheSelection","FIND_RESULT_SELECTED_CSS_CLASSNAME","FIND_RESULT_CSS_CLASSNAME","FindInCode","doc","operation","wholeWordChar","re","curLine","curChar","curMatch","fromPos","toPos","markText","getCursor","to","FindInHtml","$results","getContentElement","regExp","unmark","jumpTo","$current","eq","FindWidget","textHandler","codeHandler","htmlHandler","closeSearch","$findBox","$currentFound","$totalFound","$caseSensitiveCheckbox","performFind","$matchWordsCheckbox","$previousButton","findNext","$nextButton","$closeButton","startSearch","getHandler","timeoutId","findBoxClosed","TocWidget","tocTemporarilyHidden","$toc","tocPreviousVisible","tocLabel","headingCount","getToc","headingTagsRegex","curLevel","$ols","headingIndex","newLevel","levelDelta","$ol","headingText","$li","jumpToHeading","pullLeft","$first","sourceElement","headingElement","behavior","HighlightsListWidget","highlightsListTemporarilyHidden","$highlightsList","highlightsListPreviousVisible","optionsHighlightsList","hlLiCount","getNoteComplement","getHighlightList","findSubStr","combinedRegexStr","combinedRegex","prevEndIndex","hltIndex","subHtml","lastIndex","jumpToHighlightsList","itemIndex","targetElement","domRoots","next","BulkActionsDialog","$includeDescendants","$affectedNoteCount","$availableActionList","$existingActionList","$executeButton","includeDescendants","renderAvailableActions","affectedNoteCount","bulkActionNote","$actionGroupList","$actionGroup","AboutDialog","$appVersion","$dbVersion","$syncVersion","$buildDate","$buildRevision","$dataDirectory","appInfo","appVersion","dbVersion","syncVersion","buildDate","buildRevision","dataDirectory","HelpDialog","showHelpEvent","RecentChangesDialog","$eraseDeletedNotesNow","recentChangesRows","groupedByDate","groupByDate","dateDay","dayChanges","$changesList","dayEl","formattedTime","current_isDeleted","current_title","canBeUndeleted","$undeleteLink","Map","BranchPrefixDialog","$treePrefixInput","savePrefix","SortChildNotesDialog","sortBy","sortDirection","foldersFirst","sortNatural","sortLocale","PasswordNoteSetDialog","$openPasswordOptionsButton","showPasswordNotSetEvent","IncludeNoteDialog","includeNote","addImage","NoteTypeChooserDialog","$originalFocused","$originalDialog","$noteTypeDropdownTrigger","doResolve","clickEvent","noteTypes","JumpToNoteDialog","lastOpenedTs","$showInFullTextButton","showInFullText","KEEP_LAST_SEARCH_FOR_X_SECONDS","AddLinkDialog","$linkTitle","$addLinkTitleSettings","$addLinkTitleRadios","$addLinkTitleFormGroup","getLinkType","addLink","updateTitleSettingsVisibility","setDefaultLinkTitle","linkType","CloneToDialog","clonedNoteIds","$noteAutoComplete","$clonePrefix","cloneNotesTo","cloneNoteId","clonedNote","MoveToDialog","movedBranchIds","moveNotesTo","parentBranch","ImportDialog","$fileUploadInput","$importButton","$safeImportCheckbox","$shrinkImagesCheckbox","$textImportedAsTextCheckbox","$codeImportedAsCodeCheckbox","$explodeArchivesCheckbox","$replaceUnderscoresWithSpacesCheckbox","importIntoNote","boolToString","ExportDialog","$subtreeFormats","$singleFormats","$subtreeType","$singleType","$exportButton","$opmlVersions","exportType","exportFormat","exportVersion","exportBranch","slideUp","MarkdownImportDialog","$importTextarea","sendForm","markdownContent","htmlContent","viewFragment","processor","toView","modelFragment","toModel","importMarkdownInlineEvent","readText","convertMarkdownToHtml","ProtectedSessionPasswordDialog","showProtectedSessionPasswordDialogEvent","closeProtectedSessionPasswordDialogEvent","RevisionsDialog","revisionItems","$listDropdown","$titleButtons","$eraseAllRevisionsButton","setContentPane","loadRevisions","dateLastEdited","revisionItem","renderContentButtons","renderContent","$restoreRevisionButton","$eraseRevisionButton","fullRevision","DeleteNotesDialog","$okButton","$cancelButton","$deleteNotesList","$brokenRelationsList","$deletedNotesCount","$noNoteToDeleteWrapper","$deleteNotesListWrapper","$brokenRelationsListWrapper","$brokenRelationsCount","$deleteAllClones","$eraseNotes","isDeleteAllClonesChecked","isEraseNotesChecked","renderDeletePreview","noteIdsToBeDeleted","brokenRelations","br","InfoDialog","$originallyFocused","$infoContent","showInfoDialogEvent","DELETE_NOTE_BUTTON_CLASS","ConfirmDialog","$confirmContent","$custom","showConfirmDialogEvent","showConfirmDeleteNoteBoxWithNoteDialogEvent","PromptDialog","shownCb","$dialogBody","$question","showPromptDialogEvent","FloatingButtons","$children","hideFloatingButtonsCommand","RelationMapButtons","$createChildNote","$zoomInButton","$zoomOutButton","$resetPanZoomButton","MermaidExportButton","RightDropdownButtonWidget","iconClass","dropdownTpl","dropdownShown","pixelsToBottom","$dropdownContent","hideDropdown","CalendarWidget","$month","$next","$previous","$label","setMonth","createMonth","activeDate","todaysDate","setDate","createDay","dateNotesForMonth","day","$newDay","$date","dateNoteId","isEqual","currentMonth","$day","getDay","monthsAsString","monthIndex","OpenNoteButtonWidget","noteToOpen","launch","BookmarkFolderWidget","$parentNote","$childrenNotes","linkOptions","BookmarkButtons","bookmarkParentNote","ProtectedSessionStatusWidget","protectedSessionStartedEvent","SyncStatusWidget","syncState","allChangesPushed","processMessage","showIcon","lastSyncedPush","AbstractLauncher","launcherNote","NoteLauncher","getTargetNoteId","ScriptLauncher","executeScript","getRelationTarget","TodayLauncher","ButtonFromNoteWidget","buttonNoteIdProvider","provider","updateIcon","buttonNoteId","buttonNote","HistoryNavigationButton","showContextMenu","activeNoteChangedEvent","LauncherWidget","innerWidget","TRILIUM_SAFE_MODE","initCommandLauncherWidget","initCustomWidget","initBuiltinWidget","builtinWidget","LauncherContainer","visibleLaunchersRoot","newChildren","launcherWidget","initLauncher","RevisionsButton","CodeButtonsWidget","$openTriliumApiDocsButton","sqlConsoleNoteId","ApiLogWidget","$logContainer","apiLogMessagesEvent","HideFloatingButtonsButton","ScriptExecutorWidget","isTriliumSqlite","$executeDescription","executeTitle","executeDescription","MovePaneButton","nextContext","UploadAttachmentsDialog","$uploadButton","uploadAttachments","CopyImageReferenceButton","$hiddenImageCopy","ScrollPaddingWidget","$scrollingContainer","refreshHeight","containerHeight","DesktopLayout","customWidgets","noteTreeWidget","treeCache","importMarkdownInline","SEARCH_HELP_TEXT","msg","lineNo","columnNo","appCssNoteId","appCssNoteIds","widgetBundles"],"sourceRoot":""}