"use strict";(global.webpackChunktrilium=global.webpackChunktrilium||[]).push([[494],{1494:(e,t,o)=>{o.r(t),o.d(t,{default:()=>p});var a=o(8481),n=o(1412),d=o(1035),i=o(8181),c=o(1801),l=o(2817),b=o(4733),m=o(1736),s=o(6885),r=o(3152);class p{constructor(e,t){this.treeWidget=e,this.node=t}async show(e){c.Z.show({x:e.pageX,y:e.pageY,items:await this.getMenuItems(),selectMenuItemHandler:(e,t)=>this.selectMenuItemHandler(e)})}async getMenuItems(){const e=await n.default.getNote(this.node.data.noteId),t=n.default.getBranch(this.node.data.branchId),o="root"!==e.noteId,a=e.noteId===l.default.tabManager.getActiveContext().hoistedNoteId,i=o?await n.default.getNote(t.parentNoteId):null,c=this.treeWidget.getSelectedNodes(),m=0===c.length||1===c.length&&c[0]===this.node,s="search"!==e.type,r=!i||"search"!==i.type,p=o&&!a&&r;return[{title:"在新标签打开<kbd>CTRL+鼠标左键</kbd>",command:"openInTab",uiIcon:"bx bx-empty",enabled:m},{title:"在新的拆分中打开",command:"openNoteInSplit",uiIcon:"bx bx-dock-right",enabled:m},{title:'在后面插入<kbd data-command="createNoteAfter"></kbd>',command:"insertNoteAfter",uiIcon:"bx bx-plus",items:p?await b.Z.getNoteTypeItems("insertNoteAfter"):null,enabled:p&&m},{title:'插入子笔记<kbd data-command="createNoteInto"></kbd>',command:"insertChildNote",uiIcon:"bx bx-plus",items:s?await b.Z.getNoteTypeItems("insertChildNote"):null,enabled:s&&m},{title:'删除<kbd data-command="deleteNotes"></kbd>',command:"deleteNotes",uiIcon:"bx bx-trash",enabled:o&&!a&&r},{title:"----"},{title:'在子树搜索<kbd data-command="searchInSubtree"></kbd>',command:"searchInSubtree",uiIcon:"bx bx-search",enabled:s&&m},a?null:{title:'提升笔记<kbd data-command="toggleNoteHoisting"></kbd>',command:"toggleNoteHoisting",uiIcon:"bx bx-empty",enabled:m&&s},a&&o?{title:'取消提升笔记<kbd data-command="toggleNoteHoisting"></kbd>',command:"toggleNoteHoisting",uiIcon:"bx bx-door-open"}:null,{title:'编辑分支前缀<kbd data-command="editBranchPrefix"></kbd>',command:"editBranchPrefix",uiIcon:"bx bx-empty",enabled:o&&r&&m},{title:"高级",uiIcon:"bx bx-empty",enabled:!0,items:[{title:'展开子树<kbd data-command="expandSubtree"></kbd>',command:"expandSubtree",uiIcon:"bx bx-expand",enabled:m},{title:'收起子树<kbd data-command="collapseSubtree"></kbd>',command:"collapseSubtree",uiIcon:"bx bx-collapse",enabled:m},{title:'排序<kbd data-command="sortChildNotes"></kbd>',command:"sortChildNotes",uiIcon:"bx bx-empty",enabled:m&&s},{title:"子树最近的修改",command:"recentChangesInSubtree",uiIcon:"bx bx-history",enabled:m},{title:"转换为附件",command:"convertNoteToAttachment",uiIcon:"bx bx-empty",enabled:o&&!a},{title:"复制笔记路径到剪贴板",command:"copyNotePathToClipboard",uiIcon:"bx bx-empty",enabled:!0}]},{title:"----"},{title:"保护子树",command:"protectSubtree",uiIcon:"bx bx-check-shield",enabled:m},{title:"取消保护子树",command:"unprotectSubtree",uiIcon:"bx bx-shield",enabled:m},{title:"----"},{title:'复制/克隆<kbd data-command="copyNotesToClipboard"></kbd>',command:"copyNotesToClipboard",uiIcon:"bx bx-copy",enabled:o&&!a},{title:'克隆到...<kbd data-command="cloneNotesTo"></kbd>',command:"cloneNotesTo",uiIcon:"bx bx-empty",enabled:o&&!a},{title:'剪切<kbd data-command="cutNotesToClipboard"></kbd>',command:"cutNotesToClipboard",uiIcon:"bx bx-cut",enabled:o&&!a&&r},{title:'移动到...<kbd data-command="moveNotesTo"></kbd>',command:"moveNotesTo",uiIcon:"bx bx-empty",enabled:o&&!a&&r},{title:'粘贴<kbd data-command="pasteNotesFromClipboard"></kbd>',command:"pasteNotesFromClipboard",uiIcon:"bx bx-paste",enabled:!d.Z.isClipboardEmpty()&&s&&m},{title:"在后面粘贴",command:"pasteNotesAfterFromClipboard",uiIcon:"bx bx-paste",enabled:!d.Z.isClipboardEmpty()&&o&&!a&&r&&m},{title:'创建子树副本 <kbd data-command="duplicateSubtree">',command:"duplicateSubtree",uiIcon:"bx bx-empty",enabled:r&&o&&!a},{title:"----"},{title:"导出",command:"exportNote",uiIcon:"bx bx-empty",enabled:s&&m},{title:"导入到笔记",command:"importIntoNote",uiIcon:"bx bx-empty",enabled:s&&m},{title:"应用批量动作",command:"openBulkActionsDialog",uiIcon:"bx bx-list-plus",enabled:!0}].filter((e=>null!==e))}async selectMenuItemHandler({command:e,type:t,templateNoteId:o}){const d=a.Z.getNotePath(this.node);if("openInTab"===e)l.default.tabManager.openTabWithNoteWithHoisting(d);else if("insertNoteAfter"===e){const e=a.Z.getNotePath(this.node.getParent()),n=a.Z.getParentProtectedStatus(this.node);i.Z.createNote(e,{target:"after",targetBranchId:this.node.data.branchId,type:t,isProtected:n,templateNoteId:o})}else if("insertChildNote"===e){const e=a.Z.getNotePath(this.node);i.Z.createNote(e,{type:t,isProtected:this.node.data.isProtected,templateNoteId:o})}else if("openNoteInSplit"===e){const e=l.default.tabManager.getActiveContext().getSubContexts(),{ntxId:t}=e[e.length-1];this.treeWidget.triggerCommand("openNewNoteSplit",{ntxId:t,notePath:d})}else if("convertNoteToAttachment"===e){if(!await r.Z.confirm("您确定要将所选的笔记转换为其父笔记的附件吗?"))return;let e=0;for(const t of this.treeWidget.getSelectedOrActiveNoteIds(this.node)){const o=await n.default.getNote(t);if(o.isEligibleForConversionToAttachment()){const{attachment:t}=await m.Z.post(`notes/${o.noteId}/convert-to-attachment`);t&&e++}}s.default.showMessage(`${e} 个笔记已被转换为附件.`)}else"copyNotePathToClipboard"===e?navigator.clipboard.writeText("#"+d):this.treeWidget.triggerCommand(e,{node:this.node,notePath:d,noteId:this.node.data.noteId,selectedOrActiveBranchIds:this.treeWidget.getSelectedOrActiveBranchIds(this.node),selectedOrActiveNoteIds:this.treeWidget.getSelectedOrActiveNoteIds(this.node)})}}},4733:(e,t,o)=>{o.d(t,{Z:()=>d});var a=o(1736),n=o(1412);const d={getNoteTypeItems:async function(e){const t=[{title:"文本",command:e,type:"text",uiIcon:"bx bx-note"},{title:"代码",command:e,type:"code",uiIcon:"bx bx-code"},{title:"保存的搜索",command:e,type:"search",uiIcon:"bx bx-file-find"},{title:"关系图",command:e,type:"relationMap",uiIcon:"bx bx-map-alt"},{title:"笔记地图",command:e,type:"noteMap",uiIcon:"bx bx-map-alt"},{title:"渲染笔记",command:e,type:"render",uiIcon:"bx bx-extension"},{title:"书",command:e,type:"book",uiIcon:"bx bx-book"},{title:"美人鱼图",command:e,type:"mermaid",uiIcon:"bx bx-selection"},{title:"画布",command:e,type:"canvas",uiIcon:"bx bx-pen"},{title:"网页视图",command:e,type:"webView",uiIcon:"bx bx-globe-alt"}],o=await a.Z.get("search-templates"),d=await n.default.getNotes(o);if(d.length>0){t.push({title:"----"});for(const o of d)t.push({title:o.title,uiIcon:o.getIcon(),command:e,type:o.type,templateNoteId:o.noteId})}return t}}}}]);
//# sourceMappingURL=494.js.map