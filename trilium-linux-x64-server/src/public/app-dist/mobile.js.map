{"version":3,"file":"mobile.js","mappings":"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","sources":["webpack://trilium/./src/public/app/components/root_command_executor.js","webpack://trilium/./src/public/app/components/entrypoints.js","webpack://trilium/./src/public/app/components/note_context.js","webpack://trilium/./src/public/app/utils/mutex.js","webpack://trilium/./src/public/app/components/tab_manager.js","webpack://trilium/./src/public/app/components/mobile_screen_switcher.js","webpack://trilium/./src/public/app/components/main_tree_executors.js","webpack://trilium/./src/public/app/components/shortcut_component.js","webpack://trilium/./src/public/app/components/app_context.js","webpack://trilium/./src/public/app/components/component.js","webpack://trilium/./src/public/app/components/zoom.js","webpack://trilium/./src/public/app/entities/fattachment.js","webpack://trilium/./src/public/app/entities/fattribute.js","webpack://trilium/./src/public/app/entities/fbranch.js","webpack://trilium/./src/public/app/services/css_class_manager.js","webpack://trilium/./src/public/app/entities/fnote.js","webpack://trilium/./src/public/app/menus/context_menu.js","webpack://trilium/./src/public/app/menus/link_context_menu.js","webpack://trilium/./src/public/app/services/attribute_renderer.js","webpack://trilium/./src/public/app/services/branches.js","webpack://trilium/./src/public/app/services/bundle.js","webpack://trilium/./src/public/app/services/clipboard.js","webpack://trilium/./src/public/app/services/content_renderer.js","webpack://trilium/./src/public/app/services/date_notes.js","webpack://trilium/./src/public/app/services/dialog.js","webpack://trilium/./src/public/app/entities/fblob.js","webpack://trilium/./src/public/app/services/froca.js","webpack://trilium/./src/public/app/services/hoisted_note.js","webpack://trilium/./src/public/app/services/keyboard_actions.js","webpack://trilium/./src/public/app/services/library_loader.js","webpack://trilium/./src/public/app/services/link.js","webpack://trilium/./src/public/app/services/note_attribute_cache.js","webpack://trilium/./src/public/app/services/note_create.js","webpack://trilium/./src/public/app/services/note_tooltip.js","webpack://trilium/./src/public/app/services/open.js","webpack://trilium/./src/public/app/services/options.js","webpack://trilium/./src/public/app/services/promoted_attribute_definition_parser.js","webpack://trilium/./src/public/app/services/protected_session.js","webpack://trilium/./src/public/app/services/protected_session_holder.js","webpack://trilium/./src/public/app/services/render.js","webpack://trilium/./src/public/app/services/frontend_script_api.js","webpack://trilium/./src/public/app/services/script_context.js","webpack://trilium/./src/public/app/services/search.js","webpack://trilium/./src/public/app/services/validation_error.js","webpack://trilium/./src/public/app/services/server.js","webpack://trilium/./src/public/app/services/shortcuts.js","webpack://trilium/./src/public/app/services/spaced_update.js","webpack://trilium/./src/public/app/services/toast.js","webpack://trilium/./src/public/app/services/tree.js","webpack://trilium/./src/public/app/services/utils.js","webpack://trilium/./src/public/app/services/load_results.js","webpack://trilium/./src/public/app/services/froca_updater.js","webpack://trilium/./src/public/app/services/ws.js","webpack://trilium/./src/public/app/services/ sync","webpack://trilium/./src/public/app/widgets/basic_widget.js","webpack://trilium/./src/public/app/widgets/note_context_aware_widget.js","webpack://trilium/./src/public/app/widgets/right_panel_widget.js","webpack://trilium/external node-commonjs \"electron\"","webpack://trilium/webpack/bootstrap","webpack://trilium/webpack/runtime/load script","webpack://trilium/webpack/runtime/define property getters","webpack://trilium/webpack/runtime/ensure chunk","webpack://trilium/webpack/runtime/get javascript chunk filename","webpack://trilium/webpack/runtime/hasOwnProperty shorthand","webpack://trilium/webpack/runtime/make namespace object","webpack://trilium/webpack/runtime/publicPath","webpack://trilium/webpack/runtime/jsonp chunk loading","webpack://trilium/./src/public/app/widgets/containers/container.js","webpack://trilium/./src/public/app/widgets/containers/flex_container.js","webpack://trilium/./src/public/app/widgets/note_title.js","webpack://trilium/./src/public/app/services/attributes.js","webpack://trilium/./src/public/app/services/note_autocomplete.js","webpack://trilium/./src/public/app/widgets/type_widgets/type_widget.js","webpack://trilium/./src/public/app/services/mime_types.js","webpack://trilium/./src/public/app/widgets/type_widgets/abstract_text_type_widget.js","webpack://trilium/./src/public/app/widgets/type_widgets/editable_text.js","webpack://trilium/./src/public/app/services/image.js","webpack://trilium/./src/public/app/services/attribute_autocomplete.js","webpack://trilium/./src/public/app/widgets/type_widgets/relation_map.js","webpack://trilium/./src/public/app/services/debounce.js","webpack://trilium/./src/public/app/widgets/type_widgets/canvas.js","webpack://trilium/./src/public/app/widgets/note_map.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/options_widget.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/appearance/fonts.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/shortcuts.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/code_notes/code_mime_types.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/other/search_engine.js","webpack://trilium/./src/public/app/widgets/type_widgets/content/backend_log.js","webpack://trilium/./src/public/app/widgets/type_widgets/content_widget.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/appearance/theme.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/appearance/zoom_factor.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/appearance/native_title_bar.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/appearance/max_content_width.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/appearance/ribbon.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/text_notes/heading_style.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/text_notes/table_of_contents.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/text_notes/highlights_list.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/text_notes/text_auto_read_only_size.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/code_notes/vim_key_bindings.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/code_notes/wrap_lines.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/code_notes/code_auto_read_only_size.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/images/images.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/spellcheck.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/password.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/etapi.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/backup.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/sync.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/other/tray.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/other/note_erasure_timeout.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/other/attachment_erasure_timeout.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/other/revisions_snapshot_interval.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/other/network_connections.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/advanced/database_integrity_check.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/advanced/consistency_checks.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/advanced/database_anonymization.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/advanced/sync.js","webpack://trilium/./src/public/app/widgets/type_widgets/options/advanced/vacuum_database.js","webpack://trilium/./src/public/app/widgets/buttons/attachments_actions.js","webpack://trilium/./src/public/app/widgets/attachment_detail.js","webpack://trilium/./src/public/app/widgets/note_detail.js","webpack://trilium/./src/public/app/widgets/type_widgets/empty.js","webpack://trilium/./src/public/app/widgets/type_widgets/read_only_text.js","webpack://trilium/./src/public/app/widgets/type_widgets/editable_code.js","webpack://trilium/./src/public/app/widgets/type_widgets/read_only_code.js","webpack://trilium/./src/public/app/widgets/type_widgets/file.js","webpack://trilium/./src/public/app/widgets/type_widgets/image.js","webpack://trilium/./src/public/app/widgets/type_widgets/none.js","webpack://trilium/./src/public/app/widgets/type_widgets/render.js","webpack://trilium/./src/public/app/widgets/type_widgets/protected_session.js","webpack://trilium/./src/public/app/widgets/type_widgets/book.js","webpack://trilium/./src/public/app/widgets/type_widgets/note_map.js","webpack://trilium/./src/public/app/widgets/type_widgets/web_view.js","webpack://trilium/./src/public/app/widgets/type_widgets/doc.js","webpack://trilium/./src/public/app/widgets/type_widgets/attachment_detail.js","webpack://trilium/./src/public/app/widgets/type_widgets/attachment_list.js","webpack://trilium/./src/public/app/widgets/quick_search.js","webpack://trilium/./src/public/app/widgets/note_tree.js","webpack://trilium/./src/public/app/widgets/mobile_widgets/close_detail_button.js","webpack://trilium/./src/public/app/widgets/mobile_widgets/mobile_detail_menu.js","webpack://trilium/./src/public/app/widgets/mobile_widgets/screen_container.js","webpack://trilium/./src/public/app/widgets/containers/scrolling_container.js","webpack://trilium/./src/public/app/widgets/dialogs/protected_session_password.js","webpack://trilium/./src/public/app/widgets/dialogs/confirm.js","webpack://trilium/./src/public/app/widgets/ribbon_widgets/file_properties.js","webpack://trilium/./src/public/app/widgets/floating_buttons/floating_buttons.js","webpack://trilium/./src/public/app/widgets/buttons/abstract_button.js","webpack://trilium/./src/public/app/widgets/buttons/onclick_button.js","webpack://trilium/./src/public/app/widgets/buttons/edit_button.js","webpack://trilium/./src/public/app/widgets/floating_buttons/relation_map_buttons.js","webpack://trilium/./src/public/app/widgets/floating_buttons/mermaid_export_button.js","webpack://trilium/./src/public/app/widgets/floating_buttons/zpetne_odkazy.js","webpack://trilium/./src/public/app/widgets/floating_buttons/hide_floating_buttons_button.js","webpack://trilium/./src/public/app/widgets/mermaid.js","webpack://trilium/./src/public/app/widgets/note_list.js","webpack://trilium/./src/public/app/services/note_list_renderer.js","webpack://trilium/./src/public/app/widgets/buttons/update_available.js","webpack://trilium/./src/public/app/widgets/buttons/global_menu.js","webpack://trilium/./src/public/app/widgets/buttons/right_dropdown_button.js","webpack://trilium/./src/public/app/widgets/buttons/calendar.js","webpack://trilium/./src/public/app/widgets/spacer.js","webpack://trilium/./src/public/app/widgets/buttons/open_note_button_widget.js","webpack://trilium/./src/public/app/widgets/buttons/bookmark_folder.js","webpack://trilium/./src/public/app/widgets/bookmark_buttons.js","webpack://trilium/./src/public/app/widgets/buttons/command_button.js","webpack://trilium/./src/public/app/widgets/buttons/protected_session_status.js","webpack://trilium/./src/public/app/services/sync.js","webpack://trilium/./src/public/app/widgets/sync_status.js","webpack://trilium/./src/public/app/widgets/buttons/launcher/abstract_launcher.js","webpack://trilium/./src/public/app/widgets/buttons/launcher/note_launcher.js","webpack://trilium/./src/public/app/widgets/buttons/launcher/script_launcher.js","webpack://trilium/./src/public/app/widgets/buttons/launcher/today_launcher.js","webpack://trilium/./src/public/app/widgets/buttons/button_from_note.js","webpack://trilium/./src/public/app/widgets/buttons/history_navigation.js","webpack://trilium/./src/public/app/widgets/containers/launcher.js","webpack://trilium/./src/public/app/widgets/containers/launcher_container.js","webpack://trilium/./src/public/app/widgets/containers/root_container.js","webpack://trilium/./src/public/app/widgets/shared_info.js","webpack://trilium/./src/public/app/widgets/ribbon_widgets/promoted_attributes.js","webpack://trilium/./src/public/app/services/glob.js","webpack://trilium/./src/public/app/mobile.js","webpack://trilium/./src/public/app/layouts/mobile_layout.js"],"sourcesContent":["import Component from \"./component.js\";\nimport appContext from \"./app_context.js\";\nimport dateNoteService from \"../services/date_notes.js\";\nimport treeService from \"../services/tree.js\";\nimport openService from \"../services/open.js\";\nimport protectedSessionService from \"../services/protected_session.js\";\nimport options from \"../services/options.js\";\nimport froca from \"../services/froca.js\";\nimport utils from \"../services/utils.js\";\n\nexport default class RootCommandExecutor extends Component {\n    editReadOnlyNoteCommand() {\n        const noteContext = appContext.tabManager.getActiveContext();\n        noteContext.viewScope.readOnlyTemporarilyDisabled = true;\n\n        appContext.triggerEvent(\"readOnlyTemporarilyDisabled\", { noteContext });\n    }\n\n    async showSQLConsoleCommand() {\n        const sqlConsoleNote = await dateNoteService.createSqlConsole();\n\n        const noteContext = await appContext.tabManager.openTabWithNoteWithHoisting(sqlConsoleNote.noteId, { activate: true });\n\n        appContext.triggerEvent('focusOnDetail', {ntxId: noteContext.ntxId});\n    }\n\n    async searchNotesCommand({searchString, ancestorNoteId}) {\n        const searchNote = await dateNoteService.createSearchNote({searchString, ancestorNoteId});\n\n        // force immediate search\n        await froca.loadSearchNote(searchNote.noteId);\n\n        const noteContext = await appContext.tabManager.openTabWithNoteWithHoisting(searchNote.noteId, {\n            activate: true\n        });\n\n        appContext.triggerCommand('focusOnSearchDefinition', {ntxId: noteContext.ntxId});\n    }\n\n    async searchInSubtreeCommand({notePath}) {\n        const noteId = treeService.getNoteIdFromUrl(notePath);\n\n        this.searchNotesCommand({ancestorNoteId: noteId});\n    }\n\n    openNoteExternallyCommand() {\n        const noteId = appContext.tabManager.getActiveContextNoteId();\n        const mime = appContext.tabManager.getActiveContextNoteMime();\n        if (noteId) {\n            openService.openNoteExternally(noteId, mime);\n        }\n    }\n\n    openNoteCustomCommand() {\n        const noteId = appContext.tabManager.getActiveContextNoteId();\n        const mime = appContext.tabManager.getActiveContextNoteMime();\n        if (noteId) {\n            openService.openNoteCustom(noteId, mime);\n        }\n    }\n\n    enterProtectedSessionCommand() {\n        protectedSessionService.enterProtectedSession();\n    }\n\n    leaveProtectedSessionCommand() {\n        protectedSessionService.leaveProtectedSession();\n    }\n\n    hideLeftPaneCommand() {\n        options.save(`leftPaneVisible`, \"false\");\n    }\n\n    showLeftPaneCommand() {\n        options.save(`leftPaneVisible`, \"true\");\n    }\n\n    toggleLeftPaneCommand() {\n        options.toggle('leftPaneVisible');\n    }\n\n    async showBackendLogCommand() {\n        await appContext.tabManager.openTabWithNoteWithHoisting('_backendLog', { activate: true });\n    }\n\n    async showLaunchBarSubtreeCommand() {\n        await this.showAndHoistSubtree('_lbRoot');\n    }\n\n    async showShareSubtreeCommand() {\n        await this.showAndHoistSubtree('_share');\n    }\n\n    async showHiddenSubtreeCommand() {\n        await this.showAndHoistSubtree('_hidden');\n    }\n\n    async showOptionsCommand({section}) {\n        await appContext.tabManager.openContextWithNote(section || '_options', {\n            activate: true,\n            hoistedNoteId: '_options'\n        });\n    }\n\n    async showSQLConsoleHistoryCommand() {\n        await this.showAndHoistSubtree('_sqlConsole');\n    }\n\n    async showSearchHistoryCommand() {\n        await this.showAndHoistSubtree('_search');\n    }\n\n    async showAndHoistSubtree(subtreeNoteId) {\n        await appContext.tabManager.openContextWithNote(subtreeNoteId, {\n            activate: true,\n            hoistedNoteId: subtreeNoteId\n        });\n    }\n\n    async showNoteSourceCommand() {\n        const notePath = appContext.tabManager.getActiveContextNotePath();\n\n        if (notePath) {\n            await appContext.tabManager.openTabWithNoteWithHoisting(notePath, {\n                activate: true,\n                viewScope: {\n                    viewMode: 'source'\n                }\n            });\n        }\n    }\n\n    async showAttachmentsCommand() {\n        const notePath = appContext.tabManager.getActiveContextNotePath();\n\n        if (notePath) {\n            await appContext.tabManager.openTabWithNoteWithHoisting(notePath, {\n                activate: true,\n                viewScope: {\n                    viewMode: 'attachments'\n                }\n            });\n        }\n    }\n\n    async showAttachmentDetailCommand() {\n        const notePath = appContext.tabManager.getActiveContextNotePath();\n\n        if (notePath) {\n            await appContext.tabManager.openTabWithNoteWithHoisting(notePath, {\n                activate: true,\n                viewScope: {\n                    viewMode: 'attachments'\n                }\n            });\n        }\n    }\n\n    toggleTrayCommand() {\n        if (!utils.isElectron()) return;\n        const {BrowserWindow} = utils.dynamicRequire('@electron/remote');\n        const windows = BrowserWindow.getAllWindows();\n        const isVisible = windows.every(w => w.isVisible());\n        const action = isVisible ? \"hide\" : \"show\"\n        for (const window of windows) window[action]();\n    }\n\n    firstTabCommand()   { this.#goToTab(1); }\n    secondTabCommand()  { this.#goToTab(2); }\n    thirdTabCommand()   { this.#goToTab(3); }\n    fourthTabCommand()  { this.#goToTab(4); }\n    fifthTabCommand()   { this.#goToTab(5); }\n    sixthTabCommand()   { this.#goToTab(6); }\n    seventhTabCommand() { this.#goToTab(7); }\n    eigthTabCommand()   { this.#goToTab(8); }\n    ninthTabCommand()   { this.#goToTab(9); }\n    lastTabCommand()    { this.#goToTab(Number.POSITIVE_INFINITY); }\n\n    #goToTab(tabNumber) {\n        const mainNoteContexts = appContext.tabManager.getMainNoteContexts();\n\n        const index = tabNumber === Number.POSITIVE_INFINITY ? mainNoteContexts.length - 1 : tabNumber - 1;\n        const tab = mainNoteContexts[index];\n\n        if (tab) {\n            appContext.tabManager.activateNoteContext(tab.ntxId);\n        }\n    }\n}\n","import utils from \"../services/utils.js\";\nimport dateNoteService from \"../services/date_notes.js\";\nimport protectedSessionHolder from '../services/protected_session_holder.js';\nimport server from \"../services/server.js\";\nimport appContext from \"./app_context.js\";\nimport Component from \"./component.js\";\nimport toastService from \"../services/toast.js\";\nimport ws from \"../services/ws.js\";\nimport bundleService from \"../services/bundle.js\";\nimport froca from \"../services/froca.js\";\nimport linkService from \"../services/link.js\";\n\nexport default class Entrypoints extends Component {\n    constructor() {\n        super();\n\n        if (jQuery.hotkeys) {\n            // hot keys are active also inside inputs and content editables\n            jQuery.hotkeys.options.filterInputAcceptingElements = false;\n            jQuery.hotkeys.options.filterContentEditable = false;\n            jQuery.hotkeys.options.filterTextInputs = false;\n        }\n    }\n\n    openDevToolsCommand() {\n        if (utils.isElectron()) {\n            utils.dynamicRequire('@electron/remote').getCurrentWindow().toggleDevTools();\n        }\n    }\n\n    async createNoteIntoInboxCommand() {\n        const inboxNote = await dateNoteService.getInboxNote();\n\n        const {note} = await server.post(`notes/${inboxNote.noteId}/children?target=into`, {\n            content: '',\n            type: 'text',\n            isProtected: inboxNote.isProtected && protectedSessionHolder.isProtectedSessionAvailable()\n        });\n\n        await ws.waitForMaxKnownEntityChangeId();\n\n        await appContext.tabManager.openTabWithNoteWithHoisting(note.noteId, {activate: true});\n\n        appContext.triggerEvent('focusAndSelectTitle', {isNewNote: true});\n    }\n\n    async toggleNoteHoistingCommand({noteId = appContext.tabManager.getActiveContextNoteId()}) {\n        const noteToHoist = await froca.getNote(noteId);\n        const activeNoteContext = appContext.tabManager.getActiveContext();\n\n        if (noteToHoist.noteId === activeNoteContext.hoistedNoteId) {\n            await activeNoteContext.unhoist();\n        }\n        else if (noteToHoist.type !== 'search') {\n            await activeNoteContext.setHoistedNoteId(noteId);\n        }\n    }\n\n    async hoistNoteCommand({noteId}) {\n        const noteContext = appContext.tabManager.getActiveContext();\n\n        if (noteContext.hoistedNoteId !== noteId) {\n            await noteContext.setHoistedNoteId(noteId);\n        }\n    }\n\n    async unhoistCommand() {\n        const activeNoteContext = appContext.tabManager.getActiveContext();\n\n        if (activeNoteContext) {\n            activeNoteContext.unhoist();\n        }\n    }\n\n    copyWithoutFormattingCommand() {\n        utils.copySelectionToClipboard();\n    }\n\n    toggleFullscreenCommand() {\n        if (utils.isElectron()) {\n            const win = utils.dynamicRequire('@electron/remote').getCurrentWindow();\n\n            if (win.isFullScreenable()) {\n                win.setFullScreen(!win.isFullScreen());\n            }\n        } // outside of electron this is handled by the browser\n    }\n\n    reloadFrontendAppCommand() {\n        utils.reloadFrontendApp();\n    }\n\n    logoutCommand() {\n        const $logoutForm = $('<form action=\"logout\" method=\"POST\">')\n            .append($(`<input type='_hidden' name=\"_csrf\" value=\"${glob.csrfToken}\"/>`));\n\n        $(\"body\").append($logoutForm);\n        $logoutForm.trigger('submit');\n    }\n\n    backInNoteHistoryCommand() {\n        if (utils.isElectron()) {\n            // standard JS version does not work completely correctly in electron\n            const webContents = utils.dynamicRequire('@electron/remote').getCurrentWebContents();\n            const activeIndex = parseInt(webContents.getActiveIndex());\n\n            webContents.goToIndex(activeIndex - 1);\n        }\n        else {\n            window.history.back();\n        }\n    }\n\n    forwardInNoteHistoryCommand() {\n        if (utils.isElectron()) {\n            // standard JS version does not work completely correctly in electron\n            const webContents = utils.dynamicRequire('@electron/remote').getCurrentWebContents();\n            const activeIndex = parseInt(webContents.getActiveIndex());\n\n            webContents.goToIndex(activeIndex + 1);\n        }\n        else {\n            window.history.forward();\n        }\n    }\n\n    async switchToDesktopVersionCommand() {\n        utils.setCookie('trilium-device', 'desktop');\n\n        utils.reloadFrontendApp(\"正在切换到桌面版\");\n    }\n\n    async switchToMobileVersionCommand() {\n        utils.setCookie('trilium-device', 'mobile');\n\n        utils.reloadFrontendApp(\"正在切换到移动版\");\n    }\n\n    async openInWindowCommand({notePath, hoistedNoteId, viewScope}) {\n        const extraWindowHash = linkService.calculateHash({notePath, hoistedNoteId, viewScope});\n\n        if (utils.isElectron()) {\n            const {ipcRenderer} = utils.dynamicRequire('electron');\n\n            ipcRenderer.send('create-extra-window', { extraWindowHash });\n        }\n        else {\n            const url = `${window.location.protocol}//${window.location.host}${window.location.pathname}?extraWindow=1${extraWindowHash}`;\n\n            window.open(url, '', 'width=1000,height=800');\n        }\n    }\n\n    async openNewWindowCommand() {\n        this.openInWindowCommand({notePath: '', hoistedNoteId: 'root'});\n    }\n\n    async runActiveNoteCommand() {\n        const {ntxId, note} = appContext.tabManager.getActiveContext();\n\n        // ctrl+enter is also used elsewhere, so make sure we're running only when appropriate\n        if (!note || note.type !== 'code') {\n            return;\n        }\n\n        // TODO: use note.executeScript()\n        if (note.mime.endsWith(\"env=frontend\")) {\n            await bundleService.getAndExecuteBundle(note.noteId);\n        } else if (note.mime.endsWith(\"env=backend\")) {\n            await server.post(`script/run/${note.noteId}`);\n        } else if (note.mime === 'text/x-sqlite;schema=trilium') {\n            const resp = await server.post(`sql/execute/${note.noteId}`);\n\n            if (!resp.success) {\n                toastService.showError(`Error occurred while executing SQL query: ${resp.error}`);\n            }\n\n            await appContext.triggerEvent('sqlQueryResults', {ntxId: ntxId, results: resp.results});\n        }\n\n        toastService.showMessage(\"笔记已执行\");\n    }\n\n    hideAllPopups() {\n        if (utils.isDesktop()) {\n            $(\".aa-input\").autocomplete(\"close\");\n        }\n    }\n\n    noteSwitchedEvent() {\n        this.hideAllPopups();\n    }\n\n    activeContextChangedEvent() {\n        this.hideAllPopups();\n    }\n\n    async forceSaveRevisionCommand() {\n        const noteId = appContext.tabManager.getActiveContextNoteId();\n\n        await server.post(`notes/${noteId}/revision`);\n\n        toastService.showMessage(\"笔记历史已创建\");\n    }\n}\n","import protectedSessionHolder from \"../services/protected_session_holder.js\";\nimport server from \"../services/server.js\";\nimport utils from \"../services/utils.js\";\nimport appContext from \"./app_context.js\";\nimport treeService from \"../services/tree.js\";\nimport Component from \"./component.js\";\nimport froca from \"../services/froca.js\";\nimport hoistedNoteService from \"../services/hoisted_note.js\";\nimport options from \"../services/options.js\";\n\nclass NoteContext extends Component {\n    constructor(ntxId = null, hoistedNoteId = 'root', mainNtxId = null) {\n        super();\n\n        this.ntxId = ntxId || this.constructor.generateNtxId();\n        this.hoistedNoteId = hoistedNoteId;\n        this.mainNtxId = mainNtxId;\n\n        this.resetViewScope();\n    }\n\n    static generateNtxId() {\n        return utils.randomString(6);\n    }\n\n    setEmpty() {\n        this.notePath = null;\n        this.noteId = null;\n        this.parentNoteId = null;\n        // hoisted note is kept intentionally\n\n        this.triggerEvent('noteSwitched', {\n            noteContext: this,\n            notePath: this.notePath\n        });\n\n        this.resetViewScope();\n    }\n\n    isEmpty() {\n        return !this.noteId;\n    }\n\n    async setNote(inputNotePath, opts = {}) {\n        opts.triggerSwitchEvent = opts.triggerSwitchEvent !== undefined ? opts.triggerSwitchEvent : true;\n        opts.viewScope = opts.viewScope || {};\n        opts.viewScope.viewMode = opts.viewScope.viewMode || \"default\";\n\n        const resolvedNotePath = await this.getResolvedNotePath(inputNotePath);\n\n        if (!resolvedNotePath) {\n            return;\n        }\n\n        if (this.notePath === resolvedNotePath && utils.areObjectsEqual(this.viewScope, opts.viewScope)) {\n            return;\n        }\n\n        await this.triggerEvent('beforeNoteSwitch', {noteContext: this});\n\n        utils.closeActiveDialog();\n\n        this.notePath = resolvedNotePath;\n        this.viewScope = opts.viewScope;\n        ({noteId: this.noteId, parentNoteId: this.parentNoteId} = treeService.getNoteIdAndParentIdFromUrl(resolvedNotePath));\n\n        this.saveToRecentNotes(resolvedNotePath);\n\n        protectedSessionHolder.touchProtectedSessionIfNecessary(this.note);\n\n        if (opts.triggerSwitchEvent) {\n            await this.triggerEvent('noteSwitched', {\n                noteContext: this,\n                notePath: this.notePath\n            });\n        }\n\n        await this.setHoistedNoteIfNeeded();\n\n        if (utils.isMobile()) {\n            this.triggerCommand('setActiveScreen', {screen: 'detail'});\n        }\n    }\n\n    async setHoistedNoteIfNeeded() {\n        if (this.hoistedNoteId === 'root'\n            && this.notePath.startsWith(\"root/_hidden\")\n            && !this.note.isLabelTruthy(\"keepCurrentHoisting\")\n        ) {\n            // hidden subtree displays only when hoisted, so it doesn't make sense to keep root as hoisted note\n\n            let hoistedNoteId = '_hidden';\n\n            if (this.note.isLaunchBarConfig()) {\n                hoistedNoteId = '_lbRoot';\n            } else if (this.note.isOptions()) {\n                hoistedNoteId = '_options';\n            }\n\n            await this.setHoistedNoteId(hoistedNoteId);\n        }\n    }\n\n    getSubContexts() {\n        return appContext.tabManager.noteContexts.filter(nc => nc.ntxId === this.ntxId || nc.mainNtxId === this.ntxId);\n    }\n\n    /**\n     * A main context represents a tab and also the first split. Further splits are the children contexts of the main context.\n     * Imagine you have a tab with 3 splits, each showing notes A, B, C (in this order).\n     * In such a scenario, A context is the main context (also representing the tab as a whole), and B, C are the children\n     * of context A.\n     *\n     * @returns {boolean} true if the context is main (= tab)\n     */\n    isMainContext() {\n        // if null, then this is a main context\n        return !this.mainNtxId;\n    }\n\n    /**\n     * See docs for isMainContext() for better explanation.\n     *\n     * @returns {NoteContext}\n     */\n    getMainContext() {\n        if (this.mainNtxId) {\n            try {\n                return appContext.tabManager.getNoteContextById(this.mainNtxId);\n            }\n            catch (e) {\n                this.mainNtxId = null;\n                return this;\n            }\n        }\n        else {\n            return this;\n        }\n    }\n\n    saveToRecentNotes(resolvedNotePath) {\n        setTimeout(async () => {\n            // we include the note in the recent list only if the user stayed on the note at least 5 seconds\n            if (resolvedNotePath && resolvedNotePath === this.notePath) {\n                await server.post('recent-notes', {\n                    noteId: this.note.noteId,\n                    notePath: this.notePath\n                });\n            }\n        }, 5000);\n    }\n\n    async getResolvedNotePath(inputNotePath) {\n        const resolvedNotePath = await treeService.resolveNotePath(inputNotePath, this.hoistedNoteId);\n\n        if (!resolvedNotePath) {\n            logError(`Cannot resolve note path ${inputNotePath}`);\n            return;\n        }\n\n        if (await hoistedNoteService.checkNoteAccess(resolvedNotePath, this) === false) {\n            return; // note is outside of hoisted subtree and user chose not to unhoist\n        }\n\n        return resolvedNotePath;\n    }\n\n    /** @returns {FNote} */\n    get note() {\n        if (!this.noteId || !(this.noteId in froca.notes)) {\n            return null;\n        }\n\n        return froca.notes[this.noteId];\n    }\n\n    /** @returns {string[]} */\n    get notePathArray() {\n        return this.notePath ? this.notePath.split('/') : [];\n    }\n\n    isActive() {\n        return appContext.tabManager.activeNtxId === this.ntxId;\n    }\n\n    getPojoState() {\n        if (this.hoistedNoteId !== 'root') {\n            // keeping empty hoisted tab is esp. important for mobile (e.g. opened launcher config)\n\n            if (!this.notePath && this.getSubContexts().length === 0) {\n                return null;\n            }\n        }\n\n        return {\n            ntxId: this.ntxId,\n            mainNtxId: this.mainNtxId,\n            notePath: this.notePath,\n            hoistedNoteId: this.hoistedNoteId,\n            active: this.isActive(),\n            viewScope: this.viewScope\n        }\n    }\n\n    async unhoist() {\n        await this.setHoistedNoteId('root');\n    }\n\n    async setHoistedNoteId(noteIdToHoist) {\n        if (this.hoistedNoteId === noteIdToHoist) {\n            return;\n        }\n\n        this.hoistedNoteId = noteIdToHoist;\n\n        if (!this.notePathArray?.includes(noteIdToHoist) && !utils.isMobile()) {\n            await this.setNote(noteIdToHoist);\n        }\n\n        await this.triggerEvent('hoistedNoteChanged', {\n            noteId: noteIdToHoist,\n            ntxId: this.ntxId\n        });\n    }\n\n    /** @returns {Promise<boolean>} */\n    async isReadOnly() {\n        if (this.viewScope.readOnlyTemporarilyDisabled) {\n            return false;\n        }\n\n        // \"readOnly\" is a state valid only for text/code notes\n        if (!this.note || (this.note.type !== 'text' && this.note.type !== 'code')) {\n            return false;\n        }\n\n        if (this.note.isLabelTruthy('readOnly')) {\n            return true;\n        }\n\n        if (this.viewScope.viewMode === 'source') {\n            return true;\n        }\n\n        const blob = await this.note.getBlob();\n\n        const sizeLimit = this.note.type === 'text'\n            ? options.getInt('autoReadonlySizeText')\n            : options.getInt('autoReadonlySizeCode');\n\n        return blob.contentLength > sizeLimit\n            && !this.note.isLabelTruthy('autoReadOnlyDisabled');\n    }\n\n    async entitiesReloadedEvent({loadResults}) {\n        if (loadResults.isNoteReloaded(this.noteId)) {\n            const noteRow = loadResults.getEntityRow('notes', this.noteId);\n\n            if (noteRow.isDeleted) {\n                this.noteId = null;\n                this.notePath = null;\n\n                this.triggerEvent('noteSwitched', {\n                    noteContext: this,\n                    notePath: this.notePath\n                });\n            }\n        }\n    }\n\n    hasNoteList() {\n        return this.note\n            && this.viewScope.viewMode === 'default'\n            && this.note.hasChildren()\n            && ['book', 'text', 'code'].includes(this.note.type)\n            && this.note.mime !== 'text/x-sqlite;schema=trilium'\n            && !this.note.isLabelTruthy('hideChildrenOverview');\n    }\n\n    async getTextEditor(callback) {\n        return this.timeout(new Promise(resolve => appContext.triggerCommand('executeWithTextEditor', {\n            callback,\n            resolve,\n            ntxId: this.ntxId\n        })));\n    }\n\n    async getCodeEditor() {\n        return this.timeout(new Promise(resolve => appContext.triggerCommand('executeWithCodeEditor', {\n            resolve,\n            ntxId: this.ntxId\n        })));\n    }\n\n    async getContentElement() {\n        return this.timeout(new Promise(resolve => appContext.triggerCommand('executeWithContentElement', {\n            resolve,\n            ntxId: this.ntxId\n        })));\n    }\n\n    async getTypeWidget() {\n        return this.timeout(new Promise(resolve => appContext.triggerCommand('executeWithTypeWidget', {\n            resolve,\n            ntxId: this.ntxId\n        })));\n    }\n\n    timeout(promise) {\n        return Promise.race([\n            promise,\n            new Promise(res => setTimeout(() => res(null), 200))\n        ]);\n    }\n\n    resetViewScope() {\n        // view scope contains data specific to one note context and one \"view\".\n        // it is used to e.g., make read-only note temporarily editable or to hide TOC\n        // this is reset after navigating to a different note\n        this.viewScope = {};\n    }\n\n    async getNavigationTitle() {\n        if (!this.note) {\n            return null;\n        }\n\n        const { note, viewScope } = this;\n\n        let title = viewScope.viewMode === 'default'\n            ? note.title\n            : `${note.title}: ${viewScope.viewMode}`;\n\n        if (viewScope.attachmentId) {\n            // assuming the attachment has been already loaded\n            const attachment = await note.getAttachmentById(viewScope.attachmentId);\n\n            if (attachment) {\n                title += `: ${attachment.title}`;\n            }\n        }\n\n        return title;\n    }\n}\n\nexport default NoteContext;\n","export default class Mutex {\n    constructor() {\n        this.current = Promise.resolve();\n    }\n\n    /** @returns {Promise} */\n    lock() {\n        let resolveFun;\n        const subPromise = new Promise(resolve => resolveFun = () => resolve());\n        // Caller gets a promise that resolves when the current outstanding lock resolves\n        const newPromise = this.current.then(() => resolveFun);\n        // Don't allow the next request until the new promise is done\n        this.current = subPromise;\n        // Return the new promise\n        return newPromise;\n    };\n\n    async runExclusively(cb) {\n        const unlock = await this.lock();\n\n        try {\n            return await cb();\n        }\n        finally {\n            unlock();\n        }\n    }\n}\n","import Component from \"./component.js\";\nimport SpacedUpdate from \"../services/spaced_update.js\";\nimport server from \"../services/server.js\";\nimport options from \"../services/options.js\";\nimport froca from \"../services/froca.js\";\nimport treeService from \"../services/tree.js\";\nimport utils from \"../services/utils.js\";\nimport NoteContext from \"./note_context.js\";\nimport appContext from \"./app_context.js\";\nimport Mutex from \"../utils/mutex.js\";\nimport linkService from \"../services/link.js\";\n\nexport default class TabManager extends Component {\n    constructor() {\n        super();\n\n        /** @property {NoteContext[]} */\n        this.children = [];\n        this.mutex = new Mutex();\n\n        this.activeNtxId = null;\n\n        // elements are arrays of {contexts, position}, storing note contexts for each tab (one main context + subcontexts [splits]), and the original position of the tab\n        this.recentlyClosedTabs = [];\n\n        this.tabsUpdate = new SpacedUpdate(async () => {\n            if (!appContext.isMainWindow) {\n                return;\n            }\n\n            const openNoteContexts = this.noteContexts\n                .map(nc => nc.getPojoState())\n                .filter(t => !!t);\n\n            await server.put('options', {\n                openNoteContexts: JSON.stringify(openNoteContexts)\n            });\n        });\n\n        appContext.addBeforeUnloadListener(this);\n    }\n\n    /** @returns {NoteContext[]} */\n    get noteContexts() {\n        return this.children;\n    }\n\n    /** @type {NoteContext[]} */\n    get mainNoteContexts() {\n        return this.noteContexts.filter(nc => !nc.mainNtxId)\n    }\n\n    async loadTabs() {\n        try {\n            const noteContextsToOpen = (appContext.isMainWindow && options.getJson('openNoteContexts')) || [];\n\n            // preload all notes at once\n            await froca.getNotes([\n                    ...noteContextsToOpen.flatMap(tab =>\n                        [ treeService.getNoteIdFromUrl(tab.notePath), tab.hoistedNoteId]\n                    ),\n            ], true);\n\n            const filteredNoteContexts = noteContextsToOpen.filter(openTab => {\n                if (utils.isMobile()) { // mobile frontend doesn't have tabs so show only the active tab\n                    return !!openTab.active;\n                }\n\n                const noteId = treeService.getNoteIdFromUrl(openTab.notePath);\n                if (!(noteId in froca.notes)) {\n                    // note doesn't exist so don't try to open tab for it\n                    return false;\n                }\n\n                if (!(openTab.hoistedNoteId in froca.notes)) {\n                    openTab.hoistedNoteId = 'root';\n                }\n\n                return true;\n            });\n\n            // resolve before opened tabs can change this\n            const parsedFromUrl = linkService.parseNavigationStateFromUrl(window.location.href);\n\n            if (filteredNoteContexts.length === 0) {\n                parsedFromUrl.ntxId = parsedFromUrl.ntxId || NoteContext.generateNtxId(); // generate already here, so that we later know which one to activate\n\n                filteredNoteContexts.push({\n                    notePath: parsedFromUrl.notePath || 'root',\n                    ntxId: parsedFromUrl.ntxId,\n                    active: true,\n                    hoistedNoteId: parsedFromUrl.hoistedNoteId || 'root',\n                    viewScope: parsedFromUrl.viewScope || {}\n                });\n            } else if (!filteredNoteContexts.find(tab => tab.active)) {\n                filteredNoteContexts[0].active = true;\n            }\n\n            await this.tabsUpdate.allowUpdateWithoutChange(async () => {\n                for (const tab of filteredNoteContexts) {\n                    await this.openContextWithNote(tab.notePath, {\n                        activate: tab.active,\n                        ntxId: tab.ntxId,\n                        mainNtxId: tab.mainNtxId,\n                        hoistedNoteId: tab.hoistedNoteId,\n                        viewScope: tab.viewScope\n                    });\n                }\n            });\n\n            // if there's a notePath in the URL, make sure it's open and active\n            // (useful, for e.g., opening clipped notes from clipper or opening link in an extra window)\n            if (parsedFromUrl.notePath) {\n                await appContext.tabManager.switchToNoteContext(\n                    parsedFromUrl.ntxId,\n                    parsedFromUrl.notePath,\n                    parsedFromUrl.viewScope,\n                    parsedFromUrl.hoistedNoteId\n                );\n            } else if (parsedFromUrl.searchString) {\n                await appContext.triggerCommand('searchNotes', {\n                    searchString: parsedFromUrl.searchString\n                });\n            }\n        }\n        catch (e) {\n            logError(`Loading note contexts '${options.get('openNoteContexts')}' failed: ${e.message} ${e.stack}`);\n\n            // try to recover\n            await this.openEmptyTab();\n        }\n    }\n\n    noteSwitchedEvent({noteContext}) {\n        if (noteContext.isActive()) {\n            this.setCurrentNavigationStateToHash();\n        }\n\n        this.tabsUpdate.scheduleUpdate();\n    }\n\n    setCurrentNavigationStateToHash() {\n        const calculatedHash = this.calculateHash();\n\n        // update if it's the first history entry or there has been a change\n        if (window.history.length === 0 || calculatedHash !== window.location?.hash) {\n            // using pushState instead of directly modifying document.location because it does not trigger hashchange\n            window.history.pushState(null, \"\", calculatedHash);\n        }\n\n        const activeNoteContext = this.getActiveContext();\n        this.updateDocumentTitle(activeNoteContext);\n\n        this.triggerEvent('activeNoteChanged'); // trigger this even in on popstate event\n    }\n\n    calculateHash() {\n        const activeNoteContext = this.getActiveContext();\n        if (!activeNoteContext) {\n            return \"\";\n        }\n\n        return linkService.calculateHash({\n            notePath: activeNoteContext.notePath,\n            ntxId: activeNoteContext.ntxId,\n            hoistedNoteId: activeNoteContext.hoistedNoteId,\n            viewScope: activeNoteContext.viewScope\n        });\n    }\n\n    /** @returns {NoteContext[]} */\n    getNoteContexts() {\n        return this.noteContexts;\n    }\n\n    /**\n     * Main context is essentially a tab (children are splits), so this returns tabs.\n     * @returns {NoteContext[]}\n     */\n    getMainNoteContexts() {\n        return this.noteContexts.filter(nc => nc.isMainContext());\n    }\n\n    /** @returns {NoteContext} */\n    getNoteContextById(ntxId) {\n        const noteContext = this.noteContexts.find(nc => nc.ntxId === ntxId);\n\n        if (!noteContext) {\n            throw new Error(`找不到 noteContext id='${ntxId}'`);\n        }\n\n        return noteContext;\n    }\n\n    /**\n     * Get active context which represents the visible split with focus. Active context can, but doesn't have to be \"main\".\n     *\n     * @returns {NoteContext}\n     */\n    getActiveContext() {\n        return this.activeNtxId\n            ? this.getNoteContextById(this.activeNtxId)\n            : null;\n    }\n\n    /**\n     * Get active main context which corresponds to the active tab.\n     *\n     * @returns {NoteContext}\n     */\n    getActiveMainContext() {\n        return this.activeNtxId\n            ? this.getNoteContextById(this.activeNtxId).getMainContext()\n            : null;\n    }\n\n    /** @returns {string|null} */\n    getActiveContextNotePath() {\n        const activeContext = this.getActiveContext();\n        return activeContext ? activeContext.notePath : null;\n    }\n\n    /** @returns {FNote} */\n    getActiveContextNote() {\n        const activeContext = this.getActiveContext();\n        return activeContext ? activeContext.note : null;\n    }\n\n    /** @returns {string|null} */\n    getActiveContextNoteId() {\n        const activeNote = this.getActiveContextNote();\n\n        return activeNote ? activeNote.noteId : null;\n    }\n\n    /** @returns {string|null} */\n    getActiveContextNoteType() {\n        const activeNote = this.getActiveContextNote();\n\n        return activeNote ? activeNote.type : null;\n    }\n    /** @returns {string|null} */\n    getActiveContextNoteMime() {\n        const activeNote = this.getActiveContextNote();\n\n        return activeNote ? activeNote.mime : null;\n    }\n\n    async switchToNoteContext(ntxId, notePath, viewScope = {}, hoistedNoteId = null) {\n        const noteContext = this.noteContexts.find(nc => nc.ntxId === ntxId)\n            || await this.openEmptyTab();\n\n        await this.activateNoteContext(noteContext.ntxId);\n\n        if (hoistedNoteId) {\n            await noteContext.setHoistedNoteId(hoistedNoteId);\n        }\n\n        if (notePath) {\n            await noteContext.setNote(notePath, { viewScope });\n        }\n    }\n\n    async openAndActivateEmptyTab() {\n        const noteContext = await this.openEmptyTab();\n\n        await this.activateNoteContext(noteContext.ntxId);\n\n        await noteContext.setEmpty();\n    }\n\n    async openEmptyTab(ntxId = null, hoistedNoteId = 'root', mainNtxId = null) {\n        const noteContext = new NoteContext(ntxId, hoistedNoteId, mainNtxId);\n\n        let existingNoteContext;\n\n        if (utils.isMobile()) {\n            // kind of hacky way to enforce a single tab on mobile interface - all requests to create a new one\n            // are forced to reuse the existing ab instead\n            existingNoteContext = this.getActiveContext();\n        } else {\n            existingNoteContext = this.children.find(nc => nc.ntxId === noteContext.ntxId);\n        }\n\n        if (existingNoteContext) {\n            await existingNoteContext.setHoistedNoteId(hoistedNoteId);\n\n            return existingNoteContext;\n        }\n\n        this.child(noteContext);\n\n        await this.triggerEvent('newNoteContextCreated', {noteContext});\n\n        return noteContext;\n    }\n\n    async openInNewTab(targetNoteId, hoistedNoteId = null) {\n        const noteContext = await this.openEmptyTab(null, hoistedNoteId || this.getActiveContext().hoistedNoteId);\n\n        await noteContext.setNote(targetNoteId);\n    }\n\n    async openInSameTab(targetNoteId, hoistedNoteId = null) {\n        const activeContext = this.getActiveContext();\n        await activeContext.setHoistedNoteId(hoistedNoteId || activeContext.hoistedNoteId);\n        await activeContext.setNote(targetNoteId);\n    }\n\n    /**\n     * If the requested notePath is within current note hoisting scope then keep the note hoisting also for the new tab.\n     */\n    async openTabWithNoteWithHoisting(notePath, opts = {}) {\n        const noteContext = this.getActiveContext();\n        let hoistedNoteId = 'root';\n\n        if (noteContext) {\n            const resolvedNotePath = await treeService.resolveNotePath(notePath, noteContext.hoistedNoteId);\n\n            if (resolvedNotePath.includes(noteContext.hoistedNoteId) || resolvedNotePath.includes('_hidden')) {\n                hoistedNoteId = noteContext.hoistedNoteId;\n            }\n        }\n\n        opts.hoistedNoteId = hoistedNoteId;\n\n        return this.openContextWithNote(notePath, opts);\n    }\n\n    async openContextWithNote(notePath, opts = {}) {\n        const activate = !!opts.activate;\n        const ntxId = opts.ntxId || null;\n        const mainNtxId = opts.mainNtxId || null;\n        const hoistedNoteId = opts.hoistedNoteId || 'root';\n        const viewScope = opts.viewScope || { viewMode: \"default\" };\n\n        const noteContext = await this.openEmptyTab(ntxId, hoistedNoteId, mainNtxId);\n\n        if (notePath) {\n            await noteContext.setNote(notePath, {\n                // if activate is false, then send normal noteSwitched event\n                triggerSwitchEvent: !activate,\n                viewScope: viewScope\n            });\n        }\n\n        if (activate) {\n            this.activateNoteContext(noteContext.ntxId, false);\n\n            await this.triggerEvent('noteSwitchedAndActivated', {\n                noteContext,\n                notePath: noteContext.notePath // resolved note path\n            });\n        }\n\n        return noteContext;\n    }\n\n    async activateOrOpenNote(noteId) {\n        for (const noteContext of this.getNoteContexts()) {\n            if (noteContext.note && noteContext.note.noteId === noteId) {\n                this.activateNoteContext(noteContext.ntxId);\n\n                return;\n            }\n        }\n\n        // if no tab with this note has been found we'll create new tab\n\n        await this.openContextWithNote(noteId, { activate: true });\n    }\n\n    async activateNoteContext(ntxId, triggerEvent = true) {\n        if (ntxId === this.activeNtxId) {\n            return;\n        }\n\n        this.activeNtxId = ntxId;\n\n        if (triggerEvent) {\n            await this.triggerEvent('activeContextChanged', {\n                noteContext: this.getNoteContextById(ntxId)\n            });\n        }\n\n        this.tabsUpdate.scheduleUpdate();\n\n        this.setCurrentNavigationStateToHash();\n    }\n\n    /**\n     * @param ntxId\n     * @returns {Promise<boolean>} true if note context has been removed, false otherwise\n     */\n    async removeNoteContext(ntxId) {\n        // removing note context is an async process which can take some time, if users presses CTRL-W quickly, two\n        // close events could interleave which would then lead to attempting to activate already removed context.\n        return await this.mutex.runExclusively(async () => {\n            let noteContextToRemove;\n\n            try {\n                noteContextToRemove = this.getNoteContextById(ntxId);\n            }\n            catch {\n                // note context not found\n                return false;\n            }\n\n            if (noteContextToRemove.isMainContext()) {\n                const mainNoteContexts = this.getNoteContexts().filter(nc => nc.isMainContext());\n\n                if (mainNoteContexts.length === 1) {\n                    if (noteContextToRemove.isEmpty()) {\n                        // this is already the empty note context, no point in closing it and replacing with another\n                        // empty tab\n                        return false;\n                    }\n\n                    await this.openEmptyTab();\n                }\n            }\n\n            // close dangling autocompletes after closing the tab\n            $(\".aa-input\").autocomplete(\"close\");\n\n            const noteContextsToRemove = noteContextToRemove.getSubContexts();\n            const ntxIdsToRemove = noteContextsToRemove.map(nc => nc.ntxId);\n\n            await this.triggerEvent('beforeNoteContextRemove', { ntxIds: ntxIdsToRemove });\n\n            if (!noteContextToRemove.isMainContext()) {\n                const siblings = noteContextToRemove.getMainContext().getSubContexts();\n                const idx = siblings.findIndex(nc => nc.ntxId === noteContextToRemove.ntxId);\n                const contextToActivateIdx = idx === siblings.length - 1 ? idx - 1 : idx + 1;\n                const contextToActivate = siblings[contextToActivateIdx];\n\n                await this.activateNoteContext(contextToActivate.ntxId);\n            }\n            else if (this.mainNoteContexts.length <= 1) {\n                await this.openAndActivateEmptyTab();\n            }\n            else if (ntxIdsToRemove.includes(this.activeNtxId)) {\n                const idx = this.mainNoteContexts.findIndex(nc => nc.ntxId === noteContextToRemove.ntxId);\n\n                if (idx === this.mainNoteContexts.length - 1) {\n                    await this.activatePreviousTabCommand();\n                }\n                else {\n                    await this.activateNextTabCommand();\n                }\n            }\n\n            this.removeNoteContexts(noteContextsToRemove);\n\n            return true;\n        });\n    }\n\n    removeNoteContexts(noteContextsToRemove) {\n        const ntxIdsToRemove = noteContextsToRemove.map(nc => nc.ntxId);\n\n        const position = this.noteContexts.findIndex(nc => ntxIdsToRemove.includes(nc.ntxId));\n\n        this.children = this.children.filter(nc => !ntxIdsToRemove.includes(nc.ntxId));\n\n        this.addToRecentlyClosedTabs(noteContextsToRemove, position);\n\n        this.triggerEvent('noteContextRemoved', {ntxIds: ntxIdsToRemove});\n\n        this.tabsUpdate.scheduleUpdate();\n    }\n\n    addToRecentlyClosedTabs(noteContexts, position) {\n        if (noteContexts.length === 1 && noteContexts[0].isEmpty()) {\n            return;\n        }\n\n        this.recentlyClosedTabs.push({contexts: noteContexts, position: position});\n    }\n\n    tabReorderEvent({ntxIdsInOrder}) {\n        const order = {};\n\n        let i = 0;\n\n        for (const ntxId of ntxIdsInOrder) {\n            for (const noteContext of this.getNoteContextById(ntxId).getSubContexts()) {\n                order[noteContext.ntxId] = i++;\n            }\n        }\n\n        this.children.sort((a, b) => order[a.ntxId] < order[b.ntxId] ? -1 : 1);\n\n        this.tabsUpdate.scheduleUpdate();\n    }\n\n    noteContextReorderEvent({ntxIdsInOrder, oldMainNtxId, newMainNtxId}) {\n        const order = Object.fromEntries(ntxIdsInOrder.map((v, i) => [v, i]));\n\n        this.children.sort((a, b) => order[a.ntxId] < order[b.ntxId] ? -1 : 1);\n\n        if (oldMainNtxId && newMainNtxId) {\n            this.children.forEach(c => {\n                if (c.ntxId === newMainNtxId) {\n                    // new main context has null mainNtxId\n                    c.mainNtxId = null;\n                } else if (c.ntxId === oldMainNtxId || c.mainNtxId === oldMainNtxId) {\n                    // old main context or subcontexts all have the new mainNtxId\n                    c.mainNtxId = newMainNtxId;\n                }\n            });\n        }\n\n        this.tabsUpdate.scheduleUpdate();\n    }\n\n    async activateNextTabCommand() {\n        const activeMainNtxId = this.getActiveMainContext().ntxId;\n\n        const oldIdx = this.mainNoteContexts.findIndex(nc => nc.ntxId === activeMainNtxId);\n        const newActiveNtxId = this.mainNoteContexts[oldIdx === this.mainNoteContexts.length - 1 ? 0 : oldIdx + 1].ntxId;\n\n        await this.activateNoteContext(newActiveNtxId);\n    }\n\n    async activatePreviousTabCommand() {\n        const activeMainNtxId = this.getActiveMainContext().ntxId;\n\n        const oldIdx = this.mainNoteContexts.findIndex(nc => nc.ntxId === activeMainNtxId);\n        const newActiveNtxId = this.mainNoteContexts[oldIdx === 0 ? this.mainNoteContexts.length - 1 : oldIdx - 1].ntxId;\n\n        await this.activateNoteContext(newActiveNtxId);\n    }\n\n    async closeActiveTabCommand() {\n        await this.removeNoteContext(this.activeNtxId);\n    }\n\n    beforeUnloadEvent() {\n        this.tabsUpdate.updateNowIfNecessary();\n\n        return true; // don't block closing the tab, this metadata is not that important\n    }\n\n    openNewTabCommand() {\n        this.openAndActivateEmptyTab();\n    }\n\n    async closeAllTabsCommand() {\n        for (const ntxIdToRemove of this.mainNoteContexts.map(nc => nc.ntxId)) {\n            await this.removeNoteContext(ntxIdToRemove);\n        }\n    }\n\n    async closeOtherTabsCommand({ntxId}) {\n        for (const ntxIdToRemove of this.mainNoteContexts.map(nc => nc.ntxId)) {\n            if (ntxIdToRemove !== ntxId) {\n                await this.removeNoteContext(ntxIdToRemove);\n            }\n        }\n    }\n\n    async closeTabCommand({ntxId}) {\n        await this.removeNoteContext(ntxId);\n    }\n\n    async moveTabToNewWindowCommand({ntxId}) {\n        const {notePath, hoistedNoteId} = this.getNoteContextById(ntxId);\n\n        const removed = await this.removeNoteContext(ntxId);\n\n        if (removed) {\n            this.triggerCommand('openInWindow', {notePath, hoistedNoteId});\n        }\n    }\n\n    async reopenLastTabCommand() {\n        let closeLastEmptyTab = null;\n\n        await this.mutex.runExclusively(async () => {\n            if (this.recentlyClosedTabs.length === 0) {\n                return;\n            }\n\n            if (this.noteContexts.length === 1 && this.noteContexts[0].isEmpty()) {\n                // new empty tab is created after closing the last tab, this reverses the empty tab creation\n                closeLastEmptyTab = this.noteContexts[0];\n            }\n\n            const lastClosedTab = this.recentlyClosedTabs.pop();\n            const noteContexts = lastClosedTab.contexts;\n\n            for (const noteContext of noteContexts) {\n                this.child(noteContext);\n\n                await this.triggerEvent('newNoteContextCreated', {noteContext});\n            }\n\n            //  restore last position of contexts stored in tab manager\n            const ntxsInOrder = [\n                ...this.noteContexts.slice(0, lastClosedTab.position),\n                ...this.noteContexts.slice(-noteContexts.length),\n                ...this.noteContexts.slice(lastClosedTab.position, -noteContexts.length),\n            ]\n            await this.noteContextReorderEvent({ntxIdsInOrder: ntxsInOrder.map(nc => nc.ntxId)});\n\n            let mainNtx = noteContexts.find(nc => nc.isMainContext());\n            if (mainNtx) {\n                // reopened a tab, need to reorder new tab widget in tab row\n                await this.triggerEvent('contextsReopened', {\n                    mainNtxId: mainNtx.ntxId,\n                    tabPosition: ntxsInOrder.filter(nc => nc.isMainContext()).findIndex(nc => nc.ntxId === mainNtx.ntxId)\n                });\n            } else {\n                // reopened a single split, need to reorder the pane widget in split note container\n                await this.triggerEvent('contextsReopened', {\n                    ntxId: ntxsInOrder[lastClosedTab.position].ntxId,\n                    // this is safe since lastClosedTab.position can never be 0 in this case\n                    afterNtxId: ntxsInOrder[lastClosedTab.position - 1].ntxId\n                });\n            }\n\n            const noteContextToActivate = noteContexts.length === 1\n                ? noteContexts[0]\n                : noteContexts.find(nc => nc.isMainContext());\n\n            await this.activateNoteContext(noteContextToActivate.ntxId);\n\n            await this.triggerEvent('noteSwitched', {\n                noteContext: noteContextToActivate,\n                notePath: noteContextToActivate.notePath\n            });\n        });\n\n        if (closeLastEmptyTab) {\n            await this.removeNoteContext(closeLastEmptyTab.ntxId);\n        }\n    }\n\n    hoistedNoteChangedEvent() {\n        this.tabsUpdate.scheduleUpdate();\n    }\n\n    async updateDocumentTitle(activeNoteContext) {\n        const titleFragments = [\n            // it helps to navigate in history if note title is included in the title\n            await activeNoteContext.getNavigationTitle(),\n            \"Trilium Notes\"\n        ].filter(Boolean);\n\n        document.title = titleFragments.join(\" - \");\n    }\n\n    async entitiesReloadedEvent({loadResults}) {\n        const activeContext = this.getActiveContext();\n\n        if (activeContext && loadResults.isNoteReloaded(activeContext.noteId)) {\n            await this.updateDocumentTitle(activeContext);\n        }\n    }\n\n    async frocaReloadedEvent() {\n        const activeContext = this.getActiveContext();\n\n        if (activeContext) {\n            await this.updateDocumentTitle(activeContext);\n        }\n    }\n}\n","import Component from \"./component.js\";\nimport appContext from \"./app_context.js\";\n\nexport default class MobileScreenSwitcherExecutor extends Component {\n    setActiveScreenCommand({screen}) {\n        if (screen !== this.activeScreen) {\n            this.activeScreen = screen;\n\n            if (screen === 'tree') {\n                const activeNoteContext = appContext.tabManager.getActiveContext();\n\n                activeNoteContext.setEmpty();\n            }\n\n            this.triggerEvent('activeScreenChanged', {activeScreen: screen});\n        }\n    }\n}\n","import appContext from \"./app_context.js\";\nimport noteCreateService from \"../services/note_create.js\";\nimport treeService from \"../services/tree.js\";\nimport hoistedNoteService from \"../services/hoisted_note.js\";\nimport Component from \"./component.js\";\n\n/**\n * This class contains command executors which logically belong to the NoteTree widget, but for better user experience,\n * the keyboard shortcuts must be active on the whole screen and not just on the widget itself, so the executors\n * must be at the root of the component tree.\n */\nexport default class MainTreeExecutors extends Component {\n    get tree() {\n        return appContext.noteTreeWidget;\n    }\n\n    async cloneNotesToCommand() {\n        const selectedOrActiveNoteIds = this.tree.getSelectedOrActiveNodes().map(node => node.data.noteId);\n\n        this.triggerCommand('cloneNoteIdsTo', {noteIds: selectedOrActiveNoteIds});\n    }\n\n    async moveNotesToCommand() {\n        const selectedOrActiveBranchIds = this.tree.getSelectedOrActiveNodes().map(node => node.data.branchId);\n\n        this.triggerCommand('moveBranchIdsTo', {branchIds: selectedOrActiveBranchIds});\n    }\n\n    async createNoteIntoCommand() {\n        const activeNoteContext = appContext.tabManager.getActiveContext();\n\n        if (!activeNoteContext) {\n            return;\n        }\n\n        await noteCreateService.createNote(activeNoteContext.notePath, {\n            isProtected: activeNoteContext.note.isProtected,\n            saveSelection: false\n        });\n    }\n\n    async createNoteAfterCommand() {\n        const node = this.tree.getActiveNode();\n\n        if (!node) {\n            return;\n        }\n\n        const parentNotePath = treeService.getNotePath(node.getParent());\n        const isProtected = treeService.getParentProtectedStatus(node);\n\n        if (node.data.noteId === 'root' || node.data.noteId === hoistedNoteService.getHoistedNoteId()) {\n            return;\n        }\n\n        await noteCreateService.createNote(parentNotePath, {\n            target: 'after',\n            targetBranchId: node.data.branchId,\n            isProtected: isProtected,\n            saveSelection: false\n        });\n    }\n}\n","import appContext from \"./app_context.js\";\nimport shortcutService from \"../services/shortcuts.js\";\nimport server from \"../services/server.js\";\nimport Component from \"./component.js\";\nimport froca from \"../services/froca.js\";\n\nexport default class ShortcutComponent extends Component {\n    constructor() {\n        super();\n\n        server.get('keyboard-shortcuts-for-notes').then(shortcutAttributes => {\n            for (const attr of shortcutAttributes) {\n                this.bindNoteShortcutHandler(attr);\n            }\n        });\n    }\n\n    bindNoteShortcutHandler(labelOrRow) {\n        const handler = () => appContext.tabManager.getActiveContext().setNote(labelOrRow.noteId);\n        const namespace = labelOrRow.attributeId;\n\n        if (labelOrRow.isDeleted) { // only applicable if row\n            shortcutService.removeGlobalShortcut(namespace);\n        } else {\n            shortcutService.bindGlobalShortcut(labelOrRow.value, handler, namespace);\n        }\n    }\n\n    async entitiesReloadedEvent({loadResults}) {\n        for (const attr of loadResults.getAttributeRows()) {\n            if (attr.type === 'label' && attr.name === 'keyboardShortcut') {\n                const note = await froca.getNote(attr.noteId);\n                // launcher shortcuts are handled specifically\n                if (note && note.type !== 'launcher') {\n                    this.bindNoteShortcutHandler(attr);\n                }\n            }\n        }\n    }\n}\n","import froca from \"../services/froca.js\";\nimport bundleService from \"../services/bundle.js\";\nimport RootCommandExecutor from \"./root_command_executor.js\";\nimport Entrypoints from \"./entrypoints.js\";\nimport options from \"../services/options.js\";\nimport utils from \"../services/utils.js\";\nimport zoomComponent from \"./zoom.js\";\nimport TabManager from \"./tab_manager.js\";\nimport Component from \"./component.js\";\nimport keyboardActionsService from \"../services/keyboard_actions.js\";\nimport linkService from \"../services/link.js\";\nimport MobileScreenSwitcherExecutor from \"./mobile_screen_switcher.js\";\nimport MainTreeExecutors from \"./main_tree_executors.js\";\nimport toast from \"../services/toast.js\";\nimport ShortcutComponent from \"./shortcut_component.js\";\n\nclass AppContext extends Component {\n    constructor(isMainWindow) {\n        super();\n\n        this.isMainWindow = isMainWindow;\n        // non-widget/layout components needed for the application\n        this.components = [];\n        this.beforeUnloadListeners = [];\n    }\n\n    setLayout(layout) {\n        this.layout = layout;\n    }\n\n    async start() {\n        this.initComponents();\n\n        // options are often needed for isEnabled()\n        await options.initializedPromise;\n\n        this.renderWidgets();\n\n        await froca.initializedPromise;\n\n        this.tabManager.loadTabs();\n\n        setTimeout(() => bundleService.executeStartupBundles(), 2000);\n    }\n\n    initComponents() {\n        this.tabManager = new TabManager();\n\n        this.components = [\n            this.tabManager,\n            new RootCommandExecutor(),\n            new Entrypoints(),\n            new MainTreeExecutors(),\n            new ShortcutComponent()\n        ];\n\n        if (utils.isMobile()) {\n            this.components.push(new MobileScreenSwitcherExecutor());\n        }\n\n        for (const component of this.components) {\n            this.child(component);\n        }\n\n        if (utils.isElectron()) {\n            this.child(zoomComponent);\n        }\n    }\n\n    renderWidgets() {\n        const rootWidget = this.layout.getRootWidget(this);\n        const $renderedWidget = rootWidget.render();\n\n        keyboardActionsService.updateDisplayedShortcuts($renderedWidget);\n\n        $(\"body\").append($renderedWidget);\n\n        $renderedWidget.on('click', \"[data-trigger-command]\", function() {\n            if ($(this).hasClass(\"disabled\")) {\n                return;\n            }\n\n            const commandName = $(this).attr('data-trigger-command');\n            const $component = $(this).closest(\".component\");\n            const component = $component.prop(\"component\");\n\n            component.triggerCommand(commandName, {$el: $(this)});\n        });\n\n        this.child(rootWidget);\n\n        this.triggerEvent('initialRenderComplete');\n    }\n\n    /** @returns {Promise<void>} */\n    triggerEvent(name, data = {}) {\n        return this.handleEvent(name, data);\n    }\n\n    /** @returns {Promise<*>} */\n    triggerCommand(name, data = {}) {\n        for (const executor of this.components) {\n            const fun = executor[`${name}Command`];\n\n            if (fun) {\n                return executor.callMethod(fun, data);\n            }\n        }\n\n        // this might hint at error, but sometimes this is used by components which are at different places\n        // in the component tree to communicate with each other\n        console.debug(`Unhandled command ${name}, converting to event.`);\n\n        return this.triggerEvent(name, data);\n    }\n\n    getComponentByEl(el) {\n        return $(el).closest(\".component\").prop('component');\n    }\n\n    addBeforeUnloadListener(obj) {\n        if (typeof WeakRef !== \"function\") {\n            // older browsers don't support WeakRef\n            return;\n        }\n\n        this.beforeUnloadListeners.push(new WeakRef(obj));\n    }\n}\n\nconst appContext = new AppContext(window.glob.isMainWindow);\n\n// we should save all outstanding changes before the page/app is closed\n$(window).on('beforeunload', () => {\n    let allSaved = true;\n\n    appContext.beforeUnloadListeners = appContext.beforeUnloadListeners.filter(wr => !!wr.deref());\n\n    for (const weakRef of appContext.beforeUnloadListeners) {\n        const component = weakRef.deref();\n\n        if (!component) {\n            continue;\n        }\n\n        if (!component.beforeUnloadEvent()) {\n            console.log(`Component ${component.componentId} is not finished saving its state.`);\n\n            toast.showMessage(\"请等待几秒钟以完成保存, 然后可以重试.\", 10000);\n\n            allSaved = false;\n        }\n    }\n\n    if (!allSaved) {\n        return \"some string\";\n    }\n});\n\n$(window).on('hashchange', function() {\n    const {notePath, ntxId, viewScope} = linkService.parseNavigationStateFromUrl(window.location.href);\n\n    if (notePath || ntxId) {\n        appContext.tabManager.switchToNoteContext(ntxId, notePath, viewScope);\n    }\n});\n\nexport default appContext;\n","import utils from '../services/utils.js';\n\n/**\n * Abstract class for all components in the Trilium's frontend.\n *\n * Contains also event implementation with following properties:\n * - event / command distribution is synchronous which among others mean that events are well-ordered - event\n *   which was sent out first will also be processed first by the component\n * - execution of the event / command is asynchronous - each component executes the event on its own without regard for\n *   other components.\n * - although the execution is async, we are collecting all the promises, and therefore it is possible to wait until the\n *   event / command is executed in all components - by simply awaiting the `triggerEvent()`.\n */\nexport default class Component {\n    constructor() {\n        this.componentId = `${this.sanitizedClassName}-${utils.randomString(8)}`;\n        /** @type Component[] */\n        this.children = [];\n        this.initialized = null;\n    }\n\n    get sanitizedClassName() {\n        // webpack mangles names and sometimes uses unsafe characters\n        return this.constructor.name.replace(/[^A-Z0-9]/ig, \"_\");\n    }\n\n    setParent(parent) {\n        /** @type Component */\n        this.parent = parent;\n        return this;\n    }\n\n    child(...components) {\n        for (const component of components) {\n            component.setParent(this);\n\n            this.children.push(component);\n        }\n\n        return this;\n    }\n\n    /** @returns {Promise<void>} */\n    handleEvent(name, data) {\n        try {\n            const callMethodPromise = this.initialized\n                ? this.initialized.then(() => this.callMethod(this[`${name}Event`], data))\n                : this.callMethod(this[`${name}Event`], data);\n\n            const childrenPromise = this.handleEventInChildren(name, data);\n\n            // don't create promises if not needed (optimization)\n            return callMethodPromise && childrenPromise\n                ? Promise.all([callMethodPromise, childrenPromise])\n                : (callMethodPromise || childrenPromise);\n        }\n        catch (e) {\n            console.error(`Handling of event '${name}' failed in ${this.constructor.name} with error ${e.message} ${e.stack}`);\n\n            return null;\n        }\n    }\n\n    /** @returns {Promise<void>} */\n    triggerEvent(name, data = {}) {\n        return this.parent.triggerEvent(name, data);\n    }\n\n    /** @returns {Promise<void>} */\n    handleEventInChildren(name, data = {}) {\n        const promises = [];\n\n        for (const child of this.children) {\n            const ret = child.handleEvent(name, data);\n\n            if (ret) {\n                promises.push(ret);\n            }\n        }\n\n        // don't create promises if not needed (optimization)\n        return promises.length > 0 ? Promise.all(promises) : null;\n    }\n\n    /** @returns {Promise<*>} */\n    triggerCommand(name, data = {}) {\n        const fun = this[`${name}Command`];\n\n        if (fun) {\n            return this.callMethod(fun, data);\n        }\n        else {\n            return this.parent.triggerCommand(name, data);\n        }\n    }\n\n    callMethod(fun, data) {\n        if (typeof fun !== 'function') {\n            return;\n        }\n\n        const startTime = Date.now();\n\n        const promise = fun.call(this, data);\n\n        const took = Date.now() - startTime;\n\n        if (glob.isDev && took > 20) { // measuring only sync handlers\n            console.log(`Call to ${fun.name} in ${this.componentId} took ${took}ms`);\n        }\n\n        if (glob.isDev && promise) {\n            return utils.timeLimit(promise, 20000, `Time limit failed on ${this.constructor.name} with ${fun.name}`);\n        }\n\n        return promise;\n    }\n}\n","import options from \"../services/options.js\";\nimport Component from \"./component.js\";\nimport utils from \"../services/utils.js\";\n\nconst MIN_ZOOM = 0.5;\nconst MAX_ZOOM = 2.0;\n\nclass ZoomComponent extends Component {\n    constructor() {\n        super();\n\n        if (utils.isElectron()) {\n            options.initializedPromise.then(() => {\n                this.setZoomFactor(options.getFloat('zoomFactor'));\n            });\n\n            window.addEventListener(\"wheel\", event => {\n                if (event.ctrlKey) {\n                    this.setZoomFactorAndSave(this.getCurrentZoom() + event.deltaY * 0.001);\n                }\n            });\n        }\n    }\n\n    setZoomFactor(zoomFactor) {\n        zoomFactor = parseFloat(zoomFactor);\n\n        const webFrame = utils.dynamicRequire('electron').webFrame;\n        webFrame.setZoomFactor(zoomFactor);\n    }\n\n    async setZoomFactorAndSave(zoomFactor) {\n        if (zoomFactor >= MIN_ZOOM && zoomFactor <= MAX_ZOOM) {\n            zoomFactor = Math.round(zoomFactor * 10) / 10;\n\n            this.setZoomFactor(zoomFactor);\n\n            await options.save('zoomFactor', zoomFactor);\n        }\n        else {\n            console.log(`Zoom factor ${zoomFactor} outside of the range, ignored.`);\n        }\n    }\n\n    getCurrentZoom() {\n        return utils.dynamicRequire('electron').webFrame.getZoomFactor();\n    }\n\n    zoomOutEvent() {\n        this.setZoomFactorAndSave(this.getCurrentZoom() - 0.1);\n    }\n\n    zoomInEvent() {\n        this.setZoomFactorAndSave(this.getCurrentZoom() + 0.1);\n    }\n    zoomResetEvent() {\n        this.setZoomFactorAndSave(1);\n    }\n    \n    setZoomFactorAndSaveEvent({zoomFactor}) {\n        this.setZoomFactorAndSave(zoomFactor);\n    }\n}\n\nconst zoomService = new ZoomComponent();\n\nexport default zoomService;\n","/**\n * Attachment is a file directly tied into a note without\n * being a hidden child.\n */\nclass FAttachment {\n    constructor(froca, row) {\n        /** @type {Froca} */\n        this.froca = froca;\n\n        this.update(row);\n    }\n\n    update(row) {\n        /** @type {string} */\n        this.attachmentId = row.attachmentId;\n        /** @type {string} */\n        this.ownerId = row.ownerId;\n        /** @type {string} */\n        this.role = row.role;\n        /** @type {string} */\n        this.mime = row.mime;\n        /** @type {string} */\n        this.title = row.title;\n        /** @type {string} */\n        this.dateModified = row.dateModified;\n        /** @type {string} */\n        this.utcDateModified = row.utcDateModified;\n        /** @type {string} */\n        this.utcDateScheduledForErasureSince = row.utcDateScheduledForErasureSince;\n\n        /**\n         * optionally added to the entity \n         * @type {int}\n         */\n        this.contentLength = row.contentLength;\n\n        this.froca.attachments[this.attachmentId] = this;\n    }\n\n    /** @returns {FNote} */\n    getNote() {\n        return this.froca.notes[this.ownerId];\n    }\n\n    /** @return {FBlob} */\n    async getBlob() {\n        return await this.froca.getBlob('attachments', this.attachmentId);\n    }\n}\n\nexport default FAttachment;\n","import promotedAttributeDefinitionParser from '../services/promoted_attribute_definition_parser.js';\n\n/**\n * There are currently only two types of attributes, labels or relations.\n * @typedef {\"label\" | \"relation\"} AttributeType\n */\n\n/**\n * Attribute is an abstract concept which has two real uses - label (key - value pair)\n * and relation (representing named relationship between source and target note)\n */\nclass FAttribute {\n    constructor(froca, row) {\n        /** @type {Froca} */\n        this.froca = froca;\n\n        this.update(row);\n    }\n\n    update(row) {\n        /** @type {string} */\n        this.attributeId = row.attributeId;\n        /** @type {string} */\n        this.noteId = row.noteId;\n        /** @type {AttributeType} */\n        this.type = row.type;\n        /** @type {string} */\n        this.name = row.name;\n        /** @type {string} */\n        this.value = row.value;\n        /** @type {int} */\n        this.position = row.position;\n        /** @type {boolean} */\n        this.isInheritable = !!row.isInheritable;\n    }\n\n    /** @returns {FNote} */\n    getNote() {\n        return this.froca.notes[this.noteId];\n    }\n\n    /** @returns {Promise<FNote>} */\n    async getTargetNote() {\n        const targetNoteId = this.targetNoteId;\n\n        return await this.froca.getNote(targetNoteId, true);\n    }\n\n    get targetNoteId() { // alias\n        if (this.type !== 'relation') {\n            throw new Error(`Attribute ${this.attributeId} is not a relation`);\n        }\n\n        return this.value;\n    }\n\n    get isAutoLink() {\n        return this.type === 'relation' && ['internalLink', 'imageLink', 'relationMapLink', 'includeNoteLink'].includes(this.name);\n    }\n\n    get toString() {\n        return `FAttribute(attributeId=${this.attributeId}, type=${this.type}, name=${this.name}, value=${this.value})`;\n    }\n\n    isDefinition() {\n        return this.type === 'label' && (this.name.startsWith('label:') || this.name.startsWith('relation:'));\n    }\n\n    getDefinition() {\n        return promotedAttributeDefinitionParser.parse(this.value);\n    }\n\n    isDefinitionFor(attr) {\n        return this.type === 'label' && this.name === `${attr.type}:${attr.name}`;\n    }\n\n    get dto() {\n        const dto = Object.assign({}, this);\n        delete dto.froca;\n\n        return dto;\n    }\n}\n\nexport default FAttribute;\n","/**\n * Branch represents a relationship between a child note and its parent note. Trilium allows a note to have multiple\n * parents.\n */\nclass FBranch {\n    constructor(froca, row) {\n        /** @type {Froca} */\n        this.froca = froca;\n\n        this.update(row);\n    }\n\n    update(row) {\n        /**\n         * primary key\n         * @type {string}\n         */\n        this.branchId = row.branchId;\n        /** @type {string} */\n        this.noteId = row.noteId;\n        /** @type {string} */\n        this.parentNoteId = row.parentNoteId;\n        /** @type {int} */\n        this.notePosition = row.notePosition;\n        /** @type {string} */\n        this.prefix = row.prefix;\n        /** @type {boolean} */\n        this.isExpanded = !!row.isExpanded;\n        /** @type {boolean} */\n        this.fromSearchNote = !!row.fromSearchNote;\n    }\n\n    /** @returns {FNote} */\n    async getNote() {\n        return this.froca.getNote(this.noteId);\n    }\n\n    /** @returns {FNote} */\n    getNoteFromCache() {\n        return this.froca.getNoteFromCache(this.noteId);\n    }\n\n    /** @returns {FNote} */\n    async getParentNote() {\n        return this.froca.getNote(this.parentNoteId);\n    }\n\n    /** @returns {boolean} true if it's top level, meaning its parent is the root note */\n    isTopLevel() {\n        return this.parentNoteId === 'root';\n    }\n\n    get toString() {\n        return `FBranch(branchId=${this.branchId})`;\n    }\n\n    get pojo() {\n        const pojo = {...this};\n        delete pojo.froca;\n        return pojo;\n    }\n}\n\nexport default FBranch;\n","const registeredClasses = new Set();\n\nfunction createClassForColor(color) {\n    if (!color?.trim()) {\n        return \"\";\n    }\n\n    const normalizedColorName = color.replace(/[^a-z0-9]/gi, \"\");\n\n    if (!normalizedColorName.trim()) {\n        return \"\";\n    }\n\n    const className = `color-${normalizedColorName}`;\n\n    if (!registeredClasses.has(className)) {\n        // make the active fancytree selector more specific than the normal color setting\n        $(\"head\").append(`<style>.${className}, span.fancytree-active.${className} { color: ${color} !important; }</style>`);\n\n        registeredClasses.add(className);\n    }\n\n    return className;\n}\n\nexport default {\n    createClassForColor\n};\n","import server from '../services/server.js';\nimport noteAttributeCache from \"../services/note_attribute_cache.js\";\nimport ws from \"../services/ws.js\";\nimport froca from \"../services/froca.js\";\nimport protectedSessionHolder from \"../services/protected_session_holder.js\";\nimport cssClassManager from \"../services/css_class_manager.js\";\n\nconst LABEL = 'label';\nconst RELATION = 'relation';\n\nconst NOTE_TYPE_ICONS = {\n    \"file\": \"bx bx-file\",\n    \"image\": \"bx bx-image\",\n    \"code\": \"bx bx-code\",\n    \"render\": \"bx bx-extension\",\n    \"search\": \"bx bx-file-find\",\n    \"relationMap\": \"bx bx-map-alt\",\n    \"book\": \"bx bx-book\",\n    \"noteMap\": \"bx bx-map-alt\",\n    \"mermaid\": \"bx bx-selection\",\n    \"canvas\": \"bx bx-pen\",\n    \"webView\": \"bx bx-globe-alt\",\n    \"launcher\": \"bx bx-link\",\n    \"doc\": \"bx bxs-file-doc\",\n    \"contentWidget\": \"bx bxs-widget\"\n};\n\n/**\n * There are many different Note types, some of which are entirely opaque to the\n * end user. Those types should be used only for checking against, they are\n * not for direct use.\n * @typedef {\"file\" | \"image\" | \"search\" | \"noteMap\" | \"launcher\" | \"doc\" | \"contentWidget\" | \"text\" | \"relationMap\" | \"render\" | \"canvas\" | \"mermaid\" | \"book\" | \"webView\" | \"code\"} NoteType\n */\n\n/**\n * @typedef {Object} NotePathRecord\n * @property {boolean} isArchived\n * @property {boolean} isInHoistedSubTree\n * @property {boolean} isSearch\n * @property {Array<string>} notePath\n * @property {boolean} isHidden\n */\n\n/**\n * Note is the main node and concept in Trilium.\n */\nclass FNote {\n    /**\n     * @param {Froca} froca\n     * @param {Object.<string, Object>} row\n     */\n    constructor(froca, row) {\n        /** @type {Froca} */\n        this.froca = froca;\n\n        /** @type {string[]} */\n        this.attributes = [];\n\n        /** @type {string[]} */\n        this.targetRelations = [];\n\n        /** @type {string[]} */\n        this.parents = [];\n        /** @type {string[]} */\n        this.children = [];\n\n        /** @type {Object.<string, string>} */\n        this.parentToBranch = {};\n\n        /** @type {Object.<string, string>} */\n        this.childToBranch = {};\n\n        /** @type {FAttachment[]|null} */\n        this.attachments = null; // lazy loaded\n\n        this.update(row);\n    }\n\n    update(row) {\n        /** @type {string} */\n        this.noteId = row.noteId;\n        /** @type {string} */\n        this.title = row.title;\n        /** @type {boolean} */\n        this.isProtected = !!row.isProtected;\n        /**\n         * See {@see NoteType} for info on values.\n         * @type {NoteType}\n         */\n        this.type = row.type;\n        /**\n         * content-type, e.g. \"application/json\"\n         * @type {string}\n         */\n        this.mime = row.mime;\n\n        // the main use case to keep this is to detect content change which should trigger refresh\n        this.blobId = row.blobId;\n    }\n\n    addParent(parentNoteId, branchId, sort = true) {\n        if (parentNoteId === 'none') {\n            return;\n        }\n\n        if (!this.parents.includes(parentNoteId)) {\n            this.parents.push(parentNoteId);\n        }\n\n        this.parentToBranch[parentNoteId] = branchId;\n\n        if (sort) {\n            this.sortParents();\n        }\n    }\n\n    addChild(childNoteId, branchId, sort = true) {\n        if (!(childNoteId in this.childToBranch)) {\n            this.children.push(childNoteId);\n        }\n\n        this.childToBranch[childNoteId] = branchId;\n\n        if (sort) {\n            this.sortChildren();\n        }\n    }\n\n    sortChildren() {\n        const branchIdPos = {};\n\n        for (const branchId of Object.values(this.childToBranch)) {\n            branchIdPos[branchId] = this.froca.getBranch(branchId).notePosition;\n        }\n\n        this.children.sort((a, b) => branchIdPos[this.childToBranch[a]] - branchIdPos[this.childToBranch[b]]);\n    }\n\n    /** @returns {boolean} */\n    isJson() {\n        return this.mime === \"application/json\";\n    }\n\n    async getContent() {\n        const blob = await this.getBlob();\n\n        return blob?.content;\n    }\n\n    async getJsonContent() {\n        const content = await this.getContent();\n\n        try {\n            return JSON.parse(content);\n        }\n        catch (e) {\n            console.log(`Cannot parse content of note '${this.noteId}': `, e.message);\n\n            return null;\n        }\n    }\n\n    /**\n     * @returns {string[]}\n     */\n    getParentBranchIds() {\n        return Object.values(this.parentToBranch);\n    }\n\n    /**\n     * @returns {string[]}\n     * @deprecated use getParentBranchIds() instead\n     */\n    getBranchIds() {\n        return this.getParentBranchIds();\n    }\n\n    /**\n     * @returns {FBranch[]}\n     */\n    getParentBranches() {\n        const branchIds = Object.values(this.parentToBranch);\n\n        return this.froca.getBranches(branchIds);\n    }\n\n    /**\n     * @returns {FBranch[]}\n     * @deprecated use getParentBranches() instead\n     */\n    getBranches() {\n        return this.getParentBranches();\n    }\n\n    /** @returns {boolean} */\n    hasChildren() {\n        return this.children.length > 0;\n    }\n\n    /** @returns {FBranch[]} */\n    getChildBranches() {\n        // don't use Object.values() to guarantee order\n        const branchIds = this.children.map(childNoteId => this.childToBranch[childNoteId]);\n\n        return this.froca.getBranches(branchIds);\n    }\n\n    /** @returns {string[]} */\n    getParentNoteIds() {\n        return this.parents;\n    }\n\n    /** @returns {FNote[]} */\n    getParentNotes() {\n        return this.froca.getNotesFromCache(this.parents);\n    }\n\n    // will sort the parents so that non-search & non-archived are first and archived at the end\n    // this is done so that non-search & non-archived paths are always explored as first when looking for a note path\n    sortParents() {\n        this.parents.sort((aNoteId, bNoteId) => {\n            const aBranchId = this.parentToBranch[aNoteId];\n\n            if (aBranchId && aBranchId.startsWith('virt-')) {\n                return 1;\n            }\n\n            const aNote = this.froca.getNoteFromCache(aNoteId);\n\n            if (aNote.isArchived || aNote.isHiddenCompletely()) {\n                return 1;\n            }\n\n            return aNoteId < bNoteId ? -1 : 1;\n        });\n    }\n\n    get isArchived() {\n        return this.hasAttribute('label', 'archived');\n    }\n\n    /** @returns {string[]} */\n    getChildNoteIds() {\n        return this.children;\n    }\n\n    /** @returns {Promise<FNote[]>} */\n    async getChildNotes() {\n        return await this.froca.getNotes(this.children);\n    }\n\n    /** @returns {Promise<FAttachment[]>} */\n    async getAttachments() {\n        if (!this.attachments) {\n            this.attachments = await this.froca.getAttachmentsForNote(this.noteId);\n        }\n\n        return this.attachments;\n    }\n\n    /** @returns {Promise<FAttachment[]>} */\n    async getAttachmentsByRole(role) {\n        return (await this.getAttachments())\n            .filter(attachment => attachment.role === role);\n    }\n\n    /** @returns {Promise<FAttachment>} */\n    async getAttachmentById(attachmentId) {\n        const attachments = await this.getAttachments();\n\n        return attachments.find(att => att.attachmentId === attachmentId);\n    }\n\n    isEligibleForConversionToAttachment() {\n        if (this.type !== 'image' || !this.isContentAvailable() || this.hasChildren() || this.getParentBranches().length !== 1) {\n            return false;\n        }\n\n        const targetRelations = this.getTargetRelations().filter(relation => relation.name === 'imageLink');\n\n        if (targetRelations.length > 1) {\n            return false;\n        }\n\n        const parentNote = this.getParentNotes()[0]; // at this point note can have only one parent\n        const referencingNote = targetRelations[0]?.getNote();\n\n        if (referencingNote && referencingNote !== parentNote) {\n            return false;\n        } else if (parentNote.type !== 'text' || !parentNote.isContentAvailable()) {\n            return false;\n        }\n\n        return true;\n    }\n\n    /**\n     * @param {string} [type] - (optional) attribute type to filter\n     * @param {string} [name] - (optional) attribute name to filter\n     * @returns {FAttribute[]} all note's attributes, including inherited ones\n     */\n    getOwnedAttributes(type, name) {\n        const attrs = this.attributes\n            .map(attributeId => this.froca.attributes[attributeId])\n            .filter(Boolean); // filter out nulls;\n\n        return this.__filterAttrs(attrs, type, name);\n    }\n\n    /**\n     * @param {string} [type] - (optional) attribute type to filter\n     * @param {string} [name] - (optional) attribute name to filter\n     * @returns {FAttribute[]} all note's attributes, including inherited ones\n     */\n    getAttributes(type, name) {\n        return this.__filterAttrs(this.__getCachedAttributes([]), type, name);\n    }\n\n    /**\n     * @param {string[]} path\n     * @return {FAttribute[]}\n     * @private\n     */\n    __getCachedAttributes(path) {\n        // notes/clones cannot form tree cycles, it is possible to create attribute inheritance cycle via templates\n        // when template instance is a parent of template itself\n        if (path.includes(this.noteId)) {\n            return [];\n        }\n\n        if (!(this.noteId in noteAttributeCache.attributes)) {\n            const newPath = [...path, this.noteId];\n            const attrArrs = [ this.getOwnedAttributes() ];\n\n            // inheritable attrs on root are typically not intended to be applied to hidden subtree #3537\n            if (this.noteId !== 'root' && this.noteId !== '_hidden') {\n                for (const parentNote of this.getParentNotes()) {\n                    // these virtual parent-child relationships are also loaded into froca\n                    if (parentNote.type !== 'search') {\n                        attrArrs.push(parentNote.__getInheritableAttributes(newPath));\n                    }\n                }\n            }\n\n            for (const templateAttr of attrArrs.flat().filter(attr => attr.type === 'relation' && ['template', 'inherit'].includes(attr.name))) {\n                const templateNote = this.froca.notes[templateAttr.value];\n\n                if (templateNote && templateNote.noteId !== this.noteId) {\n                    attrArrs.push(\n                        templateNote.__getCachedAttributes(newPath)\n                            // template attr is used as a marker for templates, but it's not meant to be inherited\n                            .filter(attr => !(attr.type === 'label' && (attr.name === 'template' || attr.name === 'workspacetemplate')))\n                    );\n                }\n            }\n\n            noteAttributeCache.attributes[this.noteId] = [];\n            const addedAttributeIds = new Set();\n\n            for (const attr of attrArrs.flat()) {\n                if (!addedAttributeIds.has(attr.attributeId)) {\n                    addedAttributeIds.add(attr.attributeId);\n\n                    noteAttributeCache.attributes[this.noteId].push(attr);\n                }\n            }\n        }\n\n        return noteAttributeCache.attributes[this.noteId];\n    }\n\n    isRoot() {\n        return this.noteId === 'root';\n    }\n\n    /**\n     * Gives all possible note paths leading to this note. Paths containing search note are ignored (could form cycles)\n     *\n     * @returns {string[][]} - array of notePaths (each represented by array of noteIds constituting the particular note path)\n     */\n    getAllNotePaths() {\n        if (this.noteId === 'root') {\n            return [['root']];\n        }\n\n        const parentNotes = this.getParentNotes().filter(note => note.type !== 'search');\n\n        const notePaths = parentNotes.length === 1\n            ? parentNotes[0].getAllNotePaths() // optimization for the most common case\n            : parentNotes.flatMap(parentNote => parentNote.getAllNotePaths());\n\n        for (const notePath of notePaths) {\n            notePath.push(this.noteId);\n        }\n\n        return notePaths;\n    }\n\n    /**\n     * @param {string} [hoistedNoteId='root']\n     * @return {Array<NotePathRecord>}\n     */\n    getSortedNotePathRecords(hoistedNoteId = 'root') {\n        const isHoistedRoot = hoistedNoteId === 'root';\n\n        const notePaths = this.getAllNotePaths().map(path => ({\n            notePath: path,\n            isInHoistedSubTree: isHoistedRoot || path.includes(hoistedNoteId),\n            isArchived: path.some(noteId => froca.notes[noteId].isArchived),\n            isSearch: path.find(noteId => froca.notes[noteId].type === 'search'),\n            isHidden: path.includes('_hidden')\n        }));\n\n        notePaths.sort((a, b) => {\n            if (a.isInHoistedSubTree !== b.isInHoistedSubTree) {\n                return a.isInHoistedSubTree ? -1 : 1;\n            } else if (a.isArchived !== b.isArchived) {\n                return a.isArchived ? 1 : -1;\n            } else if (a.isHidden !== b.isHidden) {\n                return a.isHidden ? 1 : -1;\n            } else if (a.isSearch !== b.isSearch) {\n                return a.isSearch ? 1 : -1;\n            } else {\n                return a.notePath.length - b.notePath.length;\n            }\n        });\n\n        return notePaths;\n    }\n\n    /**\n     * Returns the note path considered to be the \"best\"\n     *\n     * @param {string} [hoistedNoteId='root']\n     * @return {string[]} array of noteIds constituting the particular note path\n     */\n    getBestNotePath(hoistedNoteId = 'root') {\n        return this.getSortedNotePathRecords(hoistedNoteId)[0]?.notePath;\n    }\n\n    /**\n     * Returns the note path considered to be the \"best\"\n     *\n     * @param {string} [hoistedNoteId='root']\n     * @return {string} serialized note path (e.g. 'root/a1h315/js725h')\n     */\n    getBestNotePathString(hoistedNoteId = 'root') {\n        const notePath = this.getBestNotePath(hoistedNoteId);\n\n        return notePath?.join(\"/\");\n    }\n\n    /**\n     * @return boolean - true if there's no non-hidden path, note is not cloned to the visible tree\n     */\n    isHiddenCompletely() {\n        if (this.noteId === '_hidden') {\n            return true;\n        } else if (this.noteId === 'root') {\n            return false;\n        }\n\n        for (const parentNote of this.getParentNotes()) {\n            if (parentNote.noteId === 'root') {\n                return false;\n            } else if (parentNote.noteId === '_hidden' || parentNote.type === 'search') {\n                continue;\n            }\n\n            if (!parentNote.isHiddenCompletely()) {\n                return false;\n            }\n        }\n\n        return true;\n    }\n\n    /**\n     * @param {FAttribute[]} attributes\n     * @param {AttributeType} type\n     * @param {string} name\n     * @return {FAttribute[]}\n     * @private\n     */\n    __filterAttrs(attributes, type, name) {\n        this.__validateTypeName(type, name);\n\n        if (!type && !name) {\n            return attributes;\n        } else if (type && name) {\n            return attributes.filter(attr => attr.name === name && attr.type === type);\n        } else if (type) {\n            return attributes.filter(attr => attr.type === type);\n        } else if (name) {\n            return attributes.filter(attr => attr.name === name);\n        }\n    }\n\n    __getInheritableAttributes(path) {\n        const attrs = this.__getCachedAttributes(path);\n\n        return attrs.filter(attr => attr.isInheritable);\n    }\n\n    __validateTypeName(type, name) {\n        if (type && type !== 'label' && type !== 'relation') {\n            throw new Error(`Unrecognized attribute type '${type}'. Only 'label' and 'relation' are possible values.`);\n        }\n\n        if (name) {\n            const firstLetter = name.charAt(0);\n            if (firstLetter === '#' || firstLetter === '~') {\n                throw new Error(`Detect '#' or '~' in the attribute's name. In the API, attribute names should be set without these characters.`);\n            }\n        }\n    }\n\n    /**\n     * @param {string} [name] - label name to filter\n     * @returns {FAttribute[]} all note's labels (attributes with type label), including inherited ones\n     */\n    getOwnedLabels(name) {\n        return this.getOwnedAttributes(LABEL, name);\n    }\n\n    /**\n     * @param {string} [name] - label name to filter\n     * @returns {FAttribute[]} all note's labels (attributes with type label), including inherited ones\n     */\n    getLabels(name) {\n        return this.getAttributes(LABEL, name);\n    }\n\n    getIcon() {\n        const iconClassLabels = this.getLabels('iconClass');\n        const workspaceIconClass = this.getWorkspaceIconClass();\n\n        if (iconClassLabels.length > 0) {\n            return iconClassLabels[0].value;\n        }\n        else if (workspaceIconClass) {\n            return workspaceIconClass;\n        }\n        else if (this.noteId === 'root') {\n            return \"bx bx-chevrons-right\";\n        }\n        if (this.noteId === '_share') {\n            return \"bx bx-share-alt\";\n        }\n        else if (this.type === 'text') {\n            if (this.isFolder()) {\n                return \"bx bx-folder\";\n            }\n            else {\n                return \"bx bx-note\";\n            }\n        }\n        else if (this.type === 'code' && this.mime.startsWith('text/x-sql')) {\n            return \"bx bx-data\";\n        }\n        else {\n            return NOTE_TYPE_ICONS[this.type];\n        }\n    }\n\n    getColorClass() {\n        const color = this.getLabelValue(\"color\");\n        return cssClassManager.createClassForColor(color);\n    }\n\n    isFolder() {\n        return this.type === 'search'\n            || this.getFilteredChildBranches().length > 0;\n    }\n\n    getFilteredChildBranches() {\n        let childBranches = this.getChildBranches();\n\n        if (!childBranches) {\n            ws.logError(`No children for '${this.noteId}'. This shouldn't happen.`);\n            return;\n        }\n\n        // we're not checking hideArchivedNotes since that would mean we need to lazy load the child notes\n        // which would seriously slow down everything.\n        // we check this flag only once user chooses to expand the parent. This has the negative consequence that\n        // note may appear as a folder but not contain any children when all of them are archived\n\n        return childBranches;\n    }\n\n    /**\n     * @param {string} [name] - relation name to filter\n     * @returns {FAttribute[]} all note's relations (attributes with type relation), including inherited ones\n     */\n    getOwnedRelations(name) {\n        return this.getOwnedAttributes(RELATION, name);\n    }\n\n    /**\n     * @param {string} [name] - relation name to filter\n     * @returns {FAttribute[]} all note's relations (attributes with type relation), including inherited ones\n     */\n    getRelations(name) {\n        return this.getAttributes(RELATION, name);\n    }\n\n    /**\n     * @param {AttributeType} type - attribute type (label, relation, etc.)\n     * @param {string} name - attribute name\n     * @returns {boolean} true if note has an attribute with given type and name (including inherited)\n     */\n    hasAttribute(type, name) {\n        const attributes = this.getAttributes();\n\n        return attributes.some(attr => attr.name === name && attr.type === type);\n    }\n\n    /**\n     * @param {AttributeType} type - attribute type (label, relation, etc.)\n     * @param {string} name - attribute name\n     * @returns {boolean} true if note has an attribute with given type and name (including inherited)\n     */\n    hasOwnedAttribute(type, name) {\n        return !!this.getOwnedAttribute(type, name);\n    }\n\n    /**\n     * @param {AttributeType} type - attribute type (label, relation, etc.)\n     * @param {string} name - attribute name\n     * @returns {FAttribute} attribute of the given type and name. If there are more such attributes, first is returned. Returns null if there's no such attribute belonging to this note.\n     */\n    getOwnedAttribute(type, name) {\n        const attributes = this.getOwnedAttributes();\n\n        return attributes.find(attr => attr.name === name && attr.type === type);\n    }\n\n    /**\n     * @param {AttributeType} type - attribute type (label, relation, etc.)\n     * @param {string} name - attribute name\n     * @returns {FAttribute} attribute of the given type and name. If there are more such attributes, first is returned. Returns null if there's no such attribute belonging to this note.\n     */\n    getAttribute(type, name) {\n        const attributes = this.getAttributes();\n\n        return attributes.find(attr => attr.name === name && attr.type === type);\n    }\n\n    /**\n     * @param {AttributeType} type - attribute type (label, relation, etc.)\n     * @param {string} name - attribute name\n     * @returns {string} attribute value of the given type and name or null if no such attribute exists.\n     */\n    getOwnedAttributeValue(type, name) {\n        const attr = this.getOwnedAttribute(type, name);\n\n        return attr ? attr.value : null;\n    }\n\n    /**\n     * @param {AttributeType} type - attribute type (label, relation, etc.)\n     * @param {string} name - attribute name\n     * @returns {string} attribute value of the given type and name or null if no such attribute exists.\n     */\n    getAttributeValue(type, name) {\n        const attr = this.getAttribute(type, name);\n\n        return attr ? attr.value : null;\n    }\n\n    /**\n     * @param {string} name - label name\n     * @returns {boolean} true if label exists (excluding inherited)\n     */\n    hasOwnedLabel(name) { return this.hasOwnedAttribute(LABEL, name); }\n\n    /**\n     * @param {string} name - label name\n     * @returns {boolean} true if label exists (including inherited)\n     */\n    hasLabel(name) { return this.hasAttribute(LABEL, name); }\n\n    /**\n     * @param {string} name - label name\n     * @returns {boolean} true if label exists (including inherited) and does not have \"false\" value.\n     */\n    isLabelTruthy(name) {\n        const label = this.getLabel(name);\n\n        if (!label) {\n            return false;\n        }\n\n        return label && label.value !== 'false';\n    }\n\n    /**\n     * @param {string} name - relation name\n     * @returns {boolean} true if relation exists (excluding inherited)\n     */\n    hasOwnedRelation(name) { return this.hasOwnedAttribute(RELATION, name); }\n\n    /**\n     * @param {string} name - relation name\n     * @returns {boolean} true if relation exists (including inherited)\n     */\n    hasRelation(name) { return this.hasAttribute(RELATION, name); }\n\n    /**\n     * @param {string} name - label name\n     * @returns {FAttribute} label if it exists, null otherwise\n     */\n    getOwnedLabel(name) { return this.getOwnedAttribute(LABEL, name); }\n\n    /**\n     * @param {string} name - label name\n     * @returns {FAttribute} label if it exists, null otherwise\n     */\n    getLabel(name) { return this.getAttribute(LABEL, name); }\n\n    /**\n     * @param {string} name - relation name\n     * @returns {FAttribute} relation if it exists, null otherwise\n     */\n    getOwnedRelation(name) { return this.getOwnedAttribute(RELATION, name); }\n\n    /**\n     * @param {string} name - relation name\n     * @returns {FAttribute} relation if it exists, null otherwise\n     */\n    getRelation(name) { return this.getAttribute(RELATION, name); }\n\n    /**\n     * @param {string} name - label name\n     * @returns {string} label value if label exists, null otherwise\n     */\n    getOwnedLabelValue(name) { return this.getOwnedAttributeValue(LABEL, name); }\n\n    /**\n     * @param {string} name - label name\n     * @returns {string} label value if label exists, null otherwise\n     */\n    getLabelValue(name) { return this.getAttributeValue(LABEL, name); }\n\n    /**\n     * @param {string} name - relation name\n     * @returns {string} relation value if relation exists, null otherwise\n     */\n    getOwnedRelationValue(name) { return this.getOwnedAttributeValue(RELATION, name); }\n\n    /**\n     * @param {string} name - relation name\n     * @returns {string} relation value if relation exists, null otherwise\n     */\n    getRelationValue(name) { return this.getAttributeValue(RELATION, name); }\n\n    /**\n     * @param {string} name\n     * @returns {Promise<FNote>|null} target note of the relation or null (if target is empty or note was not found)\n     */\n    async getRelationTarget(name) {\n        const targets = await this.getRelationTargets(name);\n\n        return targets.length > 0 ? targets[0] : null;\n    }\n\n    /**\n     * @param {string} [name] - relation name to filter\n     * @returns {Promise<FNote[]>}\n     */\n    async getRelationTargets(name) {\n        const relations = this.getRelations(name);\n        const targets = [];\n\n        for (const relation of relations) {\n            targets.push(await this.froca.getNote(relation.value));\n        }\n\n        return targets;\n    }\n\n    /**\n     * @returns {FNote[]}\n     */\n    getNotesToInheritAttributesFrom() {\n        const relations = [\n            ...this.getRelations('template'),\n            ...this.getRelations('inherit')\n        ];\n\n        return relations.map(rel => this.froca.notes[rel.value]);\n    }\n\n    getPromotedDefinitionAttributes() {\n        if (this.isLabelTruthy('hidePromotedAttributes')) {\n            return [];\n        }\n\n        const promotedAttrs = this.getAttributes()\n            .filter(attr => attr.isDefinition())\n            .filter(attr => {\n                const def = attr.getDefinition();\n\n                return def && def.isPromoted;\n            });\n\n        // attrs are not resorted if position changes after the initial load\n        promotedAttrs.sort((a, b) => {\n            if (a.noteId === b.noteId) {\n                return a.position < b.position ? -1 : 1;\n            } else {\n                // inherited promoted attributes should stay grouped: https://github.com/zadam/trilium/issues/3761\n                return a.noteId < b.noteId ? -1 : 1;\n            }\n        });\n\n        return promotedAttrs;\n    }\n\n    hasAncestor(ancestorNoteId, followTemplates = false, visitedNoteIds = null) {\n        if (this.noteId === ancestorNoteId) {\n            return true;\n        }\n\n        if (!visitedNoteIds) {\n            visitedNoteIds = new Set();\n        } else if (visitedNoteIds.has(this.noteId)) {\n            // to avoid infinite cycle when template is descendent of the instance\n            return false;\n        }\n\n        visitedNoteIds.add(this.noteId);\n\n        if (followTemplates) {\n            for (const templateNote of this.getNotesToInheritAttributesFrom()) {\n                if (templateNote.hasAncestor(ancestorNoteId, followTemplates, visitedNoteIds)) {\n                    return true;\n                }\n            }\n        }\n\n        for (const parentNote of this.getParentNotes()) {\n            if (parentNote.hasAncestor(ancestorNoteId, followTemplates, visitedNoteIds)) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    isInHiddenSubtree() {\n        return this.noteId === '_hidden' || this.hasAncestor('_hidden');\n    }\n\n    /**\n     * @deprecated NOOP\n     */\n    invalidateAttributeCache() {}\n\n    /**\n     * Get relations which target this note\n     *\n     * @returns {FAttribute[]}\n     */\n    getTargetRelations() {\n        return this.targetRelations\n            .map(attributeId => this.froca.attributes[attributeId]);\n    }\n\n    /**\n     * Get relations which target this note\n     *\n     * @returns {Promise<FNote[]>}\n     */\n    async getTargetRelationSourceNotes() {\n        const targetRelations = this.getTargetRelations();\n\n        return await this.froca.getNotes(targetRelations.map(tr => tr.noteId));\n    }\n\n    /**\n     * @deprecated use getBlob() instead\n     * @return {Promise<FBlob>}\n     */\n    async getNoteComplement() {\n        return this.getBlob();\n    }\n\n    /** @return {Promise<FBlob>} */\n    async getBlob() {\n        return await this.froca.getBlob('notes', this.noteId);\n    }\n\n    toString() {\n        return `Note(noteId=${this.noteId}, title=${this.title})`;\n    }\n\n    get dto() {\n        const dto = Object.assign({}, this);\n        delete dto.froca;\n\n        return dto;\n    }\n\n    getCssClass() {\n        const labels = this.getLabels('cssClass');\n        return labels.map(l => l.value).join(' ');\n    }\n\n    getWorkspaceIconClass() {\n        const labels = this.getLabels('workspaceIconClass');\n        return labels.length > 0 ? labels[0].value : \"\";\n    }\n\n    getWorkspaceTabBackgroundColor() {\n        const labels = this.getLabels('workspaceTabBackgroundColor');\n        return labels.length > 0 ? labels[0].value : \"\";\n    }\n\n    /** @returns {boolean} true if this note is JavaScript (code or file) */\n    isJavaScript() {\n        return (this.type === \"code\" || this.type === \"file\" || this.type === 'launcher')\n            && (this.mime.startsWith(\"application/javascript\")\n                || this.mime === \"application/x-javascript\"\n                || this.mime === \"text/javascript\");\n    }\n\n    /** @returns {boolean} true if this note is HTML */\n    isHtml() {\n        return (this.type === \"code\" || this.type === \"file\" || this.type === \"render\") && this.mime === \"text/html\";\n    }\n\n    /** @returns {string|null} JS script environment - either \"frontend\" or \"backend\" */\n    getScriptEnv() {\n        if (this.isHtml() || (this.isJavaScript() && this.mime.endsWith('env=frontend'))) {\n            return \"frontend\";\n        }\n\n        if (this.type === 'render') {\n            return \"frontend\";\n        }\n\n        if (this.isJavaScript() && this.mime.endsWith('env=backend')) {\n            return \"backend\";\n        }\n\n        return null;\n    }\n\n    async executeScript() {\n        if (!this.isJavaScript()) {\n            throw new Error(`Note ${this.noteId} is of type ${this.type} and mime ${this.mime} and thus cannot be executed`);\n        }\n\n        const env = this.getScriptEnv();\n\n        if (env === \"frontend\") {\n            const bundleService = (await import(\"../services/bundle.js\")).default;\n            return await bundleService.getAndExecuteBundle(this.noteId);\n        }\n        else if (env === \"backend\") {\n            const resp = await server.post(`script/run/${this.noteId}`);\n        }\n        else {\n            throw new Error(`Unrecognized env type ${env} for note ${this.noteId}`);\n        }\n    }\n\n    isShared() {\n        for (const parentNoteId of this.parents) {\n            if (parentNoteId === 'root' || parentNoteId === 'none') {\n                continue;\n            }\n\n            const parentNote = froca.notes[parentNoteId];\n\n            if (!parentNote || parentNote.type === 'search') {\n                continue;\n            }\n\n            if (parentNote.noteId === '_share' || parentNote.isShared()) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    isContentAvailable() {\n        return !this.isProtected || protectedSessionHolder.isProtectedSessionAvailable()\n    }\n\n    isLaunchBarConfig() {\n        return this.type === 'launcher' || ['_lbRoot', '_lbAvailableLaunchers', '_lbVisibleLaunchers'].includes(this.noteId);\n    }\n\n    isOptions() {\n        return this.noteId.startsWith(\"_options\");\n    }\n\n    /**\n     * Provides note's date metadata.\n     *\n     * @returns {Promise<{dateCreated: string, utcDateCreated: string, dateModified: string, utcDateModified: string}>}\n     */\n    async getMetadata() {\n        return await server.get(`notes/${this.noteId}/metadata`);\n    }\n}\n\nexport default FNote;\n","import keyboardActionService from '../services/keyboard_actions.js';\n\nclass ContextMenu {\n    constructor() {\n        this.$widget = $(\"#context-menu-container\");\n        this.dateContextMenuOpenedMs = 0;\n\n        $(document).on('click', () => this.hide());\n    }\n\n    async show(options) {\n        this.options = options;\n\n        this.$widget.empty();\n\n        this.addItems(this.$widget, options.items);\n\n        keyboardActionService.updateDisplayedShortcuts(this.$widget);\n\n        this.positionMenu();\n\n        this.dateContextMenuOpenedMs = Date.now();\n    }\n\n    positionMenu() {\n        // the code below tries to detect when dropdown would overflow from page\n        // in such case we'll position it above click coordinates, so it will fit into the client\n\n        const CONTEXT_MENU_PADDING = 5; // How many pixels to pad the context menu from edge of screen\n        const CONTEXT_MENU_OFFSET = 0; // How many pixels to offset the context menu by relative to cursor, see #3157\n\n        const clientHeight = document.documentElement.clientHeight;\n        const clientWidth = document.documentElement.clientWidth;\n        const contextMenuHeight = this.$widget.outerHeight();\n        const contextMenuWidth = this.$widget.outerWidth();\n        let top, left;\n\n        if (this.options.y + contextMenuHeight - CONTEXT_MENU_OFFSET > clientHeight - CONTEXT_MENU_PADDING) {\n            // Overflow: bottom\n            top = clientHeight - contextMenuHeight - CONTEXT_MENU_PADDING;\n        } else if (this.options.y - CONTEXT_MENU_OFFSET < CONTEXT_MENU_PADDING) {\n            // Overflow: top\n            top = CONTEXT_MENU_PADDING;\n        } else {\n            top = this.options.y - CONTEXT_MENU_OFFSET;\n        }\n\n        if (this.options.orientation === 'left') {\n            if (this.options.x + CONTEXT_MENU_OFFSET > clientWidth - CONTEXT_MENU_PADDING) {\n                // Overflow: right\n                left = clientWidth - contextMenuWidth - CONTEXT_MENU_OFFSET;\n            } else if (this.options.x - contextMenuWidth + CONTEXT_MENU_OFFSET < CONTEXT_MENU_PADDING) {\n                // Overflow: left\n                left = CONTEXT_MENU_PADDING;\n            } else {\n                left = this.options.x - contextMenuWidth + CONTEXT_MENU_OFFSET;\n            }\n        } else {\n            if (this.options.x + contextMenuWidth - CONTEXT_MENU_OFFSET > clientWidth - CONTEXT_MENU_PADDING) {\n                // Overflow: right\n                left = clientWidth - contextMenuWidth - CONTEXT_MENU_PADDING;\n            } else if (this.options.x - CONTEXT_MENU_OFFSET < CONTEXT_MENU_PADDING) {\n                // Overflow: left\n                left = CONTEXT_MENU_PADDING;\n            } else {\n                left = this.options.x - CONTEXT_MENU_OFFSET;\n            }\n        }\n\n        this.$widget.css({\n            display: \"block\",\n            top: top,\n            left: left\n        }).addClass(\"show\");\n    }\n\n    addItems($parent, items) {\n        for (const item of items) {\n            if (!item) {\n                continue;\n            }\n\n            if (item.title === '----') {\n                $parent.append($(\"<div>\").addClass(\"dropdown-divider\"));\n            } else {\n                const $icon = $(\"<span>\");\n\n                if (item.uiIcon) {\n                    $icon.addClass(item.uiIcon);\n                } else {\n                    $icon.append(\"&nbsp;\");\n                }\n\n                const $link = $(\"<span>\")\n                    .append($icon)\n                    .append(\" &nbsp; \") // some space between icon and text\n                    .append(item.title);\n\n                const $item = $(\"<li>\")\n                    .addClass(\"dropdown-item\")\n                    .append($link)\n                    .on('contextmenu', e => false)\n                    // important to use mousedown instead of click since the former does not change focus\n                    // (especially important for focused text for spell check)\n                    .on('mousedown', e => {\n                        e.stopPropagation();\n\n                        if (e.which !== 1) { // only left click triggers menu items\n                            return false;\n                        }\n\n                        this.hide();\n\n                        if (item.handler) {\n                            item.handler(item, e);\n                        }\n\n                        this.options.selectMenuItemHandler(item, e);\n\n                        // it's important to stop the propagation especially for sub-menus, otherwise the event\n                        // might be handled again by top-level menu\n                        return false;\n                    });\n\n                if (item.enabled !== undefined && !item.enabled) {\n                    $item.addClass(\"disabled\");\n                }\n\n                if (item.items) {\n                    $item.addClass(\"dropdown-submenu\");\n                    $link.addClass(\"dropdown-toggle\");\n\n                    const $subMenu = $(\"<ul>\").addClass(\"dropdown-menu\");\n\n                    this.addItems($subMenu, item.items);\n\n                    $item.append($subMenu);\n                }\n\n                $parent.append($item);\n            }\n        }\n    }\n\n    hide() {\n        // this date checking comes from change in FF66 - https://github.com/zadam/trilium/issues/468\n        // \"contextmenu\" event also triggers \"click\" event which depending on the timing can close the just opened context menu\n        // we might filter out right clicks, but then it's better if even right clicks close the context menu\n        if (Date.now() - this.dateContextMenuOpenedMs > 300) {\n            // seems like if we hide the menu immediately, some clicks can get propagated to the underlying component\n            // see https://github.com/zadam/trilium/pull/3805 for details\n            setTimeout(() => this.$widget.hide(), 100);\n        }\n    }\n}\n\nconst contextMenu = new ContextMenu();\n\nexport default contextMenu;\n","import contextMenu from \"./context_menu.js\";\nimport appContext from \"../components/app_context.js\";\n\nfunction openContextMenu(notePath, e, viewScope = {}, hoistedNoteId = null) {\n    contextMenu.show({\n        x: e.pageX,\n        y: e.pageY,\n        items: [\n            {title: \"在新标签页中打开笔记\", command: \"openNoteInNewTab\", uiIcon: \"bx bx-empty\"},\n            {title: \"在新的拆分中打开笔记\", command: \"openNoteInNewSplit\", uiIcon: \"bx bx-dock-right\"},\n            {title: \"在新窗口中打开笔记\", command: \"openNoteInNewWindow\", uiIcon: \"bx bx-window-open\"}\n        ],\n        selectMenuItemHandler: ({command}) => {\n            if (!hoistedNoteId) {\n                hoistedNoteId = appContext.tabManager.getActiveContext().hoistedNoteId;\n            }\n\n            if (command === 'openNoteInNewTab') {\n                appContext.tabManager.openContextWithNote(notePath, { hoistedNoteId, viewScope });\n            }\n            else if (command === 'openNoteInNewSplit') {\n                const subContexts = appContext.tabManager.getActiveContext().getSubContexts();\n                const {ntxId} = subContexts[subContexts.length - 1];\n\n                appContext.triggerCommand(\"openNewNoteSplit\", {ntxId, notePath, hoistedNoteId, viewScope});\n            }\n            else if (command === 'openNoteInNewWindow') {\n                appContext.triggerCommand('openInWindow', {notePath, hoistedNoteId, viewScope});\n            }\n        }\n    });\n}\n\nexport default {\n    openContextMenu\n}\n","import ws from \"./ws.js\";\nimport froca from \"./froca.js\";\n\nasync function renderAttribute(attribute, renderIsInheritable) {\n    const isInheritable = renderIsInheritable && attribute.isInheritable ? `(可继承的)` : '';\n    const $attr = $(\"<span>\");\n\n    if (attribute.type === 'label') {\n        $attr.append(document.createTextNode(`#${attribute.name}${isInheritable}`));\n\n        if (attribute.value) {\n            $attr.append('=');\n            $attr.append(document.createTextNode(formatValue(attribute.value)));\n        }\n    } else if (attribute.type === 'relation') {\n        if (attribute.isAutoLink) {\n            return $attr;\n        }\n\n        // when the relation has just been created, then it might not have a value\n        if (attribute.value) {\n            $attr.append(document.createTextNode(`~${attribute.name}${isInheritable}=`));\n            $attr.append(await createLink(attribute.value));\n        }\n    } else {\n        ws.logError(`Unknown attr type: ${attribute.type}`);\n    }\n\n    return $attr;\n}\n\nfunction formatValue(val) {\n    if (/^[\\p{L}\\p{N}\\-_,.]+$/u.test(val)) {\n        return val;\n    }\n    else if (!val.includes('\"')) {\n        return `\"${val}\"`;\n    }\n    else if (!val.includes(\"'\")) {\n        return `'${val}'`;\n    }\n    else if (!val.includes(\"`\")) {\n        return `\\`${val}\\``;\n    }\n    else {\n        return `\"${val.replace(/\"/g, '\\\\\"')}\"`;\n    }\n}\n\nasync function createLink(noteId) {\n    const note = await froca.getNote(noteId);\n\n    if (!note) {\n        return;\n    }\n\n    return $(\"<a>\", {\n        href: `#root/${noteId}`,\n        class: 'reference-link'\n    })\n        .text(note.title);\n}\n\nasync function renderAttributes(attributes, renderIsInheritable) {\n    const $container = $('<span class=\"rendered-note-attributes\">');\n\n    for (let i = 0; i < attributes.length; i++) {\n        const attribute = attributes[i];\n\n        const $attr = await renderAttribute(attribute, renderIsInheritable);\n        $container.append($attr.html()); // .html() to get only inner HTML, we don't want any spans\n\n        if (i < attributes.length - 1) {\n            $container.append(\" \");\n        }\n    }\n\n    return $container;\n}\n\nconst HIDDEN_ATTRIBUTES = [\n    'originalFileName',\n    'fileSize',\n    'template',\n    'inherit',\n    'cssClass',\n    'iconClass',\n    'pageSize',\n    'viewType'\n];\n\nasync function renderNormalAttributes(note) {\n    const promotedDefinitionAttributes = note.getPromotedDefinitionAttributes();\n    let attrs = note.getAttributes();\n\n    if (promotedDefinitionAttributes.length > 0) {\n        attrs = attrs.filter(attr => !!promotedDefinitionAttributes.find(promAttr => promAttr.isDefinitionFor(attr)));\n    }\n    else {\n        attrs = attrs.filter(\n            attr => !attr.isDefinition()\n                 && !attr.isAutoLink\n                 && !HIDDEN_ATTRIBUTES.includes(attr.name)\n                 && attr.noteId === note.noteId\n        );\n    }\n\n    const $renderedAttributes = await renderAttributes(attrs, false);\n\n    return {\n        count: attrs.length,\n        $renderedAttributes\n    }\n}\n\nexport default {\n    renderAttribute,\n    renderAttributes,\n    renderNormalAttributes\n}\n","import utils from './utils.js';\nimport server from './server.js';\nimport toastService from \"./toast.js\";\nimport froca from \"./froca.js\";\nimport hoistedNoteService from \"./hoisted_note.js\";\nimport ws from \"./ws.js\";\nimport appContext from \"../components/app_context.js\";\n\nasync function moveBeforeBranch(branchIdsToMove, beforeBranchId) {\n    branchIdsToMove = filterRootNote(branchIdsToMove);\n    branchIdsToMove = filterSearchBranches(branchIdsToMove);\n\n    const beforeBranch = froca.getBranch(beforeBranchId);\n\n    if (['root', '_lbRoot', '_lbAvailableLaunchers', '_lbVisibleLaunchers'].includes(beforeBranch.noteId)) {\n        toastService.showError('无法在此移动笔记。');\n        return;\n    }\n\n    for (const branchIdToMove of branchIdsToMove) {\n        const resp = await server.put(`branches/${branchIdToMove}/move-before/${beforeBranchId}`);\n\n        if (!resp.success) {\n            toastService.showError(resp.message);\n            return;\n        }\n    }\n}\n\nasync function moveAfterBranch(branchIdsToMove, afterBranchId) {\n    branchIdsToMove = filterRootNote(branchIdsToMove);\n    branchIdsToMove = filterSearchBranches(branchIdsToMove);\n\n    const afterNote = froca.getBranch(afterBranchId).getNote();\n\n    const forbiddenNoteIds = [\n        'root',\n        hoistedNoteService.getHoistedNoteId(),\n        '_lbRoot',\n        '_lbAvailableLaunchers',\n        '_lbVisibleLaunchers'\n    ];\n\n    if (forbiddenNoteIds.includes(afterNote.noteId)) {\n        toastService.showError('无法在此移动笔记。');\n        return;\n    }\n\n    branchIdsToMove.reverse(); // need to reverse to keep the note order\n\n    for (const branchIdToMove of branchIdsToMove) {\n        const resp = await server.put(`branches/${branchIdToMove}/move-after/${afterBranchId}`);\n\n        if (!resp.success) {\n            toastService.showError(resp.message);\n            return;\n        }\n    }\n}\n\nasync function moveToParentNote(branchIdsToMove, newParentBranchId) {\n    const newParentBranch = froca.getBranch(newParentBranchId);\n\n    if (newParentBranch.noteId === '_lbRoot') {\n        toastService.showError('无法在此移动笔记。');\n        return;\n    }\n\n    branchIdsToMove = filterRootNote(branchIdsToMove);\n\n    for (const branchIdToMove of branchIdsToMove) {\n        const branchToMove = froca.getBranch(branchIdToMove);\n\n        if (branchToMove.noteId === hoistedNoteService.getHoistedNoteId()\n            || (await branchToMove.getParentNote()).type === 'search') {\n            continue;\n        }\n\n        const resp = await server.put(`branches/${branchIdToMove}/move-to/${newParentBranchId}`);\n\n        if (!resp.success) {\n            toastService.showError(resp.message);\n            return;\n        }\n    }\n}\n\nasync function deleteNotes(branchIdsToDelete, forceDeleteAllClones = false) {\n    branchIdsToDelete = filterRootNote(branchIdsToDelete);\n\n    if (branchIdsToDelete.length === 0) {\n        return false;\n    }\n\n    let proceed, deleteAllClones, eraseNotes;\n\n    if (utils.isMobile()) {\n        proceed = true;\n        deleteAllClones = false;\n    }\n    else {\n        ({proceed, deleteAllClones, eraseNotes} = await new Promise(res =>\n            appContext.triggerCommand('showDeleteNotesDialog', {branchIdsToDelete, callback: res, forceDeleteAllClones})));\n    }\n\n    if (!proceed) {\n        return false;\n    }\n\n    const taskId = utils.randomString(10);\n\n    let counter = 0;\n\n    for (const branchIdToDelete of branchIdsToDelete) {\n        counter++;\n\n        const last = counter === branchIdsToDelete.length;\n        const query = `?taskId=${taskId}&eraseNotes=${eraseNotes ? 'true' : 'false'}&last=${last ? 'true' : 'false'}`;\n\n        const branch = froca.getBranch(branchIdToDelete);\n\n        if (deleteAllClones) {\n            await server.remove(`notes/${branch.noteId}${query}`);\n        }\n        else {\n            await server.remove(`branches/${branchIdToDelete}${query}`);\n        }\n    }\n\n    if (eraseNotes) {\n        utils.reloadFrontendApp(\"erasing notes requires reload\");\n    }\n\n    return true;\n}\n\nasync function moveNodeUpInHierarchy(node) {\n    if (hoistedNoteService.isHoistedNode(node)\n        || hoistedNoteService.isTopLevelNode(node)\n        || node.getParent().data.noteType === 'search') {\n        return;\n    }\n\n    const targetBranchId = node.getParent().data.branchId;\n    const branchIdToMove = node.data.branchId;\n\n    const resp = await server.put(`branches/${branchIdToMove}/move-after/${targetBranchId}`);\n\n    if (!resp.success) {\n        toastService.showError(resp.message);\n        return;\n    }\n\n    if (!hoistedNoteService.isTopLevelNode(node) && node.getParent().getChildren().length <= 1) {\n        node.getParent().folder = false;\n        node.getParent().renderTitle();\n    }\n}\n\nfunction filterSearchBranches(branchIds) {\n    return branchIds.filter(branchId => !branchId.startsWith('virt-'));\n}\n\nfunction filterRootNote(branchIds) {\n    const hoistedNoteId = hoistedNoteService.getHoistedNoteId();\n\n    return branchIds.filter(branchId => {\n        const branch = froca.getBranch(branchId);\n\n        return branch.noteId !== 'root'\n            && branch.noteId !== hoistedNoteId;\n    });\n}\n\nfunction makeToast(id, message) {\n    return {\n        id: id,\n        title: \"删除状态\",\n        message: message,\n        icon: \"trash\"\n    };\n}\n\nws.subscribeToMessages(async message => {\n    if (message.taskType !== 'deleteNotes') {\n        return;\n    }\n\n    if (message.type === 'taskError') {\n        toastService.closePersistent(message.taskId);\n        toastService.showError(message.message);\n    } else if (message.type === 'taskProgressCount') {\n        toastService.showPersistent(makeToast(message.taskId, `Delete notes in progress: ${message.progressCount}`));\n    } else if (message.type === 'taskSucceeded') {\n        const toast = makeToast(message.taskId, \"删除成功.\");\n        toast.closeAfter = 5000;\n\n        toastService.showPersistent(toast);\n    }\n});\n\nws.subscribeToMessages(async message => {\n    if (message.taskType !== 'undeleteNotes') {\n        return;\n    }\n\n    if (message.type === 'taskError') {\n        toastService.closePersistent(message.taskId);\n        toastService.showError(message.message);\n    } else if (message.type === 'taskProgressCount') {\n        toastService.showPersistent(makeToast(message.taskId, `Undeleting notes in progress: ${message.progressCount}`));\n    } else if (message.type === 'taskSucceeded') {\n        const toast = makeToast(message.taskId, \"撤销删除成功\");\n        toast.closeAfter = 5000;\n\n        toastService.showPersistent(toast);\n    }\n});\n\nasync function cloneNoteToBranch(childNoteId, parentBranchId, prefix) {\n    const resp = await server.put(`notes/${childNoteId}/clone-to-branch/${parentBranchId}`, {\n        prefix: prefix\n    });\n\n    if (!resp.success) {\n        toastService.showError(resp.message);\n    }\n}\n\nasync function cloneNoteToParentNote(childNoteId, parentNoteId, prefix) {\n    const resp = await server.put(`notes/${childNoteId}/clone-to-note/${parentNoteId}`, {\n        prefix: prefix\n    });\n\n    if (!resp.success) {\n        toastService.showError(resp.message);\n    }\n}\n\n// beware that the first arg is noteId and the second is branchId!\nasync function cloneNoteAfter(noteId, afterBranchId) {\n    const resp = await server.put(`notes/${noteId}/clone-after/${afterBranchId}`);\n\n    if (!resp.success) {\n        toastService.showError(resp.message);\n    }\n}\n\nexport default {\n    moveBeforeBranch,\n    moveAfterBranch,\n    moveToParentNote,\n    deleteNotes,\n    moveNodeUpInHierarchy,\n    cloneNoteAfter,\n    cloneNoteToBranch,\n    cloneNoteToParentNote,\n};\n","import ScriptContext from \"./script_context.js\";\nimport server from \"./server.js\";\nimport toastService from \"./toast.js\";\nimport froca from \"./froca.js\";\nimport utils from \"./utils.js\";\n\nasync function getAndExecuteBundle(noteId, originEntity = null, script = null, params = null) {\n    const bundle = await server.post(`script/bundle/${noteId}`, {\n        script,\n        params\n    });\n\n    return await executeBundle(bundle, originEntity);\n}\n\nasync function executeBundle(bundle, originEntity, $container) {\n    const apiContext = await ScriptContext(bundle.noteId, bundle.allNoteIds, originEntity, $container);\n\n    try {\n        return await (function () {\n            return eval(`const apiContext = this; (async function() { ${bundle.script}\\r\\n})()`);\n        }.call(apiContext));\n    }\n    catch (e) {\n        const note = await froca.getNote(bundle.noteId);\n\n        toastService.showAndLogError(`执行 ID 为 ${bundle.noteId} 的JS笔记\"${note.title}\"失败, 错误: ${e.message}`);\n    }\n}\n\nasync function executeStartupBundles() {\n    const isMobile = utils.isMobile();\n    const scriptBundles = await server.get(\"script/startup\" + (isMobile ? \"?mobile=true\" : \"\"));\n\n    for (const bundle of scriptBundles) {\n        await executeBundle(bundle);\n    }\n}\n\nclass WidgetsByParent {\n    constructor() {\n        this.byParent = {};\n    }\n\n    add(widget) {\n        if (!widget.parentWidget) {\n            console.log(`Custom widget does not have mandatory 'parentWidget' property defined`);\n            return;\n        }\n\n        this.byParent[widget.parentWidget] = this.byParent[widget.parentWidget] || [];\n        this.byParent[widget.parentWidget].push(widget);\n    }\n\n    get(parentName) {\n        if (!this.byParent[parentName]) {\n            return [];\n        }\n\n        return this.byParent[parentName]\n            // previously, custom widgets were provided as a single instance, but that has the disadvantage\n            // for splits where we actually need multiple instaces and thus having a class to instantiate is better\n            // https://github.com/zadam/trilium/issues/4274\n            .map(w => w.prototype ? new w() : w);\n    }\n}\n\nasync function getWidgetBundlesByParent() {\n    const scriptBundles = await server.get(\"script/widgets\");\n\n    const widgetsByParent = new WidgetsByParent();\n\n    for (const bundle of scriptBundles) {\n        let widget;\n\n        try {\n            widget = await executeBundle(bundle);\n            widgetsByParent.add(widget);\n        }\n        catch (e) {\n            logError(\"小部件初始化失败: \", e);\n            continue;\n        }\n    }\n\n    return widgetsByParent;\n}\n\nexport default {\n    executeBundle,\n    getAndExecuteBundle,\n    executeStartupBundles,\n    getWidgetBundlesByParent\n}\n","import branchService from \"./branches.js\";\nimport toastService from \"./toast.js\";\nimport froca from \"./froca.js\";\nimport linkService from \"./link.js\";\nimport utils from \"./utils.js\";\n\nlet clipboardBranchIds = [];\nlet clipboardMode = null;\n\nasync function pasteAfter(afterBranchId) {\n    if (isClipboardEmpty()) {\n        return;\n    }\n\n    if (clipboardMode === 'cut') {\n        await branchService.moveAfterBranch(clipboardBranchIds, afterBranchId);\n\n        clipboardBranchIds = [];\n        clipboardMode = null;\n    }\n    else if (clipboardMode === 'copy') {\n        const clipboardBranches = clipboardBranchIds.map(branchId => froca.getBranch(branchId));\n\n        for (const clipboardBranch of clipboardBranches) {\n            const clipboardNote = await clipboardBranch.getNote();\n\n            await branchService.cloneNoteAfter(clipboardNote.noteId, afterBranchId);\n        }\n\n        // copy will keep clipboardBranchIds and clipboardMode, so it's possible to paste into multiple places\n    }\n    else {\n        toastService.throwError(`Unrecognized clipboard mode=${clipboardMode}`);\n    }\n}\n\nasync function pasteInto(parentBranchId) {\n    if (isClipboardEmpty()) {\n        return;\n    }\n\n    if (clipboardMode === 'cut') {\n        await branchService.moveToParentNote(clipboardBranchIds, parentBranchId);\n\n        clipboardBranchIds = [];\n        clipboardMode = null;\n    }\n    else if (clipboardMode === 'copy') {\n        const clipboardBranches = clipboardBranchIds.map(branchId => froca.getBranch(branchId));\n\n        for (const clipboardBranch of clipboardBranches) {\n            const clipboardNote = await clipboardBranch.getNote();\n\n            await branchService.cloneNoteToBranch(clipboardNote.noteId, parentBranchId);\n        }\n\n        // copy will keep clipboardBranchIds and clipboardMode, so it's possible to paste into multiple places\n    }\n    else {\n        toastService.throwError(`Unrecognized clipboard mode=${clipboardMode}`);\n    }\n}\n\nasync function copy(branchIds) {\n    clipboardBranchIds = branchIds;\n    clipboardMode = 'copy';\n\n    if (utils.isElectron()) {\n        // https://github.com/zadam/trilium/issues/2401\n        const {clipboard} = require('electron');\n        const links = [];\n\n        for (const branch of froca.getBranches(clipboardBranchIds)) {\n            const $link = await linkService.createLink(`${branch.parentNoteId}/${branch.noteId}`, { referenceLink: true });\n            links.push($link[0].outerHTML);\n        }\n\n        clipboard.writeHTML(links.join(', '));\n    }\n\n    toastService.showMessage(\"笔记已复制到剪贴板.\");\n}\n\nfunction cut(branchIds) {\n    clipboardBranchIds = branchIds;\n\n    if (clipboardBranchIds.length > 0) {\n        clipboardMode = 'cut';\n\n        toastService.showMessage(\"笔记已被剪切到剪贴板.\");\n    }\n}\n\nfunction isClipboardEmpty() {\n    clipboardBranchIds = clipboardBranchIds.filter(branchId => !!froca.getBranch(branchId));\n\n    return clipboardBranchIds.length === 0;\n}\n\nexport default {\n    pasteAfter,\n    pasteInto,\n    cut,\n    copy,\n    isClipboardEmpty\n}\n","import renderService from \"./render.js\";\nimport protectedSessionService from \"./protected_session.js\";\nimport protectedSessionHolder from \"./protected_session_holder.js\";\nimport libraryLoader from \"./library_loader.js\";\nimport openService from \"./open.js\";\nimport froca from \"./froca.js\";\nimport utils from \"./utils.js\";\nimport linkService from \"./link.js\";\nimport treeService from \"./tree.js\";\nimport FNote from \"../entities/fnote.js\";\nimport FAttachment from \"../entities/fattachment.js\";\n\nlet idCounter = 1;\n\n/**\n * @param {FNote|FAttachment} entity\n * @param {object} options\n * @return {Promise<{type: string, $renderedContent: jQuery}>}\n */\nasync function getRenderedContent(entity, options = {}) {\n    options = Object.assign({\n        tooltip: false\n    }, options);\n\n    const type = getRenderingType(entity);\n    // attachment supports only image and file/pdf/audio/video\n\n    const $renderedContent = $('<div class=\"rendered-content\">');\n\n    if (type === 'text') {\n        await renderText(entity, $renderedContent);\n    }\n    else if (type === 'code') {\n        await renderCode(entity, $renderedContent);\n    }\n    else if (type === 'image' || type === 'canvas') {\n        renderImage(entity, $renderedContent, options);\n    }\n    else if (!options.tooltip && ['file', 'pdf', 'audio', 'video'].includes(type)) {\n        renderFile(entity, type, $renderedContent);\n    }\n    else if (type === 'mermaid') {\n        await renderMermaid(entity, $renderedContent);\n    }\n    else if (type === 'render') {\n        const $content = $('<div>');\n\n        await renderService.render(entity, $content, this.ctx);\n\n        $renderedContent.append($content);\n    }\n    else if (!options.tooltip && type === 'protectedSession') {\n        const $button = $(`<button class=\"btn btn-sm\"><span class=\"bx bx-log-in\"></span>进入受保护的会话</button>`)\n            .on('click', protectedSessionService.enterProtectedSession);\n\n        $renderedContent.append(\n            $(\"<div>\")\n                .append(\"<div>此笔记受保护, 您需要输入密码来访问它.</div>\")\n                .append(\"<br/>\")\n                .append($button)\n        );\n    }\n    else if (entity instanceof FNote) {\n        $renderedContent.append(\n            $(\"<div>\")\n                .css(\"display\", \"flex\")\n                .css(\"justify-content\", \"space-around\")\n                .css(\"align-items\", \"center\")\n                .css(\"height\", \"100%\")\n                .css(\"font-size\", \"500%\")\n                .append($(\"<span>\").addClass(entity.getIcon()))\n        );\n    }\n\n    if (entity instanceof FNote) {\n        $renderedContent.addClass(entity.getCssClass());\n    }\n\n    return {\n        $renderedContent,\n        type\n    };\n}\n\n/** @param {FNote} note */\nasync function renderText(note, $renderedContent) {\n    // entity must be FNote\n    const blob = await note.getBlob();\n\n    if (!utils.isHtmlEmpty(blob.content)) {\n        $renderedContent.append($('<div class=\"ck-content\">').html(blob.content));\n\n        if ($renderedContent.find('span.math-tex').length > 0) {\n            await libraryLoader.requireLibrary(libraryLoader.KATEX);\n\n            renderMathInElement($renderedContent[0], {trust: true});\n        }\n\n        const getNoteIdFromLink = el => treeService.getNoteIdFromUrl($(el).attr('href'));\n        const referenceLinks = $renderedContent.find(\"a.reference-link\");\n        const noteIdsToPrefetch = referenceLinks.map(el => getNoteIdFromLink(el));\n        await froca.getNotes(noteIdsToPrefetch);\n\n        for (const el of referenceLinks) {\n            await linkService.loadReferenceLinkTitle($(el));\n        }\n    } else {\n        await renderChildrenList($renderedContent, note);\n    }\n}\n\n/** @param {FNote} note */\nasync function renderCode(note, $renderedContent) {\n    const blob = await note.getBlob();\n\n    $renderedContent.append($(\"<pre>\").text(blob.content));\n}\n\nfunction renderImage(entity, $renderedContent, options = {}) {\n    const encodedTitle = encodeURIComponent(entity.title);\n\n    let url;\n\n    if (entity instanceof FNote) {\n        url = `api/images/${entity.noteId}/${encodedTitle}?${Math.random()}`;\n    } else if (entity instanceof FAttachment) {\n        url = `api/attachments/${entity.attachmentId}/image/${encodedTitle}?${entity.utcDateModified}\">`;\n    }\n\n    $renderedContent // styles needed for the zoom to work well\n        .css('display', 'flex')\n        .css('align-items', 'center')\n        .css('justify-content', 'center');\n\n    const $img = $(\"<img>\")\n        .attr(\"src\", url)\n        .attr(\"id\", \"attachment-image-\" + idCounter++)\n        .css(\"max-width\", \"100%\");\n\n    $renderedContent.append($img);\n\n    if (options.imageHasZoom) {\n        libraryLoader.requireLibrary(libraryLoader.WHEEL_ZOOM).then(() => {\n            WZoom.create(`#${$img.attr(\"id\")}`, {\n                maxScale: 50,\n                speed: 1.3,\n                zoomOnClick: false\n            });\n        });\n    }\n}\n\nfunction renderFile(entity, type, $renderedContent) {\n    let entityType, entityId;\n\n    if (entity instanceof FNote) {\n        entityType = 'notes';\n        entityId = entity.noteId;\n    } else if (entity instanceof FAttachment) {\n        entityType = 'attachments';\n        entityId = entity.attachmentId;\n    } else {\n        throw new Error(`Can't recognize entity type of '${entity}'`);\n    }\n\n    const $content = $('<div style=\"display: flex; flex-direction: column; height: 100%;\">');\n\n    if (type === 'pdf') {\n        const $pdfPreview = $('<iframe class=\"pdf-preview\" style=\"width: 100%; flex-grow: 100;\"></iframe>');\n        $pdfPreview.attr(\"src\", openService.getUrlForDownload(`api/${entityType}/${entityId}/open`));\n\n        $content.append($pdfPreview);\n    } else if (type === 'audio') {\n        const $audioPreview = $('<audio controls></audio>')\n            .attr(\"src\", openService.getUrlForDownload(`api/${entityType}/${entityId}/open-partial`))\n            .attr(\"type\", entity.mime)\n            .css(\"width\", \"100%\");\n\n        $content.append($audioPreview);\n    } else if (type === 'video') {\n        const $videoPreview = $('<video controls></video>')\n            .attr(\"src\", openService.getUrlForDownload(`api/${entityType}/${entityId}/open-partial`))\n            .attr(\"type\", entity.mime)\n            .css(\"width\", \"100%\");\n\n        $content.append($videoPreview);\n    }\n\n    if (entityType === 'notes') {\n        // TODO: we should make this available also for attachments, but there's a problem with \"Open externally\" support\n        //       in attachment list\n        const $downloadButton = $('<button class=\"file-download btn btn-primary\" type=\"button\">下载</button>');\n        const $openButton = $('<button class=\"file-open btn btn-primary\" type=\"button\">打开</button>');\n\n        $downloadButton.on('click', () => openService.downloadFileNote(entity.noteId));\n        $openButton.on('click', () => openService.openNoteExternally(entity.noteId, entity.mime));\n        // open doesn't work for protected notes since it works through a browser which isn't in protected session\n        $openButton.toggle(!entity.isProtected);\n\n        $content.append(\n            $('<div style=\"display: flex; justify-content: space-evenly; margin-top: 5px;\">')\n                .append($downloadButton)\n                .append($openButton)\n        );\n    }\n\n    $renderedContent.append($content);\n}\n\nasync function renderMermaid(note, $renderedContent) {\n    await libraryLoader.requireLibrary(libraryLoader.MERMAID);\n\n    const blob = await note.getBlob();\n    const content = blob.content || \"\";\n\n    $renderedContent\n        .css(\"display\", \"flex\")\n        .css(\"justify-content\", \"space-around\");\n\n    const documentStyle = window.getComputedStyle(document.documentElement);\n    const mermaidTheme = documentStyle.getPropertyValue('--mermaid-theme');\n\n    mermaid.mermaidAPI.initialize({startOnLoad: false, theme: mermaidTheme.trim(), securityLevel: 'antiscript'});\n\n    try {\n        const {svg} = await mermaid.mermaidAPI.render(\"in-mermaid-graph-\" + idCounter++, content);\n\n        $renderedContent.append($(svg));\n    } catch (e) {\n        const $error = $(\"<p>图表无法显示.</p>\");\n\n        $renderedContent.append($error);\n    }\n}\n\n/**\n * @param {jQuery} $renderedContent\n * @param {FNote} note\n * @returns {Promise<void>}\n */\nasync function renderChildrenList($renderedContent, note) {\n    $renderedContent.css(\"padding\", \"10px\");\n    $renderedContent.addClass(\"text-with-ellipsis\");\n\n    let childNoteIds = note.getChildNoteIds();\n\n    if (childNoteIds.length > 10) {\n        childNoteIds = childNoteIds.slice(0, 10);\n    }\n\n    // just load the first 10 child notes\n    const childNotes = await froca.getNotes(childNoteIds);\n\n    for (const childNote of childNotes) {\n        $renderedContent.append(await linkService.createLink(`${note.noteId}/${childNote.noteId}`, {\n            showTooltip: false,\n            showNoteIcon: true\n        }));\n\n        $renderedContent.append(\"<br>\");\n    }\n}\n\nfunction getRenderingType(entity) {\n    let type = entity.type || entity.role;\n    const mime = entity.mime;\n\n    if (type === 'file' && mime === 'application/pdf') {\n        type = 'pdf';\n    } else if (type === 'file' && mime.startsWith('audio/')) {\n        type = 'audio';\n    } else if (type === 'file' && mime.startsWith('video/')) {\n        type = 'video';\n    }\n\n    if (entity.isProtected) {\n        if (protectedSessionHolder.isProtectedSessionAvailable()) {\n            protectedSessionHolder.touchProtectedSession();\n        }\n        else {\n            type = 'protectedSession';\n        }\n    }\n\n    return type;\n}\n\nexport default {\n    getRenderedContent\n};\n","import froca from \"./froca.js\";\nimport server from \"./server.js\";\nimport ws from \"./ws.js\";\n\n/** @returns {FNote} */\nasync function getInboxNote() {\n    const note = await server.get(`special-notes/inbox/${dayjs().format(\"YYYY-MM-DD\")}`, \"date-note\");\n\n    return await froca.getNote(note.noteId);\n}\n\n/** @returns {FNote} */\nasync function getTodayNote() {\n    return await getDayNote(dayjs().format(\"YYYY-MM-DD\"));\n}\n\n/** @returns {FNote} */\nasync function getDayNote(date) {\n    const note = await server.get(`special-notes/days/${date}`, \"date-note\");\n\n    await ws.waitForMaxKnownEntityChangeId();\n\n    return await froca.getNote(note.noteId);\n}\n\n/** @returns {FNote} */\nasync function getWeekNote(date) {\n    const note = await server.get(`special-notes/weeks/${date}`, \"date-note\");\n\n    await ws.waitForMaxKnownEntityChangeId();\n\n    return await froca.getNote(note.noteId);\n}\n\n/** @returns {FNote} */\nasync function getMonthNote(month) {\n    const note = await server.get(`special-notes/months/${month}`, \"date-note\");\n\n    await ws.waitForMaxKnownEntityChangeId();\n\n    return await froca.getNote(note.noteId);\n}\n\n/** @returns {FNote} */\nasync function getYearNote(year) {\n    const note = await server.get(`special-notes/years/${year}`, \"date-note\");\n\n    await ws.waitForMaxKnownEntityChangeId();\n\n    return await froca.getNote(note.noteId);\n}\n\n/** @returns {FNote} */\nasync function createSqlConsole() {\n    const note = await server.post('special-notes/sql-console');\n\n    await ws.waitForMaxKnownEntityChangeId();\n\n    return await froca.getNote(note.noteId);\n}\n\n/** @returns {FNote} */\nasync function createSearchNote(opts = {}) {\n    const note = await server.post('special-notes/search-note', opts);\n\n    await ws.waitForMaxKnownEntityChangeId();\n\n    return await froca.getNote(note.noteId);\n}\n\nexport default {\n    getInboxNote,\n    getTodayNote,\n    getDayNote,\n    getWeekNote,\n    getMonthNote,\n    getYearNote,\n    createSqlConsole,\n    createSearchNote\n}\n","import appContext from \"../components/app_context.js\";\n\nasync function info(message) {\n    return new Promise(res =>\n        appContext.triggerCommand(\"showInfoDialog\", {message, callback: res}));\n}\n\nasync function confirm(message) {\n    return new Promise(res =>\n        appContext.triggerCommand(\"showConfirmDialog\", {\n            message,\n            callback: x => res(x.confirmed)\n        }));\n}\n\nasync function confirmDeleteNoteBoxWithNote(title) {\n    return new Promise(res =>\n        appContext.triggerCommand(\"showConfirmDeleteNoteBoxWithNoteDialog\", {title, callback: res}));\n}\n\nasync function prompt(props) {\n    return new Promise(res =>\n        appContext.triggerCommand(\"showPromptDialog\", {...props, callback: res}));\n}\n\nexport default {\n    info,\n    confirm,\n    confirmDeleteNoteBoxWithNote,\n    prompt\n};\n","export default class FBlob {\n    constructor(row) {\n        /** @type {string} */\n        this.blobId = row.blobId;\n\n        /**\n         * can either contain the whole content (in e.g. string notes), only part (large text notes) or nothing at all (binary notes, images)\n         * @type {string}\n         */\n        this.content = row.content;\n        this.contentLength = row.contentLength;\n\n        /** @type {string} */\n        this.dateModified = row.dateModified;\n        /** @type {string} */\n        this.utcDateModified = row.utcDateModified;\n    }\n\n    /**\n     * @returns {*}\n     * @throws Error in case of invalid JSON */\n    getJsonContent() {\n        if (!this.content || !this.content.trim()) {\n            return null;\n        }\n\n        return JSON.parse(this.content);\n    }\n\n    /** @returns {*|null} valid object or null if the content cannot be parsed as JSON */\n    getJsonContentSafely() {\n        try {\n            return this.getJsonContent();\n        }\n        catch (e) {\n            return null;\n        }\n    }\n}\n","import FBranch from \"../entities/fbranch.js\";\nimport FNote from \"../entities/fnote.js\";\nimport FAttribute from \"../entities/fattribute.js\";\nimport server from \"./server.js\";\nimport appContext from \"../components/app_context.js\";\nimport FBlob from \"../entities/fblob.js\";\nimport FAttachment from \"../entities/fattachment.js\";\n\n/**\n * Froca (FROntend CAche) keeps a read only cache of note tree structure in frontend's memory.\n * - notes are loaded lazily when unknown noteId is requested\n * - when note is loaded, all its parent and child branches are loaded as well. For a branch to be used, it's not must be loaded before\n * - deleted notes are present in the cache as well, but they don't have any branches. As a result check for deleted branch is done by presence check - if the branch is not there even though the corresponding note has been loaded, we can infer it is deleted.\n *\n * Note and branch deletions are corner cases and usually not needed.\n *\n * Backend has a similar cache called Becca\n */\nclass Froca {\n    constructor() {\n        this.initializedPromise = this.loadInitialTree();\n    }\n\n    async loadInitialTree() {\n        const resp = await server.get('tree');\n\n        // clear the cache only directly before adding new content which is important for e.g., switching to protected session\n\n        /** @type {Object.<string, FNote>} */\n        this.notes = {};\n\n        /** @type {Object.<string, FBranch>} */\n        this.branches = {};\n\n        /** @type {Object.<string, FAttribute>} */\n        this.attributes = {};\n\n        /** @type {Object.<string, FAttachment>} */\n        this.attachments = {};\n\n        /** @type {Object.<string, Promise<FBlob>>} */\n        this.blobPromises = {};\n\n        this.addResp(resp);\n    }\n\n    async loadSubTree(subTreeNoteId) {\n        const resp = await server.get(`tree?subTreeNoteId=${subTreeNoteId}`);\n\n        this.addResp(resp);\n\n        return this.notes[subTreeNoteId];\n    }\n\n    addResp(resp) {\n        const noteRows = resp.notes;\n        const branchRows = resp.branches;\n        const attributeRows = resp.attributes;\n\n        const noteIdsToSort = new Set();\n\n        for (const noteRow of noteRows) {\n            const {noteId} = noteRow;\n\n            let note = this.notes[noteId];\n\n            if (note) {\n                note.update(noteRow);\n\n                // search note doesn't have child branches in the database and all the children are virtual branches\n                if (note.type !== 'search') {\n                    for (const childNoteId of note.children) {\n                        const childNote = this.notes[childNoteId];\n\n                        if (childNote) {\n                            childNote.parents = childNote.parents.filter(p => p !== noteId);\n\n                            delete this.branches[childNote.parentToBranch[noteId]];\n                            delete childNote.parentToBranch[noteId];\n                        }\n                    }\n\n                    note.children = [];\n                    note.childToBranch = {};\n                }\n\n                // we want to remove all \"real\" branches (represented in the database) since those will be created\n                // from branches argument but want to preserve all virtual ones from saved search\n                note.parents = note.parents.filter(parentNoteId => {\n                    const parentNote = this.notes[parentNoteId];\n                    const branch = this.branches[parentNote.childToBranch[noteId]];\n\n                    if (!parentNote || !branch) {\n                        return false;\n                    }\n\n                    if (branch.fromSearchNote) {\n                        return true;\n                    }\n\n                    parentNote.children = parentNote.children.filter(p => p !== noteId);\n\n                    delete this.branches[parentNote.childToBranch[noteId]];\n                    delete parentNote.childToBranch[noteId];\n\n                    return false;\n                });\n            }\n            else {\n                this.notes[noteId] = new FNote(this, noteRow);\n            }\n        }\n\n        for (const branchRow of branchRows) {\n            const branch = new FBranch(this, branchRow);\n\n            this.branches[branch.branchId] = branch;\n\n            const childNote = this.notes[branch.noteId];\n\n            if (childNote) {\n                childNote.addParent(branch.parentNoteId, branch.branchId, false);\n            }\n\n            const parentNote = this.notes[branch.parentNoteId];\n\n            if (parentNote) {\n                parentNote.addChild(branch.noteId, branch.branchId, false);\n\n                noteIdsToSort.add(parentNote.noteId);\n            }\n        }\n\n        for (const attributeRow of attributeRows) {\n            const {attributeId} = attributeRow;\n\n            this.attributes[attributeId] = new FAttribute(this, attributeRow);\n\n            const note = this.notes[attributeRow.noteId];\n\n            if (note && !note.attributes.includes(attributeId)) {\n                note.attributes.push(attributeId);\n            }\n\n            if (attributeRow.type === 'relation') {\n                const targetNote = this.notes[attributeRow.value];\n\n                if (targetNote) {\n                    if (!targetNote.targetRelations.includes(attributeId)) {\n                        targetNote.targetRelations.push(attributeId);\n                    }\n                }\n            }\n        }\n\n        // sort all of them at once, this avoids repeated sorts (#1480)\n        for (const noteId of noteIdsToSort) {\n            this.notes[noteId].sortChildren();\n            this.notes[noteId].sortParents();\n        }\n    }\n\n    async reloadNotes(noteIds) {\n        if (noteIds.length === 0) {\n            return;\n        }\n\n        noteIds = Array.from(new Set(noteIds)); // make noteIds unique\n\n        const resp = await server.post('tree/load', { noteIds });\n\n        this.addResp(resp);\n\n        appContext.triggerEvent('notesReloaded', {noteIds});\n    }\n\n    async loadSearchNote(noteId) {\n        const note = await this.getNote(noteId);\n\n        if (!note || note.type !== 'search') {\n            return;\n        }\n\n        const {searchResultNoteIds, highlightedTokens, error} = await server.get(`search-note/${note.noteId}`);\n\n        if (!Array.isArray(searchResultNoteIds)) {\n            throw new Error(`Search note '${note.noteId}' failed: ${searchResultNoteIds}`);\n        }\n\n        // reset all the virtual branches from old search results\n        if (note.noteId in froca.notes) {\n            froca.notes[note.noteId].children = [];\n            froca.notes[note.noteId].childToBranch = {};\n        }\n\n        const branches = [...note.getParentBranches(), ...note.getChildBranches()];\n\n        searchResultNoteIds.forEach((resultNoteId, index) => branches.push({\n            // branchId should be repeatable since sometimes we reload some notes without rerendering the tree\n            branchId: `virt-${note.noteId}-${resultNoteId}`,\n            noteId: resultNoteId,\n            parentNoteId: note.noteId,\n            notePosition: (index + 1) * 10,\n            fromSearchNote: true\n        }));\n\n        // update this note with standard (parent) branches + virtual (children) branches\n        this.addResp({\n            notes: [note],\n            branches,\n            attributes: []\n        });\n\n        froca.notes[note.noteId].searchResultsLoaded = true;\n        froca.notes[note.noteId].highlightedTokens = highlightedTokens;\n\n        return {error};\n    }\n\n    /** @returns {FNote[]} */\n    getNotesFromCache(noteIds, silentNotFoundError = false) {\n        return noteIds.map(noteId => {\n            if (!this.notes[noteId] && !silentNotFoundError) {\n                console.trace(`Can't find note '${noteId}'`);\n\n                return null;\n            }\n            else {\n                return this.notes[noteId];\n            }\n        }).filter(note => !!note);\n    }\n\n    /** @returns {Promise<FNote[]>} */\n    async getNotes(noteIds, silentNotFoundError = false) {\n        noteIds = Array.from(new Set(noteIds)); // make unique\n        const missingNoteIds = noteIds.filter(noteId => !this.notes[noteId]);\n\n        await this.reloadNotes(missingNoteIds);\n\n        return noteIds.map(noteId => {\n            if (!this.notes[noteId] && !silentNotFoundError) {\n                console.trace(`Can't find note '${noteId}'`);\n\n                return null;\n            } else {\n                return this.notes[noteId];\n            }\n        }).filter(note => !!note);\n    }\n\n    /** @returns {Promise<boolean>} */\n    async noteExists(noteId) {\n        const notes = await this.getNotes([noteId], true);\n\n        return notes.length === 1;\n    }\n\n    /** @returns {Promise<FNote>} */\n    async getNote(noteId, silentNotFoundError = false) {\n        if (noteId === 'none') {\n            console.trace(`No 'none' note.`);\n            return null;\n        }\n        else if (!noteId) {\n            console.trace(`Falsy noteId '${noteId}', returning null.`);\n            return null;\n        }\n\n        return (await this.getNotes([noteId], silentNotFoundError))[0];\n    }\n\n    /** @returns {FNote|null} */\n    getNoteFromCache(noteId) {\n        if (!noteId) {\n            throw new Error(\"空 noteId\");\n        }\n\n        return this.notes[noteId];\n    }\n\n    /** @returns {FBranch[]} */\n    getBranches(branchIds, silentNotFoundError = false) {\n        return branchIds\n            .map(branchId => this.getBranch(branchId, silentNotFoundError))\n            .filter(b => !!b);\n    }\n\n    /** @returns {FBranch} */\n    getBranch(branchId, silentNotFoundError = false) {\n        if (!(branchId in this.branches)) {\n            if (!silentNotFoundError) {\n                logError(`Not existing branch '${branchId}'`);\n            }\n        }\n        else {\n            return this.branches[branchId];\n        }\n    }\n\n    async getBranchId(parentNoteId, childNoteId) {\n        if (childNoteId === 'root') {\n            return 'none_root';\n        }\n\n        const child = await this.getNote(childNoteId);\n\n        if (!child) {\n            logError(`Could not find branchId for parent '${parentNoteId}', child '${childNoteId}' since child does not exist`);\n\n            return null;\n        }\n\n        return child.parentToBranch[parentNoteId];\n    }\n\n    /** @returns {Promise<FAttachment>} */\n    async getAttachment(attachmentId, silentNotFoundError = false) {\n        const attachment = this.attachments[attachmentId];\n        if (attachment) {\n            return attachment;\n        }\n\n        // load all attachments for the given note even if one is requested, don't load one by one\n        let attachmentRows;\n        try {\n            attachmentRows = await server.getWithSilentNotFound(`attachments/${attachmentId}/all`);\n        }\n        catch (e) {\n            if (silentNotFoundError) {\n                logInfo(`Attachment '${attachmentId}' not found, but silentNotFoundError is enabled: ` + e.message);\n                return null;\n            } else {\n                throw e;\n            }\n        }\n\n        const attachments = this.processAttachmentRows(attachmentRows);\n\n        if (attachments.length) {\n            attachments[0].getNote().attachments = attachments;\n        }\n\n        return this.attachments[attachmentId];\n    }\n\n    /** @returns {Promise<FAttachment[]>} */\n    async getAttachmentsForNote(noteId) {\n        const attachmentRows = await server.get(`notes/${noteId}/attachments`);\n        return this.processAttachmentRows(attachmentRows);\n    }\n\n    /** @returns {FAttachment[]} */\n    processAttachmentRows(attachmentRows) {\n        return attachmentRows.map(attachmentRow => {\n            let attachment;\n\n            if (attachmentRow.attachmentId in this.attachments) {\n                attachment = this.attachments[attachmentRow.attachmentId];\n                attachment.update(attachmentRow);\n            } else {\n                attachment = new FAttachment(this, attachmentRow);\n                this.attachments[attachment.attachmentId] = attachment;\n            }\n\n            return attachment;\n        });\n    }\n\n    /** @returns {Promise<FBlob>} */\n    async getBlob(entityType, entityId) {\n        // I'm not sure why we're not using blobIds directly, it would save us this composite key ...\n        // perhaps one benefit is that we're always requesting the latest blob, not relying on perhaps faulty/slow\n        // websocket update?\n        const key = `${entityType}-${entityId}`;\n\n        if (!this.blobPromises[key]) {\n            this.blobPromises[key] = server.get(`${entityType}/${entityId}/blob`)\n                .then(row => new FBlob(row))\n                .catch(e => console.error(`Cannot get blob for ${entityType} '${entityId}'`, e));\n\n            // we don't want to keep large payloads forever in memory, so we clean that up quite quickly\n            // this cache is more meant to share the data between different components within one business transaction (e.g. loading of the note into the tab context and all the components)\n            // if the blob is updated within the cache lifetime, it should be invalidated by froca_updater\n            this.blobPromises[key].then(\n                () => setTimeout(() => this.blobPromises[key] = null, 1000)\n            );\n        }\n\n        return await this.blobPromises[key];\n    }\n}\n\nconst froca = new Froca();\n\nexport default froca;\n","import appContext from \"../components/app_context.js\";\nimport treeService from \"./tree.js\";\nimport dialogService from \"./dialog.js\";\nimport froca from \"./froca.js\";\n\nfunction getHoistedNoteId() {\n    const activeNoteContext = appContext.tabManager.getActiveContext();\n\n    return activeNoteContext ? activeNoteContext.hoistedNoteId : 'root';\n}\n\nasync function unhoist() {\n    const activeNoteContext = appContext.tabManager.getActiveContext();\n\n    if (activeNoteContext) {\n        await activeNoteContext.unhoist();\n    }\n}\n\nfunction isTopLevelNode(node) {\n    return isHoistedNode(node.getParent());\n}\n\nfunction isHoistedNode(node) {\n    // even though check for 'root' should not be necessary, we keep it just in case\n    return node.data.noteId === \"root\"\n        || node.data.noteId === getHoistedNoteId();\n}\n\nasync function isHoistedInHiddenSubtree() {\n    const hoistedNoteId = getHoistedNoteId();\n\n    if (hoistedNoteId === 'root') {\n        return false;\n    }\n\n    const hoistedNote = await froca.getNote(hoistedNoteId);\n    return hoistedNote.isHiddenCompletely();\n}\n\nasync function checkNoteAccess(notePath, noteContext) {\n    const resolvedNotePath = await treeService.resolveNotePath(notePath, noteContext.hoistedNoteId);\n\n    if (!resolvedNotePath) {\n        console.log(`Cannot activate '${notePath}'`);\n        return false;\n    }\n\n    const hoistedNoteId = noteContext.hoistedNoteId;\n\n    if (!resolvedNotePath.includes(hoistedNoteId) && !resolvedNotePath.includes('_hidden')) {\n        const requestedNote = await froca.getNote(treeService.getNoteIdFromUrl(resolvedNotePath));\n        const hoistedNote = await froca.getNote(hoistedNoteId);\n\n        if (!hoistedNote.hasAncestor('_hidden')\n            && !await dialogService.confirm(`Requested note '${requestedNote.title}' is outside of hoisted note '${hoistedNote.title}' subtree and you must unhoist to access the note. Do you want to proceed with unhoisting?`)) {\n            return false;\n        }\n\n        // unhoist so we can activate the note\n        await unhoist();\n    }\n\n    return true;\n}\n\nexport default {\n    getHoistedNoteId,\n    unhoist,\n    isTopLevelNode,\n    isHoistedNode,\n    checkNoteAccess,\n    isHoistedInHiddenSubtree\n}\n","import server from \"./server.js\";\nimport appContext from \"../components/app_context.js\";\nimport shortcutService from \"./shortcuts.js\";\n\nconst keyboardActionRepo = {};\n\nconst keyboardActionsLoaded = server.get('keyboard-actions').then(actions => {\n\tactions = actions.filter(a => !!a.actionName); // filter out separators\n\n\tfor (const action of actions) {\n\t\taction.effectiveShortcuts = action.effectiveShortcuts.filter(shortcut => !shortcut.startsWith(\"global:\"));\n\n\t\tkeyboardActionRepo[action.actionName] = action;\n\t}\n\n\treturn actions;\n});\n\nasync function getActions() {\n\treturn await keyboardActionsLoaded;\n}\n\nasync function getActionsForScope(scope) {\n\tconst actions = await keyboardActionsLoaded;\n\n\treturn actions.filter(action => action.scope === scope);\n}\n\nasync function setupActionsForElement(scope, $el, component) {\n\tconst actions = await getActionsForScope(scope);\n\n\tfor (const action of actions) {\n\t\tfor (const shortcut of action.effectiveShortcuts) {\n\t\t\tshortcutService.bindElShortcut($el, shortcut, () => component.triggerCommand(action.actionName, {ntxId: appContext.tabManager.activeNtxId}));\n\t\t}\n\t}\n}\n\ngetActionsForScope(\"window\").then(actions => {\n\tfor (const action of actions) {\n\t\tfor (const shortcut of action.effectiveShortcuts) {\n\t\t\tshortcutService.bindGlobalShortcut(shortcut, () => appContext.triggerCommand(action.actionName, {ntxId: appContext.tabManager.activeNtxId}));\n\t\t}\n\t}\n});\n\nasync function getAction(actionName, silent = false) {\n\tawait keyboardActionsLoaded;\n\n\tconst action = keyboardActionRepo[actionName];\n\n\tif (!action) {\n\t\tif (silent) {\n\t\t\tconsole.debug(`Cannot find action '${actionName}'`);\n\t\t}\n\t\telse {\n\t\t\tthrow new Error(`Cannot find action '${actionName}'`);\n\t\t}\n\t}\n\n\treturn action;\n}\n\nfunction updateDisplayedShortcuts($container) {\n\t$container.find('kbd[data-command]').each(async (i, el) => {\n\t\tconst actionName = $(el).attr('data-command');\n\t\tconst action = await getAction(actionName, true);\n\n\t\tif (action) {\n\t\t\tconst keyboardActions = action.effectiveShortcuts.join(', ');\n\n\t\t\tif (keyboardActions || $(el).text() !== \"not set\") {\n\t\t\t\t$(el).text(keyboardActions);\n\t\t\t}\n\t\t}\n\t});\n\n\t$container.find('[data-trigger-command]').each(async (i, el) => {\n\t\tconst actionName = $(el).attr('data-trigger-command');\n\t\tconst action = await getAction(actionName, true);\n\n\t\tif (action) {\n\t\t\tconst title = $(el).attr('title');\n\t\t\tconst shortcuts = action.effectiveShortcuts.join(', ');\n\n\t\t\tif (title?.includes(shortcuts)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst newTitle = !title?.trim() ? shortcuts : `${title} (${shortcuts})`;\n\n\t\t\t$(el).attr('title', newTitle);\n\t\t}\n\t});\n}\n\nexport default {\n\tupdateDisplayedShortcuts,\n\tsetupActionsForElement,\n\tgetActions,\n\tgetActionsForScope\n};\n","const CKEDITOR = {\"js\": [\"libraries/ckeditor/ckeditor.js\"]};\n\nconst CODE_MIRROR = {\n    js: [\n        \"libraries/codemirror/codemirror.js\",\n        \"libraries/codemirror/addon/display/placeholder.js\",\n        \"libraries/codemirror/addon/edit/matchbrackets.js\",\n        \"libraries/codemirror/addon/edit/matchtags.js\",\n        \"libraries/codemirror/addon/fold/xml-fold.js\",\n        \"libraries/codemirror/addon/lint/lint.js\",\n        \"libraries/codemirror/addon/lint/eslint.js\",\n        \"libraries/codemirror/addon/mode/loadmode.js\",\n        \"libraries/codemirror/addon/mode/multiplex.js\",\n        \"libraries/codemirror/addon/mode/overlay.js\",\n        \"libraries/codemirror/addon/mode/simple.js\",\n        \"libraries/codemirror/addon/search/match-highlighter.js\",\n        \"libraries/codemirror/mode/meta.js\",\n        \"libraries/codemirror/keymap/vim.js\"\n    ],\n    css: [\n        \"libraries/codemirror/codemirror.css\",\n        \"libraries/codemirror/addon/lint/lint.css\"\n    ]\n};\n\nconst ESLINT = {js: [\"libraries/eslint.js\"]};\n\nconst RELATION_MAP = {\n    js: [\n        \"libraries/jsplumb.js\",\n        \"libraries/panzoom.js\"\n    ],\n    css: [\n        \"stylesheets/relation_map.css\"\n    ]\n};\n\nconst PRINT_THIS = {js: [\"libraries/printThis.js\"]};\n\nconst CALENDAR_WIDGET = {css: [\"stylesheets/calendar.css\"]};\n\nconst KATEX = {\n    js: [ \"node_modules/katex/dist/katex.min.js\",\n        \"node_modules/katex/dist/contrib/mhchem.min.js\",\n        \"node_modules/katex/dist/contrib/auto-render.min.js\" ],\n    css: [ \"node_modules/katex/dist/katex.min.css\" ]\n};\n\nconst WHEEL_ZOOM = {\n    js: [ \"libraries/wheel-zoom.min.js\"]\n};\n\nconst FORCE_GRAPH = {\n    js: [ \"libraries/force-graph.min.js\"]\n};\n\nconst MERMAID = {\n    js: [ \"libraries/mermaid.min.js\" ]\n}\n\nconst EXCALIDRAW = {\n    js: [\n        \"node_modules/react/umd/react.production.min.js\",\n        \"node_modules/react-dom/umd/react-dom.production.min.js\",\n        \"node_modules/@excalidraw/excalidraw/dist/excalidraw.production.min.js\",\n    ]\n};\n\nconst MARKJS = {\n    js: [\n        \"libraries/jquery.mark.es6.min.js\"\n    ]\n};\n\nasync function requireLibrary(library) {\n    if (library.css) {\n        library.css.map(cssUrl => requireCss(cssUrl));\n    }\n\n    if (library.js) {\n        for (const scriptUrl of library.js) {\n            await requireScript(scriptUrl);\n        }\n    }\n}\n\n// we save the promises in case of the same script being required concurrently multiple times\nconst loadedScriptPromises = {};\n\nasync function requireScript(url) {\n    url = `${window.glob.assetPath}/${url}`;\n\n    if (!loadedScriptPromises[url]) {\n        loadedScriptPromises[url] = $.ajax({\n            url: url,\n            dataType: \"script\",\n            cache: true\n        });\n    }\n\n    await loadedScriptPromises[url];\n}\n\nasync function requireCss(url, prependAssetPath = true) {\n    const cssLinks = Array\n        .from(document.querySelectorAll('link'))\n        .map(el => el.href);\n\n    if (!cssLinks.some(l => l.endsWith(url))) {\n        if (prependAssetPath) {\n            url = `${window.glob.assetPath}/${url}`;\n        }\n\n        $('head').append($('<link rel=\"stylesheet\" type=\"text/css\" />').attr('href', url));\n    }\n}\n\nexport default {\n    requireCss,\n    requireLibrary,\n    CKEDITOR,\n    CODE_MIRROR,\n    ESLINT,\n    RELATION_MAP,\n    PRINT_THIS,\n    CALENDAR_WIDGET,\n    KATEX,\n    WHEEL_ZOOM,\n    FORCE_GRAPH,\n    MERMAID,\n    EXCALIDRAW,\n    MARKJS\n}\n","import treeService from './tree.js';\nimport linkContextMenuService from \"../menus/link_context_menu.js\";\nimport appContext from \"../components/app_context.js\";\nimport froca from \"./froca.js\";\nimport utils from \"./utils.js\";\n\nfunction getNotePathFromUrl(url) {\n    const notePathMatch = /#(root[A-Za-z0-9_/]*)$/.exec(url);\n\n    return notePathMatch === null ? null : notePathMatch[1];\n}\n\nasync function getLinkIcon(noteId, viewMode) {\n    let icon;\n\n    if (viewMode === 'default') {\n        const note = await froca.getNote(noteId);\n\n        icon = note.getIcon();\n    } else if (viewMode === 'source') {\n        icon = 'bx bx-code-curly';\n    } else if (viewMode === 'attachments') {\n        icon = 'bx bx-file';\n    }\n    return icon;\n}\n\nasync function createLink(notePath, options = {}) {\n    if (!notePath || !notePath.trim()) {\n        logError(\"缺少笔记路径\");\n\n        return $(\"<span>\").text(\"[missing note]\");\n    }\n\n    if (!notePath.startsWith(\"root\")) {\n        // all note paths should start with \"root/\" (except for \"root\" itself)\n        // used, e.g., to find internal links\n        notePath = `root/${notePath}`;\n    }\n\n    const showTooltip = options.showTooltip === undefined ? true : options.showTooltip;\n    const showNotePath = options.showNotePath === undefined ? false : options.showNotePath;\n    const showNoteIcon = options.showNoteIcon === undefined ? false : options.showNoteIcon;\n    const referenceLink = options.referenceLink === undefined ? false : options.referenceLink;\n    const autoConvertToImage = options.autoConvertToImage === undefined ? false : options.autoConvertToImage;\n\n    const { noteId, parentNoteId } = treeService.getNoteIdAndParentIdFromUrl(notePath);\n    const viewScope = options.viewScope || {};\n    const viewMode = viewScope.viewMode || 'default';\n    let linkTitle = options.title;\n\n    if (!linkTitle) {\n        if (viewMode === 'attachments' && viewScope.attachmentId) {\n            const attachment = await froca.getAttachment(viewScope.attachmentId);\n\n            linkTitle = attachment ? attachment.title : '[missing attachment]';\n        } else {\n            linkTitle = await treeService.getNoteTitle(noteId, parentNoteId);\n        }\n    }\n\n    const note = await froca.getNote(noteId);\n\n    if (autoConvertToImage && ['image', 'canvas', 'mermaid'].includes(note.type) && viewMode === 'default') {\n        const encodedTitle = encodeURIComponent(linkTitle);\n\n        return $(\"<img>\")\n            .attr(\"src\", `api/images/${noteId}/${encodedTitle}?${Math.random()}`)\n            .attr(\"alt\", linkTitle);\n    }\n\n    const $container = $(\"<span>\");\n\n    if (showNoteIcon) {\n        let icon = await getLinkIcon(noteId, viewMode);\n\n        if (icon) {\n            $container\n                .append($(\"<span>\").addClass(`bx ${icon}`))\n                .append(\" \");\n        }\n    }\n\n    const hash = calculateHash({\n        notePath,\n        viewScope: viewScope\n    });\n\n    const $noteLink = $(\"<a>\", {\n        href: hash,\n        text: linkTitle\n    });\n\n    if (!showTooltip) {\n        $noteLink.addClass(\"no-tooltip-preview\");\n    }\n\n    if (referenceLink) {\n        $noteLink.addClass(\"reference-link\");\n    }\n\n    $container.append($noteLink);\n\n    if (showNotePath) {\n        const resolvedNotePathSegments = await treeService.resolveNotePathToSegments(notePath);\n\n        if (resolvedNotePathSegments) {\n            resolvedNotePathSegments.pop(); // remove last element\n\n            const parentNotePath = resolvedNotePathSegments.join(\"/\").trim();\n\n            if (parentNotePath) {\n                $container.append($(\"<small>\").text(` (${await treeService.getNotePathTitle(parentNotePath)})`));\n            }\n        }\n    }\n\n    return $container;\n}\n\nfunction calculateHash({notePath, ntxId, hoistedNoteId, viewScope = {}}) {\n    notePath = notePath || \"\";\n    const params = [\n        ntxId ? { ntxId: ntxId } : null,\n        (hoistedNoteId && hoistedNoteId !== 'root') ? { hoistedNoteId: hoistedNoteId } : null,\n        viewScope.viewMode && viewScope.viewMode !== 'default' ? { viewMode: viewScope.viewMode } : null,\n        viewScope.attachmentId ? { attachmentId: viewScope.attachmentId } : null\n    ].filter(p => !!p);\n\n    const paramStr = params.map(pair => {\n        const name = Object.keys(pair)[0];\n        const value = pair[name];\n\n        return `${encodeURIComponent(name)}=${encodeURIComponent(value)}`;\n    }).join(\"&\");\n\n    if (!notePath && !paramStr) {\n        return \"\";\n    }\n\n    let hash = `#${notePath}`;\n\n    if (paramStr) {\n        hash += `?${paramStr}`;\n    }\n\n    return hash;\n}\n\nfunction parseNavigationStateFromUrl(url) {\n    if (!url) {\n        return {};\n    }\n\n    const hashIdx = url.indexOf('#');\n    if (hashIdx === -1) {\n        return {};\n    }\n\n    const hash = url.substr(hashIdx + 1); // strip also the initial '#'\n    const [notePath, paramString] = hash.split(\"?\");\n\n    if (!notePath.match(/^[_a-z0-9]{4,}(\\/[_a-z0-9]{4,})*$/i)) {\n        return {};\n    }\n\n    const viewScope = {\n        viewMode: 'default'\n    };\n    let ntxId = null;\n    let hoistedNoteId = null;\n    let searchString = null;\n\n    if (paramString) {\n        for (const pair of paramString.split(\"&\")) {\n            let [name, value] = pair.split(\"=\");\n            name = decodeURIComponent(name);\n            value = decodeURIComponent(value);\n\n            if (name === 'ntxId') {\n                ntxId = value;\n            } else if (name === 'hoistedNoteId') {\n                hoistedNoteId = value;\n            } else if (name === 'searchString') {\n                searchString = value; // supports triggering search from URL, e.g. #?searchString=blabla\n            } else if (['viewMode', 'attachmentId'].includes(name)) {\n                viewScope[name] = value;\n            } else {\n                console.warn(`Unrecognized hash parameter '${name}'.`);\n            }\n        }\n    }\n\n    return {\n        notePath,\n        noteId: treeService.getNoteIdFromUrl(notePath),\n        ntxId,\n        hoistedNoteId,\n        viewScope,\n        searchString\n    };\n}\n\nfunction goToLink(evt) {\n    const $link = $(evt.target).closest(\"a,.block-link\");\n    const hrefLink = $link.attr('href') || $link.attr('data-href');\n\n    return goToLinkExt(evt, hrefLink, $link);\n}\n\nfunction goToLinkExt(evt, hrefLink, $link) {\n    if (hrefLink?.startsWith(\"data:\")) {\n        return true;\n    }\n\n    evt.preventDefault();\n    evt.stopPropagation();\n\n    const {notePath, viewScope} = parseNavigationStateFromUrl(hrefLink);\n\n    const ctrlKey = utils.isCtrlKey(evt);\n    const isLeftClick = evt.which === 1;\n    const isMiddleClick = evt.which === 2;\n    const openInNewTab = (isLeftClick && ctrlKey) || isMiddleClick;\n\n    const leftClick = evt.which === 1;\n    const middleClick = evt.which === 2;\n\n    if (notePath) {\n        if (openInNewTab) {\n            appContext.tabManager.openTabWithNoteWithHoisting(notePath, {viewScope});\n        } else if (isLeftClick) {\n            const ntxId = $(evt.target).closest(\"[data-ntx-id]\").attr(\"data-ntx-id\");\n\n            const noteContext = ntxId\n                ? appContext.tabManager.getNoteContextById(ntxId)\n                : appContext.tabManager.getActiveContext();\n\n            noteContext.setNote(notePath, {viewScope}).then(() => {\n                if (noteContext !== appContext.tabManager.getActiveContext()) {\n                    appContext.tabManager.activateNoteContext(noteContext.ntxId);\n                }\n            });\n        }\n    } else if (hrefLink) {\n        const withinEditLink = $link?.hasClass(\"ck-link-actions__preview\");\n        const outsideOfCKEditor = !$link || $link.closest(\"[contenteditable]\").length === 0;\n\n        if (openInNewTab\n            || (withinEditLink && (leftClick || middleClick))\n            || (outsideOfCKEditor && (leftClick || middleClick))\n        ) {\n            if (hrefLink.toLowerCase().startsWith('http') || hrefLink.startsWith(\"api/\")) {\n                window.open(hrefLink, '_blank');\n            } else if (hrefLink.toLowerCase().startsWith('file:') && utils.isElectron()) {\n                const electron = utils.dynamicRequire('electron');\n\n                electron.shell.openPath(hrefLink);\n            }\n        }\n    }\n\n    return true;\n}\n\nfunction linkContextMenu(e) {\n    const $link = $(e.target).closest(\"a\");\n    const url = $link.attr(\"href\") || $link.attr(\"data-href\");\n\n    const { notePath, viewScope } = parseNavigationStateFromUrl(url);\n\n    if (!notePath) {\n        return;\n    }\n\n    e.preventDefault();\n\n    linkContextMenuService.openContextMenu(notePath, e, viewScope, null);\n}\n\nasync function loadReferenceLinkTitle($el, href = null) {\n    const $link = $el[0].tagName === 'A' ? $el : $el.find(\"a\");\n\n    href = href || $link.attr(\"href\");\n    if (!href) {\n        console.warn(\"Empty URL for parsing: \" + $el[0].outerHTML);\n        return;\n    }\n\n    const {noteId, viewScope} = parseNavigationStateFromUrl(href);\n    const note = await froca.getNote(noteId, true);\n\n    if (note) {\n        $el.addClass(note.getColorClass());\n    }\n\n    const title = await getReferenceLinkTitle(href);\n    $el.text(title);\n\n    if (note) {\n        const icon = await getLinkIcon(noteId, viewScope.viewMode);\n\n        $el.prepend($(\"<span>\").addClass(icon));\n    }\n}\n\nasync function getReferenceLinkTitle(href) {\n    const {noteId, viewScope} = parseNavigationStateFromUrl(href);\n    if (!noteId) {\n        return \"[missing note]\";\n    }\n\n    const note = await froca.getNote(noteId);\n    if (!note) {\n        return \"[missing note]\";\n    }\n\n    if (viewScope?.viewMode === 'attachments' && viewScope?.attachmentId) {\n        const attachment = await note.getAttachmentById(viewScope.attachmentId);\n\n        return attachment ? attachment.title : \"[missing attachment]\";\n    } else {\n        return note.title;\n    }\n}\n\nfunction getReferenceLinkTitleSync(href) {\n    const {noteId, viewScope} = parseNavigationStateFromUrl(href);\n    if (!noteId) {\n        return \"[missing note]\";\n    }\n\n    const note = froca.getNoteFromCache(noteId);\n    if (!note) {\n        return \"[missing note]\";\n    }\n\n    if (viewScope?.viewMode === 'attachments' && viewScope?.attachmentId) {\n        if (!note.attachments) {\n            return \"[loading title...]\";\n        }\n\n        const attachment = note.attachments.find(att => att.attachmentId === viewScope.attachmentId);\n\n        return attachment ? attachment.title : \"[missing attachment]\";\n    } else {\n        return note.title;\n    }\n}\n\n$(document).on('click', \"a\", goToLink);\n$(document).on('auxclick', \"a\", goToLink); // to handle the middle button\n$(document).on('contextmenu', 'a', linkContextMenu);\n$(document).on('dblclick', \"a\", e => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const $link = $(e.target).closest(\"a\");\n\n    const address = $link.attr('href');\n\n    if (address && address.startsWith('http')) {\n        window.open(address, '_blank');\n    }\n});\n\n$(document).on('mousedown', 'a', e => {\n    if (e.which === 2) {\n        // prevent paste on middle click\n        // https://github.com/zadam/trilium/issues/2995\n        // https://developer.mozilla.org/en-US/docs/Web/API/Element/auxclick_event#preventing_default_actions\n        e.preventDefault();\n        return false;\n    }\n});\n\nexport default {\n    getNotePathFromUrl,\n    createLink,\n    goToLink,\n    goToLinkExt,\n    loadReferenceLinkTitle,\n    getReferenceLinkTitle,\n    getReferenceLinkTitleSync,\n    calculateHash,\n    parseNavigationStateFromUrl\n};\n","/**\n * The purpose of this class is to cache the list of attributes for notes.\n *\n * Cache invalidation granularity is global - whenever a write operation is detected to notes, branches or attributes,\n * we invalidate the whole cache. That's OK, since the purpose for this is to speed up batch read-only operations, such\n * as loading the tree which uses attributes heavily.\n */\nclass NoteAttributeCache {\n    constructor() {\n        /** @property {Object.<string, BAttribute[]>} */\n        this.attributes = {};\n    }\n\n    invalidate() {\n        this.attributes = {};\n    }\n}\n\nconst noteAttributeCache = new NoteAttributeCache();\n\nexport default noteAttributeCache;\n","import appContext from \"../components/app_context.js\";\nimport protectedSessionHolder from \"./protected_session_holder.js\";\nimport server from \"./server.js\";\nimport ws from \"./ws.js\";\nimport froca from \"./froca.js\";\nimport treeService from \"./tree.js\";\nimport toastService from \"./toast.js\";\n\nasync function createNote(parentNotePath, options = {}) {\n    options = Object.assign({\n        activate: true,\n        focus: 'title',\n        target: 'into'\n    }, options);\n\n    // if isProtected isn't available (user didn't enter password yet), then note is created as unencrypted,\n    // but this is quite weird since the user doesn't see WHERE the note is being created, so it shouldn't occur often\n    if (!options.isProtected || !protectedSessionHolder.isProtectedSessionAvailable()) {\n        options.isProtected = false;\n    }\n\n    if (appContext.tabManager.getActiveContextNoteType() !== 'text') {\n        options.saveSelection = false;\n    }\n\n    if (options.saveSelection) {\n        [options.title, options.content] = parseSelectedHtml(options.textEditor.getSelectedHtml());\n    }\n\n    const parentNoteId = treeService.getNoteIdFromUrl(parentNotePath);\n\n    if (options.type === 'mermaid' && !options.content) {\n        options.content = `graph TD;\n    A-->B;\n    A-->C;\n    B-->D;\n    C-->D;`\n    }\n\n    const {note, branch} = await server.post(`notes/${parentNoteId}/children?target=${options.target}&targetBranchId=${options.targetBranchId || \"\"}`, {\n        title: options.title,\n        content: options.content || \"\",\n        isProtected: options.isProtected,\n        type: options.type,\n        mime: options.mime,\n        templateNoteId: options.templateNoteId\n    });\n\n    if (options.saveSelection) {\n        // we remove the selection only after it was saved to server to make sure we don't lose anything\n        options.textEditor.removeSelection();\n    }\n\n    await ws.waitForMaxKnownEntityChangeId();\n\n    if (options.activate) {\n        const activeNoteContext = appContext.tabManager.getActiveContext();\n        await activeNoteContext.setNote(`${parentNotePath}/${note.noteId}`);\n\n        if (options.focus === 'title') {\n            appContext.triggerEvent('focusAndSelectTitle', {isNewNote: true});\n        }\n        else if (options.focus === 'content') {\n            appContext.triggerEvent('focusOnDetail', {ntxId: activeNoteContext.ntxId});\n        }\n    }\n\n    const noteEntity = await froca.getNote(note.noteId);\n    const branchEntity = froca.getBranch(branch.branchId);\n\n    return {\n        note: noteEntity,\n        branch: branchEntity\n    };\n}\n\nasync function chooseNoteType() {\n    return new Promise(res => {\n        appContext.triggerCommand(\"chooseNoteType\", {callback: res});\n    });\n}\n\nasync function createNoteWithTypePrompt(parentNotePath, options = {}) {\n    const {success, noteType, templateNoteId} = await chooseNoteType();\n\n    if (!success) {\n        return;\n    }\n\n    options.type = noteType;\n    options.templateNoteId = templateNoteId;\n\n    return await createNote(parentNotePath, options);\n}\n\n/* If the first element is heading, parse it out and use it as a new heading. */\nfunction parseSelectedHtml(selectedHtml) {\n    const dom = $.parseHTML(selectedHtml);\n\n    if (dom.length > 0 && dom[0].tagName && dom[0].tagName.match(/h[1-6]/i)) {\n        const title = $(dom[0]).text();\n        // remove the title from content (only first occurrence)\n        const content = selectedHtml.replace(dom[0].outerHTML, \"\");\n\n        return [title, content];\n    }\n    else {\n        return [null, selectedHtml];\n    }\n}\n\nasync function duplicateSubtree(noteId, parentNotePath) {\n    const parentNoteId = treeService.getNoteIdFromUrl(parentNotePath);\n    const {note} = await server.post(`notes/${noteId}/duplicate/${parentNoteId}`);\n\n    await ws.waitForMaxKnownEntityChangeId();\n\n    const activeNoteContext = appContext.tabManager.getActiveContext();\n    activeNoteContext.setNote(`${parentNotePath}/${note.noteId}`);\n\n    const origNote = await froca.getNote(noteId);\n    toastService.showMessage(`笔记 \"${origNote.title}\" 已被复制`);\n}\n\nexport default {\n    createNote,\n    createNoteWithTypePrompt,\n    duplicateSubtree,\n    chooseNoteType\n};\n","import treeService from \"./tree.js\";\nimport linkService from \"./link.js\";\nimport froca from \"./froca.js\";\nimport utils from \"./utils.js\";\nimport attributeRenderer from \"./attribute_renderer.js\";\nimport contentRenderer from \"./content_renderer.js\";\nimport appContext from \"../components/app_context.js\";\n\nfunction setupGlobalTooltip() {\n    $(document).on(\"mouseenter\", \"a\", mouseEnterHandler);\n\n    // close any note tooltip after click, this fixes the problem that sometimes tooltips remained on the screen\n    $(document).on(\"click\", e => {\n        if ($(e.target).closest(\".note-tooltip\").length) {\n            // click within the tooltip shouldn't close it\n            return;\n        }\n\n        $('.note-tooltip').remove();\n    });\n}\n\nfunction setupElementTooltip($el) {\n    $el.on('mouseenter', mouseEnterHandler);\n}\n\nasync function mouseEnterHandler() {\n    const $link = $(this);\n\n    if ($link.hasClass(\"no-tooltip-preview\") || $link.hasClass(\"disabled\")) {\n        return;\n    } else if ($link.closest(\".ck-link-actions\").length) {\n        // this is to avoid showing tooltip from inside the CKEditor link editor dialog\n        return;\n    } else if ($link.closest(\".note-tooltip\").length) {\n        // don't show tooltip for links within tooltip\n        return;\n    }\n\n    const url = $link.attr(\"href\") || $link.attr(\"data-href\");\n    const { notePath, noteId, viewScope } = linkService.parseNavigationStateFromUrl(url);\n\n    if (!notePath || viewScope.viewMode !== 'default') {\n        return;\n    }\n\n    const linkId = $link.attr(\"data-link-id\") || `link-${Math.floor(Math.random() * 1000000)}`;\n    $link.attr(\"data-link-id\", linkId);\n\n    if ($(`.${linkId}`).is(\":visible\")) {\n        // tooltip is already open for this link\n        return;\n    }\n\n    const note = await froca.getNote(noteId);\n\n    const [content] = await Promise.all([\n        renderTooltip(note),\n        // to reduce flicker due to accidental mouseover, cursor must stay for a bit over the link for tooltip to appear\n        new Promise(res => setTimeout(res, 500))\n    ]);\n\n    if (utils.isHtmlEmpty(content)) {\n        return;\n    }\n\n    const html = `<div class=\"note-tooltip-content\">${content}</div>`;\n    const tooltipClass = 'tooltip-' + Math.floor(Math.random() * 999_999_999);\n\n    // we need to check if we're still hovering over the element\n    // since the operation to get tooltip content was async, it is possible that\n    // we now create tooltip which won't close because it won't receive mouseleave event\n    if ($(this).filter(\":hover\").length > 0) {\n        $(this).tooltip({\n            container: 'body',\n            // https://github.com/zadam/trilium/issues/2794 https://github.com/zadam/trilium/issues/2988\n            // with bottom this flickering happens a bit less\n            placement: 'bottom',\n            trigger: 'manual',\n            boundary: 'window',\n            title: html,\n            html: true,\n            template: `<div class=\"tooltip note-tooltip ${tooltipClass}\" role=\"tooltip\"><div class=\"arrow\"></div><div class=\"tooltip-inner\"></div></div>`,\n            sanitize: false,\n            customClass: linkId\n        });\n\n        $(this).tooltip('show');\n\n        // the purpose of the code below is to:\n        // - allow user to go from hovering the link to hovering the tooltip to be able to scroll,\n        //   click on links within tooltip etc. without tooltip disappearing\n        // - once the user moves the cursor away from both link and the tooltip, hide the tooltip\n        const checkTooltip = () => {\n            if (!$(`.${tooltipClass}`).is(':visible')) {\n                console.log(\"Not visible anymore\");\n\n                return;\n            }\n\n            if (!$(this).filter(\":hover\").length && !$(`.${linkId}:hover`).length) {\n                // cursor is neither over the link nor over the tooltip, user likely is not interested\n                $(this).tooltip('dispose');\n            } else {\n                setTimeout(checkTooltip, 1000);\n            }\n        }\n\n        setTimeout(checkTooltip, 1000);\n    }\n}\n\nasync function renderTooltip(note) {\n    if (!note) {\n        return '<div>笔记已被删除.</div>';\n    }\n\n    const hoistedNoteId = appContext.tabManager.getActiveContext()?.hoistedNoteId;\n    const bestNotePath = note.getBestNotePathString(hoistedNoteId);\n\n    if (!bestNotePath) {\n        return;\n    }\n\n    let content = `<h5 class=\"note-tooltip-title\">${(await treeService.getNoteTitleWithPathAsSuffix(bestNotePath)).prop('outerHTML')}</h5>`;\n\n    const {$renderedAttributes} = await attributeRenderer.renderNormalAttributes(note);\n\n    const {$renderedContent} = await contentRenderer.getRenderedContent(note, {\n        tooltip: true,\n        trim: true\n    });\n\n    content = `${content}<div class=\"note-tooltip-attributes\">${$renderedAttributes[0].outerHTML}</div>${$renderedContent[0].outerHTML}`;\n\n    return content;\n}\n\nexport default {\n    setupGlobalTooltip,\n    setupElementTooltip\n}\n","import utils from \"./utils.js\";\nimport server from \"./server.js\";\n\nfunction checkType(type) {\n    if (type !== 'notes' && type !== 'attachments') {\n        throw new Error(`Unrecognized type '${type}', should be 'notes' or 'attachments'`);\n    }\n}\n\nfunction getFileUrl(type, noteId) {\n    checkType(type);\n\n    return getUrlForDownload(`api/${type}/${noteId}/download`);\n}\n\nfunction getOpenFileUrl(type, noteId) {\n    checkType(type);\n\n    return getUrlForDownload(`api/${type}/${noteId}/open`);\n}\n\nfunction download(url) {\n    if (utils.isElectron()) {\n        const remote = utils.dynamicRequire('@electron/remote');\n\n        remote.getCurrentWebContents().downloadURL(url);\n    } else {\n        window.location.href = url;\n    }\n}\n\nfunction downloadFileNote(noteId) {\n    const url = `${getFileUrl('notes', noteId)}?${Date.now()}`; // don't use cache\n\n    download(url);\n}\n\nfunction downloadAttachment(attachmentId) {\n    const url = `${getFileUrl('attachments', attachmentId)}?${Date.now()}`; // don't use cache\n\n    download(url);\n}\n\nasync function openCustom(type, entityId, mime) {\n    checkType(type);\n    if (!utils.isElectron() || utils.isMac()) {\n        return;\n    }\n\n    const resp = await server.post(`${type}/${entityId}/save-to-tmp-dir`);\n    let filePath = resp.tmpFilePath;\n    const {exec} = utils.dynamicRequire('child_process');\n    const platform = process.platform;\n\n    if (platform === 'linux') {\n        // we don't know which terminal is available, try in succession\n        const terminals = ['x-terminal-emulator', 'gnome-terminal', 'konsole', 'xterm', 'xfce4-terminal', 'mate-terminal', 'rxvt', 'terminator', 'terminology'];\n        const openFileWithTerminal = (terminal) => {\n            const command = `${terminal} -e 'mimeopen -d \"${filePath}\"'`;\n            console.log(`Open Note custom: ${command} `);\n            exec(command, (error, stdout, stderr) => {\n                if (error) {\n                    console.error(`Open Note custom: Failed to open file with ${terminal}: ${error}`);\n                    searchTerminal(terminals.indexOf(terminal) + 1);\n                } else {\n                    console.log(`Open Note custom: File opened with ${terminal}: ${stdout}`);\n                }\n            });\n        };\n\n        const searchTerminal = (index) => {\n            const terminal = terminals[index];\n            if (!terminal) {\n                console.error('Open Note custom: No terminal found!');\n                open(getFileUrl(entityId), {url: true});\n                return;\n            }\n            exec(`which ${terminal}`, (error, stdout, stderr) => {\n                if (stdout.trim()) {\n                    openFileWithTerminal(terminal);\n                } else {\n                    searchTerminal(index + 1);\n                }\n            });\n        };\n        searchTerminal(0);\n    } else if (platform === 'win32') {\n        if (filePath.indexOf(\"/\") !== -1) {\n            // Note that the path separator must be \\ instead of /\n            filePath = filePath.replace(/\\//g, \"\\\\\");\n        }\n        const command = `rundll32.exe shell32.dll,OpenAs_RunDLL ` + filePath;\n        exec(command, (err, stdout, stderr) => {\n            if (err) {\n                console.error(\"Open Note custom: \", err);\n                open(getFileUrl(entityId), {url: true});\n                return;\n            }\n        });\n    } else {\n        console.log('Currently \"Open Note custom\" only supports linux and windows systems');\n        open(getFileUrl(entityId), {url: true});\n    }\n}\n\nconst openNoteCustom = async (noteId, mime) => await openCustom('notes', noteId, mime);\nconst openAttachmentCustom = async (attachmentId, mime) => await openCustom('attachments', attachmentId, mime);\n\n\nfunction downloadRevision(noteId, revisionId) {\n    const url = getUrlForDownload(`api/revisions/${revisionId}/download`);\n\n    download(url);\n}\n\n/**\n * @param url - should be without initial slash!!!\n */\nfunction getUrlForDownload(url) {\n    if (utils.isElectron()) {\n        // electron needs absolute URL, so we extract current host, port, protocol\n        return `${getHost()}/${url}`;\n    }\n    else {\n        // web server can be deployed on subdomain, so we need to use a relative path\n        return url;\n    }\n}\n\nfunction canOpenInBrowser(mime) {\n    return mime === \"application/pdf\"\n        || mime.startsWith(\"image\")\n        || mime.startsWith(\"audio\")\n        || mime.startsWith(\"video\");\n}\n\nasync function openExternally(type, entityId, mime) {\n    checkType(type);\n\n    if (utils.isElectron()) {\n        const resp = await server.post(`${type}/${entityId}/save-to-tmp-dir`);\n\n        const electron = utils.dynamicRequire('electron');\n        const res = await electron.shell.openPath(resp.tmpFilePath);\n\n        if (res) {\n            // fallback in case there's no default application for this file\n            window.open(getFileUrl(type, entityId));\n        }\n    }\n    else {\n        // allow browser to handle opening common file\n        if (canOpenInBrowser(mime)) {\n            window.open(getOpenFileUrl(type, entityId));\n        } else {\n            window.location.href = getFileUrl(type, entityId);\n        }\n    }\n}\n\nconst openNoteExternally = async (noteId, mime) => await openExternally('notes', noteId, mime);\nconst openAttachmentExternally = async (attachmentId, mime) => await openExternally('attachments', attachmentId, mime);\n\nfunction getHost() {\n    const url = new URL(window.location.href);\n    return `${url.protocol}//${url.hostname}:${url.port}`;\n}\n\nexport default {\n    download,\n    downloadFileNote,\n    downloadRevision,\n    downloadAttachment,\n    getUrlForDownload,\n    openNoteExternally,\n    openAttachmentExternally,\n    openNoteCustom,\n    openAttachmentCustom,\n}\n","import server from \"./server.js\";\n\nclass Options {\n    constructor() {\n        this.initializedPromise = server.get('options').then(data => this.load(data));\n    }\n\n    load(arr) {\n        this.arr = arr;\n    }\n\n    get(key) {\n        return this.arr[key];\n    }\n\n    getNames() {\n        return Object.keys(this.arr);\n    }\n\n    getJson(key) {\n        try {\n            return JSON.parse(this.arr[key]);\n        }\n        catch (e) {\n            return null;\n        }\n    }\n\n    getInt(key) {\n        return parseInt(this.arr[key]);\n    }\n\n    getFloat(key) {\n        return parseFloat(this.arr[key]);\n    }\n\n    is(key) {\n        return this.arr[key] === 'true';\n    }\n\n    set(key, value) {\n        this.arr[key] = value;\n    }\n\n    async save(key, value) {\n        this.set(key, value);\n\n        const payload = {};\n        payload[key] = value;\n\n        await server.put(`options`, payload);\n    }\n\n    async toggle(key) {\n        await this.save(key, (!this.is(key)).toString());\n    }\n}\n\nconst options = new Options();\n\nexport default options;\n","function parse(value) {\n    const tokens = value.split(',').map(t => t.trim());\n    const defObj = {};\n\n    for (const token of tokens) {\n        if (token === 'promoted') {\n            defObj.isPromoted = true;\n        }\n        else if (['text', 'number', 'boolean', 'date', 'datetime', 'url'].includes(token)) {\n            defObj.labelType = token;\n        }\n        else if (['single', 'multi'].includes(token)) {\n            defObj.multiplicity = token;\n        }\n        else if (token.startsWith('precision')) {\n            const chunks = token.split('=');\n\n            defObj.numberPrecision = parseInt(chunks[1]);\n        }\n        else if (token.startsWith('alias')) {\n            const chunks = token.split('=');\n\n            defObj.promotedAlias = chunks[1];\n        }\n        else if (token.startsWith('inverse')) {\n            const chunks = token.split('=');\n\n            defObj.inverseRelation = chunks[1];\n        }\n        else {\n            console.log(\"Unrecognized attribute definition token:\", token);\n        }\n    }\n\n    return defObj;\n}\n\nexport default {\n    parse\n};\n","import server from './server.js';\nimport protectedSessionHolder from './protected_session_holder.js';\nimport toastService from \"./toast.js\";\nimport ws from \"./ws.js\";\nimport appContext from \"../components/app_context.js\";\nimport froca from \"./froca.js\";\nimport utils from \"./utils.js\";\nimport options from \"./options.js\";\n\nlet protectedSessionDeferred = null;\n\nasync function leaveProtectedSession() {\n    if (protectedSessionHolder.isProtectedSessionAvailable()) {\n        await protectedSessionHolder.resetProtectedSession();\n    }\n}\n\n/** returned promise resolves with true if new protected session was established, false if no action was necessary */\nfunction enterProtectedSession() {\n    const dfd = $.Deferred();\n\n    if (!options.is(\"isPasswordSet\")) {\n        appContext.triggerCommand(\"showPasswordNotSet\");\n        return dfd;\n    }\n\n    if (protectedSessionHolder.isProtectedSessionAvailable()) {\n        dfd.resolve(false);\n    }\n    else {\n        // using deferred instead of promise because it allows resolving from the outside\n        protectedSessionDeferred = dfd;\n\n        appContext.triggerCommand(\"showProtectedSessionPasswordDialog\");\n    }\n\n    return dfd.promise();\n}\n\nasync function reloadData() {\n    const allNoteIds = Object.keys(froca.notes);\n\n    await froca.loadInitialTree();\n\n    // make sure that all notes used in the application are loaded, including the ones not shown in the tree\n    await froca.reloadNotes(allNoteIds, true);\n}\n\nasync function setupProtectedSession(password) {\n    const response = await server.post('login/protected', { password: password });\n\n    if (!response.success) {\n        toastService.showError(\"密码错误.\", 3000);\n        return;\n    }\n\n    protectedSessionHolder.enableProtectedSession();\n}\n\nws.subscribeToMessages(async message => {\n    if (message.type === 'protectedSessionLogin') {\n        await reloadData();\n\n        await appContext.triggerEvent('frocaReloaded');\n\n        appContext.triggerEvent('protectedSessionStarted');\n\n        appContext.triggerCommand(\"closeProtectedSessionPasswordDialog\");\n\n        if (protectedSessionDeferred !== null) {\n            protectedSessionDeferred.resolve(true);\n            protectedSessionDeferred = null;\n        }\n\n        toastService.showMessage(\"受保护的会话已启动.\");\n    }\n    else if (message.type === 'protectedSessionLogout') {\n        utils.reloadFrontendApp(`Protected session logout`);\n    }\n});\n\nasync function protectNote(noteId, protect, includingSubtree) {\n    await enterProtectedSession();\n\n    await server.put(`notes/${noteId}/protect/${protect ? 1 : 0}?subtree=${includingSubtree ? 1 : 0}`);\n}\n\nfunction makeToast(message, protectingLabel, text) {\n    return {\n        id: message.taskId,\n        title: `${protectingLabel} status`,\n        message: text,\n        icon: message.data.protect ? \"check-shield\" : \"shield\"\n    };\n}\n\nws.subscribeToMessages(async message => {\n    if (message.taskType !== 'protectNotes') {\n        return;\n    }\n\n    const protectingLabel = message.data.protect ? \"保护\" : \"取消保护\";\n\n    if (message.type === 'taskError') {\n        toastService.closePersistent(message.taskId);\n        toastService.showError(message.message);\n    } else if (message.type === 'taskProgressCount') {\n        toastService.showPersistent(makeToast(message, protectingLabel,`${protectingLabel} in progress: ${message.progressCount}`));\n    } else if (message.type === 'taskSucceeded') {\n        const toast = makeToast(message, protectingLabel, `${protectingLabel} finished successfully.`);\n        toast.closeAfter = 3000;\n\n        toastService.showPersistent(toast);\n    }\n});\n\nexport default {\n    protectNote,\n    enterProtectedSession,\n    leaveProtectedSession,\n    setupProtectedSession\n};\n","import server from \"./server.js\";\n\nfunction enableProtectedSession() {\n    glob.isProtectedSessionAvailable = true;\n\n    touchProtectedSession();\n}\n\nasync function resetProtectedSession() {\n    await server.post(\"logout/protected\");\n}\n\nfunction isProtectedSessionAvailable() {\n    return glob.isProtectedSessionAvailable;\n}\n\nasync function touchProtectedSession() {\n    if (isProtectedSessionAvailable()) {\n        await server.post(\"login/protected/touch\");\n    }\n}\n\nfunction touchProtectedSessionIfNecessary(note) {\n    if (note && note.isProtected && isProtectedSessionAvailable()) {\n        touchProtectedSession();\n    }\n}\n\nexport default {\n    enableProtectedSession,\n    resetProtectedSession,\n    isProtectedSessionAvailable,\n    touchProtectedSession,\n    touchProtectedSessionIfNecessary\n};\n","import server from \"./server.js\";\nimport bundleService from \"./bundle.js\";\n\nasync function render(note, $el) {\n    const relations = note.getRelations('renderNote');\n    const renderNoteIds = relations\n        .map(rel => rel.value)\n        .filter(noteId => noteId);\n\n    $el.empty().toggle(renderNoteIds.length > 0);\n\n    for (const renderNoteId of renderNoteIds) {\n        const bundle = await server.post(`script/bundle/${renderNoteId}`);\n\n        const $scriptContainer = $('<div>');\n        $el.append($scriptContainer);\n\n        $scriptContainer.append(bundle.html);\n\n        // async so that scripts cannot block trilium execution\n        bundleService.executeBundle(bundle, note, $scriptContainer);\n    }\n\n    return renderNoteIds.length > 0;\n}\n\nexport default {\n    render\n}\n","import server from './server.js';\nimport utils from './utils.js';\nimport toastService from './toast.js';\nimport linkService from './link.js';\nimport froca from './froca.js';\nimport noteTooltipService from './note_tooltip.js';\nimport protectedSessionService from './protected_session.js';\nimport dateNotesService from './date_notes.js';\nimport searchService from './search.js';\nimport RightPanelWidget from '../widgets/right_panel_widget.js';\nimport ws from \"./ws.js\";\nimport appContext from \"../components/app_context.js\";\nimport NoteContextAwareWidget from \"../widgets/note_context_aware_widget.js\";\nimport BasicWidget from \"../widgets/basic_widget.js\";\nimport SpacedUpdate from \"./spaced_update.js\";\nimport shortcutService from \"./shortcuts.js\";\nimport dialogService from \"./dialog.js\";\n\n\n/**\n * A whole number\n * @typedef {number} int\n */\n\n/**\n * An instance of the frontend api available globally.\n * @global\n * @var {FrontendScriptApi} api\n */\n\n/**\n * <p>This is the main frontend API interface for scripts. All the properties and methods are published in the \"api\" object\n * available in the JS frontend notes. You can use e.g. <code>api.showMessage(api.startNote.title);</code></p>\n *\n * @constructor\n */\nfunction FrontendScriptApi(startNote, currentNote, originEntity = null, $container = null) {\n    /**\n     * Container of all the rendered script content\n     * @type {jQuery}\n     * */\n    this.$container = $container;\n\n    /**\n     * Note where the script started executing, i.e., the (event) entrypoint of the current script execution.\n     * @type {FNote}\n     */\n    this.startNote = startNote;\n\n    /**\n     * Note where the script is currently executing, i.e. the note where the currently executing source code is written.\n     * @type {FNote}\n     */\n    this.currentNote = currentNote;\n\n    /**\n     * Entity whose event triggered this execution.\n     * @type {object|null}\n     */\n    this.originEntity = originEntity;\n\n    /**\n     * day.js library for date manipulation.\n     * See {@link https://day.js.org} for documentation\n     * @see https://day.js.org\n     * @type {dayjs}\n     */\n    this.dayjs = dayjs;\n\n    /** @type {RightPanelWidget} */\n    this.RightPanelWidget = RightPanelWidget;\n\n    /** @type {NoteContextAwareWidget} */\n    this.NoteContextAwareWidget = NoteContextAwareWidget;\n\n    /** @type {BasicWidget} */\n    this.BasicWidget = BasicWidget;\n\n    /**\n     * Activates note in the tree and in the note detail.\n     *\n     * @method\n     * @param {string} notePath (or noteId)\n     * @returns {Promise<void>}\n     */\n    this.activateNote = async notePath => {\n        await appContext.tabManager.getActiveContext().setNote(notePath);\n    };\n\n    /**\n     * Activates newly created note. Compared to this.activateNote() also makes sure that frontend has been fully synced.\n     *\n     * @param {string} notePath (or noteId)\n     * @returns {Promise<void>}\n     */\n    this.activateNewNote = async notePath => {\n        await ws.waitForMaxKnownEntityChangeId();\n\n        await appContext.tabManager.getActiveContext().setNote(notePath);\n        await appContext.triggerEvent('focusAndSelectTitle');\n    };\n\n    /**\n     * Open a note in a new tab.\n     *\n     * @method\n     * @param {string} notePath (or noteId)\n     * @param {boolean} activate - set to true to activate the new tab, false to stay on the current tab\n     * @returns {Promise<void>}\n     */\n    this.openTabWithNote = async (notePath, activate) => {\n        await ws.waitForMaxKnownEntityChangeId();\n\n        await appContext.tabManager.openTabWithNoteWithHoisting(notePath, { activate });\n\n        if (activate) {\n            await appContext.triggerEvent('focusAndSelectTitle');\n        }\n    };\n\n    /**\n     * Open a note in a new split.\n     *\n     * @method\n     * @param {string} notePath (or noteId)\n     * @param {boolean} activate - set to true to activate the new split, false to stay on the current split\n     * @returns {Promise<void>}\n     */\n    this.openSplitWithNote = async (notePath, activate) => {\n        await ws.waitForMaxKnownEntityChangeId();\n\n        const subContexts = appContext.tabManager.getActiveContext().getSubContexts();\n        const {ntxId} = subContexts[subContexts.length - 1];\n\n        await appContext.triggerCommand(\"openNewNoteSplit\", {ntxId, notePath});\n\n        if (activate) {\n            await appContext.triggerEvent('focusAndSelectTitle');\n        }\n    };\n\n    /**\n     * Adds a new launcher to the launchbar. If the launcher (id) already exists, it will be updated.\n     *\n     * @method\n     * @deprecated you can now create/modify launchers in the top-left Menu -> Configure Launchbar\n     *             for special needs there's also backend API's createOrUpdateLauncher()\n     * @param {object} opts\n     * @param {string} opts.title\n     * @param {function} opts.action - callback handling the click on the button\n     * @param {string} [opts.id] - id of the button, used to identify the old instances of this button to be replaced\n     *                          ID is optional because of BC, but not specifying it is deprecated. ID can be alphanumeric only.\n     * @param {string} [opts.icon] - name of the boxicon to be used (e.g. \"time\" for \"bx-time\" icon)\n     * @param {string} [opts.shortcut] - keyboard shortcut for the button, e.g. \"alt+t\"\n     */\n    this.addButtonToToolbar = async opts => {\n        console.warn(\"api.addButtonToToolbar() has been deprecated since v0.58 and may be removed in the future. Use  Menu -> Configure Launchbar to create/update launchers instead.\");\n\n        const {action, ...reqBody} = opts;\n        reqBody.action = action.toString();\n\n        await server.put('special-notes/api-script-launcher', reqBody);\n    };\n\n    function prepareParams(params) {\n        if (!params) {\n            return params;\n        }\n\n        return params.map(p => {\n            if (typeof p === \"function\") {\n                return `!@#Function: ${p.toString()}`;\n            }\n            else {\n                return p;\n            }\n        });\n    }\n\n    /**\n     * @private\n     */\n    this.__runOnBackendInner = async (func, params, transactional) => {\n        if (typeof func === \"function\") {\n            func = func.toString();\n        }\n\n        const ret = await server.post('script/exec', {\n            script: func,\n            params: prepareParams(params),\n            startNoteId: startNote.noteId,\n            currentNoteId: currentNote.noteId,\n            originEntityName: \"notes\", // currently there's no other entity on the frontend which can trigger event\n            originEntityId: originEntity ? originEntity.noteId : null,\n            transactional\n        }, \"script\");\n\n        if (ret.success) {\n            await ws.waitForMaxKnownEntityChangeId();\n\n            return ret.executionResult;\n        } else {\n            throw new Error(`server error: ${ret.error}`);\n        }\n    }\n\n    /**\n     * Executes given anonymous function on the backend.\n     * Internally this serializes the anonymous function into string and sends it to backend via AJAX.\n     * Please make sure that the supplied function is synchronous. Only sync functions will work correctly\n     * with transaction management. If you really know what you're doing, you can call api.runAsyncOnBackendWithManualTransactionHandling()\n     *\n     * @method\n     * @param {function|string} func - (synchronous) function to be executed on the backend\n     * @param {Array.<?>} params - list of parameters to the anonymous function to be sent to backend\n     * @returns {Promise<*>} return value of the executed function on the backend\n     */\n    this.runOnBackend = async (func, params = []) => {\n        if (func?.constructor.name === \"AsyncFunction\" || func?.startsWith?.(\"async \")) {\n            toastService.showError(\"You're passing an async function to api.runOnBackend() which will likely not work as you intended. \"\n                + \"Either make the function synchronous (by removing 'async' keyword), or use api.runAsyncOnBackendWithManualTransactionHandling()\");\n        }\n\n        return await this.__runOnBackendInner(func, params, true);\n    };\n\n    /**\n     * Executes given anonymous function on the backend.\n     * Internally this serializes the anonymous function into string and sends it to backend via AJAX.\n     * This function is meant for advanced needs where an async function is necessary.\n     * In this case, the automatic request-scoped transaction management is not applied,\n     * and you need to manually define transaction via api.transactional().\n     *\n     * If you have a synchronous function, please use api.runOnBackend().\n     *\n     * @method\n     * @param {function|string} func - (synchronous) function to be executed on the backend\n     * @param {Array.<?>} params - list of parameters to the anonymous function to be sent to backend\n     * @returns {Promise<*>} return value of the executed function on the backend\n     */\n    this.runAsyncOnBackendWithManualTransactionHandling = async (func, params = []) => {\n        if (func?.constructor.name === \"Function\" || func?.startsWith?.(\"function\")) {\n            toastService.showError(\"You're passing a synchronous function to api.runAsyncOnBackendWithManualTransactionHandling(), \" +\n                \"while you should likely use api.runOnBackend() instead.\");\n        }\n\n        return await this.__runOnBackendInner(func, params, false);\n    };\n\n    /**\n     * This is a powerful search method - you can search by attributes and their values, e.g.:\n     * \"#dateModified =* MONTH AND #log\". See full documentation for all options at: https://github.com/zadam/trilium/wiki/Search\n     *\n     * @method\n     * @param {string} searchString\n     * @returns {Promise<FNote[]>}\n     */\n    this.searchForNotes = async searchString => {\n        return await searchService.searchForNotes(searchString);\n    };\n\n    /**\n     * This is a powerful search method - you can search by attributes and their values, e.g.:\n     * \"#dateModified =* MONTH AND #log\". See full documentation for all options at: https://github.com/zadam/trilium/wiki/Search\n     *\n     * @method\n     * @param {string} searchString\n     * @returns {Promise<FNote|null>}\n     */\n    this.searchForNote = async searchString => {\n        const notes = await this.searchForNotes(searchString);\n\n        return notes.length > 0 ? notes[0] : null;\n    };\n\n    /**\n     * Returns note by given noteId. If note is missing from the cache, it's loaded.\n     **\n     * @method\n     * @param {string} noteId\n     * @returns {Promise<FNote>}\n     */\n    this.getNote = async noteId => await froca.getNote(noteId);\n\n    /**\n     * Returns list of notes. If note is missing from the cache, it's loaded.\n     *\n     * This is often used to bulk-fill the cache with notes which would have to be picked one by one\n     * otherwise (by e.g. createLink())\n     *\n     * @method\n     * @param {string[]} noteIds\n     * @param {boolean} [silentNotFoundError] - don't report error if the note is not found\n     * @returns {Promise<FNote[]>}\n     */\n    this.getNotes = async (noteIds, silentNotFoundError = false) => await froca.getNotes(noteIds, silentNotFoundError);\n\n    /**\n     * Update frontend tree (note) cache from the backend.\n     *\n     * @method\n     * @param {string[]} noteIds\n     */\n    this.reloadNotes = async noteIds => await froca.reloadNotes(noteIds);\n\n    /**\n     * Instance name identifies particular Trilium instance. It can be useful for scripts\n     * if some action needs to happen on only one specific instance.\n     *\n     * @method\n     * @returns {string}\n     */\n    this.getInstanceName = () => window.glob.instanceName;\n\n    /**\n     * @method\n     * @param {Date} date\n     * @returns {string} date in YYYY-MM-DD format\n     */\n    this.formatDateISO = utils.formatDateISO;\n\n    /**\n     * @method\n     * @param {string} str\n     * @returns {Date} parsed object\n     */\n    this.parseDate = utils.parseDate;\n\n    /**\n     * Show an info toast message to the user.\n     *\n     * @method\n     * @param {string} message\n     */\n    this.showMessage = toastService.showMessage;\n\n    /**\n     * Show an error toast message to the user.\n     *\n     * @method\n     * @param {string} message\n     */\n    this.showError = toastService.showError;\n\n    /**\n     * Show an info dialog to the user.\n     *\n     * @method\n     * @param {string} message\n     * @returns {Promise}\n     */\n    this.showInfoDialog = dialogService.info;\n\n    /**\n     * Show confirm dialog to the user.\n     *\n     * @method\n     * @param {string} message\n     * @returns {Promise<boolean>} promise resolving to true if the user confirmed\n     */\n    this.showConfirmDialog = dialogService.confirm;\n\n    /**\n     * Show prompt dialog to the user.\n     *\n     * @method\n     * @param {object} props\n     * @param {string} props.title\n     * @param {string} props.message\n     * @param {string} props.defaultValue\n     * @returns {Promise<string>} promise resolving to the answer provided by the user\n     */\n    this.showPromptDialog = dialogService.prompt;\n\n    /**\n     * Trigger command. This is a very low-level API which should be avoided if possible.\n     *\n     * @method\n     * @param {string} name\n     * @param {object} data\n     */\n    this.triggerCommand = (name, data) => appContext.triggerCommand(name, data);\n\n    /**\n     * Trigger event. This is a very low-level API which should be avoided if possible.\n     *\n     * @method\n     * @param {string} name\n     * @param {object} data\n     */\n    this.triggerEvent = (name, data) => appContext.triggerEvent(name, data);\n\n    /**\n     * Create a note link (jQuery object) for given note.\n     *\n     * @method\n     * @param {string} notePath (or noteId)\n     * @param {object} [params]\n     * @param {boolean} [params.showTooltip=true] - enable/disable tooltip on the link\n     * @param {boolean} [params.showNotePath=false] - show also whole note's path as part of the link\n     * @param {boolean} [params.showNoteIcon=false] - show also note icon before the title\n     * @param {string} [params.title] - custom link tile with note's title as default\n     * @param {string} [params.title=] - custom link tile with note's title as default\n     * @returns {jQuery} - jQuery element with the link (wrapped in <span>)\n     */\n    this.createLink = linkService.createLink;\n\n    /** @deprecated - use api.createLink() instead */\n    this.createNoteLink = linkService.createLink;\n\n    /**\n     * Adds given text to the editor cursor\n     *\n     * @method\n     * @param {string} text - this must be clear text, HTML is not supported.\n     */\n    this.addTextToActiveContextEditor = text => appContext.triggerCommand('addTextToActiveEditor', {text});\n\n    /**\n     * @method\n     * @returns {FNote} active note (loaded into center pane)\n     */\n    this.getActiveContextNote = () => appContext.tabManager.getActiveContextNote();\n\n    /**\n     * @method\n     * @returns {NoteContext} - returns active context (split)\n     */\n    this.getActiveContext = () => appContext.tabManager.getActiveContext();\n\n    /**\n     * @method\n     * @returns {NoteContext} - returns active main context (first split in a tab, represents the tab as a whole)\n     */\n    this.getActiveMainContext = () => appContext.tabManager.getActiveMainContext();\n\n    /**\n     * @method\n     * @returns {NoteContext[]} - returns all note contexts (splits) in all tabs\n     */\n    this.getNoteContexts = () => appContext.tabManager.getNoteContexts();\n\n    /**\n     * @method\n     * @returns {NoteContext[]} - returns all main contexts representing tabs\n     */\n    this.getMainNoteContexts = () => appContext.tabManager.getMainNoteContexts();\n\n    /**\n     * See https://ckeditor.com/docs/ckeditor5/latest/api/module_core_editor_editor-Editor.html for documentation on the returned instance.\n     *\n     * @method\n     * @returns {Promise<BalloonEditor>} instance of CKEditor\n     */\n    this.getActiveContextTextEditor = () => appContext.tabManager.getActiveContext()?.getTextEditor();\n\n    /**\n     * See https://codemirror.net/doc/manual.html#api\n     *\n     * @method\n     * @returns {Promise<CodeMirror>} instance of CodeMirror\n     */\n    this.getActiveContextCodeEditor = () => appContext.tabManager.getActiveContext()?.getCodeEditor();\n\n    /**\n     * Get access to the widget handling note detail. Methods like `getWidgetType()` and `getTypeWidget()` to get to the\n     * implementation of actual widget type.\n     *\n     * @method\n     * @returns {Promise<NoteDetailWidget>}\n     */\n    this.getActiveNoteDetailWidget = () => new Promise(resolve => appContext.triggerCommand('executeInActiveNoteDetailWidget', {callback: resolve}));\n\n    /**\n     * @method\n     * @returns {Promise<string|null>} returns a note path of active note or null if there isn't active note\n     */\n    this.getActiveContextNotePath = () => appContext.tabManager.getActiveContextNotePath();\n\n    /**\n     * Returns component which owns the given DOM element (the nearest parent component in DOM tree)\n     *\n     * @method\n     * @param {Element} el - DOM element\n     * @returns {Component}\n     */\n    this.getComponentByEl = el => appContext.getComponentByEl(el);\n\n    /**\n     * @method\n     * @param {object} $el - jquery object on which to set up the tooltip\n     * @returns {Promise<void>}\n     */\n    this.setupElementTooltip = noteTooltipService.setupElementTooltip;\n\n    /**\n     * @method\n     * @param {string} noteId\n     * @param {boolean} protect - true to protect note, false to unprotect\n     * @returns {Promise<void>}\n     */\n    this.protectNote = async (noteId, protect) => {\n        await protectedSessionService.protectNote(noteId, protect, false);\n    };\n\n    /**\n     * @method\n     * @param {string} noteId\n     * @param {boolean} protect - true to protect subtree, false to unprotect\n     * @returns {Promise<void>}\n     */\n    this.protectSubTree = async (noteId, protect) => {\n        await protectedSessionService.protectNote(noteId, protect, true);\n    };\n\n    /**\n     * Returns date-note for today. If it doesn't exist, it is automatically created.\n     *\n     * @method\n     * @returns {Promise<FNote>}\n     */\n    this.getTodayNote = dateNotesService.getTodayNote;\n\n    /**\n     * Returns day note for a given date. If it doesn't exist, it is automatically created.\n     *\n     * @method\n     * @param {string} date - e.g. \"2019-04-29\"\n     * @returns {Promise<FNote>}\n     */\n    this.getDayNote = dateNotesService.getDayNote;\n\n    /**\n     * Returns day note for the first date of the week of the given date. If it doesn't exist, it is automatically created.\n     *\n     * @method\n     * @param {string} date - e.g. \"2019-04-29\"\n     * @returns {Promise<FNote>}\n     */\n    this.getWeekNote = dateNotesService.getWeekNote;\n\n    /**\n     * Returns month-note. If it doesn't exist, it is automatically created.\n     *\n     * @method\n     * @param {string} month - e.g. \"2019-04\"\n     * @returns {Promise<FNote>}\n     */\n    this.getMonthNote = dateNotesService.getMonthNote;\n\n    /**\n     * Returns year-note. If it doesn't exist, it is automatically created.\n     *\n     * @method\n     * @param {string} year - e.g. \"2019\"\n     * @returns {Promise<FNote>}\n     */\n    this.getYearNote = dateNotesService.getYearNote;\n\n    /**\n     * Hoist note in the current tab. See https://github.com/zadam/trilium/wiki/Note-hoisting\n     *\n     * @method\n     * @param {string} noteId - set hoisted note. 'root' will effectively unhoist\n     * @returns {Promise<void>}\n     */\n    this.setHoistedNoteId = (noteId) => {\n        const activeNoteContext = appContext.tabManager.getActiveContext();\n\n        if (activeNoteContext) {\n            activeNoteContext.setHoistedNoteId(noteId);\n        }\n    };\n\n    /**\n     * @method\n     * @param {string} keyboardShortcut - e.g. \"ctrl+shift+a\"\n     * @param {function} handler\n     * @param {string} [namespace] - specify namespace of the handler for the cases where call for bind may be repeated.\n     *                               If a handler with this ID exists, it's replaced by the new handler.\n     * @returns {Promise<void>}\n     */\n    this.bindGlobalShortcut = shortcutService.bindGlobalShortcut;\n\n    /**\n     * Trilium runs in a backend and frontend process, when something is changed on the backend from a script,\n     * frontend will get asynchronously synchronized.\n     *\n     * This method returns a promise which resolves once all the backend -> frontend synchronization is finished.\n     * Typical use case is when a new note has been created, we should wait until it is synced into frontend and only then activate it.\n     *\n     * @method\n     * @returns {Promise<void>}\n     */\n    this.waitUntilSynced = ws.waitForMaxKnownEntityChangeId;\n\n    /**\n     * This will refresh all currently opened notes which have included note specified in the parameter\n     *\n     * @param includedNoteId - noteId of the included note\n     * @returns {Promise<void>}\n     */\n    this.refreshIncludedNote = includedNoteId => appContext.triggerEvent('refreshIncludedNote', {noteId: includedNoteId});\n\n    /**\n     * Return randomly generated string of given length. This random string generation is NOT cryptographically secure.\n     *\n     * @method\n     * @param {int} length of the string\n     * @returns {string} random string\n     */\n    this.randomString = utils.randomString;\n\n    /**\n     * @method\n     * @param {int} size in bytes\n     * @return {string} formatted string\n     */\n    this.formatSize = utils.formatSize;\n\n    /**\n     * @method\n     * @param {int} size in bytes\n     * @return {string} formatted string\n     * @deprecated - use api.formatSize()\n     */\n    this.formatNoteSize = utils.formatSize;\n\n    this.logMessages = {};\n    this.logSpacedUpdates = {};\n\n    /**\n     * Log given message to the log pane in UI\n     *\n     * @param message\n     * @returns {void}\n     */\n    this.log = message => {\n        const {noteId} = this.startNote;\n\n        message = `${utils.now()}: ${message}`;\n\n        console.log(`Script ${noteId}: ${message}`);\n\n        this.logMessages[noteId] = this.logMessages[noteId] || [];\n        this.logSpacedUpdates[noteId] = this.logSpacedUpdates[noteId] || new SpacedUpdate(() => {\n            const messages = this.logMessages[noteId];\n            this.logMessages[noteId] = [];\n\n            appContext.triggerEvent(\"apiLogMessages\", {noteId, messages});\n        }, 100);\n\n        this.logMessages[noteId].push(message);\n        this.logSpacedUpdates[noteId].scheduleUpdate();\n    };\n}\n\nexport default FrontendScriptApi;\n","import FrontendScriptApi from './frontend_script_api.js';\nimport utils from './utils.js';\nimport froca from './froca.js';\n\nasync function ScriptContext(startNoteId, allNoteIds, originEntity = null, $container = null) {\n    const modules = {};\n\n    await froca.initializedPromise;\n\n    const startNote = await froca.getNote(startNoteId);\n    const allNotes = await froca.getNotes(allNoteIds);\n\n    return {\n        modules: modules,\n        notes: utils.toObject(allNotes, note => [note.noteId, note]),\n        apis: utils.toObject(allNotes, note => [note.noteId, new FrontendScriptApi(startNote, note, originEntity, $container)]),\n        require: moduleNoteIds => {\n            return moduleName => {\n                const candidates = allNotes.filter(note => moduleNoteIds.includes(note.noteId));\n                const note = candidates.find(c => c.title === moduleName);\n\n                if (!note) {\n                    throw new Error(`Could not find module note ${moduleName}`);\n                }\n\n                return modules[note.noteId].exports;\n            }\n        }\n    };\n}\n\nexport default ScriptContext;","import server from \"./server.js\";\nimport froca from \"./froca.js\";\n\nasync function searchForNoteIds(searchString) {\n    return await server.get(`search/${encodeURIComponent(searchString)}`);\n}\n\nasync function searchForNotes(searchString) {\n    const noteIds = await searchForNoteIds(searchString);\n\n    return await froca.getNotes(noteIds);\n}\n\nexport default {\n    searchForNoteIds,\n    searchForNotes\n}\n","export default class ValidationError {\n    constructor(resp) {\n        for (const key in resp) {\n            this[key] = resp[key];\n        }\n    }\n}","import utils from './utils.js';\nimport ValidationError from \"./validation_error.js\";\n\nasync function getHeaders(headers) {\n    const appContext = (await import('../components/app_context.js')).default;\n    const activeNoteContext = appContext.tabManager ? appContext.tabManager.getActiveContext() : null;\n\n    // headers need to be lowercase because node.js automatically converts them to lower case\n    // also avoiding using underscores instead of dashes since nginx filters them out by default\n    const allHeaders = {\n        'trilium-component-id': glob.componentId,\n        'trilium-local-now-datetime': utils.localNowDateTime(),\n        'trilium-hoisted-note-id': activeNoteContext ? activeNoteContext.hoistedNoteId : null,\n        'x-csrf-token': glob.csrfToken\n    };\n\n    for (const headerName in headers) {\n        if (headers[headerName]) {\n            allHeaders[headerName] = headers[headerName];\n        }\n    }\n\n    if (utils.isElectron()) {\n        // passing it explicitly here because of the electron HTTP bypass\n        allHeaders.cookie = document.cookie;\n    }\n\n    return allHeaders;\n}\n\nasync function getWithSilentNotFound(url, componentId) {\n    return await call('GET', url, componentId, { silentNotFound: true });\n}\n\nasync function get(url, componentId) {\n    return await call('GET', url, componentId);\n}\n\nasync function post(url, data, componentId) {\n    return await call('POST', url, componentId, { data });\n}\n\nasync function put(url, data, componentId) {\n    return await call('PUT', url, componentId, { data });\n}\n\nasync function patch(url, data, componentId) {\n    return await call('PATCH', url, componentId, { data });\n}\n\nasync function remove(url, componentId) {\n    return await call('DELETE', url, componentId);\n}\n\nasync function upload(url, fileToUpload) {\n    const formData = new FormData();\n    formData.append('upload', fileToUpload);\n\n    return await $.ajax({\n        url: window.glob.baseApiUrl + url,\n        headers: await getHeaders(),\n        data: formData,\n        type: 'PUT',\n        timeout: 60 * 60 * 1000,\n        contentType: false, // NEEDED, DON'T REMOVE THIS\n        processData: false, // NEEDED, DON'T REMOVE THIS\n    });\n}\n\nlet idCounter = 1;\nconst idToRequestMap = {};\n\nlet maxKnownEntityChangeId = 0;\n\nasync function call(method, url, componentId, options = {}) {\n    let resp;\n\n    const headers = await getHeaders({\n        'trilium-component-id': componentId\n    });\n    const {data} = options;\n\n    if (utils.isElectron()) {\n        const ipc = utils.dynamicRequire('electron').ipcRenderer;\n        const requestId = idCounter++;\n\n        resp = await new Promise((resolve, reject) => {\n            idToRequestMap[requestId] = {\n                resolve,\n                reject,\n                silentNotFound: !!options.silentNotFound\n            };\n\n            ipc.send('server-request', {\n                requestId: requestId,\n                headers: headers,\n                method: method,\n                url: `/${window.glob.baseApiUrl}${url}`,\n                data: data\n            });\n        });\n    }\n    else {\n        resp = await ajax(url, method, data, headers, !!options.silentNotFound);\n    }\n\n    const maxEntityChangeIdStr = resp.headers['trilium-max-entity-change-id'];\n\n    if (maxEntityChangeIdStr && maxEntityChangeIdStr.trim()) {\n        maxKnownEntityChangeId = Math.max(maxKnownEntityChangeId, parseInt(maxEntityChangeIdStr));\n    }\n\n    return resp.body;\n}\n\nfunction ajax(url, method, data, headers, silentNotFound) {\n    return new Promise((res, rej) => {\n        const options = {\n            url: window.glob.baseApiUrl + url,\n            type: method,\n            headers: headers,\n            timeout: 60000,\n            success: (body, textStatus, jqXhr) => {\n                const respHeaders = {};\n\n                jqXhr.getAllResponseHeaders().trim().split(/[\\r\\n]+/).forEach(line => {\n                    const parts = line.split(': ');\n                    const header = parts.shift();\n                    respHeaders[header] = parts.join(': ');\n                });\n\n                res({\n                    body,\n                    headers: respHeaders\n                });\n            },\n            error: async jqXhr => {\n                if (silentNotFound && jqXhr.status === 404) {\n                    // report nothing\n                } else {\n                    await reportError(method, url, jqXhr.status, jqXhr.responseText);\n                }\n\n                rej(jqXhr.responseText);\n            }\n        };\n\n        if (data) {\n            try {\n                options.data = JSON.stringify(data);\n            } catch (e) {\n                console.log(\"Can't stringify data: \", data, \" because of error: \", e)\n            }\n            options.contentType = \"application/json\";\n        }\n\n        $.ajax(options);\n    });\n}\n\nif (utils.isElectron()) {\n    const ipc = utils.dynamicRequire('electron').ipcRenderer;\n\n    ipc.on('server-response', async (event, arg) => {\n        if (arg.statusCode >= 200 && arg.statusCode < 300) {\n            handleSuccessfulResponse(arg);\n        }\n        else {\n            if (arg.statusCode === 404 && idToRequestMap[arg.requestId]?.silentNotFound) {\n                // report nothing\n            } else {\n                await reportError(arg.method, arg.url, arg.statusCode, arg.body);\n            }\n\n            idToRequestMap[arg.requestId].reject(new Error(`Server responded with ${arg.statusCode}`));\n        }\n\n        delete idToRequestMap[arg.requestId];\n    });\n\n    function handleSuccessfulResponse(arg) {\n        if (arg.headers['Content-Type'] === 'application/json') {\n            arg.body = JSON.parse(arg.body);\n        }\n\n        if (!(arg.requestId in idToRequestMap)) {\n            // this can happen when reload happens between firing up the request and receiving the response\n            throw new Error(`Unknown requestId '${arg.requestId}'`);\n        }\n\n        idToRequestMap[arg.requestId].resolve({\n            body: arg.body,\n            headers: arg.headers\n        });\n    }\n}\n\nasync function reportError(method, url, statusCode, response) {\n    let message = response;\n\n    if (typeof response === 'string') {\n        try {\n            response = JSON.parse(response);\n            message = response.message;\n        }\n        catch (e) {}\n    }\n\n    const toastService = (await import(\"./toast.js\")).default;\n\n    if ([400, 404].includes(statusCode) && response && typeof response === 'object') {\n        toastService.showError(message);\n        throw new ValidationError({\n            requestUrl: url,\n            method,\n            statusCode,\n            ...response\n        });\n    } else {\n        const title = `${statusCode} ${method} ${url}`;\n        toastService.showErrorTitleAndMessage(title, message);\n        toastService.throwError(`${title} - ${message}`);\n    }\n}\n\nexport default {\n    get,\n    getWithSilentNotFound,\n    post,\n    put,\n    patch,\n    remove,\n    upload,\n    // don't remove, used from CKEditor image upload!\n    getHeaders,\n    getMaxKnownEntityChangeId: () => maxKnownEntityChangeId\n};\n","import utils from \"./utils.js\";\n\nfunction removeGlobalShortcut(namespace) {\n    bindGlobalShortcut('', null, namespace);\n}\n\nfunction bindGlobalShortcut(keyboardShortcut, handler, namespace = null) {\n    bindElShortcut($(document), keyboardShortcut, handler, namespace);\n}\n\nfunction bindElShortcut($el, keyboardShortcut, handler, namespace = null) {\n    if (utils.isDesktop()) {\n        keyboardShortcut = normalizeShortcut(keyboardShortcut);\n\n        let eventName = 'keydown';\n\n        if (namespace) {\n            eventName += `.${namespace}`;\n\n            // if there's a namespace, then we replace the existing event handler with the new one\n            $el.off(eventName);\n        }\n\n        // method can be called to remove the shortcut (e.g. when keyboardShortcut label is deleted)\n        if (keyboardShortcut) {\n            $el.bind(eventName, keyboardShortcut, e => {\n                handler(e);\n\n                e.preventDefault();\n                e.stopPropagation();\n            });\n        }\n    }\n}\n\n/**\n * Normalize to the form expected by the jquery.hotkeys.js\n */\nfunction normalizeShortcut(shortcut) {\n    if (!shortcut) {\n        return shortcut;\n    }\n\n    return shortcut\n        .toLowerCase()\n        .replace(\"enter\", \"return\")\n        .replace(\"delete\", \"del\")\n        .replace(\"ctrl+alt\", \"alt+ctrl\")\n        .replace(\"meta+alt\", \"alt+meta\"); // alt needs to be first;\n}\n\nexport default {\n    bindGlobalShortcut,\n    bindElShortcut,\n    removeGlobalShortcut,\n    normalizeShortcut\n}\n","export default class SpacedUpdate {\n    constructor(updater, updateInterval = 1000) {\n        this.updater = updater;\n        this.lastUpdated = Date.now();\n        this.changed = false;\n        this.updateInterval = updateInterval;\n    }\n\n    scheduleUpdate() {\n        if (!this.changeForbidden) {\n            this.changed = true;\n            setTimeout(() => this.triggerUpdate());\n        }\n    }\n\n    async updateNowIfNecessary() {\n        if (this.changed) {\n            this.changed = false; // optimistic...\n\n            try {\n                await this.updater();\n            }\n            catch (e) {\n                this.changed = true;\n\n                throw e;\n            }\n        }\n    }\n\n    isAllSavedAndTriggerUpdate() {\n        const allSaved = !this.changed;\n\n        this.updateNowIfNecessary();\n\n        return allSaved;\n    }\n\n    triggerUpdate() {\n        if (!this.changed) {\n            return;\n        }\n\n        if (Date.now() - this.lastUpdated > this.updateInterval) {\n            this.updater();\n            this.lastUpdated = Date.now();\n            this.changed = false;\n        }\n        else {\n            // update isn't triggered but changes are still pending, so we need to schedule another check\n            this.scheduleUpdate();\n        }\n    }\n\n    async allowUpdateWithoutChange(callback) {\n        this.changeForbidden = true;\n\n        try {\n            await callback();\n        }\n        finally {\n            this.changeForbidden = false;\n        }\n    }\n}\n","import ws from \"./ws.js\";\nimport utils from \"./utils.js\";\n\nfunction toast(options) {\n    const $toast = $(`<div class=\"toast\" role=\"alert\" aria-live=\"assertive\" aria-atomic=\"true\">\n    <div class=\"toast-header\">\n        <strong class=\"mr-auto\"><span class=\"bx bx-${options.icon}\"></span> <span class=\"toast-title\"></span></strong>\n        <button type=\"button\" class=\"ml-2 mb-1 close\" data-dismiss=\"toast\" aria-label=\"Close\">\n            <span aria-hidden=\"true\">&times;</span>\n        </button>\n    </div>\n    <div class=\"toast-body\"></div>\n</div>`);\n\n    $toast.find('.toast-title').text(options.title);\n    $toast.find('.toast-body').text(options.message);\n\n    if (options.id) {\n        $toast.attr(\"id\", `toast-${options.id}`);\n    }\n\n    $(\"#toast-container\").append($toast);\n\n    $toast.toast({\n        delay: options.delay || 3000,\n        autohide: !!options.autohide\n    });\n\n    $toast.on('hidden.bs.toast', e => e.target.remove());\n\n    $toast.toast(\"show\");\n\n    return $toast;\n}\n\nfunction showPersistent(options) {\n    let $toast = $(`#toast-${options.id}`);\n\n    if ($toast.length > 0) {\n        $toast.find('.toast-body').html(options.message);\n    }\n    else {\n        options.autohide = false;\n\n        $toast = toast(options);\n    }\n\n    if (options.closeAfter) {\n        setTimeout(() => $toast.remove(), options.closeAfter);\n    }\n}\n\nfunction closePersistent(id) {\n    $(`#toast-${id}`).remove();\n}\n\nfunction showMessage(message, delay = 2000) {\n    console.debug(utils.now(), \"message:\", message);\n\n    toast({\n        title: \"信息\",\n        icon: \"check\",\n        message: message,\n        autohide: true,\n        delay\n    });\n}\n\nfunction showAndLogError(message, delay = 10000) {\n    showError(message, delay);\n\n    ws.logError(message);\n}\n\nfunction showError(message, delay = 10000) {\n    console.log(utils.now(), \"error: \", message);\n\n    toast({\n        title: \"错误\",\n        icon: 'alert',\n        message: message,\n        autohide: true,\n        delay\n    });\n}\n\nfunction showErrorTitleAndMessage(title, message, delay = 10000) {\n    console.log(utils.now(), \"error: \", message);\n\n    toast({\n        title: title,\n        icon: 'alert',\n        message: message,\n        autohide: true,\n        delay\n    });\n}\n\nfunction throwError(message) {\n    ws.logError(message);\n\n    throw new Error(message);\n}\n\nexport default {\n    showMessage,\n    showError,\n    showErrorTitleAndMessage,\n    showAndLogError,\n    throwError,\n    showPersistent,\n    closePersistent\n}\n","import ws from './ws.js';\nimport utils from './utils.js';\nimport froca from './froca.js';\nimport hoistedNoteService from '../services/hoisted_note.js';\nimport appContext from \"../components/app_context.js\";\n\n/**\n * @returns {string|null}\n */\nasync function resolveNotePath(notePath, hoistedNoteId = 'root') {\n    const runPath = await resolveNotePathToSegments(notePath, hoistedNoteId);\n\n    return runPath ? runPath.join(\"/\") : null;\n}\n\n/**\n * Accepts notePath which might or might not be valid and returns an existing path as close to the original\n * notePath as possible. Part of the path might not be valid because of note moving (which causes\n * path change) or other corruption, in that case, this will try to get some other valid path to the correct note.\n *\n * @returns {Promise<string[]>}\n */\nasync function resolveNotePathToSegments(notePath, hoistedNoteId = 'root', logErrors = true) {\n    utils.assertArguments(notePath);\n\n    // we might get notePath with the params suffix, remove it if present\n    notePath = notePath.split(\"?\")[0].trim();\n\n    if (notePath.length === 0) {\n        return null;\n    }\n\n    const path = notePath.split(\"/\").reverse();\n\n    if (!path.includes(\"root\")) {\n        path.push('root');\n    }\n\n    const effectivePathSegments = [];\n    let childNoteId = null;\n    let i = 0;\n\n    while (true) {\n        if (i >= path.length) {\n            break;\n        }\n\n        const parentNoteId = path[i++];\n\n        if (childNoteId !== null) {\n            const child = await froca.getNote(childNoteId, !logErrors);\n\n            if (!child) {\n                if (logErrors) {\n                    ws.logError(`Can't find note ${childNoteId}`);\n                }\n\n                return null;\n            }\n\n            child.sortParents();\n\n            const parents = child.getParentNotes();\n\n            if (!parents.length) {\n                if (logErrors) {\n                    ws.logError(`No parents found for note ${childNoteId} (${child.title}) for path ${notePath}`);\n                }\n\n                return null;\n            }\n\n            if (!parents.some(p => p.noteId === parentNoteId)) {\n                if (logErrors) {\n                    const parent = froca.getNoteFromCache(parentNoteId);\n\n                    console.debug(utils.now(), `Did not find parent ${parentNoteId} (${parent ? parent.title : 'n/a'}) \n                        for child ${childNoteId} (${child.title}), available parents: ${parents.map(p => `${p.noteId} (${p.title})`)}. \n                        You can ignore this message as it is mostly harmless.`);\n                }\n\n                const bestNotePath = child.getBestNotePath(hoistedNoteId);\n\n                if (bestNotePath) {\n                    const pathToRoot = bestNotePath.reverse().slice(1);\n\n                    for (const noteId of pathToRoot) {\n                        effectivePathSegments.push(noteId);\n                    }\n                }\n\n                break;\n            }\n        }\n\n        effectivePathSegments.push(parentNoteId);\n        childNoteId = parentNoteId;\n    }\n\n    effectivePathSegments.reverse();\n\n    if (effectivePathSegments.includes(hoistedNoteId)) {\n        return effectivePathSegments;\n    }\n    else {\n        const note = await froca.getNote(getNoteIdFromUrl(notePath));\n\n        const bestNotePath = note.getBestNotePath(hoistedNoteId);\n\n        if (!bestNotePath) {\n            throw new Error(`Did not find any path segments for '${note.toString()}', hoisted note '${hoistedNoteId}'`);\n        }\n\n        // if there isn't actually any note path with hoisted note, then return the original resolved note path\n        return bestNotePath.includes(hoistedNoteId) ? bestNotePath : effectivePathSegments;\n    }\n}\n\nws.subscribeToMessages(message => {\n   if (message.type === 'openNote') {\n       appContext.tabManager.activateOrOpenNote(message.noteId);\n\n       if (utils.isElectron()) {\n           const currentWindow = utils.dynamicRequire('@electron/remote').getCurrentWindow();\n\n           currentWindow.show();\n       }\n   }\n});\n\nfunction getParentProtectedStatus(node) {\n    return hoistedNoteService.isHoistedNode(node) ? false : node.getParent().data.isProtected;\n}\n\nfunction getNoteIdFromUrl(urlOrNotePath) {\n    if (!urlOrNotePath) {\n        return null;\n    }\n\n    const [notePath] = urlOrNotePath.split(\"?\");\n    const segments = notePath.split(\"/\");\n\n    return segments[segments.length - 1];\n}\n\nasync function getBranchIdFromUrl(urlOrNotePath) {\n    const {noteId, parentNoteId} = getNoteIdAndParentIdFromUrl(urlOrNotePath);\n\n    return await froca.getBranchId(parentNoteId, noteId);\n}\n\nfunction getNoteIdAndParentIdFromUrl(urlOrNotePath) {\n    if (!urlOrNotePath) {\n        return {};\n    }\n\n    const [notePath] = urlOrNotePath.split(\"?\");\n\n    if (notePath === 'root') {\n        return {\n            noteId: 'root',\n            parentNoteId: 'none'\n        };\n    }\n\n    let parentNoteId = 'root';\n    let noteId = '';\n\n    if (notePath) {\n        const segments = notePath.split(\"/\");\n\n        noteId = segments[segments.length - 1];\n\n        if (segments.length > 1) {\n            parentNoteId = segments[segments.length - 2];\n        }\n    }\n\n    return {\n        parentNoteId,\n        noteId\n    };\n}\n\nfunction getNotePath(node) {\n    if (!node) {\n        logError(\"节点为空\");\n        return \"\";\n    }\n\n    const path = [];\n\n    while (node) {\n        if (node.data.noteId) {\n            path.push(node.data.noteId);\n        }\n\n        node = node.getParent();\n    }\n\n    return path.reverse().join(\"/\");\n}\n\nasync function getNoteTitle(noteId, parentNoteId = null) {\n    utils.assertArguments(noteId);\n\n    const note = await froca.getNote(noteId);\n    if (!note) {\n        return \"[not found]\";\n    }\n\n    let {title} = note;\n\n    if (parentNoteId !== null) {\n        const branchId = note.parentToBranch[parentNoteId];\n\n        if (branchId) {\n            const branch = froca.getBranch(branchId);\n\n            if (branch?.prefix) {\n                title = `${branch.prefix} - ${title}`;\n            }\n        }\n    }\n\n    return title;\n}\n\nasync function getNotePathTitleComponents(notePath) {\n    const titleComponents = [];\n\n    if (notePath.startsWith('root/')) {\n        notePath = notePath.substr(5);\n    }\n\n    // special case when we want just root's title\n    if (notePath === 'root') {\n        titleComponents.push(await getNoteTitle(notePath));\n    } else {\n        let parentNoteId = 'root';\n\n        for (const noteId of notePath.split('/')) {\n            titleComponents.push(await getNoteTitle(noteId, parentNoteId));\n\n            parentNoteId = noteId;\n        }\n    }\n\n    return titleComponents;\n}\n\nasync function getNotePathTitle(notePath) {\n    utils.assertArguments(notePath);\n\n    const titlePath = await getNotePathTitleComponents(notePath);\n\n    return titlePath.join(' / ');\n}\n\nasync function getNoteTitleWithPathAsSuffix(notePath) {\n    utils.assertArguments(notePath);\n\n    const titleComponents = await getNotePathTitleComponents(notePath);\n\n    if (!titleComponents || titleComponents.length === 0) {\n        return \"\";\n    }\n\n    const title = titleComponents[titleComponents.length - 1];\n    const path = titleComponents.slice(0, titleComponents.length - 1);\n\n    const $titleWithPath = $('<span class=\"note-title-with-path\">')\n        .append($('<span class=\"note-title\">').text(title));\n\n    if (path.length > 0) {\n        $titleWithPath\n            .append($('<span class=\"note-path\">').text(` (${path.join(' / ')})`));\n    }\n\n    return $titleWithPath;\n}\n\nfunction isNotePathInHiddenSubtree(notePath) {\n    return notePath?.includes(\"root/_hidden\");\n}\n\nexport default {\n    resolveNotePath,\n    resolveNotePathToSegments,\n    getParentProtectedStatus,\n    getNotePath,\n    getNoteIdFromUrl,\n    getNoteIdAndParentIdFromUrl,\n    getBranchIdFromUrl,\n    getNoteTitle,\n    getNotePathTitle,\n    getNoteTitleWithPathAsSuffix,\n    isNotePathInHiddenSubtree\n};\n","function reloadFrontendApp(reason) {\n    if (reason) {\n        logInfo(`Frontend app reload: ${reason}`);\n    }\n\n    window.location.reload();\n}\n\nfunction parseDate(str) {\n    try {\n        return new Date(Date.parse(str));\n    }\n    catch (e) {\n        throw new Error(`Can't parse date from '${str}': ${e.message} ${e.stack}`);\n    }\n}\n\nfunction padNum(num) {\n    return `${num <= 9 ? \"0\" : \"\"}${num}`;\n}\n\nfunction formatTime(date) {\n    return `${padNum(date.getHours())}:${padNum(date.getMinutes())}`;\n}\n\nfunction formatTimeWithSeconds(date) {\n    return `${padNum(date.getHours())}:${padNum(date.getMinutes())}:${padNum(date.getSeconds())}`;\n}\n\nfunction formatTimeInterval(ms) {\n    const seconds = Math.round(ms / 1000);\n    const minutes = Math.floor(seconds / 60);\n    const hours = Math.floor(minutes / 60);\n    const days = Math.floor(hours / 24);\n    const plural = (count, name) => `${count} ${name}`;\n    const segments = [];\n\n    if (days > 0) {\n        segments.push(plural(days, '天'));\n    }\n\n    if (days < 2) {\n        if (hours % 24 > 0) {\n            segments.push(plural(hours % 24, '小时'));\n        }\n\n        if (hours < 4) {\n            if (minutes % 60 > 0) {\n                segments.push(plural(minutes % 60, '分钟'));\n            }\n\n            if (minutes < 5) {\n                if (seconds % 60 > 0) {\n                    segments.push(plural(seconds % 60, '秒'));\n                }\n            }\n        }\n    }\n\n    return segments.join(\", \");\n}\n\n// this is producing local time!\nfunction formatDate(date) {\n    //    return padNum(date.getDate()) + \". \" + padNum(date.getMonth() + 1) + \". \" + date.getFullYear();\n    // instead of european format we'll just use ISO as that's pretty unambiguous\n\n    return formatDateISO(date);\n}\n\n// this is producing local time!\nfunction formatDateISO(date) {\n    return `${date.getFullYear()}-${padNum(date.getMonth() + 1)}-${padNum(date.getDate())}`;\n}\n\nfunction formatDateTime(date) {\n    return `${formatDate(date)} ${formatTime(date)}`;\n}\n\nfunction localNowDateTime() {\n    return dayjs().format('YYYY-MM-DD HH:mm:ss.SSSZZ');\n}\n\nfunction now() {\n    return formatTimeWithSeconds(new Date());\n}\n\nfunction isElectron() {\n    return !!(window && window.process && window.process.type);\n}\n\nfunction isMac() {\n    return navigator.platform.indexOf('Mac') > -1;\n}\n\nfunction isCtrlKey(evt) {\n    return (!isMac() && evt.ctrlKey)\n        || (isMac() && evt.metaKey);\n}\n\nfunction assertArguments() {\n    for (const i in arguments) {\n        if (!arguments[i]) {\n            console.trace(`Argument idx#${i} should not be falsy: ${arguments[i]}`);\n        }\n    }\n}\n\nconst entityMap = {\n    '&': '&amp;',\n    '<': '&lt;',\n    '>': '&gt;',\n    '\"': '&quot;',\n    \"'\": '&#39;',\n    '/': '&#x2F;',\n    '`': '&#x60;',\n    '=': '&#x3D;'\n};\n\nfunction escapeHtml(str) {\n    return str.replace(/[&<>\"'`=\\/]/g, s => entityMap[s]);\n}\n\nfunction formatSize(size) {\n    size = Math.max(Math.round(size / 1024), 1);\n\n    if (size < 1024) {\n        return `${size} KiB`;\n    }\n    else {\n        return `${Math.round(size / 102.4) / 10} MiB`;\n    }\n}\n\nfunction toObject(array, fn) {\n    const obj = {};\n\n    for (const item of array) {\n        const [key, value] = fn(item);\n\n        obj[key] = value;\n    }\n\n    return obj;\n}\n\nfunction randomString(len) {\n    let text = \"\";\n    const possible = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n\n    for (let i = 0; i < len; i++) {\n        text += possible.charAt(Math.floor(Math.random() * possible.length));\n    }\n\n    return text;\n}\n\nfunction isMobile() {\n    return window.glob?.device === \"mobile\"\n        // window.glob.device is not available in setup\n        || (!window.glob?.device && /Mobi/.test(navigator.userAgent));\n}\n\nfunction isDesktop() {\n    return window.glob?.device === \"desktop\"\n        // window.glob.device is not available in setup\n        || (!window.glob?.device && !/Mobi/.test(navigator.userAgent));\n}\n\n// the cookie code below works for simple use cases only - ASCII only\n// not setting a path so that cookies do not leak into other websites if multiplexed with reverse proxy\n\nfunction setCookie(name, value) {\n    const date = new Date(Date.now() + 10 * 365 * 24 * 60 * 60 * 1000);\n    const expires = `; expires=${date.toUTCString()}`;\n\n    document.cookie = `${name}=${value || \"\"}${expires};`;\n}\n\nfunction getNoteTypeClass(type) {\n    return `type-${type}`;\n}\n\nfunction getMimeTypeClass(mime) {\n    if (!mime) {\n        return \"\";\n    }\n\n    const semicolonIdx = mime.indexOf(';');\n\n    if (semicolonIdx !== -1) {\n        // stripping everything following the semicolon\n        mime = mime.substr(0, semicolonIdx);\n    }\n\n    return `mime-${mime.toLowerCase().replace(/[\\W_]+/g, \"-\")}`;\n}\n\nfunction closeActiveDialog() {\n    if (glob.activeDialog) {\n        glob.activeDialog.modal('hide');\n        glob.activeDialog = null;\n    }\n}\n\nlet $lastFocusedElement = null;\n\n// perhaps there should be saved focused element per tab?\nfunction saveFocusedElement() {\n    $lastFocusedElement = $(\":focus\");\n}\n\nfunction focusSavedElement() {\n    if (!$lastFocusedElement) {\n        return;\n    }\n\n    if ($lastFocusedElement.hasClass(\"ck\")) {\n        // must handle CKEditor separately because of this bug: https://github.com/ckeditor/ckeditor5/issues/607\n        // the bug manifests itself in resetting the cursor position to the first character - jumping above\n\n        const editor = $lastFocusedElement\n            .closest('.ck-editor__editable')\n            .prop('ckeditorInstance');\n\n        if (editor) {\n            editor.editing.view.focus();\n        } else {\n            console.log(\"Could not find CKEditor instance to focus last element\");\n        }\n    } else {\n        $lastFocusedElement.focus();\n    }\n\n    $lastFocusedElement = null;\n}\n\nasync function openDialog($dialog, closeActDialog = true) {\n    if (closeActDialog) {\n        closeActiveDialog();\n        glob.activeDialog = $dialog;\n    }\n\n    saveFocusedElement();\n\n    $dialog.modal();\n\n    $dialog.on('hidden.bs.modal', () => {\n        $(\".aa-input\").autocomplete(\"close\");\n\n        if (!glob.activeDialog || glob.activeDialog === $dialog) {\n            focusSavedElement();\n        }\n    });\n\n    const keyboardActionsService = (await import(\"./keyboard_actions.js\")).default;\n    keyboardActionsService.updateDisplayedShortcuts($dialog);\n}\n\nfunction isHtmlEmpty(html) {\n    if (!html) {\n        return true;\n    } else if (typeof html !== 'string') {\n        logError(`Got object of type '${typeof html}' where string was expected.`);\n        return false;\n    }\n\n    html = html.toLowerCase();\n\n    return !html.includes('<img')\n        && !html.includes('<section')\n        // the line below will actually attempt to load images so better to check for images first\n        && $(\"<div>\").html(html).text().trim().length === 0;\n}\n\nasync function clearBrowserCache() {\n    if (isElectron()) {\n        const win = dynamicRequire('@electron/remote').getCurrentWindow();\n        await win.webContents.session.clearCache();\n    }\n}\n\nfunction copySelectionToClipboard() {\n    const text = window.getSelection().toString();\n    if (navigator.clipboard) {\n        navigator.clipboard.writeText(text);\n    }\n}\n\nfunction dynamicRequire(moduleName) {\n    if (typeof __non_webpack_require__ !== 'undefined') {\n        return __non_webpack_require__(moduleName);\n    }\n    else {\n        return require(moduleName);\n    }\n}\n\nfunction timeLimit(promise, limitMs, errorMessage) {\n    if (!promise || !promise.then) { // it's not actually a promise\n        return promise;\n    }\n\n    // better stack trace if created outside of promise\n    const error = new Error(errorMessage || `Process exceeded time limit ${limitMs}`);\n\n    return new Promise((res, rej) => {\n        let resolved = false;\n\n        promise.then(result => {\n            resolved = true;\n\n            res(result);\n        });\n\n        setTimeout(() => {\n            if (!resolved) {\n                rej(error);\n            }\n        }, limitMs);\n    });\n}\n\nfunction initHelpDropdown($el) {\n    // stop inside clicks from closing the menu\n    const $dropdownMenu = $el.find('.help-dropdown .dropdown-menu');\n    $dropdownMenu.on('click', e => e.stopPropagation());\n\n    // previous propagation stop will also block help buttons from being opened, so we need to re-init for this element\n    initHelpButtons($dropdownMenu);\n}\n\nconst wikiBaseUrl = \"https://github.com/zadam/trilium/wiki/\";\n\nfunction openHelp($button) {\n    const helpPage = $button.attr(\"data-help-page\");\n\n    if (helpPage) {\n        const url = wikiBaseUrl + helpPage;\n\n        window.open(url, '_blank');\n    }\n}\n\nfunction initHelpButtons($el) {\n    // for some reason, the .on(event, listener, handler) does not work here (e.g. Options -> Sync -> Help button)\n    // so we do it manually\n    $el.on(\"click\", e => {\n        const $helpButton = $(e.target).closest(\"[data-help-page]\");\n        openHelp($helpButton);\n    });\n}\n\nfunction filterAttributeName(name) {\n    return name.replace(/[^\\p{L}\\p{N}_:]/ug, \"\");\n}\n\nconst ATTR_NAME_MATCHER = new RegExp(\"^[\\\\p{L}\\\\p{N}_:]+$\", \"u\");\n\nfunction isValidAttributeName(name) {\n    return ATTR_NAME_MATCHER.test(name);\n}\n\nfunction sleep(time_ms) {\n    return new Promise((resolve) => {\n        setTimeout(resolve, time_ms);\n    });\n}\n\nfunction escapeRegExp(str) {\n    return str.replace(/([.*+?^=!:${}()|\\[\\]\\/\\\\])/g, \"\\\\$1\");\n}\n\nfunction areObjectsEqual () {\n    let i, l, leftChain, rightChain;\n\n    function compare2Objects (x, y) {\n        let p;\n\n        // remember that NaN === NaN returns false\n        // and isNaN(undefined) returns true\n        if (isNaN(x) && isNaN(y) && typeof x === 'number' && typeof y === 'number') {\n            return true;\n        }\n\n        // Compare primitives and functions.\n        // Check if both arguments link to the same object.\n        // Especially useful on the step where we compare prototypes\n        if (x === y) {\n            return true;\n        }\n\n        // Works in case when functions are created in constructor.\n        // Comparing dates is a common scenario. Another built-ins?\n        // We can even handle functions passed across iframes\n        if ((typeof x === 'function' && typeof y === 'function') ||\n            (x instanceof Date && y instanceof Date) ||\n            (x instanceof RegExp && y instanceof RegExp) ||\n            (x instanceof String && y instanceof String) ||\n            (x instanceof Number && y instanceof Number)) {\n            return x.toString() === y.toString();\n        }\n\n        // At last, checking prototypes as good as we can\n        if (!(x instanceof Object && y instanceof Object)) {\n            return false;\n        }\n\n        if (x.isPrototypeOf(y) || y.isPrototypeOf(x)) {\n            return false;\n        }\n\n        if (x.constructor !== y.constructor) {\n            return false;\n        }\n\n        if (x.prototype !== y.prototype) {\n            return false;\n        }\n\n        // Check for infinitive linking loops\n        if (leftChain.indexOf(x) > -1 || rightChain.indexOf(y) > -1) {\n            return false;\n        }\n\n        // Quick checking of one object being a subset of another.\n        // todo: cache the structure of arguments[0] for performance\n        for (p in y) {\n            if (y.hasOwnProperty(p) !== x.hasOwnProperty(p)) {\n                return false;\n            }\n            else if (typeof y[p] !== typeof x[p]) {\n                return false;\n            }\n        }\n\n        for (p in x) {\n            if (y.hasOwnProperty(p) !== x.hasOwnProperty(p)) {\n                return false;\n            }\n            else if (typeof y[p] !== typeof x[p]) {\n                return false;\n            }\n\n            switch (typeof (x[p])) {\n                case 'object':\n                case 'function':\n\n                    leftChain.push(x);\n                    rightChain.push(y);\n\n                    if (!compare2Objects (x[p], y[p])) {\n                        return false;\n                    }\n\n                    leftChain.pop();\n                    rightChain.pop();\n                    break;\n\n                default:\n                    if (x[p] !== y[p]) {\n                        return false;\n                    }\n                    break;\n            }\n        }\n\n        return true;\n    }\n\n    if (arguments.length < 1) {\n        return true; //Die silently? Don't know how to handle such case, please help...\n        // throw \"Need two or more arguments to compare\";\n    }\n\n    for (i = 1, l = arguments.length; i < l; i++) {\n\n        leftChain = []; //Todo: this can be cached\n        rightChain = [];\n\n        if (!compare2Objects(arguments[0], arguments[i])) {\n            return false;\n        }\n    }\n\n    return true;\n}\n\nfunction copyHtmlToClipboard(content) {\n    const clipboardItem = new ClipboardItem({\n        'text/html': new Blob([content], {type: 'text/html'}),\n        'text/plain': new Blob([content], {type: 'text/plain'})\n    });\n\n    navigator.clipboard.write([clipboardItem]);\n}\n\n/**\n * @param {FNote} note\n * @return {string}\n */\nfunction createImageSrcUrl(note) {\n    return `api/images/${note.noteId}/${encodeURIComponent(note.title)}?timestamp=${Date.now()}`;\n}\n\nexport default {\n    reloadFrontendApp,\n    parseDate,\n    formatDateISO,\n    formatDateTime,\n    formatTimeInterval,\n    formatSize,\n    localNowDateTime,\n    now,\n    isElectron,\n    isMac,\n    isCtrlKey,\n    assertArguments,\n    escapeHtml,\n    toObject,\n    randomString,\n    isMobile,\n    isDesktop,\n    setCookie,\n    getNoteTypeClass,\n    getMimeTypeClass,\n    closeActiveDialog,\n    openDialog,\n    saveFocusedElement,\n    focusSavedElement,\n    isHtmlEmpty,\n    clearBrowserCache,\n    copySelectionToClipboard,\n    dynamicRequire,\n    timeLimit,\n    initHelpDropdown,\n    initHelpButtons,\n    openHelp,\n    filterAttributeName,\n    isValidAttributeName,\n    sleep,\n    escapeRegExp,\n    areObjectsEqual,\n    copyHtmlToClipboard,\n    createImageSrcUrl\n};\n","export default class LoadResults {\n    constructor(entityChanges) {\n        this.entities = {};\n\n        for (const {entityId, entityName, entity} of entityChanges) {\n            if (entity) {\n                this.entities[entityName] = this.entities[entityName] || [];\n                this.entities[entityName][entityId] = entity;\n            }\n        }\n\n        this.noteIdToComponentId = {};\n        this.componentIdToNoteIds = {};\n\n        this.branchRows = [];\n\n        this.attributeRows = [];\n\n        this.noteReorderings = [];\n\n        this.revisionRows = [];\n\n        this.contentNoteIdToComponentId = [];\n\n        this.optionNames = [];\n\n        this.attachmentRows = [];\n    }\n\n    getEntityRow(entityName, entityId) {\n        return this.entities[entityName]?.[entityId];\n    }\n\n    addNote(noteId, componentId) {\n        this.noteIdToComponentId[noteId] = this.noteIdToComponentId[noteId] || [];\n\n        if (!this.noteIdToComponentId[noteId].includes(componentId)) {\n            this.noteIdToComponentId[noteId].push(componentId);\n        }\n\n        this.componentIdToNoteIds[componentId] = this.componentIdToNoteIds[componentId] || [];\n\n        if (!this.componentIdToNoteIds[componentId]) {\n            this.componentIdToNoteIds[componentId].push(noteId);\n        }\n    }\n\n    addBranch(branchId, componentId) {\n        this.branchRows.push({branchId, componentId});\n    }\n\n    getBranchRows() {\n        return this.branchRows\n            .map(row => this.getEntityRow(\"branches\", row.branchId))\n            .filter(branch => !!branch);\n    }\n\n    addNoteReordering(parentNoteId, componentId) {\n        this.noteReorderings.push(parentNoteId);\n    }\n\n    getNoteReorderings() {\n        return this.noteReorderings;\n    }\n\n    addAttribute(attributeId, componentId) {\n        this.attributeRows.push({attributeId, componentId});\n    }\n\n    getAttributeRows(componentId = 'none') {\n        return this.attributeRows\n            .filter(row => row.componentId !== componentId)\n            .map(row => this.getEntityRow(\"attributes\", row.attributeId))\n            .filter(attr => !!attr);\n    }\n\n    addRevision(revisionId, noteId, componentId) {\n        this.revisionRows.push({revisionId, noteId, componentId});\n    }\n\n    hasRevisionForNote(noteId) {\n        return !!this.revisionRows.find(row => row.noteId === noteId);\n    }\n\n    getNoteIds() {\n        return Object.keys(this.noteIdToComponentId);\n    }\n\n    isNoteReloaded(noteId, componentId = null) {\n        if (!noteId) {\n            return false;\n        }\n\n        const componentIds = this.noteIdToComponentId[noteId];\n        return componentIds && componentIds.find(sId => sId !== componentId) !== undefined;\n    }\n\n    addNoteContent(noteId, componentId) {\n        this.contentNoteIdToComponentId.push({noteId, componentId});\n    }\n\n    isNoteContentReloaded(noteId, componentId) {\n        if (!noteId) {\n            return false;\n        }\n\n        return this.contentNoteIdToComponentId.find(l => l.noteId === noteId && l.componentId !== componentId);\n    }\n\n    addOption(name) {\n        this.optionNames.push(name);\n    }\n\n    isOptionReloaded(name) {\n        return this.optionNames.includes(name);\n    }\n\n    getOptionNames() {\n        return this.optionNames;\n    }\n\n    addAttachmentRow(attachment) {\n        this.attachmentRows.push(attachment);\n    }\n\n    getAttachmentRows() {\n        return this.attachmentRows;\n    }\n\n    /**\n     * @returns {boolean} true if there are changes which could affect the attributes (including inherited ones)\n     *          notably changes in note itself should not have any effect on attributes\n     */\n    hasAttributeRelatedChanges() {\n        return this.branchRows.length > 0\n            || this.attributeRows.length > 0;\n    }\n\n    isEmpty() {\n        return Object.keys(this.noteIdToComponentId).length === 0\n            && this.branchRows.length === 0\n            && this.attributeRows.length === 0\n            && this.noteReorderings.length === 0\n            && this.revisionRows.length === 0\n            && this.contentNoteIdToComponentId.length === 0\n            && this.optionNames.length === 0\n            && this.attachmentRows.length === 0;\n    }\n\n    isEmptyForTree() {\n        return Object.keys(this.noteIdToComponentId).length === 0\n            && this.branchRows.length === 0\n            && this.attributeRows.length === 0\n            && this.noteReorderings.length === 0;\n    }\n}\n","import LoadResults from \"./load_results.js\";\nimport froca from \"./froca.js\";\nimport utils from \"./utils.js\";\nimport options from \"./options.js\";\nimport noteAttributeCache from \"./note_attribute_cache.js\";\nimport FBranch from \"../entities/fbranch.js\";\nimport FAttribute from \"../entities/fattribute.js\";\nimport FAttachment from \"../entities/fattachment.js\";\n\nasync function processEntityChanges(entityChanges) {\n    const loadResults = new LoadResults(entityChanges);\n\n    for (const ec of entityChanges) {\n        try {\n            if (ec.entityName === 'notes') {\n                processNoteChange(loadResults, ec);\n            } else if (ec.entityName === 'branches') {\n                await processBranchChange(loadResults, ec);\n            } else if (ec.entityName === 'attributes') {\n                processAttributeChange(loadResults, ec);\n            } else if (ec.entityName === 'note_reordering') {\n                processNoteReordering(loadResults, ec);\n            } else if (ec.entityName === 'revisions') {\n                loadResults.addRevision(ec.entityId, ec.noteId, ec.componentId);\n            } else if (ec.entityName === 'options') {\n                if (ec.entity.name === 'openNoteContexts') {\n                    continue; // only noise\n                }\n\n                options.set(ec.entity.name, ec.entity.value);\n\n                loadResults.addOption(ec.entity.name);\n            } else if (ec.entityName === 'attachments') {\n                processAttachment(loadResults, ec);\n            } else if (ec.entityName === 'blobs' || ec.entityName === 'etapi_tokens') {\n                // NOOP\n            }\n            else {\n                throw new Error(`Unknown entityName '${ec.entityName}'`);\n            }\n        }\n        catch (e) {\n            throw new Error(`Can't process entity ${JSON.stringify(ec)} with error ${e.message} ${e.stack}`);\n        }\n    }\n\n    // froca is supposed to contain all notes currently being visible to the users in the tree / otherwise being processed\n    // and their complete \"ancestor relationship\", so it's always possible to go up in the hierarchy towards the root.\n    // To this we count: standard parent-child relationships and template/inherit relations (attribute inheritance follows them).\n    // Here we watch for changes which might violate this principle - e.g., an introduction of a new \"inherit\" relation might\n    // mean we need to load the target of the relation (and then perhaps transitively the whole note path of this target).\n    const missingNoteIds = [];\n\n    for (const {entityName, entity} of entityChanges) {\n        if (!entity) { // if erased\n            continue;\n        }\n\n        if (entityName === 'branches' && !(entity.parentNoteId in froca.notes)) {\n            missingNoteIds.push(entity.parentNoteId);\n        }\n        else if (entityName === 'attributes'\n            && entity.type === 'relation'\n            && (entity.name === 'template' || entity.name === 'inherit')\n            && !(entity.value in froca.notes)) {\n\n            missingNoteIds.push(entity.value);\n        }\n    }\n\n    if (missingNoteIds.length > 0) {\n        await froca.reloadNotes(missingNoteIds);\n    }\n\n    if (!loadResults.isEmpty()) {\n        if (loadResults.hasAttributeRelatedChanges()) {\n            noteAttributeCache.invalidate();\n        }\n\n        const appContext = (await import(\"../components/app_context.js\")).default;\n        await appContext.triggerEvent('entitiesReloaded', {loadResults});\n    }\n}\n\nfunction processNoteChange(loadResults, ec) {\n    const note = froca.notes[ec.entityId];\n\n    if (!note) {\n        // if this note has not been requested before then it's not part of froca's cached subset, and\n        // we're not interested in it\n        return;\n    }\n\n    loadResults.addNote(ec.entityId, ec.componentId);\n\n    if (ec.isErased && ec.entityId in froca.notes) {\n        utils.reloadFrontendApp(`${ec.entityName} '${ec.entityId}' is erased, need to do complete reload.`);\n        return;\n    }\n\n    if (ec.isErased || ec.entity?.isDeleted) {\n        delete froca.notes[ec.entityId];\n    }\n    else {\n        if (note.blobId !== ec.entity.blobId) {\n            for (const key of Object.keys(froca.blobPromises)) {\n                if (key.includes(note.noteId)) {\n                    delete froca.blobPromises[key];\n                }\n            }\n\n            loadResults.addNoteContent(note.noteId, ec.componentId);\n        }\n\n        note.update(ec.entity);\n    }\n}\n\nasync function processBranchChange(loadResults, ec) {\n    if (ec.isErased && ec.entityId in froca.branches) {\n        utils.reloadFrontendApp(`${ec.entityName} '${ec.entityId}' is erased, need to do complete reload.`);\n        return;\n    }\n\n    let branch = froca.branches[ec.entityId];\n\n    if (ec.isErased || ec.entity?.isDeleted) {\n        if (branch) {\n            const childNote = froca.notes[branch.noteId];\n            const parentNote = froca.notes[branch.parentNoteId];\n\n            if (childNote) {\n                childNote.parents = childNote.parents.filter(parentNoteId => parentNoteId !== branch.parentNoteId);\n                delete childNote.parentToBranch[branch.parentNoteId];\n            }\n\n            if (parentNote) {\n                parentNote.children = parentNote.children.filter(childNoteId => childNoteId !== branch.noteId);\n                delete parentNote.childToBranch[branch.noteId];\n            }\n\n            loadResults.addBranch(ec.entityId, ec.componentId);\n\n            delete froca.branches[ec.entityId];\n        }\n\n        return;\n    }\n\n    loadResults.addBranch(ec.entityId, ec.componentId);\n\n    const childNote = froca.notes[ec.entity.noteId];\n    let parentNote = froca.notes[ec.entity.parentNoteId];\n\n    if (childNote && !childNote.isRoot() && !parentNote) {\n        // a branch cannot exist without the parent\n        // a note loaded into froca has to also contain all its ancestors,\n        // this problem happened, e.g., in sharing where _share was hidden and thus not loaded\n        // sharing meant cloning into _share, which crashed because _share was not loaded\n        parentNote = await froca.getNote(ec.entity.parentNoteId);\n    }\n\n    if (branch) {\n        branch.update(ec.entity);\n    }\n    else if (childNote || parentNote) {\n        froca.branches[ec.entityId] = branch = new FBranch(froca, ec.entity);\n    }\n\n    if (childNote) {\n        childNote.addParent(branch.parentNoteId, branch.branchId);\n    }\n\n    if (parentNote) {\n        parentNote.addChild(branch.noteId, branch.branchId);\n    }\n}\n\nfunction processNoteReordering(loadResults, ec) {\n    const parentNoteIdsToSort = new Set();\n\n    for (const branchId in ec.positions) {\n        const branch = froca.branches[branchId];\n\n        if (branch) {\n            branch.notePosition = ec.positions[branchId];\n\n            parentNoteIdsToSort.add(branch.parentNoteId);\n        }\n    }\n\n    for (const parentNoteId of parentNoteIdsToSort) {\n        const parentNote = froca.notes[parentNoteId];\n\n        if (parentNote) {\n            parentNote.sortChildren();\n        }\n    }\n\n    loadResults.addNoteReordering(ec.entityId, ec.componentId);\n}\n\nfunction processAttributeChange(loadResults, ec) {\n    let attribute = froca.attributes[ec.entityId];\n\n    if (ec.isErased && ec.entityId in froca.attributes) {\n        utils.reloadFrontendApp(`${ec.entityName} '${ec.entityId}' is erased, need to do complete reload.`);\n        return;\n    }\n\n    if (ec.isErased || ec.entity?.isDeleted) {\n        if (attribute) {\n            const sourceNote = froca.notes[attribute.noteId];\n            const targetNote = attribute.type === 'relation' && froca.notes[attribute.value];\n\n            if (sourceNote) {\n                sourceNote.attributes = sourceNote.attributes.filter(attributeId => attributeId !== attribute.attributeId);\n            }\n\n            if (targetNote) {\n                targetNote.targetRelations = targetNote.targetRelations.filter(attributeId => attributeId !== attribute.attributeId);\n            }\n\n            loadResults.addAttribute(ec.entityId, ec.componentId);\n\n            delete froca.attributes[ec.entityId];\n        }\n\n        return;\n    }\n\n    loadResults.addAttribute(ec.entityId, ec.componentId);\n\n    const sourceNote = froca.notes[ec.entity.noteId];\n    const targetNote = ec.entity.type === 'relation' && froca.notes[ec.entity.value];\n\n    if (attribute) {\n        attribute.update(ec.entity);\n    } else if (sourceNote || targetNote) {\n        attribute = new FAttribute(froca, ec.entity);\n\n        froca.attributes[attribute.attributeId] = attribute;\n\n        if (sourceNote && !sourceNote.attributes.includes(attribute.attributeId)) {\n            sourceNote.attributes.push(attribute.attributeId);\n        }\n\n        if (targetNote && !targetNote.targetRelations.includes(attribute.attributeId)) {\n            targetNote.targetRelations.push(attribute.attributeId);\n        }\n    }\n}\n\nfunction processAttachment(loadResults, ec) {\n    if (ec.isErased && ec.entityId in froca.attachments) {\n        utils.reloadFrontendApp(`${ec.entityName} '${ec.entityId}' is erased, need to do complete reload.`);\n        return;\n    }\n\n    const attachment = froca.attachments[ec.entityId];\n\n    if (ec.isErased || ec.entity?.isDeleted) {\n        if (attachment) {\n            const note = attachment.getNote();\n\n            if (note && note.attachments) {\n                note.attachments = note.attachments.filter(att => att.attachmentId !== attachment.attachmentId);\n            }\n\n            loadResults.addAttachmentRow(ec.entity);\n\n            delete froca.attachments[ec.entityId];\n        }\n\n        return;\n    }\n\n    if (attachment) {\n        attachment.update(ec.entity);\n    } else {\n        const note = froca.notes[ec.entity.ownerId];\n\n        if (note?.attachments) {\n            note.attachments.push(new FAttachment(froca, ec.entity));\n        }\n    }\n\n    loadResults.addAttachmentRow(ec.entity);\n}\n\nexport default {\n    processEntityChanges\n}\n","import utils from './utils.js';\nimport toastService from \"./toast.js\";\nimport server from \"./server.js\";\nimport options from \"./options.js\";\nimport frocaUpdater from \"./froca_updater.js\";\nimport appContext from \"../components/app_context.js\";\n\nconst messageHandlers = [];\n\nlet ws;\nlet lastAcceptedEntityChangeId = window.glob.maxEntityChangeIdAtLoad;\nlet lastAcceptedEntityChangeSyncId = window.glob.maxEntityChangeSyncIdAtLoad;\nlet lastProcessedEntityChangeId = window.glob.maxEntityChangeIdAtLoad;\nlet lastPingTs;\nlet frontendUpdateDataQueue = [];\n\nfunction logError(message) {\n    console.error(utils.now(), message); // needs to be separate from .trace()\n\n    if (ws && ws.readyState === 1) {\n        ws.send(JSON.stringify({\n            type: 'log-error',\n            error: message,\n            stack: new Error().stack\n        }));\n    }\n}\n\nfunction logInfo(message) {\n    console.log(utils.now(), message);\n\n    if (ws && ws.readyState === 1) {\n        ws.send(JSON.stringify({\n            type: 'log-info',\n            info: message\n        }));\n    }\n}\n\nwindow.logError = logError;\nwindow.logInfo = logInfo;\n\nfunction subscribeToMessages(messageHandler) {\n    messageHandlers.push(messageHandler);\n}\n\n// used to serialize frontend update operations\nlet consumeQueuePromise = null;\n\n// to make sure each change event is processed only once. Not clear if this is still necessary\nconst processedEntityChangeIds = new Set();\n\nfunction logRows(entityChanges) {\n    const filteredRows = entityChanges.filter(row =>\n        !processedEntityChangeIds.has(row.id)\n        && (row.entityName !== 'options' || row.entityId !== 'openNoteContexts'));\n\n    if (filteredRows.length > 0) {\n        console.debug(utils.now(), \"Frontend update data: \", filteredRows);\n    }\n}\n\nasync function executeFrontendUpdate(entityChanges) {\n    lastPingTs = Date.now();\n\n    if (entityChanges.length > 0) {\n        logRows(entityChanges);\n\n        frontendUpdateDataQueue.push(...entityChanges);\n\n        // we set lastAcceptedEntityChangeId even before frontend update processing and send ping so that backend can start sending more updates\n\n        for (const entityChange of entityChanges) {\n            lastAcceptedEntityChangeId = Math.max(lastAcceptedEntityChangeId, entityChange.id);\n\n            if (entityChange.isSynced) {\n                lastAcceptedEntityChangeSyncId = Math.max(lastAcceptedEntityChangeSyncId, entityChange.id);\n            }\n        }\n\n        sendPing();\n\n        // first wait for all the preceding consumers to finish\n        while (consumeQueuePromise) {\n            await consumeQueuePromise;\n        }\n\n        try {\n            // it's my turn, so start it up\n            consumeQueuePromise = consumeFrontendUpdateData();\n\n            await consumeQueuePromise;\n        } finally {\n            // finish and set to null to signal somebody else can pick it up\n            consumeQueuePromise = null;\n        }\n    }\n}\n\nasync function handleMessage(event) {\n    const message = JSON.parse(event.data);\n\n    for (const messageHandler of messageHandlers) {\n        messageHandler(message);\n    }\n\n    if (message.type === 'ping') {\n        lastPingTs = Date.now();\n    }\n    else if (message.type === 'reload-frontend') {\n        utils.reloadFrontendApp(\"received request from backend to reload frontend\");\n    }\n    else if (message.type === 'frontend-update') {\n        await executeFrontendUpdate(message.data.entityChanges);\n    }\n    else if (message.type === 'sync-hash-check-failed') {\n        toastService.showError(\"同步检查失败!\", 60000);\n    }\n    else if (message.type === 'consistency-checks-failed') {\n        toastService.showError(\"一致性检查失败! 详情请看日志.\", 50 * 60000);\n    }\n    else if (message.type === 'api-log-messages') {\n        appContext.triggerEvent(\"apiLogMessages\", {noteId: message.noteId, messages: message.messages});\n    }\n    else if (message.type === 'toast') {\n        toastService.showMessage(message.message);\n    }\n    else if (message.type === 'execute-script') {\n        const bundleService = (await import(\"../services/bundle.js\")).default;\n        const froca = (await import(\"../services/froca.js\")).default;\n        const originEntity = message.originEntityId ? await froca.getNote(message.originEntityId) : null;\n\n        bundleService.getAndExecuteBundle(message.currentNoteId, originEntity, message.script, message.params);\n    }\n}\n\nlet entityChangeIdReachedListeners = [];\n\nfunction waitForEntityChangeId(desiredEntityChangeId) {\n    if (desiredEntityChangeId <= lastProcessedEntityChangeId) {\n        return Promise.resolve();\n    }\n\n    console.debug(`Waiting for ${desiredEntityChangeId}, last processed is ${lastProcessedEntityChangeId}, last accepted ${lastAcceptedEntityChangeId}`);\n\n    return new Promise((res, rej) => {\n        entityChangeIdReachedListeners.push({\n            desiredEntityChangeId: desiredEntityChangeId,\n            resolvePromise: res,\n            start: Date.now()\n        })\n    });\n}\n\nfunction waitForMaxKnownEntityChangeId() {\n    return waitForEntityChangeId(server.getMaxKnownEntityChangeId());\n}\n\nfunction checkEntityChangeIdListeners() {\n    entityChangeIdReachedListeners\n        .filter(l => l.desiredEntityChangeId <= lastProcessedEntityChangeId)\n        .forEach(l => l.resolvePromise());\n\n    entityChangeIdReachedListeners = entityChangeIdReachedListeners\n        .filter(l => l.desiredEntityChangeId > lastProcessedEntityChangeId);\n\n    entityChangeIdReachedListeners.filter(l => Date.now() > l.start - 60000)\n        .forEach(l => console.log(`Waiting for entityChangeId ${l.desiredEntityChangeId} while last processed is ${lastProcessedEntityChangeId} (last accepted ${lastAcceptedEntityChangeId}) for ${Math.floor((Date.now() - l.start) / 1000)}s`));\n}\n\nasync function consumeFrontendUpdateData() {\n    if (frontendUpdateDataQueue.length > 0) {\n        const allEntityChanges = frontendUpdateDataQueue;\n        frontendUpdateDataQueue = [];\n\n        const nonProcessedEntityChanges = allEntityChanges.filter(ec => !processedEntityChangeIds.has(ec.id));\n\n        try {\n            await utils.timeLimit(frocaUpdater.processEntityChanges(nonProcessedEntityChanges), 30000);\n        }\n        catch (e) {\n            logError(`发生错误 ${e.message}: ${e.stack}, 重新加载界面.`);\n\n            if (!glob.isDev && !options.is('debugModeEnabled')) {\n                // if there's an error in updating the frontend, then the easy option to recover is to reload the frontend completely\n\n                utils.reloadFrontendApp();\n            }\n            else {\n                console.log(\"nonProcessedEntityChanges causing the timeout\", nonProcessedEntityChanges);\n\n                toastService.showError(`Encountered error \"${e.message}\", check out the console.`);\n            }\n        }\n\n        for (const entityChange of nonProcessedEntityChanges) {\n            processedEntityChangeIds.add(entityChange.id);\n\n            lastProcessedEntityChangeId = Math.max(lastProcessedEntityChangeId, entityChange.id);\n        }\n    }\n\n    checkEntityChangeIdListeners();\n}\n\nfunction connectWebSocket() {\n    const loc = window.location;\n    const webSocketUri = `${loc.protocol === \"https:\" ? \"wss:\" : \"ws:\"}//${loc.host}${loc.pathname}`;\n\n    // use wss for secure messaging\n    const ws = new WebSocket(webSocketUri);\n    ws.onopen = () => console.debug(utils.now(), `Connected to server ${webSocketUri} with WebSocket`);\n    ws.onmessage = handleMessage;\n    // we're not handling ws.onclose here because reconnection is done in sendPing()\n\n    return ws;\n}\n\nasync function sendPing() {\n    if (Date.now() - lastPingTs > 30000) {\n        console.log(utils.now(), \"Lost websocket connection to the backend. If you keep having this issue repeatedly, you might want to check your reverse proxy (nginx, apache) configuration and allow/unblock WebSocket.\");\n    }\n\n    if (ws.readyState === ws.OPEN) {\n        ws.send(JSON.stringify({\n            type: 'ping',\n            lastEntityChangeId: lastAcceptedEntityChangeId\n        }));\n    }\n    else if (ws.readyState === ws.CLOSED || ws.readyState === ws.CLOSING) {\n        console.log(utils.now(), \"WS closed or closing, trying to reconnect\");\n\n        ws = connectWebSocket();\n    }\n}\n\nsetTimeout(() => {\n    ws = connectWebSocket();\n\n    lastPingTs = Date.now();\n\n    setInterval(sendPing, 1000);\n}, 0);\n\nexport default {\n    logError,\n    subscribeToMessages,\n    waitForMaxKnownEntityChangeId,\n    getMaxKnownEntityChangeSyncId: () => lastAcceptedEntityChangeSyncId\n};\n","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = () => ([]);\nwebpackEmptyContext.resolve = webpackEmptyContext;\nwebpackEmptyContext.id = 3676;\nmodule.exports = webpackEmptyContext;","import Component from \"../components/component.js\";\n\n\n/**\n * This is the base widget for all other widgets.\n *\n * For information on using widgets, see the tutorial {@tutorial widget_basics}.\n */\nclass BasicWidget extends Component {\n    constructor() {\n        super();\n\n        this.attrs = {\n            style: ''\n        };\n        this.classes = [];\n\n        this.children = [];\n        this.childPositionCounter = 10;\n    }\n\n    child(...components) {\n        if (!components) {\n            return this;\n        }\n\n        super.child(...components);\n\n        for (const component of components) {\n            if (component.position === undefined) {\n                component.position = this.childPositionCounter;\n                this.childPositionCounter += 10;\n            }\n        }\n\n        this.children.sort((a, b) => a.position - b.position);\n\n        return this;\n    }\n\n    id(id) {\n        this.attrs.id = id;\n        return this;\n    }\n\n    class(className) {\n        this.classes.push(className);\n        return this;\n    }\n\n    css(name, value) {\n        this.attrs.style += `${name}: ${value};`;\n        return this;\n    }\n\n    contentSized() {\n        this.css(\"contain\", \"none\");\n\n        return this;\n    }\n\n    collapsible() {\n        this.css('min-height', '0');\n        this.css('min-width', '0');\n        return this;\n    }\n\n    filling() {\n        this.css('flex-grow', '1');\n        return this;\n    }\n\n    /**\n     * Accepts a string of CSS to add with the widget.\n     * @param {string} block\n     * @returns {this} for chaining\n     */\n    cssBlock(block) {\n        this.cssEl = block;\n        return this;\n    }\n\n    render() {\n        this.doRender();\n\n        this.$widget.attr('data-component-id', this.componentId);\n        this.$widget\n            .addClass('component')\n            .prop('component', this);\n\n        if (!this.isEnabled()) {\n            this.toggleInt(false);\n        }\n\n        if (this.cssEl) {\n            const css = this.cssEl.trim().startsWith('<style>') ? this.cssEl : `<style>${this.cssEl}</style>`;\n\n            this.$widget.append(css);\n        }\n\n        for (const key in this.attrs) {\n            if (key === 'style') {\n                if (this.attrs[key]) {\n                    let style = this.$widget.attr('style');\n                    style = style ? `${style}; ${this.attrs[key]}` : this.attrs[key];\n\n                    this.$widget.attr(key, style);\n                }\n            }\n            else {\n                this.$widget.attr(key, this.attrs[key]);\n            }\n        }\n\n        for (const className of this.classes) {\n            this.$widget.addClass(className);\n        }\n\n        return this.$widget;\n    }\n\n    isEnabled() {\n        return true;\n    }\n\n    /**\n     * Method used for rendering the widget.\n     *\n     * Your class should override this method.\n     * The method is expected to create a this.$widget containing jQuery object\n     */\n    doRender() {}\n\n    toggleInt(show) {\n        this.$widget.toggleClass('hidden-int', !show);\n    }\n\n    isHiddenInt() {\n        return this.$widget.hasClass('hidden-int');\n    }\n\n    toggleExt(show) {\n        this.$widget.toggleClass('hidden-ext', !show);\n    }\n\n    isHiddenExt() {\n        return this.$widget.hasClass('hidden-ext');\n    }\n\n    canBeShown() {\n        return !this.isHiddenInt() && !this.isHiddenExt();\n    }\n\n    isVisible() {\n        return this.$widget.is(\":visible\");\n    }\n\n    getPosition() {\n        return this.position;\n    }\n\n    remove() {\n        if (this.$widget) {\n            this.$widget.remove();\n        }\n    }\n\n    getClosestNtxId() {\n        if (this.$widget) {\n            return this.$widget.closest(\"[data-ntx-id]\").attr(\"data-ntx-id\");\n        }\n        else {\n            return null;\n        }\n    }\n\n    cleanup() {}\n}\n\nexport default BasicWidget;\n","import BasicWidget from \"./basic_widget.js\";\nimport appContext from \"../components/app_context.js\";\n\n/**\n * This widget allows for changing and updating depending on the active note.\n * @extends {BasicWidget}\n */\nclass NoteContextAwareWidget extends BasicWidget {\n    isNoteContext(ntxId) {\n        if (Array.isArray(ntxId)) {\n            return this.noteContext && ntxId.includes(this.noteContext.ntxId);\n        }\n        else {\n            return this.noteContext && this.noteContext.ntxId === ntxId;\n        }\n    }\n\n    isActiveNoteContext() {\n        return appContext.tabManager.getActiveContext() === this.noteContext;\n    }\n\n    isNote(noteId) {\n        return this.noteId === noteId;\n    }\n\n    /** @returns {FNote|undefined} */\n    get note() {\n        return this.noteContext?.note;\n    }\n\n    /** @returns {string|undefined} */\n    get noteId() {\n        return this.note?.noteId;\n    }\n\n    /** @returns {string|undefined} */\n    get notePath() {\n        return this.noteContext?.notePath;\n    }\n\n    /** @returns {string} */\n    get hoistedNoteId() {\n        return this.noteContext?.hoistedNoteId;\n    }\n\n    get ntxId() {\n        return this.noteContext?.ntxId;\n    }\n\n    /**\n     * @returns {boolean} true when an active note exists\n     */\n    isEnabled() {\n        return !!this.note;\n    }\n\n    async refresh() {\n        if (this.isEnabled()) {\n            this.toggleInt(true);\n            await this.refreshWithNote(this.note);\n        }\n        else {\n            this.toggleInt(false);\n        }\n    }\n\n    /**\n     * Override this method to be able to refresh your\n     * widget with each note.\n     * @param {FNote} note\n     * @returns {Promise<void>}\n     */\n    async refreshWithNote(note) {}\n\n    async noteSwitchedEvent({noteContext, notePath}) {\n        // if notePath does not match, then the noteContext has been switched to another note in the meantime\n        if (noteContext.notePath === notePath) {\n            await this.noteSwitched();\n        }\n    }\n\n    async noteSwitched() {\n        await this.refresh();\n    }\n\n    async activeContextChangedEvent({noteContext}) {\n        this.noteContext = noteContext;\n\n        await this.activeContextChanged();\n    }\n\n    async activeContextChanged() {\n        await this.refresh();\n    }\n\n    // when note is both switched and activated, this should not produce a double refresh\n    async noteSwitchedAndActivatedEvent({noteContext, notePath}) {\n        this.noteContext = noteContext;\n\n        // if notePath does not match, then the noteContext has been switched to another note in the meantime\n        if (this.notePath === notePath) {\n            await this.refresh();\n        }\n    }\n\n    setNoteContextEvent({noteContext}) {\n        /** @var {NoteContext} */\n        this.noteContext = noteContext;\n    }\n\n    async noteTypeMimeChangedEvent({noteId}) {\n        if (this.isNote(noteId)) {\n            await this.refresh();\n        }\n    }\n\n    async frocaReloadedEvent() {\n        await this.refresh();\n    }\n}\n\nexport default NoteContextAwareWidget;\n","import NoteContextAwareWidget from \"./note_context_aware_widget.js\";\n\nconst WIDGET_TPL = `\n<div class=\"card widget\">\n    <div class=\"card-header\">\n        <div class=\"card-header-title\"></div>\n        <div class=\"card-header-buttons\"></div>\n    </div>\n\n    <div id=\"[to be set]\" class=\"body-wrapper\">\n        <div class=\"card-body\"></div>\n    </div>\n</div>`;\n\n/**\n * This widget manages rendering panels in the right-hand pane.\n * @extends {NoteContextAwareWidget}\n */\nclass RightPanelWidget extends NoteContextAwareWidget {\n    /** Title to show in the panel. */\n    get widgetTitle() { return \"Untitled widget\"; }\n\n    get widgetButtons() { return []; }\n\n    get help() { return {}; }\n\n    constructor() {\n        super();\n\n        this.child(...this.widgetButtons);\n    }\n\n    /**\n     * Do not override this method unless you know what you're doing.\n     * Do not override this method unless you know what you're doing.\n     */\n    doRender() {\n        this.$widget = $(WIDGET_TPL);\n        this.contentSized();\n        this.$widget.find('[data-target]').attr('data-target', `#${this.componentId}`);\n\n        this.$bodyWrapper = this.$widget.find('.body-wrapper');\n        this.$bodyWrapper.attr('id', this.componentId); // for toggle to work we need id\n\n        this.$body = this.$bodyWrapper.find('.card-body');\n\n        this.$title = this.$widget.find('.card-header .card-header-title');\n        this.$title.text(this.widgetTitle);\n\n        this.$buttons = this.$widget.find('.card-header .card-header-buttons');\n        this.$buttons.empty();\n\n        for (const buttonWidget of this.children) {\n            this.$buttons.append(buttonWidget.render());\n        }\n\n        this.initialized = this.doRenderBody();\n    }\n\n    /**\n     * Method used for rendering the body of the widget (via existing this.$body)\n     *\n     * Your class should override this method.\n     * @returns {Promise|undefined} if widget needs async operation to initialize, it can return a Promise\n     */\n    async doRenderBody() {}\n}\n\nexport default RightPanelWidget;\n","module.exports = require(\"electron\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","var inProgress = {};\nvar dataWebpackPrefix = \"trilium:\";\n// loadScript function to load a script via script tag\n__webpack_require__.l = (url, done, key, chunkId) => {\n\tif(inProgress[url]) { inProgress[url].push(done); return; }\n\tvar script, needAttach;\n\tif(key !== undefined) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tfor(var i = 0; i < scripts.length; i++) {\n\t\t\tvar s = scripts[i];\n\t\t\tif(s.getAttribute(\"src\") == url || s.getAttribute(\"data-webpack\") == dataWebpackPrefix + key) { script = s; break; }\n\t\t}\n\t}\n\tif(!script) {\n\t\tneedAttach = true;\n\t\tscript = document.createElement('script');\n\n\t\tscript.charset = 'utf-8';\n\t\tscript.timeout = 120;\n\t\tif (__webpack_require__.nc) {\n\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n\t\t}\n\t\tscript.setAttribute(\"data-webpack\", dataWebpackPrefix + key);\n\t\tscript.src = url;\n\t}\n\tinProgress[url] = [done];\n\tvar onScriptComplete = (prev, event) => {\n\t\t// avoid mem leaks in IE.\n\t\tscript.onerror = script.onload = null;\n\t\tclearTimeout(timeout);\n\t\tvar doneFns = inProgress[url];\n\t\tdelete inProgress[url];\n\t\tscript.parentNode && script.parentNode.removeChild(script);\n\t\tdoneFns && doneFns.forEach((fn) => (fn(event)));\n\t\tif(prev) return prev(event);\n\t}\n\tvar timeout = setTimeout(onScriptComplete.bind(null, undefined, { type: 'timeout', target: script }), 120000);\n\tscript.onerror = onScriptComplete.bind(null, script.onerror);\n\tscript.onload = onScriptComplete.bind(null, script.onload);\n\tneedAttach && document.head.appendChild(script);\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = (chunkId) => {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce((promises, key) => {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks\n__webpack_require__.u = (chunkId) => {\n\t// return url for filenames based on template\n\treturn \"\" + chunkId + \".js\";\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.p = \"assets/v0.62.4/app-dist/\";","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t8: 0,\n\t586: 0\n};\n\n__webpack_require__.f.j = (chunkId, promises) => {\n\t\t// JSONP chunk loading for javascript\n\t\tvar installedChunkData = __webpack_require__.o(installedChunks, chunkId) ? installedChunks[chunkId] : undefined;\n\t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n\t\t\t// a Promise means \"currently loading\".\n\t\t\tif(installedChunkData) {\n\t\t\t\tpromises.push(installedChunkData[2]);\n\t\t\t} else {\n\t\t\t\tif(true) { // all chunks have JS\n\t\t\t\t\t// setup Promise in chunk cache\n\t\t\t\t\tvar promise = new Promise((resolve, reject) => (installedChunkData = installedChunks[chunkId] = [resolve, reject]));\n\t\t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n\t\t\t\t\t// start chunk loading\n\t\t\t\t\tvar url = __webpack_require__.p + __webpack_require__.u(chunkId);\n\t\t\t\t\t// create error before stack unwound to get useful stacktrace later\n\t\t\t\t\tvar error = new Error();\n\t\t\t\t\tvar loadingEnded = (event) => {\n\t\t\t\t\t\tif(__webpack_require__.o(installedChunks, chunkId)) {\n\t\t\t\t\t\t\tinstalledChunkData = installedChunks[chunkId];\n\t\t\t\t\t\t\tif(installedChunkData !== 0) installedChunks[chunkId] = undefined;\n\t\t\t\t\t\t\tif(installedChunkData) {\n\t\t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n\t\t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n\t\t\t\t\t\t\t\terror.message = 'Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')';\n\t\t\t\t\t\t\t\terror.name = 'ChunkLoadError';\n\t\t\t\t\t\t\t\terror.type = errorType;\n\t\t\t\t\t\t\t\terror.request = realSrc;\n\t\t\t\t\t\t\t\tinstalledChunkData[1](error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\t__webpack_require__.l(url, loadingEnded, \"chunk-\" + chunkId, chunkId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n};\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n// no on chunks loaded\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\n}\n\nvar chunkLoadingGlobal = global[\"webpackChunktrilium\"] = global[\"webpackChunktrilium\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","import BasicWidget from \"../basic_widget.js\";\n\nexport default class Container extends BasicWidget {\n    doRender() {\n        this.$widget = $(`<div>`);\n        this.renderChildren();\n    }\n\n    renderChildren() {\n        for (const widget of this.children) {\n            this.$widget.append(widget.render());\n        }\n    }\n}\n","import Container from \"./container.js\";\n\nexport default class FlexContainer extends Container {\n    constructor(direction) {\n        super();\n\n        if (!direction || !['row', 'column'].includes(direction)) {\n            throw new Error(`Direction argument given as '${direction}', use either 'row' or 'column'`);\n        }\n\n        this.attrs.style = `display: flex; flex-direction: ${direction};`;\n    }\n}\n","import NoteContextAwareWidget from \"./note_context_aware_widget.js\";\nimport protectedSessionHolder from \"../services/protected_session_holder.js\";\nimport server from \"../services/server.js\";\nimport SpacedUpdate from \"../services/spaced_update.js\";\nimport appContext from \"../components/app_context.js\";\nimport branchService from \"../services/branches.js\";\nimport shortcutService from \"../services/shortcuts.js\";\n\nconst TPL = `\n<div class=\"note-title-widget\">\n    <style>\n    .note-title-widget {\n        flex-grow: 1000;\n        height: 100%;\n    }\n    \n    .note-title-widget input.note-title {\n        font-size: 180%;\n        border: 0;\n        min-width: 5em;\n        width: 100%;\n    }\n    \n    .note-title-widget input.note-title.protected {\n        text-shadow: 4px 4px 4px var(--muted-text-color);\n    }\n    </style>\n\n    <input autocomplete=\"off\" value=\"\" placeholder=\"输入笔记标题...\" class=\"note-title\" tabindex=\"100\">\n</div>`;\n\nexport default class NoteTitleWidget extends NoteContextAwareWidget {\n    constructor() {\n        super();\n\n        this.spacedUpdate = new SpacedUpdate(async () => {\n            const title = this.$noteTitle.val();\n\n            protectedSessionHolder.touchProtectedSessionIfNecessary(this.note);\n\n            await server.put(`notes/${this.noteId}/title`, {title}, this.componentId);\n        });\n\n        this.deleteNoteOnEscape = false;\n\n        appContext.addBeforeUnloadListener(this);\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$noteTitle = this.$widget.find(\".note-title\");\n\n        this.$noteTitle.on('input', () => this.spacedUpdate.scheduleUpdate());\n\n        this.$noteTitle.on('blur', () => {\n            this.spacedUpdate.updateNowIfNecessary();\n\n            this.deleteNoteOnEscape = false;\n        });\n\n        shortcutService.bindElShortcut(this.$noteTitle, 'esc', () => {\n            if (this.deleteNoteOnEscape && this.noteContext.isActive()) {\n                branchService.deleteNotes(Object.values(this.noteContext.note.parentToBranch));\n            }\n        });\n\n        shortcutService.bindElShortcut(this.$noteTitle, 'return', () => {\n            this.triggerCommand('focusOnDetail', {ntxId: this.noteContext.ntxId});\n        });\n    }\n\n    async refreshWithNote(note) {\n        const isReadOnly = (note.isProtected && !protectedSessionHolder.isProtectedSessionAvailable())\n            || ['_lbRoot', '_lbAvailableLaunchers', '_lbVisibleLaunchers'].includes(note.noteId)\n            || this.noteContext.viewScope.viewMode !== 'default';\n\n        this.$noteTitle.val(\n            isReadOnly\n                ? await this.noteContext.getNavigationTitle()\n                : note.title\n        );\n        this.$noteTitle.prop(\"readonly\", isReadOnly);\n\n        this.setProtectedStatus(note);\n    }\n\n    /** @param {FNote} note */\n    setProtectedStatus(note) {\n        this.$noteTitle.toggleClass(\"protected\", !!note.isProtected);\n    }\n\n    async beforeNoteSwitchEvent({noteContext}) {\n        if (this.isNoteContext(noteContext.ntxId)) {\n            await this.spacedUpdate.updateNowIfNecessary();\n        }\n    }\n\n    async beforeNoteContextRemoveEvent({ntxIds}) {\n        if (this.isNoteContext(ntxIds)) {\n            await this.spacedUpdate.updateNowIfNecessary();\n        }\n    }\n\n    focusOnTitleEvent() {\n        if (this.noteContext && this.noteContext.isActive()) {\n            this.$noteTitle.trigger('focus');\n        }\n    }\n\n    focusAndSelectTitleEvent({isNewNote} = {isNewNote: false}) {\n        if (this.noteContext && this.noteContext.isActive()) {\n            this.$noteTitle\n                .trigger('focus')\n                .trigger('select');\n\n            this.deleteNoteOnEscape = isNewNote;\n        }\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.isNoteReloaded(this.noteId)) {\n            // not updating the title specifically since the synced title might be older than what the user is currently typing\n            this.setProtectedStatus(this.note);\n        }\n\n        if (loadResults.isNoteReloaded(this.noteId, this.componentId)) {\n            this.refresh();\n        }\n    }\n\n    beforeUnloadEvent() {\n        return this.spacedUpdate.isAllSavedAndTriggerUpdate();\n    }\n}\n","import server from './server.js';\nimport froca from './froca.js';\n\nasync function addLabel(noteId, name, value = \"\") {\n    await server.put(`notes/${noteId}/attribute`, {\n        type: 'label',\n        name: name,\n        value: value\n    });\n}\n\nasync function setLabel(noteId, name, value = \"\") {\n    await server.put(`notes/${noteId}/set-attribute`, {\n        type: 'label',\n        name: name,\n        value: value\n    });\n}\n\nasync function removeAttributeById(noteId, attributeId) {\n    await server.remove(`notes/${noteId}/attributes/${attributeId}`);\n}\n\n/**\n * @returns {boolean} - returns true if this attribute has the potential to influence the note in the argument.\n *         That can happen in multiple ways:\n *         1. attribute is owned by the note\n *         2. attribute is owned by the template of the note\n *         3. attribute is owned by some note's ancestor and is inheritable\n */\nfunction isAffecting(attrRow, affectedNote) {\n    if (!affectedNote || !attrRow) {\n        return false;\n    }\n\n    const attrNote = froca.notes[attrRow.noteId];\n\n    if (!attrNote) {\n        // the note (owner of the attribute) is not even loaded into the cache, so it should not affect anything else\n        return false;\n    }\n\n    const owningNotes = [affectedNote, ...affectedNote.getNotesToInheritAttributesFrom()];\n\n    for (const owningNote of owningNotes) {\n        if (owningNote.noteId === attrNote.noteId) {\n            return true;\n        }\n    }\n\n    if (this.isInheritable) {\n        for (const owningNote of owningNotes) {\n            if (owningNote.hasAncestor(attrNote.noteId, true)) {\n                return true;\n            }\n        }\n    }\n\n    return false;\n}\n\nexport default {\n    addLabel,\n    setLabel,\n    removeAttributeById,\n    isAffecting\n}\n","import server from \"./server.js\";\nimport appContext from \"../components/app_context.js\";\nimport utils from './utils.js';\nimport noteCreateService from './note_create.js';\nimport froca from \"./froca.js\";\n\n// this key needs to have this value, so it's hit by the tooltip\nconst SELECTED_NOTE_PATH_KEY = \"data-note-path\";\n\nconst SELECTED_EXTERNAL_LINK_KEY = \"data-external-link\";\n\nasync function autocompleteSourceForCKEditor(queryText) {\n    return await new Promise((res, rej) => {\n        autocompleteSource(queryText, rows => {\n            res(rows.map(row => {\n                return {\n                    action: row.action,\n                    noteTitle: row.noteTitle,\n                    id: `@${row.notePathTitle}`,\n                    name: row.notePathTitle,\n                    link: `#${row.notePath}`,\n                    notePath: row.notePath,\n                    highlightedNotePathTitle: row.highlightedNotePathTitle\n                }\n            }));\n        }, {\n            allowCreatingNotes: true\n        });\n    });\n}\n\nasync function autocompleteSource(term, cb, options = {}) {\n    const activeNoteId = appContext.tabManager.getActiveContextNoteId();\n\n    let results = await server.get(`autocomplete?query=${encodeURIComponent(term)}&activeNoteId=${activeNoteId}`);\n\n    if (term.trim().length >= 1 && options.allowCreatingNotes) {\n        results = [\n            {\n                action: 'create-note',\n                noteTitle: term,\n                parentNoteId: activeNoteId || 'root',\n                highlightedNotePathTitle: `创建并关联子笔记 \"${utils.escapeHtml(term)}\"`\n            }\n        ].concat(results);\n    }\n\n    if (term.match(/^[a-z]+:\\/\\/.+/i) && options.allowExternalLinks) {\n        results = [\n            {\n                action: 'external-link',\n                externalLink: term,\n                highlightedNotePathTitle: `插入外部链接到 \"${utils.escapeHtml(term)}\"`\n            }\n        ].concat(results);\n    }\n\n    cb(results);\n}\n\nfunction clearText($el) {\n    if (utils.isMobile()) {\n        return;\n    }\n\n    $el.setSelectedNotePath(\"\");\n    $el.autocomplete(\"val\", \"\").trigger('change');\n}\n\nfunction setText($el, text) {\n    if (utils.isMobile()) {\n        return;\n    }\n\n    $el.setSelectedNotePath(\"\");\n    $el\n        .autocomplete(\"val\", text.trim())\n        .autocomplete(\"open\");\n}\n\nfunction showRecentNotes($el) {\n    if (utils.isMobile()) {\n        return;\n    }\n\n    $el.setSelectedNotePath(\"\");\n    $el.autocomplete(\"val\", \"\");\n    $el.trigger('focus');\n\n    // simulate pressing down arrow to trigger autocomplete\n    const e = $.Event('keydown');\n    e.which = 40; // arrow down\n    $el.trigger(e);\n}\n\nfunction initNoteAutocomplete($el, options) {\n    if ($el.hasClass(\"note-autocomplete-input\") || utils.isMobile()) {\n        // clear any event listener added in previous invocation of this function\n        $el.off('autocomplete:noteselected');\n\n        return $el;\n    }\n\n    options = options || {};\n\n    $el.addClass(\"note-autocomplete-input\");\n\n    const $clearTextButton = $(\"<a>\")\n            .addClass(\"input-group-text input-clearer-button bx bxs-tag-x\")\n            .prop(\"title\", \"清空文字\");\n\n    const $showRecentNotesButton = $(\"<a>\")\n            .addClass(\"input-group-text show-recent-notes-button bx bx-time\")\n            .prop(\"title\", \"显示最近笔记\");\n\n    const $goToSelectedNoteButton = $(\"<a>\")\n        .addClass(\"input-group-text go-to-selected-note-button bx bx-arrow-to-right\");\n\n    const $sideButtons = $(\"<div>\")\n        .addClass(\"input-group-append\")\n        .append($clearTextButton)\n        .append($showRecentNotesButton);\n\n    if (!options.hideGoToSelectedNoteButton) {\n        $sideButtons.append($goToSelectedNoteButton);\n    }\n\n    $el.after($sideButtons);\n\n    $clearTextButton.on('click', () => clearText($el));\n\n    $showRecentNotesButton.on('click', e => {\n        showRecentNotes($el);\n\n        // this will cause the click not give focus to the \"show recent notes\" button\n        // this is important because otherwise input will lose focus immediately and not show the results\n        return false;\n    });\n\n    let autocompleteOptions = {};\n    if (options.container) {\n        autocompleteOptions.dropdownMenuContainer = options.container;\n        autocompleteOptions.debug = true;   // don't close on blur\n    }\n\n    $el.autocomplete({\n        ...autocompleteOptions,\n        appendTo: document.querySelector('body'),\n        hint: false,\n        autoselect: true,\n        // openOnFocus has to be false, otherwise re-focus (after return from note type chooser dialog) forces\n        // re-querying of the autocomplete source which then changes the currently selected suggestion\n        openOnFocus: false,\n        minLength: 0,\n        tabAutocomplete: false\n    }, [\n        {\n            source: (term, cb) => autocompleteSource(term, cb, options),\n            displayKey: 'notePathTitle',\n            templates: {\n                suggestion: suggestion => suggestion.highlightedNotePathTitle\n            },\n            // we can't cache identical searches because notes can be created / renamed, new recent notes can be added\n            cache: false\n        }\n    ]);\n\n    $el.on('autocomplete:selected', async (event, suggestion) => {\n        if (suggestion.action === 'external-link') {\n            $el.setSelectedNotePath(null);\n            $el.setSelectedExternalLink(suggestion.externalLink);\n\n            $el.autocomplete(\"val\", suggestion.externalLink);\n\n            $el.autocomplete(\"close\");\n\n            $el.trigger('autocomplete:externallinkselected', [suggestion]);\n\n            return;\n        }\n\n        if (suggestion.action === 'create-note') {\n            const {success, noteType, templateNoteId} = await noteCreateService.chooseNoteType();\n\n            if (!success) {\n                return;\n            }\n\n            const {note} = await noteCreateService.createNote(suggestion.parentNoteId, {\n                title: suggestion.noteTitle,\n                activate: false,\n                type: noteType,\n                templateNoteId: templateNoteId\n            });\n\n            const hoistedNoteId = appContext.tabManager.getActiveContext()?.hoistedNoteId;\n            suggestion.notePath = note.getBestNotePathString(hoistedNoteId);\n        }\n\n        $el.setSelectedNotePath(suggestion.notePath);\n        $el.setSelectedExternalLink(null);\n\n        $el.autocomplete(\"val\", suggestion.noteTitle);\n\n        $el.autocomplete(\"close\");\n\n        $el.trigger('autocomplete:noteselected', [suggestion]);\n    });\n\n    $el.on('autocomplete:closed', () => {\n        if (!$el.val().trim()) {\n            clearText($el);\n        }\n    });\n\n    $el.on('autocomplete:opened', () => {\n        if ($el.attr(\"readonly\")) {\n            $el.autocomplete('close');\n        }\n    });\n\n    // clear any event listener added in previous invocation of this function\n    $el.off('autocomplete:noteselected');\n\n    return $el;\n}\n\nfunction init() {\n    $.fn.getSelectedNotePath = function () {\n        if (!$(this).val().trim()) {\n            return \"\";\n        } else {\n            return $(this).attr(SELECTED_NOTE_PATH_KEY);\n        }\n    };\n\n    $.fn.getSelectedNoteId = function () {\n        const notePath = $(this).getSelectedNotePath();\n        if (!notePath) {\n            return null;\n        }\n\n        const chunks = notePath.split('/');\n\n        return chunks.length >= 1 ? chunks[chunks.length - 1] : null;\n    }\n\n    $.fn.setSelectedNotePath = function (notePath) {\n        notePath = notePath || \"\";\n\n        $(this).attr(SELECTED_NOTE_PATH_KEY, notePath);\n\n        $(this)\n            .closest(\".input-group\")\n            .find(\".go-to-selected-note-button\")\n            .toggleClass(\"disabled\", !notePath.trim())\n            .attr(\"href\", `#${notePath}`); // we also set href here so tooltip can be displayed\n    };\n\n    $.fn.getSelectedExternalLink = function () {\n        if (!$(this).val().trim()) {\n            return \"\";\n        } else {\n            return $(this).attr(SELECTED_EXTERNAL_LINK_KEY);\n        }\n    };\n\n    $.fn.setSelectedExternalLink = function (externalLink) {\n        if (externalLink) {\n            $(this)\n                .closest(\".input-group\")\n                .find(\".go-to-selected-note-button\")\n                .toggleClass(\"disabled\", true);\n        }\n    }\n\n    $.fn.setNote = async function (noteId) {\n        const note = noteId ? await froca.getNote(noteId, true) : null;\n\n        $(this)\n            .val(note ? note.title : \"\")\n            .setSelectedNotePath(noteId);\n    }\n}\n\nexport default {\n    autocompleteSourceForCKEditor,\n    initNoteAutocomplete,\n    showRecentNotes,\n    setText,\n    init\n}\n","import NoteContextAwareWidget from \"../note_context_aware_widget.js\";\nimport appContext from \"../../components/app_context.js\";\n\nexport default class TypeWidget extends NoteContextAwareWidget {\n    // for overriding\n    static getType() {}\n\n    doRender() {\n        this.contentSized();\n\n        return super.doRender();\n    }\n\n    /** @param {FNote} note */\n    async doRefresh(note) {}\n\n    async refresh() {\n        const thisWidgetType = this.constructor.getType();\n        const noteWidgetType = await this.parent.getWidgetType();\n\n        if (thisWidgetType !== noteWidgetType) {\n            this.toggleInt(false);\n\n            this.cleanup();\n        }\n        else {\n            this.toggleInt(true);\n\n            await this.doRefresh(this.note);\n\n            this.triggerEvent('noteDetailRefreshed', {ntxId: this.noteContext.ntxId});\n        }\n    }\n\n    isActive() {\n        return this.$widget.is(\":visible\") && this.noteContext?.ntxId === appContext.tabManager.activeNtxId;\n    }\n\n    /** @returns {Promise<Object>|*} promise resolving note data. Note data is an object with content. */\n    getData() {}\n\n    focus() {}\n\n    async readOnlyTemporarilyDisabledEvent({noteContext}) {\n        if (this.isNoteContext(noteContext.ntxId)) {\n            await this.refresh();\n\n            this.focus();\n        }\n    }\n\n    // events should be propagated manually to the children widgets\n    handleEventInChildren(name, data) {\n        if (['activeContextChanged', 'setNoteContext'].includes(name)) {\n            // won't trigger .refresh();\n            return super.handleEventInChildren('setNoteContext', data);\n        }\n        else if (name === 'entitiesReloaded') {\n            return super.handleEventInChildren(name, data);\n        }\n        else {\n            return Promise.resolve();\n        }\n    }\n}\n","import options from \"./options.js\";\n\nconst MIME_TYPES_DICT = [\n    { default: true, title: \"纯文本\", mime: \"text/plain\" },\n    { title: \"APL\", mime: \"text/apl\" },\n    { title: \"ASN.1\", mime: \"text/x-ttcn-asn\" },\n    { title: \"ASP.NET\", mime: \"application/x-aspx\" },\n    { title: \"Asterisk\", mime: \"text/x-asterisk\" },\n    { title: \"Brainfuck\", mime: \"text/x-brainfuck\" },\n    { default: true, title: \"C\", mime: \"text/x-csrc\" },\n    { default: true, title: \"C#\", mime: \"text/x-csharp\" },\n    { default: true, title: \"C++\", mime: \"text/x-c++src\" },\n    { title: \"Clojure\", mime: \"text/x-clojure\" },\n    { title: \"ClojureScript\", mime: \"text/x-clojurescript\" },\n    { title: \"Closure Stylesheets (GSS)\", mime: \"text/x-gss\" },\n    { title: \"CMake\", mime: \"text/x-cmake\" },\n    { title: \"Cobol\", mime: \"text/x-cobol\" },\n    { title: \"CoffeeScript\", mime: \"text/coffeescript\" },\n    { title: \"Common Lisp\", mime: \"text/x-common-lisp\" },\n    { title: \"CQL\", mime: \"text/x-cassandra\" },\n    { title: \"Crystal\", mime: \"text/x-crystal\" },\n    { default: true, title: \"CSS\", mime: \"text/css\" },\n    { title: \"Cypher\", mime: \"application/x-cypher-query\" },\n    { title: \"Cython\", mime: \"text/x-cython\" },\n    { title: \"D\", mime: \"text/x-d\" },\n    { title: \"Dart\", mime: \"application/dart\" },\n    { title: \"diff\", mime: \"text/x-diff\" },\n    { title: \"Django\", mime: \"text/x-django\" },\n    { title: \"Dockerfile\", mime: \"text/x-dockerfile\" },\n    { title: \"DTD\", mime: \"application/xml-dtd\" },\n    { title: \"Dylan\", mime: \"text/x-dylan\" },\n    { title: \"EBNF\", mime: \"text/x-ebnf\" },\n    { title: \"ECL\", mime: \"text/x-ecl\" },\n    { title: \"edn\", mime: \"application/edn\" },\n    { title: \"Eiffel\", mime: \"text/x-eiffel\" },\n    { title: \"Elm\", mime: \"text/x-elm\" },\n    { title: \"Embedded Javascript\", mime: \"application/x-ejs\" },\n    { title: \"Embedded Ruby\", mime: \"application/x-erb\" },\n    { title: \"Erlang\", mime: \"text/x-erlang\" },\n    { title: \"Esper\", mime: \"text/x-esper\" },\n    { title: \"F#\", mime: \"text/x-fsharp\" },\n    { title: \"Factor\", mime: \"text/x-factor\" },\n    { title: \"FCL\", mime: \"text/x-fcl\" },\n    { title: \"Forth\", mime: \"text/x-forth\" },\n    { title: \"Fortran\", mime: \"text/x-fortran\" },\n    { title: \"Gas\", mime: \"text/x-gas\" },\n    { title: \"Gherkin\", mime: \"text/x-feature\" },\n    { title: \"GitHub风格的Markdown\", mime: \"text/x-gfm\" },\n    { default: true, title: \"Go\", mime: \"text/x-go\" },\n    { default: true, title: \"Groovy\", mime: \"text/x-groovy\" },\n    { title: \"HAML\", mime: \"text/x-haml\" },\n    { default: true, title: \"Haskell\", mime: \"text/x-haskell\" },\n    { title: \"Haskell (Literate)\", mime: \"text/x-literate-haskell\" },\n    { title: \"Haxe\", mime: \"text/x-haxe\" },\n    { default: true, title: \"HTML\", mime: \"text/html\" },\n    { default: true, title: \"HTTP\", mime: \"message/http\" },\n    { title: \"HXML\", mime: \"text/x-hxml\" },\n    { title: \"IDL\", mime: \"text/x-idl\" },\n    { default: true, title: \"Java\", mime: \"text/x-java\" },\n    { title: \"Java服务器页面\", mime: \"application/x-jsp\" },\n    { title: \"Jinja2\", mime: \"text/jinja2\" },\n    { default: true, title: \"JS backend\", mime: \"application/javascript;env=backend\" },\n    { default: true, title: \"JS frontend\", mime: \"application/javascript;env=frontend\" },\n    { default: true, title: \"JSON\", mime: \"application/json\" },\n    { title: \"JSON-LD\", mime: \"application/ld+json\" },\n    { title: \"JSX\", mime: \"text/jsx\" },\n    { title: \"Julia\", mime: \"text/x-julia\" },\n    { default: true, title: \"Kotlin\", mime: \"text/x-kotlin\" },\n    { title: \"LaTeX\", mime: \"text/x-latex\" },\n    { title: \"LESS\", mime: \"text/x-less\" },\n    { title: \"LiveScript\", mime: \"text/x-livescript\" },\n    { title: \"Lua\", mime: \"text/x-lua\" },\n    { title: \"MariaDB SQL\", mime: \"text/x-mariadb\" },\n    { default: true, title: \"Markdown\", mime: \"text/x-markdown\" },\n    { title: \"Mathematica\", mime: \"text/x-mathematica\" },\n    { title: \"mbox\", mime: \"application/mbox\" },\n    { title: \"mIRC\", mime: \"text/mirc\" },\n    { title: \"Modelica\", mime: \"text/x-modelica\" },\n    { title: \"MS SQL\", mime: \"text/x-mssql\" },\n    { title: \"mscgen\", mime: \"text/x-mscgen\" },\n    { title: \"msgenny\", mime: \"text/x-msgenny\" },\n    { title: \"MUMPS\", mime: \"text/x-mumps\" },\n    { title: \"MySQL\", mime: \"text/x-mysql\" },\n    { title: \"Nginx\", mime: \"text/x-nginx-conf\" },\n    { title: \"NSIS\", mime: \"text/x-nsis\" },\n    { title: \"NTriples\", mime: \"application/n-triples\" },\n    { title: \"Objective-C\", mime: \"text/x-objectivec\" },\n    { title: \"OCaml\", mime: \"text/x-ocaml\" },\n    { title: \"Octave\", mime: \"text/x-octave\" },\n    { title: \"Oz\", mime: \"text/x-oz\" },\n    { title: \"Pascal\", mime: \"text/x-pascal\" },\n    { title: \"PEG.js\", mime: \"null\" },\n    { default: true, title: \"Perl\", mime: \"text/x-perl\" },\n    { title: \"PGP\", mime: \"application/pgp\" },\n    { default: true, title: \"PHP\", mime: \"text/x-php\" },\n    { title: \"Pig\", mime: \"text/x-pig\" },\n    { title: \"PLSQL\", mime: \"text/x-plsql\" },\n    { title: \"PostgreSQL\", mime: \"text/x-pgsql\" },\n    { title: \"PowerShell\", mime: \"application/x-powershell\" },\n    { title: \"属性文件\", mime: \"text/x-properties\" },\n    { title: \"ProtoBuf\", mime: \"text/x-protobuf\" },\n    { title: \"Pug\", mime: \"text/x-pug\" },\n    { title: \"Puppet\", mime: \"text/x-puppet\" },\n    { default: true, title: \"Python\", mime: \"text/x-python\" },\n    { title: \"Q\", mime: \"text/x-q\" },\n    { title: \"R\", mime: \"text/x-rsrc\" },\n    { title: \"reStructuredText\", mime: \"text/x-rst\" },\n    { title: \"RPM Changes\", mime: \"text/x-rpm-changes\" },\n    { title: \"RPM Spec\", mime: \"text/x-rpm-spec\" },\n    { default: true, title: \"Ruby\", mime: \"text/x-ruby\" },\n    { title: \"Rust\", mime: \"text/x-rustsrc\" },\n    { title: \"SAS\", mime: \"text/x-sas\" },\n    { title: \"Sass\", mime: \"text/x-sass\" },\n    { title: \"Scala\", mime: \"text/x-scala\" },\n    { title: \"Scheme\", mime: \"text/x-scheme\" },\n    { title: \"SCSS\", mime: \"text/x-scss\" },\n    { default: true, title: \"Shell (bash)\", mime: \"text/x-sh\" },\n    { title: \"Sieve\", mime: \"application/sieve\" },\n    { title: \"Slim\", mime: \"text/x-slim\" },\n    { title: \"Smalltalk\", mime: \"text/x-stsrc\" },\n    { title: \"Smarty\", mime: \"text/x-smarty\" },\n    { title: \"SML\", mime: \"text/x-sml\" },\n    { title: \"Solr\", mime: \"text/x-solr\" },\n    { title: \"Soy\", mime: \"text/x-soy\" },\n    { title: \"SPARQL\", mime: \"application/sparql-query\" },\n    { title: \"Spreadsheet\", mime: \"text/x-spreadsheet\" },\n    { default: true, title: \"SQL\", mime: \"text/x-sql\" },\n    { title: \"SQLite\", mime: \"text/x-sqlite\" },\n    { default: true, title: \"SQLite (Trilium)\", mime: \"text/x-sqlite;schema=trilium\" },\n    { title: \"Squirrel\", mime: \"text/x-squirrel\" },\n    { title: \"sTeX\", mime: \"text/x-stex\" },\n    { title: \"Stylus\", mime: \"text/x-styl\" },\n    { default: true, title: \"Swift\", mime: \"text/x-swift\" },\n    { title: \"SystemVerilog\", mime: \"text/x-systemverilog\" },\n    { title: \"Tcl\", mime: \"text/x-tcl\" },\n    { title: \"Textile\", mime: \"text/x-textile\" },\n    { title: \"TiddlyWiki \", mime: \"text/x-tiddlywiki\" },\n    { title: \"Tiki wiki\", mime: \"text/tiki\" },\n    { title: \"TOML\", mime: \"text/x-toml\" },\n    { title: \"Tornado\", mime: \"text/x-tornado\" },\n    { title: \"troff\", mime: \"text/troff\" },\n    { title: \"TTCN\", mime: \"text/x-ttcn\" },\n    { title: \"TTCN_CFG\", mime: \"text/x-ttcn-cfg\" },\n    { title: \"Turtle\", mime: \"text/turtle\" },\n    { title: \"Twig\", mime: \"text/x-twig\" },\n    { title: \"TypeScript\", mime: \"application/typescript\" },\n    { title: \"TypeScript-JSX\", mime: \"text/typescript-jsx\" },\n    { title: \"VB.NET\", mime: \"text/x-vb\" },\n    { title: \"VBScript\", mime: \"text/vbscript\" },\n    { title: \"Velocity\", mime: \"text/velocity\" },\n    { title: \"Verilog\", mime: \"text/x-verilog\" },\n    { title: \"VHDL\", mime: \"text/x-vhdl\" },\n    { title: \"Vue.js部件\", mime: \"text/x-vue\" },\n    { title: \"Web IDL\", mime: \"text/x-webidl\" },\n    { default: true, title: \"XML\", mime: \"text/xml\" },\n    { title: \"XQuery\", mime: \"application/xquery\" },\n    { title: \"xu\", mime: \"text/x-xu\" },\n    { title: \"Yacas\", mime: \"text/x-yacas\" },\n    { default: true, title: \"YAML\", mime: \"text/x-yaml\" },\n    { title: \"Z80\", mime: \"text/x-z80\" }\n];\n\nlet mimeTypes = null;\n\nfunction loadMimeTypes() {\n    mimeTypes = JSON.parse(JSON.stringify(MIME_TYPES_DICT)); // clone\n\n    const enabledMimeTypes = options.getJson('codeNotesMimeTypes')\n        || MIME_TYPES_DICT.filter(mt => mt.default).map(mt => mt.mime);\n\n    for (const mt of mimeTypes) {\n        mt.enabled = enabledMimeTypes.includes(mt.mime) || mt.mime === 'text/plain'; // text/plain is always enabled\n    }\n}\n\nasync function getMimeTypes() {\n    if (mimeTypes === null) {\n        loadMimeTypes();\n    }\n\n    return mimeTypes;\n}\n\nexport default {\n    getMimeTypes,\n    loadMimeTypes\n}\n","import TypeWidget from \"./type_widget.js\";\nimport appContext from \"../../components/app_context.js\";\nimport froca from \"../../services/froca.js\";\nimport linkService from \"../../services/link.js\";\nimport contentRenderer from \"../../services/content_renderer.js\";\nimport utils from \"../../services/utils.js\";\n\nexport default class AbstractTextTypeWidget extends TypeWidget {\n    setupImageOpening(singleClickOpens) {\n        this.$widget.on(\"dblclick\", \"img\", e => this.openImageInCurrentTab($(e.target)));\n\n        this.$widget.on(\"click\", \"img\", e => {\n            const isLeftClick = e.which === 1;\n            const isMiddleClick = e.which === 2;\n            const ctrlKey = utils.isCtrlKey(e);\n\n            if ((isLeftClick && ctrlKey) || isMiddleClick) {\n                this.openImageInNewTab($(e.target));\n            }\n            else if (isLeftClick && singleClickOpens) {\n                this.openImageInCurrentTab($(e.target));\n            }\n        });\n    }\n\n    async openImageInCurrentTab($img) {\n        const { noteId, viewScope } = await this.parseFromImage($img);\n\n        if (noteId) {\n            appContext.tabManager.getActiveContext().setNote(noteId, { viewScope });\n        } else {\n            window.open($img.prop(\"src\"), '_blank');\n        }\n    }\n\n    openImageInNewTab($img) {\n        const { noteId, viewScope } = this.parseFromImage($img);\n\n        if (noteId) {\n            appContext.tabManager.openTabWithNoteWithHoisting(noteId, { viewScope });\n        } else {\n            window.open($img.prop(\"src\"), '_blank');\n        }\n    }\n\n    async parseFromImage($img) {\n        const imgSrc = $img.prop(\"src\");\n\n        const imageNoteMatch = imgSrc.match(/\\/api\\/images\\/([A-Za-z0-9_]+)\\//);\n        if (imageNoteMatch) {\n            return {\n                noteId: imageNoteMatch[1],\n                viewScope: {}\n            }\n        }\n\n        const attachmentMatch = imgSrc.match(/\\/api\\/attachments\\/([A-Za-z0-9_]+)\\/image\\//);\n        if (attachmentMatch) {\n            const attachmentId = attachmentMatch[1];\n            const attachment = await froca.getAttachment(attachmentId);\n\n            return {\n                noteId: attachment.ownerId,\n                viewScope: {\n                    viewMode: 'attachments',\n                    attachmentId: attachmentId\n                }\n            }\n        }\n\n        return null;\n    }\n\n    async loadIncludedNote(noteId, $el) {\n        const note = await froca.getNote(noteId);\n\n        if (note) {\n            const $wrapper = $('<div class=\"include-note-wrapper\">');\n\n            const $link = await linkService.createLink(note.noteId, {\n                showTooltip: false\n            });\n\n            $wrapper.empty().append(\n                $('<h4 class=\"include-note-title\">')\n                    .append($link)\n            );\n\n            const {$renderedContent, type} = await contentRenderer.getRenderedContent(note);\n\n            $wrapper.append(\n                $(`<div class=\"include-note-content type-${type}\">`)\n                    .append($renderedContent)\n            );\n\n            $el.empty().append($wrapper);\n        }\n    }\n\n    async loadReferenceLinkTitle($el, href = null) {\n        await linkService.loadReferenceLinkTitle($el, href);\n    }\n\n    refreshIncludedNote($container, noteId) {\n        if ($container) {\n            $container.find(`section[data-note-id=\"${noteId}\"]`).each((_, el) => {\n                this.loadIncludedNote(noteId, $(el));\n            });\n        }\n    }\n}\n","import libraryLoader from \"../../services/library_loader.js\";\nimport noteAutocompleteService from '../../services/note_autocomplete.js';\nimport mimeTypesService from '../../services/mime_types.js';\nimport utils from \"../../services/utils.js\";\nimport keyboardActionService from \"../../services/keyboard_actions.js\";\nimport froca from \"../../services/froca.js\";\nimport noteCreateService from \"../../services/note_create.js\";\nimport AbstractTextTypeWidget from \"./abstract_text_type_widget.js\";\nimport link from \"../../services/link.js\";\nimport appContext from \"../../components/app_context.js\";\nimport dialogService from \"../../services/dialog.js\";\n\nconst ENABLE_INSPECTOR = false;\n\nconst mentionSetup = {\n    feeds: [\n        {\n            marker: '@',\n            feed: queryText => noteAutocompleteService.autocompleteSourceForCKEditor(queryText),\n            itemRenderer: item => {\n                const itemElement = document.createElement('button');\n\n                itemElement.innerHTML = `${item.highlightedNotePathTitle} `;\n\n                return itemElement;\n            },\n            minimumCharacters: 0\n        }\n    ]\n};\n\nconst TPL = `\n<div class=\"note-detail-editable-text note-detail-printable\">\n    <style>\n    .note-detail-editable-text {\n        font-family: var(--detail-font-family);\n        padding-left: 14px;\n        padding-top: 10px;\n        height: 100%;\n    }\n    \n    body.mobile .note-detail-editable-text {\n        padding-left: 4px;\n    }\n    \n    .note-detail-editable-text a:hover {\n        cursor: pointer;\n    }\n    \n    .note-detail-editable-text a[href^=\"http://\"], .note-detail-editable-text a[href^=\"https://\"] {\n        cursor: text !important;\n    }\n    \n    .note-detail-editable-text *:not(figure,.include-note):first-child {\n        margin-top: 0 !important;\n    }\n         \n    .note-detail-editable-text h2 { font-size: 1.6em; } \n    .note-detail-editable-text h3 { font-size: 1.4em; }\n    .note-detail-editable-text h4 { font-size: 1.2em; }\n    .note-detail-editable-text h5 { font-size: 1.1em; }\n    .note-detail-editable-text h6 { font-size: 1.0em; }\n    \n    body.heading-style-markdown .note-detail-editable-text h2::before { content: \"##\\\\2004\"; color: var(--muted-text-color); }\n    body.heading-style-markdown .note-detail-editable-text h3::before { content: \"###\\\\2004\"; color: var(--muted-text-color); }\n    body.heading-style-markdown .note-detail-editable-text h4:not(.include-note-title)::before { content: \"####\\\\2004\"; color: var(--muted-text-color); }\n    body.heading-style-markdown .note-detail-editable-text h5::before { content: \"#####\\\\2004\"; color: var(--muted-text-color); }\n    body.heading-style-markdown .note-detail-editable-text h6::before { content: \"######\\\\2004\"; color: var(--muted-text-color); }\n    \n    body.heading-style-underline .note-detail-editable-text h2 { border-bottom: 1px solid var(--main-border-color); }\n    body.heading-style-underline .note-detail-editable-text h3 { border-bottom: 1px solid var(--main-border-color); }\n    body.heading-style-underline .note-detail-editable-text h4:not(.include-note-title) { border-bottom: 1px solid var(--main-border-color); }\n    body.heading-style-underline .note-detail-editable-text h5 { border-bottom: 1px solid var(--main-border-color); }\n    body.heading-style-underline .note-detail-editable-text h6 { border-bottom: 1px solid var(--main-border-color); }\n    \n    .note-detail-editable-text-editor {\n        padding-top: 10px;\n        border: 0 !important;\n        box-shadow: none !important;\n        min-height: 50px;\n        height: 100%;\n    }\n    </style>\n\n    <div class=\"note-detail-editable-text-editor\" tabindex=\"300\"></div>\n</div>\n`;\n\nexport default class EditableTextTypeWidget extends AbstractTextTypeWidget {\n    static getType() { return \"editableText\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$editor = this.$widget.find('.note-detail-editable-text-editor');\n\n        this.initialized = this.initEditor();\n\n        keyboardActionService.setupActionsForElement('text-detail', this.$widget, this);\n\n        this.setupImageOpening(false);\n\n        super.doRender();\n    }\n\n    async initEditor() {\n        await libraryLoader.requireLibrary(libraryLoader.CKEDITOR);\n\n        const codeBlockLanguages =\n            (await mimeTypesService.getMimeTypes())\n                .filter(mt => mt.enabled)\n                .map(mt => ({\n                        language: mt.mime.toLowerCase().replace(/[\\W_]+/g,\"-\"),\n                        label: mt.title\n                    }));\n\n        // CKEditor since version 12 needs the element to be visible before initialization. At the same time,\n        // we want to avoid flicker - i.e., show editor only once everything is ready. That's why we have separate\n        // display of $widget in both branches.\n        this.$widget.show();\n\n        this.watchdog = new EditorWatchdog(BalloonEditor, {\n            // An average number of milliseconds between the last editor errors (defaults to 5000).\n            // When the period of time between errors is lower than that and the crashNumberLimit\n            // is also reached, the watchdog changes its state to crashedPermanently, and it stops\n            // restarting the editor. This prevents an infinite restart loop.\n            minimumNonErrorTimePeriod: 5000,\n            // A threshold specifying the number of errors (defaults to 3).\n            // After this limit is reached and the time between last errors\n            // is shorter than minimumNonErrorTimePeriod, the watchdog changes\n            // its state to crashedPermanently, and it stops restarting the editor.\n            // This prevents an infinite restart loop.\n            crashNumberLimit: 3,\n            // A minimum number of milliseconds between saving the editor data internally (defaults to 5000).\n            // Note that for large documents, this might impact the editor performance.\n            saveInterval: 5000\n        });\n\n        this.watchdog.on('stateChange', () => {\n            const currentState = this.watchdog.state;\n\n            if (!['crashed', 'crashedPermanently'].includes(currentState)) {\n                return;\n            }\n\n            console.log(`CKEditor changed to ${currentState}`);\n\n            this.watchdog.crashes.forEach(crashInfo => console.log(crashInfo));\n\n            if (currentState === 'crashedPermanently') {\n                dialogService.info(`Editing component keeps crashing. Please try restarting Trilium. If problem persists, consider creating a bug report.`);\n\n                this.watchdog.editor.enableReadOnlyMode('crashed-editor');\n            }\n        });\n\n        this.watchdog.setCreator(async (elementOrData, editorConfig) => {\n            const editor = await BalloonEditor.create(elementOrData, editorConfig);\n\n            editor.model.document.on('change:data', () => this.spacedUpdate.scheduleUpdate());\n\n            if (glob.isDev && ENABLE_INSPECTOR) {\n                await import(/* webpackIgnore: true */'../../../libraries/ckeditor/inspector.js');\n                CKEditorInspector.attach(editor);\n            }\n\n            return editor;\n        });\n\n        await this.watchdog.create(this.$editor[0], {\n            placeholder: \"在这里输入笔记内容\",\n            mention: mentionSetup,\n            codeBlock: {\n                languages: codeBlockLanguages\n            },\n            math: {\n                engine: 'katex',\n                outputType: 'span', // or script\n                lazyLoad: async () => await libraryLoader.requireLibrary(libraryLoader.KATEX),\n                forceOutputType: false, // forces output to use outputType\n                enablePreview: true // Enable preview view\n            }\n        });\n    }\n\n    async doRefresh(note) {\n        const blob = await note.getBlob();\n\n        await this.spacedUpdate.allowUpdateWithoutChange(() =>\n            this.watchdog.editor.setData(blob.content || \"\"));\n    }\n\n    getData() {\n        const content = this.watchdog.editor.getData();\n\n        // if content is only tags/whitespace (typically <p>&nbsp;</p>), then just make it empty,\n        // this is important when setting a new note to code\n        return {\n            content: utils.isHtmlEmpty(content) ? '' : content\n        };\n    }\n\n    focus() {\n        this.$editor.trigger('focus');\n    }\n\n    scrollToEnd() {\n        this.watchdog?.editor.model.change(writer => {\n            writer.setSelection(writer.createPositionAt(this.watchdog?.editor.model.document.getRoot(), 'end'));\n        });\n\n        this.watchdog?.editor.editing.view.focus();\n    }\n\n    show() {}\n\n    getEditor() {\n        return this.watchdog?.editor;\n    }\n\n    cleanup() {\n        if (this.watchdog?.editor) {\n            this.spacedUpdate.allowUpdateWithoutChange(() => {\n                this.watchdog.editor.setData('');\n            });\n        }\n    }\n\n    insertDateTimeToTextCommand() {\n        const date = new Date();\n        const dateString = utils.formatDateTime(date);\n\n        this.addTextToEditor(dateString);\n    }\n\n    async addLinkToEditor(linkHref, linkTitle) {\n        await this.initialized;\n\n        this.watchdog.editor.model.change(writer => {\n            const insertPosition = this.watchdog.editor.model.document.selection.getFirstPosition();\n            writer.insertText(linkTitle, {linkHref: linkHref}, insertPosition);\n        });\n    }\n\n    async addTextToEditor(text) {\n        await this.initialized;\n\n        this.watchdog.editor.model.change(writer => {\n            const insertPosition = this.watchdog.editor.model.document.selection.getLastPosition();\n            writer.insertText(text, insertPosition);\n        });\n    }\n\n    addTextToActiveEditorEvent({text}) {\n        if (!this.isActive()) {\n            return;\n        }\n\n        this.addTextToEditor(text);\n    }\n\n    async addLink(notePath, linkTitle) {\n        await this.initialized;\n\n        if (linkTitle) {\n            if (this.hasSelection()) {\n                this.watchdog.editor.execute('link', `#${notePath}`);\n            } else {\n                await this.addLinkToEditor(`#${notePath}`, linkTitle);\n            }\n        }\n        else {\n            this.watchdog.editor.execute('referenceLink', { href: '#' + notePath });\n        }\n\n        this.watchdog.editor.editing.view.focus();\n    }\n\n    // returns true if user selected some text, false if there's no selection\n    hasSelection() {\n        const model = this.watchdog.editor.model;\n        const selection = model.document.selection;\n\n        return !selection.isCollapsed;\n    }\n\n    async executeWithTextEditorEvent({callback, resolve, ntxId}) {\n        if (!this.isNoteContext(ntxId)) {\n            return;\n        }\n\n        await this.initialized;\n\n        if (callback) {\n            callback(this.watchdog.editor);\n        }\n\n        resolve(this.watchdog.editor);\n    }\n\n    addLinkToTextCommand() {\n        const selectedText = this.getSelectedText();\n\n        this.triggerCommand('showAddLinkDialog', {textTypeWidget: this, text: selectedText})\n    }\n\n    getSelectedText() {\n        const range = this.watchdog.editor.model.document.selection.getFirstRange();\n        let text = '';\n\n        for (const item of range.getItems()) {\n            if (item.data) {\n                text += item.data;\n            }\n        }\n\n        return text;\n    }\n\n    async followLinkUnderCursorCommand() {\n        await this.initialized;\n\n        const selection = this.watchdog.editor.model.document.selection;\n        const selectedElement = selection.getSelectedElement();\n\n        if (selectedElement?.name === 'reference') {\n            // reference link\n            const notePath = selectedElement.getAttribute('notePath');\n\n            if (notePath) {\n                await appContext.tabManager.getActiveContext().setNote(notePath);\n                return;\n            }\n        }\n\n        if (!selection.hasAttribute('linkHref')) {\n            return;\n        }\n\n        const selectedLinkUrl = selection.getAttribute('linkHref');\n        const notePath = link.getNotePathFromUrl(selectedLinkUrl);\n\n        if (notePath) {\n            await appContext.tabManager.getActiveContext().setNote(notePath);\n        } else {\n            window.open(selectedLinkUrl, '_blank');\n        }\n    }\n\n    addIncludeNoteToTextCommand() {\n        this.triggerCommand(\"showIncludeNoteDialog\", {textTypeWidget: this});\n    }\n\n    addIncludeNote(noteId, boxSize) {\n        this.watchdog.editor.model.change( writer => {\n            // Insert <includeNote>*</includeNote> at the current selection position\n            // in a way that will result in creating a valid model structure\n            this.watchdog.editor.model.insertContent(writer.createElement('includeNote', {\n                noteId: noteId,\n                boxSize: boxSize\n            }));\n        } );\n    }\n\n    async addImage(noteId) {\n        const note = await froca.getNote(noteId);\n\n        this.watchdog.editor.model.change( writer => {\n            const encodedTitle = encodeURIComponent(note.title);\n            const src = `api/images/${note.noteId}/${encodedTitle}`;\n\n            this.watchdog.editor.execute( 'insertImage', { source: src } );\n        } );\n    }\n\n    async createNoteForReferenceLink(title) {\n        const resp = await noteCreateService.createNoteWithTypePrompt(this.notePath, {\n            activate: false,\n            title: title\n        });\n\n        if (!resp) {\n            return;\n        }\n\n        return resp.note.getBestNotePathString();\n    }\n\n    async refreshIncludedNoteEvent({noteId}) {\n        this.refreshIncludedNote(this.$editor, noteId);\n    }\n}\n","import toastService from \"./toast.js\";\n\nfunction copyImageReferenceToClipboard($imageWrapper) {\n    try {\n        $imageWrapper.attr('contenteditable', 'true');\n        selectImage($imageWrapper.get(0));\n\n        const success = document.execCommand('copy');\n\n        if (success) {\n            toastService.showMessage(\"Image copied to the clipboard\");\n        } else {\n            toastService.showAndLogError(\"Could not copy the image to clipboard.\");\n        }\n    }\n    finally {\n        window.getSelection().removeAllRanges();\n        $imageWrapper.removeAttr('contenteditable');\n    }\n}\n\nfunction selectImage(element) {\n    const selection = window.getSelection();\n    const range = document.createRange();\n    range.selectNodeContents(element);\n    selection.removeAllRanges();\n    selection.addRange(range);\n}\n\nexport default {\n    copyImageReferenceToClipboard\n};\n","import server from \"./server.js\";\n\n/**\n * @param $el - element on which to init autocomplete\n * @param attributeType - \"relation\" or \"label\" or callback providing one of those values as a type of autocompleted attributes\n * @param open - should the autocomplete be opened after init?\n */\nfunction initAttributeNameAutocomplete({ $el, attributeType, open }) {\n    if (!$el.hasClass(\"aa-input\")) {\n        $el.autocomplete({\n            appendTo: document.querySelector('body'),\n            hint: false,\n            openOnFocus: true,\n            minLength: 0,\n            tabAutocomplete: false\n        }, [{\n            displayKey: 'name',\n            // disabling cache is important here because otherwise cache can stay intact when switching between attribute type which will lead to autocomplete displaying attribute names for incorrect attribute type\n            cache: false,\n            source: async (term, cb) => {\n                const type = typeof attributeType === \"function\" ? attributeType() : attributeType;\n\n                const names = await server.get(`attribute-names/?type=${type}&query=${encodeURIComponent(term)}`);\n                const result = names.map(name => ({name}));\n\n                cb(result);\n            }\n        }]);\n\n        $el.on('autocomplete:opened', () => {\n            if ($el.attr(\"readonly\")) {\n                $el.autocomplete('close');\n            }\n        });\n    }\n\n    if (open) {\n        $el.autocomplete(\"open\");\n    }\n}\n\nasync function initLabelValueAutocomplete({ $el, open, nameCallback }) {\n    if ($el.hasClass(\"aa-input\")) {\n        // we reinit every time because autocomplete seems to have a bug where it retains state from last\n        // open even though the value was reset\n        $el.autocomplete('destroy');\n    }\n\n    const attributeName = nameCallback();\n\n    if (attributeName.trim() === \"\") {\n        return;\n    }\n\n    const attributeValues = (await server.get(`attribute-values/${encodeURIComponent(attributeName)}`))\n        .map(attribute => ({ value: attribute }));\n\n    if (attributeValues.length === 0) {\n        return;\n    }\n\n    $el.autocomplete({\n        appendTo: document.querySelector('body'),\n        hint: false,\n        openOnFocus: false, // handled manually\n        minLength: 0,\n        tabAutocomplete: false\n    }, [{\n        displayKey: 'value',\n        cache: false,\n        source: async function (term, cb) {\n            term = term.toLowerCase();\n\n            const filtered = attributeValues.filter(attr => attr.value.toLowerCase().includes(term));\n\n            cb(filtered);\n        }\n    }]);\n\n    $el.on('autocomplete:opened', () => {\n        if ($el.attr(\"readonly\")) {\n            $el.autocomplete('close');\n        }\n    });\n\n    if (open) {\n        $el.autocomplete(\"open\");\n    }\n}\n\nexport default {\n    initAttributeNameAutocomplete,\n    initLabelValueAutocomplete\n}\n","import server from \"../../services/server.js\";\nimport linkService from \"../../services/link.js\";\nimport libraryLoader from \"../../services/library_loader.js\";\nimport contextMenu from \"../../menus/context_menu.js\";\nimport toastService from \"../../services/toast.js\";\nimport attributeAutocompleteService from \"../../services/attribute_autocomplete.js\";\nimport TypeWidget from \"./type_widget.js\";\nimport appContext from \"../../components/app_context.js\";\nimport utils from \"../../services/utils.js\";\nimport froca from \"../../services/froca.js\";\nimport dialogService from \"../../services/dialog.js\";\n\nconst uniDirectionalOverlays = [\n    [ \"Arrow\", {\n        location: 1,\n        id: \"arrow\",\n        length: 14,\n        foldback: 0.8\n    } ],\n    [ \"Label\", { label: \"\", id: \"label\", cssClass: \"connection-label\" }]\n];\n\nconst biDirectionalOverlays = [\n    [ \"Arrow\", {\n        location: 1,\n        id: \"arrow\",\n        length: 14,\n        foldback: 0.8\n    } ],\n    [ \"Label\", { label: \"\", id: \"label\", cssClass: \"connection-label\" }],\n    [ \"Arrow\", {\n        location: 0,\n        id: \"arrow2\",\n        length: 14,\n        direction: -1,\n        foldback: 0.8\n    } ]\n];\n\nconst inverseRelationsOverlays = [\n    [ \"Arrow\", {\n        location: 1,\n        id: \"arrow\",\n        length: 14,\n        foldback: 0.8\n    } ],\n    [ \"Label\", { label: \"\", location: 0.2, id: \"label-source\", cssClass: \"connection-label\" }],\n    [ \"Label\", { label: \"\", location: 0.8, id: \"label-target\", cssClass: \"connection-label\" }],\n    [ \"Arrow\", {\n        location: 0,\n        id: \"arrow2\",\n        length: 14,\n        direction: -1,\n        foldback: 0.8\n    } ]\n];\n\nconst linkOverlays = [\n    [ \"Arrow\", {\n        location: 1,\n        id: \"arrow\",\n        length: 14,\n        foldback: 0.8\n    } ]\n];\n\nconst TPL = `\n<div class=\"note-detail-relation-map note-detail-printable\">\n    <div class=\"relation-map-wrapper\">\n       <div class=\"relation-map-container\"></div>\n    </div>\n</div>`;\n\nlet containerCounter = 1;\n\nexport default class RelationMapTypeWidget extends TypeWidget {\n    static getType() { return \"relationMap\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$relationMapContainer = this.$widget.find(\".relation-map-container\");\n\n        this.mapData = null;\n        this.jsPlumbInstance = null;\n        // outside of mapData because they are not persisted in the note content\n        this.relations = null;\n        this.pzInstance = null;\n\n        this.$relationMapWrapper = this.$widget.find('.relation-map-wrapper');\n        this.$relationMapWrapper.on('click', event => {\n            if (this.clipboard) {\n                let {x, y} = this.getMousePosition(event);\n\n                // modifying position so that the cursor is on the top-center of the box\n                x -= 80;\n                y -= 15;\n\n                this.createNoteBox(this.clipboard.noteId, this.clipboard.title, x, y);\n\n                this.mapData.notes.push({ noteId: this.clipboard.noteId, x, y });\n\n                this.saveData();\n\n                this.clipboard = null;\n            }\n\n            return true;\n        });\n\n        this.$relationMapContainer.attr(\"id\", \"relation-map-container-\" + (containerCounter++));\n        this.$relationMapContainer.on(\"contextmenu\", \".note-box\", e => {\n            contextMenu.show({\n                x: e.pageX,\n                y: e.pageY,\n                items: [\n                    {title: \"在新标签页中打开\", command: \"openInNewTab\", uiIcon: \"bx bx-empty\"},\n                    {title: \"删除笔记\", command: \"remove\", uiIcon: \"bx bx-trash\"},\n                    {title: \"编辑标题\", command: \"editTitle\", uiIcon: \"bx bx-pencil\"},\n                ],\n                selectMenuItemHandler: ({command}) => this.contextMenuHandler(command, e.target)\n            });\n\n            return false; // blocks default browser right click menu\n        });\n\n        this.clipboard = null;\n\n        this.$widget.on(\"drop\", ev => this.dropNoteOntoRelationMapHandler(ev));\n        this.$widget.on(\"dragover\", ev => ev.preventDefault());\n\n        this.initialized = new Promise(async res => {\n            await libraryLoader.requireLibrary(libraryLoader.RELATION_MAP);\n\n            jsPlumb.ready(res);\n        });\n\n        super.doRender();\n    }\n\n    async contextMenuHandler(command, originalTarget) {\n        const $noteBox = $(originalTarget).closest(\".note-box\");\n        const $title = $noteBox.find(\".title a\");\n        const noteId = this.idToNoteId($noteBox.prop(\"id\"));\n\n        if (command === \"openInNewTab\") {\n            appContext.tabManager.openTabWithNoteWithHoisting(noteId);\n        }\n        else if (command === \"remove\") {\n            const result = await dialogService.confirmDeleteNoteBoxWithNote($title.text());\n\n            if (!result.confirmed) {\n                return;\n            }\n\n            this.jsPlumbInstance.remove(this.noteIdToId(noteId));\n\n            if (result.isDeleteNoteChecked) {\n                const taskId = utils.randomString(10);\n\n                await server.remove(`notes/${noteId}?taskId=${taskId}&last=true`);\n            }\n\n            this.mapData.notes = this.mapData.notes.filter(note => note.noteId !== noteId);\n\n            this.relations = this.relations.filter(relation => relation.sourceNoteId !== noteId && relation.targetNoteId !== noteId);\n\n            this.saveData();\n        }\n        else if (command === \"editTitle\") {\n            const title = await dialogService.prompt({\n                title: \"重命名笔记\",\n                message: \"输入新的笔记标题:\",\n                defaultValue: $title.text()\n            });\n\n            if (!title) {\n                return;\n            }\n\n            await server.put(`notes/${noteId}/title`, { title });\n\n            $title.text(title);\n        }\n    }\n\n    async loadMapData() {\n        this.mapData = {\n            notes: [],\n            // it is important to have this exact value here so that initial transform is the same as this\n            // which will guarantee note won't be saved on first conversion to the relation map note type\n            // this keeps the principle that note type change doesn't destroy note content unless user\n            // does some actual change\n            transform: {\n                x: 0,\n                y: 0,\n                scale: 1\n            }\n        };\n\n        const blob = await this.note.getBlob();\n\n        if (blob.content) {\n            try {\n                this.mapData = JSON.parse(blob.content);\n            } catch (e) {\n                console.log(\"Could not parse content: \", e);\n            }\n        }\n    }\n\n    noteIdToId(noteId) {\n        return `rel-map-note-${noteId}`;\n    }\n\n    idToNoteId(id) {\n        return id.substr(13);\n    }\n\n    async doRefresh(note) {\n        await this.loadMapData();\n\n        this.initJsPlumbInstance();\n\n        this.initPanZoom();\n\n        this.loadNotesAndRelations();\n    }\n\n    clearMap() {\n        // delete all endpoints and connections\n        // this is done at this point (after async operations) to reduce flicker to the minimum\n        this.jsPlumbInstance.deleteEveryEndpoint();\n\n        // without this, we still end up with note boxes remaining in the canvas\n        this.$relationMapContainer.empty();\n    }\n\n    async loadNotesAndRelations() {\n        const noteIds = this.mapData.notes.map(note => note.noteId);\n        const data = await server.post(\"relation-map\", {noteIds, relationMapNoteId: this.noteId});\n\n        this.relations = [];\n\n        for (const relation of data.relations) {\n            const match = this.relations.find(rel =>\n                rel.name === data.inverseRelations[relation.name]\n                && ((rel.sourceNoteId === relation.sourceNoteId && rel.targetNoteId === relation.targetNoteId)\n                || (rel.sourceNoteId === relation.targetNoteId && rel.targetNoteId === relation.sourceNoteId)));\n\n            if (match) {\n                match.type = relation.type = relation.name === data.inverseRelations[relation.name] ? 'biDirectional' : 'inverse';\n                relation.render = false; // don't render second relation\n            } else {\n                relation.type = 'uniDirectional';\n                relation.render = true;\n            }\n\n            this.relations.push(relation);\n        }\n\n        this.mapData.notes = this.mapData.notes.filter(note => note.noteId in data.noteTitles);\n\n        this.jsPlumbInstance.batch(async () => {\n            this.clearMap();\n\n            for (const note of this.mapData.notes) {\n                const title = data.noteTitles[note.noteId];\n\n                await this.createNoteBox(note.noteId, title, note.x, note.y);\n            }\n\n            for (const relation of this.relations) {\n                if (!relation.render) {\n                    continue;\n                }\n\n                const connection = this.jsPlumbInstance.connect({\n                    source: this.noteIdToId(relation.sourceNoteId),\n                    target: this.noteIdToId(relation.targetNoteId),\n                    type: relation.type\n                });\n\n                connection.id = relation.attributeId;\n\n                if (relation.type === 'inverse') {\n                    connection.getOverlay(\"label-source\").setLabel(relation.name);\n                    connection.getOverlay(\"label-target\").setLabel(data.inverseRelations[relation.name]);\n                }\n                else {\n                    connection.getOverlay(\"label\").setLabel(relation.name);\n                }\n\n                connection.canvas.setAttribute(\"data-connection-id\", connection.id);\n            }\n        });\n    }\n\n    initPanZoom() {\n        if (this.pzInstance) {\n            return;\n        }\n\n        this.pzInstance = panzoom(this.$relationMapContainer[0], {\n            maxZoom: 2,\n            minZoom: 0.3,\n            smoothScroll: false,\n            filterKey: function(e, dx, dy, dz) {\n                // if ALT is pressed, then panzoom should bubble the event up\n                // this is to preserve ALT-LEFT, ALT-RIGHT navigation working\n                return e.altKey;\n            }\n        });\n\n        this.pzInstance.on('transform', () => { // gets triggered on any transform change\n            this.jsPlumbInstance.setZoom(this.getZoom());\n\n            this.saveCurrentTransform();\n        });\n\n        if (this.mapData.transform) {\n            this.pzInstance.zoomTo(0, 0, this.mapData.transform.scale);\n\n            this.pzInstance.moveTo(this.mapData.transform.x, this.mapData.transform.y);\n        }\n        else {\n            // set to initial coordinates\n            this.pzInstance.moveTo(0, 0);\n        }\n    }\n\n    saveCurrentTransform() {\n        const newTransform = this.pzInstance.getTransform();\n\n        if (JSON.stringify(newTransform) !== JSON.stringify(this.mapData.transform)) {\n            // clone transform object\n            this.mapData.transform = JSON.parse(JSON.stringify(newTransform));\n\n            this.saveData();\n        }\n    }\n\n    cleanup() {\n        if (this.jsPlumbInstance) {\n            this.clearMap();\n        }\n\n        if (this.pzInstance) {\n            this.pzInstance.dispose();\n            this.pzInstance = null;\n        }\n    }\n\n    initJsPlumbInstance () {\n        if (this.jsPlumbInstance) {\n            this.cleanup();\n\n            return;\n        }\n\n        this.jsPlumbInstance = jsPlumb.getInstance({\n            Endpoint: [\"Dot\", {radius: 2}],\n            Connector: \"StateMachine\",\n            ConnectionOverlays: uniDirectionalOverlays,\n            HoverPaintStyle: { stroke: \"#777\", strokeWidth: 1 },\n            Container: this.$relationMapContainer.attr(\"id\")\n        });\n\n        this.jsPlumbInstance.registerConnectionType(\"uniDirectional\", { anchor:\"Continuous\", connector:\"StateMachine\", overlays: uniDirectionalOverlays });\n\n        this.jsPlumbInstance.registerConnectionType(\"biDirectional\", { anchor:\"Continuous\", connector:\"StateMachine\", overlays: biDirectionalOverlays });\n\n        this.jsPlumbInstance.registerConnectionType(\"inverse\", { anchor:\"Continuous\", connector:\"StateMachine\", overlays: inverseRelationsOverlays });\n\n        this.jsPlumbInstance.registerConnectionType(\"link\", { anchor:\"Continuous\", connector:\"StateMachine\", overlays: linkOverlays });\n\n        this.jsPlumbInstance.bind(\"connection\", (info, originalEvent) => this.connectionCreatedHandler(info, originalEvent));\n    }\n\n    async connectionCreatedHandler(info, originalEvent) {\n        const connection = info.connection;\n\n        connection.bind(\"contextmenu\", (obj, event) => {\n            if (connection.getType().includes(\"link\")) {\n                // don't create context menu if it's a link since there's nothing to do with link from relation map\n                // (don't open browser menu either)\n                event.preventDefault();\n            }\n            else {\n                event.preventDefault();\n                event.stopPropagation();\n\n                contextMenu.show({\n                    x: event.pageX,\n                    y: event.pageY,\n                    items: [ {title: \"删除关系\", command: \"remove\", uiIcon: \"bx bx-trash\"} ],\n                    selectMenuItemHandler: async ({command}) => {\n                        if (command === 'remove') {\n                            if (!await dialogService.confirm(\"确定要删除这个关系吗?\")) {\n                                return;\n                            }\n\n                            const relation = this.relations.find(rel => rel.attributeId === connection.id);\n\n                            await server.remove(`notes/${relation.sourceNoteId}/relations/${relation.name}/to/${relation.targetNoteId}`);\n\n                            this.jsPlumbInstance.deleteConnection(connection);\n\n                            this.relations = this.relations.filter(relation => relation.attributeId !== connection.id);\n                        }\n                    }\n                });\n            }\n        });\n\n        // if there's no event, then this has been triggered programmatically\n        if (!originalEvent) {\n            return;\n        }\n\n        let name = await dialogService.prompt({\n            message: \"指定新的关系名称(允许的字符: 字母数字,冒号和下划线):\",\n            shown: ({ $answer }) => {\n                $answer.on('keyup', () => {\n                    // invalid characters are simply ignored (from user perspective they are not even entered)\n                    const attrName = utils.filterAttributeName($answer.val());\n\n                    $answer.val(attrName);\n                });\n\n                attributeAutocompleteService.initAttributeNameAutocomplete({\n                    $el: $answer,\n                    attributeType: \"relation\",\n                    open: true\n                });\n            }\n        });\n\n        if (!name || !name.trim()) {\n            this.jsPlumbInstance.deleteConnection(connection);\n\n            return;\n        }\n\n        name = utils.filterAttributeName(name);\n\n        const targetNoteId = this.idToNoteId(connection.target.id);\n        const sourceNoteId = this.idToNoteId(connection.source.id);\n\n        const relationExists = this.relations.some(rel =>\n            rel.targetNoteId === targetNoteId\n            && rel.sourceNoteId === sourceNoteId\n            && rel.name === name);\n\n        if (relationExists) {\n            await dialogService.info(`Connection '${name}' between these notes already exists.`);\n\n            this.jsPlumbInstance.deleteConnection(connection);\n\n            return;\n        }\n\n        await server.put(`notes/${sourceNoteId}/relations/${name}/to/${targetNoteId}`);\n\n        this.loadNotesAndRelations();\n    }\n\n    saveData() {\n        this.spacedUpdate.scheduleUpdate();\n    }\n\n    async createNoteBox(noteId, title, x, y) {\n        const $link = await linkService.createLink(noteId, {title});\n        $link.mousedown(e => linkService.goToLink(e));\n\n        const note = await froca.getNote(noteId);\n\n        const $noteBox = $(\"<div>\")\n            .addClass(\"note-box\")\n            .addClass(note.getCssClass())\n            .prop(\"id\", this.noteIdToId(noteId))\n            .append($(\"<span>\").addClass(\"title\").append($link))\n            .append($(\"<div>\").addClass(\"endpoint\").attr(\"title\", \"从这里拖拽到别的笔记来创建关系.\"))\n            .css(\"left\", `${x}px`)\n            .css(\"top\", `${y}px`);\n\n        this.jsPlumbInstance.getContainer().appendChild($noteBox[0]);\n\n        this.jsPlumbInstance.draggable($noteBox[0], {\n            start: params => {},\n            drag: params => {},\n            stop: params => {\n                const noteId = this.idToNoteId(params.el.id);\n\n                const note = this.mapData.notes.find(note => note.noteId === noteId);\n\n                if (!note) {\n                    logError(`笔记 ${noteId} 未找到!`);\n                    return;\n                }\n\n                [note.x, note.y] = params.finalPos;\n\n                this.saveData();\n            }\n        });\n\n        this.jsPlumbInstance.makeSource($noteBox[0], {\n            filter: \".endpoint\",\n            anchor: \"Continuous\",\n            connectorStyle: { stroke: \"#000\", strokeWidth: 1 },\n            connectionType: \"basic\",\n            extract:{\n                \"action\": \"the-action\"\n            }\n        });\n\n        this.jsPlumbInstance.makeTarget($noteBox[0], {\n            dropOptions: { hoverClass: \"dragHover\" },\n            anchor: \"Continuous\",\n            allowLoopback: true\n        });\n    }\n\n    getZoom() {\n        const matrixRegex = /matrix\\((-?\\d*\\.?\\d+),\\s*0,\\s*0,\\s*-?\\d*\\.?\\d+,\\s*-?\\d*\\.?\\d+,\\s*-?\\d*\\.?\\d+\\)/;\n\n        const transform = this.$relationMapContainer.css('transform');\n\n        if (transform === 'none') {\n            return 1;\n        }\n\n        const matches = transform.match(matrixRegex);\n\n        if (!matches) {\n            throw new Error(`Cannot match transform: ${transform}`);\n        }\n\n        return matches[1];\n    }\n\n    async dropNoteOntoRelationMapHandler(ev) {\n        ev.preventDefault();\n\n        const notes = JSON.parse(ev.originalEvent.dataTransfer.getData(\"text\"));\n\n        let {x, y} = this.getMousePosition(ev);\n\n        for (const note of notes) {\n            const exists = this.mapData.notes.some(n => n.noteId === note.noteId);\n\n            if (exists) {\n                toastService.showError(`笔记 \"${note.title}\" 已经在图中.`);\n\n                continue;\n            }\n\n            this.mapData.notes.push({noteId: note.noteId, x, y});\n\n            if (x > 1000) {\n                y += 100;\n                x = 0;\n            }\n            else {\n                x += 200;\n            }\n        }\n\n        this.saveData();\n\n        this.loadNotesAndRelations();\n    }\n\n    getMousePosition(evt) {\n        const rect = this.$relationMapContainer[0].getBoundingClientRect();\n\n        const zoom = this.getZoom();\n\n        return {\n            x: (evt.clientX - rect.left) / zoom,\n            y: (evt.clientY - rect.top) / zoom\n        };\n    }\n\n    getData() {\n        return {\n            content: JSON.stringify(this.mapData)\n        };\n    }\n\n    async relationMapCreateChildNoteEvent({ntxId}) {\n        if (!this.isNoteContext(ntxId)) {\n            return;\n        }\n\n        const title = await dialogService.prompt({ message: \"输入新笔记的标题\",  defaultValue: \"新建笔记\" });\n\n        if (!title.trim()) {\n            return;\n        }\n\n        const {note} = await server.post(`notes/${this.noteId}/children?target=into`, {\n            title,\n            content: '',\n            type: 'text'\n        });\n\n        toastService.showMessage(\"在画布上单击以放置新笔记\");\n\n        this.clipboard = { noteId: note.noteId, title };\n    }\n\n    relationMapResetPanZoomEvent({ntxId}) {\n        if (!this.isNoteContext(ntxId)) {\n            return;\n        }\n\n        // reset to initial pan & zoom state\n        this.pzInstance.zoomTo(0, 0, 1 / this.getZoom());\n        this.pzInstance.moveTo(0, 0);\n    }\n\n    relationMapResetZoomInEvent({ntxId}) {\n        if (!this.isNoteContext(ntxId)) {\n            return;\n        }\n\n        this.pzInstance.zoomTo(0, 0, 1.2);\n    }\n\n    relationMapResetZoomOutEvent({ntxId}) {\n        if (!this.isNoteContext(ntxId)) {\n            return;\n        }\n\n        this.pzInstance.zoomTo(0, 0, 0.8);\n    }\n}\n","/**\n * Returns a function, that, as long as it continues to be invoked, will not\n * be triggered. The function will be called after it stops being called for\n * N milliseconds. If `immediate` is passed, trigger the function on the\n * leading edge, instead of the trailing. The function also has a property 'clear'\n * that is a function which will clear the timer to prevent previously scheduled executions.\n *\n * @source underscore.js\n * @see http://unscriptable.com/2009/03/20/debouncing-javascript-methods/\n * @param {Function} func to wrap\n * @param {Number} waitMs in ms (`100`)\n * @param {Boolean} [immediate=false] whether to execute at the beginning (`false`)\n * @api public\n */\nfunction debounce(func, waitMs, immediate = false) {\n    let timeout, args, context, timestamp, result;\n    if (null == waitMs) waitMs = 100;\n\n    function later() {\n        const last = Date.now() - timestamp;\n\n        if (last < waitMs && last >= 0) {\n            timeout = setTimeout(later, waitMs - last);\n        } else {\n            timeout = null;\n            if (!immediate) {\n                result = func.apply(context, args);\n                context = args = null;\n            }\n        }\n    }\n\n    const debounced = function () {\n        context = this;\n        args = arguments;\n        timestamp = Date.now();\n        const callNow = immediate && !timeout;\n        if (!timeout) timeout = setTimeout(later, waitMs);\n        if (callNow) {\n            result = func.apply(context, args);\n            context = args = null;\n        }\n\n        return result;\n    };\n\n    debounced.clear = function() {\n        if (timeout) {\n            clearTimeout(timeout);\n            timeout = null;\n        }\n    };\n\n    debounced.flush = function() {\n        if (timeout) {\n            result = func.apply(context, args);\n            context = args = null;\n\n            clearTimeout(timeout);\n            timeout = null;\n        }\n    };\n\n    return debounced;\n}\n\n// Adds compatibility for ES modules\ndebounce.debounce = debounce;\n\nexport default debounce;\n","import libraryLoader from \"../../services/library_loader.js\";\nimport TypeWidget from \"./type_widget.js\";\nimport utils from '../../services/utils.js';\nimport linkService from '../../services/link.js';\nimport debounce from \"../../services/debounce.js\";\n\nconst {sleep} = utils;\n\nconst TPL = `\n    <div class=\"canvas-widget note-detail-canvas note-detail-printable note-detail\">\n        <style>\n        .excalidraw .App-menu_top .buttonList {\n            display: flex;\n        }\n        \n        /* Conflict between excalidraw and bootstrap classes keeps the menu hidden */\n        /* https://github.com/zadam/trilium/issues/3780 */\n        /* https://github.com/excalidraw/excalidraw/issues/6567 */\n        .excalidraw .dropdown-menu {\n            display: block;\n        }\n\n        .excalidraw-wrapper {\n            height: 100%;\n        }\n        \n        .excalidraw button[data-testid=\"json-export-button\"] {\n            display: none !important;\n        }\n\n        :root[dir=\"ltr\"]\n        .excalidraw\n        .layer-ui__wrapper\n        .zen-mode-transition.App-menu_bottom--transition-left {\n            transform: none;\n        }\n        \n        /* collaboration not possible so hide the button */\n        .CollabButton {\n            display: none !important;\n        }\n        \n        button[data-testid='save-button'], button[data-testid='json-export-button'] {\n            display: none !important; /* these exports don't work, user should use import/export dialog */\n        }\n        \n        .library-button {\n            display: none !important; /* library won't work without extra support which isn't currently implemented */\n        }\n\n        </style>\n        <!-- height here necessary. otherwise excalidraw not shown -->\n        <div class=\"canvas-render\" style=\"height: 100%\"></div>  \n    </div>\n`;\n\n/**\n * # Canvas note with excalidraw\n * @author thfrei 2022-05-11\n *\n * Background:\n * excalidraw gives great support for hand-drawn notes. It also allows including images and support\n * for sketching. Excalidraw has a vibrant and active community.\n *\n * Functionality:\n * We store the excalidraw assets (elements and files) in the note. In addition to that, we\n * export the SVG from the canvas on every update and store it in the note's attachment. It is used when\n * calling api/images and makes referencing very easy.\n *\n * Paths not taken.\n *  - excalidraw-to-svg (node.js) could be used to avoid storing the svg in the backend.\n *    We could render the SVG on the fly. However, as of now, it does not render any hand drawn\n *    (freedraw) paths. There is an issue with Path2D object not present in the node-canvas library\n *    used by jsdom. (See Trilium PR for samples and other issues in the respective library.\n *    Link will be added later). Related links:\n *     - https://github.com/Automattic/node-canvas/pull/2013\n *     - https://github.com/google/canvas-5-polyfill\n *     - https://github.com/Automattic/node-canvas/issues/1116\n *     - https://www.npmjs.com/package/path2d-polyfill\n *  - excalidraw-to-svg (node.js) takes quite some time to load an image (1-2s)\n *  - excalidraw-utils (browser) does render freedraw, however NOT freedraw with a background. It is not\n *    used, since it is a big dependency, and has the same functionality as react + excalidraw.\n *  - infinite-drawing-canvas with fabric.js. This library lacked a lot of features, excalidraw already\n *    has.\n *\n * Known issues:\n *  - the 3 excalidraw fonts should be included in the share and everywhere, so that it is shown\n *    when requiring svg.\n *\n * Discussion of storing svg in the note attachment:\n *  - Pro: we will combat bit-rot. Showing the SVG will be very fast and easy, since it is already there.\n *  - Con: The note will get bigger (~40-50%?), we will generate more bandwidth. However, using trilium\n *         desktop instance mitigates that issue.\n *\n * Roadmap:\n *  - Support image-notes as reference in excalidraw\n *  - Support canvas note as reference (svg) in other canvas notes.\n *  - Make it easy to include a canvas note inside a text note\n */\nexport default class ExcalidrawTypeWidget extends TypeWidget {\n    constructor() {\n        super();\n\n        // constants\n        this.SCENE_VERSION_INITIAL = -1; // -1 indicates that it is fresh. excalidraw scene version is always >0\n        this.SCENE_VERSION_ERROR = -2; // -2 indicates error\n\n        // config\n        this.DEBOUNCE_TIME_ONCHANGEHANDLER = 750; // ms\n        // ensure that assets are loaded from trilium\n        window.EXCALIDRAW_ASSET_PATH = `${window.location.origin}/node_modules/@excalidraw/excalidraw/dist/`;\n\n        // temporary vars\n        this.currentNoteId = \"\";\n        this.currentSceneVersion = this.SCENE_VERSION_INITIAL;\n\n        // will be overwritten\n        this.excalidrawRef;\n        this.$render;\n        this.$widget;\n        this.reactHandlers; // used to control react state\n\n        // binds\n        this.createExcalidrawReactApp = this.createExcalidrawReactApp.bind(this);\n        this.onChangeHandler = this.onChangeHandler.bind(this);\n        this.isNewSceneVersion = this.isNewSceneVersion.bind(this);\n\n        this.libraryChanged = false;\n    }\n\n    static getType() {\n        return \"canvas\";\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$widget.bind('mousewheel DOMMouseScroll', event => {\n            if (event.ctrlKey) {\n                event.preventDefault();\n                event.stopPropagation();\n                return false;\n            }\n        });\n\n        this.$widget.toggleClass(\"full-height\", true);\n        this.$render = this.$widget.find('.canvas-render');\n        const documentStyle = window.getComputedStyle(document.documentElement);\n        this.themeStyle = documentStyle.getPropertyValue('--theme-style')?.trim();\n\n        libraryLoader\n            .requireLibrary(libraryLoader.EXCALIDRAW)\n            .then(() => {\n                const React = window.React;\n                const ReactDOM = window.ReactDOM;\n                const renderElement = this.$render.get(0);\n\n                ReactDOM.unmountComponentAtNode(renderElement);\n                ReactDOM.render(React.createElement(this.createExcalidrawReactApp), renderElement);\n            });\n\n        return this.$widget;\n    }\n\n    /**\n     * called to populate the widget container with the note content\n     *\n     * @param {FNote} note\n     */\n    async doRefresh(note) {\n        // see if the note changed, since we do not get a new class for a new note\n        const noteChanged = this.currentNoteId !== note.noteId;\n        if (noteChanged) {\n            // reset the scene to omit unnecessary onchange handler\n            this.currentSceneVersion = this.SCENE_VERSION_INITIAL;\n        }\n        this.currentNoteId = note.noteId;\n\n        // get note from backend and put into canvas\n        const blob = await note.getBlob();\n\n        // before we load content into excalidraw, make sure excalidraw has loaded\n        while (!this.excalidrawRef?.current) {\n            console.log(\"excalidrawRef not yet loaded, sleep 200ms...\");\n            await sleep(200);\n        }\n\n        /**\n         * new and empty note - make sure that canvas is empty.\n         * If we do not set it manually, we occasionally get some \"bleeding\" from another\n         * note into this fresh note. Probably due to that this note-instance does not get\n         * newly instantiated?\n         */\n        if (!blob.content?.trim()) {\n            const sceneData = {\n                elements: [],\n                appState: {\n                    theme: this.themeStyle\n                },\n                collaborators: []\n            };\n\n            this.excalidrawRef.current.updateScene(sceneData);\n        }\n        else if (blob.content) {\n            // load saved content into excalidraw canvas\n            let content;\n\n            try {\n                content = blob.getJsonContent();\n            } catch(err) {\n                console.error(\"Error parsing content. Probably note.type changed. Starting with empty canvas\", note, blob, err);\n\n                content = {\n                    elements: [],\n                    files: [],\n                    appState: {}\n                };\n            }\n\n            const {elements, files, appState = {}} = content;\n\n            appState.theme = this.themeStyle;\n\n            const boundingClientRect = this.excalidrawWrapperRef.current.getBoundingClientRect();\n            appState.width = boundingClientRect.width;\n            appState.height = boundingClientRect.height;\n            appState.offsetLeft = boundingClientRect.left;\n            appState.offsetTop = boundingClientRect.top;\n\n            const sceneData = {\n                elements,\n                appState,\n                collaborators: []\n            };\n\n            // files are expected in an array when loading. they are stored as a key-index object\n            // see example for loading here:\n            // https://github.com/excalidraw/excalidraw/blob/c5a7723185f6ca05e0ceb0b0d45c4e3fbcb81b2a/src/packages/excalidraw/example/App.js#L68\n            const fileArray = [];\n            for (const fileId in files) {\n                const file = files[fileId];\n                // TODO: dataURL is replaceable with a trilium image url\n                //       maybe we can save normal images (pasted) with base64 data url, and trilium images\n                //       with their respective url! nice\n                // file.dataURL = \"http://localhost:8080/api/images/ltjOiU8nwoZx/start.png\";\n                fileArray.push(file);\n            }\n\n            this.excalidrawRef.current.updateScene(sceneData);\n            this.excalidrawRef.current.addFiles(fileArray);\n            this.excalidrawRef.current.history.clear();\n        }\n\n        Promise.all(\n            (await note.getAttachmentsByRole('canvasLibraryItem'))\n                .map(attachment => attachment.getBlob())\n        ).then(blobs => {\n            if (note.noteId !== this.currentNoteId) {\n                // current note changed in the course of the async operation\n                return;\n            }\n\n            const libraryItems = blobs.map(blob => blob.getJsonContentSafely()).filter(item => !!item);\n            this.excalidrawRef.current.updateLibrary({libraryItems, merge: false});\n        });\n\n        // set initial scene version\n        if (this.currentSceneVersion === this.SCENE_VERSION_INITIAL) {\n            this.currentSceneVersion = this.getSceneVersion();\n        }\n    }\n\n    /**\n     * gets data from widget container that will be sent via spacedUpdate.scheduleUpdate();\n     * this is automatically called after this.saveData();\n     */\n    async getData() {\n        const elements = this.excalidrawRef.current.getSceneElements();\n        const appState = this.excalidrawRef.current.getAppState();\n\n        /**\n         * A file is not deleted, even though removed from canvas. Therefore, we only keep\n         * files that are referenced by an element. Maybe this will change with a new excalidraw version?\n         */\n        const files = this.excalidrawRef.current.getFiles();\n\n        // parallel svg export to combat bitrot and enable rendering image for note inclusion, preview, and share\n        const svg = await window.ExcalidrawLib.exportToSvg({\n            elements,\n            appState,\n            exportPadding: 5, // 5 px padding\n            metadata: 'trilium-export',\n            files\n        });\n        const svgString = svg.outerHTML;\n\n        const activeFiles = {};\n        elements.forEach((element) => {\n            if (element.fileId) {\n                activeFiles[element.fileId] = files[element.fileId];\n            }\n        });\n\n        const content = {\n            type: \"excalidraw\",\n            version: 2,\n            elements,\n            files: activeFiles,\n            appState: {\n                scrollX: appState.scrollX,\n                scrollY: appState.scrollY,\n                zoom: appState.zoom\n            }\n        };\n\n        const attachments = [\n            { role: 'image', title: 'canvas-export.svg', mime: 'image/svg+xml', content: svgString, position: 0 }\n        ];\n\n        if (this.libraryChanged) {\n            // this.libraryChanged is unset in dataSaved()\n\n            // there's no separate method to get library items, so have to abuse this one\n            const libraryItems = await this.excalidrawRef.current.updateLibrary({merge: true});\n\n            let position = 10;\n\n            for (const libraryItem of libraryItems) {\n                attachments.push({\n                    role: 'canvasLibraryItem',\n                    title: libraryItem.id,\n                    mime: 'application/json',\n                    content: JSON.stringify(libraryItem),\n                    position: position\n                });\n\n                position += 10;\n            }\n        }\n\n        return {\n            content: JSON.stringify(content),\n            attachments\n        };\n    }\n\n    /**\n     * save content to backend\n     * spacedUpdate is kind of a debouncer.\n     */\n    saveData() {\n        this.spacedUpdate.scheduleUpdate();\n    }\n\n    dataSaved() {\n        this.libraryChanged = false;\n    }\n\n    onChangeHandler() {\n        // changeHandler is called upon any tiny change in excalidraw. button clicked, hover, etc.\n        // make sure only when a new element is added, we actually save something.\n        const isNewSceneVersion = this.isNewSceneVersion();\n        /**\n         * FIXME: however, we might want to make an exception, if viewport changed, since viewport\n         *        is desired to save? (add) and appState background, and some things\n         */\n\n        // upon updateScene, onchange is called, even though \"nothing really changed\" that is worth saving\n        const isNotInitialScene = this.currentSceneVersion !== this.SCENE_VERSION_INITIAL;\n\n        const shouldSave = isNewSceneVersion && isNotInitialScene;\n\n        if (shouldSave) {\n            this.updateSceneVersion();\n            this.saveData();\n        }\n    }\n\n    createExcalidrawReactApp() {\n        const React = window.React;\n        const { Excalidraw } = window.ExcalidrawLib;\n\n        const excalidrawRef = React.useRef(null);\n        this.excalidrawRef = excalidrawRef;\n        const excalidrawWrapperRef = React.useRef(null);\n        this.excalidrawWrapperRef = excalidrawWrapperRef;\n        const [dimensions, setDimensions] = React.useState({\n            width: undefined,\n            height: undefined\n        });\n\n        React.useEffect(() => {\n            const dimensions = {\n                width: excalidrawWrapperRef.current.getBoundingClientRect().width,\n                height: excalidrawWrapperRef.current.getBoundingClientRect().height\n            };\n            setDimensions(dimensions);\n\n            const onResize = () => {\n                if (this.note?.type !== 'canvas') {\n                    return;\n                }\n\n                const dimensions = {\n                    width: excalidrawWrapperRef.current.getBoundingClientRect().width,\n                    height: excalidrawWrapperRef.current.getBoundingClientRect().height\n                };\n                setDimensions(dimensions);\n            };\n\n            window.addEventListener(\"resize\", onResize);\n\n            return () => window.removeEventListener(\"resize\", onResize);\n        }, [excalidrawWrapperRef]);\n\n        const onLinkOpen = React.useCallback((element, event) => {\n            let link = element.link;\n\n            if (link.startsWith(\"root/\")) {\n                link = \"#\" + link;\n            }\n\n            const { nativeEvent } = event.detail;\n\n            event.preventDefault();\n\n            return linkService.goToLinkExt(nativeEvent, link, null);\n          }, []);\n\n        return React.createElement(\n            React.Fragment,\n            null,\n            React.createElement(\n                \"div\",\n                {\n                    className: \"excalidraw-wrapper\",\n                    ref: excalidrawWrapperRef\n                },\n                React.createElement(Excalidraw, {\n                    // this makes sure that 1) manual theme switch button is hidden 2) theme stays as it should after opening menu\n                    theme: this.themeStyle,\n                    ref: excalidrawRef,\n                    langCode: \"zh-CN\",\n                    width: dimensions.width,\n                    height: dimensions.height,\n                    onPaste: (data, event) => {\n                        console.log(\"Verbose: excalidraw internal paste. No trilium action implemented.\", data, event);\n                    },\n                    onLibraryChange: () => {\n                        this.libraryChanged = true;\n\n                        this.saveData();\n                    },\n                    onChange: debounce(this.onChangeHandler, this.DEBOUNCE_TIME_ONCHANGEHANDLER),\n                    viewModeEnabled: false,\n                    zenModeEnabled: false,\n                    gridModeEnabled: false,\n                    isCollaborating: false,\n                    detectScroll: false,\n                    handleKeyboardGlobally: false,\n                    autoFocus: false,\n                    onLinkOpen,\n                    UIOptions: {\n                        saveToActiveFile: false,\n                        saveAsImage: false\n                    }\n                })\n            )\n        );\n    }\n\n    /**\n     * needed to ensure, that multipleOnChangeHandler calls do not trigger a save.\n     * we compare the scene version as suggested in:\n     * https://github.com/excalidraw/excalidraw/issues/3014#issuecomment-778115329\n     *\n     * info: sceneVersions are not incrementing. it seems to be a pseudo-random number\n     */\n     isNewSceneVersion() {\n        const sceneVersion = this.getSceneVersion();\n\n        return this.currentSceneVersion === this.SCENE_VERSION_INITIAL // initial scene version update\n            || this.currentSceneVersion !== sceneVersion; // ensure scene changed\n    }\n\n    getSceneVersion() {\n        if (this.excalidrawRef) {\n            const elements = this.excalidrawRef.current.getSceneElements();\n            return window.ExcalidrawLib.getSceneVersion(elements);\n        } else {\n            return this.SCENE_VERSION_ERROR;\n        }\n    }\n\n    updateSceneVersion() {\n        this.currentSceneVersion = this.getSceneVersion();\n    }\n}\n","import libraryLoader from \"../services/library_loader.js\";\nimport server from \"../services/server.js\";\nimport attributeService from \"../services/attributes.js\";\nimport hoistedNoteService from \"../services/hoisted_note.js\";\nimport appContext from \"../components/app_context.js\";\nimport NoteContextAwareWidget from \"./note_context_aware_widget.js\";\nimport linkContextMenuService from \"../menus/link_context_menu.js\";\nimport utils from \"../services/utils.js\";\n\nconst esc = utils.escapeHtml;\n\nconst TPL = `<div class=\"note-map-widget\" style=\"position: relative;\">\n    <style>\n        .note-detail-note-map {\n            height: 100%;\n            overflow: hidden;\n        }\n        \n        .map-type-switcher {\n            position: absolute; \n            top: 10px; \n            left: 10px; \n            z-index: 10; /* should be below dropdown (note actions) */\n        }\n        \n        .map-type-switcher button.bx {\n            font-size: 130%;\n            padding: 1px 10px 1px 10px;\n        }\n    </style>\n    \n    <div class=\"btn-group btn-group-sm map-type-switcher\" role=\"group\">\n      <button type=\"button\" class=\"btn bx bx-network-chart\" title=\"链接地图\" data-type=\"link\"></button>\n      <button type=\"button\" class=\"btn bx bx-sitemap\" title=\"树形图\" data-type=\"tree\"></button>\n    </div>\n\n    <div class=\"style-resolver\"></div>\n\n    <div class=\"note-map-container\"></div>\n</div>`;\n\nexport default class NoteMapWidget extends NoteContextAwareWidget {\n    constructor(widgetMode) {\n        super();\n\n        this.widgetMode = widgetMode; // 'type' or 'ribbon'\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n\n        const documentStyle = window.getComputedStyle(document.documentElement);\n        this.themeStyle = documentStyle.getPropertyValue('--theme-style')?.trim();\n\n        this.$container = this.$widget.find(\".note-map-container\");\n        this.$styleResolver = this.$widget.find('.style-resolver');\n\n        new ResizeObserver(() => this.setDimensions()).observe(this.$container[0]);\n\n        this.$widget.find(\".map-type-switcher button\").on(\"click\",  async e => {\n            const type = $(e.target).closest(\"button\").attr(\"data-type\");\n\n            await attributeService.setLabel(this.noteId, 'mapType', type);\n        });\n\n        super.doRender();\n    }\n\n    setDimensions() {\n        if (!this.graph) { // no graph has been even rendered\n            return;\n        }\n\n        const $parent = this.$widget.parent();\n\n        this.graph\n            .height($parent.height())\n            .width($parent.width());\n    }\n\n    async refreshWithNote(note) {\n        this.$widget.show();\n\n        this.css = {\n            fontFamily: this.$container.css(\"font-family\"),\n            textColor: this.rgb2hex(this.$container.css(\"color\")),\n            mutedTextColor: this.rgb2hex(this.$styleResolver.css(\"color\"))\n        };\n\n        this.mapType = this.note.getLabelValue(\"mapType\") === \"tree\" ? \"tree\" : \"link\";\n\n        await libraryLoader.requireLibrary(libraryLoader.FORCE_GRAPH);\n\n        this.graph = ForceGraph()(this.$container[0])\n            .width(this.$container.width())\n            .height(this.$container.height())\n            .onZoom(zoom => this.setZoomLevel(zoom.k))\n            .d3AlphaDecay(0.01)\n            .d3VelocityDecay(0.08)\n            .nodeCanvasObject((node, ctx) => this.paintNode(node, this.getColorForNode(node), ctx))\n            .nodePointerAreaPaint((node, ctx) => this.paintNode(node, this.getColorForNode(node), ctx))\n            .nodePointerAreaPaint((node, color, ctx) => {\n                ctx.fillStyle = color;\n                ctx.beginPath();\n                ctx.arc(node.x, node.y, this.noteIdToSizeMap[node.id], 0, 2 * Math.PI, false);\n                ctx.fill();\n            })\n            .nodeLabel(node => esc(node.name))\n            .maxZoom(7)\n            .warmupTicks(30)\n            .linkDirectionalArrowLength(5)\n            .linkDirectionalArrowRelPos(1)\n            .linkWidth(1)\n            .linkColor(() => this.css.mutedTextColor)\n            .onNodeClick(node => appContext.tabManager.getActiveContext().setNote(node.id))\n            .onNodeRightClick((node, e) => linkContextMenuService.openContextMenu(node.id, e));\n\n        if (this.mapType === 'link') {\n            this.graph\n                .linkLabel(l => `${esc(l.source.name)} - <strong>${esc(l.name)}</strong> - ${esc(l.target.name)}`)\n                .linkCanvasObject((link, ctx) => this.paintLink(link, ctx))\n                .linkCanvasObjectMode(() => \"after\");\n        }\n\n        const mapRootNoteId = this.getMapRootNoteId();\n        const data = await this.loadNotesAndRelations(mapRootNoteId);\n\n        const nodeLinkRatio = data.nodes.length / data.links.length;\n        const magnifiedRatio = Math.pow(nodeLinkRatio, 1.5);\n        const charge = -20 / magnifiedRatio;\n        const boundedCharge = Math.min(-3, charge);\n\n        this.graph.d3Force('link').distance(40);\n        this.graph.d3Force('center').strength(0.2);\n        this.graph.d3Force('charge').strength(boundedCharge);\n        this.graph.d3Force('charge').distanceMax(1000);\n\n        this.renderData(data);\n    }\n\n    getMapRootNoteId() {\n        if (this.widgetMode === 'ribbon') {\n            return this.noteId;\n        }\n\n        let mapRootNoteId = this.note.getLabelValue(\"mapRootNoteId\");\n\n        if (mapRootNoteId === 'hoisted') {\n            mapRootNoteId = hoistedNoteService.getHoistedNoteId();\n        } else if (!mapRootNoteId) {\n            mapRootNoteId = appContext.tabManager.getActiveContext().parentNoteId;\n        }\n\n        return mapRootNoteId;\n    }\n\n    getColorForNode(node) {\n        if (node.color) {\n            return node.color;\n        } else if (this.widgetMode === 'ribbon' && node.id === this.noteId) {\n            return 'red'; // subtree root mark as red\n        } else {\n            return this.generateColorFromString(node.type);\n        }\n    }\n\n    generateColorFromString(str) {\n        if (this.themeStyle === \"dark\") {\n            str = `0${str}`; // magic lightning modifier\n        }\n\n        let hash = 0;\n        for (let i = 0; i < str.length; i++) {\n            hash = str.charCodeAt(i) + ((hash << 5) - hash);\n        }\n\n        let color = '#';\n        for (let i = 0; i < 3; i++) {\n            const value = (hash >> (i * 8)) & 0xFF;\n\n            color += (`00${value.toString(16)}`).substr(-2);\n        }\n        return color;\n    }\n\n    rgb2hex(rgb) {\n        return `#${rgb.match(/^rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)$/)\n            .slice(1)\n            .map(n => parseInt(n, 10).toString(16).padStart(2, '0'))\n            .join('')}`\n    }\n\n    setZoomLevel(level) {\n        this.zoomLevel = level;\n    }\n\n    paintNode(node, color, ctx) {\n        const {x, y} = node;\n        const size = this.noteIdToSizeMap[node.id];\n\n        ctx.fillStyle = color;\n        ctx.beginPath();\n        ctx.arc(x, y, size, 0, 2 * Math.PI, false);\n        ctx.fill();\n\n        const toRender = this.zoomLevel > 2\n            || (this.zoomLevel > 1 && size > 6)\n            || (this.zoomLevel > 0.3 && size > 10);\n\n        if (!toRender) {\n            return;\n        }\n\n        ctx.fillStyle = this.css.textColor;\n        ctx.font = `${size}px ${this.css.fontFamily}`;\n        ctx.textAlign = 'center';\n        ctx.textBaseline = 'middle';\n\n        let title = node.name;\n\n        if (title.length > 15) {\n            title = `${title.substr(0, 15)}...`;\n        }\n\n        ctx.fillText(title, x, y + Math.round(size * 1.5));\n    }\n\n    paintLink(link, ctx) {\n        if (this.zoomLevel < 5) {\n            return;\n        }\n\n        ctx.font = `3px ${this.css.fontFamily}`;\n        ctx.textAlign = 'center';\n        ctx.textBaseline = 'middle';\n        ctx.fillStyle = this.css.mutedTextColor;\n\n        const {source, target} = link;\n\n        const x = (source.x + target.x) / 2;\n        const y = (source.y + target.y) / 2;\n\n        ctx.save();\n        ctx.translate(x, y);\n\n        const deltaY = source.y - target.y;\n        const deltaX = source.x - target.x;\n\n        let angle = Math.atan2(deltaY, deltaX);\n        let moveY = 2;\n\n        if (angle < -Math.PI / 2 || angle > Math.PI / 2) {\n            angle += Math.PI;\n            moveY = -2;\n        }\n\n        ctx.rotate(angle);\n        ctx.fillText(link.name, 0, moveY);\n        ctx.restore();\n    }\n\n    async loadNotesAndRelations(mapRootNoteId) {\n        const resp = await server.post(`note-map/${mapRootNoteId}/${this.mapType}`);\n\n        this.calculateNodeSizes(resp);\n\n        const links = this.getGroupedLinks(resp.links);\n\n        this.nodes = resp.notes.map(([noteId, title, type, color]) => ({\n            id: noteId,\n            name: title,\n            type: type,\n            color: color\n        }));\n\n        return {\n            nodes: this.nodes,\n            links: links.map(link => ({\n                id: `${link.sourceNoteId}-${link.targetNoteId}`,\n                source: link.sourceNoteId,\n                target: link.targetNoteId,\n                name: link.names.join(\", \")\n            }))\n        };\n    }\n\n    getGroupedLinks(links) {\n        const linksGroupedBySourceTarget = {};\n\n        for (const link of links) {\n            const key = `${link.sourceNoteId}-${link.targetNoteId}`;\n\n            if (key in linksGroupedBySourceTarget) {\n                if (!linksGroupedBySourceTarget[key].names.includes(link.name)) {\n                    linksGroupedBySourceTarget[key].names.push(link.name);\n                }\n            } else {\n                linksGroupedBySourceTarget[key] = {\n                    id: key,\n                    sourceNoteId: link.sourceNoteId,\n                    targetNoteId: link.targetNoteId,\n                    names: [link.name]\n                }\n            }\n        }\n\n        return Object.values(linksGroupedBySourceTarget);\n    }\n\n    calculateNodeSizes(resp) {\n        this.noteIdToSizeMap = {};\n\n        if (this.mapType === 'tree') {\n            const {noteIdToDescendantCountMap} = resp;\n\n            for (const noteId in noteIdToDescendantCountMap) {\n                this.noteIdToSizeMap[noteId] = 4;\n\n                const count = noteIdToDescendantCountMap[noteId];\n\n                if (count > 0) {\n                    this.noteIdToSizeMap[noteId] += 1 + Math.round(Math.log(count) / Math.log(1.5));\n                }\n            }\n        }\n        else if (this.mapType === 'link') {\n            const noteIdToLinkCount = {};\n\n            for (const link of resp.links) {\n                noteIdToLinkCount[link.targetNoteId] = 1 + (noteIdToLinkCount[link.targetNoteId] || 0);\n            }\n\n            for (const [noteId] of resp.notes) {\n                this.noteIdToSizeMap[noteId] = 4;\n\n                if (noteId in noteIdToLinkCount) {\n                    this.noteIdToSizeMap[noteId] += Math.min(Math.pow(noteIdToLinkCount[noteId], 0.5), 15);\n                }\n            }\n        }\n    }\n\n    renderData(data) {\n        this.graph.graphData(data);\n\n        if (this.widgetMode === 'ribbon' && this.note?.type !== 'search') {\n            setTimeout(() => {\n                this.setDimensions();\n\n                const subGraphNoteIds = this.getSubGraphConnectedToCurrentNote(data);\n\n                this.graph.zoomToFit(400, 50, node => subGraphNoteIds.has(node.id));\n\n                if (subGraphNoteIds.size < 30) {\n                    this.graph.d3VelocityDecay(0.4);\n                }\n            }, 1000);\n        }\n        else {\n            if (data.nodes.length > 1) {\n                setTimeout(() => {\n                    this.setDimensions();\n\n                    const noteIdsWithLinks = this.getNoteIdsWithLinks(data);\n\n                    if (noteIdsWithLinks.size > 0) {\n                        this.graph.zoomToFit(400, 30, node => noteIdsWithLinks.has(node.id));\n                    }\n\n                    if (noteIdsWithLinks.size < 30) {\n                        this.graph.d3VelocityDecay(0.4);\n                    }\n                }, 1000);\n            }\n        }\n    }\n\n    getNoteIdsWithLinks(data) {\n        const noteIds = new Set();\n\n        for (const link of data.links) {\n            noteIds.add(link.source.id);\n            noteIds.add(link.target.id);\n        }\n\n        return noteIds;\n    }\n\n    getSubGraphConnectedToCurrentNote(data) {\n        function getGroupedLinks(links, type) {\n            const map = {};\n\n            for (const link of links) {\n                const key = link[type].id;\n                map[key] = map[key] || [];\n                map[key].push(link);\n            }\n\n            return map;\n        }\n\n        const linksBySource = getGroupedLinks(data.links, \"source\");\n        const linksByTarget = getGroupedLinks(data.links, \"target\");\n\n        const subGraphNoteIds = new Set();\n\n        function traverseGraph(noteId) {\n            if (subGraphNoteIds.has(noteId)) {\n                return;\n            }\n\n            subGraphNoteIds.add(noteId);\n\n            for (const link of linksBySource[noteId] || []) {\n                traverseGraph(link.target.id);\n            }\n\n            for (const link of linksByTarget[noteId] || []) {\n                traverseGraph(link.source.id);\n            }\n        }\n\n        traverseGraph(this.noteId);\n        return subGraphNoteIds;\n    }\n\n    cleanup() {\n        this.$container.html('');\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.getAttributeRows(this.componentId).find(\n            attr =>\n                attr.type === 'label'\n                && ['mapType', 'mapRootNoteId'].includes(attr.name)\n                && attributeService.isAffecting(attr, this.note)\n        )) {\n            this.refresh();\n        }\n    }\n}\n","import server from \"../../../services/server.js\";\nimport toastService from \"../../../services/toast.js\";\nimport NoteContextAwareWidget from \"../../note_context_aware_widget.js\";\n\nexport default class OptionsWidget extends NoteContextAwareWidget {\n    constructor() {\n        super();\n\n        this.contentSized();\n    }\n\n    async updateOption(name, value) {\n        const opts = { [name]: value };\n\n        await this.updateMultipleOptions(opts);\n    }\n\n    async updateMultipleOptions(opts) {\n        await server.put('options', opts);\n\n        this.showUpdateNotification();\n    }\n\n    showUpdateNotification() {\n        toastService.showPersistent({\n            id: \"options-change-saved\",\n            title: \"选项状态\",\n            message: \"选项更改已保存.\",\n            icon: \"slider\",\n            closeAfter: 2000\n        });\n    }\n\n    async updateCheckboxOption(name, $checkbox) {\n        const isChecked = $checkbox.prop(\"checked\");\n\n        return await this.updateOption(name, isChecked ? 'true' : 'false');\n    }\n\n    setCheckboxState($checkbox, optionValue) {\n        $checkbox.prop('checked', optionValue === 'true');\n    }\n\n    optionsLoaded(options) {}\n\n    async refreshWithNote(note) {\n        const options = await server.get('options');\n\n        this.optionsLoaded(options);\n    }\n\n    async entitiesReloadedEvent({loadResults}) {\n        if (loadResults.getOptionNames().length > 0) {\n            this.refresh();\n        }\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\nimport utils from \"../../../../services/utils.js\";\n\nconst FONT_FAMILIES = [\n    { value: \"theme\", label: \"Theme defined\" },\n    { value: \"serif\", label: \"Serif\" },\n    { value: \"sans-serif\", label: \"Sans Serif\" },\n    { value: \"monospace\", label: \"Monospace\" },\n    { value: \"Arial\", label: \"Arial\" },\n    { value: \"Verdana\", label: \"Verdana\" },\n    { value: \"Helvetica\", label: \"Helvetica\" },\n    { value: \"Tahoma\", label: \"Tahoma\" },\n    { value: \"Trebuchet MS\", label: \"Trebuchet MS\" },\n    { value: \"Times New Roman\", label: \"Times New Roman\" },\n    { value: \"Georgia\", label: \"Georgia\" },\n    { value: \"Garamond\", label: \"Garamond\" },\n    { value: \"Courier New\", label: \"Courier New\" },\n    { value: \"Brush Script MT\", label: \"Brush Script MT\" },\n    { value: \"Impact\", label: \"Impact\" },\n    { value: \"American Typewriter\", label: \"American Typewriter\" },\n    { value: \"Andalé Mono\", label: \"Andalé Mono\" },\n    { value: \"Lucida Console\", label: \"Lucida Console\" },\n    { value: \"Monaco\", label: \"Monaco\" },\n    { value: \"Bradley Hand\", label: \"Bradley Hand\" },\n    { value: \"Luminari\", label: \"Luminari\" },\n    { value: \"Comic Sans MS\", label: \"Comic Sans MS\" },\n    { value: \"Microsoft YaHei\", label: \"Microsoft YaHei\" },\n];\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>字体</h4>\n    \n    <h5>主字体</h5>\n    \n    <div class=\"form-group row\">\n        <div class=\"col-6\">\n            <label>字体系列</label>\n            <select class=\"main-font-family form-control\"></select>\n        </div>\n    \n        <div class=\"col-6\">\n            <label>大小</label>\n\n            <div class=\"input-group\">\n                <input type=\"number\" class=\"main-font-size form-control options-number-input\" min=\"50\" max=\"200\" step=\"10\"/>\n                <div class=\"input-group-append\">\n                    <span class=\"input-group-text\">%</span>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <h5>笔记树字体</h5>\n\n    <div class=\"form-group row\">\n        <div class=\"col-4\">\n            <label>字体系列</label>\n            <select class=\"tree-font-family form-control\"></select>\n        </div>\n    \n        <div class=\"col-4\">\n            <label>大小</label>\n\n            <div class=\"input-group\">\n                <input type=\"number\" class=\"tree-font-size form-control options-number-input\" min=\"50\" max=\"200\" step=\"10\"/>\n                <div class=\"input-group-append\">\n                    <span class=\"input-group-text\">%</span>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <h5>笔记详情字体</h5>\n    \n    <div class=\"form-group row\">\n        <div class=\"col-4\">\n            <label>字体系列</label>\n            <select class=\"detail-font-family form-control\"></select>\n        </div>\n        \n        <div class=\"col-4\">\n            <label>大小</label>\n\n            <div class=\"input-group\">\n                <input type=\"number\" class=\"detail-font-size form-control options-number-input\" min=\"50\" max=\"200\" step=\"10\"/>\n                <div class=\"input-group-append\">\n                    <span class=\"input-group-text\">%</span>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <h5>等宽字体 (代码)</h5>\n    \n    <div class=\"form-group row\">\n        <div class=\"col-4\">\n            <label>字体系列</label>\n            <select class=\"monospace-font-family form-control\"></select>\n        </div>\n    \n        <div class=\"col-4\">\n            <label>大小</label>\n\n            <div class=\"input-group\">\n                <input type=\"number\" class=\"monospace-font-size form-control options-number-input\" min=\"50\" max=\"200\" step=\"10\"/>\n                <div class=\"input-group-append\">\n                    <span class=\"input-group-text\">%</span>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <p>注意树和详情字体的大小和主字体大小有关.</p>\n\n    <p>并非所有列出的字体都可以在您的系统上使用.</p>\n    \n    <p>\n        应用字体修改, 请点击 \n        <button class=\"btn btn-micro reload-frontend-button\">重新加载前端</button>\n    </p>\n</div>`;\n\nexport default class FontsOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$mainFontSize = this.$widget.find(\".main-font-size\");\n        this.$mainFontFamily = this.$widget.find(\".main-font-family\");\n\n        this.$treeFontSize = this.$widget.find(\".tree-font-size\");\n        this.$treeFontFamily = this.$widget.find(\".tree-font-family\");\n\n        this.$detailFontSize = this.$widget.find(\".detail-font-size\");\n        this.$detailFontFamily = this.$widget.find(\".detail-font-family\");\n\n        this.$monospaceFontSize = this.$widget.find(\".monospace-font-size\");\n        this.$monospaceFontFamily = this.$widget.find(\".monospace-font-family\");\n\n        this.$widget.find(\".reload-frontend-button\").on(\"click\", () => utils.reloadFrontendApp(\"changes from appearance options\"));\n    }\n\n    async optionsLoaded(options) {\n        if (options.overrideThemeFonts !== 'true') {\n            this.toggleInt(false);\n            return;\n        }\n\n        this.toggleInt(true);\n\n        this.$mainFontSize.val(options.mainFontSize);\n        this.fillFontFamilyOptions(this.$mainFontFamily, options.mainFontFamily);\n\n        this.$treeFontSize.val(options.treeFontSize);\n        this.fillFontFamilyOptions(this.$treeFontFamily, options.treeFontFamily);\n\n        this.$detailFontSize.val(options.detailFontSize);\n        this.fillFontFamilyOptions(this.$detailFontFamily, options.detailFontFamily);\n\n        this.$monospaceFontSize.val(options.monospaceFontSize);\n        this.fillFontFamilyOptions(this.$monospaceFontFamily, options.monospaceFontFamily);\n\n        const optionsToSave = [\n            'mainFontFamily', 'mainFontSize',\n            'treeFontFamily', 'treeFontSize',\n            'detailFontFamily', 'detailFontSize',\n            'monospaceFontFamily', 'monospaceFontSize'\n        ];\n\n        for (const optionName of optionsToSave) {\n            this[`$${optionName}`].on('change', () =>\n                this.updateOption(optionName, this[`$${optionName}`].val()));\n        }\n    }\n\n    fillFontFamilyOptions($select, currentValue) {\n        $select.empty();\n\n        for (const {value, label} of FONT_FAMILIES) {\n            $select.append($(\"<option>\")\n                .attr(\"value\", value)\n                .prop(\"selected\", value === currentValue)\n                .text(label));\n        }\n    }\n}\n","import server from \"../../../services/server.js\";\nimport utils from \"../../../services/utils.js\";\nimport dialogService from \"../../../services/dialog.js\";\nimport OptionsWidget from \"./options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section shortcuts-options-section\">\n    <style>\n        .shortcuts-options-section {\n            display: flex; \n            flex-direction: column; \n            height: 100%;\n        }\n    \n        .shortcuts-table-container {\n            overflow: auto; \n            flex-grow: 1; \n            flex-shrink: 1; \n        }    \n        \n        .shortcuts-options-buttons {\n            display: flex; \n            justify-content: space-between;\n            margin: 15px 15px 0 15px;\n        }\n    </style>\n\n    <h4>快捷键</h4>\n    \n    <p>\n      同一操作的多个快捷方式可以用逗号隔开.\n      更多快捷键设置请查看<a href=\"https://www.electronjs.org/docs/latest/api/accelerator\">Electron 文档</a>.\n    </p>\n    \n    <div class=\"form-group\">\n        <input type=\"text\" class=\"keyboard-shortcut-filter form-control\" placeholder=\"输入关键字过滤快捷键...\">\n    </div>\n    \n    <div class=\"shortcuts-table-container\">\n        <table class=\"keyboard-shortcut-table\" cellpadding=\"10\">\n        <thead>\n            <tr>\n                <th>动作名称</th>\n                <th>快捷键</th>\n                <th>默认快捷键</th>\n                <th>描述</th>\n            </tr>\n        </thead>\n        <tbody></tbody>\n        </table>\n    </div>\n    \n    <div class=\"shortcuts-options-buttons\">\n        <button class=\"options-keyboard-shortcuts-reload-app btn btn-primary\">重新加载应用程序以应用更改</button>\n        \n        <button class=\"options-keyboard-shortcuts-set-all-to-default btn\">重置所有快捷键</button>\n    </div>\n</div>`;\n\nlet globActions;\n\nexport default class KeyboardShortcutsOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$widget.find(\".options-keyboard-shortcuts-reload-app\").on(\"click\", () => utils.reloadFrontendApp());\n\n        const $table = this.$widget.find(\".keyboard-shortcut-table tbody\");\n\n        server.get('keyboard-actions').then(actions => {\n            globActions = actions;\n\n            for (const action of actions) {\n                const $tr = $(\"<tr>\");\n\n                if (action.separator) {\n                    $tr.append(\n                        $('<td colspan=\"4\">')\n                            .attr(\"style\",\"background-color: var(--accented-background-color); font-weight: bold;\")\n                            .text(action.separator)\n                    )\n                }\n                else {\n                    $tr.append($(\"<td>\").text(action.actionName))\n                        .append($(\"<td>\").append(\n                            $(`<input type=\"text\" class=\"form-control\">`)\n                                .val(action.effectiveShortcuts.join(\", \"))\n                                .attr('data-keyboard-action-name', action.actionName)\n                                .attr('data-default-keyboard-shortcuts', action.defaultShortcuts.join(\", \"))\n                            )\n                        )\n                        .append($(\"<td>\").text(action.defaultShortcuts.join(\", \")))\n                        .append($(\"<td>\").text(action.description));\n                }\n\n                $table.append($tr);\n            }\n        });\n\n        $table.on('change', 'input.form-control', e => {\n            const $input = this.$widget.find(e.target);\n            const actionName = $input.attr('data-keyboard-action-name');\n            const shortcuts = $input.val()\n                              .replace('+,', \"+Comma\")\n                              .split(\",\")\n                              .map(shortcut => shortcut.replace(\"+Comma\", \"+,\"))\n                              .filter(shortcut => !!shortcut);\n\n            const optionName = `keyboardShortcuts${actionName.substr(0, 1).toUpperCase()}${actionName.substr(1)}`;\n\n            this.updateOption(optionName, JSON.stringify(shortcuts));\n        });\n\n        this.$widget.find(\".options-keyboard-shortcuts-set-all-to-default\").on('click', async () => {\n            if (!await dialogService.confirm(\"确定要重置所有快捷键吗？\")) {\n                return;\n            }\n\n            $table.find('input.form-control').each((_index, el) => {\n                const defaultShortcuts = this.$widget.find(el).attr('data-default-keyboard-shortcuts');\n\n                if (this.$widget.find(el).val() !== defaultShortcuts) {\n                    this.$widget.find(el)\n                        .val(defaultShortcuts)\n                        .trigger('change');\n                }\n            });\n        });\n\n        const $filter = this.$widget.find(\".keyboard-shortcut-filter\");\n\n        $filter.on('keyup', () => {\n            const filter = $filter.val().trim().toLowerCase();\n\n            $table.find(\"tr\").each((i, el) => {\n                if (!filter) {\n                    this.$widget.find(el).show();\n                    return;\n                }\n\n                const actionName = this.$widget.find(el).find('input').attr('data-keyboard-action-name');\n\n                if (!actionName) {\n                    this.$widget.find(el).hide();\n                    return;\n                }\n\n                const action = globActions.find(act => act.actionName === actionName);\n\n                if (!action) {\n                    this.$widget.find(el).hide();\n                    return;\n                }\n\n                this.$widget.find(el).toggle(!!( // !! to avoid toggle overloads with different behavior\n                    action.actionName.toLowerCase().includes(filter)\n                    || action.defaultShortcuts.some(shortcut => shortcut.toLowerCase().includes(filter))\n                    || action.effectiveShortcuts.some(shortcut => shortcut.toLowerCase().includes(filter))\n                    || (action.description && action.description.toLowerCase().includes(filter))\n                ));\n            });\n        });\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\nimport mimeTypesService from \"../../../../services/mime_types.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>下拉菜单可用的MIME文件类型</h4>\n    \n    <ul class=\"options-mime-types\" style=\"list-style-type: none;\"></ul>\n</div>`;\n\nlet idCtr = 1; // global, since this can be shown in multiple dialogs\n\nexport default class CodeMimeTypesOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$mimeTypes = this.$widget.find(\".options-mime-types\");\n    }\n\n    async optionsLoaded(options) {\n        this.$mimeTypes.empty();\n\n        for (const mimeType of await mimeTypesService.getMimeTypes()) {\n            const id = \"code-mime-type-\" + (idCtr++);\n\n            this.$mimeTypes.append($(\"<li>\")\n                .append($('<input type=\"checkbox\">')\n                    .attr(\"id\", id)\n                    .attr(\"data-mime-type\", mimeType.mime)\n                    .prop(\"checked\", mimeType.enabled))\n                .on('change', () => this.save())\n                .append(\" &nbsp; \")\n                .append($('<label>')\n                    .attr(\"for\", id)\n                    .text(mimeType.title))\n            );\n        }\n    }\n\n    async save() {\n        const enabledMimeTypes = [];\n\n        this.$mimeTypes.find(\"input:checked\").each(\n            (i, el) => enabledMimeTypes.push(this.$widget.find(el).attr(\"data-mime-type\")));\n\n        await this.updateOption('codeNotesMimeTypes', JSON.stringify(enabledMimeTypes));\n\n        mimeTypesService.loadMimeTypes();\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\nimport utils from \"../../../../services/utils.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>搜索引擎</h4>\n    \n    <p>自定义搜索引擎需要设置名称和URL。如果其中任何一个未设置，将使用DuckDuckGo作为默认搜索引擎。</p>\n    \n    <form class=\"sync-setup-form\">\n        <div class=\"form-group\">\n            <label>预定义的搜索引擎模板</label>\n            <select class=\"predefined-search-engine-select form-control\">\n                <option value=\"Bing\">必应</option>\n                <option value=\"Baidu\">百度</option>\n                <option value=\"DuckDuckGo\">DuckDuckGo</option>\n                <option value=\"Google\">谷歌</option>\n            </select>\n        </div>\n        \n        <div class=\"form-group\">\n            <label>自定义搜索引擎名称</label>\n            <input type=\"text\" class=\"custom-search-engine-name form-control\" placeholder=\"Customize search engine name\">\n        </div>\n        \n        <div class=\"form-group\">\n            <label>自定义搜索引擎的URL应该包含<code>{keyword}</code>作为搜索词的占位符。</label>\n            <input type=\"text\" class=\"custom-search-engine-url form-control\" placeholder=\"Customize search engine url\">\n        </div>\n        \n        <div style=\"display: flex; justify-content: space-between;\">\n            <button class=\"btn btn-primary\">保存</button>\n        </div>\n    </form>\n</div>`;\n\nconst SEARCH_ENGINES = {\n    \"Bing\": \"https://www.bing.com/search?q={keyword}\",\n    \"Baidu\": \"https://www.baidu.com/s?wd={keyword}\",\n    \"DuckDuckGo\": \"https://duckduckgo.com/?q={keyword}\",\n    \"Google\": \"https://www.google.com/search?q={keyword}\",\n}\n\nexport default class SearchEngineOptions extends OptionsWidget {\n    isEnabled() {\n        return super.isEnabled() && utils.isElectron();\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$form = this.$widget.find(\".sync-setup-form\");\n        this.$predefinedSearchEngineSelect = this.$widget.find(\".predefined-search-engine-select\");\n        this.$customSearchEngineName = this.$widget.find(\".custom-search-engine-name\");\n        this.$customSearchEngineUrl = this.$widget.find(\".custom-search-engine-url\");\n\n        this.$predefinedSearchEngineSelect.on('change', () => {\n            const predefinedSearchEngine = this.$predefinedSearchEngineSelect.val();\n            this.$customSearchEngineName[0].value = predefinedSearchEngine;\n            this.$customSearchEngineUrl[0].value = SEARCH_ENGINES[predefinedSearchEngine];\n        });\n\n        this.$form.on('submit', () => {\n            this.updateMultipleOptions({\n                'customSearchEngineName': this.$customSearchEngineName.val(),\n                'customSearchEngineUrl': this.$customSearchEngineUrl.val()\n            });\n        });\n    }\n\n    async optionsLoaded(options) {\n        this.$predefinedSearchEngineSelect.val(\"\");\n        this.$customSearchEngineName[0].value = options.customSearchEngineName;\n        this.$customSearchEngineUrl[0].value = options.customSearchEngineUrl;\n    }\n}\n","import NoteContextAwareWidget from \"../../note_context_aware_widget.js\";\nimport server from \"../../../services/server.js\";\n\nconst TPL = `<div style=\"height: 100%; display: flex; flex-direction: column;\">\n    <style>\n        .backend-log-textarea {\n            flex-grow: 1; \n            width: 100%;\n            border: none;\n        }   \n    </style>\n\n    <textarea class=\"backend-log-textarea\" readonly=\"readonly\"></textarea>\n    \n    <div style=\"display: flex; justify-content: space-around; margin-top: 10px;\">\n        <button class=\"refresh-backend-log-button btn btn-primary\">刷新</button>\n    </div>\n</div>`;\n\nexport default class BackendLogWidget extends NoteContextAwareWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$backendLogTextArea = this.$widget.find(\".backend-log-textarea\");\n        this.$refreshBackendLog = this.$widget.find(\".refresh-backend-log-button\");\n\n        this.$refreshBackendLog.on('click', () => this.load());\n    }\n\n    scrollToBottom() {\n        this.$backendLogTextArea.scrollTop(this.$backendLogTextArea[0].scrollHeight);\n    }\n\n    async refresh() {\n        await this.load();\n    }\n\n    async load() {\n        const backendLog = await server.get('backend-log');\n\n        this.$backendLogTextArea.text(backendLog);\n\n        this.scrollToBottom();\n    }\n}\n","import TypeWidget from \"./type_widget.js\";\nimport ZoomFactorOptions from \"./options/appearance/zoom_factor.js\";\nimport NativeTitleBarOptions from \"./options/appearance/native_title_bar.js\";\nimport ThemeOptions from \"./options/appearance/theme.js\";\nimport FontsOptions from \"./options/appearance/fonts.js\";\nimport MaxContentWidthOptions from \"./options/appearance/max_content_width.js\";\nimport KeyboardShortcutsOptions from \"./options/shortcuts.js\";\nimport HeadingStyleOptions from \"./options/text_notes/heading_style.js\";\nimport TableOfContentsOptions from \"./options/text_notes/table_of_contents.js\";\nimport HighlightsListOptions from \"./options/text_notes/highlights_list.js\";\nimport TextAutoReadOnlySizeOptions from \"./options/text_notes/text_auto_read_only_size.js\";\nimport VimKeyBindingsOptions from \"./options/code_notes/vim_key_bindings.js\";\nimport WrapLinesOptions from \"./options/code_notes/wrap_lines.js\";\nimport CodeAutoReadOnlySizeOptions from \"./options/code_notes/code_auto_read_only_size.js\";\nimport CodeMimeTypesOptions from \"./options/code_notes/code_mime_types.js\";\nimport ImageOptions from \"./options/images/images.js\";\nimport SpellcheckOptions from \"./options/spellcheck.js\";\nimport PasswordOptions from \"./options/password.js\";\nimport EtapiOptions from \"./options/etapi.js\";\nimport BackupOptions from \"./options/backup.js\";\nimport SyncOptions from \"./options/sync.js\";\nimport SearchEngineOptions from \"./options/other/search_engine.js\";\nimport TrayOptions from \"./options/other/tray.js\";\nimport NoteErasureTimeoutOptions from \"./options/other/note_erasure_timeout.js\";\nimport RevisionsSnapshotIntervalOptions from \"./options/other/revisions_snapshot_interval.js\";\nimport NetworkConnectionsOptions from \"./options/other/network_connections.js\";\nimport AdvancedSyncOptions from \"./options/advanced/sync.js\";\nimport DatabaseIntegrityCheckOptions from \"./options/advanced/database_integrity_check.js\";\nimport ConsistencyChecksOptions from \"./options/advanced/consistency_checks.js\";\nimport VacuumDatabaseOptions from \"./options/advanced/vacuum_database.js\";\nimport DatabaseAnonymizationOptions from \"./options/advanced/database_anonymization.js\";\nimport BackendLogWidget from \"./content/backend_log.js\";\nimport AttachmentErasureTimeoutOptions from \"./options/other/attachment_erasure_timeout.js\";\nimport RibbonOptions from \"./options/appearance/ribbon.js\";\n\nconst TPL = `<div class=\"note-detail-content-widget note-detail-printable\">\n    <style>\n        .type-contentWidget .note-detail {\n            height: 100%;\n        }\n        \n        .note-detail-content-widget {\n            height: 100%;\n        }\n    \n        .note-detail-content-widget-content {\n            padding: 15px;\n            height: 100%;\n        }\n    </style>\n\n    <div class=\"note-detail-content-widget-content\"></div>\n</div>`;\n\nconst CONTENT_WIDGETS = {\n    _optionsAppearance: [\n        ThemeOptions,\n        FontsOptions,\n        ZoomFactorOptions,\n        NativeTitleBarOptions,\n        MaxContentWidthOptions,\n        RibbonOptions\n    ],\n    _optionsShortcuts: [ KeyboardShortcutsOptions ],\n    _optionsTextNotes: [\n        HeadingStyleOptions,\n        TableOfContentsOptions,\n        HighlightsListOptions,\n        TextAutoReadOnlySizeOptions\n    ],\n    _optionsCodeNotes: [\n        VimKeyBindingsOptions,\n        WrapLinesOptions,\n        CodeAutoReadOnlySizeOptions,\n        CodeMimeTypesOptions\n    ],\n    _optionsImages: [ ImageOptions ],\n    _optionsSpellcheck: [ SpellcheckOptions ],\n    _optionsPassword: [ PasswordOptions ],\n    _optionsEtapi: [ EtapiOptions ],\n    _optionsBackup: [ BackupOptions ],\n    _optionsSync: [ SyncOptions ],\n    _optionsOther: [\n        SearchEngineOptions,\n        TrayOptions,\n        NoteErasureTimeoutOptions,\n        AttachmentErasureTimeoutOptions,\n        RevisionsSnapshotIntervalOptions,\n        NetworkConnectionsOptions\n    ],\n    _optionsAdvanced: [\n        DatabaseIntegrityCheckOptions,\n        ConsistencyChecksOptions,\n        DatabaseAnonymizationOptions,\n        AdvancedSyncOptions,\n        VacuumDatabaseOptions\n    ],\n    _backendLog: [ BackendLogWidget ]\n};\n\nexport default class ContentWidgetTypeWidget extends TypeWidget {\n    static getType() { return \"contentWidget\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$content = this.$widget.find(\".note-detail-content-widget-content\");\n\n        super.doRender();\n    }\n\n    async doRefresh(note) {\n        this.$content.empty();\n        this.children = [];\n\n        const contentWidgets = CONTENT_WIDGETS[note.noteId];\n\n        if (contentWidgets) {\n            for (const clazz of contentWidgets) {\n                const widget = new clazz();\n\n                await widget.handleEvent('setNoteContext', { noteContext: this.noteContext });\n                this.child(widget);\n\n                this.$content.append(widget.render());\n                await widget.refresh();\n            }\n        } else {\n            this.$content.append(`Unknown widget for \"${note.noteId}\"`);\n        }\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\nimport server from \"../../../../services/server.js\";\nimport utils from \"../../../../services/utils.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>主题</h4>\n    \n    <div class=\"form-group row\">\n        <div class=\"col-6\">\n            <label>主题</label>\n            <select class=\"theme-select form-control\"></select>\n        </div>\n        \n        <div class=\"col-6\">\n            <label>覆盖主题字体</label>\n            <input type=\"checkbox\" class=\"override-theme-fonts form-control\">\n        </div>\n    </div>\n</div>`;\n\nexport default class ThemeOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$themeSelect = this.$widget.find(\".theme-select\");\n        this.$overrideThemeFonts = this.$widget.find(\".override-theme-fonts\");\n\n        this.$themeSelect.on('change', async () => {\n            const newTheme = this.$themeSelect.val();\n\n            await server.put(`options/theme/${newTheme}`);\n\n            utils.reloadFrontendApp(\"theme change\");\n        });\n\n        this.$overrideThemeFonts.on('change', () => this.updateCheckboxOption('overrideThemeFonts', this.$overrideThemeFonts));\n    }\n\n    async optionsLoaded(options) {\n        const themes = [\n            { val: 'light', title: '明亮' },\n            { val: 'dark', title: '深色' }\n        ].concat(await server.get('options/user-themes'));\n\n        this.$themeSelect.empty();\n\n        for (const theme of themes) {\n            this.$themeSelect.append($(\"<option>\")\n                .attr(\"value\", theme.val)\n                .attr(\"data-note-id\", theme.noteId)\n                .text(theme.title));\n        }\n\n        this.$themeSelect.val(options.theme);\n\n        this.setCheckboxState(this.$overrideThemeFonts, options.overrideThemeFonts);\n    }\n}\n","import appContext from \"../../../../components/app_context.js\";\nimport OptionsWidget from \"../options_widget.js\";\nimport utils from \"../../../../services/utils.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>缩放系数(仅桌面客户端有效)</h4>\n\n    <input type=\"number\" class=\"zoom-factor-select form-control options-number-input\" min=\"0.3\" max=\"2.0\" step=\"0.1\"/>\n    <p>缩放可以通过 ctrl+- 和 ctrl+= 来控制.</p>\n</div>`;\n\nexport default class ZoomFactorOptions extends OptionsWidget {\n    isEnabled() {\n        return super.isEnabled() && utils.isElectron();\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$zoomFactorSelect = this.$widget.find(\".zoom-factor-select\");\n        this.$zoomFactorSelect.on('change', () => { appContext.triggerCommand('setZoomFactorAndSave', {zoomFactor: this.$zoomFactorSelect.val()}); });\n    }\n\n    async optionsLoaded(options) {\n        this.$zoomFactorSelect.val(options.zoomFactor);\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>原生标题栏(需要重启)</h4>\n    \n    <select class=\"native-title-bar-select form-control\">\n        <option value=\"show\">启用</option>\n        <option value=\"hide\">禁用</option>\n    </select>\n</div>`;\n\nexport default class NativeTitleBarOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$nativeTitleBarSelect = this.$widget.find(\".native-title-bar-select\");\n        this.$nativeTitleBarSelect.on('change', () => {\n            const nativeTitleBarVisible = this.$nativeTitleBarSelect.val() === 'show' ? 'true' : 'false';\n\n            this.updateOption('nativeTitleBarVisible', nativeTitleBarVisible);\n        });\n    }\n\n    async optionsLoaded(options) {\n        this.$nativeTitleBarSelect.val(options.nativeTitleBarVisible === 'true' ? 'show' : 'hide');\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\nimport utils from \"../../../../services/utils.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>内容宽度</h4>\n    \n    <p>Trilium默认会限制内容的最大宽度以提高在宽屏中全屏时的可读性.</p>\n    \n    <div class=\"form-group row\">\n        <div class=\"col-4\">\n            <label>内容最大宽度(像素)</label>\n            <input type=\"number\" min=\"200\" step=\"10\" class=\"max-content-width form-control options-number-input\">\n        </div>\n    </div>\n    \n    <p>\n        应用内容宽度修改, 请点击 \n        <button class=\"btn btn-micro reload-frontend-button\">重新加载前端</button>\n    </p>\n</div>`;\n\nexport default class MaxContentWidthOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$maxContentWidth = this.$widget.find(\".max-content-width\");\n\n        this.$maxContentWidth.on('change', async () =>\n            this.updateOption('maxContentWidth', this.$maxContentWidth.val()))\n\n        this.$widget.find(\".reload-frontend-button\").on(\"click\", () => utils.reloadFrontendApp(\"changes from appearance options\"));\n    }\n\n    async optionsLoaded(options) {\n        this.$maxContentWidth.val(options.maxContentWidth);\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>功能选项组件</h4>\n    <label>\n        <input type=\"checkbox\" class=\"promoted-attributes-open-in-ribbon\">\n        如果笔记中存在升级属性，升级属性功能选项卡将自动打开\n    </label>\n    \n    <label>\n        <input type=\"checkbox\" class=\"edited-notes-open-in-ribbon\">\n        日记笔记自动打开编辑过的笔记选项\n    </label>\n</div>`;\n\nexport default class RibbonOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$promotedAttributesOpenInRibbon = this.$widget.find(\".promoted-attributes-open-in-ribbon\");\n        this.$promotedAttributesOpenInRibbon.on('change', () =>\n            this.updateCheckboxOption('promotedAttributesOpenInRibbon', this.$promotedAttributesOpenInRibbon));\n\n        this.$editedNotesOpenInRibbon = this.$widget.find(\".edited-notes-open-in-ribbon\");\n        this.$editedNotesOpenInRibbon.on('change', () =>\n            this.updateCheckboxOption('editedNotesOpenInRibbon', this.$editedNotesOpenInRibbon));\n    }\n\n    async optionsLoaded(options) {\n        this.setCheckboxState(this.$promotedAttributesOpenInRibbon, options.promotedAttributesOpenInRibbon);\n        this.setCheckboxState(this.$editedNotesOpenInRibbon, options.editedNotesOpenInRibbon);\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>标题风格</h4>\n    \n    <select class=\"heading-style form-control\">\n        <option value=\"plain\">纯文本</option>\n        <option value=\"underline\">下划线</option>\n        <option value=\"markdown\">Markdown风格</option>\n    </select>\n</div>`;\n\nexport default class HeadingStyleOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$body = $(\"body\");\n        this.$headingStyle = this.$widget.find(\".heading-style\");\n        this.$headingStyle.on('change', () => {\n            const newHeadingStyle = this.$headingStyle.val();\n\n            this.toggleBodyClass(\"heading-style-\", newHeadingStyle);\n\n            this.updateOption('headingStyle', newHeadingStyle);\n        });\n    }\n\n    async optionsLoaded(options) {\n        this.$headingStyle.val(options.headingStyle);\n    }\n\n    toggleBodyClass(prefix, value) {\n        for (const clazz of Array.from(this.$body[0].classList)) { // create copy to safely iterate over while removing classes\n            if (clazz.startsWith(prefix)) {\n                this.$body.removeClass(clazz);\n            }\n        }\n\n        this.$body.addClass(prefix + value);\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>目录</h4>\n    \n    当笔记具有超过定义数量的标题时, 目录将出现在文本笔记中. 你可以自定义这个数值:\n    \n    <div class=\"form-group\">\n        <input type=\"number\" class=\"min-toc-headings form-control options-number-input options-number-input\" min=\"0\" max=\"9999999999999999\" step=\"1\" />\n    </div>\n    \n    <p>您可以设置一个非常大的数来禁用目录.</p>\n</div>`;\n\nexport default class TableOfContentsOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$minTocHeadings = this.$widget.find(\".min-toc-headings\");\n        this.$minTocHeadings.on('change', () =>\n            this.updateOption('minTocHeadings', this.$minTocHeadings.val()));\n    }\n\n    async optionsLoaded(options) {\n        this.$minTocHeadings.val(options.minTocHeadings);\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>高亮列表</h4>\n\n    <p>您可以自定义在右侧面板显示的高亮列表:</p>\n\n    </div>\n        <label><input type=\"checkbox\" class=\"highlights-list-check\" value=\"bold\"> 粗体字 &nbsp;</label>\n        <label><input type=\"checkbox\" class=\"highlights-list-check\" value=\"italic\"> 斜体字 &nbsp;</label>\n        <label><input type=\"checkbox\" class=\"highlights-list-check\" value=\"underline\"> 下划线字体 &nbsp;</label>\n        <label><input type=\"checkbox\" class=\"highlights-list-check\" value=\"color\"> 彩色字体 &nbsp;</label>\n        <label><input type=\"checkbox\" class=\"highlights-list-check\" value=\"bgColor\"> 带有背景色的字体 &nbsp;</label>\n    </div>\n\n    <br/><br/>\n    <h5>Highlists List visibility</h5>\n\n    <p>您可以通过添加 <code>#hideHighlightWidget</code> 标签来在每个笔记中隐藏高亮小部件。</p>\n</div>`;\n\nexport default class HighlightsListOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$hlt = this.$widget.find(\"input.highlights-list-check\");\n        this.$hlt.on('change', () => {\n            const hltVals = this.$widget.find('input.highlights-list-check[type=\"checkbox\"]:checked').map(function () {\n                return this.value;\n            }).get();\n            this.updateOption('highlightsList', JSON.stringify(hltVals));\n        });\n    }\n\n    async optionsLoaded(options) {\n        const hltVals = JSON.parse(options.highlightsList);\n        this.$widget.find('input.highlights-list-check[type=\"checkbox\"]').each(function () {\n            if ($.inArray($(this).val(), hltVals) !== -1) {\n                $(this).prop(\"checked\", true);\n            } else {\n                $(this).prop(\"checked\", false);\n            }\n        });\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>自动只读大小</h4>\n\n    <p>自动只读大小是指笔记超过设置的大小后自动设置为只读模式(为性能考虑)</p>\n\n    <div class=\"form-group\">\n        <label>自动只读大小 (文字笔记)</label>\n        <input class=\"auto-readonly-size-text form-control options-number-input\" type=\"number\" min=\"0\">\n    </div>\n</div>`;\n\nexport default class TextAutoReadOnlySizeOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$autoReadonlySizeText = this.$widget.find(\".auto-readonly-size-text\");\n        this.$autoReadonlySizeText.on('change', () =>\n            this.updateOption('autoReadonlySizeText', this.$autoReadonlySizeText.val()));\n    }\n\n    async optionsLoaded(options) {\n        this.$autoReadonlySizeText.val(options.autoReadonlySizeText);\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>在代码笔记中使用vim按键绑定(无ex模式)</h4>\n    <label>\n        <input type=\"checkbox\" class=\"vim-keymap-enabled\">\n        启用vim按键绑定\n    </label>\n</div>`;\n\nexport default class VimKeyBindingsOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$vimKeymapEnabled = this.$widget.find(\".vim-keymap-enabled\");\n        this.$vimKeymapEnabled.on('change', () =>\n            this.updateCheckboxOption('vimKeymapEnabled', this.$vimKeymapEnabled));\n    }\n\n    async optionsLoaded(options) {\n        this.setCheckboxState(this.$vimKeymapEnabled, options.vimKeymapEnabled);\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>代码笔记自动换行</h4>\n    <label>\n        <input type=\"checkbox\" class=\"line-wrap-enabled\">\n        启用自动换行(需要重新加载前端才会生效)\n    </label>\n</div>`;\n\nexport default class WrapLinesOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$codeLineWrapEnabled = this.$widget.find(\".line-wrap-enabled\");\n        this.$codeLineWrapEnabled.on('change', () =>\n            this.updateCheckboxOption('codeLineWrapEnabled', this.$codeLineWrapEnabled));\n    }\n\n    async optionsLoaded(options) {\n        this.setCheckboxState(this.$codeLineWrapEnabled, options.codeLineWrapEnabled);\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>自动只读大小</h4>\n\n    <p>自动只读大小是指笔记超过设置的大小后自动设置为只读模式(为性能考虑)</p>\n\n    <div class=\"form-group\">\n        <label>自动只读大小 (代码笔记)</label>\n        <input class=\"auto-readonly-size-code form-control options-number-input\" type=\"number\" min=\"0\">\n    </div>\n</div>`;\n\nexport default class CodeAutoReadOnlySizeOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$autoReadonlySizeCode = this.$widget.find(\".auto-readonly-size-code\");\n        this.$autoReadonlySizeCode.on('change', () =>\n            this.updateOption('autoReadonlySizeCode', this.$autoReadonlySizeCode.val()));\n    }\n\n    async optionsLoaded(options) {\n        this.$autoReadonlySizeCode.val(options.autoReadonlySizeCode);\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <style>\n        .options-section .disabled-field {\n            opacity: 0.5;\n            pointer-events: none;\n        }\n    </style>\n\n    <h4>图片</h4>\n    \n    <label>\n        <input class=\"download-images-automatically\" type=\"checkbox\" name=\"download-images-automatically\">\n        自动下载图片以便于离线使用.\n    </label>\n    \n    <p>(粘贴的HTML可能包含在线图片的引用, Trilium会找到并下载这些图片用于离线使用)</p>\n    \n    <label>\n        <input class=\"image-compresion-enabled\" type=\"checkbox\" name=\"image-compression-enabled\">\n        启用图像压缩\n    </label>\n\n    <div class=\"image-compression-enabled-wraper\">\n        <div class=\"form-group\">\n            <label>图片的最大像素宽度和高度(超过限制会缩放).</label>\n            <input class=\"image-max-width-height form-control options-number-input\" type=\"number\" min=\"1\">\n        </div>\n    \n        <div class=\"form-group\">\n            <label>JPEG质量 (10最低, 100最好, 推荐设置为50-85之间)</label>\n            <input class=\"image-jpeg-quality form-control options-number-input\" min=\"10\" max=\"100\" type=\"number\">\n        </div>\n    </div>\n</div>\n`;\n\nexport default class ImageOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$imageMaxWidthHeight = this.$widget.find(\".image-max-width-height\");\n        this.$imageJpegQuality = this.$widget.find(\".image-jpeg-quality\");\n\n        this.$imageMaxWidthHeight.on('change', () =>\n            this.updateOption('imageMaxWidthHeight', this.$imageMaxWidthHeight.val()));\n\n        this.$imageJpegQuality.on('change', () =>\n            this.updateOption('imageJpegQuality', this.$imageJpegQuality.val().trim() || \"75\"));\n\n        this.$downloadImagesAutomatically = this.$widget.find(\".download-images-automatically\");\n\n        this.$downloadImagesAutomatically.on(\"change\", () =>\n            this.updateCheckboxOption('downloadImagesAutomatically', this.$downloadImagesAutomatically));\n\n        this.$enableImageCompression = this.$widget.find(\".image-compresion-enabled\");\n        this.$imageCompressionWrapper = this.$widget.find(\".image-compression-enabled-wraper\");\n\n        this.$enableImageCompression.on(\"change\", () => {\n            this.updateCheckboxOption('compressImages', this.$enableImageCompression);\n            this.setImageCompression();\n        });\n    }\n\n    optionsLoaded(options) {\n        this.$imageMaxWidthHeight.val(options.imageMaxWidthHeight);\n        this.$imageJpegQuality.val(options.imageJpegQuality);\n\n        this.setCheckboxState(this.$downloadImagesAutomatically, options.downloadImagesAutomatically);\n        this.setCheckboxState(this.$enableImageCompression, options.compressImages);\n\n        this.setImageCompression();\n    }\n\n    setImageCompression() {\n        if (this.$enableImageCompression.prop(\"checked\")) {\n            this.$imageCompressionWrapper.removeClass(\"disabled-field\");\n        } else {\n            this.$imageCompressionWrapper.addClass(\"disabled-field\");\n        }\n    }\n}\n","import utils from \"../../../services/utils.js\";\nimport OptionsWidget from \"./options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>拼写检查</h4>\n\n    <p>这些选项只在桌面客户端有效, 浏览器会使用浏览器的拼写检查. 修改设置后需要重启应用.</p>\n\n    <label>\n        <input type=\"checkbox\" class=\"spell-check-enabled\">\n        开启拼写检查\n    </label>\n\n    <br/>\n\n    <div class=\"form-group\">\n        <label>语言码</label>\n        <input type=\"text\" class=\"spell-check-language-code form-control\" placeholder=\"for example &quot;en-US&quot;, &quot;de-AT&quot;\">\n    </div>\n\n    <p>多个语言可以用逗号分隔, 例如: <code>en-US, de-DE, cs</code>. 拼写检查选项的修改将在应用程序重新启动后生效.</p>\n    \n    <p><strong>可用的语言代码</strong> <span class=\"available-language-codes\"></span></p>\n</div>`;\n\nexport default class SpellcheckOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$spellCheckEnabled = this.$widget.find(\".spell-check-enabled\");\n        this.$spellCheckLanguageCode = this.$widget.find(\".spell-check-language-code\");\n\n        this.$spellCheckEnabled.on('change', () =>\n            this.updateCheckboxOption('spellCheckEnabled', this.$spellCheckEnabled));\n\n        this.$spellCheckLanguageCode.on('change', () =>\n            this.updateOption('spellCheckLanguageCode', this.$spellCheckLanguageCode.val()));\n\n        this.$availableLanguageCodes = this.$widget.find(\".available-language-codes\");\n\n        if (utils.isElectron()) {\n            const { webContents } = utils.dynamicRequire('@electron/remote').getCurrentWindow();\n\n            this.$availableLanguageCodes.text(webContents.session.availableSpellCheckerLanguages.join(', '));\n        }\n    }\n\n    optionsLoaded(options) {\n        this.setCheckboxState(this.$spellCheckEnabled, options.spellCheckEnabled);\n        this.$spellCheckLanguageCode.val(options.spellCheckLanguageCode);\n    }\n}\n","import server from \"../../../services/server.js\";\nimport protectedSessionHolder from \"../../../services/protected_session_holder.js\";\nimport toastService from \"../../../services/toast.js\";\nimport OptionsWidget from \"./options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4 class=\"password-heading\"></h4>\n    \n    <div class=\"alert alert-warning\" role=\"alert\" style=\"font-weight: bold; color: red !important;\">\n      请一定要记住你的新密码. 密码被用来登录和加密笔记. 如果你忘记了密码, 所有受保护的笔记将永远丢失. \n      如果你忘记了密码, <a class=\"reset-password-button\" href=\"javascript:\">点击这里来重置它</a>.\n    </div>\n    \n    <form class=\"change-password-form\">\n        <div class=\"old-password-form-group form-group\">\n            <label>旧密码</label>\n            <input class=\"old-password form-control\" type=\"password\">\n        </div>\n    \n        <div class=\"form-group\">\n            <label>新密码</label>\n            <input class=\"new-password1 form-control\" type=\"password\">\n        </div>\n    \n        <div class=\"form-group\">\n            <label>新密码确认</label>\n            <input class=\"new-password2 form-control\" type=\"password\">\n        </div>\n    \n        <button class=\"save-password-button btn btn-primary\">修改密码</button>\n    </form>\n</div>\n\n<div class=\"options-section\">\n    <h4>保护会话超时</h4>\n\n    <p>保护会话超时是从浏览器内存里清理保护会话的间隔, 这个时间从最后一次编辑保护的笔记开始计算. 详见 <a href=\"https://github.com/zadam/trilium/wiki/Protected-notes\" class=\"external\">wiki</a> 以获取更多信息</p>\n\n    <div class=\"form-group\">\n        <label>保护会话超时(单位:秒)</label>\n        <input class=\"protected-session-timeout-in-seconds form-control options-number-input\" type=\"number\" min=\"60\">\n    </div>\n</div>`;\n\nexport default class PasswordOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$passwordHeading = this.$widget.find(\".password-heading\");\n        this.$changePasswordForm = this.$widget.find(\".change-password-form\");\n        this.$oldPassword = this.$widget.find(\".old-password\");\n        this.$newPassword1 = this.$widget.find(\".new-password1\");\n        this.$newPassword2 = this.$widget.find(\".new-password2\");\n        this.$savePasswordButton = this.$widget.find(\".save-password-button\");\n        this.$resetPasswordButton = this.$widget.find(\".reset-password-button\");\n\n        this.$resetPasswordButton.on(\"click\", async () => {\n            if (confirm(\"重置密码会永远丢失所有受保护的笔记. 确定要重置密码吗?\")) {\n                await server.post(\"password/reset?really=yesIReallyWantToResetPasswordAndLoseAccessToMyProtectedNotes\");\n\n                const options = await server.get('options');\n                this.optionsLoaded(options);\n\n                toastService.showError(\"Password has been reset. Please set new password\");\n            }\n        });\n\n        this.$changePasswordForm.on('submit', () => this.save());\n\n        this.$protectedSessionTimeout = this.$widget.find(\".protected-session-timeout-in-seconds\");\n        this.$protectedSessionTimeout.on('change', () =>\n            this.updateOption('protectedSessionTimeout', this.$protectedSessionTimeout.val()));\n    }\n\n    optionsLoaded(options) {\n        const isPasswordSet = options.isPasswordSet === 'true';\n\n        this.$widget.find(\".old-password-form-group\").toggle(isPasswordSet);\n        this.$passwordHeading.text(isPasswordSet ? '修改密码' : '设置密码');\n        this.$savePasswordButton.text(isPasswordSet ? '修改密码' : '设置密码');\n        this.$protectedSessionTimeout.val(options.protectedSessionTimeout);\n    }\n\n    save() {\n        const oldPassword = this.$oldPassword.val();\n        const newPassword1 = this.$newPassword1.val();\n        const newPassword2 = this.$newPassword2.val();\n\n        this.$oldPassword.val('');\n        this.$newPassword1.val('');\n        this.$newPassword2.val('');\n\n        if (newPassword1 !== newPassword2) {\n            toastService.showError(\"New passwords are not the same.\");\n            return false;\n        }\n\n        server.post('password/change', {\n            'current_password': oldPassword,\n            'new_password': newPassword1\n        }).then(result => {\n            if (result.success) {\n                toastService.showError(\"Password has been changed. Trilium will be reloaded after you press OK.\");\n\n                // password changed so current protected session is invalid and needs to be cleared\n                protectedSessionHolder.resetProtectedSession();\n            }\n            else {\n                toastService.showError(result.message);\n            }\n        });\n\n        return false;\n    }\n}\n","import server from \"../../../services/server.js\";\nimport dialogService from \"../../../services/dialog.js\";\nimport toastService from \"../../../services/toast.js\";\nimport OptionsWidget from \"./options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>ETAPI</h4>\n    \n    <p>ETAPI 是一个 REST API, 用于以编程方式访问 Trilium 实例, 无需 UI. <br/>\n       更多信息请访问 <a href=\"https://github.com/zadam/trilium/wiki/ETAPI\">wiki</a> 和 <a onclick=\"window.open('etapi/etapi.openapi.yaml')\" href=\"etapi/etapi.openapi.yaml\">ETAPI OpenAPI 文档</a>.</p>\n    \n    <button type=\"button\" class=\"create-etapi-token btn btn-sm\">创建新的 ETAPI 令牌</button>\n\n    <h5>已有令牌</h5>\n    \n    <div class=\"no-tokens-yet\">暂无令牌. 点击上方按钮来创建令牌.</div>\n    \n    <div style=\"overflow: auto; height: 500px;\">\n        <table class=\"tokens-table table table-stripped\">\n        <thead>\n            <tr>\n                <th>令牌名称</th>\n                <th>创建</th>\n                <th>动作</th>\n            </tr>\n        </thead>\n        <tbody></tbody>\n        </table>\n    </div>\n</div>\n\n<style>\n    .token-table-button {\n        display: inline-block;\n        cursor: pointer;\n        padding: 3px;\n        margin-right: 20px;\n        font-size: large;\n        border: 1px solid transparent;\n        border-radius: var(--button-border-radius);\n    }\n    \n    .token-table-button:hover {\n        border: 1px solid var(--button-border-color);\n    }\n</style>`;\n\nexport default class EtapiOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$widget.find(\".create-etapi-token\").on(\"click\", async () => {\n            const tokenName = await dialogService.prompt({\n                title: \"新的 ETAPI 令牌\",\n                message: \"请输入新令牌的名称\",\n                defaultValue: \"新令牌\"\n            });\n\n            if (!tokenName.trim()) {\n                toastService.showError(\"令牌名称不能为空\");\n                return;\n            }\n\n            const {authToken} = await server.post('etapi-tokens', {tokenName});\n\n            await dialogService.prompt({\n                title: \"ETAPI 令牌已创建\",\n                message: '复制新令牌到剪贴板. Trilium会保存令牌的哈希值, 请注意这将是你最后一次看到这个令牌.',\n                defaultValue: authToken\n            });\n\n            this.refreshTokens();\n        });\n\n        this.refreshTokens();\n    }\n\n    async refreshTokens() {\n        const $noTokensYet = this.$widget.find(\".no-tokens-yet\");\n        const $tokensTable = this.$widget.find(\".tokens-table\");\n\n        const tokens = await server.get('etapi-tokens');\n\n        $noTokensYet.toggle(tokens.length === 0);\n        $tokensTable.toggle(tokens.length > 0);\n\n        const $tokensTableBody = $tokensTable.find(\"tbody\");\n        $tokensTableBody.empty();\n\n        for (const token of tokens) {\n            $tokensTableBody.append(\n                $(\"<tr>\")\n                    .append($(\"<td>\").text(token.name))\n                    .append($(\"<td>\").text(token.utcDateCreated))\n                    .append($(\"<td>\").append(\n                        $('<span class=\"bx bx-pen token-table-button\" title=\"重命名此令牌\"></span>')\n                            .on(\"click\", () => this.renameToken(token.etapiTokenId, token.name)),\n                        $('<span class=\"bx bx-trash token-table-button\" title=\"删除/停用此令牌\"></span>')\n                            .on(\"click\", () => this.deleteToken(token.etapiTokenId, token.name))\n                    ))\n            );\n        }\n    }\n\n    async renameToken(etapiTokenId, oldName) {\n        const tokenName = await dialogService.prompt({\n            title: \"重命名令牌\",\n            message: \"请输入新令牌的名称\",\n            defaultValue: oldName\n        });\n\n        if (!tokenName?.trim()) {\n            return;\n        }\n\n        await server.patch(`etapi-tokens/${etapiTokenId}`, {name: tokenName});\n\n        this.refreshTokens();\n    }\n\n    async deleteToken(etapiTokenId, name) {\n        if (!await dialogService.confirm(`你确认要删除ETAPI令牌 \"${name}\"?`)) {\n            return;\n        }\n\n        await server.remove(`etapi-tokens/${etapiTokenId}`);\n\n        this.refreshTokens();\n    }\n}\n","import server from \"../../../services/server.js\";\nimport toastService from \"../../../services/toast.js\";\nimport OptionsWidget from \"./options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>自动备份</h4>\n    \n    <p>Trilium 可以自动备份数据库:</p>\n    \n    <ul style=\"list-style: none\">\n        <li>\n            <label>\n                <input type=\"checkbox\" class=\"daily-backup-enabled\">\n                启用每日备份\n            </label>\n        </li>\n        <li>    \n            <label>\n                <input type=\"checkbox\" class=\"weekly-backup-enabled\">\n                启用每周备份\n            </label>\n        </li>\n        <li>\n        <label>\n            <input type=\"checkbox\" class=\"monthly-backup-enabled\">\n            启用每月备份\n            </label>\n        </li>\n    </ul>\n    \n    <p>建议打开备份功能, 但这可能会使大型数据库和/或慢速存储设备的应用程序启动变慢.</p>\n</div>\n\n<div class=\"options-section\">\n    <h4>立即备份</h4>\n    \n    <button class=\"backup-database-button btn\">立即备份数据库</button>\n</div>\n\n<div class=\"options-section\">\n    <h4>已有备份</h4>\n    \n    <ul class=\"existing-backup-list\"></ul>\n</div>\n`;\n\nexport default class BackupOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$backupDatabaseButton = this.$widget.find(\".backup-database-button\");\n\n        this.$backupDatabaseButton.on('click', async () => {\n            const {backupFile} = await server.post('database/backup-database');\n\n            toastService.showMessage(`数据库已备份至${backupFile}`, 10000);\n\n            this.refresh();\n        });\n\n        this.$dailyBackupEnabled = this.$widget.find(\".daily-backup-enabled\");\n        this.$weeklyBackupEnabled = this.$widget.find(\".weekly-backup-enabled\");\n        this.$monthlyBackupEnabled = this.$widget.find(\".monthly-backup-enabled\");\n\n        this.$dailyBackupEnabled.on('change', () =>\n            this.updateCheckboxOption('dailyBackupEnabled', this.$dailyBackupEnabled));\n\n        this.$weeklyBackupEnabled.on('change', () =>\n            this.updateCheckboxOption('weeklyBackupEnabled', this.$weeklyBackupEnabled));\n\n        this.$monthlyBackupEnabled.on('change', () =>\n            this.updateCheckboxOption('monthlyBackupEnabled', this.$monthlyBackupEnabled));\n\n        this.$existingBackupList = this.$widget.find(\".existing-backup-list\");\n    }\n\n    optionsLoaded(options) {\n        this.setCheckboxState(this.$dailyBackupEnabled, options.dailyBackupEnabled);\n        this.setCheckboxState(this.$weeklyBackupEnabled, options.weeklyBackupEnabled);\n        this.setCheckboxState(this.$monthlyBackupEnabled, options.monthlyBackupEnabled);\n\n        server.get(\"database/backups\").then(backupFiles => {\n            this.$existingBackupList.empty();\n\n            if (!backupFiles.length) {\n                backupFiles = [{filePath: \"还没有备份\", mtime: ''}];\n            }\n\n            for (const {filePath, mtime} of backupFiles) {\n                this.$existingBackupList.append($(\"<li>\").text(`${filePath} ${mtime ? ` - ${mtime}` : ''}`));\n            }\n        });\n    }\n}\n","import server from \"../../../services/server.js\";\nimport toastService from \"../../../services/toast.js\";\nimport OptionsWidget from \"./options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4 style=\"margin-top: 0px;\">同步设置</h4>\n    \n    <form class=\"sync-setup-form\">\n        <div class=\"form-group\">\n            <label>服务器地址</label>\n            <input class=\"sync-server-host form-control\" placeholder=\"https://<host>:<port>\">\n        </div>\n    \n        <div class=\"form-group\">\n            <label>同步超时(单位:毫秒)</label>\n            <input class=\"sync-server-timeout form-control\" min=\"1\" max=\"10000000\" type=\"number\" style=\"text-align: left;\">\n        </div>\n    \n        <div class=\"form-group\">\n            <label>同步代理服务器(可选)</label>\n            <input class=\"sync-proxy form-control\" placeholder=\"https://<host>:<port>\">\n    \n            <p><strong>备注:</strong> 代理设置留空则使用系统代理(仅桌面客户端有效).</p>\n            <p>另一个特殊值是<code>noproxy</code>，它会强制忽略代理，即使是系统代理也会忽略，并且会遵从<code>NODE_TLS_REJECT_UNAUTHORIZED</code>.</p>\n        </div>\n    \n        <div style=\"display: flex; justify-content: space-between;\">\n            <button class=\"btn btn-primary\">保存</button>\n    \n            <button class=\"btn\" type=\"button\" data-help-page=\"Synchronization\">帮助</button>\n        </div>\n    </form>\n</div>\n\n<div class=\"options-section\">\n    <h4>同步测试</h4>\n    \n    <p>测试和同步服务器之间的连接. 如果同步服务器没有初始化, 会将本地文档同步到同步服务器上.</p>\n    \n    <button class=\"test-sync-button btn\">测试同步</button>\n</div>`;\n\nexport default class SyncOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$form = this.$widget.find(\".sync-setup-form\");\n        this.$syncServerHost = this.$widget.find(\".sync-server-host\");\n        this.$syncServerTimeout = this.$widget.find(\".sync-server-timeout\");\n        this.$syncProxy = this.$widget.find(\".sync-proxy\");\n        this.$testSyncButton = this.$widget.find(\".test-sync-button\");\n\n        this.$form.on('submit', () => this.save());\n\n        this.$testSyncButton.on('click', async () => {\n            const result = await server.post('sync/test');\n\n            if (result.success) {\n                toastService.showMessage(result.message);\n            }\n            else {\n                toastService.showError(`Sync server handshake failed, error: ${result.message}`);\n            }\n        });\n    }\n\n    optionsLoaded(options) {\n        this.$syncServerHost.val(options.syncServerHost);\n        this.$syncServerTimeout.val(options.syncServerTimeout);\n        this.$syncProxy.val(options.syncProxy);\n    }\n\n    save() {\n        this.updateMultipleOptions({\n            'syncServerHost': this.$syncServerHost.val(),\n            'syncServerTimeout': this.$syncServerTimeout.val(),\n            'syncProxy': this.$syncProxy.val()\n        });\n\n        return false;\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>托盘</h4>\n\n    <label>\n        <input type=\"checkbox\" class=\"tray-enabled\">\n        启用托盘图标(修改需要重启生效)\n    </label>\n</div>`;\n\nexport default class TrayOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$trayEnabled = this.$widget.find(\".tray-enabled\");\n        this.$trayEnabled.on('change', () =>\n            this.updateOption('disableTray', !this.$trayEnabled.is(\":checked\") ? \"true\" : \"false\"));\n    }\n\n    async optionsLoaded(options) {\n        this.$trayEnabled.prop(\"checked\", options.disableTray !== 'true');\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\nimport server from \"../../../../services/server.js\";\nimport toastService from \"../../../../services/toast.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>笔记清理超时</h4>\n\n    <p>被删除的笔记(属性, 修改版本等)只是被标记为\"删除\", 是可以从\"最近笔记\"还原的. 过了一段时间这些笔记会被\"清理\", 被清理的笔记就无法还原了. 这个设置可以用来调整从\"删除\"到被\"清理\"的时间间隔</p>\n\n    <div class=\"form-group\">\n        <label>超过X秒后清理笔记</label>\n        <input class=\"erase-entities-after-time-in-seconds form-control options-number-input\" type=\"number\" min=\"0\">\n    </div>\n    \n    <p>您也可以手动触发清理（而不考虑上述定义的超时时间）:</p>\n    \n    <button class=\"erase-deleted-notes-now-button btn\">清理已删除的笔记</button>\n</div>`;\n\nexport default class NoteErasureTimeoutOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$eraseEntitiesAfterTimeInSeconds = this.$widget.find(\".erase-entities-after-time-in-seconds\");\n        this.$eraseEntitiesAfterTimeInSeconds.on('change', () => this.updateOption('eraseEntitiesAfterTimeInSeconds', this.$eraseEntitiesAfterTimeInSeconds.val()));\n\n        this.$eraseDeletedNotesButton = this.$widget.find(\".erase-deleted-notes-now-button\");\n        this.$eraseDeletedNotesButton.on('click', () => {\n            server.post('notes/erase-deleted-notes-now').then(() => {\n                toastService.showMessage(\"删除的笔记已被清理.\");\n            });\n        });\n    }\n\n    async optionsLoaded(options) {\n        this.$eraseEntitiesAfterTimeInSeconds.val(options.eraseEntitiesAfterTimeInSeconds);\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\nimport server from \"../../../../services/server.js\";\nimport toastService from \"../../../../services/toast.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>附件清理超时</h4>\n\n    <p>如果附件在一段时间后不再被笔记引用，它们将自动被删除(并被清理)。</p>\n\n    <div class=\"form-group\">\n        <label>在附件在笔记中未被使用 X 秒后清理附件</label>\n        <input class=\"erase-unused-attachments-after-time-in-seconds form-control options-number-input\" type=\"number\" min=\"0\">\n    </div>\n    \n    <p>您也可以手动触发清理（而不考虑上述定义的超时时间）:</p>\n    \n    <button class=\"erase-unused-attachments-now-button btn\">立即清理未使用的附件</button>\n</div>`;\n\nexport default class AttachmentErasureTimeoutOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$eraseUnusedAttachmentsAfterTimeInSeconds = this.$widget.find(\".erase-unused-attachments-after-time-in-seconds\");\n        this.$eraseUnusedAttachmentsAfterTimeInSeconds.on('change', () => this.updateOption('eraseUnusedAttachmentsAfterSeconds', this.$eraseUnusedAttachmentsAfterTimeInSeconds.val()));\n\n        this.$eraseUnusedAttachmentsNowButton = this.$widget.find(\".erase-unused-attachments-now-button\");\n        this.$eraseUnusedAttachmentsNowButton.on('click', () => {\n            server.post('notes/erase-unused-attachments-now').then(() => {\n                toastService.showMessage(\"未使用的附件已被删除.\");\n            });\n        });\n    }\n\n    async optionsLoaded(options) {\n        this.$eraseUnusedAttachmentsAfterTimeInSeconds.val(options.eraseUnusedAttachmentsAfterSeconds);\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>笔记修改快照间隔</h4>\n\n    <p>这个是笔记修改后创建快照的时间. 详见:<a href=\"https://github.com/zadam/trilium/wiki/Note-revisions\" class=\"external\">wiki</a> 以获取更多信息</p>\n\n    <div class=\"form-group\">\n        <label>笔记修改快照间隔(单位:秒)</label>\n        <input class=\"revision-snapshot-time-interval-in-seconds form-control options-number-input\" type=\"number\" min=\"10\">\n    </div>\n</div>`;\n\nexport default class RevisionsSnapshotIntervalOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$revisionsTimeInterval = this.$widget.find(\".revision-snapshot-time-interval-in-seconds\");\n        this.$revisionsTimeInterval.on('change', () =>\n            this.updateOption('revisionSnapshotTimeInterval', this.$revisionsTimeInterval.val()));\n    }\n\n    async optionsLoaded(options) {\n        this.$revisionsTimeInterval.val(options.revisionSnapshotTimeInterval);\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>网络连接</h4>\n        \n    <label>\n        <input class=\"check-for-updates\" type=\"checkbox\" name=\"check-for-updates\">\n        自动检查更新\n    </label>\n</div>`;\n\nexport default class NetworkConnectionsOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$checkForUpdates = this.$widget.find(\".check-for-updates\");\n        this.$checkForUpdates.on(\"change\", () =>\n            this.updateCheckboxOption('checkForUpdates', this.$checkForUpdates));\n    }\n\n    async optionsLoaded(options) {\n        this.setCheckboxState(this.$checkForUpdates, options.checkForUpdates);\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\nimport toastService from \"../../../../services/toast.js\";\nimport server from \"../../../../services/server.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>数据库完整性检查</h4>\n    \n    <p>检查SQLite数据库是否损坏. 根据数据库大小, 可能会需要一些时间.</p>\n    \n    <button class=\"check-integrity-button btn\">检查数据库完整性</button>\n</div>`;\n\nexport default class DatabaseIntegrityCheckOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$checkIntegrityButton = this.$widget.find(\".check-integrity-button\");\n        this.$checkIntegrityButton.on('click', async () => {\n            toastService.showMessage(\"正在检查数据库完整性...\");\n\n            const {results} = await server.get('database/check-integrity');\n\n            if (results.length === 1 && results[0].integrity_check === \"ok\") {\n                toastService.showMessage(\"完整性检查成功 - 未发现问题.\");\n            }\n            else {\n                toastService.showMessage(`Integrity check failed: ${JSON.stringify(results, null, 2)}`, 15000);\n            }\n        });\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\nimport toastService from \"../../../../services/toast.js\";\nimport server from \"../../../../services/server.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>一致性检查</h4>\n    \n    <button class=\"find-and-fix-consistency-issues-button btn\">查找并解决一致性问题</button>\n</div>`;\n\nexport default class ConsistencyChecksOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$findAndFixConsistencyIssuesButton = this.$widget.find(\".find-and-fix-consistency-issues-button\");\n        this.$findAndFixConsistencyIssuesButton.on('click', async () => {\n            toastService.showMessage(\"查找并修复一致性问题...\");\n\n            await server.post('database/find-and-fix-consistency-issues');\n\n            toastService.showMessage(\"一致性问题应该已经解决了.\");\n        });\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\nimport toastService from \"../../../../services/toast.js\";\nimport server from \"../../../../services/server.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>数据库匿名化</h4>\n    \n    <h5>完全匿名化</h5>\n    \n    <p>这会创建一个数据库的副本并匿名化处理(删除所有笔记内容, 仅保留结构和一些非敏感的元数据信息)用来分享到网上做调试而不用担心泄漏你的个人资料.</p>\n    \n    <button class=\"anonymize-full-button btn\">保存完全匿名化的数据库</button>\n\n    <h5>轻度匿名化</h5>\n    \n    <p>此操作将创建数据库的新副本并对其进行轻度匿名化 - 仅删除所有笔记的内容,但标题和属性将保留. 另外, 自定义前端和后端JS代码以及自定义部件会保留. 这会给查找bug提供更完整的环境.</p>\n    \n    <p>您可以自行决定是否要提供完全或轻度匿名化的数据库. 完全匿名化的数据库会对解决问题有帮助, 在一些情况下, 如果能提供轻度匿名化的数据库能加快定位bug和修复的过程.</p>\n    \n    <button class=\"anonymize-light-button btn\">保存轻度匿名化的数据库</button>\n    \n    <h5>已有匿名化数据库</h5>\n    \n    <ul class=\"existing-anonymized-databases\"></ul>\n</div>`;\n\nexport default class DatabaseAnonymizationOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$anonymizeFullButton = this.$widget.find(\".anonymize-full-button\");\n        this.$anonymizeLightButton = this.$widget.find(\".anonymize-light-button\");\n        this.$anonymizeFullButton.on('click', async () => {\n            toastService.showMessage(\"创建完全匿名的数据库...\");\n\n            const resp = await server.post('database/anonymize/full');\n\n            if (!resp.success) {\n                toastService.showError(\"无法创建匿名化数据库, 详情请检查后台日志.\");\n            }\n            else {\n                toastService.showMessage(`Created fully anonymized database in ${resp.anonymizedFilePath}`, 10000);\n            }\n\n            this.refresh();\n        });\n\n        this.$anonymizeLightButton.on('click', async () => {\n            toastService.showMessage(\"创建轻度匿名数据库...\");\n\n            const resp = await server.post('database/anonymize/light');\n\n            if (!resp.success) {\n                toastService.showError(\"无法创建匿名化数据库, 详情请检查后台日志.\");\n            }\n            else {\n                toastService.showMessage(`Created lightly anonymized database in ${resp.anonymizedFilePath}`, 10000);\n            }\n\n            this.refresh();\n        });\n\n        this.$existingAnonymizedDatabases = this.$widget.find(\".existing-anonymized-databases\");\n    }\n\n    optionsLoaded(options) {\n        server.get(\"database/anonymized-databases\").then(anonymizedDatabases => {\n            this.$existingAnonymizedDatabases.empty();\n\n            if (!anonymizedDatabases.length) {\n                anonymizedDatabases = [{filePath: \"还没有匿名化的数据库\"}];\n            }\n\n            for (const {filePath} of anonymizedDatabases) {\n                this.$existingAnonymizedDatabases.append($(\"<li>\").text(filePath));\n            }\n        });\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\nimport server from \"../../../../services/server.js\";\nimport toastService from \"../../../../services/toast.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>同步</h4>\n    <button class=\"force-full-sync-button btn\">强制完全同步</button> \n    \n    <button class=\"fill-entity-changes-button btn\">填充变化记录</button>\n</div>`;\n\nexport default class AdvancedSyncOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$forceFullSyncButton = this.$widget.find(\".force-full-sync-button\");\n        this.$fillEntityChangesButton = this.$widget.find(\".fill-entity-changes-button\");\n        this.$forceFullSyncButton.on('click', async () => {\n            await server.post('sync/force-full-sync');\n\n            toastService.showMessage(\"完全同步已触发\");\n        });\n\n        this.$fillEntityChangesButton.on('click', async () => {\n            toastService.showMessage(\"填充实体修改数据...\");\n\n            await server.post('sync/fill-entity-changes');\n\n            toastService.showMessage(\"同步行已成功填充\");\n        });\n    }\n\n    async optionsLoaded(options) {\n\n    }\n}\n","import OptionsWidget from \"../options_widget.js\";\nimport toastService from \"../../../../services/toast.js\";\nimport server from \"../../../../services/server.js\";\n\nconst TPL = `\n<div class=\"options-section\">\n    <h4>整理数据库</h4>\n    \n    <p>这会重建数据库, 通常会减少占用空间, 不会删除数据.</p>\n    \n    <button class=\"vacuum-database-button btn\">整理数据库</button>\n</div>`;\n\nexport default class VacuumDatabaseOptions extends OptionsWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$vacuumDatabaseButton = this.$widget.find(\".vacuum-database-button\");\n        this.$vacuumDatabaseButton.on('click', async () => {\n            toastService.showMessage(\"整理数据库...\");\n\n            await server.post('database/vacuum-database');\n\n            toastService.showMessage(\"数据库已整理\");\n        });\n    }\n}\n","import BasicWidget from \"../basic_widget.js\";\nimport server from \"../../services/server.js\";\nimport dialogService from \"../../services/dialog.js\";\nimport toastService from \"../../services/toast.js\";\nimport ws from \"../../services/ws.js\";\nimport appContext from \"../../components/app_context.js\";\nimport openService from \"../../services/open.js\";\nimport utils from \"../../services/utils.js\";\n\nconst TPL = `\n<div class=\"dropdown attachment-actions\">\n    <style>\n    .attachment-actions {\n        width: 35px;\n        height: 35px;\n    }\n    \n    .attachment-actions .dropdown-menu {\n        width: 20em;\n    }\n    \n    .attachment-actions .dropdown-item[disabled], .attachment-actions .dropdown-item[disabled]:hover {\n        color: var(--muted-text-color) !important;\n        background-color: transparent !important;\n        pointer-events: none; /* makes it unclickable */\n    }\n    </style>\n\n    <button type=\"button\" data-toggle=\"dropdown\" aria-haspopup=\"true\" \n        aria-expanded=\"false\" class=\"icon-action icon-action-always-border bx bx-dots-vertical-rounded\"\n        style=\"position: relative; top: 3px;\"></button>\n\n    <div class=\"dropdown-menu dropdown-menu-right\">\n        <a data-trigger-command=\"openAttachment\" class=\"dropdown-item\"\n            title=\"文件将在外部应用程序中打开并监视更改, 然后您可以将修改后的版本上传回Trilium\">用外部程序打开</a>\n        <a data-trigger-command=\"openAttachmentCustom\" class=\"dropdown-item\"\n            title=\"文件将在外部应用程序中打开并监视更改, 然后您可以将修改后的版本上传回Trilium\">使用自定义程序打开</a>\n        <a data-trigger-command=\"downloadAttachment\" class=\"dropdown-item\">下载</a>\n        <a data-trigger-command=\"renameAttachment\" class=\"dropdown-item\">重命名附件</a>\n        <a data-trigger-command=\"uploadNewAttachmentRevision\" class=\"dropdown-item\">上传新的修改</a>\n        <a data-trigger-command=\"copyAttachmentLinkToClipboard\" class=\"dropdown-item\">复制链接到剪贴板</a>\n        <a data-trigger-command=\"convertAttachmentIntoNote\" class=\"dropdown-item\">将附件转换为笔记</a>\n        <a data-trigger-command=\"deleteAttachment\" class=\"dropdown-item\">删除附件</a>\n    </div>\n    \n    <input type=\"file\" class=\"attachment-upload-new-revision-input\" style=\"display: none\">\n</div>`;\n\nexport default class AttachmentActionsWidget extends BasicWidget {\n    constructor(attachment, isFullDetail) {\n        super();\n\n        this.attachment = attachment;\n        this.isFullDetail = isFullDetail;\n    }\n\n    get attachmentId() {\n        return this.attachment.attachmentId;\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$widget.on('click', '.dropdown-item', () => this.$widget.find(\"[data-toggle='dropdown']\").dropdown('toggle'));\n\n        this.$uploadNewRevisionInput = this.$widget.find(\".attachment-upload-new-revision-input\");\n        this.$uploadNewRevisionInput.on('change', async () => {\n            const fileToUpload = this.$uploadNewRevisionInput[0].files[0]; // copy to allow reset below\n            this.$uploadNewRevisionInput.val('');\n\n            const result = await server.upload(`attachments/${this.attachmentId}/file`, fileToUpload);\n\n            if (result.uploaded) {\n                toastService.showMessage(\"已上传新附件版本。\");\n            } else {\n                toastService.showError(\"Upload of a new attachment revision failed.\");\n            }\n        });\n\n        if (!this.isFullDetail) {\n            // we deactivate this button because the WatchedFileUpdateStatusWidget assumes only one visible attachment\n            // in a note context, so it doesn't work in a list\n            const $openAttachmentButton = this.$widget.find(\"[data-trigger-command='openAttachment']\");\n            $openAttachmentButton\n                .addClass(\"disabled\")\n                .append($('<span class=\"disabled-tooltip\"> (?)</span>')\n                    .attr(\"title\", \"用外部程序打开附件仅在详细页面使用, 请先单击附件详情并重复操作\")\n                );\n            const $openAttachmentCustomButton = this.$widget.find(\"[data-trigger-command='openAttachmentCustom']\");\n            $openAttachmentCustomButton\n                .addClass(\"disabled\")\n                .append($('<span class=\"disabled-tooltip\"> (?)</span>')\n                    .attr(\"title\", \"用外部程序打开附件仅在详细页面使用, 请先单击附件详情并重复操作\")\n                );\n        }\n        if (!utils.isElectron()){\n            const $openAttachmentCustomButton = this.$widget.find(\"[data-trigger-command='openAttachmentCustom']\");\n            $openAttachmentCustomButton\n                .addClass(\"disabled\")\n                .append($('<span class=\"disabled-tooltip\"> (?)</span>')\n                    .attr(\"title\", \"Custom opening of attachments can only be done from the client.\")\n                );\n        }\n    }\n\n    async openAttachmentCommand() {\n        await openService.openAttachmentExternally(this.attachmentId, this.attachment.mime);\n    }\n\n    async openAttachmentCustomCommand() {\n        await openService.openAttachmentCustom(this.attachmentId, this.attachment.mime);\n    }\n\n    async downloadAttachmentCommand() {\n        await openService.downloadAttachment(this.attachmentId);\n    }\n\n    async uploadNewAttachmentRevisionCommand() {\n        this.$uploadNewRevisionInput.trigger('click');\n    }\n\n    async copyAttachmentLinkToClipboardCommand() {\n        this.parent.copyAttachmentLinkToClipboard();\n    }\n\n    async deleteAttachmentCommand() {\n        if (!await dialogService.confirm(`您确定要删除附件吗 '${this.attachment.title}'?`)) {\n            return;\n        }\n\n        await server.remove(`attachments/${this.attachmentId}`);\n        toastService.showMessage(`已删除附件 '${this.attachment.title}'`);\n    }\n\n    async convertAttachmentIntoNoteCommand() {\n        if (!await dialogService.confirm(`Are you sure you want to convert attachment '${this.attachment.title}' into a separate note?`)) {\n            return;\n        }\n\n        const {note: newNote} = await server.post(`attachments/${this.attachmentId}/convert-to-note`)\n        toastService.showMessage(`附件 '${this.attachment.title}' 已转换为笔记`);\n        await ws.waitForMaxKnownEntityChangeId();\n        await appContext.tabManager.getActiveContext().setNote(newNote.noteId);\n    }\n\n    async renameAttachmentCommand() {\n        const attachmentTitle = await dialogService.prompt({\n            title: \"重命名附件\",\n            message: \"请输入新附件的名称\",\n            defaultValue: this.attachment.title\n        });\n\n        if (!attachmentTitle?.trim()) {\n            return;\n        }\n\n        await server.put(`attachments/${this.attachmentId}/rename`, {title: attachmentTitle});\n    }\n}\n","import utils from \"../services/utils.js\";\nimport AttachmentActionsWidget from \"./buttons/attachments_actions.js\";\nimport BasicWidget from \"./basic_widget.js\";\nimport options from \"../services/options.js\";\nimport imageService from \"../services/image.js\";\nimport linkService from \"../services/link.js\";\nimport contentRenderer from \"../services/content_renderer.js\";\nimport toastService from \"../services/toast.js\";\n\nconst TPL = `\n<div class=\"attachment-detail-widget\">\n    <style>\n        .attachment-detail-widget {\n            height: 100%;\n        }\n    \n        .attachment-detail-wrapper {\n            margin-bottom: 20px;\n            display: flex;\n            flex-direction: column;\n        }\n        \n        .attachment-title-line {\n            display: flex;\n            align-items: baseline;\n            gap: 1em;\n        }\n        \n        .attachment-details {\n            margin-left: 10px;\n        }\n        \n        .attachment-content-wrapper {\n            flex-grow: 1;\n        }\n        \n        .attachment-content-wrapper .rendered-content {\n            height: 100%;\n        }\n        \n        .attachment-content-wrapper pre {\n            background: var(--accented-background-color);\n            padding: 10px;\n            margin-top: 10px;\n            margin-bottom: 10px;\n        }\n        \n        .attachment-detail-wrapper.list-view .attachment-content-wrapper {\n            max-height: 300px;\n        }\n\n        .attachment-detail-wrapper.full-detail {\n            height: 100%;\n        }\n\n        .attachment-detail-wrapper.full-detail .attachment-content-wrapper {\n            height: 100%;\n        }\n        \n        .attachment-detail-wrapper.list-view .attachment-content-wrapper pre {\n            max-height: 400px;\n        }\n        \n        .attachment-content-wrapper img {\n            margin: 10px;\n        }\n        \n        .attachment-detail-wrapper.list-view .attachment-content-wrapper img, .attachment-detail-wrapper.list-view .attachment-content-wrapper video {\n            max-height: 300px; \n            max-width: 90%; \n            object-fit: contain;\n        }\n        \n        .attachment-detail-wrapper.full-detail .attachment-content-wrapper img {\n            max-width: 90%; \n            object-fit: contain;\n        }\n        \n        .attachment-detail-wrapper.scheduled-for-deletion .attachment-content-wrapper img {\n            filter: contrast(10%);\n        }\n    </style>\n\n    <div class=\"attachment-detail-wrapper\">\n        <div class=\"attachment-title-line\">\n            <div class=\"attachment-actions-container\"></div>\n            <h4 class=\"attachment-title\"></h4>                \n            <div class=\"attachment-details\"></div>\n            <div style=\"flex: 1 1;\"></div>\n        </div>\n        \n        <div class=\"attachment-deletion-warning alert alert-info\" style=\"margin-top: 15px;\"></div>\n        \n        <div class=\"attachment-content-wrapper\"></div>\n    </div>\n</div>`;\n\nexport default class AttachmentDetailWidget extends BasicWidget {\n    constructor(attachment, isFullDetail) {\n        super();\n\n        this.contentSized();\n        this.attachment = attachment;\n        this.attachmentActionsWidget = new AttachmentActionsWidget(attachment, isFullDetail);\n        this.isFullDetail = isFullDetail;\n        this.child(this.attachmentActionsWidget);\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.refresh();\n\n        super.doRender();\n    }\n\n    async refresh() {\n        this.$widget.find('.attachment-detail-wrapper')\n            .empty()\n            .append(\n                $(TPL)\n                    .find('.attachment-detail-wrapper')\n                    .html()\n            );\n        this.$wrapper = this.$widget.find('.attachment-detail-wrapper');\n        this.$wrapper.addClass(this.isFullDetail ? \"full-detail\" : \"list-view\");\n\n        if (!this.isFullDetail) {\n            this.$wrapper.find('.attachment-title').append(\n                await linkService.createLink(this.attachment.ownerId, {\n                    title: this.attachment.title,\n                    viewScope: {\n                        viewMode: 'attachments',\n                        attachmentId: this.attachment.attachmentId\n                    }\n                })\n            );\n        } else {\n            this.$wrapper.find('.attachment-title')\n                .text(this.attachment.title);\n        }\n\n        const $deletionWarning = this.$wrapper.find('.attachment-deletion-warning');\n        const {utcDateScheduledForErasureSince} = this.attachment;\n\n        if (utcDateScheduledForErasureSince) {\n            this.$wrapper.addClass(\"scheduled-for-deletion\");\n\n            const scheduledSinceTimestamp = utils.parseDate(utcDateScheduledForErasureSince)?.getTime();\n            const intervalMs = options.getInt('eraseUnusedAttachmentsAfterSeconds') * 1000;\n            const deletionTimestamp = scheduledSinceTimestamp + intervalMs;\n            const willBeDeletedInMs = deletionTimestamp - Date.now();\n\n            $deletionWarning.show();\n\n            if (willBeDeletedInMs >= 60000) {\n                $deletionWarning.text(`此附件将在 ${utils.formatTimeInterval(willBeDeletedInMs)} 后自动删除。`);\n            } else {\n                $deletionWarning.text(`此附件将很快被自动删除`);\n            }\n\n            $deletionWarning.append(\", 因为附件未在笔记内容中链接。为防止被删除，请将附件链接添加回内容中或将附件转换为笔记。\");\n        } else {\n            this.$wrapper.removeClass(\"scheduled-for-deletion\");\n            $deletionWarning.hide();\n        }\n\n        this.$wrapper.find('.attachment-details')\n            .text(`角色：${this.attachment.role}，大小：${utils.formatSize(this.attachment.contentLength)}`);\n        this.$wrapper.find('.attachment-actions-container').append(this.attachmentActionsWidget.render());\n\n        const {$renderedContent} = await contentRenderer.getRenderedContent(this.attachment, { imageHasZoom: this.isFullDetail });\n        this.$wrapper.find('.attachment-content-wrapper').append($renderedContent);\n    }\n\n    async copyAttachmentLinkToClipboard() {\n        if (this.attachment.role === 'image') {\n            imageService.copyImageReferenceToClipboard(this.$wrapper.find('.attachment-content-wrapper'));\n        } else if (this.attachment.role === 'file') {\n            const $link = await linkService.createLink(this.attachment.ownerId, {\n                referenceLink: true,\n                viewScope: {\n                    viewMode: 'attachments',\n                    attachmentId: this.attachment.attachmentId\n                }\n            });\n\n            utils.copyHtmlToClipboard($link[0].outerHTML);\n\n            toastService.showMessage(\"附件链接已复制到剪贴板.\");\n        } else {\n            throw new Error(`Unrecognized attachment role '${this.attachment.role}'.`);\n        }\n    }\n\n    async entitiesReloadedEvent({loadResults}) {\n        const attachmentRow = loadResults.getAttachmentRows().find(att => att.attachmentId === this.attachment.attachmentId);\n\n        if (attachmentRow) {\n            if (attachmentRow.isDeleted) {\n                this.toggleInt(false);\n            } else {\n                this.refresh();\n            }\n        }\n    }\n}\n","import NoteContextAwareWidget from \"./note_context_aware_widget.js\";\nimport protectedSessionHolder from \"../services/protected_session_holder.js\";\nimport SpacedUpdate from \"../services/spaced_update.js\";\nimport server from \"../services/server.js\";\nimport libraryLoader from \"../services/library_loader.js\";\nimport appContext from \"../components/app_context.js\";\nimport keyboardActionsService from \"../services/keyboard_actions.js\";\nimport noteCreateService from \"../services/note_create.js\";\nimport attributeService from \"../services/attributes.js\";\nimport attributeRenderer from \"../services/attribute_renderer.js\";\n\nimport EmptyTypeWidget from \"./type_widgets/empty.js\";\nimport EditableTextTypeWidget from \"./type_widgets/editable_text.js\";\nimport EditableCodeTypeWidget from \"./type_widgets/editable_code.js\";\nimport FileTypeWidget from \"./type_widgets/file.js\";\nimport ImageTypeWidget from \"./type_widgets/image.js\";\nimport RenderTypeWidget from \"./type_widgets/render.js\";\nimport RelationMapTypeWidget from \"./type_widgets/relation_map.js\";\nimport CanvasTypeWidget from \"./type_widgets/canvas.js\";\nimport ProtectedSessionTypeWidget from \"./type_widgets/protected_session.js\";\nimport BookTypeWidget from \"./type_widgets/book.js\";\nimport ReadOnlyTextTypeWidget from \"./type_widgets/read_only_text.js\";\nimport ReadOnlyCodeTypeWidget from \"./type_widgets/read_only_code.js\";\nimport NoneTypeWidget from \"./type_widgets/none.js\";\nimport NoteMapTypeWidget from \"./type_widgets/note_map.js\";\nimport WebViewTypeWidget from \"./type_widgets/web_view.js\";\nimport DocTypeWidget from \"./type_widgets/doc.js\";\nimport ContentWidgetTypeWidget from \"./type_widgets/content_widget.js\";\nimport AttachmentListTypeWidget from \"./type_widgets/attachment_list.js\";\nimport AttachmentDetailTypeWidget from \"./type_widgets/attachment_detail.js\";\n\nconst TPL = `\n<div class=\"note-detail\">\n    <style>\n    .note-detail {\n        font-family: var(--detail-font-family);\n        font-size: var(--detail-font-size);\n    }\n    \n    .note-detail.full-height {\n        height: 100%;\n    }\n    </style>\n</div>\n`;\n\nconst typeWidgetClasses = {\n    'empty': EmptyTypeWidget,\n    'editableText': EditableTextTypeWidget,\n    'readOnlyText': ReadOnlyTextTypeWidget,\n    'editableCode': EditableCodeTypeWidget,\n    'readOnlyCode': ReadOnlyCodeTypeWidget,\n    'file': FileTypeWidget,\n    'image': ImageTypeWidget,\n    'search': NoneTypeWidget,\n    'render': RenderTypeWidget,\n    'relationMap': RelationMapTypeWidget,\n    'canvas': CanvasTypeWidget,\n    'protectedSession': ProtectedSessionTypeWidget,\n    'book': BookTypeWidget,\n    'noteMap': NoteMapTypeWidget,\n    'webView': WebViewTypeWidget,\n    'doc': DocTypeWidget,\n    'contentWidget': ContentWidgetTypeWidget,\n    'attachmentDetail': AttachmentDetailTypeWidget,\n    'attachmentList': AttachmentListTypeWidget\n};\n\nexport default class NoteDetailWidget extends NoteContextAwareWidget {\n    constructor() {\n        super();\n\n        this.typeWidgets = {};\n\n        this.spacedUpdate = new SpacedUpdate(async () => {\n            const {note} = this.noteContext;\n            const {noteId} = note;\n\n            const data = await this.getTypeWidget().getData();\n\n            // for read only notes\n            if (data === undefined) {\n                return;\n            }\n\n            protectedSessionHolder.touchProtectedSessionIfNecessary(note);\n\n            await server.put(`notes/${noteId}/data`, data, this.componentId);\n\n            this.getTypeWidget().dataSaved?.();\n        });\n\n        appContext.addBeforeUnloadListener(this);\n    }\n\n    isEnabled() {\n        return true;\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.contentSized();\n    }\n\n    async refresh() {\n        this.type = await this.getWidgetType();\n        this.mime = this.note?.mime;\n\n        if (!(this.type in this.typeWidgets)) {\n            const clazz = typeWidgetClasses[this.type];\n\n            if (!clazz) {\n                throw new Error(`Cannot find type widget for type '${this.type}'`);\n            }\n\n            const typeWidget = this.typeWidgets[this.type] = new clazz();\n            typeWidget.spacedUpdate = this.spacedUpdate;\n            typeWidget.setParent(this);\n\n            const $renderedWidget = typeWidget.render();\n            keyboardActionsService.updateDisplayedShortcuts($renderedWidget);\n\n            this.$widget.append($renderedWidget);\n\n            await typeWidget.handleEvent('setNoteContext', {noteContext: this.noteContext});\n\n            // this is happening in update(), so note has been already set, and we need to reflect this\n            await typeWidget.handleEvent('noteSwitched', {\n                noteContext: this.noteContext,\n                notePath: this.noteContext.notePath\n            });\n\n            this.child(typeWidget);\n        }\n\n        this.checkFullHeight();\n    }\n\n    /**\n     * sets full height of container that contains note content for a subset of note-types\n     */\n    checkFullHeight() {\n        // https://github.com/zadam/trilium/issues/2522\n        this.$widget.toggleClass(\"full-height\",\n            (\n                !this.noteContext.hasNoteList()\n                && ['canvas', 'webView', 'noteMap'].includes(this.type)\n                && this.mime !== 'text/x-sqlite;schema=trilium'\n            )\n            || this.noteContext.viewScope.viewMode === 'attachments'\n        );\n    }\n\n    getTypeWidget() {\n        if (!this.typeWidgets[this.type]) {\n            throw new Error(`Could not find typeWidget for type '${this.type}'`);\n        }\n\n        return this.typeWidgets[this.type];\n    }\n\n    async getWidgetType() {\n        const note = this.note;\n\n        if (!note) {\n            return \"empty\";\n        }\n\n        let type = note.type;\n        const viewScope = this.noteContext.viewScope;\n\n        if (viewScope.viewMode === 'source') {\n            type = 'readOnlyCode';\n        } else if (viewScope.viewMode === 'attachments') {\n            type = viewScope.attachmentId ? 'attachmentDetail' : 'attachmentList';\n        } else if (type === 'text' && await this.noteContext.isReadOnly()) {\n            type = 'readOnlyText';\n        } else if ((type === 'code' || type === 'mermaid') && await this.noteContext.isReadOnly()) {\n            type = 'readOnlyCode';\n        } else if (type === 'text') {\n            type = 'editableText';\n        } else if (type === 'code' || type === 'mermaid') {\n            type = 'editableCode';\n        } else if (type === 'launcher') {\n            type = 'doc';\n        }\n\n        if (note.isProtected && !protectedSessionHolder.isProtectedSessionAvailable()) {\n            type = 'protectedSession';\n        }\n\n        return type;\n    }\n\n    async focusOnDetailEvent({ntxId}) {\n        if (this.noteContext.ntxId !== ntxId) {\n            return;\n        }\n\n        await this.refresh();\n        const widget = this.getTypeWidget();\n        await widget.initialized;\n        widget.focus();\n    }\n\n    async scrollToEndEvent({ntxId}) {\n        if (this.noteContext.ntxId !== ntxId) {\n            return;\n        }\n\n        await this.refresh();\n        const widget = this.getTypeWidget();\n        await widget.initialized;\n\n        if (widget.scrollToEnd) {\n            widget.scrollToEnd();\n        }\n    }\n\n    async beforeNoteSwitchEvent({noteContext}) {\n        if (this.isNoteContext(noteContext.ntxId)) {\n            await this.spacedUpdate.updateNowIfNecessary();\n        }\n    }\n\n    async beforeNoteContextRemoveEvent({ntxIds}) {\n        if (this.isNoteContext(ntxIds)) {\n            await this.spacedUpdate.updateNowIfNecessary();\n        }\n    }\n\n    async runActiveNoteCommand(params) {\n        if (this.isNoteContext(params.ntxId)) {\n            // make sure that script is saved before running it #4028\n            await this.spacedUpdate.updateNowIfNecessary();\n        }\n\n        return await this.parent.triggerCommand('runActiveNote', params);\n    }\n\n    async printActiveNoteEvent() {\n        if (!this.noteContext.isActive()) {\n            return;\n        }\n\n        await libraryLoader.requireLibrary(libraryLoader.PRINT_THIS);\n\n        let $promotedAttributes = $(\"\");\n\n        if (this.note.getPromotedDefinitionAttributes().length > 0) {\n            $promotedAttributes = (await attributeRenderer.renderNormalAttributes(this.note)).$renderedAttributes;\n        }\n\n        const {assetPath} = window.glob;\n\n        this.$widget.find('.note-detail-printable:visible').printThis({\n            header: $(\"<div>\")\n                        .append($(\"<h2>\").text(this.note.title))\n                        .append($promotedAttributes)\n                        .prop('outerHTML'),\n\n            footer: `\n<script src=\"${assetPath}/node_modules/katex/dist/katex.min.js\"></script>\n<script src=\"${assetPath}/node_modules/katex/dist/contrib/mhchem.min.js\"></script>\n<script src=\"${assetPath}/node_modules/katex/dist/contrib/auto-render.min.js\"></script>\n<script>\n    document.body.className += ' ck-content printed-content';\n    \n    renderMathInElement(document.body, {trust: true});\n</script>\n`,\n            importCSS: false,\n            loadCSS: [\n                `${assetPath}/libraries/codemirror/codemirror.css`,\n                `${assetPath}/libraries/ckeditor/ckeditor-content.css`,\n                `${assetPath}/libraries/bootstrap/css/bootstrap.min.css`,\n                `${assetPath}/node_modules/katex/dist/katex.min.css`,\n                `${assetPath}/stylesheets/print.css`,\n                `${assetPath}/stylesheets/relation_map.css`,\n                `${assetPath}/stylesheets/ckeditor-theme.css`\n            ],\n            debug: true\n        });\n    }\n\n    hoistedNoteChangedEvent({ntxId}) {\n        if (this.isNoteContext(ntxId)) {\n            this.refresh();\n        }\n    }\n\n    async entitiesReloadedEvent({loadResults}) {\n        // we're detecting note type change on the note_detail level, but triggering the noteTypeMimeChanged\n        // globally, so it gets also to e.g. ribbon components. But this means that the event can be generated multiple\n        // times if the same note is open in several tabs.\n\n        if (loadResults.isNoteContentReloaded(this.noteId, this.componentId)) {\n            // probably incorrect event\n            // calling this.refresh() is not enough since the event needs to be propagated to children as well\n            // FIXME: create a separate event to force hierarchical refresh\n\n            // this uses handleEvent to make sure that the ordinary content updates are propagated only in the subtree\n            // to avoid the problem in #3365\n            this.handleEvent('noteTypeMimeChanged', {noteId: this.noteId});\n        }\n        else if (loadResults.isNoteReloaded(this.noteId, this.componentId)\n            && (this.type !== await this.getWidgetType() || this.mime !== this.note.mime)) {\n\n            // this needs to have a triggerEvent so that e.g., note type (not in the component subtree) is updated\n            this.triggerEvent('noteTypeMimeChanged', {noteId: this.noteId});\n        }\n        else {\n            const attrs = loadResults.getAttributeRows();\n\n            const label = attrs.find(attr =>\n                attr.type === 'label'\n                && ['readOnly', 'autoReadOnlyDisabled', 'cssClass', 'displayRelations', 'hideRelations'].includes(attr.name)\n                && attributeService.isAffecting(attr, this.note));\n\n            const relation = attrs.find(attr =>\n                attr.type === 'relation'\n                && ['template', 'inherit', 'renderNote'].includes(attr.name)\n                && attributeService.isAffecting(attr, this.note));\n\n            if (label || relation) {\n                // probably incorrect event\n                // calling this.refresh() is not enough since the event needs to be propagated to children as well\n                this.triggerEvent('noteTypeMimeChanged', {noteId: this.noteId});\n            }\n        }\n    }\n\n    beforeUnloadEvent() {\n        return this.spacedUpdate.isAllSavedAndTriggerUpdate();\n    }\n\n    readOnlyTemporarilyDisabledEvent({noteContext}) {\n        if (this.isNoteContext(noteContext.ntxId)) {\n            this.refresh();\n        }\n    }\n\n    async executeInActiveNoteDetailWidgetEvent({callback}) {\n        if (!this.isActiveNoteContext()) {\n            return;\n        }\n\n        await this.initialized;\n\n        callback(this);\n    }\n\n    async cutIntoNoteCommand() {\n        const note = appContext.tabManager.getActiveContextNote();\n\n        if (!note) {\n            return;\n        }\n\n        // without await as this otherwise causes deadlock through component mutex\n        noteCreateService.createNote(appContext.tabManager.getActiveContextNotePath(), {\n            isProtected: note.isProtected,\n            saveSelection: true,\n            textEditor: await this.noteContext.getTextEditor()\n        });\n    }\n\n    // used by cutToNote in CKEditor build\n    async saveNoteDetailNowCommand() {\n        await this.spacedUpdate.updateNowIfNecessary();\n    }\n\n    renderActiveNoteEvent() {\n        if (this.noteContext.isActive()) {\n            this.refresh();\n        }\n    }\n\n    async executeWithTypeWidgetEvent({resolve, ntxId}) {\n        if (!this.isNoteContext(ntxId)) {\n            return;\n        }\n\n        await this.initialized;\n\n        await this.getWidgetType();\n\n        resolve(this.getTypeWidget());\n    }\n}\n","import noteAutocompleteService from '../../services/note_autocomplete.js';\nimport TypeWidget from \"./type_widget.js\";\nimport appContext from \"../../components/app_context.js\";\nimport searchService from \"../../services/search.js\";\n\nconst TPL = `\n<div class=\"note-detail-empty note-detail-printable\">\n    <style>\n        .workspace-notes {\n            display: flex;\n            flex-direction: row;\n            flex-wrap: wrap;\n            justify-content: space-evenly;\n        }\n        \n        .workspace-notes .workspace-note {\n            width: 130px;\n            text-align: center;\n            margin: 10px;\n            padding; 10px;\n            border: 1px transparent solid;\n        }\n        \n        .workspace-notes .workspace-note:hover {\n            cursor: pointer;\n            border: 1px solid var(--main-border-color);\n        }\n        \n        .workspace-icon {\n            text-align: center;\n            font-size: 500%;\n        }\n    </style>\n\n    <div class=\"form-group\">\n        <label>在下方输入笔记名称或者点树形图来打开笔记.</label>\n        <div class=\"input-group\">\n            <input class=\"form-control note-autocomplete\" placeholder=\"根据名称搜索笔记\">\n        </div>\n    </div>\n    \n    <div class=\"workspace-notes\"></div>\n</div>`;\n\nexport default class EmptyTypeWidget extends TypeWidget {\n    static getType() { return \"empty\"; }\n\n    doRender() {\n        // FIXME: this might be optimized - cleaned up after use since it's always used only for new tab\n\n        this.$widget = $(TPL);\n        this.$autoComplete = this.$widget.find(\".note-autocomplete\");\n\n        noteAutocompleteService.initNoteAutocomplete(this.$autoComplete, {\n            hideGoToSelectedNoteButton: true,\n            allowCreatingNotes: true\n        })\n            .on('autocomplete:noteselected', function(event, suggestion, dataset) {\n                if (!suggestion.notePath) {\n                    return false;\n                }\n\n                appContext.tabManager.getActiveContext().setNote(suggestion.notePath);\n            });\n\n        this.$workspaceNotes = this.$widget.find('.workspace-notes');\n\n        super.doRender();\n    }\n\n    async doRefresh(note) {\n        const workspaceNotes = await searchService.searchForNotes('#workspace #!template');\n\n        this.$workspaceNotes.empty();\n\n        for (const workspaceNote of workspaceNotes) {\n            this.$workspaceNotes.append(\n                $('<div class=\"workspace-note\">')\n                    .append($(\"<div>\").addClass(`${workspaceNote.getIcon()} workspace-icon`))\n                    .append($(\"<div>\").text(workspaceNote.title))\n                    .attr(\"title\", `进入工作空间 ${workspaceNote.title}`)\n                    .on('click', () => this.triggerCommand('hoistNote', {noteId: workspaceNote.noteId}))\n            );\n        }\n\n        this.$autoComplete\n            .trigger('focus')\n            .trigger('select');\n    }\n}\n","import AbstractTextTypeWidget from \"./abstract_text_type_widget.js\";\nimport libraryLoader from \"../../services/library_loader.js\";\n\nconst TPL = `\n<div class=\"note-detail-readonly-text note-detail-printable\">\n    <style>\n    /* h1 should not be used at all since semantically that's a note title */\n    .note-detail-readonly-text h1 { font-size: 1.8em; }\n    .note-detail-readonly-text h2 { font-size: 1.6em; }\n    .note-detail-readonly-text h3 { font-size: 1.4em; }\n    .note-detail-readonly-text h4 { font-size: 1.2em; }\n    .note-detail-readonly-text h5 { font-size: 1.1em; }\n    .note-detail-readonly-text h6 { font-size: 1.0em; }\n    \n    body.heading-style-markdown .note-detail-readonly-text h1::before { content: \"#\\\\2004\"; color: var(--muted-text-color); }\n    body.heading-style-markdown .note-detail-readonly-text h2::before { content: \"##\\\\2004\"; color: var(--muted-text-color); }\n    body.heading-style-markdown .note-detail-readonly-text h3::before { content: \"###\\\\2004\"; color: var(--muted-text-color); }\n    body.heading-style-markdown .note-detail-readonly-text h4:not(.include-note-title)::before { content: \"####\\\\2004\"; color: var(--muted-text-color); }\n    body.heading-style-markdown .note-detail-readonly-text h5::before { content: \"#####\\\\2004\"; color: var(--muted-text-color); }\n    body.heading-style-markdown .note-detail-readonly-text h6::before { content: \"######\\\\2004\"; color: var(--muted-text-color); }\n\n    body.heading-style-underline .note-detail-readonly-text h1 { border-bottom: 1px solid var(--main-border-color); }\n    body.heading-style-underline .note-detail-readonly-text h2 { border-bottom: 1px solid var(--main-border-color); }\n    body.heading-style-underline .note-detail-readonly-text h3 { border-bottom: 1px solid var(--main-border-color); }\n    body.heading-style-underline .note-detail-readonly-text h4:not(.include-note-title) { border-bottom: 1px solid var(--main-border-color); }\n    body.heading-style-underline .note-detail-readonly-text h5 { border-bottom: 1px solid var(--main-border-color); }\n    body.heading-style-underline .note-detail-readonly-text h6 { border-bottom: 1px solid var(--main-border-color); }\n    \n    .note-detail-readonly-text {\n        padding-left: 24px;\n        padding-top: 10px;\n        font-family: var(--detail-font-family);\n        min-height: 50px;\n        position: relative;\n    }\n    \n    body.mobile .note-detail-readonly-text {\n        padding-left: 10px;\n    }\n        \n    .note-detail-readonly-text p:first-child, .note-detail-readonly-text::before {\n        margin-top: 0;\n    }\n    \n    .note-detail-readonly-text img {\n        max-width: 100%;\n        cursor: pointer;\n    }\n    \n    .edit-text-note-button {\n        position: absolute; \n        top: 5px;\n        right: 10px;\n        font-size: 150%;\n        padding: 5px;\n        cursor: pointer;\n        border: 1px solid transparent;\n        border-radius: var(--button-border-radius);\n        color: var(--button-text-color);\n    }\n    \n    .edit-text-note-button:hover {\n        border-color: var(--button-border-color);\n    }\n    </style>\n\n    <div class=\"note-detail-readonly-text-content ck-content\"></div>\n</div>\n`;\n\nexport default class ReadOnlyTextTypeWidget extends AbstractTextTypeWidget {\n    static getType() { return \"readOnlyText\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$content = this.$widget.find('.note-detail-readonly-text-content');\n\n        this.setupImageOpening(true);\n\n        super.doRender();\n    }\n\n    cleanup() {\n        this.$content.html('');\n    }\n\n    async doRefresh(note) {\n        // we load CKEditor also for read only notes because they contain content styles required for correct rendering of even read only notes\n        // we could load just ckeditor-content.css but that causes CSS conflicts when both build CSS and this content CSS is loaded at the same time\n        // (see https://github.com/zadam/trilium/issues/1590 for example of such conflict)\n        await libraryLoader.requireLibrary(libraryLoader.CKEDITOR);\n\n        const blob = await note.getBlob();\n\n        this.$content.html(blob.content);\n\n        this.$content.find(\"a.reference-link\").each(async (_, el) => {\n            this.loadReferenceLinkTitle($(el));\n        });\n\n        this.$content.find(\"section\").each(async (_, el) => {\n            const noteId = $(el).attr('data-note-id');\n\n            this.loadIncludedNote(noteId, $(el));\n        });\n\n        if (this.$content.find('span.math-tex').length > 0) {\n            await libraryLoader.requireLibrary(libraryLoader.KATEX);\n\n            renderMathInElement(this.$content[0], {trust: true});\n        }\n    }\n\n    async refreshIncludedNoteEvent({noteId}) {\n        this.refreshIncludedNote(this.$content, noteId);\n    }\n\n    async executeWithContentElementEvent({resolve, ntxId}) {\n        if (!this.isNoteContext(ntxId)) {\n            return;\n        }\n\n        await this.initialized;\n\n        resolve(this.$content);\n    }\n}\n","import libraryLoader from \"../../services/library_loader.js\";\nimport TypeWidget from \"./type_widget.js\";\nimport keyboardActionService from \"../../services/keyboard_actions.js\";\nimport options from \"../../services/options.js\";\n\nconst TPL = `\n<div class=\"note-detail-code note-detail-printable\">\n    <style>\n    .note-detail-code {\n        position: relative;\n        height: 100%;\n    }\n    \n    .note-detail-code-editor {\n        min-height: 50px;\n        height: 100%;\n    }\n    </style>\n\n    <div class=\"note-detail-code-editor\"></div>\n</div>`;\n\nexport default class EditableCodeTypeWidget extends TypeWidget {\n    static getType() { return \"editableCode\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$editor = this.$widget.find('.note-detail-code-editor');\n\n        keyboardActionService.setupActionsForElement('code-detail', this.$widget, this);\n\n        super.doRender();\n\n        this.initialized = this.initEditor();\n    }\n\n    async initEditor() {\n        await libraryLoader.requireLibrary(libraryLoader.CODE_MIRROR);\n\n        CodeMirror.keyMap.default[\"Shift-Tab\"] = \"indentLess\";\n        CodeMirror.keyMap.default[\"Tab\"] = \"indentMore\";\n\n        // these conflict with backward/forward navigation shortcuts\n        delete CodeMirror.keyMap.default[\"Alt-Left\"];\n        delete CodeMirror.keyMap.default[\"Alt-Right\"];\n\n        CodeMirror.modeURL = `${window.glob.assetPath}/libraries/codemirror/mode/%N/%N.js`;\n\n        this.codeEditor = CodeMirror(this.$editor[0], {\n            value: \"\",\n            viewportMargin: Infinity,\n            indentUnit: 4,\n            matchBrackets: true,\n            keyMap: options.is('vimKeymapEnabled') ? \"vim\": \"default\",\n            matchTags: {bothTags: true},\n            highlightSelectionMatches: {showToken: false, annotateScrollbar: false},\n            lint: true,\n            gutters: [\"CodeMirror-lint-markers\"],\n            lineNumbers: true,\n            tabindex: 300,\n            // we line wrap partly also because without it horizontal scrollbar displays only when you scroll\n            // all the way to the bottom of the note. With line wrap, there's no horizontal scrollbar so no problem\n            lineWrapping: options.is('codeLineWrapEnabled'),\n            dragDrop: false, // with true the editor inlines dropped files which is not what we expect\n            placeholder: \"在此处输入代码笔记的内容...\",\n        });\n\n        this.codeEditor.on('change', () => this.spacedUpdate.scheduleUpdate());\n    }\n\n    async doRefresh(note) {\n        const blob = await this.note.getBlob();\n\n        await this.spacedUpdate.allowUpdateWithoutChange(() => {\n            // CodeMirror breaks pretty badly on null, so even though it shouldn't happen (guarded by a consistency check)\n            // we provide fallback\n            this.codeEditor.setValue(blob.content || \"\");\n            this.codeEditor.clearHistory();\n\n            let info = CodeMirror.findModeByMIME(note.mime);\n            if (!info) {\n                // Switch back to plain text if CodeMirror does not have a mode for whatever MIME type we're editing.\n                // To avoid inheriting a mode from a previously open code note.\n                info = CodeMirror.findModeByMIME(\"text/plain\");\n            }\n\n            this.codeEditor.setOption(\"mode\", info.mime);\n            CodeMirror.autoLoadMode(this.codeEditor, info.mode);\n        });\n\n        this.show();\n    }\n\n    show() {\n        this.$widget.show();\n\n        if (this.codeEditor) { // show can be called before render\n            this.codeEditor.refresh();\n        }\n    }\n\n    getData() {\n        return {\n            content: this.codeEditor.getValue()\n        };\n    }\n\n    focus() {\n        this.$editor.focus();\n        this.codeEditor.focus();\n    }\n\n    scrollToEnd() {\n        this.codeEditor.setCursor(this.codeEditor.lineCount(), 0);\n        this.codeEditor.focus();\n    }\n\n    cleanup() {\n        if (this.codeEditor) {\n            this.spacedUpdate.allowUpdateWithoutChange(() => {\n                this.codeEditor.setValue('');\n            });\n        }\n    }\n\n    async executeWithCodeEditorEvent({resolve, ntxId}) {\n        if (!this.isNoteContext(ntxId)) {\n            return;\n        }\n\n        await this.initialized;\n\n        resolve(this.codeEditor);\n    }\n}\n","import TypeWidget from \"./type_widget.js\";\n\nconst TPL = `\n<div class=\"note-detail-readonly-code note-detail-printable\">\n    <style>\n    .note-detail-readonly-code {\n        min-height: 50px;\n        position: relative;\n    }\n    \n    .note-detail-readonly-code-content {\n        padding: 10px;\n    }\n    </style>\n\n    <pre class=\"note-detail-readonly-code-content\"></pre>\n</div>`;\n\nexport default class ReadOnlyCodeTypeWidget extends TypeWidget {\n    static getType() { return \"readOnlyCode\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$content = this.$widget.find('.note-detail-readonly-code-content');\n\n        super.doRender();\n    }\n\n    async doRefresh(note) {\n        let {content} = await this.note.getBlob();\n\n        if (note.type === 'text' && this.noteContext?.viewScope?.viewMode === 'source') {\n            content = this.format(content);\n        }\n\n        this.$content.text(content);\n    }\n\n    async executeWithContentElementEvent({resolve, ntxId}) {\n        if (!this.isNoteContext(ntxId)) {\n            return;\n        }\n\n        await this.initialized;\n\n        resolve(this.$content);\n    }\n\n    format(html) {\n        let indent = '\\n';\n        const tab = '\\t';\n        let i = 0;\n        let pre = [];\n\n        html = html\n            .replace(new RegExp('<pre>((.|\\\\t|\\\\n|\\\\r)+)?</pre>'), function (x) {\n                pre.push({indent: '', tag: x});\n                return '<--TEMPPRE' + i++ + '/-->'\n            })\n            .replace(new RegExp('<[^<>]+>[^<]?', 'g'), function (x) {\n                let ret;\n                let tag = /<\\/?([^\\s/>]+)/.exec(x)[1];\n                let p = new RegExp('<--TEMPPRE(\\\\d+)/-->').exec(x);\n\n                if (p) {\n                    pre[p[1]].indent = indent;\n                }\n\n                if (['area', 'base', 'br', 'col', 'command', 'embed', 'hr', 'img', 'input', 'keygen', 'link', 'menuitem', 'meta', 'param', 'source', 'track', 'wbr'].indexOf(tag) >= 0) { // self closing tag\n                    ret = indent + x;\n                } else {\n                    if (x.indexOf('</') < 0) { //open tag\n                        if (x.charAt(x.length - 1) !== '>') ret = indent + x.substr(0, x.length - 1) + indent + tab + x.substr(x.length - 1, x.length); else ret = indent + x;\n                        !p && (indent += tab);\n                    } else {//close tag\n                        indent = indent.substr(0, indent.length - 1);\n                        if (x.charAt(x.length - 1) !== '>') ret = indent + x.substr(0, x.length - 1) + indent + x.substr(x.length - 1, x.length); else ret = indent + x;\n                    }\n                }\n                return ret;\n            });\n\n        for (i = pre.length; i--;) {\n            html = html.replace('<--TEMPPRE' + i + '/-->', pre[i].tag.replace('<pre>', '<pre>\\n').replace('</pre>', pre[i].indent + '</pre>'));\n        }\n\n        return html.charAt(0) === '\\n' ? html.substr(1, html.length - 1) : html;\n    }\n}\n","import openService from \"../../services/open.js\";\nimport TypeWidget from \"./type_widget.js\";\n\nconst TPL = `\n<div class=\"note-detail-file note-detail-printable\">\n    <style>\n        .type-file .note-detail {\n            height: 100%;\n        }\n        \n        .note-detail-file {\n            padding: 10px;\n            height: 100%;\n        }\n\n        .file-preview-content {\n            background-color: var(--accented-background-color);\n            padding: 15px;\n            height: 100%;\n            overflow: auto;\n            margin: 10px;\n        }\n    </style>\n    \n    <pre class=\"file-preview-content\"></pre>\n    \n    <div class=\"file-preview-not-available alert alert-info\">\n        这种文件格式不支持预览.\n    </div>\n    \n    <iframe class=\"pdf-preview\" style=\"width: 100%; height: 100%; flex-grow: 100;\"></iframe>\n    \n    <video class=\"video-preview\" controls></video>\n    \n    <audio class=\"audio-preview\" controls></audio>\n</div>`;\n\nexport default class FileTypeWidget extends TypeWidget {\n    static getType() { return \"file\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$previewContent = this.$widget.find(\".file-preview-content\");\n        this.$previewNotAvailable = this.$widget.find(\".file-preview-not-available\");\n        this.$pdfPreview = this.$widget.find(\".pdf-preview\");\n        this.$videoPreview = this.$widget.find(\".video-preview\");\n        this.$audioPreview = this.$widget.find(\".audio-preview\");\n\n        super.doRender();\n    }\n\n    async doRefresh(note) {\n        this.$widget.show();\n\n        const blob = await this.note.getBlob();\n\n        this.$previewContent.empty().hide();\n        this.$pdfPreview.attr('src', '').empty().hide();\n        this.$previewNotAvailable.hide();\n        this.$videoPreview.hide();\n        this.$audioPreview.hide();\n\n        if (blob.content) {\n            this.$previewContent.show().scrollTop(0);\n            this.$previewContent.text(blob.content);\n        }\n        else if (note.mime === 'application/pdf') {\n            this.$pdfPreview.show().attr(\"src\", openService.getUrlForDownload(`api/notes/${this.noteId}/open`));\n        }\n        else if (note.mime.startsWith('video/')) {\n            this.$videoPreview\n                .show()\n                .attr(\"src\", openService.getUrlForDownload(`api/notes/${this.noteId}/open-partial`))\n                .attr(\"type\", this.note.mime)\n                .css(\"width\", this.$widget.width());\n        }\n        else if (note.mime.startsWith('audio/')) {\n            this.$audioPreview\n                .show()\n                .attr(\"src\", openService.getUrlForDownload(`api/notes/${this.noteId}/open-partial`))\n                .attr(\"type\", this.note.mime)\n                .css(\"width\", this.$widget.width());\n        }\n        else {\n            this.$previewNotAvailable.show();\n        }\n    }\n\n    async entitiesReloadedEvent({loadResults}) {\n        if (loadResults.isNoteReloaded(this.noteId)) {\n            this.refresh();\n        }\n    }\n}\n","import utils from \"../../services/utils.js\";\nimport TypeWidget from \"./type_widget.js\";\nimport libraryLoader from \"../../services/library_loader.js\";\nimport contextMenu from \"../../menus/context_menu.js\";\nimport imageService from \"../../services/image.js\";\n\nconst TPL = `\n<div class=\"note-detail-image note-detail-printable\">\n    <style>\n        .type-image .note-detail {\n            height: 100%;\n        }\n    \n        .note-detail-image {\n            height: 100%; \n        }\n        \n        .note-detail-image-wrapper {\n            position: relative;\n            display: flex;\n            align-items: center;\n            overflow: hidden;\n            justify-content: center;\n            height: 100%;\n        }\n        \n        .note-detail-image-view {\n            display: block;\n            width: auto;\n            height: auto;\n            align-self: center;\n            flex-shrink: 0;\n        }\n    </style>\n\n    <div class=\"note-detail-image-wrapper\">\n        <img class=\"note-detail-image-view\" />\n    </div>\n</div>`;\n\nclass ImageTypeWidget extends TypeWidget {\n    static getType() { return \"image\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$imageWrapper = this.$widget.find('.note-detail-image-wrapper');\n        this.$imageView = this.$widget.find('.note-detail-image-view')\n            .attr(\"id\", `image-view-${utils.randomString(10)}`);\n\n        libraryLoader.requireLibrary(libraryLoader.WHEEL_ZOOM).then(() => {\n            WZoom.create(`#${this.$imageView.attr(\"id\")}`, {\n                maxScale: 50,\n                speed: 1.3,\n                zoomOnClick: false\n            });\n        });\n\n        if (utils.isElectron()) {\n            // for browser, we want to let the native menu\n            this.$imageView.on('contextmenu', e => {\n                e.preventDefault();\n\n                contextMenu.show({\n                    x: e.pageX,\n                    y: e.pageY,\n                    items: [\n                        {\n                            title: \"复制引用到剪贴板\",\n                            command: \"copyImageReferenceToClipboard\",\n                            uiIcon: \"bx bx-empty\"\n                        },\n                        {title: \"复制图片到剪贴板\", command: \"copyImageToClipboard\", uiIcon: \"bx bx-empty\"},\n                    ],\n                    selectMenuItemHandler: ({command}) => {\n                        if (command === 'copyImageReferenceToClipboard') {\n                            imageService.copyImageReferenceToClipboard(this.$imageWrapper);\n                        } else if (command === 'copyImageToClipboard') {\n                            const webContents = utils.dynamicRequire('@electron/remote').getCurrentWebContents();\n                            utils.dynamicRequire('electron');\n                            webContents.copyImageAt(e.pageX, e.pageY);\n                        } else {\n                            throw new Error(`未识别的命令 '${command}'`);\n                        }\n                    }\n                });\n            });\n        }\n\n        super.doRender();\n    }\n\n    async doRefresh(note) {\n        this.$imageView.prop(\"src\", utils.createImageSrcUrl(note));\n    }\n\n    copyImageReferenceToClipboardEvent({ntxId}) {\n        if (!this.isNoteContext(ntxId)) {\n            return;\n        }\n\n        imageService.copyImageReferenceToClipboard(this.$imageWrapper);\n    }\n\n    async entitiesReloadedEvent({loadResults}) {\n        if (loadResults.isNoteReloaded(this.noteId)) {\n            this.refresh();\n        }\n    }\n}\n\nexport default ImageTypeWidget\n","import TypeWidget from \"./type_widget.js\";\n\nconst TPL = `<div class=\"note-detail-none note-detail-printable\"></div>`;\n\nexport default class NoneTypeWidget extends TypeWidget {\n    static getType() { return \"none\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n\n        super.doRender();\n    }\n}\n","import renderService from \"../../services/render.js\";\nimport TypeWidget from \"./type_widget.js\";\n\nconst TPL = `\n<div class=\"note-detail-render note-detail-printable\">\n    <style>\n        .note-detail-render {\n            position: relative;\n        }\n    </style>\n\n    <div class=\"note-detail-render-help alert alert-warning\" style=\"margin: 50px; padding: 20px;\">\n        <p><strong>之所以显示此帮助说明, 是因为该类型的渲染HTML没有设置好必须的关联关系.</strong></p>\n\n        <p>笔记类型: 渲染HTML 是用来<a class=\"external\" href=\"https://github.com/zadam/trilium/wiki/Scripts\">编写脚本</a>用的. 简单说就是你可以写HTML代码(或者加上一些JavaScript代码), 然后这个笔记会把页面渲染出来. 你得定义一个叫\"renderNote\"的<a class=\"external\" href=\"https://github.com/zadam/trilium/wiki/Attributes\">关系</a>来指向要渲染的HTML笔记.</p>\n    </div>\n\n    <div class=\"note-detail-render-content\"></div>\n</div>`;\n\nexport default class RenderTypeWidget extends TypeWidget {\n    static getType() { return \"render\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$noteDetailRenderHelp = this.$widget.find('.note-detail-render-help');\n        this.$noteDetailRenderContent = this.$widget.find('.note-detail-render-content');\n\n        super.doRender();\n    }\n\n    async doRefresh(note) {\n        this.$widget.show();\n        this.$noteDetailRenderHelp.hide();\n\n        const renderNotesFound = await renderService.render(note, this.$noteDetailRenderContent);\n\n        if (!renderNotesFound) {\n            this.$noteDetailRenderHelp.show();\n        }\n    }\n\n    cleanup() {\n        this.$noteDetailRenderContent.empty();\n    }\n\n    renderActiveNoteEvent() {\n        if (this.noteContext.isActive()) {\n            this.refresh();\n        }\n    }\n\n    async executeWithContentElementEvent({resolve, ntxId}) {\n        if (!this.isNoteContext(ntxId)) {\n            return;\n        }\n\n        await this.initialized;\n\n        resolve(this.$noteDetailRenderContent);\n    }\n}\n","import protectedSessionService from '../../services/protected_session.js';\nimport TypeWidget from \"./type_widget.js\";\n\nconst TPL = `\n<div class=\"protected-session-password-component note-detail-printable\">\n    <style>\n    .protected-session-password-component {\n        width: 300px;\n        margin: 30px auto auto;\n    }\n    </style>\n\n    <form class=\"protected-session-password-form\">\n        <div class=\"form-group\">\n            <label for=\"protected-session-password-in-detail\">查看受保护的笔记需要输入密码:</label>\n            <input class=\"protected-session-password-in-detail form-control protected-session-password\" type=\"password\">\n        </div>\n\n        <button class=\"btn btn-primary\">开始受保护的会话<kbd>回车</kbd></button>\n    </form>\n</div>`;\n\nexport default class ProtectedSessionTypeWidget extends TypeWidget {\n    static getType() { return \"protectedSession\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$passwordForm = this.$widget.find(\".protected-session-password-form\");\n        this.$passwordInput = this.$widget.find(\".protected-session-password\");\n\n        this.$passwordForm.on('submit', () => {\n            const password = this.$passwordInput.val();\n            this.$passwordInput.val(\"\");\n\n            protectedSessionService.setupProtectedSession(password);\n\n            return false;\n        });\n\n        super.doRender();\n    }\n}\n","import TypeWidget from \"./type_widget.js\";\n\nconst TPL = `\n<div class=\"note-detail-book note-detail-printable\">\n    <style>\n    .note-detail-book-auto-help {\n        background-color: var(--accented-background-color);\n        text-align: center;\n        border-radius: 10px;\n        padding: 5px;\n        margin: 0 10px 10px 10px;\n    }\n    </style>\n\n    <div class=\"note-detail-book-empty-help alert alert-warning\" style=\"margin: 50px; padding: 20px;\">\n        这个类型为\"书\"的笔记没有任何子笔记, 所以什么也不显示. 详见 <a href=\"https://github.com/zadam/trilium/wiki/Book-note\">wiki</a>.\n    </div>\n</div>`;\n\nexport default class BookTypeWidget extends TypeWidget {\n    static getType() { return \"book\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$helpNoChildren = this.$widget.find('.note-detail-book-empty-help');\n\n        super.doRender();\n    }\n\n    async doRefresh(note) {\n        this.$helpNoChildren.toggle(!this.note.hasChildren());\n    }\n}\n","import TypeWidget from \"./type_widget.js\";\nimport NoteMapWidget from \"../note_map.js\";\n\nconst TPL = `<div class=\"note-detail-note-map note-detail-printable\"></div>`;\n\nexport default class NoteMapTypeWidget extends TypeWidget {\n    static getType() { return \"noteMap\"; }\n\n    constructor() {\n        super();\n\n        this.noteMapWidget = new NoteMapWidget('type');\n        this.child(this.noteMapWidget);\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$widget.append(this.noteMapWidget.render());\n\n        super.doRender();\n    }\n\n    async doRefresh(note) {\n        await this.noteMapWidget.refresh();\n    }\n}\n","import TypeWidget from \"./type_widget.js\";\nimport attributeService from \"../../services/attributes.js\";\n\nconst TPL = `\n<div class=\"note-detail-web-view note-detail-printable\" style=\"height: 100%\">\n    <div class=\"note-detail-web-view-help alert alert-warning\" style=\"margin: 50px; padding: 20px 20px 0px 20px;\">\n        <h4>网页视图</h4>\n        \n        <p>网页视图类型的笔记允许您将网站嵌入到 Trilium.</p>\n\n        <p>首先, 请创建一个带有您要嵌入的 URL 地址的标签, 例如<code>#webViewSrc=\"https://www.baidu.com\"</code></p>\n\n        <h4>实验性功能免责声明</h4>\n        \n        <p>网页视图是一种实验性笔记类型, 将来可能会被删除或大幅更改. 网页视图只在桌面端有效</p>\n    </div>\n\n    <webview class=\"note-detail-web-view-content\"></webview>\n</div>`;\n\nexport default class WebViewTypeWidget extends TypeWidget {\n    static getType() { return \"webView\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$noteDetailWebViewHelp = this.$widget.find('.note-detail-web-view-help');\n        this.$noteDetailWebViewContent = this.$widget.find('.note-detail-web-view-content');\n\n        window.addEventListener('resize', () => this.setDimensions(), false);\n\n        super.doRender();\n    }\n\n    async doRefresh(note) {\n        this.$widget.show();\n        this.$noteDetailWebViewHelp.hide();\n        this.$noteDetailWebViewContent.hide();\n\n        const webViewSrc = this.note.getLabelValue('webViewSrc');\n\n        if (webViewSrc) {\n            this.$noteDetailWebViewContent\n                .show()\n                .attr(\"src\", webViewSrc);\n        }\n        else {\n            this.$noteDetailWebViewContent.hide();\n            this.$noteDetailWebViewHelp.show();\n        }\n\n        this.setDimensions();\n\n        setTimeout(() => this.setDimensions(), 1000);\n    }\n\n    cleanup() {\n        this.$noteDetailWebViewContent.removeAttribute(\"src\");\n    }\n\n    setDimensions() {\n        const $parent = this.$widget;\n\n        this.$noteDetailWebViewContent\n            .height($parent.height())\n            .width($parent.width());\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.getAttributeRows().find(attr => attr.name === 'webViewSrc' && attributeService.isAffecting(attr, this.noteContext.note))) {\n            this.refresh();\n        }\n    }\n}\n","import TypeWidget from \"./type_widget.js\";\n\nconst TPL = `<div class=\"note-detail-doc note-detail-printable\">\n    <style>\n        .note-detail-doc-content {\n            padding: 15px;\n        }\n        \n        .note-detail-doc-content pre {\n            background-color: var(--accented-background-color);\n            border: 1px solid var(--main-border-color);\n            padding: 15px;\n            border-radius: 5px;\n        }\n    </style>\n    \n    <div class=\"note-detail-doc-content\"></div>\n</div>`;\n\nexport default class DocTypeWidget extends TypeWidget {\n    static getType() { return \"doc\"; }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$content = this.$widget.find('.note-detail-doc-content');\n\n        super.doRender();\n    }\n\n    async doRefresh(note) {\n        const docName = note.getLabelValue('docName');\n\n        if (docName) {\n            this.$content.load(`${window.glob.appPath}/doc_notes/${docName}.html`);\n        } else {\n            this.$content.empty();\n        }\n    }\n}\n","import TypeWidget from \"./type_widget.js\";\nimport AttachmentDetailWidget from \"../attachment_detail.js\";\nimport linkService from \"../../services/link.js\";\nimport froca from \"../../services/froca.js\";\nimport utils from \"../../services/utils.js\";\n\nconst TPL = `\n<div class=\"attachment-detail note-detail-printable\">\n    <style>\n        .attachment-detail {\n            padding-left: 15px;\n            padding-right: 15px;\n            height: 100%;\n            display: flex;\n            flex-direction: column;\n        }\n        \n        .attachment-detail .links-wrapper {\n            font-size: larger;\n            padding: 0 0 16px 0;\n        }\n        \n        .attachment-detail .attachment-wrapper {\n            flex-grow: 1;\n        }\n    </style>\n\n    <div class=\"links-wrapper\"></div>\n\n    <div class=\"attachment-wrapper\"></div>\n</div>`;\n\nexport default class AttachmentDetailTypeWidget extends TypeWidget {\n    static getType() {\n        return \"attachmentDetail\";\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$wrapper = this.$widget.find('.attachment-wrapper');\n        this.$linksWrapper = this.$widget.find('.links-wrapper');\n\n        super.doRender();\n    }\n\n    async doRefresh(note) {\n        this.$wrapper.empty();\n        this.children = [];\n\n        const $helpButton = $('<button class=\"attachment-help-button\" type=\"button\" data-help-page=\"attachments\" title=\"打开附件帮助页面\"><span class=\"bx bx-help-circle\"></span></button>');\n        utils.initHelpButtons($helpButton);\n\n        this.$linksWrapper.empty().append(\n            \"所属笔记: \",\n            await linkService.createLink(this.noteId),\n            \", 你也可以打开 \",\n            await linkService.createLink(this.noteId, {\n                title: '所有附件列表',\n                viewScope: {\n                    viewMode: 'attachments'\n                }\n            }),\n            $helpButton\n        );\n\n        const attachment = await froca.getAttachment(this.attachmentId, true);\n\n        if (!attachment) {\n            this.$wrapper.html(\"<strong>这个附件已被删除</strong>\");\n\n            return;\n        }\n\n        const attachmentDetailWidget = new AttachmentDetailWidget(attachment, true);\n        this.child(attachmentDetailWidget);\n\n        this.$wrapper.append(attachmentDetailWidget.render());\n    }\n\n    async entitiesReloadedEvent({loadResults}) {\n        const attachmentRow = loadResults.getAttachmentRows().find(att => att.attachmentId === this.attachmentId);\n\n        if (attachmentRow?.isDeleted) {\n            this.refresh(); // all other updates are handled within AttachmentDetailWidget\n        }\n    }\n\n    get attachmentId() {\n        return this.noteContext.viewScope.attachmentId;\n    }\n}\n","import TypeWidget from \"./type_widget.js\";\nimport AttachmentDetailWidget from \"../attachment_detail.js\";\nimport linkService from \"../../services/link.js\";\nimport utils from \"../../services/utils.js\";\n\nconst TPL = `\n<div class=\"attachment-list note-detail-printable\">\n    <style>\n        .attachment-list {\n            padding-left: 15px;\n            padding-right: 15px;\n        }\n        \n        .attachment-list .links-wrapper {\n            font-size: larger;\n            margin-bottom: 15px;\n            display: flex;\n            justify-content: space-between;\n            align-items: baseline;\n        }\n    </style>\n    \n    <div class=\"links-wrapper\"></div>\n\n    <div class=\"attachment-list-wrapper\"></div>\n</div>`;\n\nexport default class AttachmentListTypeWidget extends TypeWidget {\n    static getType() {\n        return \"attachmentList\";\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$list = this.$widget.find('.attachment-list-wrapper');\n        this.$linksWrapper = this.$widget.find('.links-wrapper');\n\n        super.doRender();\n    }\n\n    async doRefresh(note) {\n        const $helpButton = $('<button class=\"attachment-help-button\" type=\"button\" data-help-page=\"attachments\" title=\"打开附件帮助页面\"><span class=\"bx bx-help-circle\"></span></button>');\n        utils.initHelpButtons($helpButton);\n\n        const noteLink = await linkService.createLink(this.noteId); // do separately to avoid race condition between empty() and .append()\n\n        this.$linksWrapper.empty().append(\n            $('<div>').append(\n                \"所属笔记: \",\n                noteLink,\n            ),\n            $('<div>').append(\n                $('<button class=\"btn btn-sm\">')\n                    .text(\"上传附件\")\n                    .on('click', () => this.triggerCommand(\"showUploadAttachmentsDialog\", {noteId: this.noteId})),\n                $helpButton\n            )\n        );\n\n        this.$list.empty();\n        this.children = [];\n        this.renderedAttachmentIds = new Set();\n\n        const attachments = await note.getAttachments();\n\n        if (attachments.length === 0) {\n            this.$list.html('<div class=\"alert alert-info\">这个笔记没有附件</div>');\n\n            return;\n        }\n\n        for (const attachment of attachments) {\n            const attachmentDetailWidget = new AttachmentDetailWidget(attachment, false);\n\n            this.child(attachmentDetailWidget);\n\n            this.renderedAttachmentIds.add(attachment.attachmentId);\n\n            this.$list.append(attachmentDetailWidget.render());\n        }\n    }\n\n    async entitiesReloadedEvent({loadResults}) {\n        // updates and deletions are handled by the detail, for new attachments the whole list has to be refreshed\n        const attachmentsAdded = loadResults.getAttachmentRows()\n            .some(att => !this.renderedAttachmentIds.has(att.attachmentId));\n\n        if (attachmentsAdded) {\n            this.refresh();\n        }\n    }\n}\n","import BasicWidget from \"./basic_widget.js\";\nimport server from \"../services/server.js\";\nimport linkService from \"../services/link.js\";\nimport froca from \"../services/froca.js\";\nimport utils from \"../services/utils.js\";\nimport appContext from \"../components/app_context.js\";\nimport shortcutService from \"../services/shortcuts.js\";\n\nconst TPL = `\n<div class=\"quick-search input-group input-group-sm\">\n  <style>\n    .quick-search {\n        padding: 10px 10px 10px 0px;\n        height: 50px;\n    }\n    \n    .quick-search button, .quick-search input {\n        border: 0;\n        font-size: 100% !important;\n    }\n  \n    .quick-search .dropdown-menu {\n        max-height: 600px;\n        max-width: 400px;\n        overflow-y: auto;\n        overflow-x: hidden;\n        text-overflow: ellipsis;\n        box-shadow: -30px 50px 93px -50px black;\n    }\n  </style>\n  \n  <div class=\"input-group-prepend\">\n    <button class=\"btn btn-outline-secondary search-button\" type=\"button\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">\n        <span class=\"bx bx-search\"></span>\n    </button>\n    <div class=\"dropdown-menu dropdown-menu-left\"></div>\n  </div>\n  <input type=\"text\" class=\"form-control form-control-sm search-string\" placeholder=\"快速搜索\">\n  </div>\n</div>`;\n\nconst MAX_DISPLAYED_NOTES = 15;\n\nexport default class QuickSearchWidget extends BasicWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$searchString = this.$widget.find('.search-string');\n        this.$dropdownMenu = this.$widget.find('.dropdown-menu');\n        this.$dropdownToggle = this.$widget.find('.search-button');\n        this.$dropdownToggle.dropdown();\n\n        this.$widget.find('.input-group-prepend').on('shown.bs.dropdown', () => this.search());\n\n        if(utils.isMobile()) {\n            this.$searchString.keydown(e =>{\n                if(e.which === 13) {\n                    if (this.$dropdownMenu.is(\":visible\")) {\n                        this.search(); // just update already visible dropdown\n                    } else {\n                        this.$dropdownToggle.dropdown('show');\n                    }\n                    e.preventDefault();\n                    e.stopPropagation();\n                }\n            })\n        }\n\n        shortcutService.bindElShortcut(this.$searchString, 'return', () => {\n            if (this.$dropdownMenu.is(\":visible\")) {\n                this.search(); // just update already visible dropdown\n            } else {\n                this.$dropdownToggle.dropdown('show');\n            }\n\n            this.$searchString.focus();\n        });\n\n        shortcutService.bindElShortcut(this.$searchString, 'down', () => {\n            this.$dropdownMenu.find('.dropdown-item:first').focus();\n        });\n\n        shortcutService.bindElShortcut(this.$searchString, 'esc', () => {\n            this.$dropdownToggle.dropdown('hide');\n        });\n\n        return this.$widget;\n    }\n\n    async search() {\n        const searchString = this.$searchString.val().trim();\n\n        if (!searchString) {\n            this.$dropdownToggle.dropdown(\"hide\");\n            return;\n        }\n\n        this.$dropdownMenu.empty();\n        this.$dropdownMenu.append('<span class=\"dropdown-item disabled\"><span class=\"bx bx-loader bx-spin\"></span>正在搜索...</span>');\n\n        const {searchResultNoteIds, error} = await server.get(`quick-search/${encodeURIComponent(searchString)}`);\n\n        if (error) {\n            this.$searchString.tooltip({\n                trigger: 'manual',\n                title: `Search error: ${error}`,\n                placement: 'right'\n            });\n\n            this.$searchString.tooltip(\"show\");\n\n            setTimeout(() => this.$searchString.tooltip(\"dispose\"), 4000);\n        }\n\n        const displayedNoteIds = searchResultNoteIds.slice(0, Math.min(MAX_DISPLAYED_NOTES, searchResultNoteIds.length));\n\n        this.$dropdownMenu.empty();\n\n        if (displayedNoteIds.length === 0) {\n            this.$dropdownMenu.append('<span class=\"dropdown-item disabled\">没有找到结果</span>');\n        }\n\n        for (const note of await froca.getNotes(displayedNoteIds)) {\n            const $link = await linkService.createLink(note.noteId, {showNotePath: true});\n            $link.addClass('dropdown-item');\n            $link.attr(\"tabIndex\", \"0\");\n            $link.on('click', e => {\n                this.$dropdownToggle.dropdown(\"hide\");\n\n                if (!e.target || e.target.nodeName !== 'A') {\n                    // click on the link is handled by link handling, but we want the whole item clickable\n                    appContext.tabManager.getActiveContext().setNote(note.noteId);\n                }\n            });\n            shortcutService.bindElShortcut($link, 'return', () => {\n                this.$dropdownToggle.dropdown(\"hide\");\n\n                appContext.tabManager.getActiveContext().setNote(note.noteId);\n            });\n\n            this.$dropdownMenu.append($link);\n        }\n\n        if (searchResultNoteIds.length > MAX_DISPLAYED_NOTES) {\n            this.$dropdownMenu.append(`<span class=\"dropdown-item disabled\">... 以及另外 ${searchResultNoteIds.length - MAX_DISPLAYED_NOTES} 个结果</span>`);\n        }\n\n        const $showInFullButton = $('<a class=\"dropdown-item\" tabindex=\"0\">')\n            .append($('<button class=\"btn btn-sm\">在搜索中显示</button>'));\n\n        this.$dropdownMenu.append($showInFullButton);\n\n        $showInFullButton.on('click', () => this.showInFullSearch());\n\n        shortcutService.bindElShortcut($showInFullButton, 'return', () => this.showInFullSearch());\n\n        shortcutService.bindElShortcut(this.$dropdownMenu.find('.dropdown-item:first'), 'up', () => this.$searchString.focus());\n\n        this.$dropdownToggle.dropdown('update');\n    }\n\n    async showInFullSearch() {\n        this.$dropdownToggle.dropdown(\"hide\");\n\n        await appContext.triggerCommand('searchNotes', {\n            searchString: this.$searchString.val()\n        });\n    }\n\n    quickSearchEvent() {\n        this.$searchString.focus();\n    }\n}\n","import hoistedNoteService from \"../services/hoisted_note.js\";\nimport treeService from \"../services/tree.js\";\nimport utils from \"../services/utils.js\";\nimport contextMenu from \"../menus/context_menu.js\";\nimport froca from \"../services/froca.js\";\nimport branchService from \"../services/branches.js\";\nimport ws from \"../services/ws.js\";\nimport NoteContextAwareWidget from \"./note_context_aware_widget.js\";\nimport server from \"../services/server.js\";\nimport noteCreateService from \"../services/note_create.js\";\nimport toastService from \"../services/toast.js\";\nimport appContext from \"../components/app_context.js\";\nimport keyboardActionsService from \"../services/keyboard_actions.js\";\nimport clipboard from \"../services/clipboard.js\";\nimport protectedSessionService from \"../services/protected_session.js\";\nimport linkService from \"../services/link.js\";\nimport options from \"../services/options.js\";\nimport protectedSessionHolder from \"../services/protected_session_holder.js\";\nimport dialogService from \"../services/dialog.js\";\nimport shortcutService from \"../services/shortcuts.js\";\n\nconst TPL = `\n<div class=\"tree-wrapper\">\n    <style>\n    .tree-wrapper {\n        flex-grow: 1;\n        flex-shrink: 1;\n        flex-basis: 60%;\n        font-family: var(--tree-font-family);\n        font-size: var(--tree-font-size);\n        position: relative;\n        min-height: 0;\n    }\n    \n    .tree {\n        height: 100%;\n        overflow: auto;\n        padding-bottom: 35px;\n        padding-top: 5px;\n    }\n    \n    .tree-actions {\n        background-color: var(--launcher-pane-background-color);\n        z-index: 100;\n        position: absolute;\n        bottom: 0;\n        display: flex;\n        align-items: flex-end;\n        justify-content: flex-end;\n        right: 17px;\n        border-radius: 7px;\n        border: 1px solid var(--main-border-color);\n    }\n    \n    button.tree-floating-button {\n        margin: 1px;\n        font-size: 1.5em;\n        padding: 5px;\n        max-height: 34px;\n        color: var(--launcher-pane-text-color);\n        background-color: var(--button-background-color);\n        border-radius: var(--button-border-radius);\n        border: 1px solid transparent;\n    }\n    \n    button.tree-floating-button:hover {\n        border: 1px solid var(--button-border-color);\n    }\n    \n    .collapse-tree-button {\n        right: 100px;\n    }\n    \n    .scroll-to-active-note-button {\n        right: 55px;\n    }\n    \n    .tree-settings-button {\n        right: 10px;\n    }\n    \n    .tree-settings-popup {\n        display: none; \n        position: absolute; \n        background-color: var(--accented-background-color); \n        border: 1px solid var(--main-border-color); \n        padding: 20px; \n        z-index: 1000;\n        width: 340px; \n        border-radius: 10px;\n    }\n    \n    .tree .hidden-node-is-hidden {\n        display: none;\n    }\n    </style>\n    \n    <div class=\"tree\"></div>\n    \n    <div class=\"tree-actions\">\n        <button class=\"tree-floating-button bx bx-layer-minus collapse-tree-button\" \n                title=\"折叠笔记树\" \n                data-trigger-command=\"collapseTree\"></button>\n        \n        <button class=\"tree-floating-button bx bx-crosshair scroll-to-active-note-button\" \n                title=\"滚动到活动笔记\" \n                data-trigger-command=\"scrollToActiveNote\"></button>\n        \n        <button class=\"tree-floating-button bx bx-cog tree-settings-button\" \n                title=\"树设置\"></button>\n    </div>\n    \n    \n    <div class=\"tree-settings-popup\">\n        <div class=\"form-check\">\n            <label class=\"form-check-label\">\n                <input class=\"form-check-input hide-archived-notes\" type=\"checkbox\" value=\"\">\n            \n                隐藏已归档笔记\n            </label>\n        </div>\n        <div class=\"form-check\">\n            <label class=\"form-check-label\">\n                <input class=\"form-check-input auto-collapse-note-tree\" type=\"checkbox\" value=\"\">\n                \n                自动折叠笔记\n                <span class=\"bx bx-info-circle\" \n                      title=\"一段时间不活跃的笔记会被折叠.\"></span>\n            </label>\n        </div>\n    \n        <br/>\n    \n        <button class=\"btn btn-sm btn-primary save-tree-settings-button\" type=\"submit\">保存并应用修改</button>\n    </div>\n</div>\n`;\n\nconst MAX_SEARCH_RESULTS_IN_TREE = 100;\n\n// this has to be hanged on the actual elements to effectively intercept and stop click event\nconst cancelClickPropagation = e => e.stopPropagation();\n\nexport default class NoteTreeWidget extends NoteContextAwareWidget {\n    constructor() {\n        super();\n\n        this.treeName = \"main\"; // legacy value\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$tree = this.$widget.find('.tree');\n        this.$treeActions = this.$widget.find(\".tree-actions\");\n\n        this.$tree.on(\"mousedown\", \".unhoist-button\", () => hoistedNoteService.unhoist());\n        this.$tree.on(\"mousedown\", \".refresh-search-button\", e => this.refreshSearch(e));\n        this.$tree.on(\"mousedown\", \".add-note-button\", e => {\n            const node = $.ui.fancytree.getNode(e);\n            const parentNotePath = treeService.getNotePath(node);\n\n            noteCreateService.createNote(parentNotePath, {\n                isProtected: node.data.isProtected\n            });\n        });\n\n        this.$tree.on(\"mousedown\", \".enter-workspace-button\", e => {\n            const node = $.ui.fancytree.getNode(e);\n\n            this.triggerCommand('hoistNote', {noteId: node.data.noteId});\n        });\n\n        // fancytree doesn't support middle click, so this is a way to support it\n        this.$tree.on('mousedown', '.fancytree-title', e => {\n            if (e.which === 2) {\n                const node = $.ui.fancytree.getNode(e);\n\n                const notePath = treeService.getNotePath(node);\n\n                if (notePath) {\n                    appContext.tabManager.openTabWithNoteWithHoisting(notePath);\n                }\n\n                e.stopPropagation();\n                e.preventDefault();\n            }\n        });\n\n        this.$treeSettingsPopup = this.$widget.find('.tree-settings-popup');\n        this.$hideArchivedNotesCheckbox = this.$treeSettingsPopup.find('.hide-archived-notes');\n        this.$autoCollapseNoteTree = this.$treeSettingsPopup.find('.auto-collapse-note-tree');\n\n        this.$treeSettingsButton = this.$widget.find('.tree-settings-button');\n        this.$treeSettingsButton.on(\"click\", e => {\n            if (this.$treeSettingsPopup.is(\":visible\")) {\n                this.$treeSettingsPopup.hide();\n                return;\n            }\n\n            this.$hideArchivedNotesCheckbox.prop(\"checked\", this.hideArchivedNotes);\n            this.$autoCollapseNoteTree.prop(\"checked\", this.autoCollapseNoteTree);\n\n            const top = this.$treeActions[0].offsetTop - (this.$treeSettingsPopup.outerHeight());\n            const left = Math.max(\n                0,\n                this.$treeActions[0].offsetLeft - this.$treeSettingsPopup.outerWidth() + this.$treeActions.outerWidth()\n            );\n\n            this.$treeSettingsPopup.css({\n                top,\n                left\n            }).show();\n\n            return false;\n        });\n\n        this.$treeSettingsPopup.on(\"click\", e => {e.stopPropagation();});\n\n        $(document).on('click', () => this.$treeSettingsPopup.hide());\n\n        this.$saveTreeSettingsButton = this.$treeSettingsPopup.find('.save-tree-settings-button');\n        this.$saveTreeSettingsButton.on('click', async () => {\n            await this.setHideArchivedNotes(this.$hideArchivedNotesCheckbox.prop(\"checked\"));\n            await this.setAutoCollapseNoteTree(this.$autoCollapseNoteTree.prop(\"checked\"));\n\n            this.$treeSettingsPopup.hide();\n\n            this.reloadTreeFromCache();\n        });\n\n        // note tree starts initializing already during render which is atypical\n        Promise.all([options.initializedPromise, froca.initializedPromise]).then(() => this.initFancyTree());\n\n        this.setupNoteTitleTooltip();\n    }\n\n    setupNoteTitleTooltip() {\n        // the following will dynamically set tree item's tooltip if the whole item's text is not currently visible\n        // if the whole text is visible then no tooltip is show since that's unnecessarily distracting\n        // see https://github.com/zadam/trilium/pull/1120 for discussion\n\n        // code inspired by https://gist.github.com/jtsternberg/c272d7de5b967cec2d3d\n        const isEnclosing = ($container, $sub) => {\n            const conOffset = $container.offset();\n            const conDistanceFromTop = conOffset.top + $container.outerHeight(true);\n            const conDistanceFromLeft = conOffset.left + $container.outerWidth(true);\n\n            const subOffset = $sub.offset();\n            const subDistanceFromTop = subOffset.top + $sub.outerHeight(true);\n            const subDistanceFromLeft = subOffset.left + $sub.outerWidth(true);\n\n            return conDistanceFromTop > subDistanceFromTop\n                && conOffset.top < subOffset.top\n                && conDistanceFromLeft > subDistanceFromLeft\n                && conOffset.left < subOffset.left;\n        };\n\n        this.$tree.on(\"mouseenter\", \"span.fancytree-title\", e => {\n            e.currentTarget.title = isEnclosing(this.$tree, $(e.currentTarget))\n                ? \"\"\n                : e.currentTarget.innerText;\n        });\n    }\n\n    get hideArchivedNotes() {\n        return options.is(`hideArchivedNotes_${this.treeName}`);\n    }\n\n    async setHideArchivedNotes(val) {\n        await options.save(`hideArchivedNotes_${this.treeName}`, val.toString());\n    }\n\n    get autoCollapseNoteTree() {\n        return options.is(\"autoCollapseNoteTree\");\n    }\n\n    async setAutoCollapseNoteTree(val) {\n        await options.save(\"autoCollapseNoteTree\", val.toString());\n    }\n\n    initFancyTree() {\n        const treeData = [this.prepareRootNode()];\n\n        this.$tree.fancytree({\n            titlesTabbable: true,\n            keyboard: true,\n            extensions: [\"dnd5\", \"clones\", \"filter\"],\n            source: treeData,\n            scrollOfs: {\n                top: 100,\n                bottom: 100\n            },\n            scrollParent: this.$tree,\n            minExpandLevel: 2, // root can't be collapsed\n            click: (event, data) => {\n                this.activityDetected();\n\n                const targetType = data.targetType;\n                const node = data.node;\n\n                if (node.isSelected() && targetType === 'icon') {\n                    this.triggerCommand('openBulkActionsDialog', {\n                        selectedOrActiveNoteIds: this.getSelectedOrActiveNoteIds(node)\n                    });\n\n                    return false;\n                }\n                else if (targetType === 'title' || targetType === 'icon') {\n                    if (event.shiftKey) {\n                        const activeNode = this.getActiveNode();\n\n                        if (activeNode.getParent() !== node.getParent()) {\n                            return;\n                        }\n\n                        this.clearSelectedNodes();\n\n                        function selectInBetween(first, second) {\n                            for (let i = 0; first && first !== second && i < 10000; i++) {\n                                first.setSelected(true);\n                                first = first.getNextSibling();\n                            }\n\n                            second.setSelected();\n                        }\n\n                        if (activeNode.getIndex() < node.getIndex()) {\n                            selectInBetween(activeNode, node);\n                        } else {\n                            selectInBetween(node, activeNode);\n                        }\n\n                        node.setFocus(true);\n                    }\n                    else if ((!utils.isMac() && event.ctrlKey) || (utils.isMac() && event.metaKey)) {\n                        const notePath = treeService.getNotePath(node);\n                        appContext.tabManager.openTabWithNoteWithHoisting(notePath);\n                    }\n                    else if (event.altKey) {\n                        node.setSelected(!node.isSelected());\n                        node.setFocus(true);\n                    }\n                    else if (data.node.isActive()) {\n                        // this is important for single column mobile view, otherwise it's not possible to see again previously displayed note\n                        this.tree.reactivate(true);\n                    }\n                    else {\n                        node.setActive();\n                    }\n\n                    return false;\n                }\n            },\n            beforeActivate: (event, {node}) => {\n                // hidden subtree is hidden hackily - we want it to be present in the tree so that we can switch to it\n                // without reloading the whole tree, but we want it to be hidden when hoisted to root. FancyTree allows\n                // filtering the display only by ascendant - i.e. if the root is visible, all the descendants are as well.\n                // We solve it by hiding the hidden subtree via CSS (class \"hidden-node-is-hidden\"),\n                // but then we need to prevent activating it, e.g. by keyboard\n\n                if (hoistedNoteService.getHoistedNoteId() === '_hidden') {\n                    // if we're hoisted in hidden subtree, we want to avoid crossing to \"visible\" tree,\n                    // which could happen via UP key from hidden root\n\n                    return node.data.noteId !== 'root';\n                }\n\n                // we're not hoisted to hidden subtree, the only way to cross is via DOWN key to the hidden root\n                return node.data.noteId !== '_hidden';\n            },\n            activate: async (event, data) => {\n                // click event won't propagate so let's close context menu manually\n                contextMenu.hide();\n\n                this.clearSelectedNodes();\n\n                const notePath = treeService.getNotePath(data.node);\n\n                const activeNoteContext = appContext.tabManager.getActiveContext();\n                await activeNoteContext.setNote(notePath);\n            },\n            expand: (event, data) => this.setExpanded(data.node.data.branchId, true),\n            collapse: (event, data) => this.setExpanded(data.node.data.branchId, false),\n            filter: {\n                counter: false,\n                mode: \"hide\",\n                autoExpand: true\n            },\n            dnd5: {\n                autoExpandMS: 600,\n                preventLazyParents: false,\n                dragStart: (node, data) => {\n                    if (['root', '_hidden', '_lbRoot', '_lbAvailableLaunchers', '_lbVisibleLaunchers'].includes(node.data.noteId)\n                        || node.data.noteId.startsWith(\"_options\")) {\n                        return false;\n                    }\n\n                    const notes = this.getSelectedOrActiveNodes(node).map(node => ({\n                        noteId: node.data.noteId,\n                        branchId: node.data.branchId,\n                        title: node.title\n                    }));\n\n                    if (notes.length === 1) {\n                        linkService.createLink(notes[0].noteId, {referenceLink: true, autoConvertToImage: true})\n                            .then($link => data.dataTransfer.setData(\"text/html\", $link[0].outerHTML));\n                    }\n                    else {\n                        Promise.all(notes.map(note => linkService.createLink(note.noteId, {referenceLink: true, autoConvertToImage: true}))).then(links => {\n                            const $list = $(\"<ul>\").append(...links.map($link => $(\"<li>\").append($link)));\n\n                            data.dataTransfer.setData(\"text/html\", $list[0].outerHTML);\n                        });\n                    }\n\n                    data.dataTransfer.setData(\"text\", JSON.stringify(notes));\n                    return true; // allow dragging to start\n                },\n                dragEnter: (node, data) => {\n                    if (node.data.noteType === 'search') {\n                        return false;\n                    } else if (node.data.noteId === '_lbRoot') {\n                        return false;\n                    } else if (node.data.noteId.startsWith('_options')) {\n                        return false;\n                    } else if (node.data.noteType === 'launcher') {\n                        return ['before', 'after'];\n                    } else if (['_lbAvailableLaunchers', '_lbVisibleLaunchers'].includes(node.data.noteId)) {\n                        return ['over'];\n                    } else {\n                        return true;\n                    }\n                },\n                dragDrop: async (node, data) => {\n                    if ((data.hitMode === 'over' && node.data.noteType === 'search') ||\n                        (['after', 'before'].includes(data.hitMode)\n                            && (node.data.noteId === hoistedNoteService.getHoistedNoteId() || node.getParent().data.noteType === 'search'))) {\n\n                        await dialogService.info(\"笔记不允许移动到这个地方.\");\n\n                        return;\n                    }\n\n                    const dataTransfer = data.dataTransfer;\n\n                    if (dataTransfer && dataTransfer.files && dataTransfer.files.length > 0) {\n                        const files = [...dataTransfer.files]; // chrome has issue that dataTransfer.files empties after async operation\n\n                        const importService = await import('../services/import.js');\n\n                        importService.uploadFiles('notes', node.data.noteId, files, {\n                            safeImport: true,\n                            shrinkImages: true,\n                            textImportedAsText: true,\n                            codeImportedAsCode: true,\n                            explodeArchives: true,\n                            replaceUnderscoresWithSpaces: true\n                        });\n                    }\n                    else {\n                        const jsonStr = dataTransfer.getData(\"text\");\n                        let notes = null;\n\n                        try {\n                            notes = JSON.parse(jsonStr);\n                        }\n                        catch (e) {\n                            logError(`Cannot parse JSON '${jsonStr}' into notes for drop`);\n                            return;\n                        }\n\n                        // This function MUST be defined to enable dropping of items on the tree.\n                        // data.hitMode is 'before', 'after', or 'over'.\n\n                        const selectedBranchIds = notes.map(note => note.branchId);\n\n                        if (data.hitMode === \"before\") {\n                            branchService.moveBeforeBranch(selectedBranchIds, node.data.branchId);\n                        } else if (data.hitMode === \"after\") {\n                            branchService.moveAfterBranch(selectedBranchIds, node.data.branchId);\n                        } else if (data.hitMode === \"over\") {\n                            branchService.moveToParentNote(selectedBranchIds, node.data.branchId);\n                        } else {\n                            throw new Error(`Unknown hitMode '${data.hitMode}'`);\n                        }\n                    }\n                }\n            },\n            lazyLoad: (event, data) => {\n                const {noteId, noteType} = data.node.data;\n\n                if (noteType === 'search') {\n                    const notePath = treeService.getNotePath(data.node.getParent());\n\n                    // this is a search cycle (search note is a descendant of its own search result)\n                    if (notePath.includes(noteId)) {\n                        data.result = [];\n                        return;\n                    }\n\n                    data.result = froca.loadSearchNote(noteId).then(() => {\n                        const note = froca.getNoteFromCache(noteId);\n\n                        let childNoteIds = note.getChildNoteIds();\n\n                        if (note.type === 'search' && childNoteIds.length > MAX_SEARCH_RESULTS_IN_TREE) {\n                            childNoteIds = childNoteIds.slice(0, MAX_SEARCH_RESULTS_IN_TREE);\n                        }\n\n                        return froca.getNotes(childNoteIds);\n                    }).then(() => {\n                        const note = froca.getNoteFromCache(noteId);\n\n                        return this.prepareChildren(note);\n                    });\n                }\n                else {\n                    data.result = froca.loadSubTree(noteId).then(note => this.prepareChildren(note));\n                }\n            },\n            clones: {\n                highlightActiveClones: true\n            },\n            enhanceTitle: async function (event, data) {\n                const node = data.node;\n\n                if (!node.data.noteId) {\n                    // if there's \"non-note\" node, then don't enhance\n                    // this can happen for e.g. \"Load error!\" node\n                    return;\n                }\n\n                const note = await froca.getNote(node.data.noteId, true);\n\n                if (!note) {\n                    return;\n                }\n\n                const activeNoteContext = appContext.tabManager.getActiveContext();\n\n                const $span = $(node.span);\n\n                $span.find('.tree-item-button').remove();\n\n                const isHoistedNote = activeNoteContext && activeNoteContext.hoistedNoteId === note.noteId && note.noteId !== 'root';\n\n                if (note.hasLabel('workspace') && !isHoistedNote) {\n                    const $enterWorkspaceButton = $('<span class=\"tree-item-button enter-workspace-button bx bx-door-open\" title=\"提升这个笔记(工作区)\"></span>')\n                        .on(\"click\", cancelClickPropagation);\n\n                    $span.append($enterWorkspaceButton);\n                }\n\n                if (note.type === 'search') {\n                    const $refreshSearchButton = $('<span class=\"tree-item-button refresh-search-button bx bx-refresh\" title=\"刷新保存的搜索结果\"></span>')\n                        .on(\"click\", cancelClickPropagation);\n\n                    $span.append($refreshSearchButton);\n                }\n\n                if (!['search', 'launcher'].includes(note.type) && !note.isOptions() && !note.isLaunchBarConfig()) {\n                    const $createChildNoteButton = $('<span class=\"tree-item-button add-note-button bx bx-plus\" title=\"创建子笔记\"></span>')\n                        .on(\"click\", cancelClickPropagation);\n\n                    $span.append($createChildNoteButton);\n                }\n\n                if (isHoistedNote) {\n                    const $unhoistButton = $('<span class=\"tree-item-button unhoist-button bx bx-door-open\" title=\"取消提升\"></span>')\n                        .on(\"click\", cancelClickPropagation);\n\n                    $span.append($unhoistButton);\n                }\n            },\n            // this is done to automatically lazy load all expanded notes after tree load\n            loadChildren: (event, data) => {\n                data.node.visit((subNode) => {\n                    // Load all lazy/unloaded child nodes\n                    // (which will trigger `loadChildren` recursively)\n                    if (subNode.isUndefined() && subNode.isExpanded()) {\n                        subNode.load();\n                    }\n                });\n            },\n            select: (event, {node}) => {\n                if (hoistedNoteService.getHoistedNoteId() === 'root'\n                    && node.data.noteId === '_hidden'\n                    && node.isSelected()) {\n\n                    // hidden is hackily hidden from the tree via CSS when root is hoisted\n                    // make sure it's not selected by mistake, it could be e.g. deleted by mistake otherwise\n                    node.setSelected(false);\n\n                    return;\n                }\n\n                $(node.span).find(\".fancytree-custom-icon\").attr(\"title\",\n                    node.isSelected() ? \"对选定的笔记应用批量动作\" : \"\");\n            }\n        });\n\n        if (!utils.isMobile()) {\n            this.getHotKeys().then(hotKeys => {\n                for (const key in hotKeys) {\n                    const handler = hotKeys[key];\n\n                    $(this.tree.$container).on('keydown', null, key, evt => {\n                        const node = this.tree.getActiveNode();\n                        return handler(node, evt);\n                        // return false from the handler will stop default handling.\n                    });\n                }\n            });\n        }\n\n        this.$tree.on('contextmenu', '.fancytree-node', e => {\n            const node = $.ui.fancytree.getNode(e);\n            const note = froca.getNoteFromCache(node.data.noteId);\n\n            if (note.isLaunchBarConfig()) {\n                import(\"../menus/launcher_context_menu.js\").then(({default: LauncherContextMenu}) => {\n                    const launcherContextMenu = new LauncherContextMenu(this, node);\n                    launcherContextMenu.show(e);\n                });\n            } else {\n                import(\"../menus/tree_context_menu.js\").then(({default: TreeContextMenu}) => {\n                    const treeContextMenu = new TreeContextMenu(this, node);\n                    treeContextMenu.show(e);\n                });\n            }\n\n            return false; // blocks default browser right click menu\n        });\n\n        this.tree = $.ui.fancytree.getTree(this.$tree);\n    }\n\n    prepareRootNode() {\n        return this.prepareNode(froca.getBranch('none_root'));\n    }\n\n    /**\n     * @param {FNote} parentNote\n     */\n    prepareChildren(parentNote) {\n        utils.assertArguments(parentNote);\n\n        const noteList = [];\n\n        const hideArchivedNotes = this.hideArchivedNotes;\n\n        let childBranches = parentNote.getFilteredChildBranches();\n\n        if (parentNote.type === 'search' && childBranches.length > MAX_SEARCH_RESULTS_IN_TREE) {\n            childBranches = childBranches.slice(0, MAX_SEARCH_RESULTS_IN_TREE);\n        }\n\n        for (const branch of childBranches) {\n            if (hideArchivedNotes) {\n                const note = branch.getNoteFromCache();\n\n                if (note.hasLabel('archived')) {\n                    continue;\n                }\n            }\n\n            const node = this.prepareNode(branch);\n\n            noteList.push(node);\n        }\n\n        return noteList;\n    }\n\n    async updateNode(node) {\n        const note = froca.getNoteFromCache(node.data.noteId);\n        const branch = froca.getBranch(node.data.branchId);\n\n        if (!note) {\n            console.log(`Node update not possible because note '${node.data.noteId}' was not found.`);\n            return;\n        } else if (!branch) {\n            console.log(`Node update not possible because branch '${node.data.branchId}' was not found.`);\n            return;\n        }\n\n        const title = `${branch.prefix ? (`${branch.prefix} - `) : \"\"}${note.title}`;\n\n        node.data.isProtected = note.isProtected;\n        node.data.noteType = note.type;\n        node.folder = note.isFolder();\n        node.icon = note.getIcon();\n        node.extraClasses = this.getExtraClasses(note);\n        node.title = utils.escapeHtml(title);\n\n        if (node.isExpanded() !== branch.isExpanded) {\n            await node.setExpanded(branch.isExpanded, {noEvents: true, noAnimation: true});\n        }\n\n        node.renderTitle();\n    }\n\n    /**\n     * @param {FBranch} branch\n     * @param {boolean} forceLazy\n     */\n    prepareNode(branch, forceLazy = false) {\n        const note = branch.getNoteFromCache();\n\n        if (!note) {\n            throw new Error(`Branch '${branch.branchId}' has no child note '${branch.noteId}'`);\n        }\n\n        const title = `${branch.prefix ? (`${branch.prefix} - `) : \"\"}${note.title}`;\n\n        const isFolder = note.isFolder();\n\n        const node = {\n            noteId: note.noteId,\n            parentNoteId: branch.parentNoteId,\n            branchId: branch.branchId,\n            isProtected: note.isProtected,\n            noteType: note.type,\n            title: utils.escapeHtml(title),\n            extraClasses: this.getExtraClasses(note),\n            icon: note.getIcon(isFolder),\n            refKey: note.noteId,\n            lazy: true,\n            folder: isFolder,\n            expanded: branch.isExpanded && note.type !== 'search',\n            key: utils.randomString(12) // this should prevent some \"duplicate key\" errors\n        };\n\n        if (isFolder && node.expanded && !forceLazy) {\n            node.children = this.prepareChildren(note);\n        }\n\n        return node;\n    }\n\n    getExtraClasses(note) {\n        utils.assertArguments(note);\n\n        const extraClasses = [];\n\n        if (note.isProtected) {\n            extraClasses.push(\"protected\");\n        }\n\n        if (note.isShared()) {\n            extraClasses.push(\"shared\");\n        }\n\n        if (note.getParentNoteIds().length > 1) {\n            const realClones = note.getParentNoteIds()\n                .map(noteId => froca.notes[noteId])\n                .filter(note => !!note)\n                .filter(note =>\n                    !['_share', '_lbBookmarks'].includes(note.noteId)\n                    && note.type !== 'search');\n\n            if (realClones.length > 1) {\n                extraClasses.push(\"multiple-parents\");\n            }\n        }\n\n        const cssClass = note.getCssClass();\n\n        if (cssClass) {\n            extraClasses.push(cssClass);\n        }\n\n        extraClasses.push(utils.getNoteTypeClass(note.type));\n\n        if (note.mime) { // some notes should not have mime type (e.g. render)\n            extraClasses.push(utils.getMimeTypeClass(note.mime));\n        }\n\n        if (note.hasLabel('archived')) {\n            extraClasses.push(\"archived\");\n        }\n\n        const colorClass = note.getColorClass();\n\n        if (colorClass) {\n            extraClasses.push(colorClass);\n        }\n\n        return extraClasses.join(\" \");\n    }\n\n    /** @returns {FancytreeNode[]} */\n    getSelectedNodes(stopOnParents = false) {\n        return this.tree.getSelectedNodes(stopOnParents);\n    }\n\n    /** @returns {FancytreeNode[]} */\n    getSelectedOrActiveNodes(node = null) {\n        const nodes = this.getSelectedNodes(true);\n\n        // the node you start dragging should be included even if not selected\n        if (node && !nodes.find(n => n.key === node.key)) {\n            nodes.push(node);\n        }\n\n        if (nodes.length === 0) {\n            nodes.push(this.getActiveNode());\n        }\n\n        // hidden subtree is hackily hidden via CSS when hoisted to root\n        // make sure it's never selected for e.g. deletion in such a case\n        return nodes.filter(node => hoistedNoteService.getHoistedNoteId() !== 'root'\n                                               || node.data.noteId !== '_hidden');\n    }\n\n    async setExpandedStatusForSubtree(node, isExpanded) {\n        if (!node) {\n            const hoistedNoteId = hoistedNoteService.getHoistedNoteId();\n\n            node = this.getNodesByNoteId(hoistedNoteId)[0];\n        }\n\n        const {branchIds} = await server.put(`branches/${node.data.branchId}/expanded-subtree/${isExpanded ? 1 : 0}`);\n\n        froca.getBranches(branchIds, true)\n            .forEach(branch => branch.isExpanded = !!isExpanded);\n\n        await this.batchUpdate(async () => {\n            await node.load(true);\n\n            if (node.data.noteId !== hoistedNoteService.getHoistedNoteId()) { // hoisted note should always be expanded\n                await node.setExpanded(isExpanded, {noEvents: true, noAnimation: true});\n            }\n        });\n\n        await this.filterHoistedBranch(true);\n\n        // don't activate the active note, see discussion in https://github.com/zadam/trilium/issues/3664\n    }\n\n    async expandTree(node = null) {\n        await this.setExpandedStatusForSubtree(node, true);\n    }\n\n    async collapseTree(node = null) {\n        await this.setExpandedStatusForSubtree(node, false);\n    }\n\n    collapseTreeEvent() {this.collapseTree();}\n\n    /**\n     * @returns {FancytreeNode|null}\n     */\n    getActiveNode() {\n        return this.tree.getActiveNode();\n    }\n\n    /**\n     * focused & not active node can happen during multiselection where the node is selected\n     * but not activated (its content is not displayed in the detail)\n     * @returns {FancytreeNode|null}\n     */\n    getFocusedNode() {\n        return this.tree.getFocusNode();\n    }\n\n    clearSelectedNodes() {\n        for (const selectedNode of this.getSelectedNodes()) {\n            selectedNode.setSelected(false);\n        }\n    }\n\n    async scrollToActiveNoteEvent() {\n        const activeContext = appContext.tabManager.getActiveContext();\n\n        if (activeContext && activeContext.notePath) {\n            this.tree.$container.focus();\n            this.tree.setFocus(true);\n\n            const node = await this.expandToNote(activeContext.notePath);\n\n            if (node) {\n                await node.makeVisible({scrollIntoView: true});\n                node.setActive(true, {noEvents: true, noFocus: false});\n            }\n        }\n    }\n\n    async focusTreeEvent() {\n        this.tree.$container.focus();\n        this.tree.setFocus(true);\n    }\n\n    /** @returns {FancytreeNode} */\n    async getNodeFromPath(notePath, expand = false, logErrors = true) {\n        utils.assertArguments(notePath);\n        /** @let {FancytreeNode} */\n        let parentNode = this.getNodesByNoteId('root')[0];\n\n        let resolvedNotePathSegments = await treeService.resolveNotePathToSegments(notePath, this.hoistedNoteId, logErrors);\n\n        if (!resolvedNotePathSegments) {\n            if (logErrors) {\n                logError(\"找不到运行路径, 对应notePath为:\", notePath);\n            }\n\n            return;\n        }\n\n        resolvedNotePathSegments = resolvedNotePathSegments.slice(1);\n\n        for (const childNoteId of resolvedNotePathSegments) {\n            // we expand only after hoisted note since before then nodes are not actually present in the tree\n            if (parentNode) {\n                if (!parentNode.isLoaded()) {\n                    await parentNode.load();\n                }\n\n                if (expand) {\n                    if (!parentNode.isExpanded()) {\n                        await parentNode.setExpanded(true, {noAnimation: true});\n                    }\n\n                    // although the previous line should set the expanded status, it seems to happen asynchronously,\n                    // so we need to make sure it is set properly before calling updateNode which uses this flag\n                    const branch = froca.getBranch(parentNode.data.branchId);\n                    branch.isExpanded = true;\n                }\n\n                await this.updateNode(parentNode);\n\n                let foundChildNode = this.findChildNode(parentNode, childNoteId);\n\n                if (!foundChildNode) { // note might be recently created, so we'll force reload and try again\n                    await parentNode.load(true);\n\n                    foundChildNode = this.findChildNode(parentNode, childNoteId);\n\n                    if (!foundChildNode) {\n                        if (logErrors) {\n                            // besides real errors, this can be also caused by hiding of e.g. included images\n                            // these are real notes with real notePath, user can display them in a detail,\n                            // but they don't have a node in the tree\n\n                            const childNote = await froca.getNote(childNoteId);\n\n                            if (!childNote || childNote.type !== 'image') {\n                                ws.logError(`Can't find node for child node of noteId=${childNoteId} for parent of noteId=${parentNode.data.noteId} and hoistedNoteId=${hoistedNoteService.getHoistedNoteId()}, requested path is ${notePath}`);\n                            }\n                        }\n\n                        return;\n                    }\n                }\n\n                parentNode = foundChildNode;\n            }\n        }\n\n        return parentNode;\n    }\n\n    /** @returns {FancytreeNode} */\n    findChildNode(parentNode, childNoteId) {\n        return parentNode.getChildren().find(childNode => childNode.data.noteId === childNoteId);\n    }\n\n    /** @returns {FancytreeNode} */\n    async expandToNote(notePath, logErrors = true) {\n        return this.getNodeFromPath(notePath, true, logErrors);\n    }\n\n    /** @returns {FancytreeNode[]} */\n    getNodesByBranch(branch) {\n        utils.assertArguments(branch);\n\n        return this.getNodesByNoteId(branch.noteId).filter(node => node.data.branchId === branch.branchId);\n    }\n\n    /** @returns {FancytreeNode[]} */\n    getNodesByNoteId(noteId) {\n        utils.assertArguments(noteId);\n\n        const list = this.tree.getNodesByRef(noteId);\n        return list ? list : []; // if no nodes with this refKey are found, fancy tree returns null\n    }\n\n    isEnabled() {\n        return !!this.noteContext;\n    }\n\n    async refresh() {\n        this.toggleInt(this.isEnabled());\n        this.$treeSettingsPopup.hide();\n\n        this.activityDetected();\n\n        const oldActiveNode = this.getActiveNode();\n\n        const newActiveNode = this.noteContext?.notePath\n            && (!treeService.isNotePathInHiddenSubtree(this.noteContext.notePath) || await hoistedNoteService.isHoistedInHiddenSubtree())\n            && await this.getNodeFromPath(this.noteContext.notePath);\n\n        if (newActiveNode !== oldActiveNode) {\n            let oldActiveNodeFocused = false;\n\n            if (oldActiveNode) {\n                oldActiveNodeFocused = oldActiveNode.hasFocus();\n\n                oldActiveNode.setActive(false);\n                oldActiveNode.setFocus(false);\n            }\n\n            if (newActiveNode) {\n                if (!newActiveNode.isVisible()) {\n                    await this.expandToNote(this.noteContext.notePath);\n                }\n\n                newActiveNode.setActive(true, {noEvents: true, noFocus: !oldActiveNodeFocused});\n                newActiveNode.makeVisible({scrollIntoView: true});\n            }\n        }\n\n        this.filterHoistedBranch(false);\n    }\n\n    async refreshSearch(e) {\n        const activeNode = $.ui.fancytree.getNode(e);\n\n        activeNode.load(true);\n        activeNode.setExpanded(true, {noAnimation: true});\n\n        toastService.showMessage(\"保存的搜索结果已刷新.\");\n    }\n\n    async batchUpdate(cb) {\n        try {\n            // disable rendering during update for increased performance\n            this.tree.enableUpdate(false);\n\n            await cb();\n        }\n        finally {\n            this.tree.enableUpdate(true);\n        }\n    }\n\n    activityDetected() {\n        if (this.autoCollapseTimeoutId) {\n            clearTimeout(this.autoCollapseTimeoutId);\n        }\n\n        this.autoCollapseTimeoutId = setTimeout(() => {\n            if (!this.autoCollapseNoteTree) {\n                return;\n            }\n\n            /*\n             * We're collapsing notes after a period of inactivity to \"cleanup\" the tree - users rarely\n             * collapse the notes and the tree becomes unusuably large.\n             * Some context: https://github.com/zadam/trilium/issues/1192\n             */\n\n            const noteIdsToKeepExpanded = new Set(\n                appContext.tabManager.getNoteContexts()\n                    .map(nc => nc.notePathArray)\n                    .flat()\n            );\n\n            let noneCollapsedYet = true;\n\n            this.tree.getRootNode().visit(node => {\n                if (node.isExpanded() && !noteIdsToKeepExpanded.has(node.data.noteId)) {\n                    node.setExpanded(false);\n\n                    if (noneCollapsedYet) {\n                        toastService.showMessage(\"自动折叠一段时间不活跃的笔记...\");\n                        noneCollapsedYet = false;\n                    }\n                }\n            }, false);\n\n            this.filterHoistedBranch(true);\n        }, 600 * 1000);\n    }\n\n    async entitiesReloadedEvent({loadResults}) {\n        this.activityDetected();\n\n        if (loadResults.isEmptyForTree()) {\n            return;\n        }\n\n        const nodeCtx = this.#getActiveNodeCtx();\n\n        const refreshCtx = {\n            noteIdsToUpdate: new Set(),\n            noteIdsToReload: new Set()\n        };\n\n        this.#processAttributeRows(loadResults.getAttributeRows(), refreshCtx);\n\n        const { movedActiveNode, parentsOfAddedNodes } = await this.#processBranchRows(loadResults.getBranchRows(), refreshCtx);\n\n        for (const noteId of loadResults.getNoteIds()) {\n            refreshCtx.noteIdsToUpdate.add(noteId);\n        }\n\n        await this.#executeTreeUpdates(refreshCtx, loadResults);\n\n        await this.#setActiveNode(nodeCtx, movedActiveNode, parentsOfAddedNodes);\n\n        if (refreshCtx.noteIdsToReload.size > 0 || refreshCtx.noteIdsToUpdate.size > 0) {\n            // workaround for https://github.com/mar10/fancytree/issues/1054\n            this.filterHoistedBranch(true);\n        }\n    }\n\n    #processAttributeRows(attributeRows, refreshCtx) {\n        for (const attrRow of attributeRows) {\n            const dirtyingLabels = ['iconClass', 'cssClass', 'workspace', 'workspaceIconClass', 'color'];\n\n            if (attrRow.type === 'label' && dirtyingLabels.includes(attrRow.name)) {\n                if (attrRow.isInheritable) {\n                    refreshCtx.noteIdsToReload.add(attrRow.noteId);\n                } else {\n                    refreshCtx.noteIdsToUpdate.add(attrRow.noteId);\n                }\n            } else if (attrRow.type === 'label' && attrRow.name === 'archived') {\n                const note = froca.getNoteFromCache(attrRow.noteId);\n\n                if (note) {\n                    // change of archived status can mean the note should not be displayed in the tree at all\n                    // depending on the value of this.hideArchivedNotes\n                    for (const parentNote of note.getParentNotes()) {\n                        refreshCtx.noteIdsToReload.add(parentNote.noteId);\n                    }\n                }\n            } else if (attrRow.type === 'relation' && (attrRow.name === 'template' || attrRow.name === 'inherit')) {\n                // missing handling of things inherited from template\n                refreshCtx.noteIdsToReload.add(attrRow.noteId);\n            } else if (attrRow.type === 'relation' && attrRow.name === 'imageLink') {\n                const note = froca.getNoteFromCache(attrRow.noteId);\n\n                if (note && note.getChildNoteIds().includes(attrRow.value)) {\n                    // there's a new /deleted imageLink between note and its image child - which can show/hide\n                    // the image (if there is an imageLink relation between parent and child,\n                    // then it is assumed to be \"contained\" in the note and thus does not have to be displayed in the tree)\n                    refreshCtx.noteIdsToReload.add(attrRow.noteId);\n                }\n            }\n        }\n    }\n\n    async #processBranchRows(branchRows, refreshCtx) {\n        const allBranchesDeleted = branchRows.every(branchRow => !!branchRow.isDeleted);\n\n        // activeNode is supposed to be moved when we find out activeNode is deleted but not all branches are deleted. save it for fixing activeNodePath after all nodes loaded.\n        let movedActiveNode = null;\n        let parentsOfAddedNodes = [];\n\n        for (const branchRow of branchRows) {\n            if (branchRow.parentNoteId === '_share') {\n                // all shared notes have a sign in the tree, even the descendants of shared notes\n                refreshCtx.noteIdsToReload.add(branchRow.noteId);\n            } else {\n                // adding noteId itself to update all potential clones\n                refreshCtx.noteIdsToUpdate.add(branchRow.noteId);\n            }\n\n            if (branchRow.isDeleted) {\n                for (const node of this.getNodesByBranch(branchRow)) {\n                    if (node.isActive()) {\n                        if (allBranchesDeleted) {\n                            const newActiveNode = node.getNextSibling()\n                                || node.getPrevSibling()\n                                || node.getParent();\n\n                            if (newActiveNode) {\n                                newActiveNode.setActive(true, {noEvents: true, noFocus: true});\n                            }\n                        } else {\n                            movedActiveNode = node;\n                        }\n                    }\n\n                    if (node.getParent()) {\n                        node.remove();\n                    }\n\n                    refreshCtx.noteIdsToUpdate.add(branchRow.parentNoteId);\n                }\n            } else {\n                for (const parentNode of this.getNodesByNoteId(branchRow.parentNoteId)) {\n                    parentsOfAddedNodes.push(parentNode)\n\n                    if (parentNode.isFolder() && !parentNode.isLoaded()) {\n                        continue;\n                    }\n\n                    const note = await froca.getNote(branchRow.noteId);\n                    const frocaBranch = froca.getBranch(branchRow.branchId);\n                    const foundNode = (parentNode.getChildren() || []).find(child => child.data.noteId === branchRow.noteId);\n                    if (foundNode) {\n                        // the branch already exists in the tree\n                        if (branchRow.isExpanded !== foundNode.isExpanded()) {\n                            refreshCtx.noteIdsToReload.add(frocaBranch.noteId);\n                        }\n                    } else {\n                        // make sure it's loaded\n                        // we're forcing lazy since it's not clear if the whole required subtree is in froca\n                        parentNode.addChildren([this.prepareNode(frocaBranch, true)]);\n\n                        if (frocaBranch.isExpanded && note.hasChildren()) {\n                            refreshCtx.noteIdsToReload.add(frocaBranch.noteId);\n                        }\n\n                        this.sortChildren(parentNode);\n\n                        // this might be a first child which would force an icon change\n                        refreshCtx.noteIdsToUpdate.add(branchRow.parentNoteId);\n                    }\n                }\n            }\n        }\n\n        return {\n            movedActiveNode,\n            parentsOfAddedNodes\n        };\n    }\n\n    async #executeTreeUpdates(refreshCtx, loadResults) {\n        await this.batchUpdate(async () => {\n            for (const noteId of refreshCtx.noteIdsToReload) {\n                for (const node of this.getNodesByNoteId(noteId)) {\n                    await node.load(true);\n\n                    refreshCtx.noteIdsToUpdate.add(noteId);\n                }\n            }\n\n            for (const parentNoteId of loadResults.getNoteReorderings()) {\n                for (const node of this.getNodesByNoteId(parentNoteId)) {\n                    if (node.isLoaded()) {\n                        this.sortChildren(node);\n                    }\n                }\n            }\n        });\n\n        // for some reason, node update cannot be in the batchUpdate() block (node is not re-rendered)\n        for (const noteId of refreshCtx.noteIdsToUpdate) {\n            for (const node of this.getNodesByNoteId(noteId)) {\n                await this.updateNode(node);\n            }\n        }\n    }\n\n    #getActiveNodeCtx() {\n        const nodeCtx = {\n            activeNotePath: null,\n            activeNodeFocused: null,\n            nextNotePath: null\n        };\n\n        const activeNode = this.getActiveNode();\n        nodeCtx.activeNodeFocused = activeNode?.hasFocus();\n        nodeCtx.activeNotePath = activeNode ? treeService.getNotePath(activeNode) : null;\n        const nextNode = activeNode ? (activeNode.getNextSibling() || activeNode.getPrevSibling() || activeNode.getParent()) : null;\n        nodeCtx.nextNotePath = nextNode ? treeService.getNotePath(nextNode) : null;\n        return nodeCtx;\n    }\n\n    async #setActiveNode(nodeCtx, movedActiveNode, parentsOfAddedNodes) {\n        if (movedActiveNode) {\n            for (const parentNode of parentsOfAddedNodes) {\n                const foundNode = (parentNode.getChildren() || []).find(child => child.data.noteId === movedActiveNode.data.noteId);\n                if (foundNode) {\n                    nodeCtx.activeNotePath = treeService.getNotePath(foundNode);\n                    break;\n                }\n            }\n        }\n\n        if (!nodeCtx.activeNotePath) {\n            return;\n        }\n\n        let node = await this.expandToNote(nodeCtx.activeNotePath, false);\n        if (node && node.data.noteId !== treeService.getNoteIdFromUrl(nodeCtx.activeNotePath)) {\n            // if the active note has been moved elsewhere then it won't be found by the path,\n            // so we switch to the alternative of trying to find it by noteId\n            const notesById = this.getNodesByNoteId(treeService.getNoteIdFromUrl(nodeCtx.activeNotePath));\n\n            // if there are multiple clones, then we'd rather not activate anyone\n            node = notesById.length === 1 ? notesById[0] : null;\n        }\n\n        if (node) {\n            if (nodeCtx.activeNodeFocused) {\n                // needed by Firefox: https://github.com/zadam/trilium/issues/1865\n                this.tree.$container.focus();\n            }\n\n            await node.setActive(true, {noEvents: true, noFocus: !nodeCtx.activeNodeFocused});\n        } else {\n            // this is used when the original note has been deleted, and we want to move the focus to the note above/below\n            node = await this.expandToNote(nodeCtx.nextNotePath, false);\n\n            if (node) {\n                // FIXME: this is conceptually wrong\n                //        here note tree is responsible for updating global state of the application\n                //        this should be done by NoteContext / TabManager and note tree should only listen to\n                //        changes in active note and just set the \"active\" state\n                // We don't await since that can bring up infinite cycles when e.g. custom widget does some backend requests which wait for max sync ID processed\n                appContext.tabManager.getActiveContext().setNote(nodeCtx.nextNotePath).then(() => {\n                    const newActiveNode = this.getActiveNode();\n\n                    // return focus if the previously active node was also focused\n                    if (newActiveNode && nodeCtx.activeNodeFocused) {\n                        newActiveNode.setFocus(true);\n                    }\n                });\n            }\n        }\n    }\n\n    sortChildren(node) {\n        node.sortChildren((nodeA, nodeB) => {\n            const branchA = froca.branches[nodeA.data.branchId];\n            const branchB = froca.branches[nodeB.data.branchId];\n\n            if (!branchA || !branchB) {\n                return 0;\n            }\n\n            return branchA.notePosition - branchB.notePosition;\n        });\n    }\n\n    setExpanded(branchId, isExpanded) {\n        utils.assertArguments(branchId);\n\n        const branch = froca.getBranch(branchId, true);\n\n        if (!branch) {\n            if (branchId && branchId.startsWith('virt')) {\n                // in case of virtual branches there's nothing to update\n                return;\n            }\n            else {\n                logError(`找不到 branch=${branchId}`);\n                return;\n            }\n        }\n\n        branch.isExpanded = isExpanded;\n\n        server.put(`branches/${branchId}/expanded/${isExpanded ? 1 : 0}`);\n    }\n\n    async reloadTreeFromCache() {\n        const activeNode = this.getActiveNode();\n\n        const activeNotePath = activeNode !== null ? treeService.getNotePath(activeNode) : null;\n\n        const rootNode = this.prepareRootNode();\n\n        await this.batchUpdate(async () => {\n            await this.tree.reload([rootNode]);\n        });\n\n        await this.filterHoistedBranch(true);\n\n        if (activeNotePath) {\n            const node = await this.getNodeFromPath(activeNotePath, true);\n\n            if (node) {\n                await node.setActive(true, {noEvents: true, noFocus: true});\n            }\n        }\n    }\n\n    async hoistedNoteChangedEvent({ntxId}) {\n        if (this.isNoteContext(ntxId)) {\n            await this.filterHoistedBranch(true);\n        }\n    }\n\n    async filterHoistedBranch(forceUpdate = false) {\n        if (!this.noteContext) {\n            return;\n        }\n\n        const hoistedNotePath = await treeService.resolveNotePath(this.noteContext.hoistedNoteId);\n\n        if (!forceUpdate && this.lastFilteredHoistedNotePath === hoistedNotePath) {\n            // no need to re-filter if the hoisting did not change\n            // (helps with flickering on simple note change with large subtrees)\n            return;\n        }\n\n        this.lastFilteredHoistedNotePath = hoistedNotePath;\n\n        await this.getNodeFromPath(hoistedNotePath);\n\n        if (this.noteContext.hoistedNoteId === 'root') {\n            this.tree.clearFilter();\n            this.toggleHiddenNode(false); // show everything but the hidden subtree\n        } else {\n            // hack when hoisted note is cloned then it could be filtered multiple times while we want only 1\n            this.tree.filterBranches(node =>\n                node.data.noteId === this.noteContext.hoistedNoteId // optimization to not having always resolve the node path\n                && treeService.getNotePath(node) === hoistedNotePath);\n\n            this.toggleHiddenNode(true); // hoisting will handle hidden note visibility\n        }\n    }\n\n    toggleHiddenNode(show) {\n        const hiddenNode = this.getNodesByNoteId('_hidden')[0];\n        $(hiddenNode.li).toggleClass(\"hidden-node-is-hidden\", !show);\n    }\n\n    frocaReloadedEvent() {\n        this.reloadTreeFromCache();\n    }\n\n    async getHotKeys() {\n        const actions = await keyboardActionsService.getActionsForScope('note-tree');\n        const hotKeyMap = {};\n\n        for (const action of actions) {\n            for (const shortcut of action.effectiveShortcuts) {\n                hotKeyMap[shortcutService.normalizeShortcut(shortcut)] = node => {\n                    const notePath = treeService.getNotePath(node);\n\n                    this.triggerCommand(action.actionName, {node, notePath});\n\n                    return false;\n                }\n            }\n        }\n\n        return hotKeyMap;\n    }\n\n    /**\n     * @param {FancytreeNode} node\n     */\n    getSelectedOrActiveBranchIds(node) {\n        const nodes = this.getSelectedOrActiveNodes(node);\n\n        return nodes.map(node => node.data.branchId);\n    }\n\n    /**\n     * @param {FancytreeNode} node\n     */\n    getSelectedOrActiveNoteIds(node) {\n        const nodes = this.getSelectedOrActiveNodes(node);\n\n        return nodes.map(node => node.data.noteId);\n    }\n\n    async deleteNotesCommand({node}) {\n        const branchIds = this.getSelectedOrActiveBranchIds(node)\n            .filter(branchId => !branchId.startsWith('virt-')); // search results can't be deleted\n\n        if (!branchIds.length) {\n            return;\n        }\n\n        await branchService.deleteNotes(branchIds);\n\n        this.clearSelectedNodes();\n    }\n\n    canBeMovedUpOrDown(node) {\n        if (node.data.noteId === 'root') {\n            return false;\n        }\n\n        const parentNote = froca.getNoteFromCache(node.getParent().data.noteId);\n\n        return !parentNote?.hasLabel('sorted');\n    }\n\n    moveNoteUpCommand({node}) {\n        if (!this.canBeMovedUpOrDown(node)) {\n            return;\n        }\n\n        const beforeNode = node.getPrevSibling();\n\n        if (beforeNode !== null) {\n            branchService.moveBeforeBranch([node.data.branchId], beforeNode.data.branchId);\n        }\n    }\n\n    moveNoteDownCommand({node}) {\n        if (!this.canBeMovedUpOrDown(node)) {\n            return;\n        }\n\n        const afterNode = node.getNextSibling();\n\n        if (afterNode !== null) {\n            branchService.moveAfterBranch([node.data.branchId], afterNode.data.branchId);\n        }\n    }\n\n    moveNoteUpInHierarchyCommand({node}) {\n        branchService.moveNodeUpInHierarchy(node);\n    }\n\n    moveNoteDownInHierarchyCommand({node}) {\n        const toNode = node.getPrevSibling();\n\n        if (toNode !== null) {\n            branchService.moveToParentNote([node.data.branchId], toNode.data.branchId);\n        }\n    }\n\n    addNoteAboveToSelectionCommand() {\n        const node = this.getFocusedNode();\n\n        if (!node) {\n            return;\n        }\n\n        if (node.isActive()) {\n            node.setSelected(true);\n        }\n\n        const prevSibling = node.getPrevSibling();\n\n        if (prevSibling) {\n            prevSibling.setActive(true, {noEvents: true});\n\n            if (prevSibling.isSelected()) {\n                node.setSelected(false);\n            }\n\n            prevSibling.setSelected(true);\n        }\n    }\n\n    addNoteBelowToSelectionCommand() {\n        const node = this.getFocusedNode();\n\n        if (!node) {\n            return;\n        }\n\n        if (node.isActive()) {\n            node.setSelected(true);\n        }\n\n        const nextSibling = node.getNextSibling();\n\n        if (nextSibling) {\n            nextSibling.setActive(true, {noEvents: true});\n\n            if (nextSibling.isSelected()) {\n                node.setSelected(false);\n            }\n\n            nextSibling.setSelected(true);\n        }\n    }\n\n    expandSubtreeCommand({node}) {\n        this.expandTree(node);\n    }\n\n    collapseSubtreeCommand({node}) {\n        this.collapseTree(node);\n    }\n\n    async recentChangesInSubtreeCommand({node}) {\n        this.triggerCommand(\"showRecentChanges\", {ancestorNoteId: node.data.noteId});\n    }\n\n    selectAllNotesInParentCommand({node}) {\n        for (const child of node.getParent().getChildren()) {\n            child.setSelected(true);\n        }\n    }\n\n    copyNotesToClipboardCommand({node}) {\n        clipboard.copy(this.getSelectedOrActiveBranchIds(node));\n    }\n\n    cutNotesToClipboardCommand({node}) {\n        clipboard.cut(this.getSelectedOrActiveBranchIds(node));\n    }\n\n    pasteNotesFromClipboardCommand({node}) {\n        clipboard.pasteInto(node.data.branchId);\n    }\n\n    pasteNotesAfterFromClipboardCommand({node}) {\n        clipboard.pasteAfter(node.data.branchId);\n    }\n\n    async exportNoteCommand({node}) {\n        const notePath = treeService.getNotePath(node);\n\n        this.triggerCommand(\"showExportDialog\", {notePath, defaultType: \"subtree\"});\n    }\n\n    async importIntoNoteCommand({node}) {\n        this.triggerCommand(\"showImportDialog\", {noteId: node.data.noteId});\n    }\n\n    editNoteTitleCommand({node}) {\n        appContext.triggerCommand('focusOnTitle');\n    }\n\n    protectSubtreeCommand({node}) {\n        protectedSessionService.protectNote(node.data.noteId, true, true);\n    }\n\n    unprotectSubtreeCommand({node}) {\n        protectedSessionService.protectNote(node.data.noteId, false, true);\n    }\n\n    duplicateSubtreeCommand({node}) {\n        const nodesToDuplicate = this.getSelectedOrActiveNodes(node);\n\n        for (const nodeToDuplicate of nodesToDuplicate) {\n            const note = froca.getNoteFromCache(nodeToDuplicate.data.noteId);\n\n            if (note.isProtected && !protectedSessionHolder.isProtectedSessionAvailable()) {\n                continue;\n            }\n\n            const branch = froca.getBranch(nodeToDuplicate.data.branchId);\n\n            noteCreateService.duplicateSubtree(nodeToDuplicate.data.noteId, branch.parentNoteId);\n        }\n    }\n\n    moveShortcutToVisibleCommand({node, selectedOrActiveBranchIds}) {\n        branchService.moveToParentNote(selectedOrActiveBranchIds, '_lbVisibleLaunchers');\n    }\n\n    moveShortcutToAvailableCommand({node, selectedOrActiveBranchIds}) {\n        branchService.moveToParentNote(selectedOrActiveBranchIds, '_lbAvailableLaunchers');\n    }\n\n    addNoteLauncherCommand({node}) {\n        this.createLauncherNote(node, 'note');\n    }\n\n    addScriptLauncherCommand({node}) {\n        this.createLauncherNote(node, 'script');\n    }\n\n    addWidgetLauncherCommand({node}) {\n        this.createLauncherNote(node, 'customWidget');\n    }\n\n    addSpacerLauncherCommand({node}) {\n        this.createLauncherNote(node, 'spacer');\n    }\n\n    async createLauncherNote(node, launcherType) {\n        const resp = await server.post(`special-notes/launchers/${node.data.noteId}/${launcherType}`);\n\n        if (!resp.success) {\n            toastService.showError(resp.message);\n        }\n\n        await ws.waitForMaxKnownEntityChangeId();\n\n        appContext.tabManager.getActiveContext().setNote(resp.note.noteId);\n    }\n}\n","import BasicWidget from \"../basic_widget.js\";\n\nconst TPL = `\n<button type=\"button\" class=\"action-button d-sm-none d-md-none d-lg-none d-xl-none\" aria-label=\"Close\" style=\"padding-top: 10px;\">\n    <span aria-hidden=\"true\">&times;</span>\n</button>`;\n\nclass CloseDetailButtonWidget extends BasicWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$widget.on('click', () => this.triggerCommand('setActiveScreen', {screen:'tree'}));\n    }\n}\n\nexport default CloseDetailButtonWidget;\n","import BasicWidget from \"../basic_widget.js\";\nimport appContext from \"../../components/app_context.js\";\nimport contextMenu from \"../../menus/context_menu.js\";\nimport noteCreateService from \"../../services/note_create.js\";\nimport branchService from \"../../services/branches.js\";\nimport treeService from \"../../services/tree.js\";\n\nconst TPL = `<button type=\"button\" class=\"action-button bx bx-menu\" style=\"padding-top: 10px;\"></button>`;\n\nclass MobileDetailMenuWidget extends BasicWidget {\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$widget.on(\"click\", async e => {\n            const note = appContext.tabManager.getActiveContextNote();\n\n            contextMenu.show({\n                x: e.pageX,\n                y: e.pageY,\n                items: [\n                    { title: \"插入子笔记\", command: \"insertChildNote\", uiIcon: \"bx bx-plus\",\n                        enabled: note.type !== 'search' },\n                    { title: \"删除此笔记\", command: \"delete\", uiIcon: \"bx bx-trash\",\n                        enabled: note.noteId !== 'root' }\n                ],\n                selectMenuItemHandler: async ({command}) => {\n                    if (command === \"insertChildNote\") {\n                        noteCreateService.createNote(appContext.tabManager.getActiveContextNotePath());\n                    }\n                    else if (command === \"delete\") {\n                        const notePath = appContext.tabManager.getActiveContextNotePath();\n                        const branchId = await treeService.getBranchIdFromUrl(notePath);\n\n                        if (!branchId) {\n                            throw new Error(`Cannot get branchId for notePath '${notePath}'`);\n                        }\n\n                        if (await branchService.deleteNotes([branchId])) {\n                            this.triggerCommand('setActiveScreen', {screen:'tree'})\n                        }\n                    }\n                    else {\n                        throw new Error(`Unrecognized command ${command}`);\n                    }\n                }\n            });\n        });\n    }\n}\n\nexport default MobileDetailMenuWidget;\n","import FlexContainer from \"../containers/flex_container.js\";\n\nexport default class ScreenContainer extends FlexContainer {\n    constructor(screenName, direction) {\n        super(direction);\n\n        this.screenName = screenName;\n    }\n\n    activeScreenChangedEvent({activeScreen}) {\n        if (activeScreen === this.screenName) {\n            this.$widget.removeClass('d-none');\n        }\n        else {\n            this.$widget.addClass('d-none');\n        }\n    }\n}\n","import Container from \"./container.js\";\n\nexport default class ScrollingContainer extends Container {\n    constructor() {\n        super();\n\n        this.class(\"scrolling-container\");\n        this.css('overflow', 'auto');\n        this.css('scroll-behavior', 'smooth');\n        this.css('position', 'relative');\n    }\n\n    setNoteContextEvent({noteContext}) {\n        /** @var {NoteContext} */\n        this.noteContext = noteContext;\n    }\n\n    async noteSwitchedEvent({noteContext, notePath}) {\n        this.$widget.scrollTop(0);\n    }\n\n    async noteSwitchedAndActivatedEvent({noteContext, notePath}) {\n        this.noteContext = noteContext;\n\n        this.$widget.scrollTop(0);\n    }\n\n    async activeContextChangedEvent({noteContext}) {\n        this.noteContext = noteContext;\n    }\n\n    handleEventInChildren(name, data) {\n        if (name === 'readOnlyTemporarilyDisabled'\n                && this.noteContext\n                && this.noteContext.ntxId === data.noteContext.ntxId) {\n\n            const scrollTop = this.$widget.scrollTop();\n\n            const promise = super.handleEventInChildren(name, data);\n\n            // there seems to be some asynchronicity, and we need to wait a bit before scrolling\n            promise.then(() => setTimeout(() => this.$widget.scrollTop(scrollTop), 500));\n\n            return promise;\n        }\n        else {\n            return super.handleEventInChildren(name, data);\n        }\n    }\n\n    scrollContainerToCommand({position}) {\n        this.$widget.scrollTop(position);\n    }\n}\n","import protectedSessionService from \"../../services/protected_session.js\";\nimport utils from \"../../services/utils.js\";\nimport BasicWidget from \"../basic_widget.js\";\n\nconst TPL = `\n<div class=\"protected-session-password-dialog modal mx-auto\" data-backdrop=\"false\" tabindex=\"-1\" role=\"dialog\">\n    <div class=\"modal-dialog modal-md\" role=\"document\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <h5 class=\"modal-title mr-auto\">保护会话</h5>\n\n                <button class=\"help-button\" type=\"button\" data-help-page=\"Protected-notes\" title=\"保护会话帮助文档\">?</button>\n\n                <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\" style=\"margin-left: 0;\">\n                    <span aria-hidden=\"true\">&times;</span>\n                </button>\n            </div>\n            <form class=\"protected-session-password-form\">\n                <div class=\"modal-body\">\n                    <div class=\"form-group\">\n                        <label style=\"width: -webkit-fill-available\">\n                            输入密码进入保护会话以继续\n                            <input class=\"form-control protected-session-password\" type=\"password\">\n                        </label>\n                    </div>\n                </div>\n                <div class=\"modal-footer\">\n                    <button class=\"btn btn-primary\">开始受保护的会话<kbd>回车</kbd></button>\n                </div>\n            </form>\n        </div>\n    </div>\n</div>`;\n\nexport default class ProtectedSessionPasswordDialog extends BasicWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$passwordForm = this.$widget.find(\".protected-session-password-form\");\n        this.$passwordInput = this.$widget.find(\".protected-session-password\");\n        this.$passwordForm.on('submit', () => {\n            const password = this.$passwordInput.val();\n            this.$passwordInput.val(\"\");\n\n            protectedSessionService.setupProtectedSession(password);\n\n            return false;\n        });\n    }\n\n    showProtectedSessionPasswordDialogEvent() {\n        utils.openDialog(this.$widget);\n\n        this.$passwordInput.trigger('focus');\n    }\n\n    closeProtectedSessionPasswordDialogEvent() {\n        this.$widget.modal('hide');\n    }\n}\n","import BasicWidget from \"../basic_widget.js\";\n\nconst DELETE_NOTE_BUTTON_CLASS = \"confirm-dialog-delete-note\";\n\nconst TPL = `\n<div class=\"confirm-dialog modal mx-auto\" tabindex=\"-1\" role=\"dialog\" style=\"z-index: 2000;\">\n    <div class=\"modal-dialog modal-dialog-scrollable\" role=\"document\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <h5 class=\"modal-title mr-auto\">确认</h5>\n\n                <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n                    <span aria-hidden=\"true\">&times;</span>\n                </button>\n            </div>\n            <div class=\"modal-body\">\n                <div class=\"confirm-dialog-content\"></div>\n\n                <div class=\"confirm-dialog-custom\"></div>\n            </div>\n            <div class=\"modal-footer\">\n                <button class=\"confirm-dialog-cancel-button btn btn-sm\">取消</button>\n\n                &nbsp;\n\n                <button class=\"confirm-dialog-ok-button btn btn-primary btn-sm\">好的</button>\n            </div>\n        </div>\n    </div>\n</div>`;\n\nexport default class ConfirmDialog extends BasicWidget {\n    constructor() {\n        super();\n\n        this.resolve = null;\n        this.$originallyFocused = null; // element focused before the dialog was opened, so we can return to it afterward\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$confirmContent = this.$widget.find(\".confirm-dialog-content\");\n        this.$okButton = this.$widget.find(\".confirm-dialog-ok-button\");\n        this.$cancelButton = this.$widget.find(\".confirm-dialog-cancel-button\");\n        this.$custom = this.$widget.find(\".confirm-dialog-custom\");\n\n        this.$widget.on('shown.bs.modal', () => this.$okButton.trigger(\"focus\"));\n\n        this.$widget.on(\"hidden.bs.modal\", () => {\n            if (this.resolve) {\n                this.resolve(false);\n            }\n\n            if (this.$originallyFocused) {\n                this.$originallyFocused.trigger('focus');\n                this.$originallyFocused = null;\n            }\n        });\n\n        this.$cancelButton.on('click', () => this.doResolve(false));\n        this.$okButton.on('click', () => this.doResolve(true));\n    }\n\n    showConfirmDialogEvent({message, callback}) {\n        this.$originallyFocused = $(':focus');\n\n        this.$custom.hide();\n\n        glob.activeDialog = this.$widget;\n\n        if (typeof message === 'string') {\n            message = $(\"<div>\").text(message);\n        }\n\n        this.$confirmContent.empty().append(message);\n\n        this.$widget.modal();\n\n        this.resolve = callback;\n    }\n\n    showConfirmDeleteNoteBoxWithNoteDialogEvent({title, callback}) {\n        glob.activeDialog = this.$widget;\n\n        this.$confirmContent.text(`Are you sure you want to remove the note \"${title}\" from relation map?`);\n\n        this.$custom.empty()\n            .append(\"<br/>\")\n            .append($(\"<div>\")\n                .addClass(\"form-check\")\n                .append(\n                    $(\"<label>\")\n                        .addClass(\"form-check-label\")\n                        .attr(\"style\", \"text-decoration: underline dotted var(--main-text-color)\")\n                        .attr(\"title\", \"如果不勾选这个, 笔记只会从关系地图里移除.\")\n                        .append(\n                            $(\"<input>\")\n                                .attr(\"type\", \"checkbox\")\n                                .addClass(`form-check-input ${DELETE_NOTE_BUTTON_CLASS}`)\n                        )\n                        .append(\"Also delete the note\")\n                ));\n\n        this.$custom.show();\n\n        this.$widget.modal();\n\n        this.resolve = callback;\n    }\n\n    doResolve(ret) {\n        this.resolve({\n            confirmed: ret,\n            isDeleteNoteChecked: this.$widget.find(`.${DELETE_NOTE_BUTTON_CLASS}:checked`).length > 0\n        });\n\n        this.resolve = null;\n\n        this.$widget.modal(\"hide\");\n    }\n}\n","import server from \"../../services/server.js\";\nimport NoteContextAwareWidget from \"../note_context_aware_widget.js\";\nimport toastService from \"../../services/toast.js\";\nimport openService from \"../../services/open.js\";\nimport utils from \"../../services/utils.js\";\nimport protectedSessionHolder from \"../../services/protected_session_holder.js\";\n\nconst TPL = `\n<div class=\"file-properties-widget\">\n    <style> \n        .file-table {\n            width: 100%;\n            margin-top: 10px;\n        }\n        \n        .file-table th, .file-table td {\n            padding: 5px;\n            overflow-wrap: anywhere;\n        }\n        \n        .file-buttons {\n            padding: 10px; \n            display: flex; \n            justify-content: space-evenly;\n        }\n    </style>\n\n    <table class=\"file-table\">\n        <tr>\n            <th>笔记ID:</th>\n            <td class=\"file-note-id\"></td>\n            <th>原始文件名:</th>\n            <td class=\"file-filename\"></td>\n        </tr>\n        <tr>\n            <th>文件类型:</th>\n            <td class=\"file-filetype\"></td>\n            <th>文件大小:</th>\n            <td class=\"file-filesize\"></td>\n        </tr>\n        \n        <tr>\n            <td colspan=\"4\">\n                <div class=\"file-buttons\">\n                    <button class=\"file-download btn btn-sm btn-primary\" type=\"button\">下载</button>\n                    &nbsp;\n                    <button class=\"file-open btn btn-sm btn-primary\" type=\"button\">打开</button>\n                    &nbsp;\n                    <button class=\"file-upload-new-revision btn btn-sm btn-primary\">上传新的修改</button>\n                \n                    <input type=\"file\" class=\"file-upload-new-revision-input\" style=\"display: none\">\n                </div>\n            </td>\n        </tr>\n    </table>\n</div>`;\n\nexport default class FilePropertiesWidget extends NoteContextAwareWidget {\n    get name() {\n        return \"fileProperties\";\n    }\n\n    get toggleCommand() {\n        return \"toggleRibbonTabFileProperties\";\n    }\n\n    isEnabled() {\n        return this.note && this.note.type === 'file';\n    }\n\n    getTitle() {\n        return {\n            show: this.isEnabled(),\n            activate: true,\n            title: '文件',\n            icon: 'bx bx-file'\n        };\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.contentSized();\n        this.$fileNoteId = this.$widget.find(\".file-note-id\");\n        this.$fileName = this.$widget.find(\".file-filename\");\n        this.$fileType = this.$widget.find(\".file-filetype\");\n        this.$fileSize = this.$widget.find(\".file-filesize\");\n        this.$downloadButton = this.$widget.find(\".file-download\");\n        this.$openButton = this.$widget.find(\".file-open\");\n        this.$uploadNewRevisionButton = this.$widget.find(\".file-upload-new-revision\");\n        this.$uploadNewRevisionInput = this.$widget.find(\".file-upload-new-revision-input\");\n\n        this.$downloadButton.on('click', () => openService.downloadFileNote(this.noteId));\n        this.$openButton.on('click', () => openService.openNoteExternally(this.noteId, this.note.mime));\n\n        this.$uploadNewRevisionButton.on(\"click\", () => {\n            this.$uploadNewRevisionInput.trigger(\"click\");\n        });\n\n        this.$uploadNewRevisionInput.on('change', async () => {\n            const fileToUpload = this.$uploadNewRevisionInput[0].files[0]; // copy to allow reset below\n            this.$uploadNewRevisionInput.val('');\n\n            const result = await server.upload(`notes/${this.noteId}/file`, fileToUpload);\n\n            if (result.uploaded) {\n                toastService.showMessage(\"新文件修改已上传.\");\n\n                this.refresh();\n            }\n            else {\n                toastService.showError(\"上传新笔记修改是该:\");\n            }\n        });\n    }\n\n    async refreshWithNote(note) {\n        this.$widget.show();\n\n        this.$fileNoteId.text(note.noteId);\n        this.$fileName.text(note.getLabelValue('originalFileName') || \"?\");\n        this.$fileType.text(note.mime);\n\n        const blob = await this.note.getBlob();\n\n        this.$fileSize.text(utils.formatSize(blob.contentLength));\n\n        // open doesn't work for protected notes since it works through a browser which isn't in protected session\n        this.$openButton.toggle(!note.isProtected);\n        this.$downloadButton.toggle(!note.isProtected || protectedSessionHolder.isProtectedSessionAvailable())\n        this.$uploadNewRevisionButton.toggle(!note.isProtected || protectedSessionHolder.isProtectedSessionAvailable())\n    }\n}\n","import NoteContextAwareWidget from \"../note_context_aware_widget.js\";\n\nconst TPL = `\n<div class=\"floating-buttons no-print\">\n    <style>\n        .floating-buttons {\n            position: relative;\n        }\n        \n        .floating-buttons-children {\n            position: absolute; \n            top: 10px; \n            right: 10px;\n            display: flex;\n            flex-direction: row;\n            z-index: 100;\n        }\n        \n        .type-canvas .floating-buttons-children {\n            top: 70px; \n        }\n        \n        .floating-buttons-children > *:not(.hidden-int):not(.no-content-hidden) {\n            margin-left: 10px;\n        }\n        \n        .floating-buttons-children > button, .floating-buttons-children .floating-button {\n            font-size: 150%;\n            padding: 5px 10px 4px 10px;\n            width: 40px;\n            cursor: pointer;\n            color: var(--button-text-color);\n            background: var(--button-background-color);\n            border-radius: var(--button-border-radius);\n            border: 1px solid transparent;\n            display: flex;\n            justify-content: space-around;\n        }\n        \n        .floating-buttons-children > button:hover, .floating-buttons-children .floating-button:hover {\n            text-decoration: none;\n            border-color: var(--button-border-color);\n        }\n        \n        .floating-buttons.temporarily-hidden {\n            display: none;\n        }\n    </style>\n    \n    <div class=\"floating-buttons-children\"></div>\n</div>`;\n\nexport default class FloatingButtons extends NoteContextAwareWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$children = this.$widget.find(\".floating-buttons-children\");\n\n        for (const widget of this.children) {\n            this.$children.append(widget.render());\n        }\n    }\n\n    async refreshWithNote(note) {\n        this.toggle(true);\n    }\n\n    toggle(show) {\n        this.$widget.toggleClass(\"temporarily-hidden\", !show);\n    }\n\n    hideFloatingButtonsCommand() {\n        this.toggle(false);\n    }\n}\n","import NoteContextAwareWidget from \"../note_context_aware_widget.js\";\n\nconst TPL = `<button class=\"button-widget bx\"\n      data-toggle=\"tooltip\"\n      title=\"\"></button>`;\n\nexport default class AbstractButtonWidget extends NoteContextAwareWidget {\n    isEnabled() {\n        return true;\n    }\n\n    constructor() {\n        super();\n\n        this.settings = {\n            titlePlacement: 'right',\n            title: null,\n            icon: null,\n            onContextMenu: null\n        };\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n\n        if (this.settings.onContextMenu) {\n            this.$widget.on(\"contextmenu\", e => {\n                this.$widget.tooltip(\"hide\");\n\n                this.settings.onContextMenu(e);\n\n                return false; // blocks default browser right click menu\n            });\n        }\n\n        this.$widget.attr(\"data-placement\", this.settings.titlePlacement);\n\n        this.$widget.tooltip({\n            html: true,\n            title: () => this.getTitle(),\n            trigger: \"hover\"\n        });\n\n        super.doRender();\n    }\n\n    getTitle() {\n        return typeof this.settings.title === \"function\"\n            ? this.settings.title()\n            : this.settings.title;\n    }\n\n    refreshIcon() {\n        for (const className of this.$widget[0].classList) {\n            if (className.startsWith(\"bx-\")) {\n                this.$widget.removeClass(className);\n            }\n        }\n\n        const icon = typeof this.settings.icon === \"function\"\n            ? this.settings.icon()\n            : this.settings.icon;\n\n        this.$widget.addClass(icon);\n    }\n\n    initialRenderCompleteEvent() {\n        this.refreshIcon();\n    }\n\n    /** @param {string|function} icon */\n    icon(icon) {\n        this.settings.icon = icon;\n        return this;\n    }\n\n    /** @param {string|function} title */\n    title(title) {\n        this.settings.title = title;\n        return this;\n    }\n\n    /** @param {string} placement - \"top\", \"bottom\", \"left\", \"right\" */\n    titlePlacement(placement) {\n        this.settings.titlePlacement = placement;\n        return this;\n    }\n\n    onContextMenu(handler) {\n        this.settings.onContextMenu = handler;\n        return this;\n    }\n}\n","import AbstractButtonWidget from \"./abstract_button.js\";\n\nexport default class OnClickButtonWidget extends AbstractButtonWidget {\n    doRender() {\n        super.doRender();\n\n        if (this.settings.onClick) {\n            this.$widget.on(\"click\", e => {\n                e.stopPropagation();\n                this.$widget.tooltip(\"hide\");\n\n                this.settings.onClick(this, e);\n            });\n        } else {\n            console.warn(`Button widget '${this.componentId}' has no defined click handler`, this.settings);\n        }\n\n        if (this.settings.onAuxClick) {\n            this.$widget.on(\"auxclick\", e => {\n                this.$widget.tooltip(\"hide\");\n\n                this.settings.onAuxClick(this, e);\n            });\n        }\n    }\n\n    onClick(handler) {\n        this.settings.onClick = handler;\n        return this;\n    }\n\n    onAuxClick(handler) {\n        this.settings.onAuxClick = handler;\n        return this;\n    }\n}\n","import OnClickButtonWidget from \"./onclick_button.js\";\nimport appContext from \"../../components/app_context.js\";\nimport attributeService from \"../../services/attributes.js\";\nimport protectedSessionHolder from \"../../services/protected_session_holder.js\";\n\nexport default class EditButton extends OnClickButtonWidget {\n    isEnabled() {\n        return super.isEnabled()\n            && this.note\n            && this.noteContext.viewScope.viewMode === 'default';\n    }\n\n    constructor() {\n        super();\n\n        this.icon(\"bx-edit-alt\")\n            .title(\"编辑笔记\")\n            .titlePlacement(\"bottom\")\n            .onClick(widget => {\n                this.noteContext.viewScope.readOnlyTemporarilyDisabled = true;\n\n                appContext.triggerEvent('readOnlyTemporarilyDisabled', {noteContext: this.noteContext});\n\n                this.refresh();\n            });\n    }\n\n    async refreshWithNote(note) {\n        if (note.isProtected && !protectedSessionHolder.isProtectedSessionAvailable()) {\n            this.toggleInt(false);\n        }\n        else {\n            // prevent flickering by assuming hidden before async operation\n            this.toggleInt(false);\n\n            const wasVisible = this.isVisible();\n\n            // can't do this in isEnabled() since isReadOnly is async\n            this.toggleInt(await this.noteContext.isReadOnly());\n\n            // make the edit button stand out on the first display, otherwise\n            // it's difficult to notice that the note is readonly\n            if (this.isVisible() && !wasVisible) {\n                this.$widget.addClass(\"bx-tada bx-lg\");\n\n                setTimeout(() => {\n                    this.$widget.removeClass(\"bx-tada bx-lg\");\n                }, 1700);\n            }\n        }\n\n        await super.refreshWithNote(note);\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.getAttributeRows().find(\n            attr => attr.type === 'label'\n                && attr.name.toLowerCase().includes(\"readonly\")\n                && attributeService.isAffecting(attr, this.note)\n        )) {\n            this.noteContext.viewScope.readOnlyTemporarilyDisabled = false;\n\n            this.refresh();\n        }\n    }\n\n    async noteTypeMimeChangedEvent({noteId}) {\n        if (this.isNote(noteId)) {\n            await this.refresh();\n        }\n    }\n}\n","import NoteContextAwareWidget from \"../note_context_aware_widget.js\";\n\nconst TPL = `\n<div class=\"relation-map-buttons\">\n    <style>\n        .relation-map-buttons {\n            display: flex;\n            gap: 10px;\n        }\n    </style>\n\n    <button type=\"button\"\n            class=\"relation-map-create-child-note floating-button btn bx bx-folder-plus\"\n            title=\"创建新的子笔记并将其添加到此关系图中\"></button>\n    \n    <button type=\"button\"\n            class=\"relation-map-reset-pan-zoom floating-button btn bx bx-crop\"\n            title=\"重置放大系数和座标\"></button>\n    \n    <div class=\"btn-group\">\n        <button type=\"button\"\n                class=\"relation-map-zoom-in floating-button btn bx bx-zoom-in\"\n                title=\"放大\"></button>\n    \n        <button type=\"button\"\n                class=\"relation-map-zoom-out floating-button btn bx bx-zoom-out\"\n                title=\"缩小\"></button>\n    </div>\n</div>`;\n\nexport default class RelationMapButtons extends NoteContextAwareWidget {\n    isEnabled() {\n        return super.isEnabled() && this.note?.type === 'relationMap';\n    }\n\n    doRender() {\n        super.doRender();\n\n        this.$widget = $(TPL);\n        this.$createChildNote = this.$widget.find(\".relation-map-create-child-note\");\n        this.$zoomInButton = this.$widget.find(\".relation-map-zoom-in\");\n        this.$zoomOutButton = this.$widget.find(\".relation-map-zoom-out\");\n        this.$resetPanZoomButton = this.$widget.find(\".relation-map-reset-pan-zoom\");\n\n        this.$createChildNote.on('click', () => this.triggerEvent('relationMapCreateChildNote', {ntxId: this.ntxId}));\n        this.$resetPanZoomButton.on('click', () => this.triggerEvent('relationMapResetPanZoom', {ntxId: this.ntxId}));\n\n        this.$zoomInButton.on('click', () => this.triggerEvent('relationMapResetZoomIn', {ntxId: this.ntxId}));\n        this.$zoomOutButton.on('click', () => this.triggerEvent('relationMapResetZoomOut', {ntxId: this.ntxId}));\n        this.contentSized();\n    }\n}\n","import NoteContextAwareWidget from \"../note_context_aware_widget.js\";\n\nconst TPL = `\n<button type=\"button\"\n        class=\"export-mermaid-button\"\n        title=\"将美人鱼图导出为SVG\">\n        <span class=\"bx bx-export\"></span>\n</button>\n`;\n\nexport default class MermaidExportButton extends NoteContextAwareWidget {\n    isEnabled() {\n        return super.isEnabled()\n            && this.note?.type === 'mermaid'\n            && this.note.isContentAvailable()\n            && this.noteContext?.viewScope.viewMode === 'default';\n    }\n\n    doRender() {\n        super.doRender();\n\n        this.$widget = $(TPL);\n        this.$widget.on('click', () => this.triggerEvent('exportMermaid', {ntxId: this.ntxId}));\n        this.contentSized();\n    }\n}\n","/**\n * !!! Filename is intentionally mangled, because some adblockers don't like the word \"backlinks\".\n */\n\nimport NoteContextAwareWidget from \"../note_context_aware_widget.js\";\nimport linkService from \"../../services/link.js\";\nimport server from \"../../services/server.js\";\nimport froca from \"../../services/froca.js\";\n\nconst TPL = `\n<div class=\"backlinks-widget\">\n    <style>\n        .backlinks-widget {\n            position: relative;\n        }\n    \n        .backlinks-ticker {\n            border-radius: 10px;\n            border-color: var(--main-border-color);\n            background-color: var(--more-accented-background-color);\n            padding: 4px 10px 4px 10px;\n            opacity: 90%;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n        \n        .backlinks-count {\n            cursor: pointer;\n        }\n                        \n        .backlinks-items {\n            z-index: 10;\n            position: absolute;\n            top: 50px;\n            right: 10px;\n            width: 400px;\n            border-radius: 10px;\n            background-color: var(--accented-background-color);\n            color: var(--main-text-color);\n            padding: 20px;\n            overflow-y: auto;\n        }\n        \n        .backlink-excerpt {\n            border-left: 2px solid var(--main-border-color);\n            padding-left: 10px;\n            opacity: 80%;\n            font-size: 90%;\n        }\n        \n        .backlink-excerpt .backlink-link { /* the actual backlink */\n            font-weight: bold;\n            background-color: yellow;\n        }\n    </style>\n    \n    <div class=\"backlinks-ticker\">\n        <span class=\"backlinks-count\"></span>\n    </div>   \n    \n    <div class=\"backlinks-items\" style=\"display: none;\"></div>\n</div>\n`;\n\nexport default class BacklinksWidget extends NoteContextAwareWidget {\n    doRender() {\n        this.$widget = $(TPL);\n        this.$count = this.$widget.find('.backlinks-count');\n        this.$items = this.$widget.find('.backlinks-items');\n        this.$ticker = this.$widget.find('.backlinks-ticker');\n\n        this.$count.on(\"click\", () => {\n            this.$items.toggle();\n            this.$items.css(\"max-height\", $(window).height() - this.$items.offset().top - 10);\n\n            if (this.$items.is(\":visible\")) {\n                this.renderBacklinks();\n            }\n        });\n\n        this.contentSized();\n    }\n\n    async refreshWithNote(note) {\n        this.clearItems();\n\n        if (this.noteContext?.viewScope?.viewMode !== 'default') {\n            this.toggle(false);\n            return;\n        }\n\n        // can't use froca since that would count only relations from loaded notes\n        const resp = await server.get(`note-map/${this.noteId}/backlink-count`);\n\n        if (!resp || !resp.count) {\n            this.toggle(false);\n            return;\n        }\n\n        this.toggle(true);\n        this.$count.text(\n            `${resp.count} 个反链`\n        );\n    }\n\n    toggle(show) {\n        this.$widget.toggleClass(\"hidden-no-content\", !show);\n    }\n\n    clearItems() {\n        this.$items.empty().hide();\n    }\n\n    async renderBacklinks() {\n        if (!this.note) {\n            return;\n        }\n\n        this.$items.empty();\n\n        const backlinks = await server.get(`note-map/${this.noteId}/backlinks`);\n\n        if (!backlinks.length) {\n            return;\n        }\n\n        await froca.getNotes(backlinks.map(bl => bl.noteId)); // prefetch all\n\n        for (const backlink of backlinks) {\n            const $item = $(\"<div>\");\n\n            $item.append(await linkService.createLink(backlink.noteId, {\n                showNoteIcon: true,\n                showNotePath: true,\n                showTooltip: false\n            }));\n\n            if (backlink.relationName) {\n                $item.append($(\"<p>\").text(`relation: ${backlink.relationName}`));\n            }\n            else {\n                $item.append(...backlink.excerpts);\n            }\n\n            this.$items.append($item);\n        }\n    }\n}\n","import NoteContextAwareWidget from \"../note_context_aware_widget.js\";\n\nconst TPL = `\n<div class=\"close-floating-buttons\">\n    <style>\n        .close-floating-buttons {\n            display: none;\n            margin-left: 5px !important;\n        }\n    \n        /* conditionally display close button if there's some other button visible */\n        .floating-buttons *:not(.hidden-int):not(.hidden-no-content) ~ .close-floating-buttons {\n            display: block;\n        }\n        \n        .close-floating-buttons-button {\n            border: 1px solid transparent;\n            color: var(--button-text-color);\n            padding: 6px;\n            border-radius: 100px;\n        }\n        \n        .close-floating-buttons-button:hover {\n            border: 1px solid var(--button-border-color);\n        }\n    </style>\n\n    <button type=\"button\"\n            class=\"close-floating-buttons-button btn bx bx-x\"\n            title=\"隐藏按钮\"></button>\n</div>\n`;\n\nexport default class HideFloatingButtonsButton extends NoteContextAwareWidget {\n    doRender() {\n        super.doRender();\n\n        this.$widget = $(TPL);\n        this.$widget.on('click', () => this.triggerCommand('hideFloatingButtons'));\n        this.contentSized();\n    }\n}\n","import libraryLoader from \"../services/library_loader.js\";\nimport NoteContextAwareWidget from \"./note_context_aware_widget.js\";\nimport server from \"../services/server.js\";\n\nconst TPL = `<div class=\"mermaid-widget\">\n    <style>\n        .mermaid-widget {\n            flex-grow: 2;\n            overflow: auto;\n            min-height: 200px;\n            border-bottom: 1px solid var(--main-border-color);\n            padding: 20px;\n            margin-bottom: 10px;\n            flex-basis: 0;\n        }\n        \n        .mermaid-render {\n            overflow: auto;\n            height: 100%;\n            text-align: center;\n        }\n        \n        .mermaid-render svg {\n            width: 95%; /* https://github.com/zadam/trilium/issues/4340 */\n        }\n    </style>\n\n    <div class=\"mermaid-error alert alert-warning\">\n        <p><strong>图表无法显示. 请看 <a href=\"https://mermaid-js.github.io/mermaid/#/flowchart?id=graph\">帮助和示例</a>.</strong></p>\n        <p class=\"error-content\"></p>\n    </div>\n\n    <div class=\"mermaid-render\"></div>\n</div>`;\n\nlet idCounter = 1;\n\nexport default class MermaidWidget extends NoteContextAwareWidget {\n    isEnabled() {\n        return super.isEnabled()\n            && this.note?.type === 'mermaid'\n            && this.note.isContentAvailable()\n            && this.noteContext?.viewScope.viewMode === 'default';\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.contentSized();\n        this.$display = this.$widget.find('.mermaid-render');\n        this.$errorContainer = this.$widget.find(\".mermaid-error\");\n        this.$errorMessage = this.$errorContainer.find(\".error-content\");\n    }\n\n    async refreshWithNote(note) {\n        this.$errorContainer.hide();\n\n        await libraryLoader.requireLibrary(libraryLoader.MERMAID);\n\n        const documentStyle = window.getComputedStyle(document.documentElement);\n        const mermaidTheme = documentStyle.getPropertyValue('--mermaid-theme');\n\n        mermaid.mermaidAPI.initialize({\n            startOnLoad: false,\n            theme: mermaidTheme.trim(),\n            securityLevel: 'antiscript',\n            flow: { useMaxWidth: false },\n            sequence: { useMaxWidth: false },\n            gantt: { useMaxWidth: false },\n            \"class\": { useMaxWidth: false },\n            state: { useMaxWidth: false },\n            pie: { useMaxWidth: true },\n            journey: { useMaxWidth: false },\n            git: { useMaxWidth: false },\n        });\n\n        this.$display.empty();\n\n        const wheelZoomLoaded = libraryLoader.requireLibrary(libraryLoader.WHEEL_ZOOM);\n\n        this.$errorContainer.hide();\n\n        try {\n            const svg = await this.renderSvg();\n\n            if (this.dirtyAttachment) {\n                const payload = {\n                    role: 'image',\n                    title: 'mermaid-export.svg',\n                    mime: 'image/svg+xml',\n                    content: svg,\n                    position: 0\n                };\n\n                server.post(`notes/${this.noteId}/attachments?matchBy=title`, payload).then(() => {\n                    this.dirtyAttachment = false;\n                });\n            }\n\n            this.$display.html(svg);\n\n            await wheelZoomLoaded;\n\n            this.$display.attr(\"id\", `mermaid-render-${idCounter}`);\n\n            WZoom.create(`#mermaid-render-${idCounter}`, {\n                type: 'html',\n                maxScale: 50,\n                speed: 1.3,\n                zoomOnClick: false\n            });\n        } catch (e) {\n            this.$errorMessage.text(e.message);\n            this.$errorContainer.show();\n        }\n    }\n\n    async renderSvg() {\n        idCounter++;\n\n        const blob = await this.note.getBlob();\n        const content = blob.content || \"\";\n\n        const {svg} = await mermaid.mermaidAPI.render(`mermaid-graph-${idCounter}`, content);\n        return svg;\n    }\n\n    async entitiesReloadedEvent({loadResults}) {\n        if (loadResults.isNoteContentReloaded(this.noteId)) {\n            this.dirtyAttachment = true;\n\n            await this.refresh();\n        }\n    }\n\n    async exportMermaidEvent({ntxId}) {\n        if (!this.isNoteContext(ntxId)) {\n            return;\n        }\n\n        const svg = await this.renderSvg();\n        this.download(`${this.note.title}.svg`, svg);\n    }\n\n    download(filename, text) {\n        const element = document.createElement('a');\n        element.setAttribute('href', `data:image/svg+xml;charset=utf-8,${encodeURIComponent(text)}`);\n        element.setAttribute('download', filename);\n\n        element.style.display = 'none';\n        document.body.appendChild(element);\n\n        element.click();\n\n        document.body.removeChild(element);\n    }\n}\n","import NoteContextAwareWidget from \"./note_context_aware_widget.js\";\nimport NoteListRenderer from \"../services/note_list_renderer.js\";\n\nconst TPL = `\n<div class=\"note-list-widget\">\n    <style>\n    .note-list-widget {\n        min-height: 0;\n        overflow: auto;\n    }\n    \n    .note-list-widget .note-list {\n        padding: 10px;\n    }\n    </style>\n    \n    <div class=\"note-list-widget-content\">\n    </div>\n</div>`;\n\nexport default class NoteListWidget extends NoteContextAwareWidget {\n    isEnabled() {\n        return super.isEnabled() && this.noteContext.hasNoteList();\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.contentSized();\n        this.$content = this.$widget.find('.note-list-widget-content');\n\n        const observer = new IntersectionObserver(entries => {\n            this.isIntersecting = entries[0].isIntersecting;\n\n            this.checkRenderStatus();\n        }, {\n            rootMargin: '50px',\n            threshold: 0.1\n        });\n\n        // there seems to be a race condition on Firefox which triggers the observer only before the widget is visible\n        // (intersection is false). https://github.com/zadam/trilium/issues/4165\n        setTimeout(() => observer.observe(this.$widget[0]), 10);\n    }\n\n    checkRenderStatus() {\n        // console.log(\"this.isIntersecting\", this.isIntersecting);\n        // console.log(`${this.noteIdRefreshed} === ${this.noteId}`, this.noteIdRefreshed === this.noteId);\n        // console.log(\"this.shownNoteId !== this.noteId\", this.shownNoteId !== this.noteId);\n\n        if (this.isIntersecting\n            && this.noteIdRefreshed === this.noteId\n            && this.shownNoteId !== this.noteId) {\n\n            this.shownNoteId = this.noteId;\n            this.renderNoteList(this.note);\n        }\n    }\n\n    async renderNoteList(note) {\n        const noteListRenderer = new NoteListRenderer(this.$content, note, note.getChildNoteIds());\n        await noteListRenderer.renderList();\n    }\n\n    async refresh() {\n        this.shownNoteId = null;\n\n        await super.refresh();\n    }\n\n    async refreshNoteListEvent({noteId}) {\n        if (this.isNote(noteId)) {\n            await this.renderNoteList(this.note);\n        }\n    }\n\n    /**\n     * We have this event so that we evaluate intersection only after note detail is loaded.\n     * If it's evaluated before note detail, then it's clearly intersected (visible) although after note detail load\n     * it is not intersected (visible) anymore.\n     */\n    noteDetailRefreshedEvent({ntxId}) {\n        if (!this.isNoteContext(ntxId)) {\n            return;\n        }\n\n        this.noteIdRefreshed = this.noteId;\n\n        setTimeout(() => this.checkRenderStatus(), 100);\n    }\n\n    notesReloadedEvent({noteIds}) {\n        if (noteIds.includes(this.noteId)) {\n            this.refresh();\n        }\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.getAttributeRows().find(attr => attr.noteId === this.noteId && ['viewType', 'expanded', 'pageSize'].includes(attr.name))) {\n            this.shownNoteId = null; // force render\n\n            this.checkRenderStatus();\n        }\n    }\n}\n","import linkService from \"./link.js\";\nimport contentRenderer from \"./content_renderer.js\";\nimport froca from \"./froca.js\";\nimport attributeRenderer from \"./attribute_renderer.js\";\nimport libraryLoader from \"./library_loader.js\";\nimport treeService from \"./tree.js\";\n\nconst TPL = `\n<div class=\"note-list\">\n    <style>\n    .note-list {\n        overflow: hidden;\n        position: relative;\n        height: 100%;\n    }\n\n    .note-list.grid-view .note-list-container {\n        display: flex;\n        flex-wrap: wrap;\n    }\n\n    .note-list.grid-view .note-book-card {\n        flex-basis: 300px;\n        border: 1px solid transparent;\n    }\n\n    .note-list.grid-view .note-expander {\n        display: none;\n    }\n\n    .note-list.grid-view .note-book-card {\n        max-height: 300px;\n    }\n    \n    .note-list.grid-view .note-book-card img {\n        max-height: 220px;\n        object-fit: contain;\n    }\n\n    .note-list.grid-view .note-book-card:hover {\n        cursor: pointer;\n        border: 1px solid var(--main-border-color);\n        background: var(--more-accented-background-color);\n    }\n\n    .note-book-card {\n        border-radius: 10px;\n        background-color: var(--accented-background-color);\n        padding: 10px 15px 15px 8px;\n        margin: 5px 5px 5px 5px;\n        overflow: hidden;\n        display: flex;\n        flex-direction: column;\n        flex-shrink: 0;\n        flex-grow: 1;\n    }\n\n    .note-book-card:not(.expanded) .note-book-content {\n        display: none !important;\n        padding: 10px\n    }\n\n    .note-book-card.expanded .note-book-content {\n        display: block;\n        min-height: 0;\n        height: 100%;\n        padding-top: 10px;\n    }\n\n    .note-book-content .rendered-content {\n        height: 100%;\n    }\n\n    .note-book-header {\n        border-bottom: 1px solid var(--main-border-color);\n        margin-bottom: 0;\n        padding-bottom: .5rem;\n        word-break: break-all;\n    }\n\n    /* not-expanded title is limited to one line only */\n    .note-book-card:not(.expanded) .note-book-header {\n        overflow: hidden;\n        white-space: nowrap;\n        text-overflow: ellipsis;\n    }\n\n    .note-book-header .rendered-note-attributes {\n        font-size: medium;\n    }\n\n    .note-book-header .rendered-note-attributes:before {\n        content: \"\\\\00a0\\\\00a0\";\n    }\n\n    .note-book-header .note-icon {\n        font-size: 100%;\n        display: inline-block;\n        padding-right: 7px;\n        position: relative;\n    }\n\n    .note-book-card .note-book-card {\n        border: 1px solid var(--main-border-color);\n    }\n\n    .note-book-content.type-image, .note-book-content.type-file, .note-book-content.type-protectedSession {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        text-align: center;\n        padding: 10px;\n    }\n\n    .note-book-content.type-image img, .note-book-content.type-canvas svg {\n        max-width: 100%;\n        max-height: 100%;\n        object-fit: contain;\n    }\n\n    .note-book-card.type-image .note-book-content img,\n    .note-book-card.type-text .note-book-content img,\n    .note-book-card.type-canvas .note-book-content img {\n        max-width: 100%;\n        max-height: 100%;\n    }\n\n    .note-book-header {\n        flex-grow: 0;\n    }\n\n    .note-list-wrapper {\n        height: 100%;\n        overflow: auto;\n    }\n\n    .note-expander {\n        font-size: x-large;\n        position: relative;\n        top: 3px;\n        cursor: pointer;\n    }\n\n    .note-list-pager {\n        text-align: center;\n    }\n    </style>\n\n    <div class=\"note-list-wrapper\">\n        <div class=\"note-list-pager\"></div>\n\n        <div class=\"note-list-container\"></div>\n\n        <div class=\"note-list-pager\"></div>\n    </div>\n</div>`;\n\nclass NoteListRenderer {\n    /*\n     * We're using noteIds so that it's not necessary to load all notes at once when paging\n     */\n    constructor($parent, parentNote, noteIds, showNotePath = false) {\n        this.$noteList = $(TPL);\n\n        // note list must be added to the DOM immediately, otherwise some functionality scripting (canvas) won't work\n        $parent.empty();\n\n        this.parentNote = parentNote;\n        const includedNoteIds = this.getIncludedNoteIds();\n\n        this.noteIds = noteIds.filter(noteId => !includedNoteIds.has(noteId) && noteId !== '_hidden');\n\n        if (this.noteIds.length === 0) {\n            return;\n        }\n\n        $parent.append(this.$noteList);\n\n        this.page = 1;\n        this.pageSize = parseInt(parentNote.getLabelValue('pageSize'));\n\n        if (!this.pageSize || this.pageSize < 1) {\n            this.pageSize = 20;\n        }\n\n        this.viewType = parentNote.getLabelValue('viewType');\n\n        if (!['list', 'grid'].includes(this.viewType)) {\n            // when not explicitly set, decide based on the note type\n            this.viewType = parentNote.type === 'search' ? 'list' : 'grid';\n        }\n\n        this.$noteList.addClass(`${this.viewType}-view`);\n\n        this.showNotePath = showNotePath;\n    }\n\n    /** @returns {Set<string>} list of noteIds included (images, included notes) in the parent note and which\n     *                        don't have to be shown in the note list. */\n    getIncludedNoteIds() {\n        const includedLinks = this.parentNote\n            ? this.parentNote.getRelations().filter(rel => rel.name === 'imageLink' || rel.name === 'includeNoteLink')\n            : [];\n\n        return new Set(includedLinks.map(rel => rel.value));\n    }\n\n    async renderList() {\n        if (this.noteIds.length === 0) {\n            this.$noteList.hide();\n            return;\n        }\n\n        const highlightedTokens = this.parentNote.highlightedTokens || [];\n        if (highlightedTokens.length > 0) {\n            await libraryLoader.requireLibrary(libraryLoader.MARKJS);\n\n            this.highlightRegex = new RegExp(highlightedTokens.join(\"|\"), 'gi');\n        } else {\n            this.highlightRegex = null;\n        }\n\n        this.$noteList.show();\n\n        const $container = this.$noteList.find('.note-list-container').empty();\n\n        const startIdx = (this.page - 1) * this.pageSize;\n        const endIdx = startIdx + this.pageSize;\n\n        const pageNoteIds = this.noteIds.slice(startIdx, Math.min(endIdx, this.noteIds.length));\n        const pageNotes = await froca.getNotes(pageNoteIds);\n\n        for (const note of pageNotes) {\n            const $card = await this.renderNote(note, this.parentNote.isLabelTruthy('expanded'));\n\n            $container.append($card);\n        }\n\n        this.renderPager();\n\n        return this.$noteList;\n    }\n\n    renderPager() {\n        const $pager = this.$noteList.find('.note-list-pager').empty();\n        const pageCount = Math.ceil(this.noteIds.length / this.pageSize);\n\n        $pager.toggle(pageCount > 1);\n\n        let lastPrinted;\n\n        for (let i = 1; i <= pageCount; i++) {\n            if (pageCount < 20 || i <= 5 || pageCount - i <= 5 || Math.abs(this.page - i) <= 2) {\n                lastPrinted = true;\n\n                const startIndex = (i - 1) * this.pageSize + 1;\n                const endIndex = Math.min(this.noteIds.length, i * this.pageSize);\n\n                $pager.append(\n                    i === this.page\n                        ? $('<span>').text(i).css('text-decoration', 'underline').css('font-weight', \"bold\")\n                        : $('<a href=\"javascript:\">')\n                            .text(i)\n                            .attr(\"title\", `Page of ${startIndex} - ${endIndex}`)\n                            .on('click', () => {\n                                this.page = i;\n                                this.renderList();\n                            }),\n                    \" &nbsp; \"\n                );\n            }\n            else if (lastPrinted) {\n                $pager.append(\"... &nbsp; \");\n\n                lastPrinted = false;\n            }\n        }\n\n        // no need to distinguish \"note\" vs \"notes\" since in case of one result, there's no paging at all\n        $pager.append(`<span class=\"note-list-pager-total-count\">(${this.noteIds.length} notes)</span>`);\n    }\n\n    async renderNote(note, expand = false) {\n        const $expander = $('<span class=\"note-expander bx bx-chevron-right\"></span>');\n\n        const {$renderedAttributes} = await attributeRenderer.renderNormalAttributes(note);\n        const notePath = this.parentNote.type === 'search'\n            ? note.noteId // for search note parent, we want to display a non-search path\n            : `${this.parentNote.noteId}/${note.noteId}`;\n\n        const $card = $('<div class=\"note-book-card\">')\n            .attr('data-note-id', note.noteId)\n            .append(\n                $('<h5 class=\"note-book-header\">')\n                    .append($expander)\n                    .append($('<span class=\"note-icon\">').addClass(note.getIcon()))\n                    .append(this.viewType === 'grid'\n                        ? $('<span class=\"note-book-title\">').text(await treeService.getNoteTitle(note.noteId, this.parentNote.noteId))\n                        : (await linkService.createLink(notePath, {showTooltip: false, showNotePath: this.showNotePath}))\n                            .addClass(\"note-book-title\")\n                    )\n                    .append($renderedAttributes)\n            );\n\n        if (this.viewType === 'grid') {\n            $card\n                .addClass(\"block-link\")\n                .attr(\"data-href\", `#${notePath}`)\n                .on('click', e => linkService.goToLink(e));\n        }\n\n        $expander.on('click', () => this.toggleContent($card, note, !$card.hasClass(\"expanded\")));\n\n        if (this.highlightRegex) {\n            $card.find(\".note-book-title\").markRegExp(this.highlightRegex, {\n                element: \"span\",\n                className: \"ck-find-result\",\n                separateWordSearch: false,\n                caseSensitive: false\n            });\n        }\n\n        await this.toggleContent($card, note, expand);\n\n        return $card;\n    }\n\n    async toggleContent($card, note, expand) {\n        if (this.viewType === 'list' && ((expand && $card.hasClass(\"expanded\")) || (!expand && !$card.hasClass(\"expanded\")))) {\n            return;\n        }\n\n        const $expander = $card.find('> .note-book-header .note-expander');\n\n        if (expand || this.viewType === 'grid') {\n            $card.addClass(\"expanded\");\n            $expander.addClass(\"bx-chevron-down\").removeClass(\"bx-chevron-right\");\n        }\n        else {\n            $card.removeClass(\"expanded\");\n            $expander.addClass(\"bx-chevron-right\").removeClass(\"bx-chevron-down\");\n        }\n\n        if ((expand || this.viewType === 'grid') && $card.find('.note-book-content').length === 0) {\n            $card.append(await this.renderNoteContent(note));\n        }\n    }\n\n    async renderNoteContent(note) {\n        const $content = $('<div class=\"note-book-content\">');\n\n        try {\n            const {$renderedContent, type} = await contentRenderer.getRenderedContent(note, {\n                trim: this.viewType === 'grid' // for grid only short content is needed\n            });\n\n            if (this.highlightRegex) {\n                $renderedContent.markRegExp(this.highlightRegex, {\n                    element: \"span\",\n                    className: \"ck-find-result\",\n                    separateWordSearch: false,\n                    caseSensitive: false\n                });\n            }\n\n            $content.append($renderedContent);\n            $content.addClass(`type-${type}`);\n        } catch (e) {\n            console.log(`Caught error while rendering note '${note.noteId}' of type '${note.type}': ${e.message}, stack: ${e.stack}`);\n\n            $content.append(\"rendering error\");\n        }\n\n        if (this.viewType === 'list') {\n            const imageLinks = note.getRelations('imageLink');\n\n            const childNotes = (await note.getChildNotes())\n                .filter(childNote => !imageLinks.find(rel => rel.value === childNote.noteId));\n\n            for (const childNote of childNotes) {\n                $content.append(await this.renderNote(childNote));\n            }\n        }\n\n        return $content;\n    }\n}\n\nexport default NoteListRenderer;\n","import BasicWidget from \"../basic_widget.js\";\n\nconst TPL = `\n<div style=\"display: none;\">\n    <style>\n        .global-menu-button-update-available-button {\n            width: 21px !important;\n            height: 21px !important;\n            padding: 0 !important;\n            \n            border-radius: var(--button-border-radius);\n            transform: scale(0.9);\n            border: none;\n            opacity: 0.8;\n            \n            display: flex;\n            align-items: center;\n            justify-content: center;\n        }\n        \n        .global-menu-button-wrapper:hover .global-menu-button-update-available-button {\n            opacity: 1;\n        }\n    </style>\n    \n    <span class=\"bx bx-sync global-menu-button-update-available-button\" title=\"有可用的更新\"></span>\n</div>\n`;\n\nexport default class UpdateAvailableWidget extends BasicWidget {\n    doRender() {\n        this.$widget = $(TPL);\n    }\n\n    updateVersionStatus(latestVersion) {\n        this.$widget.toggle(latestVersion > glob.triliumVersion);\n    }\n}\n","import BasicWidget from \"../basic_widget.js\";\nimport utils from \"../../services/utils.js\";\nimport UpdateAvailableWidget from \"./update_available.js\";\nimport options from \"../../services/options.js\";\n\nconst TPL = `\n<div class=\"dropdown global-menu dropright\">\n    <style>\n    .global-menu {\n        width: 53px;\n        height: 53px;\n    }\n    \n    .global-menu .dropdown-menu {\n        min-width: 20em;\n    }\n    \n    .global-menu-button {\n        background-image: url(\"${window.glob.assetPath}/images/icon-black.svg\");\n        background-repeat: no-repeat;\n        background-position: 40% 50%;\n        background-size: 45px;\n        width: 100%;\n        height: 100%;\n        position: relative;\n    }\n    \n    .global-menu-button:hover {\n        background-image: url(\"${window.glob.assetPath}/images/icon-color.svg\");\n        border: 0;\n    }\n    \n    .global-menu-button-update-available {\n        position: absolute;\n        right: -30px;\n        bottom: -30px;\n        width: 100%;\n        height: 100%;\n        pointer-events: none;\n    }\n\n    .update-to-latest-version-button {\n        display: none;\n    }\n    \n    .global-menu .zoom-container {\n        display: flex; \n        flex-direction: row; \n        justify-content: space-between;\n        align-items: baseline;\n    }\n    \n    .global-menu .zoom-buttons a {\n        display: inline-block;\n        border: 1px solid var(--button-border-color);\n        border-radius: var(--button-border-radius);\n        color: var(--button-text-color);\n        background-color: var(--button-background-color);\n        padding: 3px;\n        margin-left: 3px;\n    }\n    \n    .global-menu .zoom-buttons a:hover {\n        text-decoration: none;\n    }\n    \n    .global-menu .zoom-state {\n        margin-left: 5px;\n        margin-right: 5px;\n    }\n    \n    .global-menu .dropdown-item .bx {\n        position: relative;\n        top: 3px;\n        font-size: 120%;\n        margin-right: 5px;\n    }\n    \n    body.mobile .show-help-button, body.mobile .show-about-dialog-button {\n        /* hidden because these dialogs are not available for mobile */\n        display: none;\n    }\n    \n    body.mobile .global-menu .dropdown-submenu .dropdown-menu {\n        display: block;\n        font-size: 90%;\n        position: relative;\n        left: 0;\n        top: 5px;\n    }\n    </style>\n\n    <button type=\"button\" data-toggle=\"dropdown\" data-placement=\"right\"\n            aria-haspopup=\"true\" aria-expanded=\"false\" \n            class=\"icon-action global-menu-button\" title=\"菜单\">\n        <div class=\"global-menu-button-update-available\"></div>\n    </button>\n\n    <ul class=\"dropdown-menu dropdown-menu-right\">\n        <li class=\"dropdown-item\" data-trigger-command=\"showOptions\">\n            <span class=\"bx bx-slider\"></span>\n            选项\n        </li>\n\n        <li class=\"dropdown-item\" data-trigger-command=\"openNewWindow\">\n            <span class=\"bx bx-window-open\"></span>\n            新窗口\n            <kbd data-command=\"openNewWindow\"></kbd>\n        </li>\n\n        <li class=\"dropdown-item switch-to-mobile-version-button\" data-trigger-command=\"switchToMobileVersion\">\n            <span class=\"bx bx-mobile\"></span>\n            切换到移动版\n        </li>\n        \n        <li class=\"dropdown-item switch-to-desktop-version-button\" data-trigger-command=\"switchToDesktopVersion\">\n            <span class=\"bx bx-desktop\"></span>\n            切换到桌面版\n        </li>\n        \n        <span class=\"zoom-container dropdown-item\">\n            <div>\n                <span class=\"bx bx-empty\"></span>\n                缩放\n            </div>\n            \n            <div class=\"zoom-buttons\">\n                <a data-trigger-command=\"toggleFullscreen\" title=\"切换全屏\" class=\"bx bx-expand-alt\"></a>\n                \n                &nbsp;\n                \n                <a data-trigger-command=\"zoomOut\" title=\"缩小\" class=\"bx bx-minus\"></a>\n                \n                <span data-trigger-command=\"zoomReset\" title=\"Reset Zoom Level\" class=\"zoom-state\"></span>\n                \n                <a data-trigger-command=\"zoomIn\" title=\"放大\" class=\"bx bx-plus\"></a>\n            </div>\n        </span>\n\n        <li class=\"dropdown-item\" data-trigger-command=\"showLaunchBarSubtree\">\n            <span class=\"bx bx-sidebar\"></span>\n            配置启动栏\n        </li>\n        \n        <li class=\"dropdown-item\" data-trigger-command=\"showShareSubtree\">\n            <span class=\"bx bx-share-alt\"></span>\n            显示分享的笔记子树\n        </li>\n        \n        <li class=\"dropdown-item dropdown-submenu\">\n            <span class=\"dropdown-toggle\">\n                <span class=\"bx bx-empty\"></span>\n                高级\n            </span>\n            \n            <ul class=\"dropdown-menu\">\n                <li class=\"dropdown-item open-dev-tools-button\" data-trigger-command=\"openDevTools\">\n                    <span class=\"bx bx-bug-alt\"></span>\n                    开发者工具\n                    <kbd data-command=\"openDevTools\"></kbd>\n                </li>\n        \n                <li class=\"dropdown-item\" data-trigger-command=\"showSQLConsole\">\n                    <span class=\"bx bx-data\"></span>\n                    打开SQL控制台\n                    <kbd data-command=\"showSQLConsole\"></kbd>\n                </li>\n                \n                <li class=\"dropdown-item\" data-trigger-command=\"showSQLConsoleHistory\">\n                    <span class=\"bx bx-empty\"></span>\n                    打开SQL控制台历史记录\n                </li>\n                \n                <li class=\"dropdown-item\" data-trigger-command=\"showSearchHistory\">\n                    <span class=\"bx bx-empty\"></span>\n                    打开搜索历史\n                </li>\n        \n                <li class=\"dropdown-item\" data-trigger-command=\"showBackendLog\">\n                    <span class=\"bx bx-empty\"></span>\n                    显示后台日志\n                    <kbd data-command=\"showBackendLog\"></kbd>\n                </li>\n                \n                <li class=\"dropdown-item\" data-trigger-command=\"reloadFrontendApp\" \n                    title=\"重新加载可以帮助解决一些显示问题, 而无需重新启动整个应用程序.\">\n                    <span class=\"bx bx-empty\"></span>\n                    重新加载界面\n                    <kbd data-command=\"reloadFrontendApp\"></kbd>\n                </li>\n                \n                <li class=\"dropdown-item\" data-trigger-command=\"showHiddenSubtree\">\n                    <span class=\"bx bx-empty\"></span>\n                    显示隐藏的子树\n                </li>\n            </ul>\n        </li>\n\n        <li class=\"dropdown-item show-help-button\" data-trigger-command=\"showHelp\">\n            <span class=\"bx bx-info-circle\"></span>\n            显示帮助\n            <kbd data-command=\"showHelp\"></kbd>\n        </li>\n\n        <li class=\"dropdown-item show-about-dialog-button\">\n            <span class=\"bx bx-empty\"></span>\n            关于 Trilium Notes\n        </li>\n\n        <li class=\"dropdown-item update-to-latest-version-button\" data-trigger-command=\"downloadLatestVersion\">\n            <span class=\"bx bx-sync\"></span>\n\n            <span class=\"version-text\"></span>\n        </li>\n\n        <li class=\"dropdown-item logout-button\" data-trigger-command=\"logout\">\n            <span class=\"bx bx-log-out\"></span>\n            登出\n        </li>\n    </ul>\n</div>\n`;\n\nexport default class GlobalMenuWidget extends BasicWidget {\n    constructor() {\n        super();\n\n        this.updateAvailableWidget = new UpdateAvailableWidget();\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n\n        this.$dropdown = this.$widget.find(\"[data-toggle='dropdown']\");\n        const $button = this.$widget.find(\".global-menu-button\");\n        $button.tooltip({ trigger: \"hover\" });\n        $button.on(\"click\", () => $button.tooltip(\"hide\"));\n\n        this.$widget.find(\".show-about-dialog-button\").on('click', () => this.triggerCommand(\"openAboutDialog\"));\n\n        const isElectron = utils.isElectron();\n\n        this.$widget.find(\".logout-button\").toggle(!isElectron);\n        this.$widget.find(\".open-dev-tools-button\").toggle(isElectron);\n        this.$widget.find(\".switch-to-mobile-version-button\").toggle(!isElectron && utils.isDesktop());\n        this.$widget.find(\".switch-to-desktop-version-button\").toggle(!isElectron && utils.isMobile());\n\n        this.$widget.on('click', '.dropdown-item', e => {\n            if ($(e.target).parent(\".zoom-buttons\")) {\n                return;\n            }\n\n            this.$dropdown.dropdown('toggle');\n        });\n\n        this.$widget.find(\".global-menu-button-update-available\").append(\n            this.updateAvailableWidget.render()\n        );\n\n        this.$updateToLatestVersionButton = this.$widget.find(\".update-to-latest-version-button\");\n\n        if (!utils.isElectron()) {\n            this.$widget.find(\".zoom-container\").hide();\n        }\n\n        this.$zoomState = this.$widget.find(\".zoom-state\");\n        this.$widget.on('show.bs.dropdown', () => this.updateZoomState());\n\n        this.$widget.find(\".zoom-buttons\").on(\"click\",\n            // delay to wait for the actual zoom change\n            () => setTimeout(() => this.updateZoomState(), 300)\n        );\n\n        this.updateVersionStatus();\n\n        setInterval(() => this.updateVersionStatus(), 8 * 60 * 60 * 1000);\n    }\n\n    updateZoomState() {\n        if (!utils.isElectron()) {\n            return;\n        }\n\n        const zoomFactor = utils.dynamicRequire('electron').webFrame.getZoomFactor();\n        const zoomPercent = Math.round(zoomFactor * 100);\n\n        this.$zoomState.text(`${zoomPercent}%`);\n    }\n\n    async updateVersionStatus() {\n        await options.initializedPromise;\n\n        if (options.get(\"checkForUpdates\") !== 'true') {\n            return;\n        }\n\n        const latestVersion = await this.fetchLatestVersion();\n        this.updateAvailableWidget.updateVersionStatus(latestVersion);\n        this.$updateToLatestVersionButton.toggle(latestVersion > glob.triliumVersion);\n        this.$updateToLatestVersionButton.find(\".version-text\").text(`Version ${latestVersion} is available, click to download.`);\n    }\n\n    async fetchLatestVersion() {\n        const RELEASES_API_URL = \"https://api.github.com/repos/zadam/trilium/releases/latest\";\n\n        const resp = await fetch(RELEASES_API_URL);\n        const data = await resp.json();\n\n        return data?.tag_name?.substring(1);\n    }\n\n    downloadLatestVersionCommand() {\n        window.open(\"https://github.com/zadam/trilium/releases/latest\");\n    }\n\n    activeContextChangedEvent() {\n        this.$dropdown.dropdown('hide');\n    }\n\n    noteSwitchedEvent() {\n        this.$dropdown.dropdown('hide');\n    }\n}\n","import BasicWidget from \"../basic_widget.js\";\n\nconst TPL = `\n<div class=\"dropdown right-dropdown-widget dropright\">\n    <style>\n    .right-dropdown-widget {\n        height: 53px;\n    }\n    </style>\n\n    <button type=\"button\" data-toggle=\"dropdown\" data-placement=\"right\"\n            aria-haspopup=\"true\" aria-expanded=\"false\" \n            class=\"bx right-dropdown-button launcher-button\"></button>\n    \n    <div class=\"dropdown-menu dropdown-menu-right\"></div>\n</div>\n`;\n\nexport default class RightDropdownButtonWidget extends BasicWidget {\n    constructor(title, iconClass, dropdownTpl) {\n        super();\n\n        this.iconClass = iconClass;\n        this.title = title;\n        this.dropdownTpl = dropdownTpl;\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$dropdownMenu = this.$widget.find(\".dropdown-menu\");\n\n        const $button = this.$widget.find(\".right-dropdown-button\")\n            .addClass(this.iconClass)\n            .attr(\"title\", this.title)\n            .tooltip({ trigger: \"hover\" })\n            .on(\"click\", () => $button.tooltip(\"hide\"));\n\n        this.$widget.on('show.bs.dropdown', async () => {\n            await this.dropdownShown();\n\n            const rect = this.$dropdownMenu[0].getBoundingClientRect();\n            const pixelsToBottom = $(window).height() - rect.bottom;\n\n            if (pixelsToBottom < 0) {\n                this.$dropdownMenu.css(\"top\", pixelsToBottom);\n            }\n        });\n\n        this.$dropdownContent = $(this.dropdownTpl);\n        this.$widget.find(\".dropdown-menu\").append(this.$dropdownContent);\n    }\n\n    // to be overridden\n    async dropdownShow() {}\n\n    hideDropdown() {\n        this.$widget.dropdown(\"hide\");\n        this.$dropdownMenu.removeClass(\"show\");\n    }\n}\n","import libraryLoader from \"../../services/library_loader.js\";\nimport utils from \"../../services/utils.js\";\nimport dateNoteService from \"../../services/date_notes.js\";\nimport server from \"../../services/server.js\";\nimport appContext from \"../../components/app_context.js\";\nimport RightDropdownButtonWidget from \"./right_dropdown_button.js\";\nimport toastService from \"../../services/toast.js\";\n\nconst DROPDOWN_TPL = `\n<div class=\"calendar-dropdown-widget\">\n  <style>\n  .calendar-dropdown-widget {\n      width: 350px;\n  }\n  </style>\n\n  <div class=\"calendar-header\">\n    <button class=\"calendar-btn bx bx-left-arrow-alt\" data-calendar-toggle=\"previous\"></button>\n\n    <div class=\"calendar-header-label\" data-calendar-label=\"month\"></div>\n\n    <button class=\"calendar-btn bx bx-right-arrow-alt\" data-calendar-toggle=\"next\"></button>\n  </div>\n\n  <div class=\"calendar-week\">\n    <span>一</span> <span>二</span><span>三</span> <span>四</span> <span>五</span> <span>六</span> <span>日</span>\n  </div>\n  <div class=\"calendar-body\" data-calendar-area=\"month\"></div>\n</div>`;\n\nexport default class CalendarWidget extends RightDropdownButtonWidget {\n    constructor(title, icon) {\n        super(title, icon, DROPDOWN_TPL);\n    }\n\n    doRender() {\n        super.doRender();\n\n        this.$month = this.$dropdownContent.find('[data-calendar-area=\"month\"]');\n        this.$next = this.$dropdownContent.find('[data-calendar-toggle=\"next\"]');\n        this.$previous = this.$dropdownContent.find('[data-calendar-toggle=\"previous\"]');\n        this.$label = this.$dropdownContent.find('[data-calendar-label=\"month\"]');\n\n        this.$next.on('click', () => {\n            this.date.setMonth(this.date.getMonth() + 1);\n            this.createMonth();\n        });\n\n        this.$previous.on('click', e => {\n            this.date.setMonth(this.date.getMonth() - 1);\n            this.createMonth();\n        });\n\n        this.$dropdownContent.find('.calendar-header').on(\"click\", e => e.stopPropagation());\n\n        this.$dropdownContent.on('click', '.calendar-date', async ev => {\n            const date = $(ev.target).closest('.calendar-date').attr('data-calendar-date');\n\n            const note = await dateNoteService.getDayNote(date);\n\n            if (note) {\n                appContext.tabManager.getActiveContext().setNote(note.noteId);\n                this.hideDropdown();\n            }\n            else {\n                toastService.showError(\"Cannot find day note\");\n            }\n        });\n    }\n\n    async dropdownShown() {\n        await libraryLoader.requireLibrary(libraryLoader.CALENDAR_WIDGET);\n\n        const activeNote = appContext.tabManager.getActiveContextNote();\n\n        this.init(activeNote?.getOwnedLabelValue(\"dateNote\"));\n    }\n\n    init(activeDate) {\n        // attaching time fixes local timezone handling\n        this.activeDate = activeDate ? new Date(`${activeDate}T12:00:00`) : null;\n        this.todaysDate = new Date();\n        this.date = new Date((this.activeDate || this.todaysDate).getTime());\n        this.date.setDate(1);\n\n        this.createMonth();\n    }\n\n    createDay(dateNotesForMonth, num, day) {\n        const $newDay = $('<a>')\n            .addClass(\"calendar-date\")\n            .attr('data-calendar-date', utils.formatDateISO(this.date));\n        const $date = $('<span>').html(num);\n\n        // if it's the first day of the month\n        if (num === 1) {\n            if (day === 0) {\n                $newDay.css(\"marginLeft\", (6 * 14.28) + '%');\n            } else {\n                $newDay.css(\"marginLeft\", `${(day - 1) * 14.28}%`);\n            }\n        }\n\n        const dateNoteId = dateNotesForMonth[utils.formatDateISO(this.date)];\n\n        if (dateNoteId) {\n            $newDay.addClass('calendar-date-exists');\n            $newDay.attr(\"href\", `#root/${dateNoteId}`);\n        }\n\n        if (this.isEqual(this.date, this.activeDate)) {\n            $newDay.addClass('calendar-date-active');\n        }\n\n        if (this.isEqual(this.date, this.todaysDate)) {\n            $newDay.addClass('calendar-date-today');\n        }\n\n        $newDay.append($date);\n        return $newDay;\n    }\n\n    isEqual(a, b) {\n        if (!a && b || a && !b) {\n            return false;\n        }\n\n        return a.getFullYear() === b.getFullYear()\n            && a.getMonth() === b.getMonth()\n            && a.getDate() === b.getDate();\n    }\n\n    async createMonth() {\n        const month = utils.formatDateISO(this.date).substr(0, 7);\n        const dateNotesForMonth = await server.get(`special-notes/notes-for-month/${month}`);\n\n        this.$month.empty();\n\n        const currentMonth = this.date.getMonth();\n        while (this.date.getMonth() === currentMonth) {\n            const $day = this.createDay(\n                dateNotesForMonth,\n                this.date.getDate(),\n                this.date.getDay(),\n                this.date.getFullYear()\n            );\n\n            this.$month.append($day);\n\n            this.date.setDate(this.date.getDate() + 1);\n        }\n        // while loop trips over and day is at 30/31, bring it back\n        this.date.setDate(1);\n        this.date.setMonth(this.date.getMonth() - 1);\n\n        this.$label.html(`${this.monthsAsString(this.date.getMonth())} ${this.date.getFullYear()}`);\n    }\n\n    monthsAsString(monthIndex) {\n        return [\n            '一月',\n            '二月',\n            '三月',\n            '四月',\n            '五月',\n            '六月',\n            '七月',\n            '八月',\n            '九月',\n            '十月',\n            '十一月',\n            '十二月'\n        ][monthIndex];\n    }\n}\n","import BasicWidget from \"./basic_widget.js\";\nimport contextMenu from \"../menus/context_menu.js\";\nimport appContext from \"../components/app_context.js\";\n\nconst TPL = `<div class=\"spacer\"></div>`;\n\nexport default class SpacerWidget extends BasicWidget {\n    constructor(baseSize = 0, growthFactor = 1000) {\n        super();\n\n        this.baseSize = baseSize;\n        this.growthFactor = growthFactor;\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$widget.css(\"flex-basis\", this.baseSize);\n        this.$widget.css(\"flex-grow\", this.growthFactor);\n        this.$widget.css(\"flex-shrink\", 1000);\n\n        this.$widget.on(\"contextmenu\", e => {\n            this.$widget.tooltip(\"hide\");\n\n            contextMenu.show({\n                x: e.pageX,\n                y: e.pageY,\n                items: [\n                    {title: \"配置启动栏\", command: \"showLaunchBarSubtree\", uiIcon: \"bx bx-sidebar\"}\n                ],\n                selectMenuItemHandler: ({command}) => {\n                    appContext.triggerCommand(command);\n                }\n            });\n\n            return false; // blocks default browser right click menu\n        });\n    }\n}\n","import OnClickButtonWidget from \"./onclick_button.js\";\nimport linkContextMenuService from \"../../menus/link_context_menu.js\";\nimport utils from \"../../services/utils.js\";\nimport appContext from \"../../components/app_context.js\";\n\nexport default class OpenNoteButtonWidget extends OnClickButtonWidget {\n    constructor(noteToOpen) {\n        super();\n\n        this.noteToOpen = noteToOpen;\n\n        this.title(() => this.noteToOpen.title)\n            .icon(() => this.noteToOpen.getIcon())\n            .onClick((widget, evt) => this.launch(evt))\n            .onAuxClick((widget, evt) => this.launch(evt))\n            .onContextMenu(evt => linkContextMenuService.openContextMenu(this.noteToOpen.noteId, evt));\n    }\n\n    async launch(evt) {\n        if (evt.which === 3) {\n            return;\n        }\n        const ctrlKey = utils.isCtrlKey(evt);\n\n        if ((evt.which === 1 && ctrlKey) || evt.which === 2) {\n            await appContext.tabManager.openInNewTab(this.noteToOpen.noteId);\n        } else {\n            await appContext.tabManager.openInSameTab(this.noteToOpen.noteId);\n        }\n    }\n\n    initialRenderCompleteEvent() {\n        // we trigger refresh above\n    }\n}\n","import RightDropdownButtonWidget from \"./right_dropdown_button.js\";\nimport linkService from \"../../services/link.js\";\n\nconst DROPDOWN_TPL = `\n<div class=\"bookmark-folder-widget\">\n    <style>\n        .bookmark-folder-widget {\n            min-width: 400px;\n            max-height: 500px;\n            padding: 7px 15px 0 15px;\n            font-size: 1.2rem;\n            overflow: auto;\n        }\n        \n        .bookmark-folder-widget ul {\n            padding: 0;\n            list-style-type: none;\n        }\n        \n        .bookmark-folder-widget .note-link {\n            display: block;\n            padding: 5px 10px 5px 5px;\n        }\n        \n        .bookmark-folder-widget .note-link:hover {\n            background-color: var(--accented-background-color);\n            text-decoration: none;\n        }\n        \n        .dropdown-menu .bookmark-folder-widget a:hover {\n            text-decoration: none;\n            background: transparent !important;\n        }\n        \n        .bookmark-folder-widget li .note-link {\n            padding-left: 35px;\n        }\n    </style>\n    \n    <div class=\"parent-note\"></div>\n    \n    <ul class=\"children-notes\"></ul>\n</div>`;\n\nexport default class BookmarkFolderWidget extends RightDropdownButtonWidget {\n    constructor(note) {\n        super(note.title, note.getIcon(), DROPDOWN_TPL);\n\n        this.note = note;\n    }\n\n    doRender() {\n        super.doRender();\n\n        this.$parentNote = this.$dropdownContent.find('.parent-note');\n        this.$childrenNotes = this.$dropdownContent.find('.children-notes');\n    }\n\n    async dropdownShown() {\n        this.$parentNote.empty();\n        this.$childrenNotes.empty();\n\n        const linkOptions = {\n            showTooltip: false,\n            showNoteIcon: true\n        };\n\n        this.$parentNote.append(\n            (await linkService.createLink(this.note.noteId, linkOptions))\n                .addClass(\"note-link\")\n        );\n\n        for (const childNote of await this.note.getChildNotes()) {\n            this.$childrenNotes.append(\n                $(\"<li>\")\n                    .append(\n                        (await linkService.createLink(childNote.noteId, linkOptions))\n                            .addClass(\"note-link\")\n                    )\n            );\n        }\n    }\n\n    refreshIcon() {}\n}\n","import FlexContainer from \"./containers/flex_container.js\";\nimport OpenNoteButtonWidget from \"./buttons/open_note_button_widget.js\";\nimport BookmarkFolderWidget from \"./buttons/bookmark_folder.js\";\nimport froca from \"../services/froca.js\";\n\nexport default class BookmarkButtons extends FlexContainer {\n    constructor() {\n        super(\"column\");\n\n        this.contentSized();\n    }\n\n    async refresh() {\n        this.$widget.empty();\n        this.children = [];\n        this.noteIds = [];\n\n        const bookmarkParentNote = await froca.getNote('_lbBookmarks');\n\n        for (const note of await bookmarkParentNote.getChildNotes()) {\n            this.noteIds.push(note.noteId);\n\n            const buttonWidget = note.isLabelTruthy(\"bookmarkFolder\")\n                ? new BookmarkFolderWidget(note)\n                : new OpenNoteButtonWidget(note)\n                    .class(\"launcher-button\");\n\n            this.child(buttonWidget);\n\n            this.$widget.append(buttonWidget.render());\n\n            buttonWidget.refreshIcon();\n        }\n    }\n\n    initialRenderCompleteEvent() {\n        this.refresh();\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.getBranchRows().find(branch => branch.parentNoteId === '_lbBookmarks')) {\n            this.refresh();\n        }\n\n        if (loadResults.getAttributeRows().find(attr => attr.type === 'label'\n            && ['iconClass', 'workspaceIconClass', 'bookmarkFolder'].includes(attr.name)\n            && this.noteIds.includes(attr.noteId))\n        ) {\n            this.refresh();\n        }\n    }\n}\n","import keyboardActionsService from \"../../services/keyboard_actions.js\";\nimport AbstractButtonWidget from \"./abstract_button.js\";\n\nlet actions;\n\nkeyboardActionsService.getActions().then(as => actions = as);\n\nexport default class CommandButtonWidget extends AbstractButtonWidget {\n    doRender() {\n        super.doRender();\n\n        if (this.settings.command) {\n            this.$widget.on(\"click\", () => {\n                this.$widget.tooltip(\"hide\");\n\n                this.triggerCommand(this._command);\n            });\n        } else {\n            console.warn(`Button widget '${this.componentId}' has no defined command`, this.settings);\n        }\n    }\n\n    getTitle() {\n        const title = super.getTitle();\n\n        const action = actions.find(act => act.actionName === this._command);\n\n        if (action && action.effectiveShortcuts.length > 0) {\n            return `${title} (${action.effectiveShortcuts.join(\", \")})`;\n        } else {\n            return title;\n        }\n    }\n\n    onClick(handler) {\n        this.settings.onClick = handler;\n        return this;\n    }\n\n    /**\n     * @param {function|string} command\n     * @returns {this}\n     */\n    command(command) {\n        this.settings.command = command;\n        return this;\n    }\n\n    get _command() {\n        return typeof this.settings.command === \"function\"\n            ? this.settings.command()\n            : this.settings.command;\n    }\n}\n","import protectedSessionHolder from \"../../services/protected_session_holder.js\";\nimport CommandButtonWidget from \"./command_button.js\";\n\nexport default class ProtectedSessionStatusWidget extends CommandButtonWidget {\n    constructor() {\n        super();\n\n        this.class(\"launcher-button\");\n\n        this.settings.icon = () => protectedSessionHolder.isProtectedSessionAvailable()\n            ? \"bx-check-shield\"\n            : \"bx-shield-quarter\";\n\n        this.settings.title = () => protectedSessionHolder.isProtectedSessionAvailable()\n            ? \"受保护的会话已启动. 点击退出受保护的会话.\"\n            : \"点击进入受保护的会话\";\n\n        this.settings.command = () => protectedSessionHolder.isProtectedSessionAvailable()\n            ? \"leaveProtectedSession\"\n            : \"enterProtectedSession\";\n    }\n\n    protectedSessionStartedEvent() {\n        this.refreshIcon();\n    }\n}\n","import server from './server.js';\nimport toastService from \"./toast.js\";\n\nasync function syncNow(ignoreNotConfigured = false) {\n    const result = await server.post('sync/now');\n\n    if (result.success) {\n        toastService.showMessage(\"同步成功.\");\n    }\n    else {\n        if (result.message.length > 200) {\n            result.message = `${result.message.substr(0, 200)}...`;\n        }\n\n        if (!ignoreNotConfigured || result.errorCode !== 'NOT_CONFIGURED') {\n            toastService.showError(`Sync failed: ${result.message}`);\n        }\n    }\n}\n\nexport default {\n    syncNow\n};\n","import BasicWidget from \"./basic_widget.js\";\nimport ws from \"../services/ws.js\";\nimport options from \"../services/options.js\";\nimport syncService from \"../services/sync.js\";\n\nconst TPL = `\n<div class=\"sync-status-widget launcher-button\">\n    <style>\n    .sync-status-widget {\n    }\n    \n    .sync-status {\n        box-sizing: border-box;\n    }\n    \n    .sync-status .sync-status-icon {\n        display: inline-block;\n        position: relative;\n        top: -5px;\n        font-size: 110%;\n    }\n    \n    .sync-status .sync-status-sub-icon {\n        font-size: 40%; \n        position: absolute; \n        left: 0;\n        top: 16px;\n    }\n    \n    .sync-status .sync-status-icon span {\n        border: none !important;\n    }\n    \n    .sync-status-icon:not(.sync-status-in-progress):hover {\n        background-color: var(--hover-item-background-color);\n        cursor: pointer;\n    }\n    </style>\n\n    <div class=\"sync-status\">\n        <span class=\"sync-status-icon sync-status-unknown bx bx-time\" \n              data-toggle=\"tooltip\" \n              data-placement=\"right\"\n              title=\"<p>下次同步时可获取同步状态.</p><p>点击开始同步.</p>\">\n        </span>\n        <span class=\"sync-status-icon sync-status-connected-with-changes bx bx-wifi\"\n              data-toggle=\"tooltip\" \n              data-placement=\"right\"\n              title=\"<p>已连接到同步服务器. <br>还有一些修改的数据需要同步.</p><p>点击开始同步.</p>\">\n            <span class=\"bx bxs-star sync-status-sub-icon\"></span>\n        </span>\n        <span class=\"sync-status-icon sync-status-connected-no-changes bx bx-wifi\" \n              data-toggle=\"tooltip\" \n              data-placement=\"right\"\n              title=\"<p>已连接到同步服务器.<br>所有的修改已经同步.</p><p>点击开始同步.</p>\">\n        </span>\n        <span class=\"sync-status-icon sync-status-disconnected-with-changes bx bx-wifi-off\"\n              data-toggle=\"tooltip\" \n              data-placement=\"right\"\n              title=\"<p>连接到同步服务器失败.<br>还有一些修改的数据需要同步.</p><p>点击开始同步.</p>\">\n            <span class=\"bx bxs-star sync-status-sub-icon\"></span>\n        </span>\n        <span class=\"sync-status-icon sync-status-disconnected-no-changes bx bx-wifi-off\" \n              data-toggle=\"tooltip\"\n              data-placement=\"right\"\n              title=\"<p>连接到同步服务器失败.<br>所有的修改已经同步.</p><p>点击开始同步.</p>\">\n        </span>\n        <span class=\"sync-status-icon sync-status-in-progress bx bx-analyse bx-spin\" \n              data-toggle=\"tooltip\"\n              data-placement=\"right\"\n              title=\"同步中.\">\n        </span>\n    </div>\n</div>\n`;\n\nexport default class SyncStatusWidget extends BasicWidget {\n    constructor() {\n        super();\n\n        this.syncState = 'unknown';\n        this.allChangesPushed = false;\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$widget.hide();\n\n        this.$widget.find('[data-toggle=\"tooltip\"]').tooltip({\n            html: true\n        });\n\n        this.$widget.find('.sync-status-icon:not(.sync-status-in-progress)')\n            .on('click', () => syncService.syncNow());\n\n        ws.subscribeToMessages(message => this.processMessage(message));\n    }\n\n    showIcon(className) {\n        if (!options.get('syncServerHost')) {\n            this.toggleInt(false);\n            return;\n        }\n\n        this.$widget.show();\n        this.$widget.find('.sync-status-icon').hide();\n        this.$widget.find(`.sync-status-${className}`).show();\n    }\n\n    processMessage(message) {\n        if (message.type === 'sync-pull-in-progress') {\n            this.syncState = 'in-progress';\n            this.lastSyncedPush = message.lastSyncedPush;\n        }\n        else if (message.type === 'sync-push-in-progress') {\n            this.syncState = 'in-progress';\n            this.lastSyncedPush = message.lastSyncedPush;\n        }\n        else if (message.type === 'sync-finished') {\n            this.syncState = 'connected';\n            this.lastSyncedPush = message.lastSyncedPush;\n        }\n        else if (message.type === 'sync-failed') {\n            this.syncState = 'disconnected';\n            this.lastSyncedPush = message.lastSyncedPush;\n        }\n        else if (message.type === 'frontend-update') {\n            this.lastSyncedPush = message.data.lastSyncedPush;\n        }\n\n        this.allChangesPushed = this.lastSyncedPush === ws.getMaxKnownEntityChangeSyncId();\n\n        if (['unknown', 'in-progress'].includes(this.syncState)) {\n            this.showIcon(this.syncState);\n        } else {\n            this.showIcon(`${this.syncState}-${this.allChangesPushed ? 'no-changes' : 'with-changes'}`);\n        }\n    }\n}\n","import shortcutService from \"../../../services/shortcuts.js\";\nimport attributesService from \"../../../services/attributes.js\";\nimport OnClickButtonWidget from \"../onclick_button.js\";\n\nexport default class AbstractLauncher extends OnClickButtonWidget {\n    constructor(launcherNote) {\n        super();\n\n        this.class(\"launcher-button\");\n\n        /** @type {FNote} */\n        this.launcherNote = launcherNote;\n\n        for (const label of launcherNote.getOwnedLabels('keyboardShortcut')) {\n            this.bindNoteShortcutHandler(label);\n        }\n    }\n\n    launch() {\n        throw new Error(\"Abstract implementation\");\n    }\n\n    bindNoteShortcutHandler(labelOrRow) {\n        const namespace = labelOrRow.attributeId;\n\n        if (labelOrRow.isDeleted) { // only applicable if row\n            shortcutService.removeGlobalShortcut(namespace);\n        } else {\n            shortcutService.bindGlobalShortcut(labelOrRow.value, () => this.launch(), namespace);\n        }\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        for (const attr of loadResults.getAttributeRows()) {\n            if (attr.noteId === this.launcherNote.noteId && attr.type === 'label' && attr.name === 'keyboardShortcut') {\n                this.bindNoteShortcutHandler(attr);\n            } else if (attr.type === 'label' && attr.name === 'iconClass' && attributesService.isAffecting(attr, this.launcherNote)) {\n                this.refreshIcon();\n            }\n        }\n    }\n}\n","import AbstractLauncher from \"./abstract_launcher.js\";\nimport dialogService from \"../../../services/dialog.js\";\nimport appContext from \"../../../components/app_context.js\";\nimport utils from \"../../../services/utils.js\";\nimport linkContextMenuService from \"../../../menus/link_context_menu.js\";\n\n// we're intentionally displaying the launcher title and icon instead of the target,\n// e.g. you want to make launchers to 2 mermaid diagrams which both have mermaid icon (ok),\n// but on the launchpad you want them distinguishable.\n// for titles, the note titles may follow a different scheme than maybe desirable on the launchpad\n// another reason is the discrepancy between what user sees on the launchpad and in the config (esp. icons).\n// The only downside is more work in setting up the typical case\n// where you actually want to have both title and icon in sync, but for those cases there are bookmarks\nexport default class NoteLauncher extends AbstractLauncher {\n    constructor(launcherNote) {\n        super(launcherNote);\n\n        this.title(() => this.launcherNote.title)\n            .icon(() => this.launcherNote.getIcon())\n            .onClick((widget, evt) => this.launch(evt))\n            .onAuxClick((widget, evt) => this.launch(evt))\n            .onContextMenu(evt => {\n                const targetNoteId = this.getTargetNoteId();\n                if (!targetNoteId) {\n                    return;\n                }\n\n                const hoistedNoteId = this.getHoistedNoteId();\n\n                linkContextMenuService.openContextMenu(targetNoteId, evt, {}, hoistedNoteId);\n            });\n    }\n\n    async launch(evt) {\n        // await because subclass overrides can be async\n        const targetNoteId = await this.getTargetNoteId();\n        if (!targetNoteId || evt.which === 3) {\n            return;\n        }\n\n        const hoistedNoteId = await this.getHoistedNoteId();\n\n        if (!evt) {\n            // keyboard shortcut\n            await appContext.tabManager.openInSameTab(targetNoteId, hoistedNoteId);\n        } else {\n            const ctrlKey = utils.isCtrlKey(evt);\n\n            if ((evt.which === 1 && ctrlKey) || evt.which === 2) {\n                await appContext.tabManager.openInNewTab(targetNoteId, hoistedNoteId);\n            } else {\n                await appContext.tabManager.openInSameTab(targetNoteId, hoistedNoteId);\n            }\n        }\n    }\n\n    getTargetNoteId() {\n        const targetNoteId = this.launcherNote.getRelationValue('target');\n\n        if (!targetNoteId) {\n            dialogService.info(\"This launcher doesn't define target note.\");\n            return;\n        }\n\n        return targetNoteId;\n    }\n\n    getHoistedNoteId() {\n        return this.launcherNote.getRelationValue('hoistedNote')\n            || appContext.tabManager.getActiveContext().hoistedNoteId;\n    }\n\n    getTitle() {\n        const shortcuts = this.launcherNote.getLabels(\"keyboardShortcut\")\n            .map(l => l.value)\n            .filter(v => !!v)\n            .join(\", \");\n\n        let title = super.getTitle();\n        if (shortcuts) {\n            title += ` (${shortcuts})`;\n        }\n\n        return title;\n    }\n}\n","import AbstractLauncher from \"./abstract_launcher.js\";\n\nexport default class ScriptLauncher extends AbstractLauncher {\n    constructor(launcherNote) {\n        super(launcherNote);\n\n        this.title(() => this.launcherNote.title)\n            .icon(() => this.launcherNote.getIcon())\n            .onClick(() => this.launch());\n    }\n\n    async launch() {\n        if (this.launcherNote.isLabelTruthy('scriptInLauncherContent')) {\n            await this.launcherNote.executeScript();\n        } else {\n            const script = await this.launcherNote.getRelationTarget('script');\n\n            await script.executeScript();\n        }\n    }\n}\n","import NoteLauncher from \"./note_launcher.js\";\nimport dateNotesService from \"../../../services/date_notes.js\";\nimport appContext from \"../../../components/app_context.js\";\n\nexport default class TodayLauncher extends NoteLauncher {\n    async getTargetNoteId() {\n        const todayNote = await dateNotesService.getTodayNote();\n\n        return todayNote.noteId;\n    }\n\n    getHoistedNoteId() {\n        return appContext.tabManager.getActiveContext().hoistedNoteId;\n    }\n}\n","import froca from \"../../services/froca.js\";\nimport attributeService from \"../../services/attributes.js\";\nimport CommandButtonWidget from \"./command_button.js\";\n\nexport default class ButtonFromNoteWidget extends CommandButtonWidget {\n    constructor() {\n        super();\n\n        this.settings.buttonNoteIdProvider = null;\n    }\n\n    buttonNoteIdProvider(provider) {\n        this.settings.buttonNoteIdProvider = provider;\n        return this;\n    }\n\n    doRender() {\n        super.doRender();\n\n        this.updateIcon();\n    }\n\n    updateIcon() {\n        const buttonNoteId = this.settings.buttonNoteIdProvider();\n\n        if (!buttonNoteId) {\n            console.error(`buttonNoteId for '${this.componentId}' is not defined.`);\n            return;\n        }\n\n        froca.getNote(buttonNoteId).then(note => {\n            this.settings.icon = note.getIcon();\n\n            this.refreshIcon();\n        });\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        const buttonNote = froca.getNoteFromCache(this.buttonNoteIdProvider());\n\n        if (!buttonNote) {\n            return;\n        }\n\n        if (loadResults.getAttributeRows(this.componentId).find(attr =>\n            attr.type === 'label'\n            && attr.name === 'iconClass'\n            && attributeService.isAffecting(attr, buttonNote))) {\n\n            this.updateIcon();\n        }\n    }\n}","import utils from \"../../services/utils.js\";\nimport contextMenu from \"../../menus/context_menu.js\";\nimport treeService from \"../../services/tree.js\";\nimport ButtonFromNoteWidget from \"./button_from_note.js\";\n\nexport default class HistoryNavigationButton extends ButtonFromNoteWidget {\n    constructor(launcherNote, command) {\n        super();\n\n        this.title(() => launcherNote.title)\n            .icon(() => launcherNote.getIcon())\n            .command(() => command)\n            .titlePlacement(\"right\")\n            .buttonNoteIdProvider(() => launcherNote.noteId)\n            .onContextMenu(e => this.showContextMenu(e))\n            .class(\"launcher-button\");\n    }\n\n    isEnabled() {\n        return super.isEnabled() && utils.isElectron();\n    }\n\n    doRender() {\n        super.doRender();\n\n        if (!utils.isElectron()) {\n            return;\n        }\n\n        this.webContents = utils.dynamicRequire('@electron/remote').getCurrentWebContents();\n\n        // without this, the history is preserved across frontend reloads\n        this.webContents.clearHistory();\n\n        this.refresh();\n    }\n\n    async showContextMenu(e) {\n        e.preventDefault();\n\n        // API is broken and will be replaced: https://github.com/electron/electron/issues/33899\n        // until then no context menu\n        if (true) { // avoid warning in dev console\n            return;\n        }\n\n        if (this.webContents.history.length < 2) {\n            return;\n        }\n\n        let items = [];\n\n        const activeIndex = this.webContents.getActiveIndex();\n\n        for (const idx in this.webContents.history) {\n            const url = this.webContents.history[idx];\n            const [_, notePathWithTab] = url.split('#');\n            // broken: use linkService.parseNavigationStateFromUrl();\n            const [notePath, ntxId] = notePathWithTab.split('-');\n\n            const title = await treeService.getNotePathTitle(notePath);\n\n            items.push({\n                title,\n                idx,\n                uiIcon: idx == activeIndex ? \"bx bx-radio-circle-marked\" : // compare with type coercion!\n                    (idx < activeIndex ? \"bx bx-left-arrow-alt\" : \"bx bx-right-arrow-alt\")\n            });\n        }\n\n        items.reverse();\n\n        if (items.length > 20) {\n            items = items.slice(0, 50);\n        }\n\n        contextMenu.show({\n            x: e.pageX,\n            y: e.pageY,\n            items,\n            selectMenuItemHandler: ({idx}) => this.webContents.goToIndex(idx)\n        });\n    }\n\n    refresh() {\n        if (!utils.isElectron()) {\n            return;\n        }\n\n        // disabling this because in electron 9 there's a weird performance problem which makes these webContents calls\n        // block UI thread for > 1 second on specific notes (book notes displaying underlying render notes with scripts)\n\n        // this.$backInHistory.toggleClass('disabled', !this.webContents.canGoBack());\n        // this.$forwardInHistory.toggleClass('disabled', !this.webContents.canGoForward());\n    }\n\n    activeNoteChangedEvent() {\n        this.refresh();\n    }\n}\n","import CalendarWidget from \"../buttons/calendar.js\";\nimport SpacerWidget from \"../spacer.js\";\nimport BookmarkButtons from \"../bookmark_buttons.js\";\nimport ProtectedSessionStatusWidget from \"../buttons/protected_session_status.js\";\nimport SyncStatusWidget from \"../sync_status.js\";\nimport BasicWidget from \"../basic_widget.js\";\nimport NoteLauncher from \"../buttons/launcher/note_launcher.js\";\nimport ScriptLauncher from \"../buttons/launcher/script_launcher.js\";\nimport CommandButtonWidget from \"../buttons/command_button.js\";\nimport utils from \"../../services/utils.js\";\nimport TodayLauncher from \"../buttons/launcher/today_launcher.js\";\nimport HistoryNavigationButton from \"../buttons/history_navigation.js\";\n\nexport default class LauncherWidget extends BasicWidget {\n    constructor() {\n        super();\n\n        this.innerWidget = null;\n    }\n\n    isEnabled() {\n        return this.innerWidget.isEnabled();\n    }\n\n    doRender() {\n        this.$widget = this.innerWidget.render();\n    }\n\n    async initLauncher(note) {\n        if (note.type !== 'launcher') {\n            throw new Error(`Note '${note.noteId}' '${note.title}' is not a launcher even though it's in the launcher subtree`);\n        }\n\n        if (!utils.isDesktop() && note.isLabelTruthy('desktopOnly')) {\n            return false;\n        }\n\n        const launcherType = note.getLabelValue(\"launcherType\");\n\n        if (glob.TRILIUM_SAFE_MODE && launcherType === 'customWidget') {\n            return false;\n        }\n\n        if (launcherType === 'command') {\n            this.innerWidget = this.initCommandLauncherWidget(note)\n                .class(\"launcher-button\");\n        } else if (launcherType === 'note') {\n            this.innerWidget = new NoteLauncher(note)\n                .class(\"launcher-button\");\n        } else if (launcherType === 'script') {\n            this.innerWidget = new ScriptLauncher(note)\n                .class(\"launcher-button\");\n        } else if (launcherType === 'customWidget') {\n            this.innerWidget = await this.initCustomWidget(note);\n        } else if (launcherType === 'builtinWidget') {\n            this.innerWidget = this.initBuiltinWidget(note);\n        } else {\n            throw new Error(`Unrecognized launcher type '${launcherType}' for launcher '${note.noteId}' title '${note.title}'`);\n        }\n\n        if (!this.innerWidget) {\n            throw new Error(`Unknown initialization error for note '${note.noteId}', title '${note.title}'`);\n        }\n\n        this.child(this.innerWidget);\n\n        return true;\n    }\n\n    initCommandLauncherWidget(note) {\n        return new CommandButtonWidget()\n            .title(() => note.title)\n            .icon(() => note.getIcon())\n            .command(() => note.getLabelValue(\"command\"));\n    }\n\n    async initCustomWidget(note) {\n        const widget = await note.getRelationTarget('widget');\n\n        if (widget) {\n            return await widget.executeScript();\n        } else {\n            throw new Error(`Custom widget of launcher '${note.noteId}' '${note.title}' is not defined.`);\n        }\n    }\n\n    initBuiltinWidget(note) {\n        const builtinWidget = note.getLabelValue(\"builtinWidget\");\n\n        if (builtinWidget === 'calendar') {\n            return new CalendarWidget(note.title, note.getIcon());\n        } else if (builtinWidget === 'spacer') {\n            // || has to be inside since 0 is a valid value\n            const baseSize = parseInt(note.getLabelValue(\"baseSize\") || \"40\");\n            const growthFactor = parseInt(note.getLabelValue(\"growthFactor\") || \"100\");\n\n            return new SpacerWidget(baseSize, growthFactor);\n        } else if (builtinWidget === 'bookmarks') {\n            return new BookmarkButtons();\n        } else if (builtinWidget === 'protectedSession') {\n            return new ProtectedSessionStatusWidget();\n        } else if (builtinWidget === 'syncStatus') {\n            return new SyncStatusWidget();\n        } else if (builtinWidget === 'backInHistoryButton') {\n            return new HistoryNavigationButton(note, \"backInNoteHistory\");\n        } else if (builtinWidget === 'forwardInHistoryButton') {\n            return new HistoryNavigationButton(note, \"forwardInNoteHistory\");\n        } else if (builtinWidget === 'todayInJournal') {\n            return new TodayLauncher(note);\n        } else {\n            throw new Error(`Unrecognized builtin widget ${builtinWidget} for launcher ${note.noteId} \"${note.title}\"`);\n        }\n    }\n}\n","import FlexContainer from \"./flex_container.js\";\nimport froca from \"../../services/froca.js\";\nimport appContext from \"../../components/app_context.js\";\nimport LauncherWidget from \"./launcher.js\";\n\nexport default class LauncherContainer extends FlexContainer {\n    constructor() {\n        super('column');\n\n        this.id('launcher-container');\n        this.css('height', '100%');\n        this.filling();\n\n        this.load();\n    }\n\n    async load() {\n        await froca.initializedPromise;\n\n        const visibleLaunchersRoot = await froca.getNote('_lbVisibleLaunchers', true);\n\n        if (!visibleLaunchersRoot) {\n            console.log(\"Visible launchers root note doesn't exist.\");\n\n            return;\n        }\n\n        const newChildren = [];\n\n        for (const launcherNote of await visibleLaunchersRoot.getChildNotes()) {\n            try {\n                const launcherWidget = new LauncherWidget();\n                const success = await launcherWidget.initLauncher(launcherNote);\n\n                if (success) {\n                    newChildren.push(launcherWidget);\n                }\n            }\n            catch (e) {\n                console.error(e);\n            }\n        }\n\n        this.children = [];\n        this.child(...newChildren);\n\n        this.$widget.empty();\n        this.renderChildren();\n\n        await this.handleEventInChildren('initialRenderComplete');\n\n        const activeContext = appContext.tabManager.getActiveContext();\n\n        if (activeContext) {\n            await this.handleEvent('setNoteContext', {\n                noteContext: activeContext\n            });\n\n            if (activeContext.notePath) {\n                await this.handleEvent('noteSwitched', {\n                    noteContext: activeContext,\n                    notePath: activeContext.notePath\n                });\n            }\n        }\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.getBranchRows().find(branch => froca.getNoteFromCache(branch.parentNoteId)?.isLaunchBarConfig())) {\n            // changes in note placement require reload of all launchers, all other changes are handled by individual\n            // launchers\n            this.load();\n        }\n    }\n}\n","import FlexContainer from \"./flex_container.js\";\n\nexport default class RootContainer extends FlexContainer {\n    constructor() {\n        super('row');\n\n        this.id('root-widget');\n        this.css('height', '100%');\n    }\n}\n","import NoteContextAwareWidget from \"./note_context_aware_widget.js\";\nimport options from \"../services/options.js\";\nimport attributeService from \"../services/attributes.js\";\n\nconst TPL = `\n<div class=\"shared-info-widget alert alert-warning\">\n    <style>\n        .shared-info-widget {\n            margin: 10px;\n            contain: none;\n            padding: 10px;\n            font-weight: bold;\n        }\n    </style>\n    \n    <span class=\"shared-text\"></span> <a class=\"shared-link external\"></a>. 需要帮助请访问 <a href=\"https://github.com/zadam/trilium/wiki/Sharing\">wiki</a>.\n</div>`;\n\nexport default class SharedInfoWidget extends NoteContextAwareWidget {\n    isEnabled() {\n        return super.isEnabled() && this.noteId !== '_share' && this.note.hasAncestor('_share');\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.$sharedLink = this.$widget.find(\".shared-link\");\n        this.$sharedText = this.$widget.find(\".shared-text\");\n        this.contentSized();\n    }\n\n    async refreshWithNote(note) {\n        const syncServerHost = options.get(\"syncServerHost\");\n        let link;\n\n        const shareId = this.getShareId(note);\n\n        if (syncServerHost) {\n            link = `${syncServerHost}/share/${shareId}`;\n            this.$sharedText.text(\"这个笔记分享在公开地址\");\n        }\n        else {\n            let host = location.host;\n            if (host.endsWith('/')) {\n                // seems like IE has trailing slash\n                // https://github.com/zadam/trilium/issues/3782\n                host = host.substr(0, host.length - 1);\n            }\n\n            link = `${location.protocol}//${host}${location.pathname}share/${shareId}`;\n            this.$sharedText.text(\"这个笔记分享在本地地址\");\n        }\n\n        this.$sharedLink.attr(\"href\", link).text(link);\n    }\n\n    getShareId(note) {\n        if (note.hasOwnedLabel('shareRoot')) {\n            return '';\n        }\n\n        return note.getOwnedLabelValue('shareAlias') || note.noteId;\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.getAttributeRows().find(attr => attr.name.startsWith('_share') && attributeService.isAffecting(attr, this.note))) {\n            this.refresh();\n        }\n        else if (loadResults.getBranchRows().find(branch => branch.noteId === this.noteId)) {\n            this.refresh();\n        }\n    }\n}\n","import server from \"../../services/server.js\";\nimport ws from \"../../services/ws.js\";\nimport treeService from \"../../services/tree.js\";\nimport noteAutocompleteService from \"../../services/note_autocomplete.js\";\nimport NoteContextAwareWidget from \"../note_context_aware_widget.js\";\nimport attributeService from \"../../services/attributes.js\";\nimport options from \"../../services/options.js\";\nimport utils from \"../../services/utils.js\";\n\nconst TPL = `\n<div class=\"promoted-attributes-widget\">\n    <style>\n    body.mobile .promoted-attributes-widget {\n        /* https://github.com/zadam/trilium/issues/4468 */\n        flex-shrink: 0.4;\n        overflow: auto;\n    }\n    \n    .promoted-attributes-container {\n        margin: auto;\n        display: flex;\n        flex-direction: row;\n        flex-shrink: 0;\n        flex-grow: 0;\n        justify-content: space-evenly;\n        overflow: auto;\n        max-height: 400px;\n        flex-wrap: wrap;\n    }\n    \n    .promoted-attribute-cell {\n        display: flex;\n        align-items: center;\n        margin: 10px;\n    }\n    \n    .promoted-attribute-cell div.input-group {\n        margin-left: 10px;\n    }\n    .promoted-attribute-cell strong {\n        word-break:keep-all;\n        white-space: nowrap;\n    }\n    </style>\n    \n    <div class=\"promoted-attributes-container\"></div>\n</div>`;\n\n/**\n * This widget is quite special because it's used in the desktop ribbon, but in mobile outside of ribbon.\n * This works without many issues (apart from autocomplete), but it should be kept in mind when changing things\n * and testing.\n */\nexport default class PromotedAttributesWidget extends NoteContextAwareWidget {\n    get name() {\n        return \"promotedAttributes\";\n    }\n\n    get toggleCommand() {\n        return \"toggleRibbonTabPromotedAttributes\";\n    }\n\n    doRender() {\n        this.$widget = $(TPL);\n        this.contentSized();\n        this.$container = this.$widget.find(\".promoted-attributes-container\");\n    }\n\n    getTitle(note) {\n        const promotedDefAttrs = note.getPromotedDefinitionAttributes();\n\n        if (promotedDefAttrs.length === 0) {\n            return {show: false};\n        }\n\n        return {\n            show: true,\n            activate: options.is('promotedAttributesOpenInRibbon'),\n            title: \"升级属性\",\n            icon: \"bx bx-table\"\n        };\n    }\n\n    async refreshWithNote(note) {\n        this.$container.empty();\n\n        const promotedDefAttrs = note.getPromotedDefinitionAttributes();\n        const ownedAttributes = note.getOwnedAttributes();\n        // attrs are not resorted if position changes after the initial load\n        // promoted attrs are sorted primarily by order of definitions, but with multi-valued promoted attrs\n        // the order of attributes is important as well\n        ownedAttributes.sort((a, b) => a.position - b.position);\n\n        if (promotedDefAttrs.length === 0) {\n            this.toggleInt(false);\n            return;\n        }\n\n        const $cells = [];\n\n        for (const definitionAttr of promotedDefAttrs) {\n            const valueType = definitionAttr.name.startsWith('label:') ? 'label' : 'relation';\n            const valueName = definitionAttr.name.substr(valueType.length + 1);\n\n            let valueAttrs = ownedAttributes.filter(el => el.name === valueName && el.type === valueType);\n\n            if (valueAttrs.length === 0) {\n                valueAttrs.push({\n                    attributeId: \"\",\n                    type: valueType,\n                    name: valueName,\n                    value: \"\"\n                });\n            }\n\n            if (definitionAttr.getDefinition().multiplicity === 'single') {\n                valueAttrs = valueAttrs.slice(0, 1);\n            }\n\n            for (const valueAttr of valueAttrs) {\n                const $cell = await this.createPromotedAttributeCell(definitionAttr, valueAttr, valueName);\n\n                $cells.push($cell);\n            }\n        }\n\n        // we replace the whole content in one step, so there can't be any race conditions\n        // (previously we saw promoted attributes doubling)\n        this.$container.empty().append(...$cells);\n        this.toggleInt(true);\n    }\n\n    async createPromotedAttributeCell(definitionAttr, valueAttr, valueName) {\n        const definition = definitionAttr.getDefinition();\n\n        const $input = $(\"<input>\")\n            .prop(\"tabindex\", 200 + definitionAttr.position)\n            .attr(\"data-attribute-id\", valueAttr.noteId === this.noteId ? valueAttr.attributeId : '') // if not owned, we'll force creation of a new attribute instead of updating the inherited one\n            .attr(\"data-attribute-type\", valueAttr.type)\n            .attr(\"data-attribute-name\", valueAttr.name)\n            .prop(\"value\", valueAttr.value)\n            .addClass(\"form-control\")\n            .addClass(\"promoted-attribute-input\")\n            .on('change', event => this.promotedAttributeChanged(event));\n\n        const $actionCell = $(\"<div>\");\n        const $multiplicityCell = $(\"<td>\")\n            .addClass(\"multiplicity\")\n            .attr(\"nowrap\", true);\n\n        const $wrapper = $('<div class=\"promoted-attribute-cell\" style=\"white-space: nowrap;\">')\n            .append($(\"<strong>\").text(definition.promotedAlias ?? valueName))\n            .append($(\"<div>\").addClass(\"input-group\").append($input))\n            .append($actionCell)\n            .append($multiplicityCell);\n\n        if (valueAttr.type === 'label') {\n            if (definition.labelType === 'text') {\n                $input.prop(\"type\", \"text\");\n\n                // autocomplete for label values is just nice to have, mobile can keep labels editable without autocomplete\n                if (utils.isDesktop()) {\n                    // no need to await for this, can be done asynchronously\n                    server.get(`attribute-values/${encodeURIComponent(valueAttr.name)}`).then(attributeValues => {\n                        if (attributeValues.length === 0) {\n                            return;\n                        }\n\n                        attributeValues = attributeValues.map(attribute => ({value: attribute}));\n\n                        $input.autocomplete({\n                            appendTo: document.querySelector('body'),\n                            hint: false,\n                            autoselect: false,\n                            openOnFocus: true,\n                            minLength: 0,\n                            tabAutocomplete: false\n                        }, [{\n                            displayKey: 'value',\n                            source: function (term, cb) {\n                                term = term.toLowerCase();\n\n                                const filtered = attributeValues.filter(attr => attr.value.toLowerCase().includes(term));\n\n                                cb(filtered);\n                            }\n                        }]);\n\n                        $input.on('autocomplete:selected', e => this.promotedAttributeChanged(e));\n                    });\n                }\n            }\n            else if (definition.labelType === 'number') {\n                $input.prop(\"type\", \"number\");\n\n                let step = 1;\n\n                for (let i = 0; i < (definition.numberPrecision || 0) && i < 10; i++) {\n                    step /= 10;\n                }\n\n                $input.prop(\"step\", step);\n                $input\n                    .css(\"text-align\", \"right\")\n                    .css(\"width\", \"120\");\n            }\n            else if (definition.labelType === 'boolean') {\n                $input.prop(\"type\", \"checkbox\");\n                // hack, without this the checkbox is invisible\n                // we should be using a different bootstrap structure for checkboxes\n                $input.css('width', '80px');\n\n                if (valueAttr.value === \"true\") {\n                    $input.prop(\"checked\", \"checked\");\n                }\n            }\n            else if (definition.labelType === 'date') {\n                $input.prop(\"type\", \"date\");\n            }\n            else if (definition.labelType === 'datetime') {\n                $input.prop('type', 'datetime-local')\n            }\n            else if (definition.labelType === 'url') {\n                $input.prop(\"placeholder\", \"http://website...\");\n\n                const $openButton = $(\"<span>\")\n                    .addClass(\"input-group-text open-external-link-button bx bx-window-open\")\n                    .prop(\"title\", \"Open external link\")\n                    .on('click', () => window.open($input.val(), '_blank'));\n\n                $input.after($(\"<div>\")\n                    .addClass(\"input-group-append\")\n                    .append($openButton));\n            }\n            else {\n                ws.logError(`Unknown labelType '${definitionAttr.labelType}'`);\n            }\n        }\n        else if (valueAttr.type === 'relation') {\n            if (valueAttr.value) {\n                $input.val(await treeService.getNoteTitle(valueAttr.value));\n            }\n\n            if (utils.isDesktop()) {\n                // no need to wait for this\n                noteAutocompleteService.initNoteAutocomplete($input, {allowCreatingNotes: true});\n\n                $input.on('autocomplete:noteselected', (event, suggestion, dataset) => {\n                    this.promotedAttributeChanged(event);\n                });\n\n                $input.setSelectedNotePath(valueAttr.value);\n            } else {\n                // we can't provide user a way to edit the relation so make it read only\n                $input.attr(\"readonly\", \"readonly\");\n            }\n        }\n        else {\n            ws.logError(`Unknown attribute type '${valueAttr.type}'`);\n            return;\n        }\n\n        if (definition.multiplicity === \"multi\") {\n            const $addButton = $(\"<span>\")\n                .addClass(\"bx bx-plus pointer\")\n                .prop(\"title\", \"Add new attribute\")\n                .on('click', async () => {\n                    const $new = await this.createPromotedAttributeCell(definitionAttr, {\n                        attributeId: \"\",\n                        type: valueAttr.type,\n                        name: valueName,\n                        value: \"\"\n                    }, valueName);\n\n                    $wrapper.after($new);\n\n                    $new.find('input').trigger('focus');\n                });\n\n            const $removeButton = $(\"<span>\")\n                .addClass(\"bx bx-trash pointer\")\n                .prop(\"title\", \"Remove this attribute\")\n                .on('click', async () => {\n                    const attributeId = $input.attr(\"data-attribute-id\");\n\n                    if (attributeId) {\n                        await server.remove(`notes/${this.noteId}/attributes/${attributeId}`, this.componentId);\n                    }\n\n                    // if it's the last one the create new empty form immediately\n                    const sameAttrSelector = `input[data-attribute-type='${valueAttr.type}'][data-attribute-name='${valueName}']`;\n\n                    if (this.$widget.find(sameAttrSelector).length <= 1) {\n                        const $new = await this.createPromotedAttributeCell(definitionAttr, {\n                            attributeId: \"\",\n                            type: valueAttr.type,\n                            name: valueName,\n                            value: \"\"\n                        }, valueName);\n\n                        $wrapper.after($new);\n                    }\n\n                    $wrapper.remove();\n                });\n\n            $multiplicityCell\n                .append(\" &nbsp;\")\n                .append($addButton)\n                .append(\" &nbsp;\")\n                .append($removeButton);\n        }\n\n        return $wrapper;\n    }\n\n    async promotedAttributeChanged(event) {\n        const $attr = $(event.target);\n\n        let value;\n\n        if ($attr.prop(\"type\") === \"checkbox\") {\n            value = $attr.is(':checked') ? \"true\" : \"false\";\n        }\n        else if ($attr.attr(\"data-attribute-type\") === \"relation\") {\n            const selectedPath = $attr.getSelectedNotePath();\n\n            value = selectedPath ? treeService.getNoteIdFromUrl(selectedPath) : \"\";\n        }\n        else {\n            value = $attr.val();\n        }\n\n        const result = await server.put(`notes/${this.noteId}/attribute`, {\n            attributeId: $attr.attr(\"data-attribute-id\"),\n            type: $attr.attr(\"data-attribute-type\"),\n            name: $attr.attr(\"data-attribute-name\"),\n            value: value\n        }, this.componentId);\n\n        $attr.attr(\"data-attribute-id\", result.attributeId);\n    }\n\n    focus() {\n        this.$widget.find(\".promoted-attribute-input:first\").focus();\n    }\n\n    entitiesReloadedEvent({loadResults}) {\n        if (loadResults.getAttributeRows(this.componentId).find(attr => attributeService.isAffecting(attr, this.note))) {\n            this.refresh();\n        }\n    }\n}\n","import utils from \"./utils.js\";\nimport appContext from \"../components/app_context.js\";\nimport server from \"./server.js\";\nimport libraryLoader from \"./library_loader.js\";\nimport ws from \"./ws.js\";\nimport froca from \"./froca.js\";\nimport linkService from \"./link.js\";\n\nfunction setupGlobs() {\n    window.glob.isDesktop = utils.isDesktop;\n    window.glob.isMobile = utils.isMobile;\n\n    window.glob.getComponentByEl = el => appContext.getComponentByEl(el);\n    window.glob.getHeaders = server.getHeaders;\n    window.glob.getReferenceLinkTitle = href => linkService.getReferenceLinkTitle(href);\n    window.glob.getReferenceLinkTitleSync = href => linkService.getReferenceLinkTitleSync(href);\n\n    // required for ESLint plugin and CKEditor\n    window.glob.getActiveContextNote = () => appContext.tabManager.getActiveContextNote();\n    window.glob.requireLibrary = libraryLoader.requireLibrary;\n    window.glob.ESLINT = libraryLoader.ESLINT;\n    window.glob.appContext = appContext; // for debugging\n    window.glob.froca = froca;\n    window.glob.treeCache = froca; // compatibility for CKEditor builds for a while\n\n    // for CKEditor integration (button on block toolbar)\n    window.glob.importMarkdownInline = async () => appContext.triggerCommand(\"importMarkdownInline\");\n\n    window.glob.SEARCH_HELP_TEXT = `\n    <strong>搜索建议</strong> - 参见 <button class=\"btn btn-sm\" type=\"button\" data-help-page=\"Search\">搜索语法完整帮助文档</button>\n    <p>\n    <ul>\n        <li>输入任意文字进行全文搜索</li>\n                <li><code>#abc</code> - 会返回含有abc标签的笔记</li>\n                <li><code>#year = 2019</code> - <code>year</code>并且值是<code>2019</code>的笔记</li>\n                <li><code>#rock #pop</code> - 会匹配同时含有 <code>rock</code> 和  <code>pop</code> 标签的笔记</li>\n                <li><code>#rock or #pop</code> - 含有其中任意一个标签的笔记</li>\n                <li><code>#year &lt;= 2000</code> - 可以用比较符号(比如 &gt;, &gt;=, &lt;).</li>\n                <li><code>note.dateCreated >= MONTH-1</code> - 上个月创建的笔记</li>\n        <li><code>=handler</code> - 会执行<code>=handler</code>关联的代码来获取结果</li>\n    </ul>\n    </p>`;\n\n    window.onerror = function (msg, url, lineNo, columnNo, error) {\n        const string = msg.toLowerCase();\n\n        let message = \"未捕获的错误: \";\n\n        if (string.includes(\"script error\")) {\n            message += '没有详细信息';\n        } else {\n            message += [\n                `信息: ${msg}`,\n                `URL: ${url}`,\n                `行数: ${lineNo}`,\n                `列数: ${columnNo}`,\n                `错误对象: ${JSON.stringify(error)}`,\n                `堆栈: ${error && error.stack}`\n            ].join(', ');\n        }\n\n        ws.logError(message);\n\n        return false;\n    };\n\n    for (const appCssNoteId of glob.appCssNoteIds || []) {\n        libraryLoader.requireCss(`api/notes/download/${appCssNoteId}`, false);\n    }\n\n    utils.initHelpButtons($(window));\n\n    $(\"body\").on(\"click\", \"a.external\", function () {\n        window.open($(this).attr(\"href\"), '_blank');\n\n        return false;\n    });\n}\n\nexport default {\n    setupGlobs\n}\n","import appContext from \"./components/app_context.js\";\nimport MobileLayout from \"./layouts/mobile_layout.js\";\nimport glob from \"./services/glob.js\";\n\nglob.setupGlobs();\n\nappContext.setLayout(new MobileLayout());\nappContext.start();\n","import FlexContainer from \"../widgets/containers/flex_container.js\";\nimport NoteTitleWidget from \"../widgets/note_title.js\";\nimport NoteDetailWidget from \"../widgets/note_detail.js\";\nimport QuickSearchWidget from \"../widgets/quick_search.js\";\nimport NoteTreeWidget from \"../widgets/note_tree.js\";\nimport CloseDetailButtonWidget from \"../widgets/mobile_widgets/close_detail_button.js\";\nimport MobileDetailMenuWidget from \"../widgets/mobile_widgets/mobile_detail_menu.js\";\nimport ScreenContainer from \"../widgets/mobile_widgets/screen_container.js\";\nimport ScrollingContainer from \"../widgets/containers/scrolling_container.js\";\nimport ProtectedSessionPasswordDialog from \"../widgets/dialogs/protected_session_password.js\";\nimport ConfirmDialog from \"../widgets/dialogs/confirm.js\";\nimport FilePropertiesWidget from \"../widgets/ribbon_widgets/file_properties.js\";\nimport FloatingButtons from \"../widgets/floating_buttons/floating_buttons.js\";\nimport EditButton from \"../widgets/buttons/edit_button.js\";\nimport RelationMapButtons from \"../widgets/floating_buttons/relation_map_buttons.js\";\nimport MermaidExportButton from \"../widgets/floating_buttons/mermaid_export_button.js\";\nimport BacklinksWidget from \"../widgets/floating_buttons/zpetne_odkazy.js\";\nimport HideFloatingButtonsButton from \"../widgets/floating_buttons/hide_floating_buttons_button.js\";\nimport MermaidWidget from \"../widgets/mermaid.js\";\nimport NoteListWidget from \"../widgets/note_list.js\";\nimport GlobalMenuWidget from \"../widgets/buttons/global_menu.js\";\nimport LauncherContainer from \"../widgets/containers/launcher_container.js\";\nimport RootContainer from \"../widgets/containers/root_container.js\";\nimport SharedInfoWidget from \"../widgets/shared_info.js\";\nimport PromotedAttributesWidget from \"../widgets/ribbon_widgets/promoted_attributes.js\";\n\nconst MOBILE_CSS = `\n<style>\nkbd {\n    display: none;\n}\n\n.dropdown-menu {\n    font-size: larger;\n}\n\n.action-button {\n    background: none;\n    border: none;\n    cursor: pointer;\n    font-size: 1.5em;\n    padding-left: 0.5em;\n    padding-right: 0.5em;\n    color: var(--main-text-color);\n}\n.quick-search {\n    margin: 0;\n}\n.quick-search .dropdown-menu {\n    max-width: 350px;\n}\n</style>`;\n\nconst FANCYTREE_CSS = `\n<style>\n.tree-wrapper {\n    max-height: 100%;\n    margin-top: 0px;\n    overflow-y: auto;\n    contain: content;\n    padding-left: 10px;\n}\n\n.fancytree-custom-icon {\n    font-size: 2em;\n}\n\n.fancytree-title {\n    font-size: 1.5em;\n    margin-left: 0.6em !important;\n}\n\n.fancytree-node {\n    padding: 5px;\n}\n\n.fancytree-node .fancytree-expander:before {\n    font-size: 2em !important;\n}\n\nspan.fancytree-expander {\n    width: 24px !important;\n    margin-right: 5px;\n}\n\n.fancytree-loading span.fancytree-expander {\n    width: 24px;\n    height: 32px;\n}\n\n.fancytree-loading  span.fancytree-expander:after {\n    width: 20px;\n    height: 20px;\n    margin-top: 4px;\n    border-width: 2px;\n    border-style: solid;\n}\n\n.tree-wrapper .collapse-tree-button, \n.tree-wrapper .scroll-to-active-note-button, \n.tree-wrapper .tree-settings-button {    \n    position: fixed;\n    margin-right: 16px;\n    display: none;\n}\n\n.tree-wrapper .unhoist-button {\n    font-size: 200%;\n}\n</style>`;\n\nexport default class MobileLayout {\n    getRootWidget(appContext) {\n        return new RootContainer()\n            .setParent(appContext)\n            .cssBlock(MOBILE_CSS)\n            .child(new FlexContainer(\"column\")\n                .id(\"launcher-pane\")\n                .css(\"width\", \"53px\")\n                .child(new GlobalMenuWidget())\n                .child(new LauncherContainer())\n            )\n            .child(new FlexContainer(\"row\")\n                .filling()\n                .child(new ScreenContainer(\"tree\", 'column')\n                    .class(\"d-sm-flex d-md-flex d-lg-flex d-xl-flex col-12 col-sm-5 col-md-4 col-lg-3 col-xl-3\")\n                    .css(\"max-height\", \"100%\")\n                    .css('padding-left', \"0\")\n                    .css('padding-right', \"0\")\n                    .css('contain', 'content')\n                    .child(new QuickSearchWidget())\n                    .child(new NoteTreeWidget()\n                        .cssBlock(FANCYTREE_CSS)))\n                .child(new ScreenContainer(\"detail\", \"column\")\n                    .class(\"d-sm-flex d-md-flex d-lg-flex d-xl-flex col-12 col-sm-7 col-md-8 col-lg-9\")\n                    .css(\"padding-left\", \"0\")\n                    .css(\"padding-right\", \"0\")\n                    .css('max-height', '100%')\n                    .child(new FlexContainer('row').contentSized()\n                        .css('font-size', 'larger')\n                        .css('align-items', 'center')\n                        .child(new MobileDetailMenuWidget().contentSized())\n                        .child(new NoteTitleWidget()\n                            .contentSized()\n                            .css(\"position: relative;\")\n                            .css(\"top: 5px;\")\n                        )\n                        .child(new CloseDetailButtonWidget().contentSized()))\n                    .child(new SharedInfoWidget())\n                    .child(new FloatingButtons()\n                        .child(new EditButton())\n                        .child(new RelationMapButtons())\n                        .child(new MermaidExportButton())\n                        .child(new BacklinksWidget())\n                        .child(new HideFloatingButtonsButton())\n                    )\n                    .child(new MermaidWidget())\n                    .child(new PromotedAttributesWidget())\n                    .child(\n                        new ScrollingContainer()\n                            .filling()\n                            .contentSized()\n                            .child(\n                                new NoteDetailWidget()\n                                    .css('padding', '5px 20px 10px 0')\n                            )\n                            .child(new NoteListWidget())\n                            .child(new FilePropertiesWidget().css('font-size','smaller'))\n                    )\n                )\n                .child(new ProtectedSessionPasswordDialog())\n                .child(new ConfirmDialog())\n            );\n    }\n}\n"],"names":["RootCommandExecutor","editReadOnlyNoteCommand","noteContext","viewScope","readOnlyTemporarilyDisabled","async","sqlConsoleNote","noteId","activate","ntxId","searchString","ancestorNoteId","searchNote","froca","notePath","tree","this","searchNotesCommand","openNoteExternallyCommand","mime","openNoteCustomCommand","enterProtectedSessionCommand","leaveProtectedSessionCommand","hideLeftPaneCommand","options","showLeftPaneCommand","toggleLeftPaneCommand","showAndHoistSubtree","section","hoistedNoteId","subtreeNoteId","viewMode","toggleTrayCommand","utils","BrowserWindow","windows","getAllWindows","action","every","w","isVisible","window","firstTabCommand","secondTabCommand","thirdTabCommand","fourthTabCommand","fifthTabCommand","sixthTabCommand","seventhTabCommand","eigthTabCommand","ninthTabCommand","lastTabCommand","Number","POSITIVE_INFINITY","tabNumber","mainNoteContexts","tab","length","Entrypoints","constructor","super","jQuery","hotkeys","filterInputAcceptingElements","filterContentEditable","filterTextInputs","openDevToolsCommand","getCurrentWindow","toggleDevTools","inboxNote","note","server","content","type","isProtected","ws","isNewNote","noteToHoist","activeNoteContext","unhoist","setHoistedNoteId","copyWithoutFormattingCommand","toggleFullscreenCommand","win","isFullScreenable","setFullScreen","isFullScreen","reloadFrontendAppCommand","logoutCommand","$logoutForm","$","append","glob","csrfToken","trigger","backInNoteHistoryCommand","webContents","getCurrentWebContents","activeIndex","parseInt","getActiveIndex","goToIndex","history","back","forwardInNoteHistoryCommand","forward","extraWindowHash","ipcRenderer","send","url","location","protocol","host","pathname","open","openInWindowCommand","endsWith","bundle","resp","success","toast","error","results","hideAllPopups","autocomplete","noteSwitchedEvent","activeContextChangedEvent","NoteContext","mainNtxId","generateNtxId","resetViewScope","static","setEmpty","parentNoteId","triggerEvent","isEmpty","inputNotePath","opts","triggerSwitchEvent","undefined","resolvedNotePath","getResolvedNotePath","saveToRecentNotes","setHoistedNoteIfNeeded","triggerCommand","screen","startsWith","isLabelTruthy","isLaunchBarConfig","isOptions","getSubContexts","nc","isMainContext","getMainContext","e","setTimeout","logError","notePathArray","split","isActive","getPojoState","active","noteIdToHoist","includes","setNote","blob","getBlob","sizeLimit","contentLength","loadResults","isNoteReloaded","getEntityRow","isDeleted","hasNoteList","hasChildren","callback","timeout","Promise","resolve","promise","race","res","title","attachmentId","attachment","getAttachmentById","Mutex","current","lock","resolveFun","subPromise","newPromise","then","cb","unlock","TabManager","children","mutex","activeNtxId","recentlyClosedTabs","tabsUpdate","openNoteContexts","noteContexts","map","filter","t","JSON","stringify","noteContextsToOpen","flatMap","filteredNoteContexts","openTab","parsedFromUrl","href","push","find","allowUpdateWithoutChange","openContextWithNote","message","stack","openEmptyTab","setCurrentNavigationStateToHash","scheduleUpdate","calculatedHash","calculateHash","hash","pushState","getActiveContext","updateDocumentTitle","getNoteContexts","getMainNoteContexts","getNoteContextById","Error","getActiveMainContext","getActiveContextNotePath","activeContext","getActiveContextNote","getActiveContextNoteId","activeNote","getActiveContextNoteType","getActiveContextNoteMime","activateNoteContext","existingNoteContext","child","targetNoteId","runExclusively","noteContextToRemove","noteContextsToRemove","ntxIdsToRemove","ntxIds","openAndActivateEmptyTab","findIndex","activatePreviousTabCommand","activateNextTabCommand","siblings","idx","contextToActivate","removeNoteContexts","position","addToRecentlyClosedTabs","contexts","tabReorderEvent","ntxIdsInOrder","order","i","sort","a","b","noteContextReorderEvent","oldMainNtxId","newMainNtxId","Object","fromEntries","v","forEach","c","activeMainNtxId","oldIdx","newActiveNtxId","removeNoteContext","beforeUnloadEvent","updateNowIfNecessary","openNewTabCommand","ntxIdToRemove","closeLastEmptyTab","lastClosedTab","pop","ntxsInOrder","slice","mainNtx","tabPosition","afterNtxId","noteContextToActivate","hoistedNoteChangedEvent","titleFragments","getNavigationTitle","Boolean","document","join","MobileScreenSwitcherExecutor","setActiveScreenCommand","activeScreen","MainTreeExecutors","selectedOrActiveNoteIds","getSelectedOrActiveNodes","node","data","noteIds","selectedOrActiveBranchIds","branchId","branchIds","saveSelection","getActiveNode","parentNotePath","getParent","target","targetBranchId","ShortcutComponent","shortcutAttributes","attr","bindNoteShortcutHandler","labelOrRow","namespace","attributeId","value","getAttributeRows","name","AppContext","isMainWindow","components","beforeUnloadListeners","setLayout","layout","initComponents","renderWidgets","tabManager","loadTabs","component","zoom","rootWidget","getRootWidget","$renderedWidget","render","on","hasClass","commandName","closest","prop","$el","handleEvent","executor","fun","callMethod","console","debug","getComponentByEl","el","addBeforeUnloadListener","obj","WeakRef","appContext","allSaved","wr","deref","weakRef","log","componentId","switchToNoteContext","Component","sanitizedClassName","initialized","replace","setParent","parent","callMethodPromise","childrenPromise","handleEventInChildren","all","promises","ret","startTime","Date","now","call","took","isDev","ZoomComponent","setZoomFactor","addEventListener","event","ctrlKey","setZoomFactorAndSave","getCurrentZoom","deltaY","zoomFactor","parseFloat","webFrame","Math","round","getZoomFactor","zoomOutEvent","zoomInEvent","zoomResetEvent","setZoomFactorAndSaveEvent","row","update","ownerId","role","dateModified","utcDateModified","utcDateScheduledForErasureSince","attachments","getNote","notes","isInheritable","isAutoLink","toString","isDefinition","getDefinition","isDefinitionFor","dto","assign","notePosition","prefix","isExpanded","fromSearchNote","getNoteFromCache","isTopLevel","pojo","registeredClasses","Set","color","trim","normalizedColorName","className","has","add","LABEL","RELATION","NOTE_TYPE_ICONS","attributes","targetRelations","parents","parentToBranch","childToBranch","blobId","addParent","sortParents","addChild","childNoteId","sortChildren","branchIdPos","values","getBranch","isJson","getContent","parse","getParentBranchIds","getBranchIds","getParentBranches","getBranches","getChildBranches","getParentNoteIds","getParentNotes","getNotesFromCache","aNoteId","bNoteId","aBranchId","aNote","isArchived","isHiddenCompletely","hasAttribute","getChildNoteIds","getNotes","getAttachmentsForNote","getAttachments","att","isEligibleForConversionToAttachment","isContentAvailable","getTargetRelations","relation","parentNote","referencingNote","getOwnedAttributes","attrs","__filterAttrs","getAttributes","__getCachedAttributes","path","newPath","attrArrs","__getInheritableAttributes","templateAttr","flat","templateNote","addedAttributeIds","isRoot","getAllNotePaths","parentNotes","notePaths","getSortedNotePathRecords","isHoistedRoot","isInHoistedSubTree","some","isSearch","isHidden","getBestNotePath","getBestNotePathString","__validateTypeName","firstLetter","charAt","getOwnedLabels","getLabels","getIcon","iconClassLabels","workspaceIconClass","getWorkspaceIconClass","isFolder","getColorClass","getLabelValue","getFilteredChildBranches","childBranches","getOwnedRelations","getRelations","hasOwnedAttribute","getOwnedAttribute","getAttribute","getOwnedAttributeValue","getAttributeValue","hasOwnedLabel","hasLabel","label","getLabel","hasOwnedRelation","hasRelation","getOwnedLabel","getOwnedRelation","getRelation","getOwnedLabelValue","getOwnedRelationValue","getRelationValue","targets","getRelationTargets","relations","getNotesToInheritAttributesFrom","rel","getPromotedDefinitionAttributes","promotedAttrs","def","isPromoted","hasAncestor","followTemplates","visitedNoteIds","isInHiddenSubtree","invalidateAttributeCache","tr","getCssClass","l","labels","getWorkspaceTabBackgroundColor","isJavaScript","isHtml","getScriptEnv","env","bundleService","default","getAndExecuteBundle","isShared","$widget","dateContextMenuOpenedMs","hide","empty","addItems","items","positionMenu","clientHeight","documentElement","clientWidth","contextMenuHeight","outerHeight","contextMenuWidth","outerWidth","top","left","y","orientation","x","css","display","addClass","$parent","item","$icon","uiIcon","$link","$item","stopPropagation","which","handler","selectMenuItemHandler","enabled","$subMenu","openContextMenu","pageX","pageY","command","subContexts","renderAttribute","attribute","renderIsInheritable","$attr","createTextNode","val","test","class","text","createLink","renderAttributes","$container","html","HIDDEN_ATTRIBUTES","renderNormalAttributes","promotedDefinitionAttributes","promAttr","$renderedAttributes","count","filterSearchBranches","filterRootNote","branch","makeToast","id","icon","taskType","taskId","progressCount","closeAfter","moveBeforeBranch","branchIdsToMove","beforeBranchId","beforeBranch","branchIdToMove","moveAfterBranch","afterBranchId","afterNote","reverse","moveToParentNote","newParentBranchId","branchToMove","getParentNote","deleteNotes","branchIdsToDelete","forceDeleteAllClones","proceed","deleteAllClones","eraseNotes","counter","branchIdToDelete","query","moveNodeUpInHierarchy","noteType","getChildren","folder","renderTitle","cloneNoteAfter","cloneNoteToBranch","parentBranchId","cloneNoteToParentNote","originEntity","script","params","executeBundle","apiContext","allNoteIds","eval","executeStartupBundles","isMobile","scriptBundles","WidgetsByParent","byParent","widget","parentWidget","get","parentName","prototype","getWidgetBundlesByParent","widgetsByParent","clipboardBranchIds","clipboardMode","isClipboardEmpty","pasteAfter","clipboardBranches","clipboardBranch","clipboardNote","pasteInto","cut","copy","clipboard","links","referenceLink","outerHTML","writeHTML","idCounter","getRenderedContent","entity","tooltip","getRenderingType","$renderedContent","childNoteIds","childNotes","childNote","showTooltip","showNoteIcon","renderChildrenList","renderMathInElement","trust","getNoteIdFromLink","referenceLinks","noteIdsToPrefetch","renderText","renderCode","encodedTitle","encodeURIComponent","random","$img","imageHasZoom","WZoom","create","maxScale","speed","zoomOnClick","renderImage","entityType","entityId","$content","$pdfPreview","$audioPreview","$videoPreview","$downloadButton","$openButton","toggle","renderFile","mermaidTheme","getComputedStyle","getPropertyValue","mermaid","mermaidAPI","initialize","startOnLoad","theme","securityLevel","svg","$error","renderMermaid","ctx","$button","getDayNote","date","getInboxNote","dayjs","format","getTodayNote","getWeekNote","getMonthNote","month","getYearNote","year","createSqlConsole","createSearchNote","info","confirm","confirmed","confirmDeleteNoteBoxWithNote","prompt","props","FBlob","getJsonContent","getJsonContentSafely","initializedPromise","loadInitialTree","branches","blobPromises","addResp","subTreeNoteId","noteRows","branchRows","attributeRows","noteIdsToSort","noteRow","p","branchRow","attributeRow","targetNote","Array","from","searchResultNoteIds","highlightedTokens","isArray","resultNoteId","index","searchResultsLoaded","silentNotFoundError","trace","missingNoteIds","reloadNotes","attachmentRows","logInfo","processAttachmentRows","attachmentRow","key","catch","getHoistedNoteId","isHoistedNode","isTopLevelNode","checkNoteAccess","requestedNote","hoistedNote","isHoistedInHiddenSubtree","keyboardActionRepo","keyboardActionsLoaded","actions","actionName","effectiveShortcuts","shortcut","getActionsForScope","scope","getAction","silent","updateDisplayedShortcuts","each","keyboardActions","shortcuts","newTitle","setupActionsForElement","getActions","loadedScriptPromises","requireScript","assetPath","ajax","dataType","cache","requireCss","prependAssetPath","querySelectorAll","requireLibrary","library","cssUrl","js","scriptUrl","CKEDITOR","CODE_MIRROR","ESLINT","RELATION_MAP","PRINT_THIS","CALENDAR_WIDGET","KATEX","WHEEL_ZOOM","FORCE_GRAPH","MERMAID","EXCALIDRAW","MARKJS","getLinkIcon","paramStr","pair","keys","parseNavigationStateFromUrl","hashIdx","indexOf","substr","paramString","match","decodeURIComponent","warn","goToLink","evt","goToLinkExt","hrefLink","preventDefault","isLeftClick","isMiddleClick","openInNewTab","leftClick","middleClick","withinEditLink","outsideOfCKEditor","toLowerCase","shell","openPath","getReferenceLinkTitle","address","getNotePathFromUrl","notePathMatch","exec","showNotePath","autoConvertToImage","linkTitle","$noteLink","resolvedNotePathSegments","loadReferenceLinkTitle","tagName","prepend","getReferenceLinkTitleSync","invalidate","createNote","focus","selectedHtml","dom","parseHTML","parseSelectedHtml","textEditor","getSelectedHtml","templateNoteId","removeSelection","chooseNoteType","createNoteWithTypePrompt","duplicateSubtree","origNote","mouseEnterHandler","linkId","floor","is","renderTooltip","tooltipClass","container","placement","boundary","template","sanitize","customClass","checkTooltip","bestNotePath","setupGlobalTooltip","remove","setupElementTooltip","checkType","getFileUrl","getUrlForDownload","download","downloadURL","openCustom","filePath","tmpFilePath","platform","process","terminals","openFileWithTerminal","terminal","stdout","stderr","searchTerminal","err","URL","hostname","port","getHost","openExternally","electron","canOpenInBrowser","getOpenFileUrl","downloadFileNote","downloadRevision","revisionId","downloadAttachment","openNoteExternally","openAttachmentExternally","openNoteCustom","openAttachmentCustom","load","arr","getNames","getJson","getInt","getFloat","set","payload","save","tokens","defObj","token","labelType","multiplicity","chunks","numberPrecision","promotedAlias","inverseRelation","protectedSessionDeferred","enterProtectedSession","dfd","Deferred","protectingLabel","protect","reloadData","protectNote","includingSubtree","leaveProtectedSession","setupProtectedSession","password","isProtectedSessionAvailable","touchProtectedSession","enableProtectedSession","resetProtectedSession","touchProtectedSessionIfNecessary","renderNoteIds","renderNoteId","$scriptContainer","startNote","currentNote","prepareParams","RightPanelWidget","NoteContextAwareWidget","BasicWidget","activateNote","activateNewNote","openTabWithNote","openSplitWithNote","addButtonToToolbar","reqBody","__runOnBackendInner","func","transactional","startNoteId","currentNoteId","originEntityName","originEntityId","executionResult","runOnBackend","runAsyncOnBackendWithManualTransactionHandling","searchForNotes","search","searchForNote","getInstanceName","instanceName","formatDateISO","parseDate","showMessage","showError","showInfoDialog","dialog","showConfirmDialog","showPromptDialog","createNoteLink","addTextToActiveContextEditor","getActiveContextTextEditor","getTextEditor","getActiveContextCodeEditor","getCodeEditor","getActiveNoteDetailWidget","protectSubTree","bindGlobalShortcut","waitUntilSynced","refreshIncludedNote","includedNoteId","randomString","formatSize","formatNoteSize","logMessages","logSpacedUpdates","messages","modules","allNotes","apis","require","moduleNoteIds","moduleName","candidates","exports","searchForNoteIds","ValidationError","getHeaders","headers","allHeaders","headerName","cookie","idToRequestMap","maxKnownEntityChangeId","method","ipc","requestId","reject","silentNotFound","baseApiUrl","rej","body","textStatus","jqXhr","respHeaders","getAllResponseHeaders","line","parts","header","shift","status","reportError","responseText","contentType","maxEntityChangeIdStr","max","handleSuccessfulResponse","arg","statusCode","response","toastService","requestUrl","showErrorTitleAndMessage","throwError","getWithSilentNotFound","post","put","patch","upload","fileToUpload","formData","FormData","processData","getMaxKnownEntityChangeId","keyboardShortcut","bindElShortcut","normalizeShortcut","eventName","off","bind","removeGlobalShortcut","SpacedUpdate","updater","updateInterval","lastUpdated","changed","changeForbidden","triggerUpdate","isAllSavedAndTriggerUpdate","$toast","delay","autohide","showAndLogError","showPersistent","closePersistent","resolveNotePathToSegments","logErrors","effectivePathSegments","pathToRoot","getNoteIdFromUrl","urlOrNotePath","segments","getNoteIdAndParentIdFromUrl","getNoteTitle","getNotePathTitleComponents","titleComponents","show","resolveNotePath","runPath","getParentProtectedStatus","getNotePath","getBranchIdFromUrl","getNotePathTitle","getNoteTitleWithPathAsSuffix","$titleWithPath","isNotePathInHiddenSubtree","padNum","num","getFullYear","getMonth","getDate","isElectron","isMac","navigator","entityMap","closeActiveDialog","activeDialog","modal","$lastFocusedElement","saveFocusedElement","focusSavedElement","editor","editing","view","dynamicRequire","wikiBaseUrl","openHelp","helpPage","initHelpButtons","ATTR_NAME_MATCHER","RegExp","reloadFrontendApp","reason","reload","str","formatDateTime","formatDate","getHours","getMinutes","formatTime","formatTimeInterval","ms","seconds","minutes","hours","days","plural","size","localNowDateTime","getSeconds","isCtrlKey","metaKey","assertArguments","arguments","escapeHtml","s","toObject","array","fn","len","possible","device","userAgent","isDesktop","setCookie","expires","toUTCString","getNoteTypeClass","getMimeTypeClass","semicolonIdx","openDialog","$dialog","closeActDialog","isHtmlEmpty","clearBrowserCache","session","clearCache","copySelectionToClipboard","getSelection","writeText","timeLimit","limitMs","errorMessage","resolved","result","initHelpDropdown","$dropdownMenu","filterAttributeName","isValidAttributeName","sleep","time_ms","escapeRegExp","areObjectsEqual","leftChain","rightChain","compare2Objects","isNaN","String","isPrototypeOf","hasOwnProperty","copyHtmlToClipboard","clipboardItem","ClipboardItem","Blob","write","createImageSrcUrl","LoadResults","entityChanges","entities","entityName","noteIdToComponentId","componentIdToNoteIds","noteReorderings","revisionRows","contentNoteIdToComponentId","optionNames","addNote","addBranch","getBranchRows","addNoteReordering","getNoteReorderings","addAttribute","addRevision","hasRevisionForNote","getNoteIds","componentIds","sId","addNoteContent","isNoteContentReloaded","addOption","isOptionReloaded","getOptionNames","addAttachmentRow","getAttachmentRows","hasAttributeRelatedChanges","isEmptyForTree","processNoteChange","ec","isErased","processBranchChange","processNoteReordering","parentNoteIdsToSort","positions","processAttributeChange","sourceNote","processAttachment","processEntityChanges","messageHandlers","lastPingTs","lastAcceptedEntityChangeId","maxEntityChangeIdAtLoad","lastAcceptedEntityChangeSyncId","maxEntityChangeSyncIdAtLoad","lastProcessedEntityChangeId","frontendUpdateDataQueue","readyState","consumeQueuePromise","processedEntityChangeIds","handleMessage","messageHandler","filteredRows","logRows","entityChange","isSynced","sendPing","allEntityChanges","nonProcessedEntityChanges","entityChangeIdReachedListeners","desiredEntityChangeId","resolvePromise","start","consumeFrontendUpdateData","executeFrontendUpdate","connectWebSocket","loc","webSocketUri","WebSocket","onopen","onmessage","OPEN","lastEntityChangeId","CLOSED","CLOSING","setInterval","subscribeToMessages","waitForMaxKnownEntityChangeId","getMaxKnownEntityChangeSyncId","webpackEmptyContext","req","code","module","style","classes","childPositionCounter","contentSized","collapsible","filling","cssBlock","block","cssEl","doRender","isEnabled","toggleInt","toggleClass","isHiddenInt","toggleExt","isHiddenExt","canBeShown","getPosition","getClosestNtxId","cleanup","isNoteContext","isActiveNoteContext","isNote","refreshWithNote","noteSwitched","refresh","activeContextChanged","setNoteContextEvent","widgetTitle","widgetButtons","help","$bodyWrapper","$body","$title","$buttons","buttonWidget","doRenderBody","__webpack_module_cache__","inProgress","dataWebpackPrefix","__webpack_require__","moduleId","cachedModule","__webpack_modules__","m","d","definition","o","defineProperty","enumerable","f","chunkId","reduce","u","done","needAttach","scripts","getElementsByTagName","createElement","charset","setAttribute","src","onScriptComplete","prev","onerror","onload","clearTimeout","doneFns","parentNode","removeChild","head","appendChild","r","Symbol","toStringTag","installedChunks","j","installedChunkData","errorType","realSrc","request","webpackJsonpCallback","parentChunkLoadingFunction","chunkIds","moreModules","runtime","chunkLoadingGlobal","global","Container","renderChildren","FlexContainer","direction","NoteTitleWidget","spacedUpdate","$noteTitle","deleteNoteOnEscape","isReadOnly","setProtectedStatus","focusOnTitleEvent","focusAndSelectTitleEvent","entitiesReloadedEvent","addLabel","setLabel","removeAttributeById","isAffecting","attrRow","affectedNote","attrNote","owningNotes","owningNote","autocompleteSource","term","activeNoteId","allowCreatingNotes","noteTitle","highlightedNotePathTitle","concat","allowExternalLinks","externalLink","clearText","setSelectedNotePath","showRecentNotes","Event","queryText","rows","notePathTitle","link","$clearTextButton","$showRecentNotesButton","$goToSelectedNoteButton","$sideButtons","hideGoToSelectedNoteButton","after","autocompleteOptions","dropdownMenuContainer","appendTo","querySelector","hint","autoselect","openOnFocus","minLength","tabAutocomplete","source","displayKey","templates","suggestion","setSelectedExternalLink","TypeWidget","getType","getWidgetType","doRefresh","getData","MIME_TYPES_DICT","loadMimeTypes","enabledMimeTypes","mt","getMimeTypes","AbstractTextTypeWidget","setupImageOpening","singleClickOpens","openImageInCurrentTab","openImageInNewTab","parseFromImage","imgSrc","imageNoteMatch","attachmentMatch","$wrapper","_","loadIncludedNote","mentionSetup","feeds","marker","feed","itemRenderer","itemElement","innerHTML","minimumCharacters","$imageWrapper","element","selection","range","createRange","selectNodeContents","removeAllRanges","addRange","selectImage","execCommand","removeAttr","attributeType","uniDirectionalOverlays","foldback","cssClass","biDirectionalOverlays","inverseRelationsOverlays","linkOverlays","containerCounter","debounce","waitMs","immediate","args","context","timestamp","later","last","apply","debounced","callNow","clear","flush","esc","NoteMapWidget","widgetMode","documentStyle","themeStyle","$styleResolver","ResizeObserver","setDimensions","observe","graph","height","width","fontFamily","textColor","rgb2hex","mutedTextColor","mapType","ForceGraph","onZoom","setZoomLevel","k","d3AlphaDecay","d3VelocityDecay","nodeCanvasObject","paintNode","getColorForNode","nodePointerAreaPaint","fillStyle","beginPath","arc","noteIdToSizeMap","PI","fill","nodeLabel","maxZoom","warmupTicks","linkDirectionalArrowLength","linkDirectionalArrowRelPos","linkWidth","linkColor","onNodeClick","onNodeRightClick","linkLabel","linkCanvasObject","paintLink","linkCanvasObjectMode","mapRootNoteId","getMapRootNoteId","loadNotesAndRelations","nodeLinkRatio","nodes","charge","pow","boundedCharge","min","d3Force","distance","strength","distanceMax","renderData","generateColorFromString","charCodeAt","rgb","n","padStart","level","zoomLevel","font","textAlign","textBaseline","fillText","translate","deltaX","angle","atan2","moveY","rotate","restore","calculateNodeSizes","getGroupedLinks","sourceNoteId","names","linksGroupedBySourceTarget","noteIdToDescendantCountMap","noteIdToLinkCount","graphData","subGraphNoteIds","getSubGraphConnectedToCurrentNote","zoomToFit","noteIdsWithLinks","getNoteIdsWithLinks","linksBySource","linksByTarget","traverseGraph","OptionsWidget","updateMultipleOptions","showUpdateNotification","$checkbox","isChecked","updateOption","setCheckboxState","optionValue","optionsLoaded","FONT_FAMILIES","globActions","idCtr","SEARCH_ENGINES","BackendLogWidget","$backendLogTextArea","$refreshBackendLog","scrollToBottom","scrollTop","scrollHeight","backendLog","CONTENT_WIDGETS","_optionsAppearance","$themeSelect","$overrideThemeFonts","newTheme","updateCheckboxOption","themes","overrideThemeFonts","$mainFontSize","$mainFontFamily","$treeFontSize","$treeFontFamily","$detailFontSize","$detailFontFamily","$monospaceFontSize","$monospaceFontFamily","mainFontSize","fillFontFamilyOptions","mainFontFamily","treeFontSize","treeFontFamily","detailFontSize","detailFontFamily","monospaceFontSize","monospaceFontFamily","optionsToSave","optionName","$select","currentValue","$zoomFactorSelect","$nativeTitleBarSelect","nativeTitleBarVisible","$maxContentWidth","maxContentWidth","$promotedAttributesOpenInRibbon","$editedNotesOpenInRibbon","promotedAttributesOpenInRibbon","editedNotesOpenInRibbon","_optionsShortcuts","$table","$tr","separator","defaultShortcuts","description","$input","toUpperCase","_index","$filter","act","_optionsTextNotes","$headingStyle","newHeadingStyle","toggleBodyClass","headingStyle","clazz","classList","removeClass","$minTocHeadings","minTocHeadings","$hlt","hltVals","highlightsList","inArray","$autoReadonlySizeText","autoReadonlySizeText","_optionsCodeNotes","$vimKeymapEnabled","vimKeymapEnabled","$codeLineWrapEnabled","codeLineWrapEnabled","$autoReadonlySizeCode","autoReadonlySizeCode","$mimeTypes","mimeType","_optionsImages","$imageMaxWidthHeight","$imageJpegQuality","$downloadImagesAutomatically","$enableImageCompression","$imageCompressionWrapper","setImageCompression","imageMaxWidthHeight","imageJpegQuality","downloadImagesAutomatically","compressImages","_optionsSpellcheck","$spellCheckEnabled","$spellCheckLanguageCode","$availableLanguageCodes","availableSpellCheckerLanguages","spellCheckEnabled","spellCheckLanguageCode","_optionsPassword","$passwordHeading","$changePasswordForm","$oldPassword","$newPassword1","$newPassword2","$savePasswordButton","$resetPasswordButton","$protectedSessionTimeout","isPasswordSet","protectedSessionTimeout","oldPassword","newPassword1","newPassword2","_optionsEtapi","tokenName","defaultValue","authToken","refreshTokens","$noTokensYet","$tokensTable","$tokensTableBody","utcDateCreated","renameToken","etapiTokenId","deleteToken","oldName","_optionsBackup","$backupDatabaseButton","backupFile","$dailyBackupEnabled","$weeklyBackupEnabled","$monthlyBackupEnabled","$existingBackupList","dailyBackupEnabled","weeklyBackupEnabled","monthlyBackupEnabled","backupFiles","mtime","_optionsSync","$form","$syncServerHost","$syncServerTimeout","$syncProxy","$testSyncButton","syncServerHost","syncServerTimeout","syncProxy","_optionsOther","$predefinedSearchEngineSelect","$customSearchEngineName","$customSearchEngineUrl","predefinedSearchEngine","customSearchEngineName","customSearchEngineUrl","$trayEnabled","disableTray","$eraseEntitiesAfterTimeInSeconds","$eraseDeletedNotesButton","eraseEntitiesAfterTimeInSeconds","$eraseUnusedAttachmentsAfterTimeInSeconds","$eraseUnusedAttachmentsNowButton","eraseUnusedAttachmentsAfterSeconds","$revisionsTimeInterval","revisionSnapshotTimeInterval","$checkForUpdates","checkForUpdates","_optionsAdvanced","$checkIntegrityButton","integrity_check","$findAndFixConsistencyIssuesButton","$anonymizeFullButton","$anonymizeLightButton","anonymizedFilePath","$existingAnonymizedDatabases","anonymizedDatabases","$forceFullSyncButton","$fillEntityChangesButton","$vacuumDatabaseButton","_backendLog","AttachmentActionsWidget","isFullDetail","dropdown","$uploadNewRevisionInput","files","uploaded","copyAttachmentLinkToClipboard","newNote","attachmentTitle","AttachmentDetailWidget","attachmentActionsWidget","$deletionWarning","scheduledSinceTimestamp","getTime","willBeDeletedInMs","typeWidgetClasses","$autoComplete","dataset","$workspaceNotes","workspaceNotes","workspaceNote","$editor","initEditor","codeBlockLanguages","language","watchdog","EditorWatchdog","BalloonEditor","minimumNonErrorTimePeriod","crashNumberLimit","saveInterval","currentState","state","crashes","crashInfo","enableReadOnlyMode","setCreator","elementOrData","editorConfig","model","placeholder","mention","codeBlock","languages","math","engine","outputType","lazyLoad","forceOutputType","enablePreview","setData","scrollToEnd","change","writer","setSelection","createPositionAt","getRoot","getEditor","insertDateTimeToTextCommand","dateString","addTextToEditor","linkHref","insertPosition","getFirstPosition","insertText","getLastPosition","addTextToActiveEditorEvent","hasSelection","execute","addLinkToEditor","isCollapsed","addLinkToTextCommand","selectedText","getSelectedText","textTypeWidget","getFirstRange","getItems","selectedElement","getSelectedElement","selectedLinkUrl","addIncludeNoteToTextCommand","addIncludeNote","boxSize","insertContent","CodeMirror","keyMap","modeURL","codeEditor","viewportMargin","Infinity","indentUnit","matchBrackets","matchTags","bothTags","highlightSelectionMatches","showToken","annotateScrollbar","lint","gutters","lineNumbers","tabindex","lineWrapping","dragDrop","setValue","clearHistory","findModeByMIME","setOption","autoLoadMode","mode","getValue","setCursor","lineCount","indent","pre","tag","$previewContent","$previewNotAvailable","$imageView","copyImageAt","copyImageReferenceToClipboardEvent","$noteDetailRenderHelp","$noteDetailRenderContent","renderActiveNoteEvent","$relationMapContainer","mapData","jsPlumbInstance","pzInstance","$relationMapWrapper","getMousePosition","createNoteBox","saveData","contextMenuHandler","ev","dropNoteOntoRelationMapHandler","jsPlumb","ready","originalTarget","$noteBox","idToNoteId","noteIdToId","isDeleteNoteChecked","transform","scale","loadMapData","initJsPlumbInstance","initPanZoom","clearMap","deleteEveryEndpoint","relationMapNoteId","inverseRelations","noteTitles","batch","connection","connect","getOverlay","canvas","panzoom","minZoom","smoothScroll","filterKey","dx","dy","dz","altKey","setZoom","getZoom","saveCurrentTransform","zoomTo","moveTo","newTransform","getTransform","dispose","getInstance","Endpoint","radius","Connector","ConnectionOverlays","HoverPaintStyle","stroke","strokeWidth","registerConnectionType","anchor","connector","overlays","originalEvent","connectionCreatedHandler","deleteConnection","shown","$answer","attrName","mousedown","getContainer","draggable","drag","stop","finalPos","makeSource","connectorStyle","connectionType","extract","makeTarget","dropOptions","hoverClass","allowLoopback","matches","dataTransfer","rect","getBoundingClientRect","clientX","clientY","relationMapResetPanZoomEvent","relationMapResetZoomInEvent","relationMapResetZoomOutEvent","SCENE_VERSION_INITIAL","SCENE_VERSION_ERROR","DEBOUNCE_TIME_ONCHANGEHANDLER","EXCALIDRAW_ASSET_PATH","origin","currentSceneVersion","excalidrawRef","$render","reactHandlers","createExcalidrawReactApp","onChangeHandler","isNewSceneVersion","libraryChanged","React","ReactDOM","renderElement","unmountComponentAtNode","elements","appState","boundingClientRect","excalidrawWrapperRef","offsetLeft","offsetTop","sceneData","collaborators","fileArray","fileId","file","updateScene","addFiles","getAttachmentsByRole","blobs","libraryItems","updateLibrary","merge","getSceneVersion","getSceneElements","getAppState","getFiles","svgString","ExcalidrawLib","exportToSvg","exportPadding","metadata","activeFiles","version","scrollX","scrollY","libraryItem","dataSaved","isNotInitialScene","updateSceneVersion","Excalidraw","useRef","dimensions","useState","useEffect","onResize","removeEventListener","onLinkOpen","useCallback","nativeEvent","detail","Fragment","ref","langCode","onPaste","onLibraryChange","onChange","viewModeEnabled","zenModeEnabled","gridModeEnabled","isCollaborating","detectScroll","handleKeyboardGlobally","autoFocus","UIOptions","saveToActiveFile","saveAsImage","sceneVersion","$passwordForm","$passwordInput","$helpNoChildren","noteMapWidget","$noteDetailWebViewHelp","$noteDetailWebViewContent","webViewSrc","removeAttribute","docName","appPath","contentWidgets","$linksWrapper","$helpButton","attachmentDetailWidget","$list","noteLink","renderedAttachmentIds","NoteDetailWidget","typeWidgets","getTypeWidget","typeWidget","checkFullHeight","$promotedAttributes","printThis","footer","importCSS","loadCSS","readOnlyTemporarilyDisabledEvent","QuickSearchWidget","$searchString","$dropdownToggle","keydown","displayedNoteIds","nodeName","$showInFullButton","showInFullSearch","quickSearchEvent","MAX_SEARCH_RESULTS_IN_TREE","cancelClickPropagation","NoteTreeWidget","treeName","$tree","$treeActions","refreshSearch","ui","fancytree","getNode","$treeSettingsPopup","$hideArchivedNotesCheckbox","$autoCollapseNoteTree","$treeSettingsButton","hideArchivedNotes","autoCollapseNoteTree","$saveTreeSettingsButton","setHideArchivedNotes","setAutoCollapseNoteTree","reloadTreeFromCache","initFancyTree","setupNoteTitleTooltip","currentTarget","$sub","conOffset","offset","conDistanceFromTop","conDistanceFromLeft","subOffset","subDistanceFromTop","subDistanceFromLeft","isEnclosing","innerText","treeData","prepareRootNode","titlesTabbable","keyboard","extensions","scrollOfs","bottom","scrollParent","minExpandLevel","click","activityDetected","targetType","isSelected","getSelectedOrActiveNoteIds","shiftKey","activeNode","selectInBetween","first","second","setSelected","getNextSibling","clearSelectedNodes","getIndex","setFocus","reactivate","setActive","beforeActivate","expand","setExpanded","collapse","autoExpand","dnd5","autoExpandMS","preventLazyParents","dragStart","dragEnter","hitMode","uploadFiles","safeImport","shrinkImages","textImportedAsText","codeImportedAsCode","explodeArchives","replaceUnderscoresWithSpaces","jsonStr","selectedBranchIds","prepareChildren","clones","highlightActiveClones","enhanceTitle","$span","span","isHoistedNote","$enterWorkspaceButton","$refreshSearchButton","$createChildNoteButton","$unhoistButton","loadChildren","visit","subNode","isUndefined","select","getHotKeys","hotKeys","LauncherContextMenu","TreeContextMenu","getTree","prepareNode","noteList","extraClasses","getExtraClasses","noEvents","noAnimation","forceLazy","refKey","lazy","expanded","colorClass","getSelectedNodes","stopOnParents","getNodesByNoteId","batchUpdate","filterHoistedBranch","setExpandedStatusForSubtree","collapseTreeEvent","collapseTree","getFocusedNode","getFocusNode","selectedNode","expandToNote","makeVisible","scrollIntoView","noFocus","isLoaded","updateNode","foundChildNode","findChildNode","childNode","getNodeFromPath","getNodesByBranch","getNodesByRef","oldActiveNode","newActiveNode","oldActiveNodeFocused","hasFocus","enableUpdate","autoCollapseTimeoutId","noteIdsToKeepExpanded","noneCollapsedYet","getRootNode","nodeCtx","refreshCtx","noteIdsToUpdate","noteIdsToReload","movedActiveNode","parentsOfAddedNodes","dirtyingLabels","allBranchesDeleted","getPrevSibling","frocaBranch","foundNode","addChildren","activeNotePath","activeNodeFocused","nextNotePath","nextNode","notesById","nodeA","nodeB","branchA","branchB","rootNode","forceUpdate","hoistedNotePath","lastFilteredHoistedNotePath","clearFilter","toggleHiddenNode","filterBranches","hiddenNode","li","frocaReloadedEvent","hotKeyMap","getSelectedOrActiveBranchIds","canBeMovedUpOrDown","moveNoteUpCommand","beforeNode","moveNoteDownCommand","afterNode","moveNoteUpInHierarchyCommand","moveNoteDownInHierarchyCommand","toNode","addNoteAboveToSelectionCommand","prevSibling","addNoteBelowToSelectionCommand","nextSibling","expandSubtreeCommand","expandTree","collapseSubtreeCommand","selectAllNotesInParentCommand","copyNotesToClipboardCommand","cutNotesToClipboardCommand","pasteNotesFromClipboardCommand","pasteNotesAfterFromClipboardCommand","defaultType","editNoteTitleCommand","protectSubtreeCommand","unprotectSubtreeCommand","duplicateSubtreeCommand","nodesToDuplicate","nodeToDuplicate","moveShortcutToVisibleCommand","moveShortcutToAvailableCommand","addNoteLauncherCommand","createLauncherNote","addScriptLauncherCommand","addWidgetLauncherCommand","addSpacerLauncherCommand","launcherType","CloseDetailButtonWidget","MobileDetailMenuWidget","ScreenContainer","screenName","activeScreenChangedEvent","ScrollingContainer","scrollContainerToCommand","ProtectedSessionPasswordDialog","showProtectedSessionPasswordDialogEvent","closeProtectedSessionPasswordDialogEvent","DELETE_NOTE_BUTTON_CLASS","ConfirmDialog","$originallyFocused","$confirmContent","$okButton","$cancelButton","$custom","doResolve","showConfirmDialogEvent","showConfirmDeleteNoteBoxWithNoteDialogEvent","FilePropertiesWidget","toggleCommand","getTitle","$fileNoteId","$fileName","$fileType","$fileSize","$uploadNewRevisionButton","FloatingButtons","$children","hideFloatingButtonsCommand","AbstractButtonWidget","settings","titlePlacement","onContextMenu","refreshIcon","initialRenderCompleteEvent","OnClickButtonWidget","onClick","onAuxClick","EditButton","wasVisible","RelationMapButtons","$createChildNote","$zoomInButton","$zoomOutButton","$resetPanZoomButton","MermaidExportButton","BacklinksWidget","$count","$items","$ticker","renderBacklinks","clearItems","backlinks","bl","backlink","relationName","excerpts","HideFloatingButtonsButton","MermaidWidget","$display","$errorContainer","$errorMessage","flow","useMaxWidth","sequence","gantt","pie","journey","git","wheelZoomLoaded","renderSvg","dirtyAttachment","filename","NoteListWidget","observer","IntersectionObserver","entries","isIntersecting","checkRenderStatus","rootMargin","threshold","noteIdRefreshed","shownNoteId","renderNoteList","noteListRenderer","$noteList","includedNoteIds","getIncludedNoteIds","page","pageSize","viewType","includedLinks","highlightRegex","startIdx","endIdx","pageNoteIds","pageNotes","$card","renderNote","renderPager","$pager","pageCount","ceil","lastPrinted","abs","startIndex","endIndex","renderList","$expander","toggleContent","markRegExp","separateWordSearch","caseSensitive","renderNoteContent","imageLinks","getChildNotes","noteDetailRefreshedEvent","notesReloadedEvent","UpdateAvailableWidget","updateVersionStatus","latestVersion","triliumVersion","GlobalMenuWidget","updateAvailableWidget","$dropdown","$updateToLatestVersionButton","$zoomState","updateZoomState","zoomPercent","fetchLatestVersion","fetch","json","tag_name","substring","downloadLatestVersionCommand","RightDropdownButtonWidget","iconClass","dropdownTpl","dropdownShown","pixelsToBottom","$dropdownContent","hideDropdown","CalendarWidget","$month","$next","$previous","$label","setMonth","createMonth","init","activeDate","todaysDate","setDate","createDay","dateNotesForMonth","day","$newDay","$date","dateNoteId","isEqual","currentMonth","$day","getDay","monthsAsString","monthIndex","SpacerWidget","baseSize","growthFactor","OpenNoteButtonWidget","noteToOpen","launch","BookmarkFolderWidget","$parentNote","$childrenNotes","linkOptions","BookmarkButtons","bookmarkParentNote","as","CommandButtonWidget","_command","ProtectedSessionStatusWidget","protectedSessionStartedEvent","ignoreNotConfigured","errorCode","SyncStatusWidget","syncState","allChangesPushed","sync","processMessage","showIcon","lastSyncedPush","AbstractLauncher","launcherNote","NoteLauncher","getTargetNoteId","ScriptLauncher","executeScript","getRelationTarget","TodayLauncher","ButtonFromNoteWidget","buttonNoteIdProvider","provider","updateIcon","buttonNoteId","buttonNote","HistoryNavigationButton","showContextMenu","activeNoteChangedEvent","LauncherWidget","innerWidget","TRILIUM_SAFE_MODE","initCommandLauncherWidget","initCustomWidget","initBuiltinWidget","builtinWidget","LauncherContainer","visibleLaunchersRoot","newChildren","launcherWidget","initLauncher","RootContainer","SharedInfoWidget","$sharedLink","$sharedText","shareId","getShareId","PromotedAttributesWidget","promotedDefAttrs","ownedAttributes","$cells","definitionAttr","valueType","valueName","valueAttrs","valueAttr","$cell","createPromotedAttributeCell","promotedAttributeChanged","$actionCell","$multiplicityCell","attributeValues","step","$addButton","$new","$removeButton","sameAttrSelector","selectedPath","getSelectedNotePath","treeCache","importMarkdownInline","SEARCH_HELP_TEXT","msg","lineNo","columnNo","appCssNoteId","appCssNoteIds"],"sourceRoot":""}